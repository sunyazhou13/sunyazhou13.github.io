<!DOCTYPE html><html lang="zh-Hans" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Learning AV Foundation(五)播放视频" /><meta name="author" content="孙亚洲" /><meta property="og:locale" content="zh_Hans" /><meta name="description" content="嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者." /><meta property="og:description" content="嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者." /><link rel="canonical" href="https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" /><meta property="og:url" content="https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" /><meta property="og:site_name" content="迈腾大队长" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-03-05T00:56:06+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning AV Foundation(五)播放视频" /><meta name="twitter:site" content="@sunyazhou13" /><meta name="twitter:creator" content="@孙亚洲" /><meta name="google-site-verification" content="Xo29j227HYVdC-vDA_-qJwvDP3PIo-lC78CFeBvhrDA" /> <script type="application/ld+json"> {"datePublished":"2018-03-05T00:56:06+08:00","url":"https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/","@type":"BlogPosting","dateModified":"2018-03-05T00:56:06+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/"},"author":{"@type":"Person","name":"孙亚洲"},"description":"嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者.","headline":"Learning AV Foundation(五)播放视频","@context":"https://schema.org"}</script><title>Learning AV Foundation(五)播放视频 | 迈腾大队长</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">迈腾大队长</a></div><div class="site-subtitle font-italic">不断学习, 与时俱进.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>主页</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/projects/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-paint-brush ml-xl-3 mr-xl-3 unloaded"></i> <span>作品</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/sunyazhou13" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sunyazhou13" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.weibo.com/sunyazhou13" aria-label="" target="_blank" rel="noopener"> <i class="fab fa-weibo"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sunyazhou','111.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 主页 </a> </span> <span>Learning AV Foundation(五)播放视频</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Learning AV Foundation(五)播放视频</h1><div class="post-meta text-muted d-flex flex-column"><div> 　由 <span class="author"> 孙亚洲 </span> 发布于 <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Mar 5, 2018, 12:56 AM +0800" > 2018-03-05 <i class="unloaded">2018-03-05T00:56:06+08:00</i> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20180304LearningAVFoundationPlayingVideo/5kAirplay.jpg" alt="" /></p><h1 id="前言">前言</h1><p>很久没有写Learning AV Foundation相关的文章了,言归正传 本篇介绍一下简单的视频播放</p><p>了解视频播放之前我们来看戏<code class="language-plaintext highlighter-rouge">AVPlayer</code>需要的一些组件模型</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20180304LearningAVFoundationPlayingVideo/AVPlayer.png" alt="AVPlayer组件模型" /></p><h2 id="avplayer">AVPlayer</h2><p><code class="language-plaintext highlighter-rouge">AVPlayer</code>是一个用来播放基于基于时间的视听媒体的控制对象,支持播放:</p><ul><li>本地 媒体文件<li>异步下载 媒体文件<li>HTTP Live Streaming协议的流媒体 文件</ul><p><code class="language-plaintext highlighter-rouge">AVPlayer</code> 是个 逻辑层组件</p><p>(应用可以分为如下几层)</p><blockquote><p>UI层<br /> 业务逻辑层<br /> 持久层+网络层</p></blockquote><p>如果播放<code class="language-plaintext highlighter-rouge">MP3</code>或<code class="language-plaintext highlighter-rouge">AAC</code>等音频文件, 是没有啥UI可视化的页面的。要是播放一个<code class="language-plaintext highlighter-rouge"> QuickTime</code>的电影或一个<code class="language-plaintext highlighter-rouge">MPEG-4</code>视频, 就会搞得很不适应.<br /> 如果要播放视频等功能设计到UI的话，可以使用<code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>类。</p><blockquote><p>注意: <em><code class="language-plaintext highlighter-rouge">AVPlayer</code>只管理一个单独资源的播放, 如果播放多个可以使用<code class="language-plaintext highlighter-rouge">AVPlayer</code>的子类<code class="language-plaintext highlighter-rouge">AVQueuePlayer</code>, 用它来管理一个资源队列, 当需要在一个序列中播放多个条目或者 为音频、视频资源设置播放循环时刻使用这个类</em>.</p></blockquote><h2 id="avplayerlayer">AVPlayerLayer</h2><p><code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>构建于 <code class="language-plaintext highlighter-rouge">Core Animation</code>之上, 是<code class="language-plaintext highlighter-rouge">AV Foundation</code>中能找到的位数不多的UI组件. <code class="language-plaintext highlighter-rouge">Core Animation</code> 是<code class="language-plaintext highlighter-rouge">Mac</code>和<code class="language-plaintext highlighter-rouge">iOS</code>平台上负责图形渲染与动画的基础框架,主要用于这些平台的美化和动画流畅度的提升. <code class="language-plaintext highlighter-rouge">Core Animation</code>本身具有基于时间的属性,并且由于它基于<code class="language-plaintext highlighter-rouge">OpenGL</code>,所以具有很好的性能.</p><p><code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>扩展了<code class="language-plaintext highlighter-rouge">Core Animation</code> 的<code class="language-plaintext highlighter-rouge">CALayer</code>类, 并通过框架显示视频内容到屏幕上. 我们知道Layer是不响应事件的.</p><p>创建<code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>需要实例化一个<code class="language-plaintext highlighter-rouge">AVPlayer</code>的对象，<code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>有一个<code class="language-plaintext highlighter-rouge">videoGravity</code>属性可以设置三种类似填充模式的东西,用来拉扯和缩放的视频. 下面列举了16:9的视频置于4:3矩形范围来说明不同的<code class="language-plaintext highlighter-rouge">gravity</code>.</p><p>如下图:</p><p>__AVLayerVideoGravityResizeAspect__保持缩放比例 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResizeAspect.png" alt="" /></p><p>__AVLayerVideoGravityResizeAspectFill__填充 <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResizeAspectFill.png" alt="" /></p><p>__AVLayerVideoGravityResize__拉伸</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResize.png" alt="" /></p><h2 id="avplayeritem">AVPlayerItem</h2><p>我们需要使用<code class="language-plaintext highlighter-rouge">AVPlayer</code>播放<code class="language-plaintext highlighter-rouge">AVAsset</code>,前面我知道<code class="language-plaintext highlighter-rouge">AVAsset</code>元数据里面有<code class="language-plaintext highlighter-rouge">创建时间</code>、<code class="language-plaintext highlighter-rouge">元数据</code>和<code class="language-plaintext highlighter-rouge">时长</code>等信息.但是并没有媒体中特定位置的方法.</p><p><strong>这是因为<code class="language-plaintext highlighter-rouge">AVAsset</code>模型只包含媒体资源的静态信息.这些不变的属性用来描述对象的静态信息.这就意味着仅使用<code class="language-plaintext highlighter-rouge">AVAsset</code>对象是不能实现播放功能的.如果播放我们需要使用<code class="language-plaintext highlighter-rouge">AVPlayerItem</code></strong></p><p><strong><code class="language-plaintext highlighter-rouge">AVPlayerItem</code>可以理解成是一个动态的<code class="language-plaintext highlighter-rouge">AVAsset</code>模型,</strong><br /> <code class="language-plaintext highlighter-rouge">AVPlayerItem</code>有<code class="language-plaintext highlighter-rouge">seekToTime:</code>方法和<code class="language-plaintext highlighter-rouge">presentationSize:</code>,<code class="language-plaintext highlighter-rouge">AVPlayerItem</code>由一个或多个媒体曲目组成.</p><p><code class="language-plaintext highlighter-rouge">AVPlayerItem</code>里面有``AVPlayerItemTrack`轨道属性.</p><h2 id="播放示例">播放示例</h2><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
	<span class="n">self</span><span class="p">.</span><span class="n">localURL</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">URLForResource</span><span class="p">:</span><span class="s">@"hubblecast"</span> <span class="nf">withExtension</span><span class="p">:</span><span class="s">@"m4v"</span><span class="p">];</span>

    <span class="n">AVAsset</span> <span class="o">*</span><span class="n">asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVAsset</span> <span class="nf">assetWithURL</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">localURL</span><span class="p">];</span>
    
    <span class="n">AVPlayerItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVPlayerItem</span> <span class="nf">playerItemWithAsset</span><span class="p">:</span><span class="n">asset</span><span class="p">];</span>
    
    <span class="n">AVPlayer</span> <span class="o">*</span><span class="n">player</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVPlayer</span> <span class="nf">playerWithPlayerItem</span><span class="p">:</span><span class="n">item</span><span class="p">];</span>
    
    <span class="n">AVPlayerLayer</span> <span class="o">*</span><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVPlayerLayer</span> <span class="nf">playerLayerWithPlayer</span><span class="p">:</span><span class="n">player</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span> <span class="nf">addSublayer</span><span class="p">:</span><span class="n">layer</span><span class="p">];</span>
<span class="p">}</span>
</pre></table></code></div></div><p>这个<code class="language-plaintext highlighter-rouge">AVPlayerItem</code>并没有任何代理告知我们是否已经开始播放,所以一般的搞法都是使用<code class="language-plaintext highlighter-rouge">KVO</code>去监听它的一个属性,<code class="language-plaintext highlighter-rouge">AVPlayerItemStatus</code></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="nf">NS_ENUM</span><span class="p">(</span><span class="n">NSInteger</span><span class="p">,</span> <span class="n">AVPlayerItemStatus</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">AVPlayerItemStatusUnknown</span><span class="p">,</span>
	<span class="n">AVPlayerItemStatusReadyToPlay</span><span class="p">,</span>
	<span class="n">AVPlayerItemStatusFailed</span>
<span class="p">};</span>
</pre></table></code></div></div><p>当它的<code class="language-plaintext highlighter-rouge">status</code>变成<code class="language-plaintext highlighter-rouge">AVPlayerItemStatusReadyToPlay</code>就说明已载入完成准备播放.</p><h2 id="cmtime">CMTime</h2><p>使用<code class="language-plaintext highlighter-rouge">CMTime</code>来处理各种音视频相关的时间操作,他是<code class="language-plaintext highlighter-rouge">CoreMedia</code>framework中的结构体.专门用于处理精确的时间,我们以前用的<code class="language-plaintext highlighter-rouge">NSTimeInterval</code>是存在计算不精确的问题(苹果官方说的).</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">CMTimeValue</span>	<span class="n">value</span><span class="p">;</span>		<span class="c1">//分子</span>
	<span class="n">CMTimeScale</span>	<span class="n">timescale</span><span class="p">;</span> <span class="c1">//分母</span>
	<span class="n">CMTimeFlags</span>	<span class="n">flags</span><span class="p">;</span>		<span class="c1">//标记是否失效 eg. kCMTimeFlags_Valid, kCMTimeFlags_PositiveInfinity</span>
	<span class="n">CMTimeEpoch</span>	<span class="n">epoch</span><span class="p">;</span>		
<span class="p">}</span> <span class="n">CMTime</span><span class="p">;</span>
</pre></table></code></div></div><p>这个结构体最关键的即使<code class="language-plaintext highlighter-rouge">value</code>(64位整形)和<code class="language-plaintext highlighter-rouge">timescale</code>(32位整形).</p><p>它表达时间的方式以分数表示比如:</p><p><code class="language-plaintext highlighter-rouge">0.5</code>秒</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">CMTime</span> <span class="n">halfSecond</span> <span class="o">=</span> <span class="n">CMTimeMake</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1">//0.5秒</span>
<span class="n">CMTime</span> <span class="n">fiveSecond</span> <span class="o">=</span> <span class="n">CMTimeMake</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">//5秒</span>
<span class="n">CMTime</span> <span class="n">oneSample</span> <span class="o">=</span> <span class="n">CMTimeMake</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">44100</span><span class="p">);</span> <span class="c1">//一个抽样的样本</span>
<span class="n">CMTime</span> <span class="n">zeroTime</span> <span class="o">=</span> <span class="n">kCMTimeZero</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="创建自己的播放器">创建自己的播放器</h2><p>首先需要封装一个<code class="language-plaintext highlighter-rouge">player</code>,</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cp">#import &lt;UIKit/UIKit.h&gt;
#import "TransportProtocol.h"
</span><span class="k">@class</span> <span class="nc">AVPlayer</span><span class="p">;</span>
<span class="k">@interface</span> <span class="nc">PlayerView</span> <span class="p">:</span> <span class="nc">UIView</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">id</span> <span class="o">&lt;</span><span class="n">TransportProtocol</span><span class="o">&gt;</span>  <span class="n">transport</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithPlayer</span><span class="p">:(</span><span class="n">AVPlayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">player</span><span class="p">;</span>
<span class="k">@end</span>

</pre></table></code></div></div><p>.m文件实现</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="cp">#import "PlayerView.h"
#import &lt;AVFoundation/AVFoundation.h&gt;
#import "THOverlayView.h"
</span><span class="k">@interface</span> <span class="nc">PlayerView</span> <span class="p">()</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">THOverlayView</span> <span class="o">*</span><span class="n">overlayView</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">PlayerView</span>
<span class="k">+</span> <span class="p">(</span><span class="n">Class</span><span class="p">)</span><span class="n">layerClass</span><span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">AVPlayerLayer</span> <span class="nf">class</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithPlayer</span><span class="p">:(</span><span class="n">AVPlayer</span> <span class="o">*</span><span class="p">)</span><span class="nv">player</span><span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithFrame</span><span class="p">:</span><span class="n">CGRectZero</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">blackColor</span><span class="p">];</span>
        <span class="n">self</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span> <span class="n">UIViewAutoresizingFlexibleWidth</span> <span class="o">|</span> <span class="n">UIViewAutoresizingFlexibleHeight</span><span class="p">;</span>
        <span class="p">[(</span><span class="n">AVPlayerLayer</span> <span class="o">*</span><span class="p">)[</span><span class="n">self</span> <span class="nf">layer</span><span class="p">]</span> <span class="nf">setPlayer</span><span class="p">:</span><span class="n">player</span><span class="p">];</span>
        <span class="p">[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">loadNibNamed</span><span class="p">:</span><span class="s">@"THOverlayView"</span> <span class="nf">owner</span><span class="p">:</span><span class="n">self</span> <span class="n">options</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">addSubview</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">overlayView</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">layoutSubviews</span><span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">layoutSubviews</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">overlayView</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span> <span class="o">&lt;</span><span class="n">TransportProtocol</span><span class="o">&gt;</span><span class="p">)</span><span class="n">transport</span><span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">overlayView</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></table></code></div></div><p>transport 是播放器的视图点击视图代理等集成了 在一起</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="k">@protocol</span> <span class="nc">TransportDelegate</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">play</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pause</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stop</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">scrubbingDidStart</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scrubbedToTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">scrubbingDidEnd</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">jumpedToTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span><span class="p">;</span>

<span class="k">@optional</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subtitleSelected</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">subtitle</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@protocol</span> <span class="nc">TransportProtocol</span> <span class="o">&lt;</span><span class="n">NSObject</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">id</span> <span class="o">&lt;</span><span class="n">TransportDelegate</span><span class="o">&gt;</span> <span class="n">delegate</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setCurrentTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span> <span class="nf">duration</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">duration</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setScrubbingTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">playbackComplete</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">setSubtitles</span><span class="p">:(</span><span class="n">NSArray</span> <span class="o">*</span><span class="p">)</span><span class="nv">subtitles</span><span class="p">;</span>
<span class="k">@end</span>
</pre></table></code></div></div><p>THOverlayView文件是顶层视图点击播放等等控件.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import &lt;UIKit/UIKit.h&gt;
</span><span class="k">@interface</span> <span class="nc">PlayerController</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">UIView</span> <span class="o">*</span><span class="n">view</span><span class="p">;</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithURL</span><span class="p">:(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">assetURL</span><span class="p">;</span>
<span class="k">@end</span>
</pre></table></code></div></div><p>播放器的实现文件如下</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
</pre><td class="rouge-code"><pre><span class="cp">#import "PlayerController.h"
#import &lt;AVFoundation/AVFoundation.h&gt;
#import "TransportProtocol.h"
#import "PlayerView.h"
#import "AVAsset+Additions.h"
#import "UIAlertView+Additions.h"
#import "THThumbnail.h"
</span>
<span class="c1">// AVPlayerItem's status property</span>
<span class="cp">#define STATUS_KEYPATH @"status"
</span>
<span class="c1">// Refresh interval for timed observations of AVPlayer</span>
<span class="cp">#define REFRESH_INTERVAL 0.5f
</span>
<span class="c1">// Define this constant for the key-value observation context.</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">PlayerItemStatusContext</span><span class="p">;</span>

<span class="k">@interface</span> <span class="nc">PlayerController</span> <span class="p">()</span> <span class="o">&lt;</span><span class="n">TransportDelegate</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">AVAsset</span>               <span class="o">*</span><span class="n">asset</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">AVPlayerItem</span>          <span class="o">*</span><span class="n">playerItem</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">AVPlayer</span>              <span class="o">*</span><span class="n">player</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">PlayerView</span>            <span class="o">*</span><span class="n">playerView</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">weak</span><span class="p">)</span> <span class="n">id</span> <span class="o">&lt;</span><span class="n">TransportProtocol</span><span class="o">&gt;</span>  <span class="n">transport</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">id</span>                    <span class="n">timeObserver</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">id</span>                    <span class="n">itemEndObserver</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="kt">float</span>                 <span class="n">lastPlaybackRate</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">AVAssetImageGenerator</span> <span class="o">*</span><span class="n">imageGenerator</span><span class="p">;</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">PlayerController</span>

<span class="cp">#pragma mark - Setup
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithURL</span><span class="p">:(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">assetURL</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_asset</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVAsset</span> <span class="nf">assetWithURL</span><span class="p">:</span><span class="n">assetURL</span><span class="p">];</span>                           <span class="c1">// 1</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">prepareToPlay</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">prepareToPlay</span> <span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">keys</span> <span class="o">=</span> <span class="p">@[</span>
                      <span class="s">@"tracks"</span><span class="p">,</span>
                      <span class="s">@"duration"</span><span class="p">,</span>
                      <span class="s">@"commonMetadata"</span><span class="p">,</span>
                      <span class="s">@"availableMediaCharacteristicsWithMediaSelectionOptions"</span>
                      <span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVPlayerItem</span> <span class="nf">playerItemWithAsset</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span>          <span class="c1">// 2</span>
                           <span class="nl">automaticallyLoadedAssetKeys:</span><span class="n">keys</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="nf">addObserver</span><span class="p">:</span><span class="n">self</span>                                       <span class="c1">// 3</span>
                      <span class="nl">forKeyPath:</span><span class="n">STATUS_KEYPATH</span>
                         <span class="nl">options:</span><span class="mi">0</span>
                         <span class="nl">context:</span><span class="o">&amp;</span><span class="n">PlayerItemStatusContext</span><span class="p">];</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVPlayer</span> <span class="nf">playerWithPlayerItem</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span><span class="p">];</span>          <span class="c1">// 4</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">playerView</span> <span class="o">=</span> <span class="p">[[</span><span class="n">PlayerView</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithPlayer</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">];</span>    <span class="c1">// 5</span>
    <span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">playerView</span><span class="p">.</span><span class="n">transport</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">transport</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">observeValueForKeyPath</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">keyPath</span>
                      <span class="nf">ofObject</span><span class="p">:(</span><span class="n">id</span><span class="p">)</span><span class="nv">object</span>
                        <span class="nf">change</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">change</span>
                       <span class="nf">context</span><span class="p">:(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nv">context</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">context</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">PlayerItemStatusContext</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>                        <span class="c1">// 1</span>
            
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="nf">removeObserver</span><span class="p">:</span><span class="n">self</span> <span class="nf">forKeyPath</span><span class="p">:</span><span class="n">STATUS_KEYPATH</span><span class="p">];</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">AVPlayerItemStatusReadyToPlay</span><span class="p">)</span> <span class="p">{</span>
                
                <span class="c1">// Set up time observers.                                   // 2</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">addPlayerItemTimeObserver</span><span class="p">];</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">addItemEndObserverForPlayerItem</span><span class="p">];</span>
                
                <span class="n">CMTime</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">playerItem</span><span class="p">.</span><span class="n">duration</span><span class="p">;</span>
                
                <span class="c1">// Synchronize the time display                             // 3</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setCurrentTime</span><span class="p">:</span><span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">kCMTimeZero</span><span class="p">)</span>
                                      <span class="nl">duration:</span><span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">duration</span><span class="p">)];</span>
                
                <span class="c1">// Set the video title.</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setTitle</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span><span class="p">.</span><span class="n">title</span><span class="p">];</span>                 <span class="c1">// 4</span>
                
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">play</span><span class="p">];</span>                                         <span class="c1">// 5</span>
                
                <span class="p">[</span><span class="n">self</span> <span class="nf">loadMediaOptions</span><span class="p">];</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">generateThumbnails</span><span class="p">];</span>
                
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">UIAlertView</span> <span class="nf">showAlertWithTitle</span><span class="p">:</span><span class="s">@"Error"</span>
                                        <span class="nl">message:</span><span class="s">@"Failed to load video"</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loadMediaOptions</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">mc</span> <span class="o">=</span> <span class="n">AVMediaCharacteristicLegible</span><span class="p">;</span>                            <span class="c1">// 1</span>
    <span class="n">AVMediaSelectionGroup</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span> <span class="nf">mediaSelectionGroupForMediaCharacteristic</span><span class="p">:</span><span class="n">mc</span><span class="p">];</span>          <span class="c1">// 2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">subtitles</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>                 <span class="c1">// 3</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">AVMediaSelectionOption</span> <span class="o">*</span><span class="n">option</span> <span class="k">in</span> <span class="n">group</span><span class="p">.</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">subtitles</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">option</span><span class="p">.</span><span class="n">displayName</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setSubtitles</span><span class="p">:</span><span class="n">subtitles</span><span class="p">];</span>                            <span class="c1">// 4</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setSubtitles</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">subtitleSelected</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">subtitle</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">mc</span> <span class="o">=</span> <span class="n">AVMediaCharacteristicLegible</span><span class="p">;</span>
    <span class="n">AVMediaSelectionGroup</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span> <span class="nf">mediaSelectionGroupForMediaCharacteristic</span><span class="p">:</span><span class="n">mc</span><span class="p">];</span>          <span class="c1">// 1</span>
    <span class="n">BOOL</span> <span class="n">selected</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">AVMediaSelectionOption</span> <span class="o">*</span><span class="n">option</span> <span class="k">in</span> <span class="n">group</span><span class="p">.</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">([</span><span class="n">option</span><span class="p">.</span><span class="n">displayName</span> <span class="nf">isEqualToString</span><span class="p">:</span><span class="n">subtitle</span><span class="p">])</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="nf">selectMediaOption</span><span class="p">:</span><span class="n">option</span>                       <span class="c1">// 2</span>
                         <span class="nl">inMediaSelectionGroup:</span><span class="n">group</span><span class="p">];</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">selected</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="nf">selectMediaOption</span><span class="p">:</span><span class="nb">nil</span>                              <span class="c1">// 3</span>
                     <span class="nl">inMediaSelectionGroup:</span><span class="n">group</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cp">#pragma mark - Time Observers
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addPlayerItemTimeObserver</span> <span class="p">{</span>
    
    <span class="c1">// Create 0.5 second refresh interval - REFRESH_INTERVAL == 0.5</span>
    <span class="n">CMTime</span> <span class="n">interval</span> <span class="o">=</span>
    <span class="n">CMTimeMakeWithSeconds</span><span class="p">(</span><span class="n">REFRESH_INTERVAL</span><span class="p">,</span> <span class="n">NSEC_PER_SEC</span><span class="p">);</span>              <span class="c1">// 1</span>
    
    <span class="c1">// Main dispatch queue</span>
    <span class="n">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_main_queue</span><span class="p">();</span>                     <span class="c1">// 2</span>
    
    <span class="c1">// Create callback block for time observer</span>
    <span class="n">__weak</span> <span class="n">PlayerController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>                             <span class="c1">// 3</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="n">callback</span><span class="p">)(</span><span class="n">CMTime</span> <span class="n">time</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">CMTime</span> <span class="n">time</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSTimeInterval</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
        <span class="n">NSTimeInterval</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">playerItem</span><span class="p">.</span><span class="n">duration</span><span class="p">);</span>
        <span class="p">[</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setCurrentTime</span><span class="p">:</span><span class="n">currentTime</span> <span class="nf">duration</span><span class="p">:</span><span class="n">duration</span><span class="p">];</span>  <span class="c1">// 4</span>
    <span class="p">};</span>
    
    <span class="c1">// Add observer and store pointer for future use</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timeObserver</span> <span class="o">=</span>                                                     <span class="c1">// 5</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">addPeriodicTimeObserverForInterval</span><span class="p">:</span><span class="n">interval</span>
                                              <span class="nl">queue:</span><span class="n">queue</span>
                                         <span class="nl">usingBlock:</span><span class="n">callback</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addItemEndObserverForPlayerItem</span> <span class="p">{</span>
    
    <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">AVPlayerItemDidPlayToEndTimeNotification</span><span class="p">;</span>
    
    <span class="n">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSOperationQueue</span> <span class="nf">mainQueue</span><span class="p">];</span>
    
    <span class="n">__weak</span> <span class="n">PlayerController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>                             <span class="c1">// 1</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="n">callback</span><span class="p">)(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="n">note</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span><span class="n">notification</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">player</span> <span class="nf">seekToTime</span><span class="p">:</span><span class="n">kCMTimeZero</span>                             <span class="c1">// 2</span>
                  <span class="nl">completionHandler:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">finished</span><span class="p">)</span> <span class="p">{</span>
                      <span class="p">[</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">transport</span> <span class="nf">playbackComplete</span><span class="p">];</span>                          <span class="c1">// 3</span>
                  <span class="p">}];</span>
    <span class="p">};</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">itemEndObserver</span> <span class="o">=</span>                                                  <span class="c1">// 4</span>
    <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">addObserverForName</span><span class="p">:</span><span class="n">name</span>
                                                      <span class="nl">object:</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span>
                                                       <span class="nl">queue:</span><span class="n">queue</span>
                                                  <span class="nl">usingBlock:</span><span class="n">callback</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - THTransportDelegate Methods
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">play</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">play</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pause</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">lastPlaybackRate</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">rate</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">pause</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stop</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">setRate</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">playbackComplete</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">jumpedToTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">seekToTime</span><span class="p">:</span><span class="n">CMTimeMakeWithSeconds</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">NSEC_PER_SEC</span><span class="p">)];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">scrubbingDidStart</span> <span class="p">{</span>                                                 <span class="c1">// 1</span>
    <span class="n">self</span><span class="p">.</span><span class="n">lastPlaybackRate</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">rate</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">pause</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">removeTimeObserver</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">timeObserver</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timeObserver</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">scrubbedToTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span> <span class="p">{</span>                               <span class="c1">// 2</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">playerItem</span> <span class="nf">cancelPendingSeeks</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">seekToTime</span><span class="p">:</span><span class="n">CMTimeMakeWithSeconds</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">NSEC_PER_SEC</span><span class="p">)</span> <span class="nf">toleranceBefore</span><span class="p">:</span><span class="n">kCMTimeZero</span> <span class="n">toleranceAfter</span><span class="o">:</span><span class="n">kCMTimeZero</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">scrubbingDidEnd</span> <span class="p">{</span>                                                   <span class="c1">// 3</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">addPlayerItemTimeObserver</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">lastPlaybackRate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">play</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="cp">#pragma mark - Thumbnail Generation
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">generateThumbnails</span> <span class="p">{</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">imageGenerator</span> <span class="o">=</span>                                                   <span class="c1">// 1</span>
    <span class="p">[</span><span class="n">AVAssetImageGenerator</span> <span class="nf">assetImageGeneratorWithAsset</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span><span class="p">];</span>
    
    <span class="c1">// Generate the @2x equivalent</span>
    <span class="n">self</span><span class="p">.</span><span class="n">imageGenerator</span><span class="p">.</span><span class="n">maximumSize</span> <span class="o">=</span> <span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">200</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">);</span>             <span class="c1">// 2</span>
    
    <span class="n">CMTime</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">asset</span><span class="p">.</span><span class="n">duration</span><span class="p">;</span>
    
    <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>                         <span class="c1">// 3</span>
    <span class="n">CMTimeValue</span> <span class="n">increment</span> <span class="o">=</span> <span class="n">duration</span><span class="p">.</span><span class="n">value</span> <span class="o">/</span> <span class="mi">20</span><span class="p">;</span>
    <span class="n">CMTimeValue</span> <span class="n">currentValue</span> <span class="o">=</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="o">*</span> <span class="n">duration</span><span class="p">.</span><span class="n">timescale</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">currentValue</span> <span class="o">&lt;=</span> <span class="n">duration</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">CMTime</span> <span class="n">time</span> <span class="o">=</span> <span class="n">CMTimeMake</span><span class="p">(</span><span class="n">currentValue</span><span class="p">,</span> <span class="n">duration</span><span class="p">.</span><span class="n">timescale</span><span class="p">);</span>
        <span class="p">[</span><span class="n">times</span> <span class="nf">addObject</span><span class="p">:[</span><span class="n">NSValue</span> <span class="nf">valueWithCMTime</span><span class="p">:</span><span class="n">time</span><span class="p">]];</span>
        <span class="n">currentValue</span> <span class="o">+=</span> <span class="n">increment</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="n">__block</span> <span class="n">NSUInteger</span> <span class="n">imageCount</span> <span class="o">=</span> <span class="n">times</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>                            <span class="c1">// 4</span>
    <span class="n">__block</span> <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">images</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
    
    <span class="n">AVAssetImageGeneratorCompletionHandler</span> <span class="n">handler</span><span class="p">;</span>                         <span class="c1">// 5</span>
    
    <span class="n">handler</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">CMTime</span> <span class="n">requestedTime</span><span class="p">,</span>
                <span class="n">CGImageRef</span> <span class="n">imageRef</span><span class="p">,</span>
                <span class="n">CMTime</span> <span class="n">actualTime</span><span class="p">,</span>
                <span class="n">AVAssetImageGeneratorResult</span> <span class="n">result</span><span class="p">,</span>
                <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="n">AVAssetImageGeneratorSucceeded</span><span class="p">)</span> <span class="p">{</span>                     <span class="c1">// 6</span>
            <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nf">imageWithCGImage</span><span class="p">:</span><span class="n">imageRef</span><span class="p">];</span>
            <span class="n">id</span> <span class="n">thumbnail</span> <span class="o">=</span>
            <span class="p">[</span><span class="n">THThumbnail</span> <span class="nf">thumbnailWithImage</span><span class="p">:</span><span class="n">image</span> <span class="nf">time</span><span class="p">:</span><span class="n">actualTime</span><span class="p">];</span>
            <span class="p">[</span><span class="n">images</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">thumbnail</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
        <span class="p">}</span>
        
        <span class="c1">// If the decremented image count is at 0, we're all done.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">imageCount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>                                            <span class="c1">// 7</span>
            <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
                <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">THThumbnailsGeneratedNotification</span><span class="p">;</span>
                <span class="n">NSNotificationCenter</span> <span class="o">*</span><span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">];</span>
                <span class="p">[</span><span class="n">nc</span> <span class="nf">postNotificationName</span><span class="p">:</span><span class="n">name</span> <span class="nf">object</span><span class="p">:</span><span class="n">images</span><span class="p">];</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">};</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">imageGenerator</span> <span class="nf">generateCGImagesAsynchronouslyForTimes</span><span class="p">:</span><span class="n">times</span>       <span class="c1">// 8</span>
                                              <span class="nl">completionHandler:</span><span class="n">handler</span><span class="p">];</span>
<span class="p">}</span>


<span class="cp">#pragma mark - Housekeeping
</span>
<span class="k">-</span> <span class="p">(</span><span class="n">UIView</span> <span class="o">*</span><span class="p">)</span><span class="n">view</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">playerView</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">dealloc</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">itemEndObserver</span><span class="p">)</span> <span class="p">{</span>                                             <span class="c1">// 5</span>
        <span class="n">NSNotificationCenter</span> <span class="o">*</span><span class="n">nc</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">];</span>
        <span class="p">[</span><span class="n">nc</span> <span class="nf">removeObserver</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">itemEndObserver</span>
                      <span class="nl">name:</span><span class="n">AVPlayerItemDidPlayToEndTimeNotification</span>
                    <span class="nl">object:</span><span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">.</span><span class="n">currentItem</span><span class="p">];</span>
        <span class="n">self</span><span class="p">.</span><span class="n">itemEndObserver</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>

</pre></table></code></div></div><p>这里说一下如何监听时间从而得知播放时间回调</p><h3 id="监听时间">监听时间</h3><p>当播放器播放的时候我们无法得知播放到播放器的哪个位置,为了解决这个问题<code class="language-plaintext highlighter-rouge">AVPlayerItem</code>添加了两个监听播放的方法以及具体的用法<code class="language-plaintext highlighter-rouge">API</code>.</p><h4 id="定期监听">定期监听</h4><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">addPeriodicTimeObserverForInterval</span><span class="p">:(</span><span class="n">CMTime</span><span class="p">)</span><span class="nv">interval</span>
                                   <span class="nf">queue</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">dispatch_queue_t</span><span class="p">)</span><span class="nv">queue</span>
                              <span class="nf">usingBlock</span><span class="p">:(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="n">CMTime</span> <span class="n">time</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>
</pre></table></code></div></div><p>这里主要是为了随着时间的变化移动播放器seek位置更新时间显示,通过<code class="language-plaintext highlighter-rouge">AVPlayer</code>的<code class="language-plaintext highlighter-rouge">addPeriodicTimeObserverForInterval:queue:usingBlock:</code> 来监听播放时间的变化</p><ul><li><code class="language-plaintext highlighter-rouge">interv</code><em>监听周期的间隔<code class="language-plaintext highlighter-rouge">CMTime</code></em><li><code class="language-plaintext highlighter-rouge">queue</code> <em>通知发送的顺序调度队列,一般我们都放在主线程回掉.(注意这里不能放在并行队列中)</em><li><code class="language-plaintext highlighter-rouge">block</code> <em>指定周期的时间回调.</em></ul><p>下面是示例代码</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">addPlayerItemTimeObserver</span> <span class="p">{</span>
    
    <span class="c1">// Create 0.5 second refresh interval - REFRESH_INTERVAL == 0.5</span>
    <span class="n">CMTime</span> <span class="n">interval</span> <span class="o">=</span>
    <span class="n">CMTimeMakeWithSeconds</span><span class="p">(</span><span class="n">REFRESH_INTERVAL</span><span class="p">,</span> <span class="n">NSEC_PER_SEC</span><span class="p">);</span>              <span class="c1">// 1</span>
    
    <span class="c1">// Main dispatch queue</span>
    <span class="n">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_main_queue</span><span class="p">();</span>                     <span class="c1">// 2</span>
    
    <span class="c1">// Create callback block for time observer</span>
    <span class="n">__weak</span> <span class="n">PlayerController</span> <span class="o">*</span><span class="n">weakSelf</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>                             <span class="c1">// 3</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="n">callback</span><span class="p">)(</span><span class="n">CMTime</span> <span class="n">time</span><span class="p">)</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">CMTime</span> <span class="n">time</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSTimeInterval</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">time</span><span class="p">);</span>
        <span class="n">NSTimeInterval</span> <span class="n">duration</span> <span class="o">=</span> <span class="n">CMTimeGetSeconds</span><span class="p">(</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">playerItem</span><span class="p">.</span><span class="n">duration</span><span class="p">);</span>
        <span class="p">[</span><span class="n">weakSelf</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setCurrentTime</span><span class="p">:</span><span class="n">currentTime</span> <span class="nf">duration</span><span class="p">:</span><span class="n">duration</span><span class="p">];</span>  <span class="c1">// 4</span>
    <span class="p">};</span>
    
    <span class="c1">// Add observer and store pointer for future use</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timeObserver</span> <span class="o">=</span>                                                     <span class="c1">// 5</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">addPeriodicTimeObserverForInterval</span><span class="p">:</span><span class="n">interval</span>
                                              <span class="nl">queue:</span><span class="n">queue</span>
                                         <span class="nl">usingBlock:</span><span class="n">callback</span><span class="p">];</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="边界监听">边界监听</h4><p>什么叫边界监听呢?就是播放器播放到某个时间的触发的 时间位置.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">addBoundaryTimeObserverForTimes</span><span class="p">:(</span><span class="n">NSArray</span><span class="o">&lt;</span><span class="n">NSValue</span> <span class="o">*&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">times</span>
                                <span class="nf">queue</span><span class="p">:(</span><span class="n">nullable</span> <span class="n">dispatch_queue_t</span><span class="p">)</span><span class="nv">queue</span>
                           <span class="nf">usingBlock</span><span class="p">:(</span><span class="kt">void</span> <span class="p">(</span><span class="o">^</span><span class="p">)(</span><span class="kt">void</span><span class="p">))</span><span class="nv">block</span><span class="p">;</span>
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">times</code> <em>CMTime值组成一个<code class="language-plaintext highlighter-rouge">NSArray</code>,这里面定义的一个时间点的数组.eg: 25% 50% 75%等时间点.</em><li><code class="language-plaintext highlighter-rouge">queue</code> <em>通知发送的顺序调度队列,一般我们都放在主线程回掉.(注意这里不能放在并行队列中)</em><li><code class="language-plaintext highlighter-rouge">block</code> <em>指定周期的时间回调.</em></ul><h3 id="显示字幕">显示字幕</h3><p><code class="language-plaintext highlighter-rouge">AVPlayerLayer</code>里有两个类来处理字幕</p><ul><li>AVMediaSelectionGroup<li>AVMediaSelectionOption</ul><p><code class="language-plaintext highlighter-rouge">AVMediaSelectionOption</code> 用于表示<code class="language-plaintext highlighter-rouge">AVAsset</code>备用媒体显示.在前几篇中我讲过一个媒体元数据中有<code class="language-plaintext highlighter-rouge">音频轨</code>、<code class="language-plaintext highlighter-rouge">视频轨</code>、<code class="language-plaintext highlighter-rouge">字幕轨</code>,<code class="language-plaintext highlighter-rouge">备用相机角度</code>等.</p><p>我们如果想找出字幕的话需要用到<code class="language-plaintext highlighter-rouge">AVAsset</code>的<code class="language-plaintext highlighter-rouge">availableMediaCharacteristicsWithMediaSelectionOptions</code>属性.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSArray</span><span class="o">&lt;</span><span class="n">AVMediaCharacteristic</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">availableMediaCharacteristicsWithMediaSelectionOptions</span> <span class="nf">NS_AVAILABLE</span><span class="p">(</span><span class="mi">10</span><span class="n">_8</span><span class="p">,</span> <span class="mi">5</span><span class="n">_0</span><span class="p">);</span>
</pre></table></code></div></div><p>这个属性会返回一个数组的<code class="language-plaintext highlighter-rouge">字符串</code>,这些<code class="language-plaintext highlighter-rouge">字符串</code>用于表示保存在资源中可用选项的媒体特征,其实数组中包含的字符串的值为如下：</p><ul><li>AVMediaCharacteristicVisual 视频<li>AVMediaCharacteristicAudible 音频<li>AVMediaCharacteristicLegible 字幕或隐藏式字幕</ul><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>
<span class="k">-</span> <span class="p">(</span><span class="n">nullable</span> <span class="n">AVMediaSelectionGroup</span> <span class="o">*</span><span class="p">)</span><span class="nf">mediaSelectionGroupForMediaCharacteristic</span><span class="p">:(</span><span class="n">AVMediaCharacteristic</span><span class="p">)</span><span class="nv">mediaCharacteristic</span> <span class="n">NS_AVAILABLE</span><span class="p">(</span><span class="mi">10</span><span class="n">_8</span><span class="p">,</span> <span class="mi">5</span><span class="n">_0</span><span class="p">);</span>

</pre></table></code></div></div><p>请求可用媒体特性数据后,调用<code class="language-plaintext highlighter-rouge">AVAsset</code>的<code class="language-plaintext highlighter-rouge">mediaSelectionGroupForMediaCharacteristic:</code>方法.为其传递要检索的选项的特定媒体特征.这个方法返回一个<code class="language-plaintext highlighter-rouge">AVMediaSelectionGroup</code>,它作为一个或多个互斥的<code class="language-plaintext highlighter-rouge">AVMediaSelectionGroup</code>实例的容器.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">loadMediaOptions</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">mc</span> <span class="o">=</span> <span class="n">AVMediaCharacteristicLegible</span><span class="p">;</span>                            <span class="c1">// 1</span>
    <span class="n">AVMediaSelectionGroup</span> <span class="o">*</span><span class="n">group</span> <span class="o">=</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">asset</span> <span class="nf">mediaSelectionGroupForMediaCharacteristic</span><span class="p">:</span><span class="n">mc</span><span class="p">];</span>          <span class="c1">// 2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">group</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">subtitles</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>                 <span class="c1">// 3</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">AVMediaSelectionOption</span> <span class="o">*</span><span class="n">option</span> <span class="k">in</span> <span class="n">group</span><span class="p">.</span><span class="n">options</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">[</span><span class="n">subtitles</span> <span class="nf">addObject</span><span class="p">:</span><span class="n">option</span><span class="p">.</span><span class="n">displayName</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setSubtitles</span><span class="p">:</span><span class="n">subtitles</span><span class="p">];</span>                            <span class="c1">// 4</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">transport</span> <span class="nf">setSubtitles</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="airplay">AirPlay</h2><p>AirPlay相信大部分iOS开发者都耳熟能详,这个东西是用于无线方式将流媒体音频/视频内容在<code class="language-plaintext highlighter-rouge">Apple TV</code>上播放.或者将纯音频内容在多种第三方音频系统中播放(如汽车中内置的CarPlay).如果大家有<code class="language-plaintext highlighter-rouge">Apple TV</code>或其它音频系统中的一个,就会觉得这个功能实在太实用了.其实把这个功能整合到我们的APP中十分容易.</p><p><code class="language-plaintext highlighter-rouge">AVPlayer</code>有一个属性是<code class="language-plaintext highlighter-rouge">allowsExternalPlayback</code>,允许启用或者禁用<code class="language-plaintext highlighter-rouge">AirPlay</code>播放功能.该属性默认是<code class="language-plaintext highlighter-rouge">YES</code>,即在不做任何额外编码的情况下,播放器应用程序也会自动支持<code class="language-plaintext highlighter-rouge">AirPlay</code>功能.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">allowsExternalPlayback</span> <span class="nf">NS_AVAILABLE</span><span class="p">(</span><span class="mi">10</span><span class="n">_11</span><span class="p">,</span> <span class="mi">6</span><span class="n">_0</span><span class="p">);</span>
</pre></table></code></div></div><p>不过从iOS11之后才有专门针对AirPlay的framework功能API,在以前我们使用<code class="language-plaintext highlighter-rouge">Media Player</code>中的<code class="language-plaintext highlighter-rouge">MPVolumeView</code>来实现.</p><p>示例代码:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>	MPVolumeView *volumeView = [[MPVolumeView alloc] init];
    volumeView.showsVolumeSlider = NO;
    [volumeView sizeToFit];
    [transportView addSubview:volumeView];
</pre></table></code></div></div><p>当AirPlay可用时,而且WIFI 网络启用时才会显示线路选择按钮.这两个条件只有一个不满足, MPVolumeView 就会自动隐藏按钮.</p><h2 id="总结">总结</h2><p>本章讲述了 如何使用AVPlayer以及AVPlayerItem 的一些属性 监听播放进度回调,取 字幕等等.</p><p><a href="https://github.com/sunyazhou13/Learning-AV-Foundation-Demos">详细demo请参考</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios%E5%BC%80%E5%8F%91/'>ios开发</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/macos/" class="post-tag no-text-decoration" >macos</a> <a href="/tags/learning-av-foundation/" class="post-tag no-text-decoration" >learning av foundation</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 该博客文章由作者通过 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a> 进行授权。</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning AV Foundation(五)播放视频 - 迈腾大队长&url=https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning AV Foundation(五)播放视频 - 迈腾大队长&u=https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Learning AV Foundation(五)播放视频 - 迈腾大队长&url=https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Learning AV Foundation(五)播放视频 - 迈腾大队长&url=https://www.sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2020/02/SunyazhouTheory/">《孙亚洲理论》的诞生</a><li><a href="/2017/02/HowToUseGitManageCode/">如何使用git管理代码</a><li><a href="/2022/09/howtousensoptions/">NS-OPTIONS的用法</a><li><a href="/2022/07/binarytreeorder/">二叉树的前、中、后序遍历</a><li><a href="/2022/07/mergetwolists/">合并两个有序链表</a></ul></div><div id="access-tags"> <span>热门标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/%E9%9D%A2%E8%AF%95/">面试</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/ios%E5%BC%80%E5%8F%91/">ios开发</a> <a class="post-tag" href="/tags/ios%E9%9D%A2%E8%AF%95%E9%A2%98/">ios面试题</a> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a> <a class="post-tag" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">文章目录</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>接下来阅读</h3><div class="card-deck mb-4"><div class="card"> <a href="/2017/03/LearningAVFoundationAVAudioPlayer/"><div class="card-body"> <span class="timeago small" > 2017-03-17 <i class="unloaded">2017-03-17T18:26:06+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning AV Foundation(二)AVAudioPlayer</h3><div class="text-muted small"><p> 开篇 最近在学习AV Foundation 试图把学习内容记录下来 并参考一些博客文章 本期的内容是AVAudioPlayer 音频知识基础 音频文件的生成过程是将声音信息__采样__、量化__和__编码__产生的数字信号的过程，__人耳所能听到的声音，最低的频率是从20Hz起一直到最高频率20KHZ，因此音频文件格式的最大带宽是20KHZ。根据奈奎斯特的理论，只有采样频率高于...</p></div></div></a></div><div class="card"> <a href="/2017/03/LearningAVFoundationAVAudioRecorder/"><div class="card-body"> <span class="timeago small" > 2017-03-28 <i class="unloaded">2017-03-28T17:40:18+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning AV Foundation(三)AVAudioRecorder</h3><div class="text-muted small"><p> 前言 在AV Foundation中使用AVAudioRecorder类添加音频录制功能和使用AVAudioPlayer一样简单, 都是在Audio Queue Server上层构建的.同时支持macOS和iOS平台.可以从内置麦克风录制音频,也可以支持数字音频接口或USB外接麦克风录制. 主要内容如下: 如何创建AVAudioRecorder 1. 音频格式 2...</p></div></div></a></div><div class="card"> <a href="/2017/06/LearningAVFoundationAVAssetBasic/"><div class="card-body"> <span class="timeago small" > 2017-06-16 <i class="unloaded">2017-06-16T18:11:19+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning AV Foundation(四)AVAsset元数据(基础篇)</h3><div class="text-muted small"><p> 前言 本篇讲述的AVAsset元数据(可以简单理解成 比如一个mp3音频格式的model信息. title:xxxx, art:刘德华, album:专辑 爱你一万年…. 等这些数据的来源). 当然这种意义上的字段信息 属于AVAsset的一个属性。AV Foundation通过AVAsset封装来处理各种音频的元数据, __比如从mp3文件中解析出来封面图(artwork)__等。 本...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2018/02/WordEmbeding/" class="btn btn-outline-primary"><p>NLP分词WordEmbeding</p></a> <a href="/2018/03/ComputerGraphicsRenderingProcess/" class="btn btn-outline-primary"><p>计算机图形渲染的流程</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="sunyazhou13/gitment-comments" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/sunyazhou13">sunyazhou13</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，否则本网站上的博客文章均由作者根据知识共享许可协议 - 署名标示 4.0（CC BY 4.0）进行授权许可。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本博客由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，使用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> 作为主题</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">热门标签</h4><a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/%E9%9D%A2%E8%AF%95/">面试</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/ios%E5%BC%80%E5%8F%91/">ios开发</a> <a class="post-tag" href="/tags/ios%E9%9D%A2%E8%AF%95%E9%A2%98/">ios面试题</a> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a> <a class="post-tag" href="/tags/%E7%94%9F%E6%B4%BB/">生活</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sunyazhou.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
