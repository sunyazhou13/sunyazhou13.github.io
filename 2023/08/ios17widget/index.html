<!DOCTYPE html><html lang="zh-Hans" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="开发iOS17小组件" /><meta name="author" content="孙亚洲" /><meta property="og:locale" content="zh_Hans" /><meta name="description" content="前言" /><meta property="og:description" content="前言" /><link rel="canonical" href="https://www.sunyazhou.com/2023/08/ios17widget/" /><meta property="og:url" content="https://www.sunyazhou.com/2023/08/ios17widget/" /><meta property="og:site_name" content="迈腾大队长" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2023-08-04T06:56:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="开发iOS17小组件" /><meta name="twitter:site" content="@sunyazhou" /><meta name="twitter:creator" content="@孙亚洲" /><meta name="google-site-verification" content="Xo29j227HYVdC-vDA_-qJwvDP3PIo-lC78CFeBvhrDA" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"https://www.sunyazhou.com/2023/08/ios17widget/","author":{"@type":"Person","name":"孙亚洲"},"headline":"开发iOS17小组件","dateModified":"2023-08-04T06:56:00+00:00","datePublished":"2023-08-04T06:56:00+00:00","description":"前言","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sunyazhou.com/2023/08/ios17widget/"},"@context":"https://schema.org"}</script><title>开发iOS17小组件 | 迈腾大队长</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/images/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">迈腾大队长</a></div><div class="site-subtitle font-italic">不斷學習,與時俱進.求真務實,實事求是.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3"></i> <span>主页</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3"></i> <span>归档</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3"></i> <span>分类</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3"></i> <span>标签</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/projects/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-paint-brush ml-xl-3 mr-xl-3"></i> <span>作品</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3"></i> <span>关于</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/sunyazhou13" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sunyazhou" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.weibo.com/sunyazhou13" aria-label="" target="_blank" rel="noopener"> <i class="fab fa-weibo"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sunyazhou','111.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 主页 </a> </span> <span>开发iOS17小组件</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>开发iOS17小组件</h1><div class="post-meta text-muted d-flex flex-column"><div> 　由 <span class="author"> 孙亚洲 </span> 发布于 <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 4, 2023, 6:56 AM +0000" > 2023-08-04 <i class="unloaded">2023-08-04T06:56:00+00:00</i> </span></div><div> 最后更新: <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, May 15, 2024, 10:31 AM +0800" > 2024-05-15 <i class="unloaded">2024-05-15T02:31:49+00:00</i> </span></div></div><div class="post-content"><h1 id="前言">前言</h1><p>本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在许可协议范围内转载或分享,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用RSS方式订阅本站,感谢支持!</p><h1 id="ios17关于小组件的wwdc">iOS17关于小组件的WWDC</h1><p><a href="https://developer.apple.com/wwdc23/">WWDC23</a>中提供了一些关于小组件的视频,最近开发小组件遇到了一些问题,在这里解读一下视频中的内容</p><h2 id="bring-widgets-to-new-places">Bring widgets to new places</h2><p><a href="https://developer.apple.com/videos/play/wwdc2023/10027/?time=180">Bring widgets to new places</a></p><p>The widget ecosystem is expanding: Discover how you can use the latest WidgetKit APIs to make your widget look great everywhere. We’ll show you how to identify your widget’s background, adjust layout dynamically, and prepare colors for vibrant rendering so that your widget can sit seamlessly in any environment.</p><p>小部件生态系统正在扩展:了解如何使用最新的WidgetKit api使您的小部件在任何地方看起来都很棒。我们将向您展示如何识别小部件的背景，动态调整布局，并为充满活力的渲染准备颜色，以便您的小部件可以在任何环境中无缝地运行。</p><h3 id="transition-to-content-margins">Transition to content margins</h3><p><a href="https://developer.apple.com/videos/play/wwdc2023/10027/?time=104"> Transition to content margins</a></p><p>从 ios14 引入桌面小组件，后又在 ios16 增加锁屏小组件，现在，它可以扩展到：mac 桌面、pad 锁屏、iphone StandBy 以及 iwatch 的 new Smart Stack。所以确保一次编码后在各个位置都能表现出色是件很重要的事。我的理解就是iOS, iPadOS, WatchOS, macOS 全苹果平台通用适配.也就是说编码一次小组件可以运行到所有苹果的系统上.</p><p>以 watchOS 的 safe area 为例:</p><ul><li>watchOS9 and below: 使用了system-defined 的 safe area 以避免小组件太贴边。但开发者可以通过<code class="language-plaintext highlighter-rouge">Color.blue.ignoresSafeArea()</code> 来忽略它<li>watchOS10 and above: 方法<code class="language-plaintext highlighter-rouge">ignoresSafeArea()</code>不在起作用，而应该对 <code class="language-plaintext highlighter-rouge">widget configuration</code> 应用 <code class="language-plaintext highlighter-rouge">contentMarginsDisabled</code>修改器来实现这一目的</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20230804iOS17Widget/widget1.gif" alt="" /></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20230804iOS17Widget/widget2.webp" alt="" /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20230804iOS17Widget/widget3.webp" alt="" /></p><h3 id="add-a-removable-background">Add a removable background</h3><p>现有的 accessory family 小组件可以自动适配到 ipad 的锁屏上。ipad can also show system small widgets right alongside them。 但会有一个半透明的背景，如果想去掉它，可以使用：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kt">ZStack</span> <span class="p">{</span>
    <span class="c1">// TODO</span>
<span class="p">}</span><span class="o">.</span><span class="nf">containerBackground</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">widget</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">Color</span><span class="o">.</span><span class="n">gameBackground</span>
<span class="p">}</span>
</pre></table></code></div></div><p>这样系统就可以根据显示的位置来自动决定是否要显示背景。对于，watchOS 上的组件也一样，系统会默认给予一个半透明背景，也可以通过这种方式交给系统来进行处理背景，以展示丰富多彩的样式。</p><p>如果确实不想系统对某些组件(如：ios上的桌面照片组件)使用可移除的背景，可以在小组件的 widget configuration 上应用 <code class="language-plaintext highlighter-rouge">containerBackgroundRemovable(false)</code> 修改器。</p><h3 id="dynamically-adjust-layout">Dynamically adjust layout</h3><p>当使用 StandBy mode 时，小组件会被放大，并且会移除背景。可以通过使用以下代码来检查背景是否被移除来进行适配：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">showsWidgetContainerBackground</span><span class="p">)</span> <span class="k">var</span> <span class="nv">showsWidgetBackground</span>
</pre></table></code></div></div><h3 id="prepare-for-vibrant-rendering">Prepare for vibrant rendering</h3><p>在 ipad lock screen 上的小组件，系统可能会根据需要调整饱和度(desaturate)，也就是说小组件可能需要根据实际情况进行不同的色彩、背景等样式微调，此时可以通过以下代码来检查渲染是否为 .vibrant 来进行适配：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kd">@Environment</span><span class="p">(\</span><span class="o">.</span><span class="n">widgetRenderingMode</span><span class="p">)</span> <span class="k">var</span> <span class="nv">widgetRender</span> 
</pre></table></code></div></div><h2 id="adding-interactivity-to-widgets-and-live-activities">Adding interactivity to widgets and Live Activities</h2><p><a href="https://developer.apple.com/documentation/WidgetKit/Adding-interactivity-to-widgets-and-Live-Activities">Adding interactivity to widgets and Live Activities </a></p><h3 id="appintent">AppIntent</h3><p>这可能是此次WWDC中小组件开发最感兴趣的内容之一了，它简化了交互式小组件的现有实现方式，同时也对现有的交互效果有了明显的改善。</p><p>从 iOS 17, iPadOS 17, 以及 macOS 14 开始，widgets 和 Live Activities 可以使用 buttons 和 toggles 在不启动主 app 的情况下提供一些特殊功能。</p><blockquote><p>注意：仅仅 Button 和 Toggle 组件支持，需要引入import AppIntents模块</p></blockquote><p>以下类型的小组件在新版本 sdk 中包含此特性的 Button 和 Toggle：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">systemSmall</span>
<span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">systemMedium</span>
<span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">systemLarge</span>
<span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">systemExtraLarge</span>
<span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">accessoryCircular</span> <span class="n">on</span> <span class="n">iPhone</span> <span class="n">and</span> <span class="n">iPad</span>
<span class="kt">WidgetFamily</span><span class="o">.</span><span class="n">accessoryRectangular</span> <span class="n">on</span> <span class="n">iPhone</span> <span class="n">and</span> <span class="n">iPad</span>
</pre></table></code></div></div><p>在具体开发过程中需要实现自己的 AppIntent 对象：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">MyIntent</span> <span class="p">:</span> <span class="kt">AppIntent</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">LocalizedStringResource</span> <span class="o">=</span> <span class="s">"title"</span>

    <span class="kd">func</span> <span class="nf">perform</span><span class="p">()</span> <span class="k">async</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kd">some</span> <span class="kt">IntentResult</span> <span class="p">{</span>
        <span class="k">await</span> <span class="kt">MyActionWhichMaybeAsync</span><span class="p">()</span>
        <span class="k">return</span> <span class="o">.</span><span class="nf">result</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>这里需要说明的是：</p><ul><li>当 perform() 返回后，系统会立即触发 timeline 更新<li>所以 perform 中如果是异步操作时，需要 await 异步操作结束<li>需要在 perform 中更新小组件数据并持久化</ul><p>AppIntent 工作的本质就是由系统触发 timeline 来实现小组件视图(不可变对象)更新。具体的使用方式可以参考<a href="https://developer.apple.com/documentation/WidgetKit/Adding-interactivity-to-widgets-and-Live-Activities">官方代码示例</a>。</p><h3 id="preview">Preview</h3><p>这里有个有趣的地方就是更新了 preview 的方式：相比原来的：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">struct</span> <span class="kt">MyWidgetView_Previews</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
   <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
       <span class="kt">MyWidgetView</span><span class="p">()</span><span class="o">.</span><span class="nf">previewContext</span><span class="p">(</span><span class="kt">WidgetPreviewContext</span><span class="p">(</span><span class="nv">family</span><span class="p">:</span> <span class="o">.</span><span class="n">systemLarge</span><span class="p">))</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>增加了 timeline 的支持，可以方便的观察动画效果等：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="cp">#Preview(as: WidgetFamily.systemLarge) {</span>
    <span class="c1">// TODO：view</span>
<span class="p">}</span> <span class="nv">timeline</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// TODO：timeline list</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="animating-data-updates-in-widgets-and-live-activities">Animating data updates in widgets and Live Activities</h3><p><a href="https://developer.apple.com/documentation/WidgetKit/Animating-data-updates-in-widgets-and-live-activities">Animating data updates in widgets and Live Activities</a></p><p>把 Live Activity 中的效果扩展到了 Widget 上，Live Activity 中的 timer 类型 Text 自带翻页特效，如果不想使用的话可以使用以下方式去掉：</p><div class="language-swift highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">Text</span><span class="p">(</span><span class="kt">Date</span><span class="o">.</span><span class="n">now</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">timer</span><span class="p">)</span><span class="o">.</span><span class="nf">contentTransition</span><span class="p">(</span><span class="o">.</span><span class="n">identity</span><span class="p">)</span>
</pre></table></code></div></div><h1 id="总结">总结</h1><p>iOS小组件有一些细微改动的,经过WWDC分析 我们还是需要认真学习的.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a>, <a href='/categories/swiftui/'>SwiftUI</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >iOS</a> <a href="/tags/macos/" class="post-tag no-text-decoration" >macOS</a> <a href="/tags/ipados/" class="post-tag no-text-decoration" >iPadOS</a> <a href="/tags/watchos/" class="post-tag no-text-decoration" >watchOS</a> <a href="/tags/swiftui/" class="post-tag no-text-decoration" >SwiftUI</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 该博客文章由作者通过 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a> 进行授权。</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=开发iOS17小组件 - 迈腾大队长&url=https://www.sunyazhou.com/2023/08/ios17widget/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=开发iOS17小组件 - 迈腾大队长&u=https://www.sunyazhou.com/2023/08/ios17widget/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=开发iOS17小组件 - 迈腾大队长&url=https://www.sunyazhou.com/2023/08/ios17widget/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="http://service.weibo.com/share/share.php?title=开发iOS17小组件 - 迈腾大队长&url=https://www.sunyazhou.com/2023/08/ios17widget/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2017/02/HowToUseGitManageCode/">如何使用git管理代码</a><li><a href="/2017/01/UIViewControllerCodeStandard/">UIViewController代码规范</a><li><a href="/2024/11/coretextcalculatedheight/">CoreText渲染字体的时如何计算字体所需要的高度?</a><li><a href="/2024/10/uiimagemirror/">UIImage镜像</a><li><a href="/2024/09/cfnotificationprocesscommunication/">CFNotification进程间通讯</a></ul></div><div id="access-tags"> <span>热门标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/objective-c/">Objective C</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/skills/">skills</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/swiftui/">SwiftUI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a> <a class="post-tag" href="/tags/avfoundation/">AVFoundation</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">文章目录</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>接下来阅读</h3><div class="card-deck mb-4"><div class="card"> <a href="/2023/08/swiftuiextention1/"><div class="card-body"> <span class="timeago small" > 2023-08-02 <i class="unloaded">2023-08-02T09:13:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SwiftUI可用性检测,解决小组件iOS17 available问题</h3><div class="text-muted small"><p> 前言 本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在许可协议范围内转载或分享,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用RSS方式订阅本站,感谢支持! 问题 最近在开发iOS17上的小组件使用SwiftUI框架,第一次进行工程化遇到一个 api可用性检测问题 之前的小组件是锁屏小组件,在iO...</p></div></div></a></div><div class="card"> <a href="/2023/09/ios17widgetURL/"><div class="card-body"> <span class="timeago small" > 2023-09-12 <i class="unloaded">2023-09-12T01:54:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>解决iOS小组件开发中widgetURL问题</h3><div class="text-muted small"><p> 前言 本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在许可协议范围内转载或分享,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用RSS方式订阅本站,感谢支持! 背景描述 最近再开发iOS17的小组件遇到一个非常奇怪且很脑残的问题 在小组件开发过程中有如下代码使用深度链接(deeping URL )调...</p></div></div></a></div><div class="card"> <a href="/2023/10/sqlstandard/"><div class="card-body"> <span class="timeago small" > 2023-10-31 <i class="unloaded">2023-10-31T02:01:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SQL语句的标准</h3><div class="text-muted small"><p> 前言 本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在许可协议范围内转载或分享,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用RSS方式订阅本站,感谢支持! 背景介绍 最近工作太忙,没有保证博客的产出,今天偶有时间来探讨一下最近看到的一篇文章 orona技术专题-时序数据分析 来自于网易云音乐技术团队...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2023/08/swiftuiextention1/" class="btn btn-outline-primary"><p>SwiftUI可用性检测,解决小组件iOS17 available问题</p></a> <a href="/2023/08/learnswiftuichapter3/" class="btn btn-outline-primary"><p>SwiftUI第三章学习总结</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="sunyazhou13/gitment-comments" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/sunyazhou13">sunyazhou</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，否则本网站上的博客文章均由作者根据知识共享许可协议 - 署名标示 4.0（CC BY 4.0）进行授权许可。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本博客由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，使用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> 作为主题</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">热门标签</h4><a class="post-tag" href="/tags/objective-c/">Objective C</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/skills/">skills</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/swiftui/">SwiftUI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a> <a class="post-tag" href="/tags/avfoundation/">AVFoundation</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sunyazhou.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
