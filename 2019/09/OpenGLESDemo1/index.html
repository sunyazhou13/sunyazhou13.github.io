<!DOCTYPE html><html lang="zh-Hans" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="从零学习OpenGLES的纹理渲染" /><meta name="author" content="孙亚洲" /><meta property="og:locale" content="zh_Hans" /><meta name="description" content="嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者." /><meta property="og:description" content="嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者." /><link rel="canonical" href="https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" /><meta property="og:url" content="https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" /><meta property="og:site_name" content="迈腾大队长" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-09-06T18:19:48+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="从零学习OpenGLES的纹理渲染" /><meta name="twitter:site" content="@sunyazhou" /><meta name="twitter:creator" content="@孙亚洲" /><meta name="google-site-verification" content="Xo29j227HYVdC-vDA_-qJwvDP3PIo-lC78CFeBvhrDA" /> <script type="application/ld+json"> {"@type":"BlogPosting","headline":"从零学习OpenGLES的纹理渲染","dateModified":"2019-09-06T18:19:48+08:00","datePublished":"2019-09-06T18:19:48+08:00","author":{"@type":"Person","name":"孙亚洲"},"url":"https://www.sunyazhou.com/2019/09/OpenGLESDemo1/","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sunyazhou.com/2019/09/OpenGLESDemo1/"},"description":"嗨,我是孙亚洲(@sunyazhou13),一名来自祖国北国冰城的iOS开发者.","@context":"https://schema.org"}</script><title>从零学习OpenGLES的纹理渲染 | 迈腾大队长</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/images/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">迈腾大队长</a></div><div class="site-subtitle font-italic">不断学习, 与时俱进.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>主页</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/projects/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-paint-brush ml-xl-3 mr-xl-3 unloaded"></i> <span>作品</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/sunyazhou13" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sunyazhou" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.weibo.com/sunyazhou13" aria-label="" target="_blank" rel="noopener"> <i class="fab fa-weibo"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sunyazhou','111.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 主页 </a> </span> <span>从零学习OpenGLES的纹理渲染</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>从零学习OpenGLES的纹理渲染</h1><div class="post-meta text-muted d-flex flex-column"><div> 　由 <span class="author"> 孙亚洲 </span> 发布于 <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Sep 6, 2019, 6:19 PM +0800" > 2019-09-06 <i class="unloaded">2019-09-06T18:19:48+08:00</i> </span></div><div> 最后更新: <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Feb 5, 2023, 4:47 PM +0800" > 02-05 <i class="unloaded">2023-02-05T16:47:37+08:00</i> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20190906OpenGLESDemo1/sunyazhou_logo_glsl.webp" alt="" /></p><h1 id="前言">前言</h1><p>很久没用OpenGL了 记录一下学习GLSL代码和实现</p><h2 id="objctive-c代码">Objctive-C代码</h2><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
</pre><td class="rouge-code"><pre><span class="cp">#import "ViewController.h"
#import &lt;GLKit/GLKit.h&gt;
</span>
<span class="c1">//顶点结构体类型</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">GLKVector3</span> <span class="n">positionCoord</span><span class="p">;</span> <span class="c1">// (x,y,z)</span>
    <span class="n">GLKMatrix2</span> <span class="n">textureCoord</span><span class="p">;</span> <span class="c1">// (u, v)</span>
    
<span class="p">}</span> <span class="n">SenceVertex</span><span class="p">;</span>


<span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">assign</span><span class="p">)</span> <span class="n">SenceVertex</span> <span class="o">*</span><span class="n">vertices</span><span class="p">;</span> <span class="c1">//顶点数组</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">EAGLContext</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ViewController</span>

<span class="cp">#pragma mark -
#pragma mark - override methods 复写方法
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">whiteColor</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">commonInit</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark -
#pragma mark - private methods 私有方法
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">commonInit</span> <span class="p">{</span>
    <span class="c1">// 创建上下文 使用 2.0版本</span>
    <span class="n">self</span><span class="p">.</span><span class="n">context</span> <span class="o">=</span> <span class="p">[[</span><span class="n">EAGLContext</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithAPI</span><span class="p">:</span><span class="n">kEAGLRenderingAPIOpenGLES2</span><span class="p">];</span>
    <span class="p">[</span><span class="n">EAGLContext</span> <span class="nf">setCurrentContext</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">context</span><span class="p">];</span>
    
    <span class="c1">//创建顶点数组</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vertices</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span> <span class="c1">//4个顶点</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">SenceVertex</span><span class="p">){{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">}};</span> <span class="c1">//左上角</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">SenceVertex</span><span class="p">){{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},{</span><span class="mi">0</span> <span class="p">,</span><span class="mi">0</span><span class="p">}};</span> <span class="c1">//左下角</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">SenceVertex</span><span class="p">){{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">}};</span> <span class="c1">//右上角</span>
    <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">SenceVertex</span><span class="p">){{</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">}};</span> <span class="c1">//右下角</span>
    
    <span class="c1">//创建一个展示纹理的layer</span>
    
    <span class="n">CAEAGLLayer</span> <span class="o">*</span><span class="n">layer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CAEAGLLayer</span> <span class="nf">layer</span><span class="p">];</span>
    <span class="n">layer</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">);</span>
    <span class="n">layer</span><span class="p">.</span><span class="n">contentsScale</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIScreen</span> <span class="nf">mainScreen</span><span class="p">]</span> <span class="nf">scale</span><span class="p">];</span> <span class="c1">//设置缩放比例，不设置的话，纹理会失真</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">layer</span> <span class="nf">addSublayer</span><span class="p">:</span><span class="n">layer</span><span class="p">];</span>
    
    <span class="c1">// 绑定纹理到输出layer</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">bindRenderLayer</span><span class="p">:</span><span class="n">layer</span><span class="p">];</span>
    
    <span class="c1">// 读取纹理</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">imagePath</span> <span class="o">=</span> <span class="p">[[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">resourcePath</span><span class="p">]</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"logo.webp"</span><span class="p">];</span>
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIImage</span> <span class="nf">imageWithContentsOfFile</span><span class="p">:</span><span class="n">imagePath</span><span class="p">];</span>
    <span class="n">GLuint</span> <span class="n">textureID</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">createTextureWithImage</span><span class="p">:</span><span class="n">image</span><span class="p">];</span>
    
    
    <span class="c1">// 设置视口尺寸</span>
    
    <span class="n">glViewport</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">drawableWidth</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">drawableHeight</span><span class="p">);</span>
    
    <span class="c1">// 编译链接 着色器</span>
    <span class="n">GLuint</span> <span class="n">program</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">programWithShaderName</span><span class="p">:</span><span class="s">@"glsl"</span><span class="p">];</span>
    <span class="n">glUseProgram</span><span class="p">(</span><span class="n">program</span><span class="p">);</span>
    
    <span class="c1">// 获取shader 中的参数 然后传数据进去</span>
    <span class="n">GLuint</span> <span class="n">positionSlot</span> <span class="o">=</span> <span class="n">glGetAttribLocation</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="s">"Position"</span><span class="p">);</span> <span class="c1">//获取顶点着色器的位置</span>
    <span class="n">GLuint</span> <span class="n">textureCoordsSlot</span> <span class="o">=</span> <span class="n">glGetAttribLocation</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="s">"TextureCoords"</span><span class="p">);</span> <span class="c1">//获取顶点着色器中的纹理坐标</span>

    <span class="n">GLuint</span> <span class="n">textureSlot</span> <span class="o">=</span> <span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="s">"Texture"</span><span class="p">);</span> <span class="c1">//获取片元着色器纹理变量</span>

    <span class="c1">//将纹理 ID 传给着色器程序</span>
    <span class="n">glActiveTexture</span><span class="p">(</span><span class="n">GL_TEXTURE0</span><span class="p">);</span>
    <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">textureID</span><span class="p">);</span>
    <span class="n">glUniform1i</span><span class="p">(</span><span class="n">textureSlot</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 将textureSlot 赋值为 0, 而 0 与 GL_TEXTURE0 对应,这里如果写1,就是GL_TEXTURE1</span>
    
    <span class="c1">// 创建顶点缓存</span>
    <span class="n">GLuint</span> <span class="n">vertexBuffer</span><span class="p">;</span>
    <span class="n">glGenBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vertexBuffer</span><span class="p">);</span>
    <span class="n">glBindBuffer</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">vertexBuffer</span><span class="p">);</span>
    <span class="n">GLsizeiptr</span> <span class="n">bufferSizeBytes</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">glBufferData</span><span class="p">(</span><span class="n">GL_ARRAY_BUFFER</span><span class="p">,</span> <span class="n">bufferSizeBytes</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">vertices</span><span class="p">,</span> <span class="n">GL_STATIC_DRAW</span><span class="p">);</span>
    
    <span class="c1">// 设置顶点数据</span>
    <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="n">positionSlot</span><span class="p">);</span>
    <span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="n">positionSlot</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">),</span> <span class="nb">NULL</span> <span class="o">+</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">,</span> <span class="n">positionCoord</span><span class="p">));</span>
    
    <span class="c1">// 设置纹理数据</span>
    <span class="n">glEnableVertexAttribArray</span><span class="p">(</span><span class="n">textureCoordsSlot</span><span class="p">);</span>
    <span class="n">glVertexAttribPointer</span><span class="p">(</span><span class="n">textureCoordsSlot</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GL_FLOAT</span><span class="p">,</span> <span class="n">GL_FALSE</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">),</span> <span class="nb">NULL</span> <span class="o">+</span> <span class="n">offsetof</span><span class="p">(</span><span class="n">SenceVertex</span><span class="p">,</span> <span class="n">textureCoord</span><span class="p">));</span>
    
    <span class="c1">// 开始绘制</span>
    <span class="n">glDrawArrays</span><span class="p">(</span><span class="n">GL_TRIANGLE_STRIP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    
    <span class="c1">// 将绑定</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">context</span> <span class="nf">presentRenderbuffer</span><span class="p">:</span><span class="n">GL_RENDERBUFFER</span><span class="p">];</span>
    
    <span class="c1">//删除顶点缓存</span>
    <span class="n">glDeleteBuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vertexBuffer</span><span class="p">);</span>
    <span class="n">vertexBuffer</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
<span class="p">}</span>

<span class="c1">//绑定图像要输出的 layer</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">bindRenderLayer</span><span class="p">:(</span><span class="n">CALayer</span> <span class="o">&lt;</span><span class="n">EAGLDrawable</span><span class="o">&gt;</span> <span class="o">*</span><span class="p">)</span><span class="nv">layer</span> <span class="p">{</span>
    <span class="n">GLuint</span> <span class="n">frameBuffer</span><span class="p">;</span> <span class="c1">//帧缓冲</span>
    <span class="n">GLuint</span> <span class="n">renderBuffer</span><span class="p">;</span> <span class="c1">//渲染缓冲</span>

    <span class="c1">//绑定渲染缓冲到 输出的layer</span>
    <span class="n">glGenRenderbuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">renderBuffer</span><span class="p">);</span>
    <span class="n">glBindRenderbuffer</span><span class="p">(</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">renderBuffer</span><span class="p">);</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">context</span> <span class="nf">renderbufferStorage</span><span class="p">:</span><span class="n">GL_RENDERBUFFER</span> <span class="nf">fromDrawable</span><span class="p">:</span><span class="n">layer</span><span class="p">];</span>
    
    <span class="c1">//将渲染缓冲附着在帧缓冲上</span>
    <span class="n">glGenFramebuffers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">frameBuffer</span><span class="p">);</span>
    <span class="n">glBindFramebuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">frameBuffer</span><span class="p">);</span>
    <span class="n">glFramebufferRenderbuffer</span><span class="p">(</span><span class="n">GL_FRAMEBUFFER</span><span class="p">,</span> <span class="n">GL_COLOR_ATTACHMENT0</span><span class="p">,</span> <span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">renderBuffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 通过一个图片 创建纹理</span>
<span class="k">-</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="nf">createTextureWithImage</span><span class="p">:(</span><span class="n">UIImage</span> <span class="o">*</span><span class="p">)</span><span class="nv">image</span> <span class="p">{</span>
    <span class="c1">// 将 UIImage 转换为 CGImageRef</span>
    <span class="n">CGImageRef</span> <span class="n">cgImageRef</span> <span class="o">=</span> <span class="p">[</span><span class="n">image</span> <span class="nf">CGImage</span><span class="p">];</span>
    <span class="n">GLuint</span> <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="n">CGImageGetWidth</span><span class="p">(</span><span class="n">cgImageRef</span><span class="p">);</span>
    <span class="n">GLuint</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="n">CGImageGetHeight</span><span class="p">(</span><span class="n">cgImageRef</span><span class="p">);</span>
    <span class="n">CGRect</span> <span class="n">rect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    
    <span class="c1">// 绘制图片</span>
    <span class="n">CGColorSpaceRef</span> <span class="n">colorSpace</span> <span class="o">=</span> <span class="n">CGColorSpaceCreateDeviceRGB</span><span class="p">();</span>
    <span class="kt">void</span> <span class="o">*</span><span class="n">imageData</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">height</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
    <span class="n">CGContextRef</span> <span class="n">context</span> <span class="o">=</span> <span class="n">CGBitmapContextCreate</span><span class="p">(</span><span class="n">imageData</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">width</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">colorSpace</span><span class="p">,</span> <span class="n">kCGImageAlphaPremultipliedLast</span> <span class="o">|</span> <span class="n">kCGBitmapByteOrder32Big</span><span class="p">);</span>
    <span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="n">CGContextScaleCTM</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">);</span>
    <span class="n">CGColorSpaceRelease</span><span class="p">(</span><span class="n">colorSpace</span><span class="p">);</span>
    <span class="n">CGContextClearRect</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">rect</span><span class="p">);</span>
    <span class="n">CGContextDrawImage</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">rect</span><span class="p">,</span> <span class="n">cgImageRef</span><span class="p">);</span>

    <span class="c1">// 生成纹理</span>
    <span class="n">GLuint</span> <span class="n">textureID</span><span class="p">;</span>
    <span class="n">glGenTextures</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">textureID</span><span class="p">);</span>
    <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">textureID</span><span class="p">);</span>
    <span class="n">glTexImage2D</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">GL_RGBA</span><span class="p">,</span> <span class="n">GL_UNSIGNED_BYTE</span><span class="p">,</span> <span class="n">imageData</span><span class="p">);</span> <span class="c1">// 将图片数据写入纹理缓存</span>
    
    <span class="c1">// 设置如何把纹素映射成像素</span>
    <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_S</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">);</span>
    <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_WRAP_T</span><span class="p">,</span> <span class="n">GL_CLAMP_TO_EDGE</span><span class="p">);</span>
    <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
    <span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="n">GL_TEXTURE_MAG_FILTER</span><span class="p">,</span> <span class="n">GL_LINEAR</span><span class="p">);</span>
    
    <span class="c1">// 解绑</span>
    <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    
    <span class="c1">// 释放内存</span>
    <span class="n">CGContextRelease</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">imageData</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">textureID</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 将一个顶点着色器和片元着色器挂在到一个着色器程序上, 并返回程序的 id</span>
<span class="k">-</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="nf">programWithShaderName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">shaderName</span> <span class="p">{</span>
    <span class="c1">// 编译两个着色器</span>
    <span class="n">GLuint</span> <span class="n">vertexShader</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">compileShaderWithName</span><span class="p">:</span><span class="n">shaderName</span> <span class="nf">type</span><span class="p">:</span><span class="n">GL_VERTEX_SHADER</span><span class="p">];</span>
    <span class="n">GLuint</span> <span class="n">fragmentShader</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">compileShaderWithName</span><span class="p">:</span><span class="n">shaderName</span> <span class="nf">type</span><span class="p">:</span><span class="n">GL_FRAGMENT_SHADER</span><span class="p">];</span>
    
    <span class="c1">// 挂载 shader 到 program 上</span>
    <span class="n">GLuint</span> <span class="n">program</span> <span class="o">=</span> <span class="n">glCreateProgram</span><span class="p">();</span>
    <span class="n">glAttachShader</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">vertexShader</span><span class="p">);</span>
    <span class="n">glAttachShader</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">fragmentShader</span><span class="p">);</span>
    
    <span class="c1">// 链接 program</span>
    <span class="n">glLinkProgram</span><span class="p">(</span><span class="n">program</span><span class="p">);</span>
    
    <span class="c1">// 检查链接是否成功</span>
    <span class="n">GLint</span> <span class="n">linkSuccess</span><span class="p">;</span>
    <span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="n">GL_LINK_STATUS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">linkSuccess</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">linkSuccess</span> <span class="o">==</span> <span class="n">GL_FALSE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">GLchar</span> <span class="n">messages</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
        <span class="n">glGetProgramInfoLog</span><span class="p">(</span><span class="n">program</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">messages</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">messageString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithUTF8String</span><span class="p">:</span><span class="n">messages</span><span class="p">];</span>
        <span class="n">NSAssert</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="s">@"program链接失败：%@"</span><span class="p">,</span> <span class="n">messageString</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">program</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 编译一个 shader，并返回 shader 的 id</span>
<span class="k">-</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="nf">compileShaderWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span> <span class="nf">type</span><span class="p">:(</span><span class="n">GLenum</span><span class="p">)</span><span class="nv">shaderType</span> <span class="p">{</span>
    <span class="c1">// 查找 shader 文件</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">shaderPath</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]</span> <span class="nf">pathForResource</span><span class="p">:</span><span class="n">name</span> <span class="nf">ofType</span><span class="p">:</span><span class="n">shaderType</span> <span class="o">==</span> <span class="n">GL_VERTEX_SHADER</span> <span class="p">?</span> <span class="s">@"vsh"</span> <span class="p">:</span> <span class="s">@"fsh"</span><span class="p">];</span> <span class="c1">// 根据不同的类型确定后缀名</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">shaderString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithContentsOfFile</span><span class="p">:</span><span class="n">shaderPath</span> <span class="nf">encoding</span><span class="p">:</span><span class="n">NSUTF8StringEncoding</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">shaderString</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSAssert</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="s">@"读取shader失败"</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="c1">// 创建一个 shader 对象</span>
    <span class="n">GLuint</span> <span class="n">shader</span> <span class="o">=</span> <span class="n">glCreateShader</span><span class="p">(</span><span class="n">shaderType</span><span class="p">);</span>
    
    <span class="c1">// 获取 shader 的内容</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">shaderStringUTF8</span> <span class="o">=</span> <span class="p">[</span><span class="n">shaderString</span> <span class="nf">UTF8String</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">shaderStringLength</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)[</span><span class="n">shaderString</span> <span class="nf">length</span><span class="p">];</span>
    <span class="n">glShaderSource</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">shaderStringUTF8</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">shaderStringLength</span><span class="p">);</span>
    
    <span class="c1">// 编译shader</span>
    <span class="n">glCompileShader</span><span class="p">(</span><span class="n">shader</span><span class="p">);</span>
    
    <span class="c1">// 查询 shader 是否编译成功</span>
    <span class="n">GLint</span> <span class="n">compileSuccess</span><span class="p">;</span>
    <span class="n">glGetShaderiv</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="n">GL_COMPILE_STATUS</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">compileSuccess</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">compileSuccess</span> <span class="o">==</span> <span class="n">GL_FALSE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">GLchar</span> <span class="n">messages</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
        <span class="n">glGetShaderInfoLog</span><span class="p">(</span><span class="n">shader</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">messages</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">messageString</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithUTF8String</span><span class="p">:</span><span class="n">messages</span><span class="p">];</span>
        <span class="n">NSAssert</span><span class="p">(</span><span class="nb">NO</span><span class="p">,</span> <span class="s">@"shader编译失败：%@"</span><span class="p">,</span> <span class="n">messageString</span><span class="p">);</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="n">shader</span><span class="p">;</span>
<span class="p">}</span>


<span class="cp">#pragma mark -
#pragma mark - public methods 公有方法
</span>


<span class="cp">#pragma mark -
#pragma mark - getters and setters 设置器和访问器
</span><span class="c1">// 获取渲染缓存宽度</span>
<span class="k">-</span> <span class="p">(</span><span class="n">GLint</span><span class="p">)</span><span class="n">drawableWidth</span> <span class="p">{</span>
    <span class="n">GLint</span> <span class="n">backingWidth</span><span class="p">;</span>
    <span class="n">glGetRenderbufferParameteriv</span><span class="p">(</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">GL_RENDERBUFFER_WIDTH</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">backingWidth</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">backingWidth</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// 获取渲染缓存高度</span>
<span class="k">-</span> <span class="p">(</span><span class="n">GLint</span><span class="p">)</span><span class="n">drawableHeight</span> <span class="p">{</span>
    <span class="n">GLint</span> <span class="n">backingHeight</span><span class="p">;</span>
    <span class="n">glGetRenderbufferParameteriv</span><span class="p">(</span><span class="n">GL_RENDERBUFFER</span><span class="p">,</span> <span class="n">GL_RENDERBUFFER_HEIGHT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">backingHeight</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">backingHeight</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#pragma mark -
#pragma mark - life cycle 视图的生命周期
</span><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">dealloc</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">EAGLContext</span> <span class="nf">currentContext</span><span class="p">]</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">context</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">EAGLContext</span> <span class="nf">setCurrentContext</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="c1">//释放结构体内存的数组 需要手动free</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_vertices</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">free</span><span class="p">(</span><span class="n">_vertices</span><span class="p">);</span>
        <span class="n">_vertices</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>
</pre></table></code></div></div><h3 id="顶点着色器">顶点着色器</h3><pre><code class="language-shade">attribute vec4 Position;
attribute vec2 TextureCoords;
varying vec2 TextureCoordsVarying;

void main (void) {
    gl_Position = Position;
    TextureCoordsVarying = TextureCoords;
}

</code></pre><h3 id="片元着色器">片元着色器</h3><pre><code class="language-shade">precision mediump float;

uniform sampler2D Texture;
varying vec2 TextureCoordsVarying;

void main (void) {
    vec4 mask = texture2D(Texture, TextureCoordsVarying);
    gl_FragColor = vec4(mask.rgb, 1.0);
}
</code></pre><h1 id="总结">总结</h1><p>最近一有时间就尽量研习图形图像相关的技术,本文具有强烈的个人感情色彩,如有观看不适,请尽快关闭. 本文仅作为个人学习记录使用,也欢迎在许可协议范围内转载或使用,请尊重版权并且保留原文链接,谢谢您的理解合作. 如果您觉得本站对您能有帮助,您可以使用RSS方式订阅本站,这样您将能在第一时间获取本站信息.</p><p><a href="https://github.com/sunyazhou13/GLSLDemo1">Demo</a></p><p><a href="http://www.lymanli.com/2019/02/17/ios-opengles-render-texture/">学习参考</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios%E5%BC%80%E5%8F%91/'>ios开发</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >ios</a> <a href="/tags/macos/" class="post-tag no-text-decoration" >macos</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 该博客文章由作者通过 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a> 进行授权。</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=从零学习OpenGLES的纹理渲染 - 迈腾大队长&url=https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=从零学习OpenGLES的纹理渲染 - 迈腾大队长&u=https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=从零学习OpenGLES的纹理渲染 - 迈腾大队长&url=https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="http://service.weibo.com/share/share.php?title=从零学习OpenGLES的纹理渲染 - 迈腾大队长&url=https://www.sunyazhou.com/2019/09/OpenGLESDemo1/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2023/03/circularsliderview/">使用SwiftUI绘制环形 Slider</a><li><a href="/2022/12/thesunyazhoutheoryii/">《The Sunyazhou Theory Ⅱ》的诞生</a><li><a href="/2022/12/gradientlayeranimation/">模仿Q音径向渐变动画</a><li><a href="/2022/11/swiftuipropertywrapper/">SwiftUI属性包装器:State、Binding、ObservableObject、EnvironmentObject</a><li><a href="/2022/09/fbmemorychecktool/">FB内存检测工具分享</a></ul></div><div id="access-tags"> <span>热门标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/%E9%9D%A2%E8%AF%95/">面试</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/ios%E5%BC%80%E5%8F%91/">ios开发</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/ios%E9%9D%A2%E8%AF%95%E9%A2%98/">ios面试题</a> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">文章目录</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>接下来阅读</h3><div class="card-deck mb-4"><div class="card"> <a href="/2019/04/AVRoutePickerView/"><div class="card-body"> <span class="timeago small" > 2019-04-17 <i class="unloaded">2019-04-17T23:19:52+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>AVRoutePickerView</h3><div class="text-muted small"><p> 前言 最近无意中看了一下AVKit发现内部增加了很多新的内容.其中有个AVRoutePickerView的UI控件,打算研究一下. 其实这个很常见就在系统的控制中心 下拉屏幕就能看见 当你连接耳机或者无线蓝牙设备的时候. 这里网易云音乐中有实践的例子 这个控件主要用于AirPlay投屏 和音频的线路切换 那么我今天就跟大家一起学习一下这个新的控件 代码实现 导入#im...</p></div></div></a></div><div class="card"> <a href="/2018/07/ToolBarBlur/"><div class="card-body"> <span class="timeago small" > 2018-07-24 <i class="unloaded">2018-07-24T02:22:05+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>利用UIToolBar做高斯模糊背景</h3><div class="text-muted small"><p> - (UIView *)containerBackgroundView { if (!_containerBackgroundView) { UIToolbar *toolBar = [[UIToolbar alloc] initWithFrame:CGRectZero]; toolBar.barStyle = UIBarStyleBlack; ...</p></div></div></a></div><div class="card"> <a href="/2018/08/TapticEngineFeedback/"><div class="card-body"> <span class="timeago small" > 2018-08-13 <i class="unloaded">2018-08-13T22:28:04+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Taptic Engine振动反馈</h3><div class="text-muted small"><p> 前言 Taptic Engine 是苹果产品上推出的全新震动模块，该元件最早出现在 Apple Watch 中。iPhone 6s 和 iPhone 6s Plus 中，也同样内置了Taptic Engine，在设计上有所升级。 Taptic Engine 振动模块为 Apple Watch 以及 iPhone 6s、iPhone 7 提供了 Force Touch 以及 3D To...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2019/07/LoadingAnimationI/" class="btn btn-outline-primary"><p>做一个简单的Loading动画</p></a> <a href="/2019/09/UITraitCollection/" class="btn btn-outline-primary"><p>UITraitCollection详解</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="sunyazhou13/gitment-comments" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/sunyazhou13">sunyazhou13</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，否则本网站上的博客文章均由作者根据知识共享许可协议 - 署名标示 4.0（CC BY 4.0）进行授权许可。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本博客由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，使用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> 作为主题</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">热门标签</h4><a class="post-tag" href="/tags/ios/">ios</a> <a class="post-tag" href="/tags/macos/">macos</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/%E9%9D%A2%E8%AF%95/">面试</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/ios%E5%BC%80%E5%8F%91/">ios开发</a> <a class="post-tag" href="/tags/swift/">swift</a> <a class="post-tag" href="/tags/ios%E9%9D%A2%E8%AF%95%E9%A2%98/">ios面试题</a> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sunyazhou.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
