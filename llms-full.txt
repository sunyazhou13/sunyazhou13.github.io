
URL: https://sunyazhou.com/2025/05/MemoryAlignmentAlgorithm/index.html.md
Published At: 2025-05-11 07:30:00 +0000

# GPUå†…å­˜å¯¹é½ç®—æ³•

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## èƒŒæ™¯ä»‹ç»

åœ¨å­¦ä¹ ã€ŠMetalã€‹ GPUç€è‰²å™¨ç¼–ç¨‹ä¸­ æœ‰ä¸€ç« è®²è§£GPUèµ„æºå †(Resource Heap)çš„å‚æ•°ç¼“å†²(Arguements Buffer)ä¸­éœ€è¦ä»CPUé€èµ„æºåˆ°GPUæ—¶é‡åˆ°ä¸€æ®µä»£ç è®¡ç®—èµ„æºçš„å†…å­˜å ç”¨çš„ç®—æ³•,å¾ˆæœ‰æ„æ€,åœ¨æ­¤è®°å½•ä¸‹æ¥.

``` swift
let sizeAndAligns = descriptors.map { descriptor in
    Renderer.device.heapTextureSizeAndAlign(descriptor: descriptor)
}
heapDescriptor.size = sizeAndAligns.reduce(0) { total, sizeAndAlign in
    let size = sizeAndAlign.size
    let align = sizeAndAlign.align
    return total + size - (size & (align - 1)) + align   //è¿™è¡Œä»£ç 
}
if heapDescriptor.size == 0 {
    return nil
}
```

æ–‡æ¡£æ˜¯è¿™æ ·è¯´æ˜çš„

> You calculate the size of the heap using size and correct alignment within the heap.
As long as align is a power of two, (size & (align - 1)) will give you the
remainder when size is divided by alignment. For example, if you have a size of 129
bytes, and you want to align it to memory blocks of 128 bytes, this is the result of
size - (size & (align - 1)) + align:

``` sh
129 - (129 & (128 - 1)) + 128 = 256
```

è¡¨è¾¾å¼` 129 & (128 - 1) `æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é«˜æ•ˆçš„å–æ¨¡ï¼ˆæ±‚ä½™ï¼‰æ“ä½œï¼Œä½†ä»…å½“é™¤æ•°æ˜¯ 2 çš„å¹‚æ¬¡æ–¹æ—¶æˆç«‹ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Š:

#### 1. æ•°å­¦åŸç† 

å½“ align æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼ˆå¦‚ 128 = 2â·ï¼‰ï¼Œalign - 1 çš„äºŒè¿›åˆ¶å½¢å¼æ˜¯å…¨ 1ï¼ˆä¾‹å¦‚ 127 çš„äºŒè¿›åˆ¶æ˜¯ 01111111ï¼‰ã€‚
æŒ‰ä½ä¸ï¼ˆ&ï¼‰æ“ä½œä¼šå°† size çš„é«˜ä½æ¸…é›¶ï¼Œä»…ä¿ç•™ä½ logâ‚‚(align) ä½çš„å€¼ï¼Œå³ size % align çš„ä½™æ•°ã€‚

ç¤ºä¾‹è®¡ç®—
å¯¹äº size = 129ï¼Œalign = 128ï¼š

``` math
\begin{align*}
\text{ä½™æ•°} &= 129 \ \% \ 128 \\
&= 129 \ \& \ (128 - 1) \\
&= 129 \ \& \ 127 \\
&= \text{äºŒè¿›åˆ¶} \ 10000001 \ \& \ 01111111 \\
&= 00000001 \quad (\text{å³åè¿›åˆ¶ 1})
\end{align*}
```

#### 2. ä¸ä¼ ç»Ÿæ¨¡è¿ç®—çš„å¯¹æ¯”


| æ–¹æ³• | è¿ç®—è¡¨è¾¾å¼ | ç»“æœ |	é€‚ç”¨æ¡ä»¶
| ------| ------ | ------ | ------ | 
| æŒ‰ä½ä¸æ³• | `size & (align - 1)`	 |  1	 | `align`å¿…é¡»æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ |
| ä¼ ç»Ÿå–æ¨¡æ³•	 | `size % align` |  1 |  ä»»æ„æ­£æ•´æ•° |

ä¼˜åŠ¿

* æ€§èƒ½é«˜æ•ˆï¼šä½è¿ç®—ï¼ˆ&ï¼‰çš„ç¡¬ä»¶æ‰§è¡Œé€Ÿåº¦é€šå¸¸æ¯”æ¨¡è¿ç®—ï¼ˆ%ï¼‰å¿«ä¸€ä¸ªæ•°é‡çº§ã€‚
* ä»£ç ç®€æ´ï¼šé€‚ç”¨äºéœ€è¦é¢‘ç¹è®¡ç®—å¯¹é½çš„åœºæ™¯ï¼ˆå¦‚ GPU å†…å­˜ç®¡ç†ï¼‰ã€‚

#### 3. å®é™…åº”ç”¨åœºæ™¯

åœ¨ Metal ä¸­ç®¡ç†å †å†…å­˜ï¼ˆ`MTLHeap`ï¼‰æ—¶ï¼Œå¸¸ç”¨æ­¤æ–¹æ³•è®¡ç®—å¯¹é½åçš„å†…å­˜å¤§å°ã€‚ä¾‹å¦‚ï¼š

``` swift
func alignedSize(size: Int, align: Int) -> Int {
    assert(align.isPowerOfTwo, "Alignment must be a power of two")
    let remainder = size & (align - 1)
    return remainder == 0 ? size : (size - remainder + align)
}

// ç¤ºä¾‹ï¼šå°† 129 å­—èŠ‚å¯¹é½åˆ° 128 å­—èŠ‚
let aligned = alignedSize(size: 129, align: 128) // ç»“æœä¸º 256
```

#### 4.é 2 çš„å¹‚æ¬¡æ–¹å¦‚ä½•å¤„ç†ï¼Ÿ

è‹¥`align`ä¸æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼ˆå¦‚`align = 100`ï¼‰ï¼Œå¿…é¡»ä½¿ç”¨ä¼ ç»Ÿæ¨¡è¿ç®—ï¼š

``` swift
func alignedSizeGeneric(size: Int, align: Int) -> Int {
    let remainder = size % align
    return remainder == 0 ? size : (size - remainder + align)
}

// ç¤ºä¾‹ï¼šå°† 250 å¯¹é½åˆ° 100
let aligned = alignedSizeGeneric(size: 250, align: 100) // ç»“æœä¸º 300
```

æ˜¯çš„ï¼Œè¡¨è¾¾å¼ `129 & (128 - 1)` æœ¬è´¨ä¸Šæ˜¯ä¸€ç§é«˜æ•ˆçš„å–æ¨¡ï¼ˆæ±‚ä½™ï¼‰æ“ä½œï¼Œä½†**ä»…å½“é™¤æ•°æ˜¯ 2 çš„å¹‚æ¬¡æ–¹æ—¶æˆç«‹**ã€‚

### **æ€»ç»“**
- `129 & (128 - 1)` **æ˜¯å–æ¨¡æ“ä½œ**ï¼Œä½†ä»…å½“ `align` ä¸º 2 çš„å¹‚æ¬¡æ–¹æ—¶æˆç«‹ã€‚
- **é€‚ç”¨åœºæ™¯**ï¼šGPU å†…å­˜å¯¹é½ã€é«˜æ€§èƒ½è®¡ç®—ä¸­ä¼˜åŒ–å–æ¨¡æ“ä½œã€‚
- **æ ¸å¿ƒå…¬å¼**ï¼š  
	
``` math
  \[
\text{AlignedSize} = \text{size} - (\text{size} \ \% \ \text{align}) + \text{align}
\]  
```

![](/assets/images/20250511MemoryAlignmentAlgorithm/AlignedSize.webp)

å…¶ä¸­ `%` å¯é€šè¿‡ `& (align - 1)` ä¼˜åŒ–ï¼ˆå½“ `align` æ˜¯ 2 çš„å¹‚æ—¶ï¼‰ã€‚


URL: https://sunyazhou.com/2025/02/the-basics-on-the-memory-layout-of-swift-struct-instances/index.html.md
Published At: 2025-02-23 12:17:00 +0000

# Swiftç»“æ„ä½“å®ä¾‹å†…å­˜å¸ƒå±€çš„åŸºç¡€çŸ¥è¯†

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯ä»‹ç»

![](/assets/images/20250223SwiftStructMemoryLayout/VerTexBufferLayout.webp)

2024å¹´å­¦ä¹ ã€ŠMetal.by.Tutorials.4th.2023.12ã€‹ä¸­æœ‰æåˆ°swiftä¸­çš„ç»“æ„ä½“å®ä¾‹çš„å†…å­˜å¸ƒå±€,æˆ‘æŠŠè¿™äº›æ•´ç†äº†ä¸€ä¸‹.

## å¤§å°ã€æ­¥é•¿å’Œå¯¹é½(Size, Stride, Alignment)


Swift ç»“æ„ä½“å®ä¾‹å†…å­˜å¸ƒå±€çš„åŸºç¡€çŸ¥è¯†
> 2018 å¹´ 3 æœˆ 12 æ—¥ âˆ™ Swift å†…éƒ¨åŸç† âˆ™ ä½œè€…ï¼šGreg Heo

åœ¨å†…å­˜ä¸­å¤„ç† Swift ç±»å‹æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸‰ä¸ªå±æ€§ï¼šå¤§å°ï¼ˆSizeï¼‰ã€æ­¥é•¿ï¼ˆStrideï¼‰ å’Œ å¯¹é½ï¼ˆAlignmentï¼‰ã€‚

## å¤§å°(Size)

è®©æˆ‘ä»¬ä»¥ä¸¤ä¸ªç»“æ„ä½“çš„ä¸¾ä¾‹è¯´æ˜

``` swift
struct Year {
  let year: Int
}

struct YearWithMonth {
  let year: Int
  let month: Int
}
```

æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘ï¼ŒYearWithMonth çš„å®ä¾‹æ¯” Year çš„å®ä¾‹æ›´å¤§â€”â€”å®ƒåœ¨å†…å­˜ä¸­å ç”¨äº†æ›´å¤šçš„ç©ºé—´ã€‚ä½†æˆ‘ä»¬æ˜¯ç§‘å­¦å®¶ï¼›æˆ‘ä»¬å¦‚ä½•ç”¨ç¡®å‡¿çš„æ•°æ®æ¥éªŒè¯ç›´è§‰å‘¢ï¼Ÿ

## å†…å­˜å¸ƒå±€(Memory Layout)

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `MemoryLayout` ç±»å‹æ¥æ£€æŸ¥æˆ‘ä»¬çš„ç±»å‹åœ¨å†…å­˜ä¸­çš„ä¸€äº›å±æ€§ã€‚

è¦æŸ¥æ‰¾ç»“æ„ä½“çš„å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨ size å±æ€§å¹¶ç»“åˆæ³›å‹å‚æ•°ï¼š

``` swift
let size = MemoryLayout<Year>.size
```

å¦‚æœä½ æœ‰ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ `size(ofValue:)` é™æ€å‡½æ•°ï¼š

``` swift
let instance = Year(year: 1984)
let size = MemoryLayout.size(ofValue: instance)
```

åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œå¤§å°éƒ½è¢«æŠ¥å‘Šä¸º **8 å­—èŠ‚**ã€‚

ä¸å‡ºæ‰€æ–™ï¼Œæˆ‘ä»¬çš„ç»“æ„ä½“ `YearWithMonth` çš„å¤§å°æ˜¯ **16 å­—èŠ‚**ã€‚

## å›åˆ°å¤§å°  

ç»“æ„ä½“çš„å¤§å°ä¼¼ä¹éå¸¸ç›´è§‚â€”â€”è®¡ç®—æ¯ä¸ªå±æ€§å¤§å°çš„æ€»å’Œã€‚å¯¹äºè¿™æ ·çš„ç»“æ„ä½“ï¼š

``` swift
struct Puppy {
  let age: Int
  let isTrained: Bool
}
```

ç»“æ„ä½“çš„å¤§å°åº”è¯¥ä¸å…¶å±æ€§çš„å¤§å°ç›¸åŒ¹é…ï¼š


``` swift
MemoryLayout<Int>.size + MemoryLayout<Bool>.size
// returns 9, from 8 + 1

MemoryLayout<Puppy>.size
// returns 9
```

çœ‹èµ·æ¥æ²¡é—®é¢˜ï¼[æ—ç™½ï¼šçœŸçš„æ²¡é—®é¢˜å—ï¼ŸğŸ˜ˆ]

## æ­¥é•¿ï¼ˆStrideï¼‰

å½“ä½ åœ¨å¤„ç†å•ä¸ªç¼“å†²åŒºï¼ˆä¾‹å¦‚æ•°ç»„ï¼‰ä¸­çš„å¤šä¸ªå®ä¾‹æ—¶ï¼Œç±»å‹çš„æ­¥é•¿å°±å˜å¾—éå¸¸é‡è¦ã€‚

å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¿ç»­çš„å°ç‹—æ•°ç»„ï¼Œæ¯åªå°ç‹—çš„å¤§å°ä¸º 9 å­—èŠ‚ï¼Œé‚£ä¹ˆå®ƒåœ¨å†…å­˜ä¸­ä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ

![](/assets/images/20250223SwiftStructMemoryLayout/stride-nopadding.webp)

äº‹å®è¯æ˜ï¼Œå¹¶éå¦‚æ­¤ã€‚âŒ

`æ­¥é•¿ Stride`å†³å®šäº†ä¸¤ä¸ªå…ƒç´ ä¹‹é—´çš„è·ç¦»ï¼Œå®ƒé€šå¸¸å¤§äºæˆ–ç­‰äºå¤§å°ã€‚

``` swift
MemoryLayout<Puppy>.size
// returns 9

MemoryLayout<Puppy>.stride
// returns 16
```

å› æ­¤ï¼Œå®é™…çš„å¸ƒå±€çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/stride-padding.webp)

ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæŒ‡å‘ç¬¬ä¸€ä¸ªå…ƒç´ çš„å­—èŠ‚æŒ‡é’ˆï¼Œå¹¶å¸Œæœ›ç§»åŠ¨åˆ°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ­¥é•¿å°±æ˜¯ä½ éœ€è¦å°†æŒ‡é’ˆå‰è¿›çš„å­—èŠ‚è·ç¦»ã€‚

ä¸ºä»€ä¹ˆå¤§å°å’Œæ­¥é•¿ä¼šä¸åŒï¼Ÿè¿™å°±å¼•å‡ºäº†å†…å­˜å¸ƒå±€çš„æœ€åä¸€ä¸ªç¥å¥‡æ•°å­—ã€‚


## å¯¹é½ï¼ˆAlignmentï¼‰  

æƒ³è±¡ä¸€ä¸‹ï¼Œè®¡ç®—æœºä¸€æ¬¡è·å– 8 ä½ï¼ˆå³ 1 å­—èŠ‚ï¼‰çš„å†…å­˜ã€‚æ— è®ºæ˜¯è·å–ç¬¬ 1 ä¸ªå­—èŠ‚è¿˜æ˜¯ç¬¬ 7 ä¸ªå­—èŠ‚ï¼Œæ‰€éœ€çš„æ—¶é—´æ˜¯ç›¸åŒçš„ã€‚

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-byte8.webp)

ç„¶åä½ å‡çº§åˆ°äº†ä¸€å° 16 ä½è®¡ç®—æœºï¼Œå®ƒä»¥ 16 ä½çš„å­—ï¼ˆwordï¼‰ä¸ºå•ä½è®¿é—®æ•°æ®ã€‚ä½ ä»ç„¶æœ‰ä¸€äº›æ—§çš„è½¯ä»¶å¸Œæœ›ä»¥å­—èŠ‚ä¸ºå•ä½è®¿é—®æ•°æ®ï¼Œä½†æƒ³è±¡ä¸€ä¸‹è¿™é‡Œå¯èƒ½å‘ç”Ÿçš„é­”æ³•ï¼šå¦‚æœè½¯ä»¶è¯·æ±‚å­—èŠ‚ 0 å’Œå­—èŠ‚ 1ï¼Œè®¡ç®—æœºç°åœ¨å¯ä»¥ä¸€æ¬¡æ€§è®¿é—®å­— 0ï¼Œç„¶åå°† 16 ä½çš„ç»“æœæ‹†åˆ†ã€‚

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-byte16.webp)

åœ¨è¿™ç§ç†æƒ³æƒ…å†µä¸‹ï¼Œå­—èŠ‚çº§çš„å†…å­˜è®¿é—®é€Ÿåº¦æé«˜äº†ä¸€å€ï¼ğŸ‰

ç°åœ¨å‡è®¾ä¸€ä¸ªä¸å®ˆè§„çŸ©çš„ç¨‹åºåƒè¿™æ ·æ”¾å…¥ä¸€ä¸ª 16 ä½çš„å€¼ï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-misaligned16.webp)

ç„¶åä½ è¦æ±‚è®¡ç®—æœºä»å­—èŠ‚ä½ç½® 3 è¯»å– 16 ä½çš„å­—ï¼ˆwordï¼‰ã€‚é—®é¢˜åœ¨äºï¼Œè¿™ä¸ªå€¼æ˜¯å¯¹é½ä¸å½“çš„ã€‚ä¸ºäº†è¯»å–å®ƒï¼Œè®¡ç®—æœºéœ€è¦è¯»å–ä½ç½® 1 çš„å­—ï¼Œå°†å…¶åˆ‡åŠï¼Œå†è¯»å–ä½ç½® 2 çš„å­—ï¼Œå°†å…¶åˆ‡åŠï¼Œç„¶åå°†ä¸¤åŠæ‹¼æ¥åœ¨ä¸€èµ·ã€‚è¿™æ„å‘³ç€è®¿é—®ä¸€ä¸ª 16 ä½çš„å€¼éœ€è¦ä¸¤æ¬¡ç‹¬ç«‹çš„ 16 ä½å†…å­˜è¯»å–â€”â€”æ¯”åº”æœ‰çš„é€Ÿåº¦æ…¢äº†ä¸¤å€ï¼ğŸ˜­

åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œæœªå¯¹é½çš„è®¿é—®ä¸ä»…ä»…æ˜¯æ…¢çš„é—®é¢˜â€”â€”å®ƒå®Œå…¨ä¸è¢«å…è®¸ï¼Œå¹¶ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚

## ç®€å•çš„ Swift ç±»å‹  

åœ¨ Swift ä¸­ï¼Œç®€å•ç±»å‹ï¼ˆå¦‚ `Int` å’Œ `Double`ï¼‰çš„å¯¹é½å€¼ä¸å…¶å¤§å°ç›¸åŒã€‚ä¸€ä¸ª 32 ä½ï¼ˆ4 å­—èŠ‚ï¼‰çš„æ•´æ•°å¤§å°ä¸º 4 å­—èŠ‚ï¼Œå¹¶ä¸”éœ€è¦å¯¹é½åˆ° 4 å­—èŠ‚ã€‚

``` swift
MemoryLayout<Int32>.size
// returns 4
MemoryLayout<Int32>.alignment
// returns 4
MemoryLayout<Int32>.stride
// returns 4
```

æ­¥é•¿ä¹Ÿæ˜¯ 4ï¼Œè¿™æ„å‘³ç€åœ¨è¿ç»­ç¼“å†²åŒºä¸­ï¼Œå€¼ä¹‹é—´ç›¸éš” 4 å­—èŠ‚ã€‚ä¸éœ€è¦å¡«å……ã€‚

## å¤åˆç±»å‹ (Compound Types)

ç°åœ¨å›åˆ°æˆ‘ä»¬çš„ `Puppy` ç»“æ„ä½“ï¼Œå®ƒæœ‰ä¸€ä¸ª `Int` å’Œä¸€ä¸ª `Bool` å±æ€§ã€‚å†æ¬¡è€ƒè™‘å€¼åœ¨ç¼“å†²åŒºä¸­ç´§æŒ¨åœ¨ä¸€èµ·çš„æƒ…å†µï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-nopadding-bytes.webp)

`Bool` å€¼çš„ä½ç½®æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºå®ƒä»¬çš„å¯¹é½å€¼ä¸º 1 (`alignment=1`)ã€‚ä½†ç¬¬äºŒä¸ªæ•´æ•°æ˜¯å¯¹é½ä¸å½“çš„ã€‚å®ƒæ˜¯ä¸€ä¸ª 64 ä½ï¼ˆ8 å­—èŠ‚ï¼‰çš„å€¼ï¼Œå¯¹é½å€¼ä¸º 8(`alignment=8`)ï¼Œè€Œå®ƒçš„å­—èŠ‚ä½ç½®ä¸æ˜¯ 8 çš„å€æ•°ã€‚âŒ

è®°ä½ï¼Œè¿™ç§ç±»å‹çš„æ­¥é•¿æ˜¯ 16ï¼Œè¿™æ„å‘³ç€ç¼“å†²åŒºå®é™…ä¸Šçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-padding-bytes.webp)

æˆ‘ä»¬ä¿ç•™äº†ç»“æ„ä½“å†…æ‰€æœ‰å€¼çš„å¯¹é½è¦æ±‚ï¼šç¬¬äºŒä¸ªæ•´æ•°ä½äºå­—èŠ‚ 16ï¼Œè¿™æ˜¯ 8 çš„å€æ•°ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆç»“æ„ä½“çš„æ­¥é•¿å¯ä»¥å¤§äºå…¶å¤§å°ï¼šä¸ºäº†æ·»åŠ è¶³å¤Ÿçš„å¡«å……ä»¥æ»¡è¶³å¯¹é½è¦æ±‚ã€‚

## è®¡ç®—å¯¹é½  

é‚£ä¹ˆï¼Œåœ¨æˆ‘ä»¬è¿™æ®µæ—…ç¨‹çš„ç»“å°¾ï¼Œ`Puppy` ç»“æ„ä½“ç±»å‹çš„å¯¹é½å€¼æ˜¯å¤šå°‘å‘¢ï¼Ÿ

``` swift
MemoryLayout<Puppy>.alignment
// returns 8
```

ç»“æ„ä½“ç±»å‹çš„å¯¹é½å€¼æ˜¯å…¶æ‰€æœ‰å±æ€§ä¸­æœ€å¤§çš„å¯¹é½å€¼ã€‚åœ¨ `Int` å’Œ `Bool` ä¹‹é—´ï¼Œ`Int` çš„å¯¹é½å€¼æ›´å¤§ï¼Œä¸º 8ï¼Œå› æ­¤ç»“æ„ä½“ä½¿ç”¨å®ƒã€‚

ç„¶åï¼Œæ­¥é•¿æ˜¯å¤§å°å‘ä¸Šå–æ•´åˆ°å¯¹é½å€¼çš„ä¸‹ä¸€ä¸ªå€æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼š

- å¤§å°æ˜¯ 9
- 9 ä¸æ˜¯ 8 çš„å€æ•°
- 9 ä¹‹åçš„ä¸‹ä¸€ä¸ª 8 çš„å€æ•°æ˜¯ 16
- å› æ­¤ï¼Œæ­¥é•¿æ˜¯ 16

## æœ€åä¸€ä¸ªå¤æ‚ç‚¹  

è€ƒè™‘æˆ‘ä»¬æœ€åˆçš„ `Puppy`ï¼Œå¹¶å°†å…¶ä¸ `AlternatePuppy` è¿›è¡Œå¯¹æ¯”ï¼š

``` swift
struct Puppy {
  let age: Int
  let isTrained: Bool
} // Int, Bool

struct AlternatePuppy { 
  let isTrained: Bool
  let age: Int
} // Bool, Int

```

`AlternatePuppy` ç»“æ„ä½“çš„å¯¹é½å€¼ä»ç„¶æ˜¯ 8ï¼Œæ­¥é•¿ä»ç„¶æ˜¯ 16ï¼Œä½†ï¼š

``` swift
MemoryLayout<AlternatePuppy>.size
// returns 16
```

ä»€ä¹ˆï¼Ÿï¼æˆ‘ä»¬åªæ˜¯æ”¹å˜äº†å±æ€§çš„é¡ºåºã€‚ä¸ºä»€ä¹ˆç°åœ¨å¤§å°ä¸ä¸€æ ·äº†ï¼Ÿå®ƒåº”è¯¥ä»ç„¶æ˜¯9ï¼Œä¸æ˜¯å—ï¼Ÿä¸€ä¸ªå¸ƒå°”å€¼åé¢è·Ÿç€ä¸€ä¸ªæ•´æ•°ï¼Œå°±åƒè¿™æ ·ï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-internal-1.webp)

ä¹Ÿè®¸ä½ çœ‹åˆ°äº†é—®é¢˜æ‰€åœ¨ï¼š8å­—èŠ‚çš„æ•´æ•°ä¸å†å¯¹é½äº†ï¼å®ƒåœ¨å†…å­˜ä¸­å®é™…çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š

![](/assets/images/20250223SwiftStructMemoryLayout/alignment-internal-2.webp)

ç»“æ„ä½“æœ¬èº«å¿…é¡»å¯¹é½ï¼Œç»“æ„ä½“å†…éƒ¨çš„å±æ€§ä¹Ÿå¿…é¡»ä¿æŒå¯¹é½ã€‚å¡«å……å­—èŠ‚ä¼šæ’å…¥åˆ°å…ƒç´ ä¹‹é—´ï¼Œæ•´ä¸ªç»“æ„ä½“çš„å¤§å°ä¹Ÿä¼šéšä¹‹æ‰©å±•ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ­¥é•¿ï¼ˆstrideï¼‰ä»ç„¶æ˜¯16ï¼Œå› æ­¤ä»`Puppy`åˆ°`AlternatePuppy`çš„å®é™…å˜åŒ–æ˜¯å¡«å……å­—èŠ‚çš„ä½ç½®ã€‚é‚£ä¹ˆè¿™äº›ç»“æ„ä½“å‘¢ï¼Ÿ

``` swift
struct CertifiedPuppy1 {
  let age: Int
  let isTrained: Bool
  let isCertified: Bool
} // Int, Bool, Bool

struct CertifiedPuppy2 {
  let isTrained: Bool
  let age: Int
  let isCertified: Bool
} // Bool, Int, Bool
```

è¿™ä¸¤ä¸ªç»“æ„ä½“çš„å¤§å°ï¼ˆsizeï¼‰ã€æ­¥é•¿ï¼ˆstrideï¼‰å’Œå¯¹é½æ–¹å¼ï¼ˆalignmentï¼‰åˆ†åˆ«æ˜¯å¤šå°‘å‘¢ï¼ŸğŸ¤”ï¼ˆæç¤ºï¼‰

## å…³äºé—­åˆå¤§æ‹¬å·

å‡è®¾ä½ æœ‰ä¸€ä¸ª`UnsafeRawPointer`ï¼ˆåœ¨Cè¯­è¨€ä¸­ç›¸å½“äº`void *`ï¼‰ã€‚ä½ çŸ¥é“å®ƒæŒ‡å‘çš„ç±»å‹ã€‚é‚£ä¹ˆï¼Œå¤§å°ï¼ˆsizeï¼‰ã€æ­¥é•¿ï¼ˆstrideï¼‰å’Œå¯¹é½æ–¹å¼ï¼ˆalignmentï¼‰åœ¨å…¶ä¸­æ‰®æ¼”ä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿ

- **å¤§å°ï¼ˆSizeï¼‰**ï¼šæ˜¯ä»æŒ‡é’ˆè¯»å–ä»¥è·å–æ‰€æœ‰æ•°æ®æ‰€éœ€çš„å­—èŠ‚æ•°ã€‚
- **æ­¥é•¿ï¼ˆStrideï¼‰**ï¼šæ˜¯å‘å‰ç§»åŠ¨ä»¥åˆ°è¾¾ç¼“å†²åŒºä¸­ä¸‹ä¸€ä¸ªé¡¹ç›®çš„å­—èŠ‚æ•°ã€‚
- **å¯¹é½æ–¹å¼ï¼ˆAlignmentï¼‰**ï¼šæ˜¯æ¯ä¸ªå®ä¾‹å¿…é¡»ä½äºçš„â€œèƒ½è¢«æ•´é™¤çš„â€æ•°å­—ã€‚å¦‚æœä½ æ­£åœ¨åˆ†é…å†…å­˜ä»¥å¤åˆ¶æ•°æ®ï¼Œä½ éœ€è¦æŒ‡å®šæ­£ç¡®çš„å¯¹é½æ–¹å¼ï¼ˆä¾‹å¦‚ï¼š`allocate(byteCount: 100, alignment: 4)`ï¼‰ã€‚

![](/assets/images/20250223SwiftStructMemoryLayout/size-stride-alignment-summary.webp)


å¯¹äºæˆ‘ä»¬å¤§å¤šæ•°äººæ¥è¯´ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¤„ç†çš„éƒ½æ˜¯é«˜çº§é›†åˆï¼Œæ¯”å¦‚æ•°ç»„å’Œé›†åˆï¼Œä¸éœ€è¦è€ƒè™‘åº•å±‚çš„å†…å­˜å¸ƒå±€ã€‚

åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åœ¨å¹³å°ä¸Šä½¿ç”¨ä½çº§APIï¼Œæˆ–è€…ä¸Cä»£ç è¿›è¡Œäº’æ“ä½œã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªSwiftç»“æ„ä½“æ•°ç»„ï¼Œå¹¶ä¸”éœ€è¦è®©Cä»£ç è¯»å–å®ƒï¼ˆæˆ–è€…åè¿‡æ¥ï¼‰ï¼Œé‚£ä¹ˆä½ å°±éœ€è¦æ‹…å¿ƒåˆ†é…å…·æœ‰æ­£ç¡®å¯¹é½æ–¹å¼çš„ç¼“å†²åŒºï¼Œç¡®ä¿ç»“æ„ä½“å†…éƒ¨çš„å¡«å……å­—èŠ‚å¯¹é½ï¼Œä»¥åŠç¡®ä¿ä½ æœ‰æ­£ç¡®çš„æ­¥é•¿å€¼ï¼Œä»¥ä¾¿æ­£ç¡®è§£é‡Šæ•°æ®ã€‚

æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œå³ä½¿æ˜¯è®¡ç®—å¤§å°ï¼Œä¹Ÿæ²¡æœ‰çœ‹èµ·æ¥é‚£ä¹ˆç®€å•â€”â€”æ¯ä¸ªå±æ€§çš„å¤§å°å’Œå¯¹é½æ–¹å¼ä¹‹é—´å­˜åœ¨ç›¸äº’ä½œç”¨ï¼Œè¿™å†³å®šäº†ç»“æ„ä½“çš„æ•´ä½“å¤§å°ã€‚å› æ­¤ï¼Œç†è§£è¿™ä¸‰è€…æ„å‘³ç€ä½ æ­£åœ¨æˆä¸ºå†…å­˜ç®¡ç†çš„é«˜æ‰‹ã€‚

å¯¹æ·±å…¥äº†è§£æ„Ÿå…´è¶£å—ï¼Ÿ

- [Wikipedia ä¸Šçš„ â€œData structure alignmentâ€](https://en.wikipedia.org/wiki/Data_structure_alignment)  
- [Swift æ–‡æ¡£ä¸­çš„ â€œType Layoutâ€ æ–‡ç« ](https://github.com/apple/swift/blob/master/docs/ABI/TypeLayout.rst)ï¼Œè§£é‡Šäº†å¦‚ä½•è®¡ç®—ç»“æ„ä½“çš„å¤§å°ï¼ˆsizeï¼‰ã€æ­¥é•¿ï¼ˆstrideï¼‰å’Œå¯¹é½æ–¹å¼ï¼ˆalignmentï¼‰ã€‚  
- [LLVM ä¸­çš„ `getAlignOf` æºç ](https://github.com/apple/swift-llvm/blob/stable/lib/IR/Constants.cpp#L1800-L1811)
- [Swift çš„ `UnsafeMutableRawPointer.allocate(byteCount:alignment:)`ï¼Œå¸¦æœ‰å¤§å°å’Œå¯¹é½å‚æ•°](https://developer.apple.com/documentation/swift/unsafemutablerawpointer/allocate(bytecount:alignment:))


# æ€»ç»“

åœ¨å­¦ä¹ Metalå¼€å§‹çš„æ—¶å€™è¦ä½¿ç”¨swiftç±»å‹æ“ä½œå†…å­˜,å¯¹swiftä¸­çš„ç±»å‹å†…å­˜å¸ƒå±€å’Œå¯¹é½äº†è§£ä¸æ˜¯å¾ˆæ¸…æ¥š,æ•´ç†äº†è¿™ç¯‡æ–‡ç«  å¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©

[åŸæ–‡åœ°å€The basics on the memory layout of Swift struct instances.
](https://swiftunboxed.com/internals/size-stride-alignment/)


URL: https://sunyazhou.com/2025/02/unsafe-swift-using-pointers-and-interacting-with-c/index.html.md
Published At: 2025-02-22 14:15:00 +0000

# å¦‚ä½•ä½¿ç”¨unsafe SwiftæŒ‡é’ˆç±»å‹ç›´æ¥è®¿é—®å†…å­˜å¹¶ä¸Cäº¤äº’

![](/assets/images/20250222UnsafeSwift/banner.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


### èƒŒæ™¯ä»‹ç»

2024å¹´å­¦ä¹ ã€ŠMetal.by.Tutorials.4th.2023.12ã€‹ä¸­æœ‰æåˆ°å¦‚ä½•ä½¿ç”¨`Unsafe Swift` æŒ‡é’ˆå’ŒCäº¤äº’,ä¸»è¦æ˜¯åœ¨å†…å­˜ä¸­å¦‚ä½•æ ‡è¯†Cçš„å†…å®¹,ä¸‹é¢è¿™ç¯‡æ–‡ç« æ˜¯ä¹¦ä¸­ä»‹ç»çš„è‹±æ–‡æ–‡ç« æˆ‘çœ‹äº†ä»¥åè§‰å¾—æ¶ˆåŒ–å¸æ”¶ä¸€ä¸‹,æ•´ç†æˆä¸­æ–‡ç‰ˆä¾›å„ä½å‚è€ƒ.

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨unsafe Swift é€šè¿‡å„ç§æŒ‡é’ˆç±»å‹ç›´æ¥è®¿é—®å†…å­˜ã€‚ä½œè€…ï¼šBrody Ellerã€‚

> æ›´æ–°è¯´æ˜ï¼šBrody Eller ä¸º Swift 5.1 æ›´æ–°äº†æœ¬æ•™ç¨‹ã€‚åŸå§‹ç‰ˆæœ¬ç”± Ray Fix ç¼–å†™ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒSwift æ˜¯å†…å­˜å®‰å…¨çš„ï¼šå®ƒé˜²æ­¢ç›´æ¥è®¿é—®å†…å­˜ï¼Œå¹¶ç¡®ä¿åœ¨ä½¿ç”¨ä¹‹å‰åˆå§‹åŒ–æ‰€æœ‰å†…å®¹ã€‚å…³é”®çŸ­è¯­æ˜¯â€œé»˜è®¤æƒ…å†µä¸‹â€ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸å®‰å…¨çš„ Swiftï¼Œå®ƒå…è®¸ä½ é€šè¿‡æŒ‡é’ˆç›´æ¥è®¿é—®å†…å­˜ã€‚

æœ¬æ•™ç¨‹å°†å¸¦ä½ å¿«é€Ÿäº†è§£ Swift ä¸­æ‰€è°“çš„â€œä¸å®‰å…¨â€ç‰¹æ€§ã€‚

â€œä¸å®‰å…¨â€å¹¶ä¸æ„å‘³ç€ä»£ç å¯èƒ½ä¼šå‡ºé”™æˆ–å±é™©ã€‚ç›¸åï¼Œå®ƒæŒ‡çš„æ˜¯éœ€è¦é¢å¤–å°å¿ƒçš„ä»£ç ï¼Œå› ä¸ºå®ƒé™åˆ¶äº†ç¼–è¯‘å™¨åœ¨é˜²æ­¢ä½ çŠ¯é”™æ–¹é¢çš„èƒ½åŠ›ã€‚

å¦‚æœä½ éœ€è¦ä¸ä¸å®‰å…¨çš„è¯­è¨€ï¼ˆå¦‚ Cï¼‰è¿›è¡Œäº¤äº’ã€éœ€è¦æé«˜è¿è¡Œæ—¶æ€§èƒ½ï¼Œæˆ–è€…åªæ˜¯æƒ³æ¢ç´¢ Swift çš„å†…éƒ¨æœºåˆ¶ï¼Œè¿™äº›ç‰¹æ€§ä¼šéå¸¸æœ‰ç”¨ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨æŒ‡é’ˆå¹¶ç›´æ¥ä¸å†…å­˜ç³»ç»Ÿäº¤äº’ã€‚

> æ³¨æ„ï¼šè™½ç„¶è¿™æ˜¯ä¸€ä¸ªé«˜çº§ä¸»é¢˜ï¼Œä½†å¦‚æœä½ å¯¹ Swift æœ‰ä¸€å®šçš„æŒæ¡èƒ½åŠ›ï¼Œå°±å¯ä»¥è·Ÿä¸Šæœ¬æ•™ç¨‹çš„å†…å®¹ã€‚å¦‚æœä½ éœ€è¦å¤ä¹  Swift æŠ€èƒ½ï¼Œè¯·æŸ¥[ iOS å’Œ Swift åˆå­¦è€…ç³»åˆ—](https://www.kodeco.com/ios/learn)ã€‚æœ‰ C è¯­è¨€ç»éªŒä¼šæœ‰æ‰€å¸®åŠ©ï¼Œä½†ä¸æ˜¯å¿…éœ€çš„ã€‚


### å¼€å§‹å‰å¯ä»¥ä¸‹è½½æœ¬ç¯‡æ–‡ç« æ¶‰åŠåˆ°çš„demo

[Download Materialsä¸‹è½½åˆå§‹é¡¹ç›®](https://github.com/sunyazhou13/Using-Pointers-and-Interacting-With-C)ã€‚

æœ¬æ•™ç¨‹åŒ…å«ä¸‰ä¸ªç©ºçš„ Swift Playground æ–‡ä»¶ï¼š

###  æ¢ç´¢Unsafe Swiftå†…å­˜å¸ƒå±€
é¦–å…ˆæ‰“å¼€ UnsafeSwift Playgroundã€‚ç”±äºæœ¬æ•™ç¨‹ä¸­çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯è·¨å¹³å°çš„ï¼Œä½ å¯ä»¥é€‰æ‹©ä»»æ„å¹³å°

![](/assets/images/20250222UnsafeSwift/memory1.webp)

ä¸å®‰å…¨çš„ Swift ç›´æ¥ä¸å†…å­˜ç³»ç»Ÿäº¤äº’ã€‚ä½ å¯ä»¥å°†å†…å­˜æƒ³è±¡æˆä¸€ç³»åˆ—ç›’å­â€”â€”å®é™…ä¸Šæœ‰æ•°åäº¿ä¸ªç›’å­â€”â€”æ¯ä¸ªç›’å­é‡Œéƒ½åŒ…å«ä¸€ä¸ªæ•°å­—ã€‚

æ¯ä¸ªç›’å­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜åœ°å€ã€‚æœ€å°çš„å¯å¯»å€å­˜å‚¨å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œé€šå¸¸ç”± 8 ä¸ªæ¯”ç‰¹ï¼ˆbitï¼‰ç»„æˆã€‚

8 æ¯”ç‰¹çš„å­—èŠ‚å¯ä»¥å­˜å‚¨ 0 åˆ° 255 ä¹‹é—´çš„å€¼ã€‚å¤„ç†å™¨è¿˜å¯ä»¥é«˜æ•ˆåœ°è®¿é—®å†…å­˜ä¸­çš„å­—ï¼ˆwordï¼‰ï¼Œå­—é€šå¸¸ç”±å¤šä¸ªå­—èŠ‚ç»„æˆã€‚

ä¾‹å¦‚ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä¸€ä¸ªå­—æ˜¯ 8 ä¸ªå­—èŠ‚ï¼ˆ64 æ¯”ç‰¹ï¼‰ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `MemoryLayout` æ¥æŸ¥çœ‹ä¸€äº›åŸç”Ÿ Swift ç±»å‹çš„å¤§å°å’Œå¯¹é½æ–¹å¼ã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

* åœ¨ç¬¬ä¸€ä¸ª Playground ä¸­ï¼Œä½ å°†ä½¿ç”¨å‡ æ®µç®€çŸ­çš„ä»£ç æ¥æ¢ç´¢å†…å­˜å¸ƒå±€ï¼Œå¹¶å°è¯•ä½¿ç”¨ä¸å®‰å…¨çš„æŒ‡é’ˆã€‚    
* åœ¨ç¬¬äºŒä¸ª Playground ä¸­ï¼Œä½ å°†ä½¿ç”¨ä¸€ä¸ªä½çº§çš„ C API æ¥æ‰§è¡Œæµå¼æ•°æ®å‹ç¼©ï¼Œå¹¶å°†å…¶å°è£…ä¸º Swift é£æ ¼çš„æ¥å£ã€‚  
* åœ¨æœ€åä¸€ä¸ª Playground ä¸­ï¼Œä½ å°†åˆ›å»ºä¸€ä¸ªè·¨å¹³å°çš„æ›¿ä»£ `arc4random` çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚å®ƒå†…éƒ¨ä½¿ç”¨äº†ä¸å®‰å…¨çš„ Swiftï¼Œä½†å¯¹ç”¨æˆ·éšè—äº†è¿™ä¸€ç»†èŠ‚ã€‚

é¦–å…ˆæ‰“å¼€ **UnsafeSwift** Playgroundã€‚ç”±äºæœ¬æ•™ç¨‹ä¸­çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯è·¨å¹³å°çš„ï¼Œä½ å¯ä»¥é€‰æ‹©ä»»æ„å¹³å°ã€‚

![](/assets/images/20250222UnsafeSwift/memory2.webp)

ä¸å®‰å…¨çš„ Swift ç›´æ¥ä¸å†…å­˜ç³»ç»Ÿäº¤äº’ã€‚ä½ å¯ä»¥å°†å†…å­˜æƒ³è±¡æˆä¸€ç³»åˆ—ç›’å­â€”â€”å®é™…ä¸Šæœ‰æ•°åäº¿ä¸ªç›’å­â€”â€”æ¯ä¸ªç›’å­é‡Œéƒ½åŒ…å«ä¸€ä¸ªæ•°å­—ã€‚

æ¯ä¸ªç›’å­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜åœ°å€ã€‚æœ€å°çš„å¯å¯»å€å­˜å‚¨å•å…ƒæ˜¯ä¸€ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰ï¼Œé€šå¸¸ç”± 8 ä¸ªæ¯”ç‰¹ï¼ˆbitï¼‰ç»„æˆã€‚

8 æ¯”ç‰¹çš„å­—èŠ‚å¯ä»¥å­˜å‚¨ 0 åˆ° 255 ä¹‹é—´çš„å€¼ã€‚å¤„ç†å™¨è¿˜å¯ä»¥é«˜æ•ˆåœ°è®¿é—®å†…å­˜ä¸­çš„å­—ï¼ˆwordï¼‰ï¼Œå­—é€šå¸¸ç”±å¤šä¸ªå­—èŠ‚ç»„æˆã€‚

ä¾‹å¦‚ï¼Œåœ¨ 64 ä½ç³»ç»Ÿä¸Šï¼Œä¸€ä¸ªå­—æ˜¯ 8 ä¸ªå­—èŠ‚ï¼ˆ64 æ¯”ç‰¹ï¼‰ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ä½¿ç”¨ `MemoryLayout` æ¥æŸ¥çœ‹ä¸€äº›åŸç”Ÿ Swift ç±»å‹çš„å¤§å°å’Œå¯¹é½æ–¹å¼ã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
import Foundation

MemoryLayout<Int>.size          // returns 8 (on 64-bit)
MemoryLayout<Int>.alignment     // returns 8 (on 64-bit)
MemoryLayout<Int>.stride        // returns 8 (on 64-bit)

MemoryLayout<Int16>.size        // returns 2
MemoryLayout<Int16>.alignment   // returns 2
MemoryLayout<Int16>.stride      // returns 2

MemoryLayout<Bool>.size         // returns 1
MemoryLayout<Bool>.alignment    // returns 1
MemoryLayout<Bool>.stride       // returns 1

MemoryLayout<Float>.size        // returns 4
MemoryLayout<Float>.alignment   // returns 4
MemoryLayout<Float>.stride      // returns 4

MemoryLayout<Double>.size       // returns 8
MemoryLayout<Double>.alignment  // returns 8
MemoryLayout<Double>.stride     // returns 8

```

`MemoryLayout<Type>` æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶è¯„ä¼°çš„æ³›å‹ç±»å‹ã€‚å®ƒç”¨äºç¡®å®šæŒ‡å®š `Type` çš„å¤§å°ï¼ˆsizeï¼‰ã€å¯¹é½æ–¹å¼ï¼ˆalignmentï¼‰å’Œæ­¥é•¿ï¼ˆstrideï¼‰ï¼Œå¹¶è¿”å›ä»¥å­—èŠ‚ä¸ºå•ä½çš„å€¼ã€‚

ä¾‹å¦‚ï¼Œ`Int16` çš„å¤§å°ä¸º 2 ä¸ªå­—èŠ‚ï¼Œå¯¹é½æ–¹å¼ä¹Ÿæ˜¯ 2ã€‚è¿™æ„å‘³ç€å®ƒå¿…é¡»ä»å¶æ•°åœ°å€å¼€å§‹â€”â€”å³åœ°å€å¯ä»¥è¢« 2 æ•´é™¤ã€‚

ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨åœ°å€ 100 åˆ†é…ä¸€ä¸ª `Int16`ï¼Œä½†ä¸èƒ½åœ¨åœ°å€ 101 åˆ†é…â€”â€”å¥‡æ•°åœ°å€è¿åäº†æ‰€éœ€çš„å¯¹é½è¦æ±‚ã€‚

å½“ä½ å°†ä¸€å † `Int16` æ‰“åŒ…åœ¨ä¸€èµ·æ—¶ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æ­¥é•¿ï¼ˆstrideï¼‰çš„é—´éš”æ’åˆ—ã€‚å¯¹äºè¿™äº›åŸºæœ¬ç±»å‹ï¼Œæ­¥é•¿ä¸å¤§å°æ˜¯ç›¸åŒçš„ã€‚

### æ£€æŸ¥ç»“æ„ä½“çš„å†…å­˜å¸ƒå±€  
æ¥ä¸‹æ¥ï¼Œé€šè¿‡å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Playground ä¸­ï¼ŒæŸ¥çœ‹ä¸€äº›ç”¨æˆ·å®šä¹‰çš„ç»“æ„ä½“`user-defined struct`çš„å†…å­˜å¸ƒå±€ï¼š

``` swift
struct EmptyStruct {}

MemoryLayout<EmptyStruct>.size      // returns 0
MemoryLayout<EmptyStruct>.alignment // returns 1
MemoryLayout<EmptyStruct>.stride    // returns 1

struct SampleStruct {
  let number: UInt32
  let flag: Bool
}

MemoryLayout<SampleStruct>.size       // returns 5
MemoryLayout<SampleStruct>.alignment  // returns 4
MemoryLayout<SampleStruct>.stride     // returns 8

```

ç©ºç»“æ„ä½“çš„å¤§å°ä¸ºé›¶ã€‚ç”±äºå¯¹é½æ–¹å¼ä¸º 1ï¼Œå®ƒå¯ä»¥å­˜åœ¨äºä»»ä½•åœ°å€ï¼Œå› ä¸ºæ‰€æœ‰æ•°å­—éƒ½å¯ä»¥è¢« 1 æ•´é™¤ã€‚

æœ‰è¶£çš„æ˜¯ï¼Œæ­¥é•¿ï¼ˆ`stride`ï¼‰ä¸º 1ã€‚è¿™æ˜¯å› ä¸ºå³ä½¿ `EmptyStruct` çš„å¤§å°ä¸ºé›¶ï¼Œä½ åˆ›å»ºçš„æ¯ä¸ª `EmptyStruct` éƒ½å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜åœ°å€ã€‚

å¯¹äº `SampleStruct`ï¼Œå…¶å¤§å°ä¸º 5ï¼Œä½†æ­¥é•¿ä¸º 8ã€‚è¿™æ˜¯å› ä¸ºå®ƒçš„å¯¹é½è¦æ±‚å®ƒå¿…é¡»ä½äº 4 å­—èŠ‚çš„è¾¹ç•Œä¸Šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒSwift èƒ½åšåˆ°çš„æœ€ä½³æ‰“åŒ…é—´éš”æ˜¯ 8 ä¸ªå­—èŠ‚ã€‚

ä¸ºäº†æŸ¥çœ‹ç±»ï¼ˆclassï¼‰å’Œç»“æ„ä½“ï¼ˆstructï¼‰åœ¨å†…å­˜å¸ƒå±€ä¸Šçš„åŒºåˆ«ï¼Œè¯·æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

``` swift
class EmptyClass {}

MemoryLayout<EmptyClass>.size      // returns 8 (on 64-bit)
MemoryLayout<EmptyClass>.stride    // returns 8 (on 64-bit)
MemoryLayout<EmptyClass>.alignment // returns 8 (on 64-bit)

class SampleClass {
  let number: Int64 = 0
  let flag = false
}

MemoryLayout<SampleClass>.size      // returns 8 (on 64-bit)
MemoryLayout<SampleClass>.stride    // returns 8 (on 64-bit)
MemoryLayout<SampleClass>.alignment // returns 8 (on 64-bit)

```

ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå› æ­¤ `MemoryLayout` æŠ¥å‘Šçš„æ˜¯å¼•ç”¨çš„å¤§å°ï¼š8 ä¸ªå­—èŠ‚ã€‚

å¦‚æœä½ æƒ³æ›´è¯¦ç»†åœ°æ¢ç´¢å†…å­˜å¸ƒå±€ï¼Œå¯ä»¥æŸ¥çœ‹ Mike Ash çš„ç²¾å½©æ¼”è®²ï¼š[Exploring Swift Memory Layout](https://mikeash.com/pyblog/friday-qa-2014-07-18-exploring-swift-memory-layout.html)ã€‚

### Using Pointers in Unsafe Swiftåœ¨ä¸å®‰å…¨çš„ Swift ä¸­ä½¿ç”¨æŒ‡é’ˆ   

æŒ‡é’ˆå°è£…äº†ä¸€ä¸ªå†…å­˜åœ°å€ã€‚

æ¶‰åŠç›´æ¥å†…å­˜è®¿é—®çš„ç±»å‹ä¼šå¸¦æœ‰ `unsafe` å‰ç¼€ï¼Œå› æ­¤æŒ‡é’ˆç±»å‹çš„åç§°ä¸º `UnsafePointer`ã€‚

é¢å¤–çš„è¾“å…¥å¯èƒ½çœ‹èµ·æ¥æœ‰äº›çƒ¦äººï¼Œä½†å®ƒæé†’ä½ æ­£åœ¨è®¿é—®ç¼–è¯‘å™¨æœªæ£€æŸ¥çš„å†…å­˜ã€‚å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå¯é¢„æµ‹çš„å´©æºƒã€‚

Swift å¹¶ä¸åƒ C è¯­è¨€ä¸­çš„ `char *` é‚£æ ·ï¼Œåªæä¾›ä¸€ç§éç»“æ„åŒ–çš„ `UnsafePointer` ç±»å‹æ¥è®¿é—®å†…å­˜ã€‚Swift æä¾›äº†è¿‘åç§æŒ‡é’ˆç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰ä¸åŒçš„åŠŸèƒ½å’Œç”¨é€”ã€‚

ä½ åº”è¯¥å§‹ç»ˆæ ¹æ®éœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„æŒ‡é’ˆç±»å‹ã€‚è¿™ä¸ä»…èƒ½æ›´å¥½åœ°è¡¨è¾¾æ„å›¾ï¼Œè¿˜èƒ½å‡å°‘é”™è¯¯å¹¶é¿å…æœªå®šä¹‰è¡Œä¸ºã€‚

ä¸å®‰å…¨çš„ Swift æŒ‡é’ˆä½¿ç”¨ä¸€ç§å¯é¢„æµ‹çš„å‘½åæ–¹æ¡ˆæ¥æè¿°æŒ‡é’ˆçš„ç‰¹æ€§ï¼šå¯å˜çš„ï¼ˆmutableï¼‰æˆ–ä¸å¯å˜çš„ï¼ˆimmutableï¼‰ã€åŸå§‹çš„ï¼ˆrawï¼‰æˆ–ç±»å‹åŒ–çš„ï¼ˆtypedï¼‰ã€ç¼“å†²åŒºé£æ ¼ï¼ˆbuffer styleï¼‰æˆ–éç¼“å†²åŒºé£æ ¼ã€‚æ€»å…±æœ‰å…«ç§æŒ‡é’ˆç»„åˆã€‚ä½ å°†åœ¨æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­äº†è§£æ›´å¤šå…³äºå®ƒä»¬çš„å†…å®¹ã€‚

![](/assets/images/20250222UnsafeSwift/pointers1.webp)

### Using Raw Pointers ä½¿ç”¨åŸå§‹æŒ‡é’ˆ  

åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†ä½¿ç”¨ä¸å®‰å…¨çš„ Swift æŒ‡é’ˆæ¥å­˜å‚¨å’ŒåŠ è½½ä¸¤ä¸ªæ•´æ•°ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
// 1
let count = 2
let stride = MemoryLayout<Int>.stride
let alignment = MemoryLayout<Int>.alignment
let byteCount = stride * count

// 2
do {
  print("Raw pointers")
  
  // 3
  let pointer = UnsafeMutableRawPointer.allocate(
    byteCount: byteCount,
    alignment: alignment)
  // 4
  defer {
    pointer.deallocate()
  }
  
  // 5
  pointer.storeBytes(of: 42, as: Int.self)
  pointer.advanced(by: stride).storeBytes(of: 6, as: Int.self)
  pointer.load(as: Int.self)
  pointer.advanced(by: stride).load(as: Int.self)
  
  // 6
  let bufferPointer = UnsafeRawBufferPointer(start: pointer, count: byteCount)
  for (index, byte) in bufferPointer.enumerated() {
    print("byte \(index): \(byte)")
  }
}

```

ä»¥ä¸‹æ˜¯ä»£ç çš„è¯¦ç»†è¯´æ˜ï¼š

* 1.è¿™äº›å¸¸é‡ä¿å­˜äº†å¸¸ç”¨çš„å€¼ï¼š
	- `count` ä¿å­˜è¦å­˜å‚¨çš„æ•´æ•°çš„æ•°é‡ã€‚
	- `stride` ä¿å­˜ `Int` ç±»å‹çš„æ­¥é•¿ï¼ˆstrideï¼‰ã€‚
	- `alignment` ä¿å­˜ `Int` ç±»å‹çš„å¯¹é½æ–¹å¼ã€‚
	- `byteCount` ä¿å­˜æ‰€éœ€çš„æ€»å­—èŠ‚æ•°ã€‚  

* 2.ä¸€ä¸ª `do` å—æ·»åŠ äº†ä¸€ä¸ªä½œç”¨åŸŸçº§åˆ«ï¼Œè¿™æ ·ä½ å¯ä»¥åœ¨æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¸­é‡ç”¨å˜é‡åã€‚

* 3.`UnsafeMutableRawPointer.allocate` åˆ†é…æ‰€éœ€çš„å­—èŠ‚ã€‚æ­¤æ–¹æ³•è¿”å›ä¸€ä¸ª `UnsafeMutableRawPointer`ã€‚è¯¥ç±»å‹çš„åç§°å‘Šè¯‰ä½ ï¼Œè¯¥æŒ‡é’ˆå¯ä»¥åŠ è½½å’Œå­˜å‚¨ï¼ˆæˆ–ä¿®æ”¹ï¼‰åŸå§‹å­—èŠ‚ã€‚

* 4.`defer` å—ç¡®ä¿ä½ æ­£ç¡®åœ°é‡Šæ”¾æŒ‡é’ˆã€‚ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰åœ¨è¿™é‡Œä¸ä¼šå¸®åŠ©ä½ â€”â€”ä½ éœ€è¦è‡ªå·±ç®¡ç†å†…å­˜ï¼ä½ å¯ä»¥åœ¨ [å®˜æ–¹ Swift æ–‡æ¡£](https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html#ID514) ä¸­é˜…è¯»æ›´å¤šå…³äº `defer` è¯­å¥çš„å†…å®¹ã€‚

* 5.`storeBytes` å’Œ `load` æ–¹æ³•ç”¨äºå­˜å‚¨å’ŒåŠ è½½å­—èŠ‚ã€‚ä½ å¯ä»¥é€šè¿‡å°†æŒ‡é’ˆå‰è¿› `stride` ä¸ªå­—èŠ‚æ¥è®¡ç®—ç¬¬äºŒä¸ªæ•´æ•°çš„å†…å­˜åœ°å€ã€‚ç”±äºæŒ‡é’ˆæ˜¯ `Strideable` çš„ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æŒ‡é’ˆç®—æœ¯ï¼Œä¾‹å¦‚ï¼š`(pointer+stride).storeBytes(of: 6, as: Int.self)`ã€‚

* 6.`UnsafeRawBufferPointer` å…è®¸ä½ å°†å†…å­˜è§†ä¸ºå­—èŠ‚é›†åˆæ¥è®¿é—®ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥è¿­ä»£å­—èŠ‚å¹¶ä½¿ç”¨ä¸‹æ ‡è®¿é—®å®ƒä»¬ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨åƒ `filter`ã€`map` å’Œ `reduce` è¿™æ ·çš„æ–¹æ³•ã€‚ä½ å¯ä»¥ä½¿ç”¨åŸå§‹æŒ‡é’ˆåˆå§‹åŒ–ç¼“å†²åŒºæŒ‡é’ˆã€‚

å°½ç®¡ `UnsafeRawBufferPointer` æ˜¯ä¸å®‰å…¨çš„ï¼Œä½†ä½ ä»ç„¶å¯ä»¥é€šè¿‡å°†å…¶çº¦æŸä¸ºç‰¹å®šç±»å‹æ¥ä½¿å…¶æ›´å®‰å…¨ã€‚

### Using Typed Pointers ä½¿ç”¨ç±»å‹åŒ–çš„æŒ‡é’ˆ

ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ç±»å‹åŒ–æŒ‡é’ˆæ¥ç®€åŒ–å‰é¢çš„ç¤ºä¾‹ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
do {
  print("Typed pointers")
  
  let pointer = UnsafeMutablePointer<Int>.allocate(capacity: count)
  pointer.initialize(repeating: 0, count: count)
  defer {
    pointer.deinitialize(count: count)
    pointer.deallocate()
  }
  
  pointer.pointee = 42
  pointer.advanced(by: 1).pointee = 6
  pointer.pointee
  pointer.advanced(by: 1).pointee
  
  let bufferPointer = UnsafeBufferPointer(start: pointer, count: count)
  for (index, value) in bufferPointer.enumerated() {
    print("value \(index): \(value)")
  }
}

```

æ³¨æ„ä»¥ä¸‹åŒºåˆ«ï¼š

1. ä½ ä½¿ç”¨ `UnsafeMutablePointer.allocate` åˆ†é…å†…å­˜ã€‚æ³›å‹å‚æ•°è®© Swift çŸ¥é“ä½ å°†ä½¿ç”¨è¯¥æŒ‡é’ˆæ¥åŠ è½½å’Œå­˜å‚¨ `Int` ç±»å‹çš„å€¼ã€‚
2. åœ¨ä½¿ç”¨ç±»å‹åŒ–å†…å­˜ä¹‹å‰ï¼Œå¿…é¡»å…ˆåˆå§‹åŒ–å®ƒï¼Œå¹¶åœ¨ä½¿ç”¨åååˆå§‹åŒ–å®ƒã€‚ä½ å¯ä»¥åˆ†åˆ«ä½¿ç”¨ `initialize` å’Œ `deinitialize` æ–¹æ³•æ¥å®Œæˆè¿™äº›æ“ä½œã€‚ååˆå§‹åŒ–ä»…å¯¹éå¹³å‡¡ç±»å‹ï¼ˆnon-trivial typesï¼‰æ˜¯å¿…éœ€çš„ã€‚ç„¶è€Œï¼ŒåŒ…å«ååˆå§‹åŒ–æ“ä½œæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œå¯ä»¥ç¡®ä¿ä»£ç åœ¨æœªæ¥åˆ‡æ¢åˆ°éå¹³å‡¡ç±»å‹æ—¶ä»ç„¶æœ‰æ•ˆã€‚é€šå¸¸è¿™ä¸ä¼šå¸¦æ¥ä»»ä½•å¼€é”€ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šå°†å…¶ä¼˜åŒ–æ‰ã€‚
3. ç±»å‹åŒ–æŒ‡é’ˆæœ‰ä¸€ä¸ª `pointee` å±æ€§ï¼Œå®ƒæä¾›äº†ä¸€ç§ç±»å‹å®‰å…¨çš„æ–¹å¼æ¥åŠ è½½å’Œå­˜å‚¨å€¼ã€‚
4. å½“æ¨è¿›ç±»å‹åŒ–æŒ‡é’ˆæ—¶ï¼Œä½ å¯ä»¥ç®€å•åœ°æŒ‡å®šä½ æƒ³è¦æ¨è¿›çš„å€¼çš„æ•°é‡ã€‚æŒ‡é’ˆå¯ä»¥æ ¹æ®å®ƒæŒ‡å‘çš„å€¼çš„ç±»å‹è®¡ç®—å‡ºæ­£ç¡®çš„æ­¥é•¿ï¼ˆstrideï¼‰ã€‚åŒæ ·ï¼ŒæŒ‡é’ˆç®—æœ¯ä¹Ÿé€‚ç”¨ã€‚ä½ ä¹Ÿå¯ä»¥å†™æˆ `(pointer+1).pointee = 6`ã€‚
5. å¯¹äºç±»å‹åŒ–çš„ç¼“å†²åŒºæŒ‡é’ˆä¹Ÿæ˜¯å¦‚æ­¤ï¼šå®ƒä»¬è¿­ä»£çš„æ˜¯å€¼è€Œä¸æ˜¯å­—èŠ‚ã€‚

æ¥ä¸‹æ¥ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä»æ— çº¦æŸçš„ `UnsafeRawBufferPointer` è½¬æ¢ä¸ºæ›´å®‰å…¨çš„ã€ç±»å‹çº¦æŸçš„ `UnsafeRawBufferPointer`ã€‚

### Converting Raw Pointers to Typed Pointersè½¬æ¢åŸå§‹æŒ‡é’ˆç±»å‹åˆ°ç±»å‹åŒ–çš„æŒ‡é’ˆ

ä½ å¹¶ä¸æ€»æ˜¯éœ€è¦ç›´æ¥åˆå§‹åŒ–ç±»å‹åŒ–æŒ‡é’ˆã€‚ä½ ä¹Ÿå¯ä»¥ä»åŸå§‹æŒ‡é’ˆä¸­æ´¾ç”Ÿå‡ºå®ƒä»¬ã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
do {
  print("Converting raw pointers to typed pointers")
  
  let rawPointer = UnsafeMutableRawPointer.allocate(
    byteCount: byteCount,
    alignment: alignment)
  defer {
    rawPointer.deallocate()
  }
  
  let typedPointer = rawPointer.bindMemory(to: Int.self, capacity: count)
  typedPointer.initialize(repeating: 0, count: count)
  defer {
    typedPointer.deinitialize(count: count)
  }

  typedPointer.pointee = 42
  typedPointer.advanced(by: 1).pointee = 6
  typedPointer.pointee
  typedPointer.advanced(by: 1).pointee
  
  let bufferPointer = UnsafeBufferPointer(start: typedPointer, count: count)
  for (index, value) in bufferPointer.enumerated() {
    print("value \(index): \(value)")
  }
}

```

è¿™ä¸ªç¤ºä¾‹ä¸ä¹‹å‰çš„ç¤ºä¾‹ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªåŸå§‹æŒ‡é’ˆã€‚ä½ é€šè¿‡å°†å†…å­˜ç»‘å®šåˆ°æ‰€éœ€çš„ç±»å‹ `Int` æ¥åˆ›å»ºç±»å‹åŒ–æŒ‡é’ˆã€‚

é€šè¿‡ç»‘å®šå†…å­˜ï¼Œä½ å¯ä»¥ä»¥ç±»å‹å®‰å…¨çš„æ–¹å¼è®¿é—®å®ƒã€‚å½“ä½ åˆ›å»ºç±»å‹åŒ–æŒ‡é’ˆæ—¶ï¼Œå†…å­˜ç»‘å®šä¼šåœ¨å¹•åè¿›è¡Œã€‚

è¿™ä¸ªç¤ºä¾‹çš„å…¶ä½™éƒ¨åˆ†ä¹Ÿä¸ä¹‹å‰çš„ç¤ºä¾‹ç›¸åŒã€‚ä¸€æ—¦ä½ è¿›å…¥ç±»å‹åŒ–æŒ‡é’ˆçš„é¢†åŸŸï¼Œå°±å¯ä»¥ä½¿ç”¨ `pointee` ç­‰ç‰¹æ€§ã€‚

### è·å–å®ä¾‹çš„å­—èŠ‚  
é€šå¸¸ï¼Œä½ å·²ç»æœ‰ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œå¹¶ä¸”æƒ³è¦æ£€æŸ¥æ„æˆå®ƒçš„å­—èŠ‚ã€‚ä½ å¯ä»¥ä½¿ç”¨ `withUnsafeBytes(of:)` æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

ä¸ºæ­¤ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
do {
  print("Getting the bytes of an instance")
  
  var sampleStruct = SampleStruct(number: 25, flag: true)

  withUnsafeBytes(of: &sampleStruct) { bytes in
    for byte in bytes {
      print(byte)
    }
  }
}

```

è¿™ä¼šæ‰“å°å‡º `SampleStruct` å®ä¾‹çš„åŸå§‹å­—èŠ‚ã€‚

`withUnsafeBytes(of:)` å…è®¸ä½ è®¿é—®ä¸€ä¸ª `UnsafeRawBufferPointer`ï¼Œä½ å¯ä»¥åœ¨é—­åŒ…ä¸­ä½¿ç”¨å®ƒã€‚

`withUnsafeBytes` ä¹Ÿå¯ä»¥ä½œä¸º `Array` å’Œ `Data` çš„å®ä¾‹æ–¹æ³•ä½¿ç”¨ã€‚

### Computing a Checksumè®¡ç®—æ ¡éªŒå’Œ  

ä½¿ç”¨ `withUnsafeBytes(of:)`ï¼Œä½ å¯ä»¥è¿”å›ä¸€ä¸ªç»“æœã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¡ç®—ç»“æ„ä¸­å­—èŠ‚çš„ 32 ä½æ ¡éªŒå’Œã€‚

å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°ä½ çš„ Playground ä¸­ï¼š

``` swift
do {
  print("Checksum the bytes of a struct")
  
  var sampleStruct = SampleStruct(number: 25, flag: true)
  
  let checksum = withUnsafeBytes(of: &sampleStruct) { (bytes) -> UInt32 in
    return ~bytes.reduce(UInt32(0)) { $0 + numericCast($1) }
  }
  
  print("checksum", checksum) // prints checksum 4294967269
}

```

`reduce` è°ƒç”¨å°†å­—èŠ‚ç›¸åŠ ï¼Œç„¶å `~` ç¿»è½¬ä½ã€‚è™½ç„¶è¿™ä¸æ˜¯æœ€å¼ºå¤§çš„é”™è¯¯æ£€æµ‹æ–¹æ³•ï¼Œä½†å®ƒå±•ç¤ºäº†è¿™ä¸ªæ¦‚å¿µã€‚

ç°åœ¨ä½ å·²ç»äº†è§£äº†å¦‚ä½•ä½¿ç”¨ä¸å®‰å…¨çš„ Swiftï¼Œæ¥ä¸‹æ¥æ˜¯æ—¶å€™å­¦ä¹ ä¸€äº›ä½ ç»å¯¹ä¸åº”è¯¥ç”¨å®ƒåšçš„äº‹æƒ…äº†ã€‚


### ä¸å®‰å…¨ä»£ç çš„ä¸‰æ¡è§„åˆ™  
åœ¨ç¼–å†™ä¸å®‰å…¨ä»£ç æ—¶ï¼ŒåŠ¡å¿…å°å¿ƒé¿å…æœªå®šä¹‰è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›é”™è¯¯ä»£ç çš„ç¤ºä¾‹ï¼š

#### ä¸è¦ä» `withUnsafeBytes` è¿”å›æŒ‡é’ˆï¼

``` swift
// Rule #1
do {
  print("1. Don't return the pointer from withUnsafeBytes!")
  
  var sampleStruct = SampleStruct(number: 25, flag: true)
  
  let bytes = withUnsafeBytes(of: &sampleStruct) { bytes in
    return bytes // strange bugs here we come â˜ ï¸â˜ ï¸â˜ ï¸
  }
  
  print("Horse is out of the barn!", bytes) // undefined!!!
}

```

ä½ ç»ä¸åº”è¯¥è®©æŒ‡é’ˆé€ƒé€¸å‡º `withUnsafeBytes(of:)` é—­åŒ…ã€‚å³ä½¿ä½ çš„ä»£ç ç°åœ¨å¯ä»¥è¿è¡Œï¼Œæœªæ¥ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´å¥‡æ€ªçš„é”™è¯¯ã€‚


#### ä¸€æ¬¡åªç»‘å®šä¸€ç§ç±»å‹ï¼

``` swift
// Rule #2
do {
  print("2. Only bind to one type at a time!")
  
  let count = 3
  let stride = MemoryLayout<Int16>.stride
  let alignment = MemoryLayout<Int16>.alignment
  let byteCount = count * stride
  
  let pointer = UnsafeMutableRawPointer.allocate(
    byteCount: byteCount,
    alignment: alignment)
  
  let typedPointer1 = pointer.bindMemory(to: UInt16.self, capacity: count)
  
  // Breakin' the Law... Breakin' the Law (Undefined behavior)
  let typedPointer2 = pointer.bindMemory(to: Bool.self, capacity: count * 2)
  
  // If you must, do it this way:
  typedPointer1.withMemoryRebound(to: Bool.self, capacity: count * 2) {
    (boolPointer: UnsafeMutablePointer<Bool>) in
    print(boolPointer.pointee) // See Rule #1, don't return the pointer
  }
}

```

æ°¸è¿œä¸è¦å°†å†…å­˜åŒæ—¶ç»‘å®šåˆ°ä¸¤ç§ä¸ç›¸å…³çš„ç±»å‹ã€‚è¿™è¢«ç§°ä¸º **ç±»å‹åŒå…³ï¼ˆType Punningï¼‰**ï¼Œè€Œ Swift ä¸å–œæ¬¢åŒå…³ã€‚:]

ç›¸åï¼Œå¯ä»¥ä½¿ç”¨ `withMemoryRebound(to:capacity:)` ç­‰æ–¹æ³•ä¸´æ—¶é‡æ–°ç»‘å®šå†…å­˜ã€‚

æ­¤å¤–ï¼Œä»å¹³å‡¡ç±»å‹ï¼ˆå¦‚ `Int`ï¼‰é‡æ–°ç»‘å®šåˆ°éå¹³å‡¡ç±»å‹ï¼ˆå¦‚ç±»ï¼‰æ˜¯éæ³•çš„ã€‚ä¸è¦è¿™æ ·åšã€‚


#### ä¸è¦è¶Šç•Œâ€¦â€¦å“å‘€ï¼

``` swift
// Rule #3... wait
do {
  print("3. Don't walk off the end... whoops!")
  
  let count = 3
  let stride = MemoryLayout<Int16>.stride
  let alignment = MemoryLayout<Int16>.alignment
  let byteCount =  count * stride
  
  let pointer = UnsafeMutableRawPointer.allocate(
    byteCount: byteCount,
    alignment: alignment)
  let bufferPointer = UnsafeRawBufferPointer(start: pointer, count: byteCount + 1) 
  // OMG +1????
  
  for byte in bufferPointer {
    print(byte) // pawing through memory like an animal
  }
}

```

åœ¨ç¼–å†™ä¸å®‰å…¨ä»£ç æ—¶ï¼Œ**è¶Šç•Œé”™è¯¯**ï¼ˆoff-by-one errorsï¼‰çš„é—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ã€‚åŠ¡å¿…å°å¿ƒï¼Œä»”ç»†æ£€æŸ¥å¹¶æµ‹è¯•ä½ çš„ä»£ç ï¼


### ä¸å®‰å…¨çš„ Swift ç¤ºä¾‹ 1ï¼šå‹ç¼©  
æ˜¯æ—¶å€™è¿ç”¨ä½ æ‰€å­¦åˆ°çš„çŸ¥è¯†æ¥å°è£…ä¸€ä¸ª C API äº†ã€‚Cocoa åŒ…å«ä¸€ä¸ªå®ç°äº†å¸¸è§æ•°æ®å‹ç¼©ç®—æ³•çš„ C æ¨¡å—ã€‚è¿™äº›ç®—æ³•åŒ…æ‹¬ï¼š

- **LZ4**ï¼šé€‚ç”¨äºé€Ÿåº¦è‡³å…³é‡è¦çš„æƒ…å†µã€‚
- **LZ4A**ï¼šé€‚ç”¨äºéœ€è¦æœ€é«˜å‹ç¼©æ¯”ä¸”ä¸å…³å¿ƒé€Ÿåº¦çš„æƒ…å†µã€‚
- **ZLIB**ï¼šåœ¨ç©ºé—´å’Œé€Ÿåº¦ä¹‹é—´å–å¾—å¹³è¡¡ã€‚
- **LZFSE**ï¼šæ–°çš„å¼€æºç®—æ³•ï¼Œåœ¨ç©ºé—´å’Œé€Ÿåº¦ä¹‹é—´å–å¾—äº†æ›´å¥½çš„å¹³è¡¡ã€‚

ç°åœ¨ï¼Œæ‰“å¼€åˆå§‹é¡¹ç›®ä¸­çš„ **Compression** Playgroundã€‚

é¦–å…ˆï¼Œä½ å°†ä½¿ç”¨ `Data` å®šä¹‰ä¸€ä¸ªçº¯ Swift APIï¼Œå°† Playground çš„å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

``` swift
import Foundation
import Compression

enum CompressionAlgorithm {
  case lz4   // speed is critical
  case lz4a  // space is critical
  case zlib  // reasonable speed and space
  case lzfse // better speed and space
}

enum CompressionOperation {
  case compression, decompression
}

/// return compressed or uncompressed data depending on the operation
func perform(
  _ operation: CompressionOperation,
  on input: Data,
  using algorithm: CompressionAlgorithm,
  workingBufferSize: Int = 2000) 
    -> Data?  {
  return nil
}

```

æ‰§è¡Œå‹ç¼©å’Œè§£å‹ç¼©çš„å‡½æ•°æ˜¯ `perform`ï¼Œç›®å‰å®ƒè¢«å­˜æ ¹åŒ–ï¼ˆstubbed outï¼‰å¹¶è¿”å› `nil`ã€‚ç¨åä½ å°†ä¸ºå…¶æ·»åŠ ä¸€äº›ä¸å®‰å…¨çš„ä»£ç ã€‚

æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Playground çš„æœ«å°¾ï¼š

``` swift
/// Compressed keeps the compressed data and the algorithm
/// together as one unit, so you never forget how the data was
/// compressed.
struct Compressed {
  let data: Data
  let algorithm: CompressionAlgorithm
  
  init(data: Data, algorithm: CompressionAlgorithm) {
    self.data = data
    self.algorithm = algorithm
  }
  
  /// Compresses the input with the specified algorithm. Returns nil if it fails.
  static func compress(
    input: Data,with algorithm: CompressionAlgorithm) 
      -> Compressed? {
    guard let data = perform(.compression, on: input, using: algorithm) else {
      return nil
    }
    return Compressed(data: data, algorithm: algorithm)
  }
  
  /// Uncompressed data. Returns nil if the data cannot be decompressed.
 func decompressed() -> Data? {
    return perform(.decompression, on: data, using: algorithm)
  }
}

```

`Compressed` ç»“æ„ä½“å­˜å‚¨äº†å‹ç¼©åçš„æ•°æ®ä»¥åŠç”¨äºåˆ›å»ºå®ƒçš„ç®—æ³•ã€‚è¿™ä½¿å¾—åœ¨å†³å®šä½¿ç”¨å“ªç§è§£å‹ç¼©ç®—æ³•æ—¶ï¼Œä»£ç æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚

æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ° Playground çš„æœ«å°¾ï¼š

``` swift
/// For discoverability, adds a compressed method to Data
extension Data {
  /// Returns compressed data or nil if compression fails.
  func compressed(with algorithm: CompressionAlgorithm) -> Compressed? {
    return Compressed.compress(input: self, with: algorithm)
  }
}

// Example usage:

let input = Data(Array(repeating: UInt8(123), count: 10000))

let compressed = input.compressed(with: .lzfse)
compressed?.data.count // in most cases much less than original input count

let restoredInput = compressed?.decompressed()
input == restoredInput // true

```

ä¸»è¦çš„å…¥å£ç‚¹æ˜¯ `Data` ç±»å‹çš„æ‰©å±•ã€‚ä½ æ·»åŠ äº†ä¸€ä¸ªåä¸º `compressed(with:)` çš„æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯é€‰çš„ `Compressed` ç»“æ„ä½“ã€‚è¯¥æ–¹æ³•ç®€å•åœ°è°ƒç”¨äº† `Compressed` ä¸Šçš„é™æ€æ–¹æ³• `compress(input:with:)`ã€‚

æœ€åæœ‰ä¸€ä¸ªç¤ºä¾‹ï¼Œä½†ç›®å‰å®ƒè¿˜ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚æ˜¯æ—¶å€™ä¿®å¤å®ƒäº†ï¼

æ»šåŠ¨åˆ°ä½ è¾“å…¥çš„ç¬¬ä¸€ä¸ªä»£ç å—ï¼Œå¹¶å¼€å§‹å®ç° `perform(_:on:using:workingBufferSize:)`ï¼Œåœ¨ `return nil` ä¹‹å‰æ’å…¥ä»¥ä¸‹ä»£ç ï¼š

``` swift
// set the algorithm
let streamAlgorithm: compression_algorithm
switch algorithm {
case .lz4:   streamAlgorithm = COMPRESSION_LZ4
case .lz4a:  streamAlgorithm = COMPRESSION_LZMA
case .zlib:  streamAlgorithm = COMPRESSION_ZLIB
case .lzfse: streamAlgorithm = COMPRESSION_LZFSE
}
  
// set the stream operation and flags
let streamOperation: compression_stream_operation
let flags: Int32
switch operation {
case .compression:
  streamOperation = COMPRESSION_STREAM_ENCODE
  flags = Int32(COMPRESSION_STREAM_FINALIZE.rawValue)
case .decompression:
  streamOperation = COMPRESSION_STREAM_DECODE
  flags = 0
}

```

è¿™å°†ä½ çš„ Swift ç±»å‹è½¬æ¢ä¸ºå‹ç¼©ç®—æ³•æ‰€éœ€çš„ C ç±»å‹ã€‚

æ¥ä¸‹æ¥ï¼Œå°† `return nil` æ›¿æ¢ä¸ºï¼š

``` swift
// 1: create a stream
var streamPointer = UnsafeMutablePointer<compression_stream>.allocate(capacity: 1)
defer {
  streamPointer.deallocate()
}

// 2: initialize the stream
var stream = streamPointer.pointee
var status = compression_stream_init(&stream, streamOperation, streamAlgorithm)
guard status != COMPRESSION_STATUS_ERROR else {
  return nil
}
defer {
  compression_stream_destroy(&stream)
}

// 3: set up a destination buffer
let dstSize = workingBufferSize
let dstPointer = UnsafeMutablePointer<UInt8>.allocate(capacity: dstSize)
defer {
  dstPointer.deallocate()
}

return nil // To be continued

```

ä»¥ä¸‹æ˜¯æ­£åœ¨å‘ç”Ÿçš„äº‹æƒ…ï¼š

ç¼–è¯‘å™¨åœ¨è¿™é‡Œåšäº†ä¸€äº›ç‰¹æ®Šçš„äº‹æƒ…ï¼šå®ƒä½¿ç”¨äº† `in-out` çš„ `&` æ ‡è®°ï¼Œå°†ä½ çš„ `compression_stream` è½¬æ¢ä¸ºä¸€ä¸ª `UnsafeMutablePointer<compression_stream>` ç±»å‹ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’ `streamPointer`ï¼Œè¿™æ ·å°±ä¸éœ€è¦è¿™ç§ç‰¹æ®Šçš„è½¬æ¢äº†ã€‚

åˆ†é…ä¸€ä¸ª `compression_stream` å¹¶ä½¿ç”¨ `defer` å—å®‰æ’å…¶é‡Šæ”¾ã€‚
ç„¶åï¼Œé€šè¿‡ `pointee` å±æ€§è·å–æµï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ `compression_stream_init` å‡½æ•°ã€‚

ç¼–è¯‘å™¨åœ¨è¿™é‡Œåšäº†ä¸€äº›ç‰¹æ®Šçš„äº‹æƒ…ï¼šå®ƒä½¿ç”¨äº† `in-out` çš„ `&` æ ‡è®°ï¼Œå°†ä½ çš„ `compression_stream` è½¬æ¢ä¸ºä¸€ä¸ª `UnsafeMutablePointer<compression_stream>` ç±»å‹ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä¼ é€’ `streamPointer`ï¼Œè¿™æ ·å°±ä¸éœ€è¦è¿™ç§ç‰¹æ®Šçš„è½¬æ¢äº†ã€‚

æœ€åï¼Œåˆ›å»ºä¸€ä¸ªç›®æ ‡ç¼“å†²åŒºä½œä¸ºä½ çš„å·¥ä½œç¼“å†²åŒºã€‚
æ¥ä¸‹æ¥ï¼Œé€šè¿‡å°†æœ€ç»ˆçš„ `return nil` æ›¿æ¢ä¸ºï¼š

``` swift
// process the input
return input.withUnsafeBytes { srcRawBufferPointer in
  // 1
  var output = Data()
  
  // 2
  let srcBufferPointer = srcRawBufferPointer.bindMemory(to: UInt8.self)
  guard let srcPointer = srcBufferPointer.baseAddress else {
    return nil
  }
  stream.src_ptr = srcPointer
  stream.src_size = input.count
  stream.dst_ptr = dstPointer
  stream.dst_size = dstSize
  
  // 3
  while status == COMPRESSION_STATUS_OK {
    // process the stream
    status = compression_stream_process(&stream, flags)
    
    // collect bytes from the stream and reset
    switch status {
      
    case COMPRESSION_STATUS_OK:
      // 4
      output.append(dstPointer, count: dstSize)
      stream.dst_ptr = dstPointer
      stream.dst_size = dstSize
      
    case COMPRESSION_STATUS_ERROR:
      return nil
      
    case COMPRESSION_STATUS_END:
      // 5
      output.append(dstPointer, count: stream.dst_ptr - dstPointer)
      
    default:
      fatalError()
    }
  }
  return output
}

```

è¿™æ˜¯çœŸæ­£æ‰§è¡Œå·¥ä½œçš„åœ°æ–¹ã€‚ä»¥ä¸‹æ˜¯å®ƒçš„å…·ä½“æ“ä½œï¼š

- åˆ›å»ºä¸€ä¸ª `Data` å¯¹è±¡ï¼Œç”¨äºå­˜æ”¾è¾“å‡ºå†…å®¹â€”â€”è¿™å¯èƒ½æ˜¯å‹ç¼©åçš„æ•°æ®ï¼Œä¹Ÿå¯èƒ½æ˜¯è§£å‹ç¼©åçš„æ•°æ®ï¼Œå…·ä½“å–å†³äºå½“å‰æ‰§è¡Œçš„æ“ä½œã€‚
- ä½¿ç”¨ä½ åˆ†é…çš„æŒ‡é’ˆåŠå…¶å¤§å°è®¾ç½®æºç¼“å†²åŒºå’Œç›®æ ‡ç¼“å†²åŒºã€‚
- åœ¨è¿™é‡Œï¼Œåªè¦ `compression_stream_process` è¿”å› `COMPRESSION_STATUS_OK`ï¼Œå°±ä¼šæŒç»­è°ƒç”¨å®ƒã€‚
- ç„¶åï¼Œå°†ç›®æ ‡ç¼“å†²åŒºçš„å†…å®¹å¤åˆ¶åˆ°è¾“å‡ºä¸­ï¼Œæœ€ç»ˆä»è¿™ä¸ªå‡½æ•°è¿”å›ã€‚
- å½“æœ€åä¸€ä¸ªæ•°æ®åŒ…åˆ°è¾¾æ—¶ï¼Œå®ƒä¼šè¢«æ ‡è®°ä¸º `COMPRESSION_STATUS_END`ï¼Œæ­¤æ—¶ä½ å¯èƒ½åªéœ€è¦å¤åˆ¶ç›®æ ‡ç¼“å†²åŒºçš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚
- åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸€ä¸ªåŒ…å« 10,000 ä¸ªå…ƒç´ çš„æ•°ç»„è¢«å‹ç¼©åˆ°äº† 153 å­—èŠ‚ã€‚æ•ˆæœè¿˜ä¸é”™ã€‚

### Unsafe Swift ç¤ºä¾‹ 2ï¼šéšæœºæ•°ç”Ÿæˆå™¨

éšæœºæ•°å¯¹äºè®¸å¤šåº”ç”¨æ¥è¯´éå¸¸é‡è¦ï¼Œä»æ¸¸æˆåˆ°æœºå™¨å­¦ä¹ éƒ½æœ‰å¹¿æ³›ç”¨é€”ã€‚

macOS æä¾›äº† `arc4random`ï¼Œå®ƒå¯ä»¥ç”Ÿæˆå¯†ç å­¦å®‰å…¨çš„éšæœºæ•°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ Linux ä¸Šä¸å¯ç”¨ã€‚æ­¤å¤–ï¼Œ`arc4random` åªèƒ½æä¾› `UInt32` ç±»å‹çš„éšæœºæ•°ã€‚ç„¶è€Œï¼Œ`/dev/urandom` æä¾›äº†ä¸€ä¸ªæ— é™çš„ã€é«˜è´¨é‡çš„éšæœºæ•°æ¥æºã€‚

åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†åˆ©ç”¨æ–°å­¦åˆ°çš„çŸ¥è¯†æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆç±»å‹å®‰å…¨çš„éšæœºæ•°ã€‚

![](/assets/images/20250222UnsafeSwift/hexdump.webp)

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Playgroundï¼Œå‘½åä¸º RandomNumbersï¼Œæˆ–è€…æ‰“å¼€é¡¹ç›®ä¸­çš„åˆå§‹ Playgroundã€‚

ç¡®ä¿è¿™æ¬¡é€‰æ‹©çš„æ˜¯ macOS å¹³å°ã€‚

å‡†å¤‡å°±ç»ªåï¼Œå°†é»˜è®¤å†…å®¹æ›¿æ¢ä¸ºï¼š

``` swift
import Foundation

enum RandomSource {
  static let file = fopen("/dev/urandom", "r")!
  static let queue = DispatchQueue(label: "random")
  
  static func get(count: Int) -> [Int8] {
    let capacity = count + 1 // fgets adds null termination
    var data = UnsafeMutablePointer<Int8>.allocate(capacity: capacity)
    defer {
      data.deallocate()
    }
    queue.sync {
      fgets(data, Int32(capacity), file)
    }
    return Array(UnsafeMutableBufferPointer(start: data, count: count))
  }
}

```

ä½ å°†æ–‡ä»¶å˜é‡å£°æ˜ä¸º `static`ï¼Œè¿™æ ·ç³»ç»Ÿä¸­å°±åªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹ã€‚ä½ å°†ä¾èµ–ç³»ç»Ÿåœ¨è¿›ç¨‹é€€å‡ºæ—¶å…³é—­å®ƒã€‚

ç”±äºå¤šä¸ªçº¿ç¨‹å¯èƒ½éœ€è¦éšæœºæ•°ï¼Œä½ éœ€è¦é€šè¿‡ä¸€ä¸ªä¸²è¡Œçš„ GCD é˜Ÿåˆ—æ¥ä¿æŠ¤å¯¹å®ƒçš„è®¿é—®ã€‚

`get` å‡½æ•°æ˜¯å®é™…æ‰§è¡Œå·¥ä½œçš„åœ°æ–¹ã€‚

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæœªåˆ†é…çš„å­˜å‚¨ç©ºé—´ï¼Œå…¶å¤§å°æ¯”ä½ éœ€è¦çš„å¤šä¸€ä¸ªï¼Œå› ä¸º `fgets` æ€»æ˜¯ä»¥ `\0`ï¼ˆç©ºå­—ç¬¦ï¼‰ç»“å°¾ã€‚

æ¥ä¸‹æ¥ï¼Œåœ¨ GCD é˜Ÿåˆ—ä¸­æ“ä½œï¼Œä»æ–‡ä»¶ä¸­è·å–æ•°æ®ã€‚

æœ€åï¼Œé€šè¿‡å°†æ•°æ®åŒ…è£…åœ¨ `UnsafeMutableBufferPointer` ä¸­ï¼ˆå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªåºåˆ—ï¼‰ï¼Œå°†å…¶å¤åˆ¶åˆ°æ ‡å‡†æ•°ç»„ä¸­ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™åªèƒ½å®‰å…¨åœ°ä¸ºä½ æä¾›ä¸€ä¸ª `Int8` ç±»å‹çš„æ•°ç»„ã€‚ç°åœ¨ï¼Œä½ å°†å¯¹å…¶è¿›è¡Œæ‰©å±•ã€‚

åœ¨ä½ çš„ Playground çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š

``` swift
extension BinaryInteger {
  static var randomized: Self {
    let numbers = RandomSource.get(count: MemoryLayout<Self>.size)
    return numbers.withUnsafeBufferPointer { bufferPointer in
      return bufferPointer.baseAddress!.withMemoryRebound(
        to: Self.self,
        capacity: 1) {
        return $0.pointee
      }
    }
  }
}

Int8.randomized
UInt8.randomized
Int16.randomized
UInt16.randomized
Int16.randomized
UInt32.randomized
Int64.randomized
UInt64.randomized

```

è¿™ä¸º `BinaryInteger` åè®®çš„æ‰€æœ‰å­ç±»å‹æ·»åŠ äº†ä¸€ä¸ªé™æ€çš„ `randomized` å±æ€§ã€‚å…³äºè¿™æ–¹é¢çš„æ›´å¤šå†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘ä»¬å…³äºåè®®å¯¼å‘ç¼–ç¨‹çš„æ•™ç¨‹ã€‚

é¦–å…ˆï¼Œä½ è·å–éšæœºæ•°ã€‚ç„¶åï¼Œä½¿ç”¨è¿”å›çš„æ•°ç»„çš„å­—èŠ‚ï¼Œå°† `Int8` å€¼é‡æ–°ç»‘å®šä¸ºè¯·æ±‚çš„ç±»å‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‰¯æœ¬ã€‚

è‡³æ­¤ï¼Œä¸€åˆ‡éƒ½å®Œæˆäº†ï¼ä½ ç°åœ¨ä»¥ä¸€ç§å®‰å…¨çš„æ–¹å¼ç”Ÿæˆéšæœºæ•°ï¼Œè€Œè¿™ä¸€åˆ‡çš„èƒŒåæ­£æ˜¯åˆ©ç”¨äº† Swift çš„ä¸å®‰å…¨ç‰¹æ€§ã€‚

### ä¸‹ä¸€æ­¥è¦åšè¿™ä¹ˆï¼Ÿ

æ­å–œä½ å®Œæˆäº†æœ¬æ•™ç¨‹ï¼ä½ å¯ä»¥é€šè¿‡æœ¬æ•™ç¨‹é¡¶éƒ¨æˆ–åº•éƒ¨çš„â€œ[ä¸‹è½½ææ–™](https://github.com/sunyazhou13/Using-Pointers-and-Interacting-With-C)â€é“¾æ¥ä¸‹è½½å®Œæ•´çš„é¡¹ç›®æ–‡ä»¶ã€‚

å¦‚æœä½ æƒ³è¿›ä¸€æ­¥äº†è§£ Swift çš„ä¸å®‰å…¨ç‰¹æ€§ï¼Œè¿˜æœ‰å¾ˆå¤šé¢å¤–çš„èµ„æºå¯ä»¥æ¢ç´¢ï¼š

- **[Swift Evolution 0107: UnsafeRawPointer API](https://github.com/apple/swift-evolution/blob/master/proposals/0107-unsaferawpointer.md)**  
  è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº† Swift çš„å†…å­˜æ¨¡å‹ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ API æ–‡æ¡£ã€‚

- **[Swift Evolution 0138: UnsafeRawBufferPointer API](https://github.com/apple/swift-evolution/blob/master/proposals/0138-unsaferawbufferpointer.md)**  
  è¿™ç¯‡æ–‡ç« æ·±å…¥æ¢è®¨äº†å¦‚ä½•å¤„ç†æœªç±»å‹åŒ–çš„å†…å­˜ï¼Œå¹¶æä¾›äº†ä»ä¸­å—ç›Šçš„å¼€æºé¡¹ç›®çš„é“¾æ¥ã€‚

- **[å¯¼å…¥çš„ C å’Œ Objective-C API](https://developer.apple.com/documentation/swift/imported_c_and_objective-c_apis)**  
  è¿™éƒ¨åˆ†å†…å®¹å¯ä»¥å¸®åŠ©ä½ äº†è§£ Swift æ˜¯å¦‚ä½•ä¸ C è¯­è¨€äº¤äº’çš„ã€‚

å¸Œæœ›ä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³è¦åˆ†äº«çš„ç»éªŒï¼Œè¯·éšæ—¶åœ¨è®ºå›ä¸­è®¨è®ºï¼

# æ€»ç»“

ä»¥ä¸Šæ˜¯å»å¹´æ¬ ä¸‹çš„æŠ€æœ¯å€º.ä»Šå¤©è¦è¿˜ä¸Š,è¿™é‡Œä»‹ç»çš„é¢unsafe swiftä¸­æ“ä½œå†…å­˜çš„æ–¹å‡½æ•°æ–¹æ³• å€¼å¾—å¤§å®¶æ·±å…¥å­¦ä¹ ,è™½ç„¶ç¿»è¯‘çš„è¿‡äºæœºå™¨åŒ–,ç­‰æŠ½ç©ºæˆ‘é‡æ–°æ•´ç†ä¸€ä¸‹.

[åŸæ–‡é“¾æ¥Unsafe Swift: Using Pointers and Interacting With C](https://www.kodeco.com/7181017-)




URL: https://sunyazhou.com/2024/12/FinalSummary/index.html.md
Published At: 2024-12-31 23:53:00 +0000

# 2024å¹´ç»ˆæ€»ç»“

![](/assets/images/20241231FinalSummary/banner.webp)
<button type="button" class="btn btn-info" data-toggle="popover" title="Magotan1990" data-content="å»æ‰“å°çƒçš„è·¯ä¸Š">å°†ä¸€åˆ‡å›°éš¾è¸©åœ¨è„šä¸‹</button>

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

---

æ¸…å¹³ä¹Â·2024å¹´ç»ˆå›é¡¾

å²æœ«å¤©å¯’ï¼Œå›é¦–æµå¹´è¿œã€‚
é£éœœé›¨é›ªå¾é€”æ¼«ï¼Œæ¢¦æƒ³æœªæ›¾æ”¹å˜ã€‚

ç»æµé€šç¼©å·èµ·ï¼Œå°½æ˜¾äººä¹‹æ— åŠ›.
è£å‘˜å‹æ¦¨å‡‹æ•,  å‰é€”æ¸ºèŒ«å¯¥å¯‚.

> 2024å¹´å†¬çºªå¿µé‚£äº›æ›¾æ¯«æ— äººæ–‡ä¸»ä¹‰ç²¾ç¥å’Œè‰ºæœ¯æ°”è´¨çš„ä¼ä¸šåœ¨äº’è”ç½‘çš„æµªæ½®å˜é©æ´—ç¤¼ä¸­å¯¹å¾…åº•å±‚æ‰“å·¥äººæƒ¨æ— äººé“çš„æ€æˆ®.

---

è¿™ä¸€å¹´é™¤äº†æ—¶åˆ»é¢ä¸´è¢«è£çš„é£é™©å¤–å‡ ä¹ç”Ÿæ´»è¿‡å¾—æ¯«æ— æ³¢æ¾œ,ä¸¤é¬“ç™½å‘è¯‰è¯´ç€å¹³é™æ¯«æ— è¿½æ±‚çš„æ—¥å­,è¿™æ˜¯ç¼ç¼è¡¥è¡¥çš„ä¸€å¹´,å‡ ä¹æ‰€æœ‰äººéƒ½å¯¹è‡ªå·±çš„å¼€æ”¯æ§åˆ¶çš„éå¸¸åˆ°ä½,èƒ½èŠ±å°‘éƒ¨åˆ†é’±ä¿®çš„æŒ‡å®šä¸èŠ±é’±æ¢,çºµè§‚å¤šå¹´å‰æ‰€æœªæœ‰ä¹‹ç»æµç°è±¡,å¤§å®¶éƒ½åœ¨ç–¯ç‹‚æ”’é’±æ‹’ç»æ¶ˆè´¹,è¿«ä¸å¾—å·²æ¶ˆè´¹çš„è¯ä¹Ÿåªæ˜¯"å£çº¢ç»æµ"çš„æƒ…å†µè€Œå·².

å½“å¯¹å‰é€”æ¯«æ— æœŸå¾…çš„äººä»¬å¤±å»å¯¹æœªæ¥ç»æµå‘å¥½çš„ä¿¡å¿ƒ,é‚£ç”Ÿæ´»ä¼šè¿‡çš„æ¯«æ— è¿½æ±‚å’ŒæœŸå¾…,åªèƒ½å’Œç°å®å†™ç…§ä¸‹çš„è‡ªå·±å¦¥å,å‹‰å¼ºæ´»ç€, é‚£æ ·çš„äººä»¬ä¸­å°±æœ‰æˆ‘ä¸€ä¸ª. 

åœ¨è¿™ç§å¤æ‚çš„å±€é¢ä¸‹æ¥å›é¦–ä¸€ä¸‹è¿™ä¸€å¹´ä¸­çš„äººå’Œäº‹.

## 2024å¹´å›é¡¾

* å›½é™…å½¢åŠ¿
*  ç”Ÿæ´»
*  å·¥ä½œ
*  å­¦ä¹ 
*  çˆ±å¥½
*  ä¹°æˆ¿

## å›½é™…å½¢åŠ¿

æ‡‚ç‹å†æ¬¡å½“é€‰æ€»ç»Ÿ ä¼°è®¡åˆè¦å¼€å¯å¼€æŒ‚çš„4å¹´ä»»æœŸ åªè¦åœ°çƒä¸çˆ†ç‚¸æˆ‘éƒ½å¯ä»¥æ¥å—,æ¯•ç«Ÿè¿˜å¾—æ˜¯æ‡‚ç‹,æˆ‘é¢„æµ‹å¦‚ä¸‹çš„äº‹æƒ…ä¼šå‘ç”Ÿ

* ä¿„ä¹Œæˆ˜äº‰ç»ˆç»“è€… (åˆ°åº•è°ç»ˆç»“è°ä¸å¥½è¯´)
* ä¸­ç¾ä¹‹é—´è´¸æ˜“æ‘©æ“¦åŠ å‰§
* å·´ä»¥åœ°åŒºè¿æ¥æ‡‚ç‹çš„å’Œå¹³å¦¥å (ä¸çŸ¥é“æ€ä¹ˆä¸ªå¦¥åæ–¹å¼,æ¯•ç«Ÿç¾å›½èƒŒåé‚£æ˜¯çŠ¹å¤ªè´¢é˜€)
* ç»§ç»­æäº‹æƒ… å¿çœ‹é”€çƒŸä¹‹åœ°é‡ç”Ÿæˆ˜ç«,ç—›æƒœè´Ÿä¼¤ä¹‹å…µå†ä¸¾åˆ€æª. æˆ˜ç«æŒ‡å®šä¸æ–­.

å…¶å®ƒçš„å¤§å®¶ä¹Ÿéƒ½èƒ½æƒ³åˆ°,åªæœ‰ä¸€ç‚¹æˆ‘çŒœæµ‹å¤§å®¶æƒ³ä¸åˆ°,ç¾å›½çš„å„ç§èŒèƒ½éƒ¨é—¨ä¹Ÿé¢ä¸´è£å‘˜,å› ä¸ºé™æœ¬å¢æ•ˆçš„é©¬æ–¯å…‹å½“ä¸Šäº†æ•ˆç‡éƒ¨é—¨çš„å¤§ä½¬,è¿™ä¸‹å¥½äº†.åŸæœ¬è£å‘˜åªæœ‰äº’è”ç½‘èƒ½æœ‰çš„äº‹è¿™ä¸€å¹•æ¬åˆ°äº†ç¾å›½å„ç§éƒ¨é—¨,ä»€ä¹ˆCIA,ä»€ä¹ˆå›½é˜²éƒ¨,ä»€ä¹ˆäº”è§’ç‚®æ¥¼è¯¥æ’¤æ’¤è¯¥è£è£. çœ‹ç€å¾—åŠ²,è¿‡ç˜¾. æˆ‘ç°åœ¨æƒ³åˆ°çš„ä¸€å¹•æ˜¯è¿™äº›å¤§ä½¬è¢«è£å‘˜äº†è¦æ˜¯é€å–å¤–é‚£åœºé¢ä¼°è®¡æŒºç‚¸è£‚. æ¯•ç«Ÿä¹Ÿè¦ä¸ºè‡ªå·±çš„ç”Ÿè®¡ç€æƒ³å— çºµç„¶ä½ æœ‰ç™¾ä¸‡åˆ€ä¹ é©¬æ–¯å…‹å„ç§æ”¹é©ç»™é€€ä¼‘é‡‘ç»™ä½ é™æœ¬å¢æ•ˆäº†æˆ‘çœ‹è¿™äº›æ›¾ç»ä¸å¯ä¸€è§†çš„äººç‰©èƒ½ä¸èƒ½å˜æˆäººå, æƒ³æƒ³æŒºæœ‰æ„æ€,ä¸–ç•Œæ€»æ˜¯è¿™æ ·å˜åŒ–è«æµ‹,å³ä¾¿è¿™äº›æ›¾ç»çš„å¤§äººç‰©å¯¹æ­¤è¡¨ç¤ºä¸æ»¡çš„è¯å‘Twitter æˆ‘çœ‹ä»–ä¼šä¸ä¼šè¢«å°å·.é‚£Xå¯æ˜¯muskè¯´äº†ç®—.è¿™æ‹›å¹²çš„é‡œåº•æŠ½è–ªè®©ä½ æ²¡è„¾æ°”.
 
è¯è¯´ä¿„ä¹Œæˆ˜äº‰ä»åœ¨ç»§ç»­.ç»™æˆ‘æœ€ç›´è§‚çš„æ„Ÿå—æ˜¯  92#æ±½æ²¹ä»å¼€æˆ˜å‰çš„6.2å…ƒ/Lå¹²åˆ°ç°åœ¨é«˜é«˜åœ¨ä¸Šçš„7.9å…ƒ/L,è¿™ä»—æ‰“çš„æˆ‘ç”Ÿæ´»æ–¹æ–¹é¢é¢éƒ½å—åˆ°äº†ä¸åŒç¨‹åº¦çš„å½±å“,èµ¶ç´§æ‡‚ç‹ä¸Šä½24å°æ—¶ç»ˆç»“äº†å§! 
 
æˆ‘å›½çš„ååº”è¿™ä¸€ç›´æ˜¯ä¸ªMGè¯é¢˜,æ€»ä½“æ¥è¯´å°±æ˜¯æ‹¿è€ç™¾å§“çš„ç”Ÿæ´»ç¡¬æ‰›,æˆ¿åœ°äº§æ³¡æ²«ç ´è£‚,è®¸å®¶å°å˜æˆé˜¶ä¸‹å›š.å„ç§æˆ¿åœ°äº§ç ´äº§è·‘è·¯,å›½å†…ç»æµæŒç»­ä½è¿·,å¤±ä¸šç‡ä¸¥é‡,ç»æµå°±åœ¨ä¸ç¨³å®šçš„è¾¹ç¼˜åå¤è¯•æ¢,è¿™ä¸€å¹´å‘ç”Ÿå¤ªå¤šè®©ç™¾å§“éš¾ä»¥æ‰¿å—çš„è‹¦,åœ°äº§å•†å·é’±è·‘è·¯,ç™¾å§“æç©º6ä¸ªé’±åŒ…ä¹°çš„æˆ¿å­æ²¡äº†å…‘ç°,ç™¾å§“æƒ³ç¨³å®šèµšé’±,å„ç§ä¼ä¸šè£å‘˜æ²¡æœ‰äº†å·¥ä½œ,ç™¾å§“æƒ³æ¶ˆè´¹æ‹¿ç©ºæ°”æ¶ˆè´¹ä¹ˆ? ç™¾å§“æƒ³å›ä¹¡åˆ›ä¸šæç§æ¤,å„ç§å†œäº§å“çš„ä»·æ ¼ä½åˆ°æ¯”è‚¥æ–™éƒ½ä¾¿å®œ,ç™¾å§“æƒ³æå…»æ®–,çœ‹çœ‹ ç°åœ¨è¿™çŒªè‚‰ä»·æ ¼ 10å‡ å…ƒ/æ–¤ è‚‰ä»·æ¯”é¥²æ–™éƒ½ä¾¿å®œ,æƒ³é€å¤–å– æœ‰å¹´é¾„é™åˆ¶,ç„¶åè¡Œä¸šé¥±å’Œ.... å†™åˆ°è¿™é‡Œæˆ‘æƒ³èµ·æ¥ é‚“å…¬é‚£å¥è¯"ä¸­å›½äººæ°‘å·²ç»æ‰¿å—äº†å¤ªå¤šå¤ªå¤š,ä»–ä»¬å·²ç»å¤Ÿå‹¤å¥‹äº†,å¤Ÿåƒè‹¦è€åŠ³äº†",èƒ½ä¸èƒ½ç»™æ™®é€šè€ç™¾å§“ä¸€ä¸ªæ´»è·¯,éè¦ç­‰ç€ç™¾å§“æ¯ä¸ªäººéƒ½è¿˜ä¸ä¸Šæˆ¿è´·,ä¸€å®¶è€å°ä¸Šè¡—ä¹è®¨æ‰æ˜¯æˆ‘ä»¬è¿½æ±‚çš„ç‰¹è‰²ç¤¾ä¼šä¸»ä¹‰ç°ä»£åŒ–å—?
 
æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´çš„æ¦¨å–å‹ç¤¾ä¼šä¸»ä¹‰åˆ¶åº¦ï¼Œç„¶è€Œå°±ç›®å‰ä¸ºæ­¢ä¹Ÿæ²¡æœ‰åœä¸‹çš„è„šæ­¥çš„è¿¹è±¡ã€‚æ— è®ºåŠ³åŠ¨è€…å¥‰çŒ®å¤šå°‘ä¹Ÿæ‹¿ä¸åˆ°ç¤¾ä¼šèµ„æºåˆ†é…çš„å…¬å¹³é‚£éƒ¨åˆ†ï¼Œå¥‰çŒ®å°‘äº†åªèƒ½è£å‘˜ã€‚
 
## ç”Ÿæ´»

ç–«æƒ…è‡ªå»å¹´å¹´åˆæ—¶å¤§å®¶é˜³çš„é˜³,å…¨æ°‘å…ç–«å¼€å§‹,é€æ¸é€€å‡ºäº†æ—¶ä»£èˆå°,3å¹´çš„ç…ç†¬ç»ˆäºæœ‰äº†ç»“æœ,ä»¿ä½›æ‰“é†’äº†äººä»¬ä»¥åä¸€å®šæ”’å¤Ÿè¶³å¤Ÿçš„é’±,åº”å¯¹é•¿æ—¶é—´çªå‘å¹¶æŒç»­æ—¶é—´é•¿çš„å¤§ç¾å¤§éš¾.

ç–«æƒ…çš„ç»“æŸä¹Ÿæ ‡å¿—ç€å¤§å®¶åˆèƒ½å›å½’æ­£å¸¸ç”Ÿæ´»,è¿™è®©æˆ‘æ€è€ƒäº†å‡ ä¸ªé—®é¢˜

### å¦‚ä½•æ‰èƒ½æŒ¯å…´å®¶æ—?  
	 
æˆ‘çš„æ€è€ƒå¦‚ä¸‹:   

**ä¸€ä¸ªå®¶æ—è´«ç©·çš„çœŸæ­£åŸå› æ˜¯æ•´ä¸ªå®¶æ—æ²¡æœ‰ä¸€ä¸ªæ ¼å±€å¤§çš„å¼•è·¯äººä»å•†æˆ–è€…ä»æ”¿.è€äººæ²¡æœ‰åŠæ³•ä¸ºæ‡µæ‡‚çš„ä¸‹ä¸€ä»£åšè§„åˆ’,è‡ªå·±ä¹Ÿä¸æ³¨é‡æ ¼å±€,ä¸€è¾ˆå­éƒ½åœ¨ç»™åˆ«äººæ‰“å·¥,å®¶æ—é‡Œçš„é•¿è¾ˆè‡ªç§è‡ªåˆ©,ä¸é‡è§†ä¸‹ä¸€ä»£çš„æ•™è‚²,ç­‰è€äº†åˆåˆ©ç”¨å­é“æ¥ç»‘æ¶å­å¥³,è€Œå­å¥³ä¹‹é—´ä¹Ÿæ˜¯å„å¹²å„çš„,å½¼æ­¤ä¹‹é—´ä¸å›¢ç»“,ä¸€ç‚¹åˆ©ç›Šå°±äº‰åµä¸ä¼‘,çŠ¹å¦‚ä¸€ç›˜æ•£æ²™,ä¸æ‡‚å¾—æ•´åˆä¼˜åŠ¿èµ„æº**â€”â€”é»„å®å‡

**ä»»ä½•ä¸€ä¸ªä¼˜ç§€çš„å®¶æ—éƒ½ä¸æ˜¯é ä¸€ä»£äººçš„åŠªåŠ›,è€Œæ˜¯é å‡ ä»£äººçš„ç›¸äº’æ¿€åŠ±,å…±åŒåŠªåŠ›,å¦‚æœç¥–è¾ˆæ‰“ä¸‹çš„åŸºç¡€å¥½,åªéœ€è¨€å¬è®¡ä»,ç»´æŒç°çŠ¶å³å¯æ—¥æ¸ä½³å¢ƒ.å¦‚æœçˆ¶è¾ˆéƒ½æ˜¯æ™®é€šäºº,å°±éœ€è¦æˆ‘ä»¬è¿™ä¸€ä»£äººå»åŠªåŠ›è€•è€˜,åƒä¸‡ä¸è¦å¯„å¸Œæœ›äºä¸‹ä¸€ä»£,æˆ‘ä»¬æ··å¥½äº†ä¸‹ä¸€ä»£æ‰æœ‰å¯èƒ½æ›´å¥½.è¿™ä¸€ä»£æ··å¾—ä¸å¥½.ä¸‹ä¸€ä»£å¤§æ¦‚ç‡ä¼šæ›´éš¾.ä¸‰ä»£æœ›æœ‰è´µæ—ä¹‹å´›èµ·,å†ä»£ä¹‹èœ•å˜,çš†éœ€è„±çš®ä¸€å±‚,çš†éœ€å†ä»£ä¹‹åŠ›æ‹“.**  

æ‰€ä»¥å°±ä¼šå¾—å‡ºä»¥ä¸‹ç»“è®º:  
æœ€å¯æ€œçš„ä¸‹ä¸€ä»£äººæ˜¯æ²¡å®¶åº•æœ‰å®¶æ•™.  
æœ€å±é™©çš„ä¸‹ä¸€ä»£äººæ˜¯æœ‰å®¶åº•æ²¡å®¶æ•™.  
æœ€å‰å®³çš„ä¸‹ä¸€ä»£äººæ˜¯æ—¢æœ‰å®¶åº•åˆæœ‰å®¶æ•™.  
å½“ç„¶æœ€å¤±è´¥çš„ä¸‹ä¸€ä»£å½“ç„¶æ˜¯æ—¢æ²¡å®¶åº•ä¹Ÿæ²¡å®¶æ•™.  
æ­£æ˜¯ä¸åŒçš„æ•™è‚²ç¯å¢ƒè®©è‡ªå·±çš„åä»£å’Œåˆ«äººçš„åä»£å·®è·è¶Šæ‹‰è¶Šå¤§,è€Œä¸”åä»£é€†è¢­çš„æ¦‚ç‡è¿˜è¶Šæ¥è¶Šä½.  	 

### å½“æˆ‘ä»¬é¢ä¸´ç”Ÿå­˜å±æœºæ—¶è°èƒ½ä¸ºæˆ‘ä»¬çš„ç”Ÿæ´»å…œåº•? 

**å›é¡¾è¿™äº›å¹´ï¼Œæˆ‘ä¼¼ä¹æ€»æ˜¯æ‰‹æ¡ä¸€å‰¯ä¸å°½å¦‚äººæ„çš„ç‰Œï¼Œå´å§‹ç»ˆåœ¨å¥‹åŠ›æ‰“å¥½ã€‚ä»å‡ºç”Ÿçš„é‚£ä¸€åˆ»èµ·ï¼Œåˆ°æ¥å—æ•™è‚²çš„å†ç¨‹ï¼Œå†åˆ°ä¹°æˆ¿ç½®ä¸šç›´è‡³å¦‚ä»ŠæŠšå…»å­©å­ï¼Œæˆ‘é€æ¸æœ‰äº†ä¸€ç§æ·±åˆ»çš„é¢†æ‚Ÿã€‚æ‹¥æœ‰çˆ¶æ¯ï¼Œæœ‰æ—¶æ˜¯ç¦ç¥‰ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯è´Ÿæ‹…ã€‚ç¦ç¥‰åœ¨äºï¼Œå¦‚æœä»–ä»¬æ‹¥æœ‰é€€ä¼‘é‡‘ï¼Œé‚£ä¹ˆåœ¨æˆ‘å¤±ä¸šæˆ–ç»æµå›°éš¾æ—¶ï¼Œä»–ä»¬èƒ½ä¸ºæˆ‘æä¾›åŸºæœ¬çš„ç”Ÿæ´»ä¿éšœã€‚ç„¶è€Œï¼Œå½“çˆ¶æ¯ä¸æˆ‘çš„å¹´çºªå·®è·è¾ƒå¤§æ—¶ï¼Œé—®é¢˜ä¾¿æ˜¾ç°å‡ºæ¥ã€‚æœ¬åº”æ˜¯ä»–ä»¬å¹´å¯ŒåŠ›å¼ºã€å¸®åŠ©æˆ‘ç…§é¡¾å­©å­çš„é˜¶æ®µï¼Œå´å› å¹´é¾„å’Œå¥åº·çš„é™åˆ¶ï¼Œä½¿å¾—ä»–ä»¬åœ¨å¸¦å­©å­æ—¶æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚è¿™ç§ä¸åŒé¾„äººçˆ¶æ¯èº«ä½“å¼ºå¥çš„å¯¹æ¯”ï¼Œè®©æˆ‘äº§ç”Ÿäº†éš¾ä»¥æ‰¿å—çš„å¿ƒç†è½å·®ã€‚**

è¿™ç§è‹¦æ¶©çš„ç”Ÿæ´»ç»å†ï¼Œæ—¢éæˆ‘çš„è¿‡é”™ï¼Œä¹Ÿä¼¼ä¹ä¸æˆ‘æœ‰å…³ã€‚éæˆ‘çš„è¿‡é”™åœ¨äºï¼Œæˆ‘æ— æ³•é€‰æ‹©è‡ªå·±çš„å‡ºç”Ÿæ—¶æœºå’Œçˆ¶æ¯çš„å¹´çºªã€‚è€Œæˆ‘çš„è¿‡é”™åˆ™åœ¨äºï¼Œæˆ‘æœªèƒ½ç§¯ç´¯è¶³å¤Ÿçš„è´¢å¯Œæ¥æ‘†è„±è¿™äº›å›°å¢ƒï¼Œå®ç°çœŸæ­£çš„ç‹¬ç«‹ï¼Œä¸å†ä¾èµ–ä»–ä»¬ã€‚ä½†ç”Ÿæ´»æ€»è¦ç»§ç»­ï¼Œæˆ‘æ·±çŸ¥å”¯æœ‰åŠªåŠ›æ´»ä¸‹å»ï¼Œé¿å…è‡ªèº«é‡è¹ˆè¦†è¾™ï¼Œæ‰æ˜¯æœ€ä¼˜è§£ã€‚å› æ­¤ï¼Œæˆ‘å°†è¿™æ®µç»å†è§†ä¸º`ç£¨ç»ƒçµé­‚çš„å†ç¨‹`ï¼Œä»æœªåœæ­¢è¿‡è‡ªæˆ‘æå‡ä¸æˆé•¿ã€‚Keep honing.

### æ›¾ç»ç†Ÿæ‚‰çš„æœ‹å‹æˆ–åŒå­¦ç›®å‰éƒ½åœ¨åšä»€ä¹ˆï¼Ÿ

æ¯å½“æˆ‘è¸ä¸Šåœ°é“,æ‹¿å‡ºæ‰‹æœºæ‰“å¼€iBookçœ‹ã€ŠMetal by Tutorials 4th 2023ã€‹æ—¶,çœ‹ç€å¤§å®¶éƒ½å‰æ‰€æœªé—»çš„å›¾å½¢å›¾åƒæŠ€æœ¯ä¸“ä¸šä¹¦ç±,å¯¹ç€å†°å†·çš„æŠ€æœ¯ç‚¹å’Œç€è‰²å™¨ä»£ç .æˆ‘æ—¶å¸¸åœ¨æƒ³ èº«è¾¹çœŸæœ‰åƒæˆ‘è¿™æ ·çš„äººæ¯å¤©ç ”ç©¶å¥‡å¥‡æ€ªæ€ªçš„æ™¦æ¶©éš¾æ‡‚çš„å‡½æ•°çš„äººå—?ä»–ä»¬è¿™ä¸ªæ—¶å€™éƒ½åœ¨å¹²å•¥? é‚£æ—¶å€™æ„Ÿè§‰è‡ªå·± æ— æ¯”å­¤ç‹¬, ä¹Ÿè®¸å°±åƒã€ŠåŒ—æ´¾ç›—å¢“ç¬”è®°ã€‹ä¸­ ç§¦è¥¿è¾¾è¯´é¡¹äº‘å³°:"å¼ºè€…æ³¨å®šå­¤ç‹¬..."


## å·¥ä½œ

ç°åœ¨çš„å·¥ä½œå·²ç»ä¸æ˜¯ç¨³ä¸ç¨³å®šçš„é—®é¢˜äº†,æ˜¯å•¥æ—¶å€™ç­‰ç€è¢«è£é¢†å¤§ç¤¼åŒ…å‡†å¤‡ç ”ç©¶å¹²å•¥äº†,æ¯å¤©éƒ½åœ¨ç»§ç»­é’»ç ”å’Œå‡†å¤‡æ‰¾å·¥ä½œä¹‹é—´æŒ£æ‰å¾˜å¾Š.å¯¹å·¥ä½œå¤±å»äº†ä¿¡å¿ƒ,æ¯•ç«Ÿå¤§å®¶çš„é­é‡å‡ ä¹å’Œæˆ‘å¥½ä¸åˆ°å“ªå»,å¯¹äºç›®å‰çš„å…¬å¸æˆ‘åªèƒ½è¯´æˆ‘è¿˜èƒ½å¯¹ä»˜å¹²,å› ä¸ºæˆ‘ä¸ç¡®å®šåˆ°åº•æ˜¯å®ƒå¹²åºŸè¿˜æ˜¯æˆ‘å¹²èµ°å“ªä¸ªå…ˆå‘ç”Ÿ.

åŒäº‹è´¨é‡çœŸçš„æ˜¯ä¸€å¹´ä¸å¦‚ä¸€å¹´,å¦‚æœä¸æ˜¯éæ ¸å¿ƒéƒ¨é—¨çš„å…¬å¸ä¹Ÿè®¸åŒäº‹è´¨é‡ä¸é«˜,å·²ç»å¾ˆéš¾å›åˆ°æ›¾ç»æˆ‘åœ¨ç™¾åº¦æ—¶é‡åˆ°é‚£äº›NBçš„åŒäº‹,æ²¡äº‹æ•™æˆ‘å†™å†™æ–‡ç« åšå®¢,ç»ƒç»ƒä¹¦æ³•å†™å†™ä»£ç .å·²ç»æ‰¾ä¸å›æ¥äº†.è¿™å¯èƒ½å’Œå½“ä¸‹çš„ç»æµå½¢åŠ¿æœ‰å…³,

### è®©æˆ‘æœ€éœ‡æƒŠçš„ä¸€ä»¶äº‹

æ¸…åå¤§å­¦æ¯•ä¸šçš„ç™¾åº¦å‰åŒäº‹æ¶›å…„ä¸å¾—ä¸å†æ¬¡åœ¨æˆ‘çš„å¹´ç»ˆæ€»ç»“å‡ºé•œ,å°±æ˜¯é‚£ä¸ªæ•°å­¦120åˆ†é«˜è€ƒæ‰“119åˆ†é‚£ä¸€åˆ†å› ä¸ºå·é¢æ•´æ´åº¦ä¸å¤Ÿæ‰£ä¸€åˆ†(å¯æœ‰å¯æ— çš„), ä»Šå¹´å¬è¯´ä»–è¢«è£å‘˜äº†,è®©æˆ‘ååˆ†éœ‡æƒŠ, é™¤äº†å®‰æ…°ä»–ä»¥å¤–è®©æˆ‘ä¸å¾—ä¸ é‡æ–°è®¤è¯† è€ƒä¸ªå¥½å¤§å­¦,å¥½å­¦å†ç°åœ¨è¿˜æœ‰ç”¨ä¸. ç°åœ¨æœ¬ç§‘æˆ–ç ”ç©¶ç”Ÿæ‰¾ä¸åˆ°å·¥ä½œï¼Œè®©æˆ‘äº§ç”Ÿäº†å¯¹è¯»ä¹¦æ˜¯å¦æœ‰ç”¨çš„æ€è€ƒã€‚è¯»ä¹¦åˆ°åº•æœ‰æ²¡æœ‰ç”¨æˆ‘ä¸çŸ¥é“ï¼Œä½†ç§¯ç´¯æ— å½¢çš„èµ„äº§ï¼Œå½¢æˆè‡ªå·±çš„è®¤çŸ¥ã€è§‚å¿µå’Œæ–¹æ³•è®ºéœ€è¦å®ƒï¼Œå®ƒä¼šæ½œç§»é»˜åŒ–çš„æ”¹å˜æˆ‘ä»¬çš„ä¸€ç”Ÿï¼Œï¼Œä¹Ÿè®¸ä½ å¹¶ä¸çŸ¥é“çŸ¥è¯†çš„ç”¨å¤„ï¼Œä½†ä½ ä¸€å®šæ‰¿å—ä¸äº†æ— çŸ¥çš„ä»£ä»·ã€‚è¯»ä¹¦çš„è¿‡ç¨‹ä¹Ÿè®¸æ˜¯å¯¹è‡ªå·±çš„ç£¨ç‚¼å’Œå¡‘é€ ï¼ŒåŸ¹å…»å…‹æœå›°éš¾çš„å“è´¨ã€‚

ä¸è¿‡æœ‰ä¸€ä»¶äº‹æˆ‘ä»¬ä¼¼ä¹å¿½è§†äº†,è¯»ä¹¦æ²¡æœ‰æ•™æˆ‘å¦‚ä½•èµšé’±,æ¯•ç«Ÿè¿™ä¸œè¥¿æ²¡æœ‰å†™åˆ°ä¹¦æœ¬é‡Œ.è¿™ä¸ªå°±æ˜¯ä¸»è¦åŸå› ä¸ºä»€ä¹ˆä¸Šè¿°ç§ç§å‘ç”Ÿçš„äº‹æƒ…è‹¦å¯»æ— æœ, æˆ‘ç›¸ä¿¡è¿™æ˜¯æ‰€æœ‰äººéƒ½éƒ¨ç½²çš„ç ”ç©¶è¯¾é¢˜.

å·¥ä½œç›®å‰å°±ä¸ªçƒæ ·,å¹´çºªå¤§å¾…é‡å·®.

### å€¼å¾—æ¬£æ…°çš„ä¸€ä»¶äº‹

ä»Šå¹´Q1æ‹¿äº†ä¸€ä¸ª å“è¶Šä¸ªäººé€å…‰å¥–å‹‰å‹‰å¼ºå¼ºèƒ½åœ¨å¹´ç»ˆæ€»ç»“æä¸€æ

![](/assets/images/20241231FinalSummary/award1.webp)  
![](/assets/images/20241231FinalSummary/award2.webp)

ç»™çš„ç»è´¹ä¹Ÿå°±2k è¯·å¤§å®¶åƒäº†é¡¿é¥­èƒ¡ä¹±çš„æŠ¥é”€äº†,å•¥ç”¨æ²¡æœ‰. å“¦ è¿˜ç»™ä¸€æ†é²œèŠ± ä»…æ­¤è€Œå·².

å¥½ä¹…æ²¡æ‹¿å¥–äº†.è·ç¦»ä¸Šæ¬¡å¥½åƒæ˜¯åœ¨å¿«æ‰‹æ—¶æ‹¿åˆ°çš„ä¼˜ç§€è®²å¸ˆå§!æƒ­æ„§æƒ­æ„§

æ‹¿è¿™ä¸ªå¥–é¡¹ä¸»è¦æ˜¯å‘å¸ƒäº†ä¸€ç¯‡ã€Šé…·æˆ‘éŸ³ä¹iOSå°ç»„ä»¶é€‚é…å¼€å‘å®è·µ
ã€‹æ–‡ç« åˆ°`QQéŸ³ä¹æŠ€æœ¯å›¢é˜Ÿ`çš„å¾®ä¿¡å…¬ä¼—å·,æ²¡æƒ³åˆ°èƒ½ç°åœ¨å„å¤§æœç´¢å¼•æ“åªè¦æœç´¢å°ç»„ä»¶å¼€å‘å°±æœ‰æˆ‘çš„æ–‡ç« ,ä¹Ÿç®—ä¸€ç‚¹ç‚¹é¼“åŠ±å§!

#### èƒ½ä¿®å°½é‡ä¸æ¢æ–°çš„ç‰©ä»¶

å‡ å¹´å‰åœ¨å¾—ç‰©ä¸Šä¹°äº† ä¸€åŒAJ1 çƒé‹,å› ä¸ºå¸¸å¹´çš„ç©¿ç€,å¯¼è‡´å‰å¤´çš®è´¨ææ–™è€åŒ–, é—®äº†å„ç§ä¿®é‹åº—éƒ½å¼„ä¸äº†,æ— å¥ˆæ‹¼å¤šå¤šæ‰¾ä¸ªä¸“ä¸šç»´ä¿®aj1çƒé‹çš„å¸ˆå‚…,èŠ±äº†150å…ƒå·¦å³ä¿®å¥½äº†,æ•ˆæœä¸é”™

![](/assets/images/20241231FinalSummary/aj1.webp)

è¿˜æœ‰ä¸€ä¸ªAirPod Proè€³æœºè¿˜æ˜¯å¿«æ‰‹2019å¹´æ˜¥æ™šç›´æ’­æ´»åŠ¨æ—¶ é…å‘çš„,è¿™ä¹ˆå¤šå¹´è¿‡å»,å†…éƒ¨æ‰¬å£°å™¨å–‡å­å¥½åƒè„±è½å¼€èƒ¶äº†ä¸€æ ·,åœ¨åœ°é“å­¦ä¹ æ—¶æ€»å“,äºæ˜¯æ‹¼å¤šå¤šæ‰¾äº†ä¸ªä¸“ä¸šç»´ä¿®å¸ˆå‚… 50å…ƒæå®š,æ‰¾è‹¹æœå®˜æ–¹ç­”å¤æ˜¯è¦ä¹ˆç›´æ¥æ¢æ–°,å¦åˆ™æ— æ³•ç»´ä¿®.

![](/assets/images/20241231FinalSummary/airpod.webp)

è¿™ä¸¤ä»¶ä¸ªäººç‰©å“å®Œå…¨æç°äº†2024å¹´çš„æˆ‘ç¼ç¼è¡¥è¡¥,æ²¡åŠæ³•æ¶ˆè´¹é™çº§,æˆ‘çš„å…¨éƒ¨è´¢å¯Œéƒ½è¢«æ”¿åºœä¸€æ¬¡æ€§æ”¶å‰²æ¢æˆ¿äº†,ç©·äººçš„æ— å¥ˆ...

## å­¦ä¹ 

### C++çš„æŒç»­å­¦ä¹ 

![](/assets/images/20241231FinalSummary/Cplusplus.webp)    

åœ¨åœ°é“ä¸Šçš„é›¶ç¢æ—¶é—´é‡Œï¼Œæˆ‘ç«Ÿç„¶æ„å¤–åœ°å®Œæˆäº†ä¸€æ•´æœ¬C++çš„å­¦ä¹ ã€‚åˆä¸Šä¹¦çš„é‚£ä¸€åˆ»ï¼Œæˆ‘ä»¿ä½›ç«™åœ¨äº†ä¸€åº§å®ä¼Ÿçš„çŸ¥è¯†æ®¿å ‚çš„é—¨å‰ï¼Œé—¨åæ˜¯æ— æ•°æ¡èœ¿èœ’çš„é€šé“ï¼Œæ¯ä¸€æ¡éƒ½é€šå‘æ›´æ·±çš„å­¦é—®ï¼Œæ¯ä¸€æ¡éƒ½éœ€è¦æˆ‘æŠ•å…¥æ›´å¤šçš„æ—¶é—´å’Œç²¾åŠ›å»æ¢ç´¢ã€‚æˆ‘æ„Ÿè§‰è‡ªå·±æ­£ç«™åœ¨ä¸€æ£µå¤§æ ‘çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œæ­£å‡†å¤‡æ²¿ç€æ ‘çš„åˆ†æ”¯ï¼Œä¸€æ­¥æ­¥æ·±å…¥åˆ°æ¯ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œç”šè‡³æ˜¯æœ€æœ«ç«¯çš„å¶å­èŠ‚ç‚¹ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘åªæœ‰å‰é©±å’Œåç»§çš„æŒ‡å¼•ï¼Œå®ƒä»¬å°†å¸¦é¢†æˆ‘ç»§ç»­åœ¨ç¼–ç¨‹çš„ä¸–ç•Œä¸­å‰è¡Œå’Œæ¢ç´¢ã€‚

### Metalå›¾å½¢å›¾åƒçš„å­¦ä¹ 

å½“å®Œæˆäº†ä¸Šä¸€æœ¬,ç´§æ¥ç€å°±å¼€å§‹ä¸‹ä¸€æœ¬ã€ŠMetal.by.Tutorials.4th.2023.12ã€‹Appleå¹³å°çš„å›¾å½¢å›¾åƒ.

![](/assets/images/20241231FinalSummary/Metal.webp)    

å½“æˆ‘è¯»åˆ°è¿™æœ¬ã€ŠMetalã€‹è®¡ç®—æœºå›¾å½¢å­¦ä¹¦ç±çš„ä¸€åŠæ—¶ï¼Œæˆ‘æ·±åˆ»åœ°æ„è¯†åˆ°ï¼Œæˆ‘åœ¨å¤§å­¦æ—¶æœŸæ‰€å­¦çš„è®¡ç®—æœºçŸ¥è¯†ä¸è¿‡æ˜¯æµ…å°è¾„æ­¢ã€æµ®çš®æ½¦è‰ï¼Œå¯¹äºå›¾å½¢å­¦è¿™ä¸€é¢†åŸŸæ›´æ˜¯æœªæ›¾æ·±å…¥æ¢ç©¶ï¼Œè¿™è®©æˆ‘æ„Ÿåˆ°è‡ªå·±æµªè´¹äº†å®è´µçš„æ—¶å…‰ã€‚ç°åœ¨ï¼Œæˆ‘æ‰æ˜ç™½ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„è®¡ç®—æœºæŠ€æœ¯ç²¾é«“ã€‚å¦‚æœåœ¨æˆ‘çš„èŒä¸šç”Ÿæ¶¯æ—©æœŸï¼Œèƒ½æœ‰ä¸€ä½å¯¼å¸ˆä¸ºæˆ‘æŒ‡å¼•æ–¹å‘ï¼Œæˆ–è®¸æˆ‘å°±ä¸ä¼šåƒç°åœ¨è¿™æ ·ï¼Œæ—¶åˆ»æ‹…å¿ƒç€è¢«è£å‘˜çš„å‘½è¿ã€‚

ä¸ºäº†å¼„æ¸…æ¥šMetalæä¾›çš„API,æˆ‘å°è¯•å†™äº†å‡ ç¯‡çº¸,å¼„æ¸…æ¥š queuã€command bufferã€ command encoderã€pipeline buffer object... 

![](/assets/images/20241231FinalSummary/Metal01.webp)   
![](/assets/images/20241231FinalSummary/Metal02.webp) 
> ç”»çš„è¿‡äºæ½¦è‰çŒ®ä¸‘äº†.

æ­£å¦‚ç‰›é¡¿æ‰€è¯´ï¼Œä»–ä¹‹æ‰€ä»¥èƒ½çœ‹å¾—æ›´è¿œï¼Œæ˜¯å› ä¸ºä»–ç«™åœ¨äº†å·¨äººçš„è‚©è†€ä¸Šã€‚æˆ‘æ¸´æœ›åŠªåŠ›æˆä¸ºé‚£ä¸ªå·¨äººï¼Œè®©æ›´å¤šçš„ç‰›é¡¿çœ‹çš„æ›´è¿œã€‚

è¿™æœ¬ä¹¦éå¸¸æœ‰æŒ‘æˆ˜æ€§.å…¨è‹±æ–‡,ä¹Ÿç€å®é”»ç‚¼äº†ä¸€ä¸‹æˆ‘å¾ˆä¹…ä¸ä½¿ç”¨çš„è‹±æ–‡é˜…è¯»ç†è§£æŠ€èƒ½,é€‚å½“çš„æ—¶å€™ç”¨ä¸€ä¸‹iOSè‡ªå¸¦ç¿»è¯‘,ä¸è¿‡è¿™éƒ½æ˜¯æˆ‘ç†è§£ä¸€éå’Œç¿»è¯‘å¯¹ç…§ä¸€é,å½“æˆ‘æŸ¥çœ‹ç¿»è¯‘å’Œæˆ‘ç†è§£çš„å†…å®¹åšdiffæ—¶æˆ‘èƒ½æ˜æ˜¾æ„Ÿè§‰è‡ªå·±çš„é˜…è¯»ç†è§£åœ¨é€æ­¥æé«˜,åªæ˜¯è¿™æœ¬ä¹¦çš„ä½œè€…æˆ‘å®åœ¨ä¸èƒ½è‹›æ±‚å®ƒç”¨æ ‡å‡†çš„è‹±å¼è‹±è¯­,å®ƒè¯´çš„å¾ˆå¤šå†…å®¹æˆ‘éƒ½æœªå¬è¿‡ç„¶è€Œåˆå¯ä»¥æˆä¸ºä¸€ç§ä¸å¸¸ç”¨çš„åè¯ç†è§£å½¢å¼è€Œå­˜åœ¨.

åœ¨å­¦ä¹ è¿™æœ¬ä¹¦çš„æ—¶å€™æˆ‘ä¸å¾—ä¸æŠŠçº¿æ€§ä»£æ•°è·Ÿéšç€ä¸€ç‚¹ç‚¹å­¦ä¹ äº†ä¸€ä¸‹[ã€Šçº¿æ€§ä»£æ•°ã€‹æ­£è¯¾ï¼Œé›¶åºŸè¯ï¼Œè¶…ç²¾è®²ï¼ã€å­”ç¥¥ä»ã€‘](https://b23.tv/MHAsU12) å› ä¸ºå›¾å½¢å­¦å¤§éƒ¨åˆ†éƒ½æ˜¯çº¿æ€§ä»£æ•°èŒƒç•´,è¿™å±äºè¢«åŠ¨è·Ÿéšå­¦ä¹ .

åˆšå¼€å§‹çš„è®²çš„äºŒé˜¶è¡Œåˆ—å¼å¤§æ¦‚å’Œæˆ‘ä»¬ä½¿ç”¨çš„çŸ©é˜µè¿ç®—æœ‰ç›´æ¥å…³è”.å› ä¸ºåœ¨3Dçš„ä¸–ç•Œé‡Œå¯¹ä¸€ä¸ªç‰©ä½“æ‰§è¡Œ ä½ç½®å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾(ä»¿å°„å˜æ¢)éƒ½éœ€è¦ç”¨åˆ°è¡Œåˆ—å¼ç±»ä¼¼çš„å¼å­. è¿™å‡ ä¹å¯ä»¥è¯´æ˜¯å›¾å½¢å­¦çš„åŸºç¡€,å¦‚æœåé¢ç¼–å†™ç€è‰²å™¨æ—¶å¯¹å…¶å†…éƒ¨çš„å‡½æ•°ä¸äº†è§£ä¼šå¾ˆæ‡µ,è¿™äº›éƒ½æ˜¯çº¿æ€§ä»£æ•°åœ¨èƒŒååšç†è®ºæ”¯æ’‘çš„.

è¿™æœ¬ä¹¦è®©æˆ‘æœ€å°è±¡æ·±åˆ»çš„çŸ¥è¯†ç‚¹æˆ–è€…è¯´æ˜¯æˆ‘çš„çŸ¥è¯†ç›²åŒºæ˜¯æˆ‘å¯¹å…‰ç…§çš„ç†è§£,åŸæ¥å¾ˆå¤šå‰è¾ˆåœ¨è¿™æ–¹é¢åšäº†å¾ˆå¤šç ”ç©¶eg:[Phong light model å†¯æ°å…‰ç…§æ¨¡å‹](https://www.cs.utexas.edu/~bajaj/graphics2012/cs354/lectures/lect14.pdf)è®ºæ–‡,è²æ¶…å°”å…‰ç…§æ¨¡å‹ç­‰.

åŸºäºè¿™äº›è®ºæ–‡æä¾›çš„å…¬å¼ç†è®º,å¯ä»¥å¤„ç†å…‰ç…§çš„åå°„å’Œæ¼«å°„ä»¥åŠç¯å¢ƒå…‰é®æŒ¡ç­‰æŠ€æœ¯(åœ¨ç€è‰²å™¨ä¸­å†™çš„ä»£ç å°±æ˜¯åŸºäºè¿™ç§å…¬å¼),æ¯”å¦‚ç¯å…‰æ¨¡å‹åˆ†ä¸º èšå…‰ç¯ã€ç‚¹å…‰æºã€ç›´å°„å…‰(å¤ªé˜³å…‰),åŸºäºè¿™äº›å…‰ç…§åŸºç¡€,æ‰æœ€ç»ˆè¡ç”Ÿå‡ºåŸºäº `[BPR](ç‰©ç†çš„æ¸²æŸ“æŠ€æœ¯)` ç”šè‡³åæ¥çš„å¤šæ¬¡åå°„å½¢æˆçš„å…‰çº¿è¿½è¸ªæŠ€æœ¯(Ray Tracking).

è¯´çœŸçš„å°±æ˜¯è¿™ä¸€æœ¬ç®€å•çš„ä¹¦,è§¦åŠ¨è¿‡æˆ‘å¿ƒçµæ·±å¤„çš„è®¤çŸ¥Næ¬¡,ä¹Ÿè®©æˆ‘ä¸æ–­è§‰é†’æŒç»­å­¦ä¹ è¿™ç§å›¾å½¢å­¦.

**è¿›æ­¥çš„æ—¶å€™ä¹Ÿè®¸å°±æ˜¯å·¥ç¨‹å¸ˆæœ€å¿«ä¹çš„æ—¶å€™å§** (å½“ç„¶è´¢å¯Œè‡ªç”±ä¹Ÿæ˜¯),æ˜¾ç„¶ç ”ç©¶å›¾å½¢å›¾åƒæœ‰æ—¶å€™å¾ˆæ™¦æ¶©,å¯¹äºç›®å‰å½“ä¸‹çš„æˆ‘ä»¬æ¥è¯´èµšæ›´å¤šçš„é’±åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆå¯èƒ½. ç ”ç©¶ä¸€äº›æ·±åº¦çš„æŠ€æœ¯ä¹Ÿè®¸æ˜¯ä¸€ä»¶è‹¦ä¸­ä½œä¹çš„äº‹.

å¯¹äºå­¦ä¹ è¿™ä»¶äº‹,ä¸çŸ¥å¤§å®¶æ˜¯å¦å’Œæˆ‘ä¸€æ ·,å¹´åˆçš„æ—¶å€™æ‰“ç®—å­¦ä¸€å †ä¸œè¥¿,ç„¶è€Œç»å¸¸è¢«å…¶å®ƒé«˜ä¼˜å…ˆçº§çš„äº‹æƒ…æŠ¢å å¼è°ƒåº¦,å¯¼è‡´æœ€åå•¥ä¹Ÿæ²¡å­¦åˆ°,æœ€åå¹´ç»ˆä¹Ÿæ²¡å•¥è¯´çš„,äºæ˜¯2024å¹´åˆçš„æ—¶å€™æˆ‘æ”¹å˜äº†æ€è·¯, ä¸ç®¡æ€ä¹ˆæ ·å…ˆå°½åŠ›ä¸“å¿ƒç ”ç©¶ä¸€æ ·æŠ€æœ¯,å®Œæˆåå†ç ”ç©¶ä¸‹ä¸€ä¸ª.å¦‚æœè¿™ä¸­é—´å®åœ¨æ˜¯æ„Ÿåˆ°æ— èŠå’Œç™¾æ— èŠèµ–æš‚æ—¶æ‰¾ç‚¹æœ‰æ„æ€çš„äº‹,ç­‰ç¼“è§£è¿‡åå†å¾ªåºæ¸è¿›çš„æ¢å¤åˆ°ä¹‹å‰çš„å­¦ä¹ æ–¹å‘ä¸Š.ç»è¿‡ä¸€å¹´çš„å®è·µè¿™ç§æ–¹å¼å¾ˆæœ‰æ•ˆæœ. æˆ‘æŠŠè¿™ç§æ–¹å¼ç§°ä¸º`çº¿æ€§å¶å‘è¢«å¹²æ‰°å­¦ä¹ æ³•`

## çˆ±å¥½

2020å¹´å·¦å³,é‚£æ—¶å€™æˆ‘æ„Ÿè§‰æˆ‘æœ‰ä¸€ç§æŠ‘éƒç—‡,å¯¹åŒ—äº¬çš„å·¥ä½œæ¯«æ— è¿½æ±‚, å…¶å®é‚£æ—¶å€™è‡ªå·±æ²¡æœ‰å¯Ÿè§‰,å¦‚æœæœ‰è®¤çŸ¥çš„æå‡ä¹Ÿè®¸ä¼šå¥½ä¸€äº›, ç„¶è€Œç°åœ¨ä¼šæƒ³èµ·æ¥è¿˜æ˜¯è§‰å¾—å½“æ—¶è‡ªå·±æ²¡æœ‰æ‰¾åˆ°ä¸€ç§æ–¹å¼è§£å†³è¿™ç§æŠ‘éƒç—‡çš„æƒ…å†µ, ç›´åˆ°åæ¥é‡åˆ°äº†å°çƒ,å¹¶ä¸”ä¸æ–­çš„æ·±å…¥ç ”ç©¶,çœ‹æ¯”èµ›èµ›äº‹ç†Ÿæ‚‰è§„åˆ™,å®è·µè¿‡ç¨‹ä¸­å­¦ä¹ Bç«™çš„æ•™ç¨‹

ç°åœ¨è¿˜åœ¨åšæŒçƒ­çˆ±å¹¶ä¸€ç›´æ²¡æœ‰æ”¾å¼ƒ,ç°åœ¨çš„æˆ‘æ‰“çƒå·²ç»ä¸èƒ½è¯´æ˜¯æ‰“çƒäº†,æ˜¯åœ¨é€æ¸äº†è§£çƒæˆ¿çš„ç»è¥æ–¹å¼,è¿ç»´æˆæœ¬,å™¨æçš„å“ç‰Œå’Œç»´ä¿®ç›¸å…³, æƒ³æŠŠè¿™ä¸ªå‘å±•æˆä¸ºç¬¬äºŒæ›²çº¿çš„å‰æé¦–å…ˆè¦å¯¹å®ƒæœ‰ä¸ªå…¨é¢çš„äº†è§£,è¿™æ ·æ‰çŸ¥é“è¿™é—¨ç”Ÿæ„èƒ½ä¸èƒ½åš,åšéœ€è¦å¤šå°‘æŠ•å…¥,è‡ªå·±å°±æ˜¯ä¸€åå°çƒçˆ±å¥½è€…,å¹¶ä¸”æ€»æ˜¯å°è¯•ä¸€äº›æŠ€æœ¯å‹æ€ç»´ç†è§£å°çƒè¡Œä¸šçš„å‘å±•.

è¿™é—¨ç”Ÿæ„æˆ‘çœ‹å¥½çš„åŸå› æœ‰ä¸¤ä¸ª

* å½“ä¸‹çš„ç»æµé€šç¼©èƒŒæ™¯ä¸‹æ™®é€šäººç¾¤å¾ˆå°‘æ¶ˆè´¹
* [å£çº¢ç»æµ](https://baike.baidu.com/item/%E5%8F%A3%E7%BA%A2%E7%BB%8F%E6%B5%8E/1011374) çš„ä½œç”¨

å› ä¸ºç°åœ¨ç»æµå½¢åŠ¿è¾ƒå·®,å½“å·¥ä½œä¸ç¨³å®šæ—¶æ”¶å…¥å˜çš„éå¸¸é‡è¦,å¤§å®¶ä¸æ•¢æ¶ˆè´¹,åªèƒ½ç”¨å°‘çš„é’±æ»¡è¶³æ¶ˆè´¹éœ€æ±‚,è¿™ç§å°çƒç»æµéå¸¸ç¬¦åˆè¿™ç§ç»æµèƒŒæ™¯ä¸‹çš„æ¶ˆè´¹æ–¹å¼.èŠ±ä¸€ç‚¹é’±èƒ½å¸¦æ¥å¾ˆå¤šå¿«ä¹é‚£ç§.

![](/assets/images/20241231FinalSummary/daiyong.webp)  

å°çƒå¯¹æˆ‘æ¥è¯´éå¸¸æ²»æ„ˆ,å½“æˆ‘å·¥ä½œå‹åŠ›å¾ˆå¤§æ—¶è¿™ç§è¿åŠ¨éå¸¸ä¼˜é›…,ç»è¿‡äº†2å¹´å¤šçš„ç»ƒä¹ ,å¯¹å°çƒæœ‰ä¸ªåŸºæœ¬è®¤è¯†,å‰åŒäº‹ä»æ–°åŠ å¡å›å›½æˆ‘ç”¨å°çƒè·Ÿä»–åˆ†äº«äº†ä¸€ä¸‹ä¸€ä¸ªäººå¦‚ä½•æˆ˜èƒœèƒŒäº•ç¦»ä¹¡ä¸¾ç›®æ— äº²çš„å­¤ç‹¬æ„Ÿ.

![](/assets/images/20241231FinalSummary/wufendian.webp)  

äººç”Ÿå¦‚åŒé‚£é¢—ç™½è‰²çš„æ¯çƒï¼Œåœ¨äº”åˆ†ç‚¹çš„æŒ‘æˆ˜ä¸­ï¼Œä¸‰ç‚¹ä¸€çº¿ï¼Œç„å‡†è¢‹å£ã€‚å½“æˆ‘ä»¬å‡»çƒçš„è´¨é‡ä¸ä½³ï¼Œæˆ–æ˜¯å‡»çƒç‚¹ä¸å‡†ç¡®æ—¶ï¼Œè¿™äº›å¤±è¯¯éƒ½ä¼šåé¦ˆåˆ°ç™½çƒçš„è½¨è¿¹ä¸Šã€‚éšç€æˆ‘ä»¬ä¸æ–­å¯»æ‰¾æ­£ç¡®çš„å‡»çƒç‚¹ï¼Œçº æ­£è‡ªå·±çš„é”™è¯¯ï¼Œæˆ‘ä»¬å°±èƒ½è°ƒæ•´æ­£ç¡®çš„ç”Ÿæ´»æ–¹å‘ï¼Œä½¿äººç”Ÿé‡å›æ­£è½¨ã€‚

### æˆ‘å¯¹å°çƒçˆ±å¥½çš„æ²‰æ€

æœ‰æ—¶å€™ï¼Œæˆ‘ä¼šé™·å…¥æ·±æ€ï¼šäººç©¶ç«Ÿæ˜¯å¦éœ€è¦æ‹¥æœ‰çˆ±å¥½ï¼Ÿçˆ±å¥½å’Œæ¢¦æƒ³ä¸€æ ·ï¼Œå¾€å¾€éœ€è¦é‡‘é’±çš„æ”¯æ’‘ã€‚å½“ä¸ªäººçš„å®åŠ›ä¸æ¢¦æƒ³ä¸ç›¸ç¬¦æ—¶ï¼Œçˆ±å¥½æ˜¯å¦å˜æˆäº†ä¸€ç§å¥¢ä¾ˆï¼Ÿ

é¦–å…ˆï¼Œçˆ±å¥½æ— ç–‘èƒ½å¤Ÿæ»¡è¶³æˆ‘çš„æƒ…ç»ªä»·å€¼ï¼Œä¸ºæˆ‘çš„å¿ƒçµå¸¦æ¥æ„‰æ‚¦å’Œæ»¡è¶³ã€‚å®ƒèƒ½å¤Ÿæ¿€å‘æˆ‘ä»¬çš„çƒ­æƒ…ï¼Œè®©æˆ‘ä»¬åœ¨å¿™ç¢Œå’Œå‹åŠ›ä¹‹ä¸­æ‰¾åˆ°æ…°è—‰ã€‚

å…¶æ¬¡ï¼Œçˆ±å¥½æœ‰åŠ©äºå¡‘é€ ä¸ªäººçš„ç‹¬ç«‹æ€§æ ¼ã€‚é€šè¿‡è¿½æ±‚è‡ªå·±çš„å…´è¶£ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‘ç°è‡ªæˆ‘ï¼ŒåŸ¹å…»ç‹¬ç‰¹çš„ä¸ªæ€§å’Œåˆ›é€ åŠ›ã€‚

å†è€…ï¼Œçˆ±å¥½å®Œå…¨å¯ä»¥åœ¨ç»æµèƒ½åŠ›å…è®¸çš„èŒƒå›´å†…è¿›è¡Œã€‚å®ƒä¸å¿…æ˜¯æ˜‚è´µçš„ï¼Œé‡è¦çš„æ˜¯æ‰¾åˆ°é‚£äº›èƒ½å¤Ÿå¸¦æ¥å¿«ä¹å’Œæˆå°±æ„Ÿçš„æ´»åŠ¨ï¼Œè€Œä¸å¿…è¿‡åˆ†è¿½æ±‚ç‰©è´¨ä¸Šçš„æŠ•å…¥ã€‚

æœ€åï¼Œå¦‚æœæ²¡æœ‰çˆ±å¥½ï¼Œæˆ‘ä¸ç¦è¦é—®ï¼Œäººæ´»ç€ç©¶ç«Ÿæ˜¯ä¸ºäº†å¿å—ç”Ÿæ´»çš„è‹¦æ¶©ï¼Œè¿˜æ˜¯ä¸ºäº†è¿½æ±‚é‚£äº›è®©æˆ‘ä»¬åšæŒä¸æ‡ˆçš„ç›®æ ‡ï¼Ÿçˆ±å¥½ä¸ä»…ä¸°å¯Œäº†æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬è¿½æ±‚å¹¸ç¦å’Œæ»¡è¶³æ„Ÿçš„é‡è¦é€”å¾„ã€‚

### ä¹”æ°åœ¨æ¨å¹¿ä¸­å¼å°çƒåŠ å…¥å¥¥è¿ä¼šæˆä¸ºä¸€é¡¹ä½“è‚²èµ›äº‹

æ›¾ç»æˆ‘ä»¬é¡¶ç€ç—å­è¿åŠ¨çš„å¸½å­ï¼Œåœ¨è¡—è¾¹åœ¨å··å°¾ä»»æ±—æ°´æŒ¥æ´’ï¼Œå¯¹äºå‡ºèº«é«˜è´µçš„æ–¯è¯ºå…‹ 9çƒï¼Œæˆ‘ä»¬åªèƒ½ä»°è§†ï¼Œæ‰è‡ªå—Ÿå‘€ï¼Œæˆ‘ä»¬çŠ¹å¦‚çŸ³ç¼ä¸­çš„å°è‰ï¼Œé¡¶ç€éš¾ä»¥å‡ºå¤´çš„é‡å‹ï¼Œæˆ‘ä»¬å‘å¾®å¼±å°è¢«å†·çœ¼æ­§è§†ï¼Œç”šè‡³é™©äº›è¢«æ— æƒ…æ‰¼æ€ï¼Œä¸ä¿Šæ™–æœ‰äº†è‡ªå·±çš„åˆ«å¢…ï¼Œæ½˜æ™“å©·çš„è·‘è½¦ä¹Ÿå¾ˆè±ªåã€‚å¯æˆ‘ä»¬ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œåªæœ‰å·¥ä½œä¹‹ä½™è‹¦è‹¦çš„ç»ƒçƒæµªè¿¹å¤©æ¶¯ï¼Œæˆ‘ä»¬ç”¨è‡ªå·±æ¥è¯æ˜è¿™é¡¹è¿åŠ¨çš„å­˜åœ¨ï¼Œå°å°½äººé—´çš„é…¸ç”œè‹¦è¾£ï¼Œå› ä¸ºçƒ­çˆ±ä½¿æˆ‘ä»¬å‰²èˆä¸ä¸‹ï¼Œå› ä¸ºæ¢¦æƒ³ä½¿æˆ‘ä»¬å†…å¿ƒæ— æ¯”å¼ºå¤§ï¼Œæˆ‘ä»¬å’¬ç‰™åšæŒï¼Œå­¤ç‹¬ç»ƒçƒï¼Œä»¤å¤šå°‘äººæ³ªç›®æ¿€æƒ…è¿¸å‘ï¼Œä¸€ä½å¤§å”å¬åˆ°äº†æˆ‘ä»¬ç—›è‹¦çš„å‘å–Šï¼Œä¹”æ°æ‰›èµ·å¤§æ——ä¸æˆ‘ä»¬å¹¶è‚©æ‹¼æ€ï¼Œä¹”æ°è®©æˆ‘ä»¬å……æ»¡äº†æ— å°½çš„å¸Œæœ›ï¼Œæˆ‘ä»¬è®©ä¹”æ°å¥‹åŠ›æ‹¼æï¼Œæ°¸ä¸æ”¾å¼ƒï¼Œç»ä¸å€’ä¸‹ï¼Œä¸€ç¾¤ä¸åƒå‘½è¿ä½å¤´çš„å›é€†è€…æ´»å‡ºäº†ä¸€å£æ°”ï¼Œé‡å‹ä¸‹æŒ¥å‡ºçš„æ¯ä¸€æ†éƒ½æ˜¯å¯¹å‘½è¿æ— å£°çš„å‡»æ‰“ã€‚è€Œè¿™ä½è€äººå´æŠŠè¿™é¡¹è¿åŠ¨æ¨å‘äº†ä¸–ç•Œå¥¥è¿çš„å£®ä¸¾æˆä¸ºäº†ä½³è¯ï¼Œä»æ­¤æˆ‘æ‰çŸ¥é“åŸæ¥å°çƒè¿åŠ¨å¯ä»¥è¿™æ ·ä¼Ÿå¤§ã€‚ä¹”æ°ä¸­å¼8çƒå¤§å¸ˆèµ›å·²ç»18å²äº†ï¼Œå®ƒç»ˆå°†åœ¨ä¸–ç•Œä½“è‚²èµ›äº‹ä¸­å‹‡é—¯å¤©æ¶¯ï¼Œä¸ºæˆ‘ä»¬è¿™äº›å‘å¾®çš„å°çƒçˆ±å¥½è€…æŠ¹å»é‚£ç—å­è¿åŠ¨çš„å¸½å­çš„åŒæ—¶æŠŠè¿™é¡¹è¿åŠ¨çš„å…‰è¾‰ç•™åœ¨ä¸–ç•Œå°å›çš„èšå…‰ç¯ä¸‹ã€‚


### å°çƒçš„æœªæ¥

è¿™é¡¹è¿åŠ¨è®©æˆ‘æ„Ÿå—åˆ°äº†å‰æ‰€æœªæœ‰çš„å…¬å¹³ç«æŠ€,å…¨å‡­å®åŠ›è¯´è¯,å…¶ä¸­åŒ…å«å¾ˆå¤šæŠ€æœ¯æŠ€å·§å’ŒçŸ¥è¯†, æ™®é€šäººçœ‹æ¥ä¼°è®¡ä¹Ÿå°±æ˜¯å‡ æ ¹æœ¨å¤´æ£å­åŠ ä¸€å¼ ç»¿è‰²å°æ³¥çš„æ¡ˆæ¿è€Œå·², å…¶å®è¿™é‡Œé¢æœ‰å¾ˆå¤šæœºä¼šç­‰å¾…æŒ–æ˜,æ¯”å¦‚ç”Ÿäº§è´¨é‡æœ€å¥½çš„èƒ¶è¾¹æ¥è‡ª[ä¸­å›½æŒ¯å®èƒ¶è¾¹](http://www.j-hrubber.com/)(å°±æ˜¯çƒå²¸çš„æ©¡èƒ¶æ¡),ç”Ÿäº§çš„å¥½å°å°¼çš„å‚å®¶ä¸­å›½çš„[åˆ©ç™¾æ–‡](https://www.liberwintex.com/)å’Œ[è‹±å›½ä¸–åˆ›6811](https://strachan.co/zh-hans/), çƒæ†å„ç§å“ç‰Œéƒ½è¢«èŒä¸šé€‰æ‰‹å……å€¼äº†,ä¸è¿‡ä¹Ÿæœ‰å¾ˆå¤šå¥½çš„, æ¯”å¦‚ çš®å°”åŠ›ã€ææ–¯çƒé¦†ã€å…°è”»å„ç§å“ç‰Œå°±å’Œæ±½è½¦ä¸€æ ·åº”æœ‰å°½æœ‰, è¿™é‡Œé¢è¿˜æœ‰ä¸€äº›ç”Ÿäº§çš®å¤´å’Œå·§ç²‰çš„ä¼ä¸š,æ¯”å¦‚å°éº¦çš®å¤´ï¼ŒHRå·§ç²‰ç­‰.å…¶å®ä¸æ·±å…¥è¿™è¡Œä¸šæ ¹æœ¬ä¸äº†è§£è¿™è¡Œä¸šçš„ä¾›åº”é“¾,ç”šè‡³é’çŸ³æ¿çš„ä¾›åº”å•†ã€æ¯”åˆ©æ—¶è¿›å£çš„é›…ä¹ç¾TVçƒ. æœ€è¿‘è¿™å‡ å¹´å¾ˆæµè¡Œçš„ äº’ä¹‰ç¯å…·(ä¸“é—¨ç”Ÿäº§å°çƒçƒå°ä¸Šæ–¹çš„æ— å½±ç¯ä¼ä¸š) è¿˜æœ‰åƒç››åˆ©è€…æ²™å‘,ä¸“é—¨ç”Ÿäº§ å°çƒä¸“ç”¨æ²™å‘. 

è¿™æ˜¯ä¸€é—¨å†…è¡Œäººçš„ç”Ÿæ„,æˆ‘ä»¬æ€»è¯´è‡ªå·±åœ¨ç›®å‰çš„å°±ä¸šå‹åŠ›ä¸‹å¾ˆéš¾æ‰¾åˆ°è‡ªå·±çš„ç¬¬äºŒæ›²çº¿,æˆ‘æƒ³è¯´æ— è®ºå•¥æ›²çº¿éƒ½éœ€è¦èŠ±æ—¶é—´å’Œç²¾åŠ›å»äº†è§£å’Œæ·±å…¥ç ”ç©¶å­¦ä¹ ,å“ªä¸ªæ›²çº¿éƒ½æ˜¯ç•™ç»™æœ‰å‡†å¤‡çš„äºº.


## ä¹°æˆ¿

å¹´åˆçš„æ—¶å€™åœ¨åŒ—äº¬å¤§å…´åŒºä¹°äº†ä¸€å¥—å…±æœ‰äº§æƒæˆ¿,é¦–å…ˆéšç€æˆ¿åœ°äº§æ”¿ç­–é€æ¸æ”¾å¼€,å„ç§æ”¿ç­–çš„åˆºæ¿€ä¸‹,æˆ‘ä¸å¾—ä¸è€ƒè™‘åœ¨åŒ—äº¬é•¿æœŸç”Ÿæ´»

å…ˆè¯´è¯´æˆ‘éƒ½èµ¶ä¸Šå“ªäº›æ”¿ç­–äº†å§

* é™æˆ¿ä¸ç°å•†è´·(ä¹‹å‰çš„æ”¿ç­–:å°±æ˜¯å¦‚æœä½ åœ¨å…¨å›½å„åœ°åªè¦æœ‰ä¸€å¤„æˆ¿äº§æœ‰è´·æ¬¾,åŸºæœ¬éƒ½æ˜¯å•†è´·,åœ¨åŒ—äº¬å°±ä¼šé¦–ä»˜80%æ‰èƒ½ä¹°æˆ¿, è¿™é¡¹æ”¿ç­–æ”¾å¼€å,ä»…é™åŒ—äº¬åœ°åŒºçš„å•†è´·äº†)ä¹Ÿå°±æ˜¯è¯´ åœ¨å¤–åœ°ç”¨è¿‡å•†è´·å’Œåœ¨åŒ—äº¬ä¹°æˆ¿æ²¡æœ‰ç›´æ¥é™åˆ¶äº†.
* ç›‘ç®¡è´¦æˆ· (é¦–ä»˜æ¬¾ç›´æ¥æ‰“åˆ°å¼€å‘å•†å’Œæ”¿åºœç›‘ç®¡çš„è´¦æˆ·,é˜²æ­¢æˆ¿åœ°äº§å•†æš´é›· çƒ‚å°¾) è¿™ä¹Ÿæ˜¯è¿™å‡ å¹´ç»å¸¸å‡ºç°çš„é—®é¢˜å¯¼è‡´çš„æ”¿åºœä¸å¾—ä¸å‡ºæ‰‹ æ•´æ²»å¼€å‘å•†çš„æ”¿ç­–ä¹‹ä¸€,èµ„é‡‘ç´§äº†ç›‘ç®¡è´¦æˆ· åªæœ‰å°é¡¶æ‰èƒ½ç»™å¼€å‘å•†æ”¾æ¬¾çš„æ“ä½œä¹Ÿç€å®å‡»æºƒäº†å¾ˆå¤šçƒ‚å°¾æ¥¼åœ°äº§å•†.
* åˆ©ç‡ä¸‹è°ƒ å…¬ç§¯é‡‘åˆ©ç‡ 5å¹´æœŸä»¥ä¸Š 2.85% è¿™åˆ©ç‡ å·²ç»è¿œæ¯”ä¹‹å‰çš„å•†è´· 4.9%ä½å¤ªå¤šäº†.
* ç»¿è‰²å»ºç­‘å…¬ç§¯é‡‘é¢åº¦ä¸Šæµ® (è¿™ä¸ªå’Œå¼€å‘å•†å»ºè®¾æœ‰å…³ç³» å»ºè®¾çš„ç¬¦åˆå›½å®¶è§„å®šçš„äºŒçº§å»ºç­‘ ) è¿™ä¸ªæˆ‘æœ€åæ²¡ç”¨ä¸Š
* åŒ—äº¬äº”ç¯å¤– è¿ç»­ç¤¾ä¿ 3å¹´å³å¯ï¼Œè¿™ä¸ªæˆ‘ä¹Ÿæ²¡ç”¨ä¸Š,æˆ‘ç”¨çš„æ˜¯å·¥ä½œå±…ä½è¯æ²¡æœ‰è¿™ä¸ªé™åˆ¶.  
...

åæ¥åˆå‡ºäº†å¾ˆå¤šæŒ¤ç‰™è†çš„æ”¿ç­–æˆ‘å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†,æˆ‘å°±è¯´ä¸€ç‚¹å¤§å®¶çœ‹ä¸åˆ°çš„èƒŒé¢å§ï¼š

åœ¨åŒ—äº¬ä¹°æˆ¿å¦‚æœä½ ç”¨å…¬ç§¯é‡‘è´·æ¬¾ é‚£ä¹ˆä½ è¦ä¿è¯ä½ åŠå¹´å†…ä¸å¤±ä¸š,å› ä¸ºåŒ—äº¬å…¬ç§¯é‡‘ä»å°é¡¶åˆ°äº¤æˆ¿ ä¹Ÿå°±ä¸€ä¸ªæœˆå†…å°±è¦åŠå¥½,æˆ‘ä»å¹´åˆåˆ†ç»„æ‘‡å·é€‰æˆ¿åˆ°æœ€ååŠå®Œå…¬ç§¯é‡‘æ”¾æ¬¾ç”¨äº†æ•´æ•´åŠå¹´, å‰å‡ ä¸ªæœˆæ˜¯æˆ¿å­å°é¡¶,æœ€åä¸€ä¸ªæœˆæ˜¯åŠå…¬ç§¯é‡‘,æˆ‘æƒ³è¯´è¿™ä¸­é€”è¦æ˜¯å¤±ä¸šçš„è¯å…¬ç§¯é‡‘çŠ¶æ€å˜æˆå°å­˜é‚£ä¹ˆæ­å–œä½ ä¼°è®¡å•¥æˆ¿è´·ä½ ä¹ŸåŠä¸ä¸‹æ¥äº†,ä½ å‡ ä¹è¢«ç¤¾ä¼šæŠ›å¼ƒäº†ä¸€æ ·,å•†è´·çœ‹ä½ æ²¡æœ‰ç¨³å®šå·¥ä½œä¸æ•¢æ”¾è´·ç»™ä½ ,å…¬ç§¯é‡‘è´¦æˆ·å°å­˜å¾—ä¸‹å®¶å…¬å¸ç»™ä½ ç¼´çº³æ—¶æ‰èƒ½ç»™ä½ çŠ¶æ€å˜æˆç¼´å­˜,ä½ æ€ä¹ˆä¿è¯ä½ åœ¨çŸ­æ—¶é—´å†…æ‰¾åˆ°ä¸€ä»½èƒ½ç»™è‡ªå·±ç¼´çº³äº”é™©ä¸€é‡‘çš„å…¬å¸,è¿™ä¸ç¡®å®šæ€§å¤ªå¼ºäº†å§! å¹¶ä¸”ä½ é€šè¿‡ä»£ç¼´çš„æ–¹å¼ç¼´çº³å¥½åƒä¹Ÿä¸é è°±å§! æ€»ä¹‹æˆ‘è§‰å¾—åœ¨ç›®å‰çš„ç»æµå½¢åŠ¿å¾ˆå·®åŠ²çš„æ—¶å€™æ²¡æœ‰å‹‡æ°”å’Œå®åŠ› ä¸è¦å°è¯•è¿™ä¸ªæ“ä½œ,éå¸¸å·®åŠ². è¿˜å¥½æˆ‘ç›®å‰çš„å…¬å¸æ²¡æœ‰ç»™æˆ‘å¤§ç¤¼åŒ…æ•´èµ°,å¦åˆ™æˆ‘å°±æ˜¯åœ¨æ‹¿è‡ªå·±å½“ä¾‹å­ç»™å„ä½è®²ç¬‘è¯äº†,çœ‹åˆ°è¿™å„ä½ä»¥ä¸ºæˆ‘åœ¨è®²ç¬‘è¯,æˆ‘æƒ³è¯´è¿™å°±æ˜¯éå¸¸å®¢è§‚çš„ç°å®æ²¡æœ‰ä¸€ç‚¹ç©ç¬‘,

è¿™ç§æ–¹å¼æˆ‘è®¤ä¸ºå¯ä»¥ç»™å›½å®¶æææ„è§,è¿™ç§æ–¹å¼å¯¹å¤±ä¸šç¾¤ä½“éå¸¸ä¸å‹å¥½,è°èƒ½ä¿è¯è‡ªå·±å·¥ä½œå¾ˆç¨³å®š,åœ¨å½“ä¸‹æ²¡æœ‰äººèƒ½æ•¢ä¿è¯è‡ªå·±ç¨³å®š, è¿™ç§çŠ¶æ€ä¸‹å»ä¹°æˆ¿è°ä¼šå»ä¹°é‚£ä¸æœ‰ç—…å—? å·¥ä½œæ”¶å…¥ä¸ç¨³å®šæœ‰å‡ ä¸ªäººæ„¿æ„å†’é™©ä¸€è¯•æ‰¾åˆºæ¿€.

![](/assets/images/20241231FinalSummary/gjj.webp)  

ç»è¿‡æ­¤æ¬¡ä¹°æˆ¿è®©æˆ‘è§‰å¾—å¥½é™©å¥½é™©,æ²¡é’±çš„ç©·äººåœ¨åŒ—äº¬ä¹°æˆ¿çœŸçš„æ˜¯ä¸€é¡¹å·¨å¤§çš„æŒ‘æˆ˜. çœŸçš„ä¸çŸ¥é“å¤±ä¸šå’Œæ˜å¤©å“ªä¸ªå…ˆæ¥!æ²¡æœ‰çˆ¶æ¯ä¸ºè‡ªå·±ç”Ÿæ´»å…œåº•,è¿™ä¸ªå›½å®¶åˆä¸€æ¬¡æ€§æ‹¿èµ°å¹´è½»äººçš„å…¨éƒ¨æ”¶å…¥ç”šè‡³æç©ºçˆ¶æ¯çš„é’±åŒ…,å°±è¿™æ ·è¿˜èƒ½æœ‰ä»€ä¹ˆæ¶ˆè´¹,ç»æµå²‚èƒ½å‘å¥½ï¼Œç»æµåªèƒ½åœæ»ä¸å‰.


# æ€»ç»“

2024å¹´æˆ‘çœŸåˆ‡çš„æ„Ÿå—åˆ°äº†è‡ªå·±å¾ˆç©·,èƒ½ä¿®å¥½çš„ä¸œè¥¿ç»ä¸ä¼šæ¶ˆè´¹å»ä¹°æ–°çš„,è¿™ä¸€å¹´å³ä¾¿ä¸–ç•Œæ ¼å±€å¦‚ä½•å˜åŒ–åŠ¨è¡,ç”Ÿæ´»åœ¨å¤¹ç¼ä¸­çš„è‡ªå·± ä¸€ç›´åœ¨å·¦å³æ‘‡æ‘†ä¸­ç»å¤„é€¢ç”Ÿ.

2024å¹´å‘è¡¨äº†å¾ˆå¤šå¾ˆæ°´çš„æ–‡ç« ,æœ‰çš„ä¸å€¼å¾—ä¸€æå®Œå…¨å°±æ˜¯é˜²æ­¢å¿˜äº†æ‰¾ä¸åˆ°,å·¥ä½œå¾ˆå¿™åŠ ä¸Šå®¶é‡Œå°æœ‹å‹å æ®äº†å¾ˆå¤šä¸šä½™æ—¶é—´,æˆ‘ç°åœ¨éƒ½è§‰å¾—å­¦ä¹ æœ€å¥½çš„åœ°æ–¹æ˜¯ åœ°é“8å·çº¿. ä¸Šç­çš„è·¯ä¸Šæ¥å›ä¸¤ä¸ªå°æ—¶è‡³å°‘50%çš„æ—¶é—´ä¸æ˜¯æ¶ˆè´¹ç»™åƒåœ¾è§†é¢‘,è€Œæ˜¯åœ¨é’»ç ”æŠ€æœ¯,è™½ç„¶åˆ«äººçœ‹ç€æ¯«æ— ä¹è¶£, å…¶å®è‡ªå·±è¿™ç®—æ˜¯åœ¨è‹¦ä¸­ä½œä¹å§!å…¨å½“è¡Œä¸šèƒ½ç»§ç»­å‘å±•ç»™è‡ªå·±çš„æŠ€æœ¯æŠ¤åŸæ²³æŒ–æŒ–æ›´æ·±çš„æ²Ÿæ¸ .è™½ç„¶ç›®å‰ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæœ€ä¼˜è§£èƒ½è§£å†³æ­¤é—®é¢˜,ä¸è¿‡è¿˜åœ¨å°è¯•æ–°çš„æ–¹å¼å¯»æ‰¾æœ€ä¼˜è§£

2024å¹´å·¥ä½œä¸­å·å‡ºæ–°é«˜åº¦åœ¨ç›®å‰çš„æ—¶ä»£èƒŒæ™¯ä¸‹æˆä¸ºäº†æµè¡Œè¶‹åŠ¿,æœªæ¥å‡ å¹´ä¼°è®¡æ¯”è¿™æ›´å·®åŠ²,æˆ‘å‡ ä¹æ˜¯ä¸æŠ¥ä»€ä¹ˆå¥½çš„å¸Œæœ›çš„æ¶ˆæç¤¾ä¼šåˆ†å­.

å·®ä¸å¤šå°±åˆ°è¿™å§! 2025å¹´ æ€»è¦æœ‰æ‰€æœŸç›¼, æˆ‘çš„æœŸç›¼æ˜¯æŠŠMetalå­¦å®Œç”¨èµ·æ¥å°±è¿™ä¹ˆç®€å•. å› ä¸ºè´«ç©·æ”¹å˜ä¸äº†,ç°çŠ¶æ”¹å˜ä¸äº†,è´¢å¯Œè‡ªç”±é‚£æ˜¯åšæ¢¦ï¼Œèµšæ›´å¤šé’±é‚£ä¹Ÿå‡ ä¹æ‰¯æ·¡,å”¯ä¸€å¯æ§çš„æ˜¯è‡ªå·±è¿˜èƒ½åšæŒä¸æ‡ˆçš„å­¦ä¹ æé«˜è®¤çŸ¥ æ‰æ˜¯è§£å†³ä¸Šè¿°é—®é¢˜çš„æœ€ä¼˜è§£.

æœ€åæ”¾ä¸Šæˆ‘åœ¨ã€Šç›é“è®ºã€‹è¯»åˆ°æœ€æœ‰ç”¨çš„ä¸¤å¥è¯å§!

![](/assets/images/20241231FinalSummary/yantielun.webp)  

2024å†è§.


URL: https://sunyazhou.com/2024/11/coretextcalculatedheight/index.html.md
Published At: 2024-11-06 02:25:00 +0000

# CoreTextæ¸²æŸ“å­—ä½“çš„æ—¶å¦‚ä½•è®¡ç®—å­—ä½“æ‰€éœ€è¦çš„é«˜åº¦?

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

ä¸»è¦æ˜¯ä½¿ç”¨ `CTFramesetterSuggestFrameSizeWithConstraints` è®¡ç®—æ–‡æœ¬çš„é«˜åº¦å’Œå®½åº¦ï¼Œè®°å¾—è¦ç»™`CTFramesetterRef` è®¾ç½®ç›¸å…³çš„å±æ€§ï¼ˆè¡Œé—´è·å’Œè‡ªåŠ¨æ¢è¡Œï¼‰ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ CoreText ç»˜åˆ¶å¹¶è®¡ç®—æ–‡æœ¬é«˜åº¦çš„Â Objective-CÂ ä»£ç ç¤ºä¾‹:


``` objc
- (void)calculatedHeight:(CGSize)bounds
{
    NSString *text = @"This\nis\nsome\nmulti-line\nsample\ntext.";
    UIFont   *uiFont = [UIFont fontWithName:@"Helvetica" size:17.0];
    CTFontRef ctFont = CTFontCreateWithName((CFStringRef) uiFont.fontName, uiFont.pointSize, NULL);

    // è®¾ç½®è¡Œé—´è·
    CGFloat leading = uiFont.lineHeight - uiFont.ascender + uiFont.descender;
    CTParagraphStyleSetting LineSpacing;
        
    LineSpacing.spec = kCTParagraphStyleSpecifierLineSpacingAdjustment;
    LineSpacing.value = &leading;
    LineSpacing.valueSize = sizeof(CGFloat);
        
    // è®¾ç½®æ¢è¡Œæ¨¡å¼
    CTParagraphStyleSetting lineBreakMode;
    CTLineBreakMode lineBreak = kCTLineBreakByCharWrapping;
    lineBreakMode.spec = kCTParagraphStyleSpecifierLineBreakMode;
    lineBreakMode.value = &lineBreak;
    lineBreakMode.valueSize = sizeof(CTLineBreakMode);

    CTParagraphStyleSetting paragraphSettings[] = {lineBreakMode,LineSpacing};

    CTParagraphStyleRef  paragraphStyle = CTParagraphStyleCreate(paragraphSettings, 2);
    CFRange textRange = CFRangeMake(0, text.length);

    CFMutableAttributedStringRef string = CFAttributedStringCreateMutable(kCFAllocatorDefault, text.length);
    CFAttributedStringReplaceString(string, CFRangeMake(0, 0), (CFStringRef) text);

    // è®¾ç½®å­—ä½“è¡Œé—´è·å’Œå¤§å°
    CFAttributedStringSetAttribute(string, textRange, kCTFontAttributeName, ctFont);
    CFAttributedStringSetAttribute(string, textRange, kCTParagraphStyleAttributeName, paragraphStyle);

    CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString(string);
    CFRange fitRange;

    // è®¡ç®—æ–‡æœ¬éœ€è¦çš„é«˜åº¦
    CGSize frameSize = CTFramesetterSuggestFrameSizeWithConstraints(framesetter, textRange, NULL, bounds, &fitRange);

    CFRelease(framesetter);
    CFRelease(string);
}
```


# æ€»ç»“

è®°å½•ä¸€äº›å®¹æ˜“é—å¿˜çš„ä»£ç 


URL: https://sunyazhou.com/2024/11/armthreadstate/index.html.md
Published At: 2024-11-04 02:31:00 +0000

# iOSçš„dSYMä¸­ARM Thread Stateå¯„å­˜å™¨æœ‰å“ªäº›ï¼Ÿ

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# èƒŒæ™¯

å¾ˆä¹…ä»¥å‰è®°å¾—å¾ˆå¤šäººç»å¸¸é¢è¯•å–œæ¬¢é—® iOSçš„dSYMä¸­ARM Thread Stateçš„å¯„å­˜å™¨æœ‰å“ªäº›,åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€?

åŸºäºä¸€æ®µæ•°æ® æˆ‘ä»¬ç®€å•è®°å½•ä¸€ä¸‹è¿™ä¸ªé—®é¢˜

``` sh
Thread 0 crashed with ARM Thread State (64-bit):
x0:000000000000000000
x1:000000000000000000
x2:0x000000016bd31ce0
x3:0x000000016bd31d20
x4:0x0000000000000010
x5:0x00000000000022e0
x6:0x00000002817762e0
x7:0x00000000000000f0
x8:0x0000000281f7b930
x9:0x00000000000006bb
x10:0x000000018aa49cf8
x11:0x00ff0001238cf400
x12:0x00000000000000b5
x13:0x00000001238cff40
x14:0x02000001e0ad6c89
x15:0x00000001e0ad6c88
x16:0x00000001d8922e40
x17:0x00000001122301e8
x18:000000000000000000
x19:0x000000016bd31cc0
x20:000000000000000000
x21:000000000000000000
x22:0x000000011222c21a
x23:0x000000018652ddb0
x24:000000000000000000
x25:0x000000028115e880
x26:0x000000010d8ca6ed
x27:0x0000000281328930
x28:0x0000000000000001
fp:0x000000016bd31c60
lr:0x0000000112216898
sp:0x000000016bd31c30
pc:0x00000001d8922e44
cpsr:0x0000000060001000
```

è¿™æ˜¯ä¸€æ®µçº¿ç¨‹å´©æºƒåçš„çš„ ä¸»çº¿ç¨‹crash çš„çº¿ç¨‹çŠ¶æ€

## ARM Thread Stateå¯„å­˜å™¨å«ä¹‰

åœ¨iOSçš„dSYMä¸­ï¼ŒARM Thread Stateå¯„å­˜å™¨æä¾›äº†ç¨‹åºå´©æºƒæ—¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦å¯„å­˜å™¨çš„å«ä¹‰ï¼š

- **x0-x30**ï¼šè¿™äº›æ˜¯é€šç”¨å¯„å­˜å™¨ï¼Œç”¨äºå­˜å‚¨ä¸´æ—¶æ•°æ®ã€‚åœ¨å‡½æ•°è°ƒç”¨ä¸­ï¼Œx0-x7é€šå¸¸ç”¨äºä¼ é€’å‚æ•°ï¼Œè€Œx19-x28åˆ™ç”¨äºä¿å­˜å±€éƒ¨å˜é‡å’Œå‡½æ•°çš„è¿”å›åœ°å€ã€‚
- **fp (Frame Pointer)**ï¼šå¸§æŒ‡é’ˆå¯„å­˜å™¨ï¼Œé€šå¸¸ç”¨äºæŒ‡å‘å½“å‰å‡½æ•°çš„æ ˆå¸§ï¼Œä»¥ä¾¿äºå‡½æ•°è°ƒç”¨å’Œè¿”å›æ—¶æ ˆçš„ç®¡ç†å’Œè®¿é—®å±€éƒ¨å˜é‡ã€‚
- **lr (Link Register)**ï¼šé“¾æ¥å¯„å­˜å™¨ï¼Œå­˜å‚¨ç€å‡½æ•°è°ƒç”¨è¿”å›åçš„åœ°å€ï¼Œå³ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚
- **sp (Stack Pointer)**ï¼šæ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼ŒæŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆé¡¶ã€‚
- **pc (Program Counter)**ï¼šç¨‹åºè®¡æ•°å™¨ï¼ŒæŒ‡å‘ä¸‹ä¸€æ¡è¦æ‰§è¡Œçš„æŒ‡ä»¤åœ°å€ã€‚
- **cpsr (Current Program Status Register)**ï¼šå½“å‰ç¨‹åºçŠ¶æ€å¯„å­˜å™¨ï¼ŒåŒ…å«å¤„ç†å™¨çš„çŠ¶æ€å’Œæ§åˆ¶ä½ï¼Œå¦‚æ¡ä»¶æ ‡å¿—ä½ã€ä¸­æ–­ä½¿èƒ½ä½ç­‰ã€‚

åœ¨æ‚¨æä¾›çš„å´©æºƒæ—¥å¿—ä¸­ï¼Œpcå¯„å­˜å™¨çš„å€¼ä¸º`0x00000001d8922e44`ï¼Œè¿™é€šå¸¸æŒ‡å‘å¯¼è‡´å´©æºƒçš„æŒ‡ä»¤åœ°å€ã€‚æ‚¨å¯ä»¥ä½¿ç”¨`atos`å‘½ä»¤ç»“åˆdSYMæ–‡ä»¶æ¥è§£æè¿™ä¸ªåœ°å€å¯¹åº”çš„ä»£ç ä½ç½®ï¼Œä¾‹å¦‚ï¼š

``` bash
atos -arch arm64 -o YourApp.app.dSYM/Contents/Resources/DWARF/YourApp -l 0xXXXXXXXX 0xXXXXXXXX
```

å…¶ä¸­-arch arm64æŒ‡å®šäº†æ¶æ„ï¼Œ-oåé¢è·Ÿç€çš„æ˜¯dSYMæ–‡ä»¶çš„è·¯å¾„ï¼Œ-låé¢è·Ÿç€çš„æ˜¯çº¿ç¨‹å·å’Œpcå¯„å­˜å™¨çš„å€¼ã€‚è¿™æ ·å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°å´©æºƒå‘ç”Ÿæ—¶æ­£åœ¨æ‰§è¡Œçš„ä»£ç è¡Œã€‚

## å¦‚ä½•è§£æARM Thread Stateå¯„å­˜å™¨ä¸­çš„`pc`å€¼ï¼Ÿ

è§£æARM Thread Stateå¯„å­˜å™¨ä¸­çš„`pc`ï¼ˆProgram Counterï¼‰å€¼é€šå¸¸æ¶‰åŠåˆ°ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š

1.**è·å–å´©æºƒæ—¶çš„`pc`å€¼**ï¼š
 
 è¿™æ˜¯å¯¼è‡´ç¨‹åºå´©æºƒçš„æŒ‡ä»¤çš„å†…å­˜åœ°å€ã€‚åœ¨ä½ çš„å´©æºƒæ—¥å¿—ä¸­ï¼Œ`pc`çš„å€¼æ˜¯`0x00000001d8922e44`ã€‚

2.**è·å–åº”ç”¨ç¨‹åºçš„dSYMæ–‡ä»¶**ï¼š
   
 dSYMæ–‡ä»¶åŒ…å«äº†åº”ç”¨ç¨‹åºçš„è°ƒè¯•ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç¬¦å·è¡¨ï¼Œè¿™äº›ç¬¦å·è¡¨å°†å†…å­˜åœ°å€æ˜ å°„åˆ°æºä»£ç ä¸­çš„å‡½æ•°å’Œè¡Œå·ã€‚ç¡®ä¿ä½ æœ‰å¯¹åº”å´©æºƒæ—¶åº”ç”¨ç¨‹åºç‰ˆæœ¬çš„dSYMæ–‡ä»¶ã€‚

3.**ä½¿ç”¨è°ƒè¯•å·¥å…·è§£æåœ°å€**ï¼š
 
 ä½ å¯ä»¥ä½¿ç”¨Xcodeçš„è°ƒè¯•å·¥å…·ï¼Œæˆ–è€…å‘½ä»¤è¡Œå·¥å…·å¦‚`atos`ï¼ˆAddress to Symbolï¼‰æ¥å°†`pc`å€¼è½¬æ¢ä¸ºæºä»£ç ä¸­çš„å‡½æ•°åå’Œè¡Œå·ã€‚

ä½¿ç”¨`atos`çš„å‘½ä»¤è¡Œç¤ºä¾‹å¦‚ä¸‹ï¼š

``` bash
atos -arch arm64 -o YourApp.app.dSYM/Contents/Resources/DWARF/YourApp -l 0xXXXXXXXXXXXXXXXX 0xXXXXXXXXXXXXXXXX   
```

å…¶ä¸­ï¼š

* `-arch arm64` æŒ‡å®šäº†æ¶æ„ç±»å‹ã€‚
* `-o` åé¢è·Ÿç€çš„æ˜¯ä½ çš„åº”ç”¨ç¨‹åºçš„dSYMæ–‡ä»¶è·¯å¾„ã€‚
* ` -l` åé¢è·Ÿç€çš„æ˜¯çº¿ç¨‹å·å’Œpcå¯„å­˜å™¨çš„å€¼ã€‚

è¯·å°†YourApp.app.dSYM/Contents/Resources/DWARF/YourAppæ›¿æ¢ä¸ºä½ çš„å®é™…dSYMæ–‡ä»¶è·¯å¾„ï¼Œå°†0xXXXXXXXXXXXXXXXXå’Œ0xXXXXXXXXXXXXXXXXæ›¿æ¢ä¸ºä½ çš„å®é™…çº¿ç¨‹å·å’Œpcå€¼ã€‚

4.åˆ†æç»“æœï¼š
atoså‘½ä»¤ä¼šè¾“å‡ºå¯¼è‡´å´©æºƒçš„å‡½æ•°åå’Œè¡Œå·ã€‚ä¾‹å¦‚ï¼š

``` bash
0x00000001d8922e44: -[YourViewController yourMethod] (YourViewController.m:123)
```   

è¿™è¡¨æ˜å´©æºƒå‘ç”Ÿåœ¨YourViewControllerç±»çš„yourMethodæ–¹æ³•ä¸­ï¼Œä½äºYourViewController.mæ–‡ä»¶çš„ç¬¬123è¡Œã€‚

5.è°ƒè¯•å’Œä¿®å¤ï¼š
æ ¹æ®è§£æå‡ºçš„å‡½æ•°åå’Œè¡Œå·ï¼Œä½ å¯ä»¥åœ¨æºä»£ç ä¸­å®šä½åˆ°å…·ä½“çš„ä»£ç ä½ç½®ï¼Œè¿›ä¸€æ­¥åˆ†æå’Œä¿®å¤å¯¼è‡´å´©æºƒçš„é—®é¢˜ã€‚

# æ€»ç»“

è®°å½•ä¸€ä¸‹å®¹æ˜“è¢«é—å¿˜çš„å†…å®¹, å¸®åŠ©ä¿®å¤å·¥ç¨‹ä¸­crashçš„é—®é¢˜


URL: https://sunyazhou.com/2024/10/swiftuiimage/index.html.md
Published At: 2024-10-28 10:35:00 +0000

# SwiftUIä¸­çš„Imageä¿®æ”¹å™¨(è§†å›¾ä¿®é¥°ç¬¦)æœ‰å“ªäº›ï¼Ÿ

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


åœ¨SwiftUIä¸­ï¼ŒImageè§†å›¾å¯ä»¥ç”¨æ¥æ˜¾ç¤ºå›¾ç‰‡èµ„æºã€‚ä½ å¯ä»¥é€šè¿‡å¤šç§ä¿®æ”¹å™¨ï¼ˆå³è§†å›¾ä¿®é¥°ç¬¦ï¼‰æ¥æ”¹å˜Imageçš„å¤–è§‚å’Œè¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„Imageä¿®æ”¹å™¨ï¼š

* 1.`nterpolation`ï¼šè®¾ç½®å›¾ç‰‡çš„æ’å€¼æ–¹å¼ï¼Œç”¨äºå®šä¹‰å›¾ç‰‡ç¼©æ”¾æ—¶çš„æ¸²æŸ“è´¨é‡ã€‚  
	
	``` swift
	Image("example")
	    .interpolation(.medium)	
	```
* 2.`resizable`ï¼šä½¿å›¾ç‰‡å¯æ‹‰ä¼¸ï¼Œé€šå¸¸ä¸.aspectRatioç»“åˆä½¿ç”¨ä»¥ä¿æŒå›¾ç‰‡çš„åŸå§‹å®½é«˜æ¯”ã€‚  

	``` swift
	Image("example")
	    .resizable()
	```

* 3.`aspectRatio`ï¼šè®¾ç½®å›¾ç‰‡çš„å®½é«˜æ¯”ï¼Œå¯ä»¥æ˜¯å›ºå®šå€¼æˆ–ä»å›¾ç‰‡æœ¬èº«ç»§æ‰¿ã€‚

	``` swift
	Image("example")
		.aspectRatio(contentMode: .fit)
	```
* 4.`frame`ï¼šè®¾ç½®å›¾ç‰‡çš„å›ºå®šå¤§å°ã€‚
	
	``` swift
	Image("example")
  		.frame(width: 100, height: 100)
	```
* 5.`clipped`ï¼šå†³å®šæ˜¯å¦è£å‰ªå›¾ç‰‡ä»¥é€‚åº”æŒ‡å®šçš„å°ºå¯¸ã€‚
	
	``` swift
	Image("example")
		.clipped()
	```
* 6.`antialiased`ï¼šè®¾ç½®æ˜¯å¦å¯¹å›¾ç‰‡è¿›è¡ŒæŠ—é”¯é½¿å¤„ç†ã€‚

	``` swift
	Image("example")
   		.antialiased()
	```
* 7.`renderingMode`ï¼šæ”¹å˜å›¾ç‰‡çš„æ¸²æŸ“æ¨¡å¼ï¼Œæ¯”å¦‚.originalã€.templateç­‰ã€‚

	``` swift
	Image("example")
	    .renderingMode(.template)
	```
* 8.`opacity`ï¼šè®¾ç½®å›¾ç‰‡çš„é€æ˜åº¦ã€‚

	``` swift
	Image("example")
		.opacity(0.5)
	```
* 9.`overlay`ï¼šåœ¨å›¾ç‰‡ä¸Šè¦†ç›–å¦ä¸€ä¸ªè§†å›¾ã€‚

	``` swift
	Image("example")
		.overlay(Circle().foregroundColor(.red))
	```
* 10.`background`ï¼šåœ¨å›¾ç‰‡èƒŒåè®¾ç½®ä¸€ä¸ªèƒŒæ™¯é¢œè‰²æˆ–å¦ä¸€ä¸ªè§†å›¾ã€‚
	
	``` swift
	Image("example")	
		.background(Color.gray)
	```
* 11.`clipShape`ï¼šå°†å›¾ç‰‡è£å‰ªæˆç‰¹å®šå½¢çŠ¶ï¼Œæ¯”å¦‚åœ†å½¢ã€çŸ©å½¢ç­‰ã€‚

	``` swift
	Image("example")
		.clipShape(Circle())	
	```
* 12.`mask(shape:)`ï¼šä½¿ç”¨å¦ä¸€ä¸ªè§†å›¾çš„å½¢çŠ¶æ¥è£å‰ªå›¾ç‰‡ã€‚
	
	``` swift
	Image("example")
		.mask(Circle())
	```
* 13.`padding`ï¼šåœ¨å›¾ç‰‡å‘¨å›´æ·»åŠ å†…è¾¹è·ã€‚
	
	``` swift
	Image("example")
		.padding()
	```
* 14.`contentShape`ï¼šä¸ºå›¾ç‰‡æŒ‡å®šä¸€ä¸ªéšå«çš„è½®å»“ï¼Œè¿™åœ¨äº¤äº’è®¾è®¡ä¸­å¾ˆæœ‰ç”¨ã€‚

	``` swift
	Image("example")
		.contentShape(Rectangle())
	```
	
* 15.`onTapGesture`ï¼šä¸ºå›¾ç‰‡æ·»åŠ ç‚¹å‡»æ‰‹åŠ¿è¯†åˆ«ã€‚

	``` swift
	Image("example")
		.onTapGesture {
        	print("Image tapped")
    	}
	```
* 16.`scaledToFit()`ï¼šå°†å›¾ç‰‡ç¼©æ”¾ä»¥é€‚åº”å…¶çˆ¶è§†å›¾ï¼ŒåŒæ—¶ä¿æŒå…¶å®½é«˜æ¯”ã€‚

	``` swift
	Image("example")
		.resizable()
		.frame(width: 100, height: 100)
	```
* 17.`scaledToFill()`ï¼šå°†å›¾ç‰‡ç¼©æ”¾ä»¥å¡«å……å…¶çˆ¶è§†å›¾ï¼Œå¯èƒ½ä¼šè£å‰ªå›¾ç‰‡çš„æŸäº›éƒ¨åˆ†ã€‚

	``` swift
	Image("example")
		.resizable()
		.scaledToFill()
	```
* 18.`cornerRadius(radius:)`ï¼šç»™å›¾ç‰‡æ·»åŠ åœ†è§’ã€‚
	
	``` swift
	Image("example")	
		.cornerRadius(10)
	```
* 19.`foregroundColor(color:)`:è®¾ç½®å›¾ç‰‡çš„å‰æ™¯è‰²ï¼Œé€šå¸¸ç”¨äºæ¨¡æ¿å›¾ç‰‡ã€‚

	``` swift
	Image("example")
		.renderingMode(.template)
		.foregroundColor(.blue)
	```
	
* 20.`symbolRenderingMode(mode:)`ï¼šç”¨äºç³»ç»Ÿå›¾æ ‡ï¼Œè®¾ç½®å›¾æ ‡çš„æ¸²æŸ“æ¨¡å¼ã€‚  
	``` swift
	Image(systemName: "wifi")	
		.symbolRenderingMode(.hierarchical)
		.foregroundColor(.blue)
	```
* 21.`foregroundStyle(style:)`ï¼šç”¨äºç³»ç»Ÿå›¾æ ‡ï¼Œè®¾ç½®å›¾æ ‡çš„å¤šå±‚æ¬¡é¢œè‰²ã€‚

	``` swift
	Image(systemName: "wifi")
		.foregroundStyle(Color.pink, Color.green)
	```
	
* 22.`visualEffect(effect:)`ï¼šåœ¨ä¸ç ´åå½“å‰å¸ƒå±€çš„æƒ…å†µä¸‹ï¼Œç›´æ¥åœ¨é—­åŒ…ä¸­ä½¿ç”¨è§†å›¾çš„GeometryProxyï¼Œå¹¶å¯¹è§†å›¾åº”ç”¨æŸäº›ç‰¹å®šçš„ä¿®é¥°ç¬¦ã€‚

	``` swift
	Image("example")
		.visualEffect { content, geometryProxy in
        		content.offset(x: geometryProxy.frame(in: .global).origin.y)
    	}
	```
	
# æ€»ç»“

è¿™äº›æ˜¯Imageè§†å›¾æœ€å¸¸ç”¨çš„ä¸€äº›ä¿®é¥°ç¬¦,è®°å½•ä¸€ä¸‹
 
 


URL: https://sunyazhou.com/2024/10/hangmonitor/index.html.md
Published At: 2024-10-22 05:01:00 +0000

# iOSå¡é¡¿ç›‘æ§ä»£ç 

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


ç›‘æ§åŸç†æ˜¯æ³¨å†Œrunloopè§‚å¯Ÿè€…ï¼Œæ£€æµ‹è€—æ—¶ï¼Œè®°å½•è°ƒç”¨æ ˆï¼Œä¸ŠæŠ¥åå°åˆ†æã€‚é•¿æ—¶é—´å¡é¡¿åï¼Œè‹¥æœªè¿›å…¥ä¸‹ä¸€ä¸ªæ´»è·ƒçŠ¶æ€ï¼Œåˆ™æ ‡è®°ä¸ºå¡æ­»å´©æºƒä¸ŠæŠ¥ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ª iOS å¡æ­»ç›‘æ§çš„ä»£ç ç¤ºä¾‹ï¼š

``` objc
//
//  MTHangMonitor.h
//  HangTest
//
//  Created by sunyazhou on 2024/10/22.
//

#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>
#import <execinfo.h>
#import <sys/time.h>

NS_ASSUME_NONNULL_BEGIN

// å®šä¹‰ Runloop æ¨¡å¼çš„æšä¸¾
typedef enum {
    eRunloopDefaultMode,  // é»˜è®¤æ¨¡å¼
    eRunloopTrackingMode  // è¿½è¸ªæ¨¡å¼
} RunloopMode;

// å…¨å±€å˜é‡ï¼Œç”¨äºè®°å½• Runloop çš„æ´»åŠ¨çŠ¶æ€å’Œæ¨¡å¼
static CFRunLoopActivity g_runLoopActivity;
static RunloopMode g_runLoopMode;
static BOOL g_bRun = NO;  // æ ‡è®° Runloop æ˜¯å¦åœ¨è¿è¡Œ
static struct timeval g_tvRun;  // è®°å½• Runloop å¼€å§‹è¿è¡Œçš„æ—¶é—´

// HangMonitor ç±»ï¼Œç”¨äºç›‘æ§å¡æ­»æƒ…å†µ
@interface MTHangMonitor : NSObject

@property (nonatomic, assign) CFRunLoopObserverRef runLoopBeginObserver;  // Runloop å¼€å§‹è§‚å¯Ÿè€…
@property (nonatomic, assign) CFRunLoopObserverRef runLoopEndObserver;    // Runloop ç»“æŸè§‚å¯Ÿè€…
@property (nonatomic, strong) dispatch_semaphore_t semaphore;  // ä¿¡å·é‡ï¼Œç”¨äºåŒæ­¥
@property (nonatomic, assign) NSTimeInterval timeoutInterval;  // è¶…æ—¶æ—¶é—´

+ (instancetype)sharedInstance;

- (void)addRunLoopObserver;  // æ·»åŠ  Runloop è§‚å¯Ÿè€…çš„æ–¹æ³•
- (void)startMonitor;  // å¯åŠ¨ç›‘æ§çš„æ–¹æ³•
- (void)logStackTrace;  // è®°å½•è°ƒç”¨æ ˆçš„æ–¹æ³•
- (void)reportHang;  // ä¸ŠæŠ¥å¡æ­»çš„æ–¹æ³•

@end

@implementation MTHangMonitor

// å•ä¾‹æ¨¡å¼ï¼Œç¡®ä¿ HangMonitor åªæœ‰ä¸€ä¸ªå®ä¾‹
+ (instancetype)sharedInstance {
    static MTHangMonitor *instance;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        instance = [[MTHangMonitor alloc] init];
    });
    return instance;
}

// åˆå§‹åŒ–æ–¹æ³•
- (instancetype)init {
    self = [super init];
    if (self) {
        _timeoutInterval = 6.0;  // è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º6ç§’
        _semaphore = dispatch_semaphore_create(0);  // åˆ›å»ºä¿¡å·é‡
        [self addRunLoopObserver];  // æ·»åŠ  Runloop è§‚å¯Ÿè€…
        [self startMonitor];  // å¯åŠ¨ç›‘æ§
    }
    return self;
}

// æ·»åŠ  Runloop è§‚å¯Ÿè€…çš„æ–¹æ³•
- (void)addRunLoopObserver {
    NSRunLoop *curRunLoop = [NSRunLoop currentRunLoop];  // è·å–å½“å‰ Runloop

    // åˆ›å»ºç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€
    CFRunLoopObserverContext context = {0, (__bridge void *) self, NULL, NULL, NULL};
    CFRunLoopObserverRef beginObserver = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, LONG_MIN, &myRunLoopBeginCallback, &context);
    CFRetain(beginObserver);  // ä¿ç•™è§‚å¯Ÿè€…ï¼Œé˜²æ­¢è¢«é‡Šæ”¾
    self.runLoopBeginObserver = beginObserver;

    // åˆ›å»ºç¬¬äºŒä¸ªè§‚å¯Ÿè€…ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºç¡çœ çŠ¶æ€
    CFRunLoopObserverRef endObserver = CFRunLoopObserverCreate(kCFAllocatorDefault, kCFRunLoopAllActivities, YES, LONG_MAX, &myRunLoopEndCallback, &context);
    CFRetain(endObserver);  // ä¿ç•™è§‚å¯Ÿè€…ï¼Œé˜²æ­¢è¢«é‡Šæ”¾
    self.runLoopEndObserver = endObserver;

    // å°†è§‚å¯Ÿè€…æ·»åŠ åˆ°å½“å‰ Runloop ä¸­
    CFRunLoopRef runloop = [curRunLoop getCFRunLoop];
    CFRunLoopAddObserver(runloop, beginObserver, kCFRunLoopCommonModes);
    CFRunLoopAddObserver(runloop, endObserver, kCFRunLoopCommonModes);
}

// ç¬¬ä¸€ä¸ªè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºè¿è¡ŒçŠ¶æ€
void myRunLoopBeginCallback(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info) {
    MTHangMonitor *monitor = (__bridge MTHangMonitor *)info;
    g_runLoopActivity = activity;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ´»åŠ¨çŠ¶æ€
    g_runLoopMode = eRunloopDefaultMode;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ¨¡å¼
    switch (activity) {
        case kCFRunLoopEntry:
            g_bRun = YES;  // æ ‡è®° Runloop è¿›å…¥è¿è¡ŒçŠ¶æ€
            break;
        case kCFRunLoopBeforeTimers:
        case kCFRunLoopBeforeSources:
        case kCFRunLoopAfterWaiting:
            if (g_bRun == NO) {
                gettimeofday(&g_tvRun, NULL);  // è®°å½• Runloop å¼€å§‹è¿è¡Œçš„æ—¶é—´
            }
            g_bRun = YES;  // æ ‡è®° Runloop å¤„äºè¿è¡ŒçŠ¶æ€
            break;
        case kCFRunLoopAllActivities:
            break;
        default:
            break;
    }
    dispatch_semaphore_signal(monitor.semaphore);  // å‘é€ä¿¡å·é‡
}

// ç¬¬äºŒä¸ªè§‚å¯Ÿè€…çš„å›è°ƒå‡½æ•°ï¼Œç›‘æ§ Runloop æ˜¯å¦å¤„äºç¡çœ çŠ¶æ€
void myRunLoopEndCallback(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info) {
    MTHangMonitor *monitor = (__bridge MTHangMonitor *)info;
    g_runLoopActivity = activity;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ´»åŠ¨çŠ¶æ€
    g_runLoopMode = eRunloopDefaultMode;  // æ›´æ–°å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰çš„ Runloop æ¨¡å¼
    switch (activity) {
        case kCFRunLoopBeforeWaiting:
            gettimeofday(&g_tvRun, NULL);  // è®°å½• Runloop è¿›å…¥ç¡çœ çŠ¶æ€çš„æ—¶é—´
            g_bRun = NO;  // æ ‡è®° Runloop è¿›å…¥ç¡çœ çŠ¶æ€
            break;
        case kCFRunLoopExit:
            g_bRun = NO;  // æ ‡è®° Runloop é€€å‡ºè¿è¡ŒçŠ¶æ€
            break;
        case kCFRunLoopAllActivities:
            break;
        default:
            break;
    }
    dispatch_semaphore_signal(monitor.semaphore);  // å‘é€ä¿¡å·é‡
}

// å¯åŠ¨ç›‘æ§çš„æ–¹æ³•
- (void)startMonitor {
    dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, 0), ^{
        while (YES) {
            long result = dispatch_semaphore_wait(self.semaphore, dispatch_time(DISPATCH_TIME_NOW, self.timeoutInterval * NSEC_PER_SEC));
            if (result != 0) {
                if (g_runLoopActivity == kCFRunLoopBeforeSources || g_runLoopActivity == kCFRunLoopAfterWaiting) {
                    [self logStackTrace];  // è®°å½•è°ƒç”¨æ ˆ
                    [self reportHang];  // ä¸ŠæŠ¥å¡æ­»
                }
            }
        }
    });
}

// è®°å½•è°ƒç”¨æ ˆçš„æ–¹æ³•
- (void)logStackTrace {
    void *callstack[128];
    int frames = backtrace(callstack, 128);
    char **strs = backtrace_symbols(callstack, frames);
    NSMutableString *stackTrace = [NSMutableString stringWithString:@"\n"];
    for (int i = 0; i < frames; i++) {
        [stackTrace appendFormat:@"%s\n", strs[i]];
    }
    free(strs);
    NSLog(@"%@", stackTrace);
}

// ä¸ŠæŠ¥å¡æ­»çš„æ–¹æ³•
- (void)reportHang {
    // åœ¨è¿™é‡Œå®ç°ä¸ŠæŠ¥åå°åˆ†æçš„é€»è¾‘
    NSLog(@"æ£€æµ‹åˆ°å¡æ­»å´©æºƒï¼Œè¿›è¡Œä¸ŠæŠ¥");
}


NS_ASSUME_NONNULL_END

```

ä»¥ä¸Šä»£ç ä¸­ HangMonitor ç±»ä¼šåœ¨ä¸»çº¿ç¨‹çš„ RunLoop æ´»åŠ¨ä¸­æ£€æµ‹æ˜¯å¦æœ‰é•¿æ—¶é—´çš„å¡é¡¿ï¼Œå¹¶åœ¨æ£€æµ‹åˆ°å¡é¡¿æ—¶è®°å½•è°ƒç”¨æ ˆå¹¶ä¸ŠæŠ¥åå°è¿›è¡Œåˆ†æã€‚è¶…æ—¶æ—¶é—´è®¾å®šä¸º 6 ç§’ï¼Œä»¥è¦†ç›–å¤§éƒ¨åˆ†ç”¨æˆ·æ„ŸçŸ¥åœºæ™¯å¹¶å‡å°‘æ€§èƒ½æŸè€—ã€‚

ä½¿ç”¨ç¤ºä¾‹ä»£ç :

``` objc
#import <UIKit/UIKit.h>
#import "AppDelegate.h"
#import "MTHangMonitor.h"

int main(int argc, char * argv[]) {
    NSString * appDelegateClassName;
    @autoreleasepool {
        __unused MTHangMonitor *monitor = [MTHangMonitor sharedInstance];  // è·å– HangMonitor å•ä¾‹
        // Setup code that might create autoreleased objects goes here.
        appDelegateClassName = NSStringFromClass([AppDelegate class]);
    }
    return UIApplicationMain(argc, argv, nil, appDelegateClassName);
}

```

# æ€»ç»“

å¡é¡¿ç›‘æ§ä»£ç 

[ä»£ç å¼•ç”¨è‡ª äºŒåˆ· iOS æ€§èƒ½ä¸ç¼–è¯‘ï¼Œç®€å•ç‚¹è¯´
](https://mp.weixin.qq.com/s/X96VdTsskmNVCoqMzZjbgg)


URL: https://sunyazhou.com/2024/10/uiimagemirror/index.html.md
Published At: 2024-10-16 01:46:00 +0000

# UIImageé•œåƒ

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# ç¤ºä¾‹ä»£ç è®°å½•

``` objc

@implementation UIImage (MTMirrorImage)

- (nullable UIImage *)mirrorImageHorizontally
{
    if (self == nil) { return nil; }
    CGSize size = self.size;
    CGRect rect = CGRectMake(0, 0, size.width, size.height);
    // åˆ›å»ºä¸€ä¸ªä½å›¾ä¸Šä¸‹æ–‡
    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    unsigned char *bytes = (unsigned char *)malloc(size.width * size.height * 4);
    CGContextRef context = CGBitmapContextCreate(bytes, size.width, size.height, 8, size.width * 4, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedLast);
    // å°†åŸå§‹å›¾åƒç»˜åˆ¶åˆ°ä½å›¾ä¸Šä¸‹æ–‡ä¸­
    CGContextDrawImage(context, rect, self.CGImage);
    // æ°´å¹³ç¿»è½¬ä½å›¾ä¸Šä¸‹æ–‡ä¸­çš„å›¾åƒ
    CGContextTranslateCTM(context, size.width, 0);
    CGContextScaleCTM(context, -1, 1);
    CGContextDrawImage(context, rect, self.CGImage);
    // ä»ä½å›¾ä¸Šä¸‹æ–‡ä¸­è·å–æ–°çš„å›¾åƒ
    CGImageRef newImageRef = CGBitmapContextCreateImage(context);
    UIImage *newImage = [UIImage imageWithCGImage:newImageRef];
    // é‡Šæ”¾èµ„æº
    CGImageRelease(newImageRef);
    CGContextRelease(context);
    free(bytes);
    CGColorSpaceRelease(colorSpace);
    return newImage;
}

- (nullable UIImage *)mirrorImageVertically;
{
    if (self == nil) { return nil; }
    CGSize size = self.size;
    CGRect rect = CGRectMake(0, 0, size.width, size.height);
    // åˆ›å»ºä¸€ä¸ªä½å›¾ä¸Šä¸‹æ–‡
    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    unsigned char *bytes = (unsigned char *)malloc(size.width * size.height * 4);
    CGContextRef context = CGBitmapContextCreate(bytes, size.width, size.height, 8, size.width * 4, colorSpace, kCGBitmapByteOrderDefault | kCGImageAlphaPremultipliedLast);
    // å°†åŸå§‹å›¾åƒç»˜åˆ¶åˆ°ä½å›¾ä¸Šä¸‹æ–‡ä¸­
    CGContextDrawImage(context, rect, self.CGImage);
    // å‚ç›´ç¿»è½¬ä½å›¾ä¸Šä¸‹æ–‡ä¸­çš„å›¾åƒ
    CGContextTranslateCTM(context, 0, size.height);
    CGContextScaleCTM(context, 1, -1);
    CGContextDrawImage(context, rect, self.CGImage);
    // ä»ä½å›¾ä¸Šä¸‹æ–‡ä¸­è·å–æ–°çš„å›¾åƒ
    CGImageRef newImageRef = CGBitmapContextCreateImage(context);
    UIImage *newImage = [UIImage imageWithCGImage:newImageRef];
    // é‡Šæ”¾èµ„æº
    CGImageRelease(newImageRef);
    CGContextRelease(context);
    free(bytes);
    CGColorSpaceRelease(colorSpace);
    return newImage;
}

@end
```



URL: https://sunyazhou.com/2024/09/cfnotificationprocesscommunication/index.html.md
Published At: 2024-09-02 12:08:00 +0000

# CFNotificationè¿›ç¨‹é—´é€šè®¯

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# èƒŒæ™¯

åœ¨iOSå¼€å‘ä¸­ï¼Œåº”ç”¨æ‰©å±•ï¼ˆApp Extensionsï¼‰ä¸å…¶å®¹å™¨åº”ç”¨ï¼ˆContaining Appï¼‰åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­è¿è¡Œã€‚è¿™ç§éš”ç¦»å¸¦æ¥äº†ä¸€ä¸ªæŒ‘æˆ˜ï¼šå½“ä½ éœ€è¦åœ¨ä¸»åº”ç”¨å’Œå®ƒçš„æ‰©å±•ä¹‹é—´è¿›è¡Œé€šä¿¡æ—¶ã€‚è™½ç„¶NSNotificationCenteræ˜¯åœ¨åŒä¸€åº”ç”¨å†…ä¼ é€’æ•°æ®ç»™ä¸åŒè§†å›¾æ§åˆ¶å™¨çš„å¸¸è§é€‰æ‹©ï¼Œä½†åœ¨å¤„ç†è¿›ç¨‹é—´é€šä¿¡æ—¶å°±åŠ›ä¸ä»å¿ƒäº†ã€‚ä½ æ˜¯å¦æ›¾æƒ³è¿‡å¦‚ä½•åœ¨ä¸»åº”ç”¨åŠå…¶æ‰©å±•ä¹‹é—´ä¼ é€’æ•°æ®ï¼ŸDarwiné€šçŸ¥ä¸ºè¿™ä¸€åœºæ™¯æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„è§£å†³æ–¹æ¡ˆã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•å®ç°ä¸€ä¸ªDarwiné€šçŸ¥ç®¡ç†å™¨ï¼Œå¹¶ä½¿ç”¨å®ƒæ¥ä¿ƒè¿›ä¸»åº”ç”¨å’Œå…¶æ‰©å±•ä¹‹é—´çš„å®æ—¶æ•°æ®ä¼ è¾“ã€‚

ä»€ä¹ˆæ˜¯Darwiné€šçŸ¥ï¼ˆåˆç§°CFNotificationCenterGetDarwinNotifyCenterï¼‰ï¼Ÿ
CFNotificationCenterGetDarwinNotifyCenteræ˜¯è‹¹æœCore Foundationæ¡†æ¶ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œæä¾›äº†è®¿é—®Darwiné€šçŸ¥ä¸­å¿ƒçš„æƒé™ã€‚è¿™ä¸ªé€šçŸ¥ä¸­å¿ƒè¢«è®¾è®¡ç”¨äºç³»ç»Ÿçº§çš„é€šçŸ¥ï¼Œå…è®¸åƒä½ çš„åº”ç”¨å’Œå…¶æ‰©å±•è¿™æ ·çš„ä¸åŒè¿›ç¨‹å½¼æ­¤é€šä¿¡ã€‚

å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
ç³»ç»Ÿçº§é€šä¿¡ï¼šä¸ä»…ä»…é™äºåº”ç”¨å†…éƒ¨çš„NSNotificationCenterä¸åŒï¼ŒDarwiné€šçŸ¥ä¸­å¿ƒå¯ä»¥å‘é€èƒ½å¤Ÿè¢«è®¾å¤‡ä¸Šå…¶ä»–è¿›ç¨‹è§‚å¯Ÿåˆ°çš„é€šçŸ¥ã€‚

## Darwin Notificationsï¼Œä¹Ÿç§°ä¸ºCFNotificationCenterGetDarwinNotifyCenterï¼Œæ˜¯ä»€ä¹ˆï¼Ÿ

`CFNotificationCenterGetDarwinNotifyCenter`æ˜¯è‹¹æœå…¬å¸Core
Foundationæ¡†æ¶ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæä¾›äº†å¯¹Darwiné€šçŸ¥ä¸­å¿ƒçš„è®¿é—®æƒé™ã€‚è¯¥é€šçŸ¥ä¸­å¿ƒè¢«è®¾è®¡ç”¨äºç³»ç»Ÿçº§çš„é€šå‘Šï¼Œå…è®¸ä¸åŒè¿›ç¨‹ï¼ˆä¾‹å¦‚ä½ çš„åº”ç”¨åŠå…¶æ‰©å±•ï¼‰å½¼æ­¤é€šä¿¡ã€‚

### å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

**ç³»ç»Ÿçº§é€šä¿¡**ï¼šä¸ä»…é™äºåº”ç”¨è¿›ç¨‹çš„NSNotificationCenterä¸åŒï¼ŒDarwiné€šçŸ¥ä¸­å¿ƒå¯ä»¥å‘é€èƒ½è¢«è®¾å¤‡ä¸Šå…¶ä»–è¿›ç¨‹è§‚å¯Ÿåˆ°çš„é€šçŸ¥ã€‚è¿™å¯¹äºåº”ç”¨é—´ä»¥åŠåº”ç”¨åˆ°æ‰©å±•çš„é€šä¿¡æ¥è¯´æ˜¯ä¸€ä¸ªç†æƒ³çš„é€‰æ‹©ã€‚

**ä¸æ”¯æŒuserInfoå­—å…¸**ï¼šä¸€ä¸ªé™åˆ¶æ˜¯Darwiné€šçŸ¥ä¸æ”¯æŒå‘é€é¢å¤–çš„æ•°æ®ï¼ˆå¦‚userInfoå­—å…¸ï¼‰ã€‚è¿™æ„å‘³ç€ä½ åªèƒ½å‘é€ä¸€ä¸ªç®€å•çš„é€šçŸ¥ï¼Œæ²¡æœ‰ä»»ä½•é¢å¤–ä¿¡æ¯ã€‚è¿™æ˜¯å› ä¸ºåº•å±‚æœºåˆ¶notify_post()åªæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²æ ‡è¯†ç¬¦ä½œä¸ºé€šçŸ¥ã€‚

### Darwiné€šçŸ¥çš„ä¸€ä¸ªç”¨ä¾‹æ˜¯

ä¾‹å¦‚ï¼Œå½“å¹¿æ’­ä¸Šä¼ æ‰©å±•å¼€å§‹æˆ–åœæ­¢æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨Darwiné€šçŸ¥æ¥é€šçŸ¥ä¸»åº”ç”¨ã€‚æˆ‘çœ‹åˆ°å¤§å¤šæ•°äººä½¿ç”¨UserDefaultsæˆ–Keychainï¼Œä½†æˆ‘ä¸ªäººè®¤ä¸ºDarwiné€šçŸ¥æœ€é€‚åˆè¿™ä¸ªç”¨ä¾‹ã€‚

### å®ç°Darwiné€šçŸ¥ç®¡ç†å™¨

é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª`DarwinNotificationManager`ç±»ï¼Œä½¿ç”¨`CFNotificationCenter` APIæ¥è·¨è¿›ç¨‹å‘å¸ƒå’Œè§‚å¯Ÿé€šçŸ¥ã€‚

``` swift
import Foundation

class DarwinNotificationManager {
    
    static let shared = DarwinNotificationManager()
    
    private init() {}
    
    // 1
    private var callbacks: [String: () -> Void] = [:]
    
    // Method to post a Darwin notification
    func postNotification(name: String) {
        let notificationCenter = CFNotificationCenterGetDarwinNotifyCenter()
        CFNotificationCenterPostNotification(notificationCenter, CFNotificationName(name as CFString), nil, nil, true)
    }
    
    // 2
    func startObserving(name: String, callback: @escaping () -> Void) {
        callbacks[name] = callback
        
        let notificationCenter = CFNotificationCenterGetDarwinNotifyCenter()
        
        CFNotificationCenterAddObserver(notificationCenter,
                                        Unmanaged.passUnretained(self).toOpaque(),
                                        DarwinNotificationManager.notificationCallback,
                                        name as CFString,
                                        nil,
                                        .deliverImmediately)
    }
    
    // 3
    func stopObserving(name: String) {
        let notificationCenter = CFNotificationCenterGetDarwinNotifyCenter()
        CFNotificationCenterRemoveObserver(notificationCenter, Unmanaged.passUnretained(self).toOpaque(), CFNotificationName(name as CFString), nil)
        callbacks.removeValue(forKey: name)
    }
    
    // 4
    private static let notificationCallback: CFNotificationCallback = { center, observer, name, _, _ in
        guard let observer = observer else { return }
        let manager = Unmanaged<DarwinNotificationManager>.fromOpaque(observer).takeUnretainedValue()
        
        if let name = name?.rawValue as String?, let callback = manager.callbacks[name] {
            callback()
        }
    }
}
```

#### Darwiné€šçŸ¥ç®¡ç†å™¨çš„è§£æ

``` swift
private var callbacks: [String: () -> Void] = [:]

```

å›è°ƒ`callbacks `å‡½æ•°å­˜å‚¨æ¯ä¸ªé€šçŸ¥åç§°çš„å›è°ƒï¼Œä»¥ä¾¿åœ¨æ”¶åˆ°é€šçŸ¥æ—¶æ‰§è¡Œã€‚


``` swift
func startObserving(name: String, callback: @escaping () -> Void) {
    callbacks[name] = callback
    
    let notificationCenter = CFNotificationCenterGetDarwinNotifyCenter()
    
    CFNotificationCenterAddObserver(notificationCenter,
                                    Unmanaged.passUnretained(self).toOpaque(),
                                    DarwinNotificationManager.notificationCallback,
                                    name as CFString,
                                    nil,
                                    .deliverImmediately)
}
```

`startObserving`æ–¹æ³•ä¸ºé€šçŸ¥æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå¹¶æ·»åŠ è§‚å¯Ÿè€…æ¥ç›‘å¬å®ƒã€‚å½“ä½ æƒ³å¼€å§‹ç›‘å¬é€šçŸ¥æ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å®ƒé€šå¸¸åœ¨è§†å›¾åˆå§‹åŒ–æ—¶è¢«è°ƒç”¨ã€‚

``` swift
func stopObserving(name: String) {
    let notificationCenter = CFNotificationCenterGetDarwinNotifyCenter()
    CFNotificationCenterRemoveObserver(notificationCenter, Unmanaged.passUnretained(self).toOpaque(), CFNotificationName(name as CFString), nil)
    callbacks.removeValue(forKey: name)
}
```

`stopObserving`æ–¹æ³•ç§»é™¤é€šçŸ¥çš„è§‚å¯Ÿè€…å¹¶åˆ é™¤å…¶å›è°ƒï¼Œä»¥åœæ­¢ç›‘å¬ã€‚å®ƒé€šå¸¸åœ¨è§†å›¾è¢«é‡Šæ”¾æ—¶è°ƒç”¨ã€‚

``` swift
private static let notificationCallback: CFNotificationCallback = { center, observer, name, _, _ in
    guard let observer = observer else { return }
    let manager = Unmanaged<DarwinNotificationManager>.fromOpaque(observer).takeUnretainedValue()
    
    if let name = name?.rawValue as String?, let callback = manager.callbacks[name] {
        callback()
    }
}
```

`notificationCallback`åœ¨æ”¶åˆ°ç›¸åº”çš„é€šçŸ¥æ—¶æ‰§è¡Œå­˜å‚¨çš„å›è°ƒã€‚

#### åœ¨å¹¿æ’­æ‰©å±•ä¸­ä½¿ç”¨ç®¡ç†å™¨

``` swift
import ReplayKit

class SampleHandler: RPBroadcastSampleHandler {
    
    override func broadcastStarted(withSetupInfo setupInfo: [String : NSObject]?) {
        DarwinNotificationManager.shared.postNotification(name: "com.yourapp.BroadcastStarted")
    }
    
    override func broadcastFinished() {
        DarwinNotificationManager.shared.postNotification(name: "com.yourapp.BroadcastStopped")
    }
}
```

#### åœ¨UIKitè§†å›¾ä¸­è§‚å¯ŸDarwiné€šçŸ¥

``` swift
class DashboardViewController: UIViewController { 
    override func viewWillAppear(_ animated: Bool) {
        super.viewWillAppear(animated)
        self.configureCallbacks()
    }


    fileprivate func configureCallbacks() {
        DarwinNotificationManager.shared.startObserving(name: "com.yourapp.BroadcastStarted") {
            print("*******Broadcast has started*******")
            // Handle the event when broadcast starts
        }
        
        DarwinNotificationManager.shared.startObserving(name: "com.yourapp.BroadcastStopped") {
            print("*******Broadcast has stopped*******")
            // Handle the event when broadcast starts
        }

    }
}
```

#### åœ¨SwiftUIè§†å›¾ä¸­è§‚å¯ŸDarwiné€šçŸ¥

``` swift
import SwiftUI
import Foundation

struct BroadcastView: View {
    @State private var broadcastStatus: String = "Not Broadcasting"
    
    var body: some View {
        VStack {
            Text(broadcastStatus)
                .font(.largeTitle)
                .padding()
        
        }
        .onAppear {
            configureCallbacks()
        }
        .onDisappear {
            stopCallbacks()
        }
    }
    
    private func configureCallbacks() {
        DarwinNotificationManager.shared.startObserving(name: "com.yourapp.BroadcastStarted") {
            broadcastStatus = "Broadcasting..."
            print("*******Broadcast has started*******")
        }
        
        DarwinNotificationManager.shared.startObserving(name: "com.yourapp.BroadcastStopped") {
            broadcastStatus = "Not Broadcasting"
            print("*******Broadcast has stopped*******")
        }
    }
    
    private func stopCallbacks() {
        DarwinNotificationManager.shared.stopObserving(name: "com.yourapp.BroadcastStarted")
        DarwinNotificationManager.shared.stopObserving(name: "com.yourapp.BroadcastStopped")
    }
}
```

æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œåœ¨`onAppear`ä¸­å¼€å§‹è§‚å¯Ÿï¼Œåœ¨`onDisappear`ä¸­åœæ­¢è§‚å¯Ÿã€‚è¿™å°†ç¡®ä¿ä½ çš„ä»£ç ä¸ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚

### å…³é”®è¦ç‚¹

1.**è¿›ç¨‹é—´é€šä¿¡**ï¼šDarwiné€šçŸ¥ä¸ºä¸åŒè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æä¾›äº†ä¸€ç§å¼ºå¤§çš„æœºåˆ¶ï¼Œå¦‚ä¸»åº”ç”¨ä¸å…¶æ‰©å±•ä¹‹é—´çš„é€šä¿¡ï¼Œå…‹æœäº†`NSNotificationCente`rçš„é™åˆ¶ã€‚

2.**ç³»ç»Ÿçº§è¦†ç›–**ï¼šä¸ä»…é™äºå•ä¸ªåº”ç”¨çš„`NSNotificationCenter`ä¸åŒï¼ŒDarwiné€šçŸ¥å¯ä»¥è¢«è®¾å¤‡ä¸Šçš„ä»»ä½•è¿›ç¨‹è§‚å¯Ÿåˆ°ï¼Œä½¿å®ƒä»¬æˆä¸ºåº”ç”¨-æ‰©å±•é€šä¿¡çš„ç†æƒ³é€‰æ‹©ã€‚

3.**ä¸æ”¯æŒæœ‰æ•ˆè´Ÿè½½**ï¼šDarwiné€šçŸ¥ä¸æ”¯æŒå‘é€é¢å¤–çš„æ•°æ®ï¼ˆå¦‚`userInfo`å­—å…¸ï¼‰ã€‚å®ƒä»¬ä»…é™äºé€šçŸ¥è§‚å¯Ÿè€…äº‹ä»¶å‘ç”Ÿï¼Œæ²¡æœ‰é¢å¤–çš„ä¸Šä¸‹æ–‡ã€‚

4.**é«˜æ•ˆçš„é€šçŸ¥å¤„ç†**ï¼šé€šè¿‡ä½¿ç”¨`CFNotificationCenterGetDarwinNotifyCenter`ï¼Œå¼€å‘äººå‘˜å¯ä»¥æœ‰æ•ˆåœ°å‘å¸ƒå’Œè§‚å¯Ÿé€šçŸ¥ï¼Œæ— éœ€ç®¡ç†é¢å¤–æ•°æ®çš„å¼€é”€ã€‚

5.**SwiftUIé›†æˆ**ï¼š`Darwin`é€šçŸ¥å¯ä»¥è½»æ¾é›†æˆåˆ°SwiftUIåº”ç”¨ç¨‹åºä¸­ï¼Œå…è®¸åœ¨ä¸åŒåº”ç”¨ç»„ä»¶ä¹‹é—´è¿›è¡Œå®æ—¶æ›´æ–°å’ŒçŠ¶æ€ç®¡ç†ã€‚

# æ€»ç»“

æˆ‘çš„è„‘æµ·é‡Œæ€»æ˜¯å°†è¿™äº›è¿›ç¨‹é—´é€šçŸ¥æ¯”ä½œå½—æ˜Ÿç©¿è¿‡æˆ‘ä»¬çš„åœ°çƒã€‚æ­£å¦‚å½—æ˜Ÿæ˜¯ç½•è§ä¸”ä»¤äººæ•¬ç•çš„äº‹ä»¶ï¼Œå¸å¼•æˆ‘ä»¬çš„æ³¨æ„åŠ›ä¸€æ ·ï¼ŒDarwiné€šçŸ¥ä½œä¸ºå…³é”®çš„ä¿¡å·ï¼Œè®©åº”ç”¨ç”Ÿæ€ç³»ç»Ÿçš„ä¸åŒéƒ¨åˆ†èƒ½å¤Ÿæ— ç¼é€šä¿¡ã€‚è¿™éš¾é“ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¯”å–»å—ï¼Ÿ

æ‰€ä»¥ï¼Œå°±æ˜¯è¿™æ ·äº†ã€‚å¦‚æœä½ ä¸€ç›´è¯»åˆ°è¿™é‡Œï¼Œæˆ‘çœŸçš„å¾ˆæ„Ÿæ¿€ã€‚æˆ‘å¸Œæœ›è¿™æ¬¡å¯¹Darwiné€šçŸ¥çš„æ¢ç´¢èƒ½æ¿€å‘ä½ ä»¥æ–°çš„æ–¹å¼æ€è€ƒè¿›ç¨‹é—´é€šä¿¡ã€‚æˆ‘è¿«ä¸åŠå¾…æƒ³çœ‹åˆ°ä½ å¦‚ä½•åœ¨åº”ç”¨ä¸­ä½¿ç”¨Darwiné€šçŸ¥ã€‚è¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä½ çš„æƒ³æ³•å’Œç»éªŒã€‚ä½ çš„åé¦ˆå’Œæƒ³æ³•æ€»æ˜¯å—æ¬¢è¿çš„ï¼ä¹Ÿåˆ«å¿˜äº†ä¸ä½ çš„ç½‘ç»œåˆ†äº«è¿™ç¯‡æ–‡ç« ï¼

[åŸæ–‡é“¾æ¥ Send data Between iOS Apps and Extensions Using Darwin Notifications](https://ohmyswift.com/blog/2024/08/27/send-data-between-ios-apps-and-extensions-using-darwin-notifications/)  
[CFNotificationCenteræ–‡æ¡£](https://developer.apple.com/documentation/corefoundation/cfnotificationcenter)


URL: https://sunyazhou.com/2024/08/multiblockembedded/index.html.md
Published At: 2024-08-22 12:32:00 +0000

# åœ¨Objective-Cä¸­å¤šå±‚blockåµŒå¥—æ—¶å¦‚ä½•ä½¿ç”¨weak selfå’Œstrong self

![](/assets/images/20240822MultiBlockEmbedded/Objective-C.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜

åœ¨Objective-Cä¸­å¦‚ä½• æ­£ç¡®çš„ä½¿ç”¨ blockçš„ weakSelfå’Œ strongSelfåœ¨ å¤šå±‚blokc

åœ¨Objective-Cä¸­ï¼Œ`weak self`å’Œ`strong self`ç”¨äºè§£å†³å¾ªç¯å¼•ç”¨é—®é¢˜ã€‚å½“ä½ åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨äº†`self`ä½œä¸ºblockçš„å‚æ•°æ—¶ï¼Œä½ éœ€è¦ä½¿ç”¨`__weak typeof(self) weakSelf = self;`æ¥åˆ›å»ºä¸€ä¸ªå¼±å¼•ç”¨ï¼Œä»¥é¿å…å¾ªç¯å¼•ç”¨ã€‚ç„¶ååœ¨blockå†…éƒ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨`strongSelf`æ¥è·å–ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨ä¸‰å±‚åµŒå¥—çš„æ–¹æ³•ä¸­ä½¿ç”¨`weak self`å’Œ`strong self`ï¼š

``` objc
- (void)outerMethod {
    __weak typeof(self) weakSelf = self;
    [self innerMethod1:^{
        __weak typeof(weakSelf) weakSelf2 = weakSelf;
        [weakSelf2 innerMethod2:^{
            __weak typeof(weakSelf2) weakSelf3 = weakSelf2;
            [weakSelf3 innerMethod3:^{
                __strong typeof(weakSelf3) strongSelf = weakSelf3;
                // åœ¨è¿™é‡Œä½¿ç”¨strongSelfè¿›è¡Œæ“ä½œ
            }];
        }];
    }];
}

- (void)innerMethod1:(void (^)(void))completion {
    // ...
    if (completion) {
        completion();
    }
}

- (void)innerMethod2:(void (^)(void))completion {
    // ...
    if (completion) {
        completion();
    }
}

- (void)innerMethod3:(void (^)(void))completion {
    // ...
    if (completion) {
        completion();
    }
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸€å±‚æ–¹æ³•ä¸­éƒ½ä½¿ç”¨äº†`__weak typeof(self) weakSelf = self;`æ¥åˆ›å»ºå¼±å¼•ç”¨ï¼Œå¹¶åœ¨ä¸‹ä¸€å±‚æ–¹æ³•ä¸­ä½¿ç”¨`__weak typeof(weakSelf) weakSelf2 = weakSelf;`ã€‚æœ€åï¼Œåœ¨æœ€å†…å±‚çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`__strong typeof(weakSelf3) strongSelf = weakSelf3;`æ¥è·å–ä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œä»¥ä¾¿åœ¨è¯¥å±‚æ–¹æ³•ä¸­ä½¿ç”¨ã€‚


URL: https://sunyazhou.com/2024/08/dispatchafternsintegermax/index.html.md
Published At: 2024-08-19 01:50:00 +0000

# NSIntegerMaxæ•´æ•°æº¢å‡ºé—®é¢˜è®°å½•

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## å¼€å‘ä¸­é‡åˆ°çš„é—®é¢˜

![](/assets/images/20240819dispatchafterNSIntegermax/popup.gif)

æœ€è¿‘å¼€å‘ æµ‹è¯•åŒå­¦æäº†ä¸€ä¸ªbug, é¦–é¡µåº•éƒ¨tabçš„æ°”æ³¡ä¸€é—ªè€Œè¿‡ç¬é—´æ¶ˆå¤±,è®¤çœŸè¿½è¸ªä»£ç åå‘ç°,é…ç½®åå°ä¸‹å‘`-1`,å®¢æˆ·ç«¯åŒå­¦æŠŠè¿™ä¸ª`-1`æ›¿æ¢æˆäº†NSIntegerMax

å¦‚ä¸‹ä»£ç ,æ˜¯æ§åˆ¶ä¸€ä¸ªæ°”æ³¡ ä»å±•ç¤ºåˆ°ç»“æŸçš„ä»£ç å®ç°.

``` objc
NSInteger delaySeconds = NSIntegerMax;
NSLog(@"%@,å±•ç¤ºå‰,%zd",[NSDate date],delaySeconds);
dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delaySeconds * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
    NSLog(@"%@,å±•ç¤ºå,%zd",[NSDate date],delaySeconds);
});
```

å‡è®¾æ°”æ³¡å±•ç¤º10ç§’åè°ƒç”¨ç»“æŸçš„ä»£ç ç§»é™¤æ°”æ³¡,ä½†æ˜¯è¿™æ®µä»£ç  ä¼šç«‹å³æ‰§è¡Œ.

``` sh
2024-08-19 02:03:16 +0000,å±•ç¤ºå‰,9223372036854775807
2024-08-19 02:03:16 +0000,å±•ç¤ºå,9223372036854775807
```

### ä¸ºä»€ä¹ˆä¼šç«‹å³æ‰§è¡Œ?

![](/assets/images/20240819dispatchafterNSIntegermax/NSIntegerMax1.webp)

 `NSIntegerMax * NSEC_PER_SEC`= -10äº¿

è´Ÿæ•°å½“ç„¶ä¼šè§¦å‘ `dispatch_after()`ç«‹å³æ‰§è¡Œ.


å½“ä½ é‡åˆ° `NSIntegerMax * NSEC_PER_SEC` ç»“æœä¸ºè´Ÿæ•°çš„æƒ…å†µæ—¶ï¼Œè¿™é€šå¸¸æ„å‘³ç€å‘ç”Ÿäº†æ•´æ•°æº¢å‡ºã€‚`NSIntegerMax` è¡¨ç¤º `NSInteger` ç±»å‹çš„æœ€å¤§å€¼ï¼Œå½“å®ƒä¸ `NSEC_PER_SEC`ï¼ˆæ¯ç§’çš„çº³ç§’æ•°ï¼Œç­‰äº `1,000,000,000`ï¼‰ç›¸ä¹˜æ—¶ï¼Œç»“æœå¯èƒ½ä¼šè¶…å‡º `NSInteger` èƒ½å¤Ÿè¡¨ç¤ºçš„èŒƒå›´ã€‚

åœ¨32ä½ç³»ç»Ÿä¸Šï¼Œ`NSInteger` æ˜¯ä¸€ä¸ª32ä½æ•´æ•°ï¼Œå…¶æœ€å¤§å€¼æ˜¯ `2,147,483,647`ã€‚è€Œ `NSEC_PER_SEC` æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æ•°ï¼Œæ‰€ä»¥å½“å®ƒä»¬ç›¸ä¹˜æ—¶ï¼Œç»“æœä¼šè¶…è¿‡32ä½æ•´æ•°çš„æœ€å¤§å€¼ï¼Œå¯¼è‡´æº¢å‡ºã€‚

åœ¨64ä½ç³»ç»Ÿä¸Šï¼Œ`NSInteger` æ˜¯ä¸€ä¸ª64ä½æ•´æ•°ï¼Œå…¶æœ€å¤§å€¼æ˜¯ `9,223,372,036,854,775,807`ã€‚å°½ç®¡64ä½æ•´æ•°çš„è¡¨ç¤ºèŒƒå›´è¦å¤§å¾—å¤šï¼Œä½†å½“å®ƒä¸ `NSEC_PER_SEC` ç›¸ä¹˜æ—¶ï¼Œç»“æœä»ç„¶å¯èƒ½è¶…å‡º `NSInteger` çš„èŒƒå›´ï¼Œå› ä¸º `NSInteger` å®é™…ä¸Šæ˜¯ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°ï¼Œå…¶æœ€å¤§å€¼æ˜¯ `9,223,372,036,854,775,807`ï¼Œè€Œ `NSEC_PER_SEC` ä¹˜ä»¥ `NSIntegerMax` ä¼šå¾—åˆ°ä¸€ä¸ªå¤§äºè¿™ä¸ªå€¼çš„æ•°å­—ã€‚

æ•´æ•°æº¢å‡ºé€šå¸¸å‘ç”Ÿåœ¨ä¸¤ç§æƒ…å†µä¸‹ï¼š

1. **æ— ç¬¦å·æ•´æ•°æº¢å‡º**ï¼šå½“ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°è¾¾åˆ°å…¶æœ€å¤§å€¼å¹¶ç»§ç»­å¢åŠ æ—¶ï¼Œå®ƒä¼šå›ç»•åˆ°0å¹¶ä»0å¼€å§‹é‡æ–°è®¡æ•°ã€‚
2. **æœ‰ç¬¦å·æ•´æ•°æº¢å‡º**ï¼šå½“ä¸€ä¸ªæœ‰ç¬¦å·æ•´æ•°è¾¾åˆ°å…¶æœ€å¤§å€¼å¹¶ç»§ç»­å¢åŠ æ—¶ï¼Œå®ƒå°†å˜æˆä¸€ä¸ªè´Ÿæ•°ã€‚

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äº `NSInteger` æ˜¯æœ‰ç¬¦å·çš„ï¼Œå½“å®ƒä¸ `NSEC_PER_SEC` ç›¸ä¹˜çš„ç»“æœè¶…å‡ºå…¶è¡¨ç¤ºèŒƒå›´æ—¶ï¼Œç»“æœä¼šå˜ä¸ºè´Ÿæ•°ã€‚

ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œä½ åº”è¯¥ä½¿ç”¨æ›´å¤§çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚ `uint64_t` æˆ– `int64_t`ï¼Œè¿™äº›ç±»å‹å¯ä»¥å®‰å…¨åœ°å­˜å‚¨æ›´å¤§çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼š

```objective-c
uint64_t delayInNanoseconds = (uint64_t)NSIntegerMax * NSEC_PER_SEC;
```

ä½¿ç”¨ `uint64_t` å¯ä»¥ç¡®ä¿ä¹˜æ³•æ“ä½œä¸ä¼šå¯¼è‡´è´Ÿæ•°ï¼Œå› ä¸º `uint64_t` æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„64ä½æ•´æ•°ã€‚

### è§£å†³æ–¹å¼

* å®šä¹‰ä¸¤ä¸ªæ—¶é—´æœ€å¤§é•¿åº¦çš„å®æ¥æ›¿ä»£æœ€å¤§å€¼

``` objc
#define SECONDS_IN_A_YEAR 31536000LL // éé—°å¹´
#define SECONDS_IN_A_LEAP_YEAR 31622400LL // é—°å¹´
#define SECONDS_IN_A_MONTH 2629746LL  //ä¸€ä¸ªæœˆæœ€å¤§ç§’æ•°
#define SECONDS_IN_A_DAY 86400  //ä¸€å¤©æœ€å¤§ç§’æ•°
```


åœ¨ Objective-C ä¸­ï¼Œæ²¡æœ‰ä¸€ä¸ªæ ‡å‡†çš„å®ç›´æ¥è¡¨ç¤ºä¸€å¤©ä¸­çš„æœ€å¤§ç§’æ•°ã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€äº›åŸºæœ¬çš„æ—¶é—´å•ä½å®æ¥è®¡ç®—ä¸€å¤©çš„æ€»ç§’æ•°ã€‚

ä¸€å¤©æœ‰ 24 å°æ—¶ï¼Œæ¯å°æ—¶æœ‰ 60 åˆ†é’Ÿï¼Œæ¯åˆ†é’Ÿæœ‰ 60 ç§’ã€‚æ‰€ä»¥ï¼Œä¸€å¤©çš„æ€»ç§’æ•°å¯ä»¥é€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—å¾—å‡ºï¼š

\[ \text{ä¸€å¤©çš„æ€»ç§’æ•°} = 24 \times 60 \times 60 \]

ä¸€å¤©çš„æ€»ç§’æ•° = 24 *  60* 60

è¿™ç­‰äº 86,400 ç§’ã€‚

å¦‚æœä½ éœ€è¦åœ¨ Objective-C ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªå€¼ï¼Œä½ å¯ä»¥å®šä¹‰ä¸€ä¸ªå®æˆ–è€…å¸¸é‡æ¥è¡¨ç¤ºå®ƒï¼š

```objective-c
#define SECONDS_IN_A_DAY 86400
```

æˆ–è€…ä½¿ç”¨ `const` å¸¸é‡ï¼š

```objective-c
const int64_t SecondsInADay = 86400LL;
```

ä½¿ç”¨ `int64_t` ç±»å‹å¯ä»¥ç¡®ä¿è¿™ä¸ªå¸¸é‡è¶³å¤Ÿå¤§ï¼Œå³ä½¿åœ¨ 32 ä½ç³»ç»Ÿä¸Šä¹Ÿèƒ½æ­£ç¡®è¡¨ç¤ºä¸€å¤©çš„æ€»ç§’æ•°ã€‚`LL` åç¼€ç¡®ä¿äº†è¿™ä¸ªæ•°å­—è¢«è§£é‡Šä¸ºé•¿é•¿æ•´å‹ï¼ˆ`long long`ï¼‰å¸¸é‡ã€‚

åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨è¿™ä¸ªå€¼æ¥è¿›è¡Œæ—¶é—´è®¡ç®—ã€‚

ä¸€ä¸ªæœˆå’Œä¸€å¹´ä¸­çš„å¤©æ•°ä¸æ˜¯å›ºå®šçš„ï¼Œå› ä¸ºå®ƒä»¬ä¾èµ–äºç‰¹å®šçš„æ—¥å†è§„åˆ™ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å‡ºä¸€äº›è¿‘ä¼¼å€¼å’Œè®¡ç®—æ–¹æ³•ã€‚

### ä¸€ä¸ªæœˆçš„ç§’æ•°

å¯¹äºä¸€ä¸ªæœˆä»½ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨å¹³å‡å€¼æ¥è¿‘ä¼¼è®¡ç®—ã€‚ä¸€ä¸ªæœˆå¹³å‡å¤§çº¦æœ‰ 30.44 å¤©ï¼ˆè€ƒè™‘äº†ä¸åŒæœˆä»½çš„å¤©æ•°å’Œé—°å¹´çš„å½±å“ï¼‰ã€‚å› æ­¤ï¼Œä¸€ä¸ªæœˆçš„æ€»ç§’æ•°å¯ä»¥è¿‘ä¼¼ä¸ºï¼š

\[ \text{ä¸€ä¸ªæœˆçš„æ€»ç§’æ•°} \approx 30.44 \times 24 \times 60 \times 60 \]

è®¡ç®—ç»“æœå¤§çº¦æ˜¯ï¼š

\[ 2,629,746 \text{ ç§’} \]

åœ¨ Objective-C ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·å®šä¹‰ä¸€ä¸ªæœˆçš„ç§’æ•°ï¼š

```objective-c
#define SECONDS_IN_A_MONTH 2629746LL
```

### ä¸€å¹´çš„ç§’æ•°

å¯¹äºä¸€å¹´ï¼Œæˆ‘ä»¬é€šå¸¸å‡è®¾å®ƒæœ‰ 365 å¤©ï¼Œé™¤éæ˜¯é—°å¹´ï¼Œé‚£æ—¶ä¼šæœ‰ 366 å¤©ã€‚å› æ­¤ï¼Œä¸€å¹´çš„æ€»ç§’æ•°å¯ä»¥è¿™æ ·è®¡ç®—ï¼š

- éé—°å¹´ï¼š
  \[ \text{ä¸€å¹´çš„æ€»ç§’æ•°} = 365 \times 24 \times 60 \times 60 \]
- é—°å¹´ï¼š
  \[ \text{ä¸€å¹´çš„æ€»ç§’æ•°} = 366 \times 24 \times 60 \times 60 \]

éé—°å¹´ï¼š   
ä¸€å¹´çš„æ€»ç§’æ•° = 365 Ã— 24 Ã— 60 Ã— 60  
é—°å¹´ï¼š   
ä¸€å¹´çš„æ€»ç§’æ•° = 366 Ã— 24 Ã— 60 Ã— 60

è®¡ç®—ç»“æœå¤§çº¦æ˜¯ï¼š

- éé—°å¹´ï¼š31,536,000 ç§’
- é—°å¹´ï¼š31,622,400 ç§’

åœ¨ Objective-C ä¸­ï¼Œä½ å¯ä»¥è¿™æ ·å®šä¹‰ä¸€å¹´çš„ç§’æ•°ï¼š

```objective-c
#define SECONDS_IN_A_YEAR 31536000LL // éé—°å¹´
#define SECONDS_IN_A_LEAP_YEAR 31622400LL // é—°å¹´
```

è¯·æ³¨æ„ï¼Œè¿™äº›å€¼æ˜¯åŸºäºè¿‘ä¼¼è®¡ç®—çš„ï¼Œå®é™…çš„æœˆä»½å’Œå¹´ä»½é•¿åº¦å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨å¤„ç†å…·ä½“çš„æ—¥æœŸå’Œæ—¶é—´è®¡ç®—æ—¶ï¼Œé€šå¸¸éœ€è¦è€ƒè™‘æ›´å¤æ‚çš„æ—¥å†è§„åˆ™ã€‚åœ¨ Objective-C ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ `NSCalendar` ç±»å’Œ `NSDate` ç±»æ¥æ›´å‡†ç¡®åœ°å¤„ç†æ—¥æœŸå’Œæ—¶é—´ã€‚

# æ€»ç»“

è¿™é‡Œçš„æ ¸å¿ƒé—®é¢˜æ˜¯ä¸è¦ç”¨ä¸€ä¸ª NSIntegerMax å»ä¹˜ä»¥ `ä¸€ä¸ªå€¼` å¾—å‡ºçš„è§£å†³è¶…è¿‡äº† NSIntegerèƒ½è¡¨ç¤ºçš„æœ€å¤§èŒƒå›´,å¼€å‘ä¸­ä¸€å®šè¦æ³¨æ„.




URL: https://sunyazhou.com/2024/08/PickingAndHitTestingInMetal/index.html.md
Published At: 2024-08-12 08:55:00 +0000

# PickingInMetal

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


![](/assets/images/20240813PickingAndHitTestinginMetal/picking.gif)


# æœ€è¿‘å­¦ä¹ Metal

å½“å­¦ä¹ åˆ°ç¬¬åäºŒçš„æ—¶å€™é‡åˆ°äº†ä¸€ä¸ªä¹‹å‰æƒ³è§£å†³å´ä»æœªæ‰¾åˆ°ç­”æ¡ˆçš„æ–¹å¼ã€‚å¦‚ä½•æ£€æµ‹ ä¸€ä¸ª3Dåœºæ™¯ä¸­æŸä¸ªå…ƒç´ çš„ç‚¹å‡»é—®é¢˜,æ¯”å¦‚å¼•å…¥ä¸€ä¸ª3Dåœºæ™¯åœ¨æ‰‹æœºç«¯æˆ–è€…PCç«¯, é€šè¿‡æ‰‹æŒ‡è§¦æ‘¸æˆ–è€…é¼ æ ‡ç‚¹å‡»èƒ½çŸ¥é“ æˆ‘ç‚¹å‡»æ˜¯å“ªä¸ª3Dæ¨¡å‹

åœ¨Metal.by.Tutorials.4th.2023.12.pdfè¿™æœ¬ä¹¦ä¸­æˆ‘æ‰¾åˆ°äº†ç­”æ¡ˆ-`Object Picking`

![](/assets/images/20240813PickingAndHitTestinginMetal/Metal.by.Tutorials.4th.2023.12.webp)


``` sh
To get started with multipass rendering, youâ€™ll create a simple render pass that adds object picking to your app. When you click a model in your scene, that model will render in a slightly different shade.
There are several ways to hit-test rendered objects. For example, you could do the math to convert the 2D touch location to a 3D ray and then perform ray intersection to see which object intersects the ray. Warren Moore describes this method in his Picking and Hit-Testing in Metal (https://bit.ly/3rlzm9b) article. Alternatively, you could render a texture where each object is rendered in a different color or object ID. Then, you calculate the texture coordinate from the screen touch location and read the texture to see which object was hit.
Youâ€™re going to store the modelâ€™s object ID into a texture in one render pass. Youâ€™ll then send the touch location to the fragment shader in the second render pass and read the texture from the first pass. If the fragment being rendered is from the selected object, youâ€™ll render that fragment in a different color.

```

è¿™ç¯‡æ–‡ç« è§£å†³äº†æˆ‘æ¢ç´¢å¾ˆä¹…çš„é—®é¢˜.å¦‚ä½•è§£å†³ 2Dç©ºé—´ç‚¹å‡»3Dç©ºé—´å…ƒç´ çš„é—®é¢˜,å…¶æ ¸å¿ƒæ˜¯é‡‡ç”¨ä¸€ç§å«åš**3Då°„å’Œç‰©ä½“æ±‚äº¤é›†çš„æ–¹å¼**.

ä¸‹é¢çš„æ–‡ç« è§£å†³äº†æ­¤é—®é¢˜,é™¤äº†è¿™ç§æ–¹å¼ä»¥å¤–è¿˜æœ‰ä¸€ç§æ˜¯**åˆ©ç”¨é¢œè‰²IDæ¥åŒºåˆ†ç‰©ä½“ç‚¹å‡»**.

ä¸€ä¸‹æ˜¯pickingæŠ€æœ¯çš„æ–‡ç« ç²¾é€‰ 

[Picking and Hit-Testing in Metal](https://bit.ly/3rlzm9b)  
[Picking and Hit-Testing in Metal Demo](https://github.com/metal-by-example/metal-picking)

# æ€»ç»“

å’Œä¹‹å‰å›¾å½¢å­¦åŒäº‹æ¢è®¨,ä»–ç»™æˆ‘ä¸€äº›å­¦ä¹ vulkançš„æ–¹å‘èµ„æ–™,æˆ‘æ•´ç†åˆ°è¿™é‡Œ 

``` sh
https://github.com/KhronosGroup/Vulkan-Guide
https://github.com/KhronosGroup/Khronosdotorg/blob/main/api/vulkan/resources.md

Tutorial:
https://gavinkg.github.io/ILearnVulkanFromScratch-CN/
https://vulkan-tutorial.com/
https://software.intel.com/content/www/us/en/develop/articles/api-without-secrets-introduction-to-vulkan-preface.html
https://renderdoc.org/vulkan-in-30-minutes.html
https://www.fasterthan.life/blog/2017/7/11/i-am-graphics-and-so-can-you-part-1
``` 




URL: https://sunyazhou.com/2024/08/docatchinswift/index.html.md
Published At: 2024-08-11 01:55:00 +0000

# Swiftä¸­çš„do catch

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# Swiftä¸­çš„do-catchè¯­å¥

åœ¨Swiftä¸­ï¼Œ`do-catch`è¯­å¥æ˜¯ç”¨äºå¼‚å¸¸å¤„ç†çš„æœºåˆ¶ã€‚å®ƒå…è®¸ä½ æ‰§è¡Œå¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯çš„ä»£ç å—ï¼ˆåœ¨`do`å—ä¸­ï¼‰ï¼Œå¹¶æ•è·è¿™äº›é”™è¯¯ï¼ˆåœ¨`catch`å—ä¸­ï¼‰ä»¥ä¾¿å¤„ç†ã€‚è¿™æ˜¯Swiftä¸­å¤„ç†è¿è¡Œæ—¶é”™è¯¯çš„ä¸€ç§ä¼˜é›…æ–¹å¼ã€‚

## ç¤ºä¾‹


```swift
do {
    // å°è¯•æ‰§è¡Œçš„ä»£ç ï¼Œè¿™é‡Œå¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯
    let number = "è¿™ä¸æ˜¯ä¸€ä¸ªæ•°å­—"
    let myNumber = Int(number) // è¿™è¡Œå¯èƒ½ä¼šå› ä¸ºè½¬æ¢å¤±è´¥è€ŒæŠ›å‡ºé”™è¯¯
    
    // å¦‚æœä¸Šé¢çš„ä»£ç æ²¡æœ‰æŠ›å‡ºé”™è¯¯ï¼Œè¿™é‡Œçš„ä»£ç å°†æ‰§è¡Œ
    print("è½¬æ¢æˆåŠŸ: \(myNumber)")
} catch let error as NSError {
    // æ•è·å¹¶å¤„ç†é”™è¯¯
    print("å‘ç”Ÿé”™è¯¯: \(error.localizedDescription)")
}
```

## è§£é‡Š

1. **doå—**
   - åœ¨`do`å—ä¸­ï¼Œä½ æ”¾ç½®å¯èƒ½ä¼šæŠ›å‡ºé”™è¯¯çš„ä»£ç ã€‚
   - ç¤ºä¾‹ä¸­å°è¯•å°†ä¸€ä¸ªå­—ç¬¦ä¸²`"è¿™ä¸æ˜¯ä¸€ä¸ªæ•°å­—"`è½¬æ¢ä¸º`Int`ç±»å‹ï¼Œè¿™é€šå¸¸ä¼šå¤±è´¥å¹¶æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚

2. **catchå—**
   - `catch`å—ç´§éš`do`å—ä¹‹åã€‚
   - å®ƒç”¨äºæ•è·`do`å—ä¸­æŠ›å‡ºçš„é”™è¯¯ã€‚
   - ä½ å¯ä»¥æ ¹æ®é”™è¯¯çš„å…·ä½“ç±»å‹ï¼ˆé€šè¿‡æ¨¡å¼åŒ¹é…ï¼‰æ¥æ•è·ä¸åŒç±»å‹çš„é”™è¯¯ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ•è·äº†æ‰€æœ‰ç¬¦åˆ`NSError`ç±»å‹çš„é”™è¯¯ã€‚
   - ä¸€æ—¦æ•è·åˆ°é”™è¯¯ï¼Œä½ å°±å¯ä»¥åœ¨`catch`å—ä¸­ç¼–å†™ä»£ç æ¥å¤„ç†è¿™ä¸ªé”™è¯¯ã€‚

## æ³¨æ„

- ä»Swift 2å¼€å§‹ï¼Œ`NSError`çš„ä½¿ç”¨è¢«Swiftçš„é”™è¯¯å¤„ç†æœºåˆ¶æ‰€å–ä»£ï¼Œä½†ç¤ºä¾‹ä¸­ä»ç„¶ä½¿ç”¨å®ƒæ˜¯å› ä¸ºå®ƒå±•ç¤ºäº†å¦‚ä½•æ•è·å’Œå¤„ç†é”™è¯¯ã€‚
- åœ¨æœ€æ–°çš„Swiftç‰ˆæœ¬ä¸­ï¼Œä½ æ›´å¯èƒ½ä¼šçœ‹åˆ°ä½¿ç”¨`Error`åè®®çš„é”™è¯¯å¤„ç†ï¼Œè€Œä¸æ˜¯`NSError`ã€‚

## ç®€åŒ–çš„catchå—

```swift
do {
    // å°è¯•æ‰§è¡Œçš„ä»£ç 
} catch {
    // æ•è·æ‰€æœ‰é”™è¯¯
    print("å‘ç”Ÿé”™è¯¯")
}
```

åœ¨è¿™ä¸ªç®€åŒ–çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šé”™è¯¯çš„å…·ä½“ç±»å‹ï¼Œå› æ­¤å®ƒä¼šæ•è·`do`å—ä¸­æŠ›å‡ºçš„ä»»ä½•ç±»å‹çš„é”™è¯¯ã€‚

# æ€»ç»“

åœ¨Metalå­¦ä¹ çš„demoå·¥ç¨‹ä¸­é‡åˆ°äº†ä¹‹å‰é—å¿˜çš„å†…å®¹,è®°å½•ä¸€ä¸‹.

``` swift
do {
	pipelineState = try device.makeRenderPipelineState(descriptor: pipelineDescriptor)
} catch {
  	fatalError(error.localizedDescription)
}
```




URL: https://sunyazhou.com/2024/07/uiapplicationsignificanttimechangenotification/index.html.md
Published At: 2024-07-31 03:17:00 +0000

# iOSä¸­å¦‚ä½•è§£å†³è·¨å¤©æ—¥æœŸå˜åŒ–

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## èƒŒæ™¯ä»‹ç»

æœ€è¿‘å·¥ä½œä¸­é‡åˆ°ä¸€ä¸ªéœ€æ±‚æ˜¯ å½“appåœ¨å‰å°å¹¶ä¸” è¿‡åˆå¤œ12ç‚¹æ—¶ è§¦å‘æŸäº›é€»è¾‘,è€Œä¸”è¿˜éœ€è¦åœ¨å‰å°è§¦å‘, ä¹Ÿå°±æ˜¯è¯´å¦‚æœåœ¨åå°æŒ‚èµ·çŠ¶æ€ å›åˆ°å‰å°æ‰è¦è§¦å‘,ä¸€èˆ¬ç”¨äºä¸€äº›ç­¾åˆ°ä¹‹ç±»çš„é€»è¾‘. 

## UIApplicationSignificantTimeChangeNotification

åœ¨iOSåº”ç”¨å¼€å‘ä¸­ï¼Œ`UIApplicationSignificantTimeChangeNotification`æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå®ƒå…è®¸å¼€å‘è€…åœ¨æ—¶é—´å‘ç”Ÿé‡å¤§å˜åŒ–æ—¶æ¥æ”¶é€šçŸ¥ã€‚è¿™ç§å˜åŒ–åŒ…æ‹¬æ—¥æœŸçš„æ›´æ”¹ã€æ—¶åŒºçš„å˜åŠ¨æˆ–å¤ä»¤æ—¶ï¼ˆDSTï¼‰çš„å¼€å§‹å’Œç»“æŸæˆ–è¿è¥å•†çš„æ—¶é—´æ›´æ–°ã€‚è¿™ä¸ªåŠŸèƒ½å°¤å…¶å¯¹äºéœ€è¦åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡ŒæŸäº›ä»»åŠ¡çš„åº”ç”¨éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨`åˆå¤œ12ç‚¹`è¿›è¡Œæ•°æ®å¤‡ä»½æˆ–æ›´æ–°ã€‚

è¦åœ¨åº”ç”¨ä¸­æ¥æ”¶UIApplicationSignificantTimeChangeNotificationï¼Œé¦–å…ˆéœ€è¦å‘ç³»ç»Ÿæ³¨å†Œä»¥æ¥æ”¶æ­¤é€šçŸ¥ã€‚è¿™å¯ä»¥åœ¨åº”ç”¨çš„ä»»ä½•éƒ¨åˆ†å®Œæˆï¼Œä½†é€šå¸¸æ˜¯åœ¨applicationDidFinishLaunching:æˆ–ç±»ä¼¼çš„åº”ç”¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­è¿›è¡Œã€‚

ä»¥ä¸‹æ˜¯å¦‚ä½•æ³¨å†Œçš„ç¤ºä¾‹ä»£ç ï¼š

``` objc
//æ³¨å†Œé€šçŸ¥
[[NSNotificationCenter defaultCenter] addObserver:self
                                         selector:@selector(significantTimeChangeHandler:)
                                             name:UIApplicationSignificantTimeChangeNotification
                                           object:nil];
...

- (void)significantTimeChangeHandler:(NSNotification *)notification {
    if ([notification.name isEqualToString:UIApplicationSignificantTimeChangeNotification]) {
        // è·å–å½“å‰æ—¥æœŸ
        NSDate *currentDate = [NSDate date];
        // è·å–æ˜¨å¤©çš„æ—¥æœŸ
        NSCalendar *calendar = [NSCalendar currentCalendar];
        NSDateComponents *comps = [calendar components:NSCalendarUnitDay fromDate:currentDate];
        comps.day = comps.day - 1;
        NSDate *yesterday = [calendar dateFromComponents:comps];
        
        // æ£€æŸ¥æ˜¯å¦è·¨è¿‡åˆå¤œ
        if ([currentDate compare:yesterday] == NSOrderedDescending) {
            // åœ¨è¿™é‡Œæ‰§è¡Œè·¨æ—¥æœŸåéœ€è¦çš„æ“ä½œï¼Œå¦‚æ•°æ®å¤‡ä»½ç­‰
            NSLog(@"Crossed midnight, perform necessary actions.");
        }
    }
}

```

æ­¤æ–¹æ³•é¦–å…ˆç¡®è®¤æ”¶åˆ°çš„é€šçŸ¥æ˜¯æˆ‘ä»¬æ‰€å…³å¿ƒçš„æ—¶é—´æ˜¾è‘—å˜åŒ–é€šçŸ¥ã€‚ç„¶åï¼Œå®ƒè·å–å½“å‰çš„æ—¥æœŸï¼Œå¹¶è®¡ç®—å‡ºæ˜¨å¤©çš„æ—¥æœŸã€‚é€šè¿‡æ¯”è¾ƒè¿™ä¸¤ä¸ªæ—¥æœŸï¼Œæˆ‘ä»¬å¯ä»¥ç¡®å®šæ˜¯å¦è·¨è¿‡äº†åˆå¤œã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œé‚£ä¹ˆå¯ä»¥æ‰§è¡Œéœ€è¦åœ¨æ–°ä¸€å¤©å¼€å§‹æ—¶è¿›è¡Œçš„ä»»ä½•æ“ä½œï¼Œæ¯”å¦‚æ•°æ®å¤‡ä»½ã€åˆ·æ–°ç”¨æˆ·ç•Œé¢ç­‰ã€‚

è¿™ä¸ªé€šçŸ¥å•çš„å®˜æ–¹æ³¨é‡Šå¦‚ä¸‹ 

``` txt
A notification that posts when there is a significant change in time, for example, change to a new day (midnight), carrier time update, and change to or from daylight savings time.
å½“æ—¶é—´å‘ç”Ÿé‡å¤§å˜åŒ–æ—¶å‘å¸ƒçš„é€šçŸ¥ï¼Œä¾‹å¦‚ï¼Œæ›´æ”¹ä¸ºæ–°çš„ä¸€å¤©ï¼ˆåˆå¤œï¼‰ã€è¿è¥å•†æ—¶é—´æ›´æ–°ï¼Œä»¥åŠæ›´æ”¹ä¸ºå¤ä»¤æ—¶ã€‚

This notification does not contain a userInfo  dictionary.
æ­¤é€šçŸ¥ä¸åŒ…å«userInfoå­—å…¸ã€‚

If your app is currently suspended, this message is queued until your app returns to the foreground, at which point it is delivered. If multiple time changes occur, only the most recent one is delivered.
å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå½“å‰å¤„äºæŒ‚èµ·çŠ¶æ€ï¼Œåˆ™æ­¤æ¶ˆæ¯å°†ä¸€ç›´æ’é˜Ÿï¼Œç›´åˆ°ä½ çš„åº”ç”¨ç¨‹åºè¿”å›å‰å°ï¼Œå¹¶åœ¨å‰å°å‘é€ã€‚å¦‚æœå‘ç”Ÿå¤šä¸ªæ—¶é—´æ›´æ”¹ï¼Œåˆ™åªå‘é€æœ€è¿‘çš„ä¸€ä¸ªã€‚

```
> [å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/documentation/uikit/uiapplicationsignificanttimechangenotification)

# æ€»ç»“

è¿™ä¸ªé€šçŸ¥å¹¶ä¸å¸¸ç”¨,ä½†èƒ½å®Œå…¨æ»¡è¶³éœ€æ±‚ä¸­è¦æ±‚çš„ è·¨å¤©å˜åŒ–,æ—¥æœŸä¿®æ”¹å›åˆ°å‰å°ç­‰é€»è¾‘,å¹¶ä¸”è¿˜èƒ½åœ¨ä¿®æ”¹å¤ä»¤æ—¶æˆ–è¿è¥å•†æ—¶é—´æ›´æ–°æ—¶è§¦å‘.  



URL: https://sunyazhou.com/2024/07/magnificationgesture/index.html.md
Published At: 2024-07-27 14:29:00 +0000

# swiftUIä¸­æ·»åŠ æ‹Ÿåˆæ‰‹åŠ¿MagnificationGesture

![](/assets/images/20240727Magnificationgesture/SwiftUI.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# MagnificationGesture ä»‹ç»

`MagnificationGesture` æ˜¯SwiftUIä¸­ç”¨äºå¤„ç†ç¼©æ”¾æ‰‹åŠ¿çš„æ‰‹åŠ¿è¯†åˆ«å™¨ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡æåˆï¼ˆå³ä¸¤ä¸ªæ‰‹æŒ‡é è¿‘æˆ–è¿œç¦»ï¼‰çš„æ‰‹åŠ¿æ¥æ”¾å¤§æˆ–ç¼©å°è§†å›¾ä¸­çš„å…ƒç´ ã€‚è¿™ç§æ‰‹åŠ¿åœ¨å¤šç§åº”ç”¨åœºæ™¯ä¸­éƒ½éå¸¸æœ‰ç”¨ï¼Œå¦‚å›¾ç‰‡ç¼©æ”¾ã€åœ°å›¾ç¼©æ”¾ã€ç”¨æˆ·ç•Œé¢ç¼©æ”¾ç­‰ã€‚

![](/assets/images/20240727Magnificationgesture/MagnificationGesture.gif)

## ä¸»è¦ç‰¹ç‚¹

- **ç¼©æ”¾æ‰‹åŠ¿è¯†åˆ«**ï¼š`MagnificationGesture` èƒ½å¤Ÿè¯†åˆ«ç”¨æˆ·çš„æåˆæ‰‹åŠ¿ï¼Œå¹¶æ ¹æ®æ‰‹åŠ¿çš„æ–¹å‘ï¼ˆé è¿‘æˆ–è¿œç¦»ï¼‰æ¥æ”¾å¤§æˆ–ç¼©å°è§†å›¾ã€‚
- **å®æ—¶å“åº”**ï¼šåœ¨ç”¨æˆ·è¿›è¡Œç¼©æ”¾æ‰‹åŠ¿æ—¶ï¼Œ`MagnificationGesture` èƒ½å¤Ÿå®æ—¶åœ°è°ƒæ•´è§†å›¾çš„å¤§å°ï¼Œæä¾›æµç•…çš„äº¤äº’ä½“éªŒã€‚
- **å¯å®šåˆ¶æ€§**ï¼šå¼€å‘è€…å¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„å‚æ•°å’Œç›‘å¬å™¨æ¥å®šåˆ¶`MagnificationGesture`çš„è¡Œä¸ºï¼Œä»¥æ»¡è¶³ä¸åŒçš„åº”ç”¨éœ€æ±‚ã€‚

## ä½¿ç”¨åœºæ™¯

1. **å›¾ç‰‡ç¼©æ”¾**ï¼šåœ¨å›¾ç‰‡æŸ¥çœ‹åº”ç”¨ä¸­ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨`MagnificationGesture`æ¥æ”¾å¤§æˆ–ç¼©å°å›¾ç‰‡ï¼Œä»¥ä¾¿æ›´æ¸…æ™°åœ°æŸ¥çœ‹å›¾ç‰‡çš„ç»†èŠ‚ã€‚
2. **åœ°å›¾ç¼©æ”¾**ï¼šåœ¨åœ°å›¾åº”ç”¨ä¸­ï¼Œ`MagnificationGesture`å…è®¸ç”¨æˆ·é€šè¿‡æåˆæ‰‹åŠ¿æ¥æ”¾å¤§æˆ–ç¼©å°åœ°å›¾ï¼Œä»¥ä¾¿æŸ¥çœ‹ä¸åŒå±‚çº§çš„åœ°ç†ä¿¡æ¯ã€‚
3. **ç”¨æˆ·ç•Œé¢ç¼©æ”¾**ï¼šåœ¨éœ€è¦è‡ªå®šä¹‰ç•Œé¢å¤§å°çš„åº”ç”¨ä¸­ï¼Œ`MagnificationGesture`å¯ä»¥ç”¨äºå®ç°ç”¨æˆ·ç•Œé¢çš„ç¼©æ”¾åŠŸèƒ½ï¼Œæå‡ç”¨æˆ·çš„ä¸ªæ€§åŒ–ä½“éªŒã€‚

## ç¤ºä¾‹ä»£ç 

``` swift
import SwiftUI

struct MagnificationGestureDemo: View {
    @GestureState private var scalingRatio: CGFloat = 1.0

    var body: some View {
        Image("exampleImage") // æ›¿æ¢ä¸ºå®é™…å›¾ç‰‡åç§°
            .resizable()
            .frame(width: 200, height: 200)
            .scaleEffect(scalingRatio) // åº”ç”¨ç¼©æ”¾æ•ˆæœ
            .gesture(
                MagnificationGesture()
                    .updating($scalingRatio, body: { value, state, _ in
                        state = value // æ›´æ–°ç¼©æ”¾æ¯”ä¾‹
                    })
            )
    }
}

```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`MagnificationGesture`è¢«æ·»åŠ åˆ°äº†ä¸€ä¸ªå›¾ç‰‡è§†å›¾ä¸Šï¼Œå¹¶é€šè¿‡`.updating`ä¿®é¥°ç¬¦æ¥æ›´æ–°ä¸€ä¸ªåä¸º`scalingRatio`çš„`@GestureState`å˜é‡ï¼Œè¯¥å˜é‡è®°å½•äº†å½“å‰çš„ç¼©æ”¾æ¯”ä¾‹ã€‚å½“ç”¨æˆ·è¿›è¡Œç¼©æ”¾æ‰‹åŠ¿æ—¶ï¼Œ`scalingRatio`çš„å€¼ä¼šå®æ—¶æ›´æ–°ï¼Œå¹¶é€šè¿‡`.scaleEffect`ä¿®é¥°ç¬¦åº”ç”¨åˆ°å›¾ç‰‡ä¸Šï¼Œä»è€Œå®ç°å›¾ç‰‡çš„ç¼©æ”¾æ•ˆæœã€‚

# æ€»ç»“

`MagnificationGesture`æ˜¯SwiftUIä¸­ä¸€ä¸ªéå¸¸å®ç”¨çš„æ‰‹åŠ¿è¯†åˆ«å™¨ï¼Œå®ƒå…è®¸å¼€å‘è€…é€šè¿‡ç®€å•çš„ä»£ç å®ç°å¤æ‚çš„ç¼©æ”¾æ‰‹åŠ¿äº¤äº’æ•ˆæœã€‚åœ¨å¼€å‘éœ€è¦ç¼©æ”¾åŠŸèƒ½çš„åº”ç”¨æ—¶ï¼Œ`MagnificationGesture`æ˜¯ä¸€ä¸ªä¸å¯æˆ–ç¼ºçš„å·¥å…·ã€‚


URL: https://sunyazhou.com/2024/07/UIViewrepresentable/index.html.md
Published At: 2024-07-26 14:28:00 +0000

# ä½¿ç”¨UIViewRepresentable  åœ¨SwiftUIä¸­æ¡¥æ¥ UIKit è§†å›¾

![](/assets/images/20240726UIViewrepresentable/UIViewRepresentable.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## UIViewRepresentableä»‹ç»

`UIViewRepresentable` æ˜¯ SwiftUI æ¡†æ¶ä¸­çš„ä¸€ä¸ªåè®®ï¼Œå®ƒä¸»è¦ç”¨äºåœ¨ SwiftUI ç¯å¢ƒä¸­å°è£… UIKit è§†å›¾ï¼ˆ`UIView` åŠå…¶å­ç±»ï¼‰ã€‚SwiftUI æ˜¯ Apple æ¨å‡ºçš„ä¸€ä¸ªç”¨äºæ„å»ºè·¨å¹³å°ç”¨æˆ·ç•Œé¢çš„ç°ä»£æ¡†æ¶ï¼Œå®ƒæ”¯æŒ iOSã€macOSã€watchOS å’Œ tvOSã€‚ç„¶è€Œï¼Œç”±äº SwiftUI æ˜¯åœ¨ç›¸å¯¹è¾ƒæ–°çš„æ—¶é—´ç‚¹ä¸Šæ¨å‡ºçš„ï¼Œè®¸å¤šç°æœ‰çš„ UIKit è§†å›¾å’Œæ§ä»¶å°šæœªè¢«ç›´æ¥é›†æˆåˆ° SwiftUI ä¸­ã€‚

`UIViewRepresentable` åè®®å…è®¸å¼€å‘è€…å°† UIKit è§†å›¾æ¡¥æ¥åˆ° SwiftUI è§†å›¾ç³»ç»Ÿä¸­ï¼Œä½¿å¾—åœ¨ SwiftUI åº”ç”¨ä¸­èƒ½å¤Ÿåˆ©ç”¨ UIKit å¼ºå¤§çš„åŠŸèƒ½å’Œç°æœ‰çš„ UIKit ç»„ä»¶ã€‚é€šè¿‡ä½¿ç”¨ `UIViewRepresentable`ï¼Œå¼€å‘è€…å¯ä»¥åˆ›å»ºä¸€ä¸ª SwiftUI è§†å›¾ï¼Œè¯¥è§†å›¾å†…éƒ¨å°è£…äº†ä¸€ä¸ªæˆ–å¤šä¸ª UIKit è§†å›¾ï¼Œå¹¶åœ¨ SwiftUI çš„è§†å›¾ä¸­è¿›è¡Œç®¡ç†ã€‚

## å¦‚ä½•ä½¿ç”¨ UIViewRepresentable

* **å®šä¹‰ä¸€ä¸ªéµå¾ª`UIViewRepresentable`çš„`SwiftUI`è§†å›¾**ï¼šä½ éœ€è¦åˆ›å»ºä¸€ä¸ª SwiftUI è§†å›¾ï¼Œè¯¥è§†å›¾éµå¾ª`UIViewRepresentable`åè®®ã€‚
* **å®ç°åè®®è¦æ±‚çš„ä¸¤ä¸ªæ–¹æ³•ï¼š**

	* `makeUIView(context: Context) -> UIView`ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºåˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª UIKit è§†å›¾å®ä¾‹ã€‚è¿™ä¸ªè§†å›¾å°†è¢«å°è£…åœ¨ SwiftUI è§†å›¾å†…éƒ¨ã€‚
	*  `updateUIView(_ uiView: UIViewType, context: Context)`ï¼šå½“ SwiftUI è§†å›¾éœ€è¦æ›´æ–°å…¶å†…éƒ¨å°è£…çš„ UIKit è§†å›¾æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œè®¾ç½® UIKit è§†å›¾çš„å±æ€§æˆ–æ·»åŠ å­è§†å›¾ç­‰ã€‚
* **åœ¨ SwiftUI è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ä½¿ç”¨ä½ çš„å°è£…è§†å›¾**ï¼šåˆ›å»ºå¹¶åˆå§‹åŒ–ä½ çš„å°è£…è§†å›¾åï¼Œå°±å¯ä»¥åƒä½¿ç”¨å…¶ä»– SwiftUI è§†å›¾ä¸€æ ·åœ¨ç•Œé¢ä¸­ä½¿ç”¨å®ƒäº†ã€‚

#### ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨`UIViewRepresentable`æ¥å°è£…ä¸€ä¸ª UIKit çš„ `UIButton`ï¼š

``` swift
import SwiftUI  
import UIKit  
  
struct MyButton: UIViewRepresentable {  
    func makeUIView(context: Context) -> UIButton {  
        let button = UIButton()  
        button.setTitle("Click Me", for: .normal)  
        button.addTarget(context.coordinator, action: #selector(Coordinator.buttonPressed), for: .touchUpInside)  
        button.backgroundColor = .blue  
        return button  
    }  
  
    func updateUIView(_ uiView: UIButton, context: Context) {  
        // è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦æ›´æ–°æŒ‰é’®  
    }  
  
    class Coordinator: NSObject {  
        @objc func buttonPressed() {  
            print("Button was pressed!")  
        }  
    }  
  
    func makeCoordinator() -> Coordinator {  
        return Coordinator()  
    }  
}
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ`MyButton` æ˜¯ä¸€ä¸ªå°è£…äº† `UIButton` çš„ SwiftUI è§†å›¾ã€‚æˆ‘ä»¬è®¾ç½®äº†æŒ‰é’®çš„æ ‡é¢˜ã€é¢œè‰²ï¼Œå¹¶æ·»åŠ äº†ä¸€ä¸ªç‚¹å‡»äº‹ä»¶çš„å¤„ç†å™¨ã€‚ç‚¹å‡»äº‹ä»¶é€šè¿‡`Coordinator`ç±»æ¥å¤„ç†ï¼Œè¿™æ˜¯`UIViewRepresentable`åè®®çš„ä¸€ä¸ªå¸¸è§æ¨¡å¼ï¼Œç”¨äºå¤„ç† UIKit è§†å›¾ä¸­çš„äº‹ä»¶ã€‚


### `UIViewRepresentable` ä¸­çš„ `makeCoordinator` æ–¹æ³•è°ƒç”¨æ—¶æœº  
  
åœ¨ SwiftUI çš„ `UIViewRepresentable` åè®®ä¸­ï¼Œ`makeCoordinator` æ–¹æ³•æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç† UIKit è§†å›¾ä¸­çš„äº‹ä»¶å’Œå›è°ƒæ—¶ã€‚ä»¥ä¸‹æ˜¯å…³äº `makeCoordinator` æ–¹æ³•è°ƒç”¨æ—¶æœºçš„è¯¦ç»†è¯´æ˜ã€‚  
  
## è°ƒç”¨æ—¶æœº  
  
### 1. è§†å›¾åˆ›å»ºä¸æ¸²æŸ“  
  
- å½“ SwiftUI éœ€è¦æ¸²æŸ“ `UIViewRepresentable` è§†å›¾æ—¶ï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨è¯¥è§†å›¾é¦–æ¬¡è¢«æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ï¼Œæˆ–è€…å½“ SwiftUI å†³å®šéœ€è¦é‡æ–°æ¸²æŸ“è¯¥è§†å›¾ï¼ˆä¾‹å¦‚ï¼Œç”±äºçŠ¶æ€å˜åŒ–æˆ–å¸ƒå±€æ›´æ–°ï¼‰æ—¶ã€‚  
  
### 2. `makeUIView` è°ƒç”¨  
  
- åœ¨ `UIViewRepresentable` è§†å›¾å‡†å¤‡å°†å…¶å†…éƒ¨çš„ UIKit è§†å›¾æ·»åŠ åˆ°è§†å›¾å±‚æ¬¡ç»“æ„ä¹‹å‰ï¼Œ`makeUIView` æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•è´Ÿè´£åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ª UIKit è§†å›¾å®ä¾‹ã€‚  
  
### 3. `makeCoordinator` è°ƒç”¨  
  
- ç´§æ¥ç€ `makeUIView` æ–¹æ³•ä¹‹åï¼ˆæˆ–è€…åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½å‡ ä¹åŒæ—¶ï¼‰ï¼Œ`makeCoordinator` æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•çš„ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªåè°ƒå™¨ï¼ˆcoordinatorï¼‰å¯¹è±¡ï¼Œè¯¥å¯¹è±¡é€šå¸¸ç”¨äºå¤„ç† UIKit è§†å›¾ä¸­çš„äº‹ä»¶æˆ–å›è°ƒã€‚  
  
### 4. åè°ƒå™¨ä¸ UIKit è§†å›¾äº¤äº’  
  
- åœ¨ `makeUIView` ä¸­ï¼Œä½ å¯èƒ½ä¼šè®¾ç½® UIKit è§†å›¾çš„ä¸€äº›å±æ€§æˆ–äº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™äº›ç›‘å¬å™¨å¯ä»¥æŒ‡å‘åè°ƒå™¨ä¸­çš„æ–¹æ³•ã€‚è¿™æ ·ï¼Œå½“ UIKit è§†å›¾ä¸­çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆå¦‚æŒ‰é’®ç‚¹å‡»ï¼‰ï¼Œç›¸åº”çš„åè°ƒå™¨æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ã€‚  
  
### 5. `updateUIView` çš„å¯èƒ½è°ƒç”¨  
  
- åœ¨ `UIViewRepresentable` è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¦‚æœå…¶çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¹¶ä¸”è¿™äº›å˜åŒ–éœ€è¦åæ˜ åœ¨å…¶å†…éƒ¨çš„ UIKit è§†å›¾ä¸Šï¼Œé‚£ä¹ˆ `updateUIView` æ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•å…è®¸ä½ æ ¹æ® `UIViewRepresentable` è§†å›¾çš„çŠ¶æ€æ›´æ–°å…¶å†…éƒ¨çš„ UIKit è§†å›¾ã€‚  
  
## å…³é”®ç‚¹  
  
- `makeCoordinator` æ–¹æ³•åœ¨ `UIViewRepresentable` è§†å›¾å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼ˆé™¤éè§†å›¾è¢«é‡æ–°åˆ›å»ºï¼Œä¾‹å¦‚ï¼Œç”±äºå†…å­˜å›æ”¶å’Œé‡æ–°åŠ è½½ï¼‰ã€‚  
- ä¸€æ—¦åè°ƒå™¨å¯¹è±¡è¢«åˆ›å»ºï¼Œå®ƒå°±ä¼šé€šè¿‡ `Context` å‚æ•°ä¸ `UIViewRepresentable` è§†å›¾ä¿æŒå…³è”ï¼Œç›´åˆ°è§†å›¾è¢«é”€æ¯ã€‚  
- ä½ å¯ä»¥å°† `makeCoordinator` æ–¹æ³•è§†ä¸ºåˆå§‹åŒ– `UIViewRepresentable` è§†å›¾æ—¶è®¾ç½®äº‹ä»¶å¤„ç†å’Œå›è°ƒé€»è¾‘çš„ä¸€éƒ¨åˆ†ã€‚  
  
é€šè¿‡ç†è§£ `makeCoordinator` çš„è°ƒç”¨æ—¶æœºï¼Œä½ å¯ä»¥æ›´æœ‰æ•ˆåœ°åœ¨ SwiftUI åº”ç”¨ä¸­æ¡¥æ¥ UIKit è§†å›¾ï¼Œå¹¶å¤„ç†å®ƒä»¬ä¹‹é—´çš„äº‹ä»¶å’Œäº¤äº’ã€‚


URL: https://sunyazhou.com/2024/07/kerning/index.html.md
Published At: 2024-07-18 07:01:00 +0000

# Kerningæ–‡å­—æ’ç‰ˆè®¡ç®—

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## è®°å½•ä¸€æ®µä»£ç ç”¨äºè§£å†³iOSæ–‡å­—æ’ç‰ˆçš„æŠ€æœ¯é—®é¢˜

``` objc
CFAttributedStringRef attributedString;
CTTypesetterRef typesetter = CTTypesetterCreateWithAttributedString(attributedString);
CTLineRef line = CTTypesetterCreateLine(typesetter, CFRangeMake(0, 0));
NSArray *runs = (__bridge NSArray *)CTLineGetGlyphRuns(line);

CTRunRef run = (__bridge CTRunRef)runs[runIdx];

const CFIndex glyphCount = CTRunGetGlyphCount(run);
CGPoint *glyphPositions = malloc(sizeof(CGPoint) * glyphCount);
CTRunGetPositions(run, CFRangeMake(0, 0), glyphPositions);

CGRect bounds = CTRunGetImageBounds(run, NULL, CFRangeMake(0, 0));

CGGlyph *glyphs = malloc(sizeof(CGGlyph) * glyphCount);
CTRunGetGlyphs(run, CFRangeMake(0, 0), glyphs);

NSDictionary *runAttributes = (__bridge NSDictionary *)CTRunGetAttributes(run);
CTFontRef font = (__bridge CTFontRef)runAttributes[NSFontAttributeName];

CGSize size;
CTFontGetAdvancesForGlyphs(font, 0, &glyphs[glyphIdx], &size, 1);
            
CTFontGetBoundingRectsForGlyphs()

CTRunGetPositions(run, CFRangeMake(0, 0), glyphPositions);//è¿™ä¸ªåº”è¯¥æ‹¿åˆ°çš„å°±æ˜¯å¸¦Kerningä¿¡æ¯çš„position
```

ä»¥ä¸Šä»£ç éœ€è¦å†™demoéªŒè¯.


URL: https://sunyazhou.com/2024/07/hitteststd/index.html.md
Published At: 2024-07-02 08:01:00 +0000

# hitTestæ ‡å‡†å†™æ³•

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# HitTestæ ‡å‡†å†™æ³•


``` objc
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    if (!self.isUserInteractionEnabled || self.isHidden || self.alpha <= 0.01)
    {
        return nil;
    }
    if ([self pointInside:point withEvent:event])
    {
        for (UIView *subview in [self.subviews reverseObjectEnumerator])
        {
            CGPoint convertedPoint = [subview convertPoint:point fromView:self];
            UIView *hitTestView = [subview hitTest:convertedPoint withEvent:event];
            if (hitTestView)
            {
                if (hitTestView.superview == self)
                {
                    // selfçš„æ‰€æœ‰å­viewéƒ½ä¸åº”è¯¥å“åº”äº‹ä»¶
                    return nil;
                }
                return hitTestView;
            }
        }
        return nil;
    }
    return nil;
}
```

# æ€»ç»“

ä»£ç reviewå‡ºç°é—®é¢˜è®°å½•ä»¥ä¸‹,hittestçš„æ ‡å‡†å†™æ³•


URL: https://sunyazhou.com/2024/05/smoothstep/index.html.md
Published At: 2024-05-15 01:42:00 +0000

# å¹³æ»‘é˜¶æ¢¯å‡½æ•°smoothstep

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚ä½•æ§åˆ¶ä¸€ä¸ªå€¼ åœ¨æŸä¸ªåŒºé—´å†…,ä½¿å…¶ä¸è¶…è¿‡æœ€å¤§åŒºé—´æé™å’Œæœ€å°åŒºé—´çš„æé™ï¼Ÿ

## åœ¨å¼€å‘ä¸­æˆ‘ä»¬ç»å¸¸è®¡ç®—ä¸€äº›åŒºé—´å€¼,:å¦‚ä¸‹

``` c
float a = æŸä¸ªè¾“å…¥å€¼
float maxValue = 1;
//check  0 < a <æé™å€¼ å‡è®¾maxValue   = 1

if (a <= 0) {
	a = 0;
} else if (a >= maxValue) {
	a = maxValue	
}

return a;

```

æ˜¾ç„¶è¿™æ˜¯åˆšå­¦Cè¯­è¨€æ—¶å€™çš„æˆ‘å†™å‡ºæ¥çš„æ¯«æ— æŠ€æœ¯å«é‡çš„ä»£ç .

## å·¥ä½œå¤šå¹´åçš„å†™æ³•

``` c
//å¼•å…¥æ ‡å‡†åº“å¤´æ–‡ä»¶ è¿™é‡Œçœç•¥å¯¼å…¥å¤´æ–‡ä»¶è¿‡ç¨‹...

float a = æŸä¸ªè¾“å…¥å€¼
float maxValue = 1;
//ä¼˜é›…æ°¸ä¸è¿‡æ—¶
float a = min(max(0, a), maxValue); // 0 <= a <= 1
return a;
```

è¿™ç§å†™æ³•è™½ç„¶ä¸€è¡Œä»£ç æå®š,æ˜¾å¾—NBå¤šäº†,æ§åˆ¶äº†è¿™ä¸ªå€¼çš„æœ€å°å’Œæœ€å¤§åŒºé—´ä¸è¶…è¿‡èŒƒå›´.

æ›¾ç»è¿˜å› ä¸ºè¿™ä¸ªé—®é¢˜é—®è¿‡å‰å…¬å¸çš„æ‰€æœ‰æŠ€æœ¯åŒå­¦,æˆ‘çš„æé—®å¦‚ä¸‹ 

**æœ‰æ²¡æœ‰ä¸€ä¸ªå‡½æ•°èƒ½æŠŠmin + max åˆæˆä¸€ä¸‹ æ§åˆ¶ä¸€ä¸ªå€¼åœ¨æŸä¸ªåŒºé—´èŒƒå›´å†….**

ç­”å¤æ˜¯å¾ˆå¤šäººéƒ½ä¸æ¸…æ¥š.æ“¦


## smoothste() åŸƒå°”ç±³ç‰¹(Hermite)å¹³æ»‘æ’å€¼å‡½æ•°

ç„¶è€Œå¤šå¹´å æˆ‘å‘ç°è‡ªå·±å¹¶ä¸ä¼˜é›…. æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šå‡½æ•°éœ€è¦è‡ªå·±æé«˜è®¤çŸ¥æ‰çŸ¥é“å®ƒæ˜¯åšä»€ä¹ˆçš„.

å½“æˆ‘é˜…è¯»åˆ° `Metal by Tutorials`,è¿™æœ¬ä¹¦æ—¶æœ‰ä¸€æ®µç‰‡å…ƒç€è‰²å™¨çš„ä»£ç å¼•èµ·äº†æˆ‘çš„æ³¨æ„.

``` txt
â€œsmoothstep

smoothstep(edge0, edge1, x) returns a smooth Hermite interpolation between 0 and 1.


Note: edge1 must be greater than edge0, and x should be edge0 <= x <= edge1.â€

æ‘˜å½•æ¥è‡ª
Metal by Tutorials
æ­¤ææ–™å¯èƒ½å—ç‰ˆæƒä¿æŠ¤ã€‚
```

ä»¥ä¸‹æ˜¯ç‰‡å…ƒç€è‰²å™¨çš„ä»£ç .

``` c
float color = smoothstep(0, params.width, in.position.x);
return float4(color, color, color, 1);

```

æ˜¯çš„ è¿™ä¹ˆå¤šå¹´æˆ‘ç”¨çš„è¿™ä¸ªå‡½æ•°å®ƒå…¶å®å«åš `å¹³æ»‘é˜¶æ¢¯å‡½æ•°`.

# æ€»ç»“

æ˜¾ç„¶ æ¥ä¸‹æ¥çš„æ“ä½œæ˜¯: å®šä¹‰ä¸€ä¸ªå…¨å±€å†…è”å‡½æ•° å°è£… smoothstep()

``` c
inline xx_smoothstep(T minEdge, T maxEdge, value) {
	return smoothstep(minEdge, maxEdge, value); 
}

```
è¿™ç§æ€è·¯è§£å†³å·¥ç¨‹ä¸­æ‰€ä»¥èŒƒå›´å€¼é—®é¢˜.åŸæ¥è¿™ä¹ˆå¤šå¹´è¿½æ±‚çš„æŠ€æœ¯æºäºè®¤çŸ¥çš„æå‡.






URL: https://sunyazhou.com/2024/05/arktsanimation/index.html.md
Published At: 2024-05-05 11:05:00 +0000

# HarmonyOSåŠ¨ç”»åˆ†ç±»

![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/harmonyOS.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# åŠ¨ç”»èƒŒæ™¯ä»‹ç»

åœ¨é¸¿è’™å¼€å‘ä¸­åŠ¨ç”»åˆ†ç±»æ¯”iOSå¼€å‘çš„åˆ†ç±»æ›´åŠ ä¸°å¯Œ,åŒ…å«å¦‚ä¸‹åŠ¨ç”»ç±»åˆ«

* å±æ€§åŠ¨ç”»(animation)
* æ˜¾å¼åŠ¨ç”»(animateTo)
* å…³é”®å¸§åŠ¨ç”»(keyframeAnimationTo)
* è½¬åœºåŠ¨ç”»(Transition)
	* é¡µé¢é—´è½¬åœº(pageTransition)
	* ç»„ä»¶å†…è½¬åœº(transition)
	* å…±äº«å…ƒç´ è½¬åœº(sharedTransition)
	* ç»„ä»¶å†…éšå¼å…±äº«å…ƒç´ è½¬åœº(geometryTransition)
* è·¯å¾„è½¬åœº(motionPath)
* ç²’å­åŠ¨ç”»(Particle)

è¯¦ç»†èµ„æ–™æ¥æº[é¸¿è’™å¼€å‘æ–‡æ¡£-åŠ¨ç”»](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-transition-animation-component-0000001862687721#ZH-CN_TOPIC_0000001862687721__transitioneffect10%E5%AF%B9%E8%B1%A1%E8%AF%B4%E6%98%8E)

## å±æ€§åŠ¨ç”»animation

![](/assets/images/20240505ArkTSAnimation/HarmonyOSAnimation.gif)

``` ts
import { SizeT } from '@ohos.arkui.node';

@Entry
@Component
struct MTAnimation3 {
  @State message: string = 'è¿ˆè…¾å¤§é˜Ÿé•¿';
  @State buttonSize: Size = {width: 266, height: 108};
  @State didChanged: boolean = true;

  build() {
    Row() {
      Column() {
        Text(this.message)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
        Button("sunyazhou.com")
          //.animation({}) // å…¬å¼ï¼šanimation å¢åŠ åˆ°é‚£ä¸ªåœ°æ–¹çš„åé¢ï¼Œå‰é¢å°±ä¼šè¢«animationç®¡ç†ï¼Œå¦åˆ™ä¸ç”Ÿæ•ˆ
          .onClick( ()=> {
            console.log("ç‚¹å‡»sunyazhou.comæŒ‰é’®")
            if (this.didChanged) {
              this.buttonSize = {width: 166, height:80}
            } else {
              this.buttonSize = {width: 266, height:108}
            }
            this.didChanged = !this.didChanged //åç½® äº¤æ¢
          })
          .width(this.buttonSize.width)
          .animation({
              duration: 1000,
              curve: Curve.EaseInOut,
              // iterations: 1, //æ‰§è¡Œæ¬¡æ•°,(åŠ¨ç”»æ¥å›ç®—2æ¬¡)
              playMode: PlayMode.Alternate, //åŠ¨ç”»ç»“æŸåœåœ¨åŠ¨ç”»ç»“æŸçš„ä½ç½®
              onFinish: ()=> {
                console.log("åŠ¨ç”»æ‰§è¡Œå®Œæˆ")
              }
          }) //æˆ‘åªè´Ÿè´£å‰é¢çš„ä»£ç  æœ‰åŠ¨ç”»ï¼Œåé¢çš„ä»£ç ï¼Œæˆ‘ä¸ç®¡(åœ¨è¿™é‡Œä¹‹å‰çš„ä»£ç éƒ½å—animationæ§åˆ¶)
          .height(this.buttonSize.height) //æ³¨æ„;è¿™è¡Œä»£ç ä¸åœ¨åŠ¨ç”»èŒƒå›´å†…
      }
      .width('100%')
    }
    .height('100%')
  }
}
```
>  æ³¨æ„ :.animationåŠ¨ç”»åªå¯¹æ·»åŠ ä»£ç ä¹‹å‰çš„å±æ€§ç”Ÿæ•ˆ,ä¹‹åçš„å±æ€§ä¸ç”Ÿæ•ˆ,[å±æ€§åŠ¨ç”»å®˜ç½‘æ–‡æ¡£](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-animatorproperty-0000001815927688)

## æ˜¾å¼åŠ¨ç”»(animateTo)

å­¦è¿‡iOSå¼€å‘éƒ½çŸ¥é“iOSä¸­çš„æ˜¾å¼åŠ¨ç”»æ˜¯`[UIView animateWithDuratio...]`

``` objc
+ (void)animateWithDuration:(NSTimeInterval)duration animations:(void (^)(void))animations API_AVAILABLE(ios(4.0)); 
```

åœ¨é¸¿è’™å¼€å‘ä¸­,è¿™ç§ç±»å‹çš„åŠ¨ç”»å«åš`animateTo`

å…ˆçœ‹ä¸‹ç¤ºæ„å›¾,æˆ‘æƒ³è®©å›¾ç‰‡æ—‹è½¬90åº¦,ç„¶åå†å›å»,è¿™åœ¨iOSä¸­ç›´æ¥å°±æ”¹transfrom,å¹¶ä¸”æŠŠæ”¹åŠ¨çš„ä»£ç æ”¾åˆ°ä¸Šè¿°UIViewçš„animationä¸­çš†å¯,

``` objc
CGAffineTransformRotate(transform, M_PI_2); //æ—‹è½¬90Â°
...

CGAffineTransformIdentity;

```

![](/assets/images/20240505ArkTSAnimation/HarmonyOSAnimateTo.gif)

è¿™é‡Œ HarmonyOSçš„ArkUIç¤ºä¾‹ä»£ç æ¼”ç¤º:

``` ts
@Entry
@Component
struct MTAnimation2 {
  @State message: string = 'æ˜¾å¼åŠ¨ç”»(animateTo)';
  @State rotateValue: number = 0;
  @State color: Color = Color.Blue;
  @State isStart: boolean = false;
  build() {
    Row() {
      Column() {
        Text(this.message)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
        Divider()
          .height(20)
        Image($r('app.media.sunyazhou'))
          .width(333)
          .height(333)
          .rotate({
            angle:this.rotateValue, //è¡¨é¢ä¸Šæ˜¯æ—‹è½¬åŠŸèƒ½ï¼Œ å®é™…ä¸Šéœ€è¦é…åˆ xè½´yæŠ½zè½´
            x:0,
            y:0,
            z:1,
          })
          .onClick(() => {
            animateTo({
              duration: 1000, //ms
              curve : Curve.EaseInOut, //åŠ¨ç”»é€Ÿç‡
              onFinish:() => {
                this.message = "åŠ¨ç”»æ‰§è¡Œå®Œæˆ"
                this.color = Color.Green
              }
            }, ()=> {
              if (this.isStart) {
                this.rotateValue = 0
              } else  {
                this.rotateValue = 90
              }
              this.isStart = !this.isStart
            })
          })
      }
      .width('100%')
    }
    .height('100%')
  }
}

```
å¦‚æœæŠŠ`.rotate`ä¸­çš„x,y,z,éƒ½æ”¹æˆ1å¹¶æ—‹è½¬625åº¦çš„è¯æ˜¯è¿™æ ·çš„

![](/assets/images/20240505ArkTSAnimation/HarmonyOSAnimateTo2.gif)

å½“æˆ‘ä»¬åœ¨åŠ¨ç”»ä¸­è¿ç»­ç‚¹å‡»åŠ¨ç”»çš„æ—¶å€™å®ƒå¾ˆè·Ÿæ‰‹,å’ŒiOSä¸­çš„UIView Animationä¸€æ ·ä¸­é—´è¢«æ‰“æ–­ç›´æ¥æ‰§è¡Œä¸‹æ¬¡æ˜¾å¼åŠ¨ç”»,ä¸‹å›¾æ¼”ç¤ºè·Ÿæ‰‹æ•ˆæœ.
![](/assets/images/20240505ArkTSAnimation/HarmonyOSAnimateTo3.gif)

[æ›´å¤šç»†èŠ‚è¯·è®¿é—® HarmonyOSå®˜æ–¹æ–‡æ¡£ æ˜¾å¼åŠ¨ç”» (animateTo)](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-explicit-animation-0000001862687717)

## å…³é”®å¸§åŠ¨ç”»

å…³é”®å¸§åŠ¨ç”»åœ¨é¸¿è’™å¼€å‘ä¸­æ˜¯å€ŸåŠ©`UIContext`å®ç°

![](/assets/images/20240505ArkTSAnimation/HarmonyOSKeyframeAnimation.gif)

``` ts
// xxx.ets
import { UIContext } from '@ohos.arkui.UIContext';
@Entry
@Component
struct KeyframeDemo {
  @State myScale: number = 1.0;
  uiContext: UIContext | undefined = undefined;

  aboutToAppear() {
    this.uiContext = this.getUIContext?.();
  }

  build() {
    Column() {
      Circle()
        .width(100)
        .height(100)
        .fill("#46B1E3")
        .margin(100)
        .scale({ x: this.myScale, y: this.myScale })
        .onClick(() => {
          if (!this.uiContext) {
            console.info("no uiContext, keyframe failed");
            return;
          }
          this.myScale = 1;
          // è®¾ç½®å…³é”®å¸§åŠ¨ç”»æ•´ä½“æ’­æ”¾3æ¬¡
          this.uiContext.keyframeAnimateTo({ iterations: 3 }, [
            {
              // ç¬¬ä¸€æ®µå…³é”®å¸§åŠ¨ç”»æ—¶é•¿ä¸º800msï¼Œscaleå±æ€§åšä»1åˆ°1.5çš„åŠ¨ç”»
              duration: 800,
              event: () => {
                this.myScale = 1.5;
              }
            },
            {
              // ç¬¬äºŒæ®µå…³é”®å¸§åŠ¨ç”»æ—¶é•¿ä¸º500msï¼Œscaleå±æ€§åšä»1.5åˆ°1çš„åŠ¨ç”»
              duration: 500,
              event: () => {
                this.myScale = 1;
              }
            }
          ]);
        })
    }.width('100%').margin({ top: 5 })
  }
}
```


## ç»„ä»¶å†…è½¬åœºåŠ¨ç”»

ç»„ä»¶å†…è½¬åœºåŠ¨ç”»

å¦‚ä¸‹å›¾:
![](/assets/images/20240505ArkTSAnimation/transition1.gif)

å®ç°ä»£ç 

``` ts
@Entry
@Component
struct MTAnimation1 {
  @State phones: string[] = [
    'HUAWEI Mete 60 Pro WIt9000S',
    'HUAWEI Mete 40 Pro+ 5G soc',
    'Xiaomi 14 Pro ç¬¬ä¸‰ä»£éªé¾™ 5G',
    'OPPO Find X Pro ç¬¬äºŒä»£éªé¾™ 5G'
  ]

  @State topIndex: number = 0
  @State bottomIndex: number = this.phones.length

  build() {
    Column({space:12}) {
      Column() {
        ForEach(this.phones, (item:string)=> {
           Text(item).ft_text()
             .transition(
               TransitionEffect.asymmetric(
                 // 1.å‡ºç°æ—¶åšä»æŒ‡å®šçš„é€æ˜åº¦ä¸º0å˜ä¸ºé»˜è®¤çš„é€æ˜åº¦1çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»æ—¶é•¿ä¸º1000msï¼Œ
                 // ä»¥åŠåšä»æŒ‡å®šçš„ç»•zè½´æ—‹è½¬180Â°å˜ä¸ºé»˜è®¤çš„æ—‹è½¬è§’ä¸º0çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»1000msåæ’­æ”¾ï¼Œæ—¶é•¿ä¸º1000ms
                 // 2.æ¶ˆå¤±æ—¶åšä»é»˜è®¤çš„é€æ˜åº¦ä¸º1å˜ä¸ºæŒ‡å®šçš„é€æ˜åº¦0çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»1000msåæ’­æ”¾ï¼Œ
                 // æ—¶é•¿ä¸º1000msï¼Œä»¥åŠåšä»é»˜è®¤çš„æ—‹è½¬è§’0å˜ä¸ºæŒ‡å®šçš„ç»•zè½´æ—‹è½¬180Â°çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»æ—¶é•¿ä¸º1000ms
                 TransitionEffect.OPACITY.animation({ duration: 1000 }).combine(
                   TransitionEffect.rotate({ z: 1, angle: 180 }).animation({ delay: 1000, duration: 1000 })),
                   TransitionEffect.OPACITY.animation({ delay: 1000, duration: 1000 }).combine(
                    TransitionEffect.rotate({ z: 1, angle: 180 }).animation({ duration: 1000 })
                    // TransitionEffect.translate({x: 600, y: 0}).animation({duration: 1000})
                 )
               )
             )
             // .transition(TransitionEffect.OPACITY.animation({duration: 2000, curve: Curve.Ease})
             //   .combine(TransitionEffect.rotate({z: 1, angle: 180})
             //   ))

             // .transition(
             //   TransitionEffect.asymmetric(
             //     TransitionEffect.translate({x: 333, y: 333}),
             //     TransitionEffect.IDENTITY
             //   )
             // )
        }, (item: string) => JSON.stringify(item))
      }.ft_column()

      Button('åœ¨é¡¶éƒ¨å¢åŠ æ‰‹æœº').ft_btn(Color.Red,() => {
          animateTo({}, ()=> {
            if (this.topIndex == 0) {
              this.phones.unshift('iPhone 15 Pro Max')
            } else {
              this.phones.unshift('iPhone 15 Pro Max'+ '(' + this.topIndex + ')')
            }
            this.topIndex++
          })
      })
      Button('åœ¨åº•éƒ¨å¢åŠ æ‰‹æœº').ft_btn(Color.Green, ()=> {
          animateTo({}, ()=> {
            if (this.bottomIndex == 0) {
              this.phones.push('iPhone 14 Pro Max')
            } else {
              this.phones.push('iPhone 14 Pro Max' + '('+ this.bottomIndex +')')
            }
            this.bottomIndex++
          })
      })

      Button('åœ¨å¤´éƒ¨åˆ é™¤æ‰‹æœº').ft_btn(Color.Blue, ()=> {
        animateTo({}, ()=> {
          this.phones.shift()
        })
      })

      Button('åœ¨åº•éƒ¨åˆ é™¤æ‰‹æœº').ft_btn(Color.Pink, () => {
        animateTo({}, ()=> {
          this.phones.pop()
        })
      })
    }
    .width('100%')
    .height('100%')
  }
}

@Extend(Column) function ft_column() {
  .margin(10)
  .justifyContent(FlexAlign.Start)
  .alignItems(HorizontalAlign.Center)
  .width('90%')
  .height('50%')
}

@Extend(Text) function ft_text() {
  .width(300)
  .height(60)
  .fontSize(18)
  .margin({top: 3})
  .backgroundColor(Color.Yellow)
  .textAlign(TextAlign.Center)
}

@Extend(Button) function ft_btn(bgColor: Color, click: Function) {
  .width(200)
  .height(50)
  .fontSize(18)
  .backgroundColor(bgColor)
  .onClick(()=> {
    click() //æ­¤å¤„çš„cLickæ˜¯ä¸€ä¸ªå½¢å‚ã€‚å…·ä½“ä»£è¡¨çš„æ˜¯è°ƒç”¨é™¤ä¼ è¿›æ¥çš„å‡½æ•°ã€‚åæ–¹è·Ÿå°æ‹¬å·ä»£è¡¨æ‰§è¡Œä¼ è¿›æ¥çš„å‡½æ•°ã€‚
  })
}

function item(item: string, index: number): string {
  throw new Error('Function not implemented.')
}

```

è¿™é‡Œæ¯”è¾ƒæ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹

``` ts
Text(item).ft_text()
	 .transition(
	   TransitionEffect.asymmetric(
	     // 1.å‡ºç°æ—¶åšä»æŒ‡å®šçš„é€æ˜åº¦ä¸º0å˜ä¸ºé»˜è®¤çš„é€æ˜åº¦1çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»æ—¶é•¿ä¸º1000msï¼Œ
	     // ä»¥åŠåšä»æŒ‡å®šçš„ç»•zè½´æ—‹è½¬180Â°å˜ä¸ºé»˜è®¤çš„æ—‹è½¬è§’ä¸º0çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»1000msåæ’­æ”¾ï¼Œæ—¶é•¿ä¸º1000ms
	     // 2.æ¶ˆå¤±æ—¶åšä»é»˜è®¤çš„é€æ˜åº¦ä¸º1å˜ä¸ºæŒ‡å®šçš„é€æ˜åº¦0çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»1000msåæ’­æ”¾ï¼Œ
	     // æ—¶é•¿ä¸º1000msï¼Œä»¥åŠåšä»é»˜è®¤çš„æ—‹è½¬è§’0å˜ä¸ºæŒ‡å®šçš„ç»•zè½´æ—‹è½¬180Â°çš„åŠ¨ç”»ï¼Œè¯¥åŠ¨ç”»æ—¶é•¿ä¸º1000ms
	     TransitionEffect.OPACITY.animation({ duration: 1000 }).combine(
	       TransitionEffect.rotate({ z: 1, angle: 180 }).animation({ delay: 1000, duration: 1000 })),
	       TransitionEffect.OPACITY.animation({ delay: 1000, duration: 1000 }).combine(
	        TransitionEffect.rotate({ z: 1, angle: 180 }).animation({ duration: 1000 })
	        // TransitionEffect.translate({x: 600, y: 0}).animation({duration: 1000})
	     )
	   )
	 )
	 // .transition(TransitionEffect.OPACITY.animation({duration: 2000, curve: Curve.Ease})
	 //   .combine(TransitionEffect.rotate({z: 1, angle: 180})
	 //   ))
	
	 // .transition(
	 //   TransitionEffect.asymmetric(
	 //     TransitionEffect.translate({x: 333, y: 333}),
	 //     TransitionEffect.IDENTITY
	 //   )
	 // )
```

æ‰¾äº†ä¸€ä¸‹æ–‡æ¡£[ç»„ä»¶å†…è½¬åœº (transition)](https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-transition-animation-component-0000001862687721)è¿™é‡Œæœ‰è¯¦ç»†çš„ä»‹ç».

è¿™ä¸ªåŠ¨ç”»æœ‰ç‚¹ç±»ä¼¼iOSçš„ä»¿å°„åŠ¨ç”».åªæ˜¯å¹³å°ä¸ä¸€æ ·,è¿™é‡Œçš„åŠ¨ç”»ä¹Ÿéå¸¸ä¸°å¯Œ.åç»­ä¼šæŒç»­æŠŠå…¶ä»–åŠ¨ç”»å®ç°ä¸€éè®°å½•åœ¨è¿™é‡Œ


# æ€»ç»“

é¸¿è’™å¼€å‘å·²ç»å­¦äº†3éäº†,æœ‰æ—¶å€™éœ€è¦è®°å½•ä¸€äº›åŠ¨ç”»å’Œå†…å®¹.å…¨å½“å­¦ä¹ ç¬”è®°.å¸Œæœ›èƒ½å¸®åŠ©å…¶å®ƒå¼€å‘è€….


URL: https://sunyazhou.com/2024/04/keepimagescale/index.html.md
Published At: 2024-04-02 09:16:00 +0000

# ä¿æŒåŸUIImageç¼©æ”¾æ¯”çš„è®¡ç®—æ–¹æ³•

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–å¼•ç”¨,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,è¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯.

# ä»£ç è®°å½•

``` objc
/// ä¿æŒå®½é«˜æ¯”ä¸å˜çš„å‰æçš„ å®½é«˜ä¸è¶…è¿‡ æœ€å¤§é™åˆ¶2048
/// - Parameter imageSize: åŸå§‹å¤§å°
- (CGSize)keepScaleSize:(CGSize)imageSize
{
    if (kw_is_float_zero(imageSize.width) || kw_is_float_zero(imageSize.height)) { return imageSize; }
    //checkæœ‰æ²¡æœ‰è¶…è¿‡æœ€å¤§é™åˆ¶
    if (imageSize.width < 2048 && imageSize.height < 2048) { return imageSize; }
    //è¶…è¿‡æœ€å¤§é™åˆ¶
    CGSize resize = CGSizeZero;
    if (imageSize.width > imageSize.height) {
        //æœ€é•¿è¾¹æ˜¯ å®½
        CGFloat ratio = imageSize.height / imageSize.width;
        CGFloat disWidth = 2048;
        CGFloat disHeight = disWidth * ratio;
        resize = CGSizeMake(disWidth, disHeight);
    } else {
        //æœ€é•¿è¾¹æ˜¯ é«˜
        CGFloat ratio = imageSize.width / imageSize.height;
        CGFloat disHeight = 2048;
        CGFloat disWidth = disHeight * ratio;
        resize = CGSizeMake(disWidth, disHeight);
    }
    return resize;
}
```

# æ€»ç»“

å¼€å‘è¿‡ç¨‹ä¸­æœ‰ä¸€äº›ç»å¸¸å¿˜è®°,å´å¾ˆå®¹æ˜“çš„è®¡ç®—æ–¹æ³•,å½“ç”¨åˆ°çš„æ—¶å€™å¾ˆéš¾æ‰¾,è®°å½•ä¸€ä¸‹ä»£ç ç‰‡æ®µ


URL: https://sunyazhou.com/2024/03/masonryrelayoutviews/index.html.md
Published At: 2024-03-22 13:24:00 +0000

# ä½¿ç”¨Masonryé«˜é˜¶æ–¹æ³•å¯¹å­è§†å›¾ç»Ÿä¸€å¸ƒå±€

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯ä»‹ç»


![](/assets/images/20240322MasonryRelayoutViews/MasonryRelayout.gif)

åœ¨å¼€å‘è¿‡ç¨‹ä¸­,ç»å¸¸é‡åˆ°æŸäº›å…¥å£çš„å‡ºç°å’Œæ¶ˆå¤±ä¸æ˜¯æŒ‰ç…§æŒ‡å®šçš„æ—¶åºå‘ç”Ÿ,æ¯”å¦‚ ä¸Šé¢è¿™ä¸‰ä¸ªå…¥å£,å‡ºç°çš„æ—¶æœºä¸åŒºåˆ†å…ˆå,ä½†æ˜¯å‡ºç°çš„é¡ºåºæ˜¯å›ºå®šçš„, è¿™é‡Œå°±å­˜åœ¨ä¸€äº›å¾ˆä¸å¥½å¤„ç†çš„é—®é¢˜, æ¯”å¦‚Aè§†å›¾å‡ºç° ä¾èµ–Bè§†å›¾çš„ä½ç½®,å¦‚æœBä¸åœ¨é‚£è¦ç»§ç»­å‘ä¸Šæˆ–è€…å‘ä¸‹ä¾èµ–. 

## é¢ä¸´çš„æŒ‘æˆ˜æ¡ˆä¾‹

åŸºäºä¸Šè¿°çš„èƒŒæ™¯æè¿°,æˆ‘ä»¬éœ€è¦å¤„ç†çš„é—®é¢˜å¦‚ä¸‹

* å‡è®¾ å…¥å£è§†å›¾çš„å‡ºç°æ—¶æœºæˆ–è€…æ¶ˆå¤±æ—¶æœº, ä¸æ˜¯æ—¶åºé¡ºåºçš„,æ˜¯æ—¶åºéšæœºçš„.
* å„ä¸ªå…¥å£è§†å›¾çš„æœ‰ä¾èµ–å…³ç³», æˆ–è€…é¡ºåºå›ºå®š è¦å¦‚ä½•å¤„ç†
* æœ‰æ²¡æœ‰ç®€å•æ›´æœ‰æ•ˆçš„æ–¹å¼ ä½¿ç”¨å°‘é‡ä»£ç è§£å†³ä¸Šè¿°é—®é¢˜çš„æœ€ä¼˜è§£.

æ ¹æ®ä¸Šè¿°çš„æŒ‘æˆ˜æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å¦‚ä½•è§£å†³

* è¦ç»™æ‰€æœ‰å…¥å£è§†å›¾æ·»åŠ ä¼˜å…ˆçº§, æ·»åŠ å’Œåˆ é™¤éƒ½éœ€è¦æ’åº
* å„ç§è§†å›¾æ·»åŠ çš„æ—¶é—´æ˜¯ä¸å›ºå®šçš„,é‚£ä¹ˆå°±è¦æœ‰ä¸€ä¸ªå…¬ç”¨çš„æ–¹æ³•æ§åˆ¶ä»–ä»¬æ·»åŠ å’Œç§»é™¤æˆ–è€…è¯´æ˜¯æ˜¾ç¤ºå’Œæ¶ˆå¤±éƒ½å¿…é¡»è¦è°ƒç”¨çš„æ–¹æ³•ç”¨äºå¸ƒå±€
* åŸºäºç®€å•çš„Masonryä»£ç èƒ½ä¸èƒ½ å‡ è¡Œæå®š.

### æœ€ä¼˜è§£çš„æ–¹å¼å®ç°

é¦–å…ˆæˆ‘ä»¬å…ˆå°è£…ä¸€ä¸ªUIViewçš„å­ç±»,å¯¹å¤–æä¾›å„ç§å…¥å£çš„showå’Œdismissæ–¹æ³•.å†…éƒ¨è¦å¯¹è¿™äº›å…¥å£æ·»åŠ æˆ–è€…æ¶ˆå¤±çš„æ—¶å€™è°ƒç”¨relayoutçš„å‡½æ•°æ–¹æ³•. relayoutæ–¹æ³•ä¸­è¦å¯¹ç°æœ‰çš„è§†å›¾è¿›è¡Œæ’åº. ç„¶åç»Ÿä¸€ç”¨Masonryæä¾›çš„æ–¹æ³•è§£å†³å¸ƒå±€é—®é¢˜.

``` objc
typedef NS_ENUM(NSUInteger, MTContainerViewPriority) {
    MTContainerViewPriorityL1 = 101,
    MTContainerViewPriorityL2 = 102,
    MTContainerViewPriorityL3 = 103,
    //more ...
};

@interface MTContainerView : UIView

- (void)showView1;
- (void)dismissView1;

- (void)showView2;
- (void)dimissView2;

- (void)showView3;
- (void)dismissView3;

@end
```

å®ç°æ–‡ä»¶

``` objc
#import "MTContainerView.h"
#import <Masonry/Masonry.h>

const CGSize MTContainerSize = { 40 , 40};

@interface MTContainerView ()

@property (nonatomic, strong) UIView *view1;
@property (nonatomic, strong) UIView *view2;
@property (nonatomic, strong) UIView *view3;

@end

@implementation MTContainerView

#pragma mark -
#pragma mark - private methods ç§æœ‰æ–¹æ³•
- (void)layoutAllEntryViewsIfNeeded
{
    NSSortDescriptor *ascendingSort = [[NSSortDescriptor alloc] initWithKey:@"tag" ascending:YES];
    NSArray <UIView *> *allEntries = [[self subviews] sortedArrayUsingDescriptors:[NSArray arrayWithObject:ascendingSort]];
    if (allEntries.count == 0) { return; }
    if (allEntries.count == 1) {
        UIView *entryView = [allEntries objectAtIndex:0];
        [entryView mas_remakeConstraints:^(MASConstraintMaker *make) {
            make.size.mas_equalTo(MTContainerSize);
            make.right.equalTo(self.mas_right).offset(-10);
            make.centerY.equalTo(self.mas_centerY);
        }];
    } else {
        // ä½¿ç”¨ mas_distributeViewsAlongAxis æ–¹æ³•å¯¹ä¸‰ä¸ªè§†å›¾è¿›è¡Œæ°´å¹³å³å¯¹é½å¹¶ä¸€æ¬¡æ’å¼€
        [allEntries mas_remakeConstraints:^(MASConstraintMaker *make) {
            make.size.mas_equalTo(MTContainerSize);
            make.centerY.equalTo(self.mas_centerY);
        }];
        //å¿…é¡» allEntries.count >= 2 æ‰èƒ½ç”¨ä¸‹è¿°æ–¹æ³•, ä¸‹é¢é—´è·ç®—æ³• å®¹å™¨å®½åº¦-æ‰€ç”¨å®¹é‡å®½åº¦(åŒ…å«å³ä¾§é—´éš™+æ¯ä¸ªitemå¤§å°+æ¯ä¸ªitemä¹‹é—´çš„é—´éš™)
        CGFloat leadSpace = CGRectGetWidth(self.frame) - allEntries.count * MTContainerSize.width - 10 - (allEntries.count - 1) * 10;
        [allEntries mas_distributeViewsAlongAxis:MASAxisTypeHorizontal withFixedSpacing:10 leadSpacing:leadSpace tailSpacing:10];
    }
    [UIView animateWithDuration:0.3 animations:^{
        [self layoutIfNeeded];
    }];
}

- (UIColor *)randomColor
{
    CGFloat hue = ( arc4random() % 256 / 256.0 );  //  0.0 to 1.0
    CGFloat saturation = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from white
    CGFloat brightness = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from black
    UIColor *color = [UIColor colorWithHue:hue saturation:saturation brightness:brightness alpha:1];
    return color;
}

#pragma mark -
#pragma mark - public methods å…¬æœ‰æ–¹æ³•
- (void)showView1
{
    if (self.view1 == nil) {
        self.view1 = [[UIView alloc] initWithFrame:CGRectMake(CGRectGetWidth(UIScreen.mainScreen.bounds), 20, MTContainerSize.width, MTContainerSize.height)];
        self.view1.backgroundColor = [self randomColor];
        self.view1.tag = MTContainerViewPriorityL1;
    }
    if (self.view1.superview == nil) {
        [self addSubview:self.view1];
    }
    [self layoutAllEntryViewsIfNeeded];
}

- (void)dismissView1
{
    if (self.view1.superview) {
        [self.view1 removeFromSuperview];
    }
    self.view1 = nil;
    [self layoutAllEntryViewsIfNeeded];
}

- (void)showView2
{
    if (self.view2 == nil) {
        self.view2 = [[UIView alloc] initWithFrame:CGRectMake(CGRectGetWidth(UIScreen.mainScreen.bounds), 20, MTContainerSize.width, MTContainerSize.height)];
        self.view2.backgroundColor = [self randomColor];
        self.view2.tag = MTContainerViewPriorityL2;
    }
    if (self.view2.superview == nil) {
        [self addSubview:self.view2];
    }
    [self layoutAllEntryViewsIfNeeded];
}

- (void)dimissView2
{
    if (self.view2.superview) {
        [self.view2 removeFromSuperview];
    }
    self.view2 = nil;
    [self layoutAllEntryViewsIfNeeded];
}

- (void)showView3
{
    if (self.view3 == nil) {
        self.view3 = [[UIView alloc] initWithFrame:CGRectMake(CGRectGetWidth(UIScreen.mainScreen.bounds), 20, MTContainerSize.width, MTContainerSize.height)];
        self.view3.backgroundColor = [self randomColor];
        self.view3.tag = MTContainerViewPriorityL3;
    }
    if (self.view3.superview == nil) {
        [self addSubview:self.view3];
    }
    [self layoutAllEntryViewsIfNeeded];
}

- (void)dismissView3
{
    if (self.view3.superview) {
        [self.view3 removeFromSuperview];
    }
    self.view3 = nil;
    [self layoutAllEntryViewsIfNeeded];
}
 
@end
```


è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä¸æŒ‰é¡ºåº ä¸åŒæ—¶åº æ·»åŠ è§†å›¾

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.continerView = [[MTContainerView alloc] initWithFrame:CGRectZero];
    self.continerView.backgroundColor = [UIColor cyanColor];
    [self.view addSubview:self.continerView];
    
    [self.continerView mas_remakeConstraints:^(MASConstraintMaker *make) {
        make.left.right.equalTo(self.view);
        make.top.mas_equalTo(self.mas_topLayoutGuideBottom);
        make.height.equalTo(@60);
    }];
    
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        [self.continerView showView3];
    });
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(4 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        [self.continerView showView1];
    });
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(7 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
        [self.continerView showView2];
    });
}

```

## æ ¸å¿ƒå®ç°ä»£ç 

``` objc
- (void)layoutAllEntryViewsIfNeeded
{
    NSSortDescriptor *ascendingSort = [[NSSortDescriptor alloc] initWithKey:@"tag" ascending:YES];
    NSArray <UIView *> *allEntries = [[self subviews] sortedArrayUsingDescriptors:[NSArray arrayWithObject:ascendingSort]];
    if (allEntries.count == 0) { return; }
    if (allEntries.count == 1) {
        UIView *entryView = [allEntries objectAtIndex:0];
        [entryView mas_remakeConstraints:^(MASConstraintMaker *make) {
            make.size.mas_equalTo(MTContainerSize);
            make.right.equalTo(self.mas_right).offset(-10);
            make.centerY.equalTo(self.mas_centerY);
        }];
    } else {
        // ä½¿ç”¨ mas_distributeViewsAlongAxis æ–¹æ³•å¯¹ä¸‰ä¸ªè§†å›¾è¿›è¡Œæ°´å¹³å³å¯¹é½å¹¶ä¸€æ¬¡æ’å¼€
        [allEntries mas_remakeConstraints:^(MASConstraintMaker *make) {
            make.size.mas_equalTo(MTContainerSize);
            make.centerY.equalTo(self.mas_centerY);
        }];
        //å¿…é¡» allEntries.count >= 2 æ‰èƒ½ç”¨ä¸‹è¿°æ–¹æ³•, ä¸‹é¢é—´è·ç®—æ³• å®¹å™¨å®½åº¦-æ‰€ç”¨å®¹é‡å®½åº¦(åŒ…å«å³ä¾§é—´éš™+æ¯ä¸ªitemå¤§å°+æ¯ä¸ªitemä¹‹é—´çš„é—´éš™)
        CGFloat leadSpace = CGRectGetWidth(self.frame) - allEntries.count * MTContainerSize.width - 10 - (allEntries.count - 1) * 10;
        [allEntries mas_distributeViewsAlongAxis:MASAxisTypeHorizontal withFixedSpacing:10 leadSpacing:leadSpace tailSpacing:10];
    }
    [UIView animateWithDuration:0.3 animations:^{
        [self layoutIfNeeded];
    }];
}
```

è¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è¯´æ¸…æ¥š

* mas_makeConstraints æ˜¯Masonryç»™NSArrayæ‰©å±•çš„æ–¹æ³•.ç”¨äºæ‰¹é‡å¤„ç†è§†å›¾ä½¿ç”¨,å®ƒå¿…é¡»ä¿è¯NSArray.count > 1
* ç»Ÿä¸€å¸ƒå±€ å®ç°çš„æ˜¯å›ºå®šå¤§å°, å¦‚æœè¦å®ç° å¤šä¸ªè§†å›¾ä¸åŒå¤§å°,é‚£ç›®å‰è¿™ç§æ–¹å¼ä¸é€‚ç”¨
* Masonryæ²¡æœ‰åƒArkUIå’ŒSwiftUIä¸­å£°æ˜å¼ç¼–ç¨‹,é‚£ç§å®¹å™¨å¯¹é½çš„æ–¹å¼,æ¯”å¦‚ startã€centerã€endç­‰å†…å®¹å¯¹é½.æ‰€ä»¥ä¼šçœ‹åˆ°æœ‰å¦‚ä¸‹ä»£ç 

``` objc
CGFloat leadSpace = CGRectGetWidth(self.frame) - allEntries.count * MTContainerSize.width - 10 - (allEntries.count - 1) * 10;
[allEntries mas_distributeViewsAlongAxis:MASAxisTypeHorizontal withFixedSpacing:10 leadSpacing:leadSpace tailSpacing:10];
```

è®¡ç®—`leadSpace`å·¦ä¾§å‘å³çš„åç§»è·ç¦».

é€šè¿‡ä¸Šè¿°å®ç°æˆ‘ä»¬å°±æœ‰äº†å¦‚ä¸‹çš„demo

![](/assets/images/20240322MasonryRelayoutViews/MasonryRelayoutDemo.gif)

è¿™é‡Œçš„æ ¸å¿ƒä»£ç æ˜¯Masonryæä¾›çš„æ•°ç»„æ‰©å±•æ–¹æ³•

``` objc
- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block {
    self.translatesAutoresizingMaskIntoConstraints = NO;
    MASConstraintMaker *constraintMaker = [[MASConstraintMaker alloc] initWithView:self];
    block(constraintMaker);
    return [constraintMaker install];
}

- (void)mas_distributeViewsAlongAxis:(MASAxisType)axisType withFixedSpacing:(CGFloat)fixedSpacing leadSpacing:(CGFloat)leadSpacing tailSpacing:(CGFloat)tailSpacing;

- (void)mas_distributeViewsAlongAxis:(MASAxisType)axisType withFixedItemLength:(CGFloat)fixedItemLength leadSpacing:(CGFloat)leadSpacing tailSpacing:(CGFloat)tailSpacing;

```

ä»¥ä¸Šä¸‰ä¸ªæ–¹æ³•æ˜¯å®ç°ä¸Šè¿°è§†å›¾çš„å…³é”®


# æ€»ç»“

æ·±å…¥äº†è§£Masonryçš„apiä½¿ç”¨.ç”¨é«˜é˜¶ç”¨æ³•å®ç°å¤æ‚çš„åŠŸèƒ½.

[æœ¬æ–‡demo ç‚¹å‡»ä¸‹è½½](https://github.com/sunyazhou13/MasonryRelayoutDemo)


URL: https://sunyazhou.com/2024/02/MotionShake/index.html.md
Published At: 2024-02-21 06:56:00 +0000

# è¿åŠ¨ä¼ æ„Ÿå™¨æ‘‡æ™ƒæ£€æµ‹

![](/assets/images/20240222MotionShake/CMMotion.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–å¼•ç”¨,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,è¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯.


## èƒŒæ™¯è¯´æ˜

æœ€è¿‘å¼€å‘é‡åˆ°ç”¨æˆ·åé¦ˆ,å¼€å¯æ™ƒåŠ¨æ‰‹æœºåˆ‡æ¢æ­Œæ›²æ—¶,æ”¾è£¤å…œæˆ–è€…è¡£æœå£è¢‹ä¸­,å¾ˆå®¹æ˜“è§¦å‘ä¸»åŠ¨åˆ‡æ¢æ­Œæ›²,å¸¦ç€è¿™ä¸ªé—®é¢˜,æˆ‘ä»”
ç»†ç ”ç©¶äº†ä¸€ä¸‹å›ºæœ‰ä»£ç .

å¾ˆæ˜¾ç„¶ç”¨æˆ·ä½¿ç”¨æ‘‡ä¸€æ‘‡æ‰‹æœºåˆ‡æ¢æ­Œæ›²çš„çµæ•åº¦å¤ªé«˜äº†.é‚£æ€ä¹ˆè°ƒæ•´çµæ•åº¦åˆ°ä¸€ä¸ªåˆç†åŒºé—´å‘¢ï¼Ÿ

# å®ç°æ‘‡æ™ƒåŠ¨ä½œçš„å‡ ç§æ–¹å¼

* 1.ç³»ç»Ÿäº‹ä»¶
* 2.CMMotionManageråŠ é€Ÿè®¡api
* 3.UIAccelerometer

## ç³»ç»Ÿçš„æ‘‡ä¸€æ‘‡äº‹ä»¶

æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç»§æ‰¿è‡ª`UIResponder`çš„ç±»,å®ç°å¦‚ä¸‹æ–¹æ³•

``` objc
 -(BOOL)canBecomeFirstResponder {
    return YES;
}

- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event {
    if (event.subtype == UIEventSubtypeMotionShake) {
        NSLog(@"æ‘‡æ™ƒæ‰‹åŠ¿è¢«æ£€æµ‹åˆ°");
        // åœ¨è¿™é‡Œå¤„ç†æ‘‡æ™ƒæ‰‹åŠ¿äº‹ä»¶
    }
}
```

æ¯”å¦‚åœ¨UIViewControllerä¸­æˆ‘ä»¬ å®ç°ä¸Šè¿°ä»£ç 


``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    [self becomeFirstResponder];
}

- (BOOL)canBecomeFirstResponder {
    return YES;
}

- (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event {
    if (event.subtype == UIEventSubtypeMotionShake) {
        NSLog(@"æ‘‡æ™ƒæ‰‹åŠ¿è¢«æ£€æµ‹åˆ°");
        // åœ¨è¿™é‡Œå¤„ç†æ‘‡æ™ƒæ‰‹åŠ¿äº‹ä»¶
    }
}
```

å°±å¯ä»¥åœ¨Objective-Cä¸­å®ç°æ‘‡æ™ƒæ‰‹åŠ¿æ£€æµ‹äº†

> ç„¶è€Œè¿™ç§æ¨¡å¼æ²¡æœ‰å…¥å£è®©æˆ‘è®¾ç½®é˜ˆå€¼æ§åˆ¶æ‘‡ä¸€æ‘‡çš„çµæ•åº¦

## CMMotionManager

é¦–å…ˆå…ˆææ¸…æ¥šè¿™é‡Œæœ‰å•¥,iOS ä¸­å¸¸è§ä¼ æ„Ÿå™¨å¦‚ä¸‹æ‰€ç¤º:

| ç±»å‹ | ä½œç”¨ | å¤‡æ³¨ |
| ------| ------ | ------ |
| ç¯å¢ƒå…‰ä¼ æ„Ÿå™¨ | æ„Ÿåº”å…‰ç…§å¼ºåº¦ | |
| è·ç¦»ä¼ æ„Ÿå™¨	| æ„Ÿåº”é è¿‘è®¾å¤‡å±å¹•çš„ç‰©ä½“ | |
| ç£åŠ›è®¡ä¼ æ„Ÿå™¨ | æ„Ÿåº”å‘¨è¾¹ç£åœº | |
| å†…éƒ¨æ¸©åº¦ä¼ æ„Ÿå™¨	| æ„Ÿåº”è®¾å¤‡å†…éƒ¨æ¸©åº¦ï¼ˆéå…¬å¼€ï¼‰ | 
| æ¹¿åº¦ä¼ æ„Ÿå™¨	| æ„Ÿåº”è®¾å¤‡æ˜¯å¦è¿›æ°´ï¼ˆéå¾®ç”µå­ä¼ æ„Ÿå™¨ï¼‰ | 
| é™€èºä»ª	| æ„Ÿåº”æŒæ¡æ–¹å¼ | 
| åŠ é€Ÿè®¡	| æ„Ÿåº”è®¾å¤‡è¿åŠ¨ | 

CMMotionManager æ˜¯ `Core Motion` åº“çš„æ ¸å¿ƒç±»ï¼Œè´Ÿè´£è·å–å’Œå¤„ç†æ‰‹æœºçš„è¿åŠ¨ä¿¡æ¯ï¼Œå®ƒå¯ä»¥è·å–çš„æ•°æ®æœ‰:  

* åŠ é€Ÿåº¦ï¼Œæ ‡è¯†è®¾å¤‡åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„ç¬æ—¶åŠ é€Ÿåº¦
* é™€èºä»ªï¼Œæ ‡è¯†è®¾å¤‡åœ¨ä¸‰ä¸ªä¸»è½´ä¸Šçš„ç¬æ—¶æ—‹è½¬
* ç£åœºä¿¡æ¯ï¼Œæ ‡è¯†è®¾å¤‡ç›¸å¯¹äºåœ°çƒç£åœºçš„æ–¹ä½
* è®¾å¤‡è¿åŠ¨æ•°æ®ï¼Œæ ‡è¯†å…³é”®çš„è¿åŠ¨ç›¸å…³å±æ€§ï¼ŒåŒ…æ‹¬è®¾å¤‡ç”¨æˆ·å¼•èµ·çš„åŠ é€Ÿåº¦ã€å§¿æ€ã€æ—‹è½¬é€Ÿç‡ã€ç›¸å¯¹äºæ ¡å‡†ç£åœºçš„æ–¹ä½ä»¥åŠç›¸å¯¹äºé‡åŠ›çš„æ–¹ä½ç­‰ï¼Œè¿™äº›æ•°æ®å‡æ¥è‡ªäº Core Motion çš„ä¼ æ„Ÿå™¨èåˆç®—æ³•ï¼Œä»è¿™ä¸€ä¸ªæ•°æ®æ¥å£å³å¯è·å–ä»¥ä¸Šä¸‰ç§æ•°æ®ï¼Œå› æ­¤ä½¿ç”¨è¾ƒä¸ºå¹¿æ³›.æ¯”å¦‚nikeçš„è·‘é‹app è®¡ç®—æ­¥æ•°å°±æ˜¯ä¾èµ–äºè¿™ä¸ªä¼ æ„Ÿå™¨.

[äº†è§£æ›´å¤šCMMotionå¯ä»¥å‚è€ƒè¿™é‡Œ](https://www.jianshu.com/p/2f5cca76c5ee)

ä½¿ç”¨è¿™ä¸ª`CMMotionManager `ä¹‹å‰æˆ‘ä»¬è¦ä¿è¯åœ¨info.plistä¸­åŠ å…¥Privacy â€“ Motion Usage Description.è®©ç”¨æˆ·çŸ¥é“æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªä¼ æ„Ÿå™¨.

``` xml
<key>NSMotionUsageDescription</key>
<string>è¯·é€‰æ‹©â€œå…è®¸â€ï¼Œå¯ä¸ºæ‚¨æä¾›æ™ƒåŠ¨åˆ‡æ¢æ­Œæ›²</string>  
```

ä¸‹é¢æ˜¯ä½¿ç”¨çš„ç¤ºä¾‹ä»£ç 

``` objc
#import <CoreMotion/CoreMotion.h>

@interface ShakeDetector : NSObject
@property (nonatomic, strong) CMMotionManager *motionManager;
- (void)startShakeDetection;

@end

#import "ShakeDetector.h"

@implementation ShakeDetector  

- (void)startShakeDetection {
    self.motionManager = [[CMMotionManager alloc] init];
    self.motionManager.deviceMotionUpdateInterval = 1.0/60.0;
    [self.motionManager startDeviceMotionUpdatesToQueue:[NSOperationQueue mainQueue] withHandler:^(CMDeviceMotion *motion, NSError *error) {
        CMAcceleration userAcceleration = motion.userAcceleration;
        double accelerationThreshold = 0.30;
        if (fabs(userAcceleration.x) > accelerationThreshold || fabs(userAcceleration.y) > accelerationThreshold || fabs(userAcceleration.z) > accelerationThreshold) {
            // åœ¨è¿™é‡Œå¤„ç†æ‘‡æ™ƒåŠ¨ä½œçš„é€»è¾‘
            NSLog(@"Device shaken!");
        }
    }];
}

@end
```

### å®ç°åŸç†

å®ç°åŸç†ï¼šé€šè¿‡xã€yã€zä¸‰ä¸ªè½´çš„æ–¹å‘çš„åŠ é€Ÿåº¦è®¡ç®—å‡ºæ‘‡åŠ¨æ‰‹æœºæ—¶ï¼Œæ‰‹æœºæ‘‡åŠ¨æ–¹å‘çš„åŠ é€Ÿåº¦a,

$$
\begin{align}  
  g = \sqrt{x^2+y^2+z^2}
\end{align}  
$$


åŠ é€Ÿè®¡ä¸­çš„å•ä½ä¸ºï¼šg(é‡åŠ›åŠ é€Ÿåº¦9.8ç±³/ç§’), å½“g > 1.6, è®°å½•ä¸€æ¬¡æ‘‡åŠ¨.å‚è€ƒèŒƒå›´(2.0~3.0).



``` objc
typedef struct {
	double x;
	double y;
	double z;
} CMAcceleration;
```

é€šè¿‡ä¼ æ„Ÿå™¨è¿”å›çš„`CMAcceleration `ç»“æ„ä½“,å’Œæˆ‘ä»¬æŒ‡å®šçš„é˜ˆå€¼åšæ£€æµ‹,é€šè¿‡åŠ é€Ÿè®¡çš„x, y, zåˆ†åˆ«checkæ˜¯å¦å¤§äºæˆ‘ä»¬è®¾ç½®çš„é˜ˆå€¼.å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªå€¼å¤§äºæˆ‘ä»¬æŒ‡å®šçš„é˜ˆå€¼,å°±è¯´æ˜æˆ‘ä»¬æ£€æµ‹åˆ°äº†`æ‘‡æ™ƒåŠ¨ä½œ`å¯ä»¥ç†è§£ä¸ºæ‘‡ä¸€æ‘‡.

``` objc
double threshold = 2.45; //æŒ‡å®šçµæ•åº¦é˜ˆå€¼
if (fabs(acceleration.x) > threshold || fabs(acceleration.y) > threshold || fabs(acceleration.z) > threshold) {
    	...
}
```

`threshold`é˜ˆå€¼è¿™é‡Œéœ€è¦å¯ä»¥å‚è€ƒå¦‚ä¸‹:  
* **å¯¹äºä¸€èˆ¬çš„æ‘‡ä¸€æ‘‡åŠŸèƒ½ï¼Œé˜ˆå€¼å¤§å°å¯ä»¥åœ¨1.0åˆ°2.0ä¹‹é—´**.  
* **å¦‚æœéœ€è¦æ›´é«˜çš„çµæ•åº¦ï¼Œå¯ä»¥é€‰æ‹©è¾ƒå°çš„é˜ˆå€¼ï¼Œä¾‹å¦‚0.5åˆ°1.0**.  
* **å¦‚æœéœ€è¦è¾ƒä½çš„çµæ•åº¦ï¼Œå¯ä»¥é€‰æ‹©è¾ƒå¤§çš„é˜ˆå€¼ï¼Œä¾‹å¦‚2.0åˆ°3.0**.

`2.45`æ˜¯æˆ‘æµ‹è¯•å‡ºæ¥æ¯”è¾ƒé€‚åˆå¤§éƒ¨åˆ†äººæ‰‹æ‘‡æ™ƒçš„åŠ›é‡,å¹¶ä¸”é¿å…è½»å¾®æ™ƒåŠ¨è§¦å‘å¾—å‡ºçš„ç†æƒ³å€¼.

### é˜Ÿåˆ—æ§åˆ¶

å½“æˆ‘ä½¿ç”¨`CMMotionManager`æ—¶æ³¨æ„,æœ€å¥½æ˜¯æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„é˜Ÿåˆ—ä¸­.ä¸»è¦æ˜¯æ‹…å¿ƒæ”¾ä¸»çº¿ç¨‹å½±å“ä¸»çº¿ç¨‹æ€§èƒ½.

``` objc
//æ³¨æ„è¿™é‡Œ customeMotionOperationQueue
[self.motionManager startAccelerometerUpdatesToQueue:customeMotionOperationQueue withHandler:..];
```

### é¢‘ç‡ä¼˜åŒ–

å› ä¸ºæ ¹æ®ä¸Šè¿°åŸç†ä»‹ç»æˆ‘ä»¬å¯ä»¥é€šè¿‡x, y, zè½´çš„åŠ é€Ÿåº¦æ¥æ£€æµ‹å½“å‰æ˜¯å¦æ˜¯æ‘‡æ™ƒ,ä½†æ˜¯æœ‰å¯èƒ½ ä¸Šä¸‹æ“ä½œè¿‡å¿«ä¼šå¯¼è‡´æ£€æµ‹è§¦å‘å¤šæ¬¡,ä¸ºäº†æ§åˆ¶ å¤šæ¬¡ä¹‹é—´çš„é—´éš™å¤ªçŸ­é—®é¢˜,æˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç æ§åˆ¶é¢‘ç‡

``` objc
@property (nonatomic, assign) CFAbsoluteTime beforeTime; //è®°å¾—åˆå§‹åŒ–èµ‹å€¼.
...

// æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ
CFAbsoluteTime afterTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘åçš„æ—¶é—´
CFTimeInterval timeDifference = afterTime - self.beforeTime; // è®¡ç®—æ—¶é—´å·® å•ä½ç§’ s
CFTimeInterval intervalSenonds = 1.0;  
if (timeDifference >= intervalSenonds) { //æ§åˆ¶æ£€æµ‹å‰åé—´éš”
    //NSLog(@"æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,è·ç¦»ä¸Šæ¬¡æ£€æµ‹: f seconds", timeDifference);
    self.beforeTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘å‰çš„æ—¶é—´
    if (self.didAcceleratorDectecdBlock) {
        self.didAcceleratorDectecdBlock();
    }
} else {
    //NSLog(@"æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,é—´éš”ä¸æ»¡è¶³ f seconds,å¿½ç•¥æœ¬æ¬¡æ£€æµ‹!",intervalSenonds);
}

```

è¿™æ ·å°±æ§åˆ¶äº†åŠ é€Ÿè®¡å¤šæ¬¡æ£€æµ‹è§¦å‘é¢‘ç‡æ¯”è¾ƒé¢‘ç¹çš„å›è°ƒé—®é¢˜.

### ç¼–å†™å·¥å…·ç±» 20240326æ›´æ–°,ä¼˜åŒ–æ™ƒåŠ¨ç®—æ³•,é˜²æ­¢è¯¯è§¦

ç„¶åå†™ä¸ªå·¥å…·ç±»,æŠŠä¸Šè¿°çš„å†…å®¹å…¨éƒ¨æ”¾åˆ°ä¸€ä¸ªå·¥å…·ç±»ä¸­ä¾›å¤§å®¶ä½¿ç”¨, æˆ‘ä»¬å†™ä¸€ä¸ªMTCMMotionToolç±»ç”¨äºå°è£…åŠ é€Ÿè®¡ä¼ æ„Ÿå™¨çš„å®ç°

//.hæ–‡ä»¶

``` objc
typedef NS_ENUM(NSUInteger, MTAccelerationAlgorithm) {
    MTAccelerationAlgorithmNormal = 0,  //å¸¸è§„ç®—æ³•æ‘‡ä¸€æ‘‡
    MTAccelerationAlgorithmLPF    = 1,  //ä½é€šæ»¤æ³¢å™¨æ¥å¹³æ»‘åŠ é€Ÿåº¦ å‡å°‘è¯¯è§¦
};

/**
 åˆ©ç”¨é—¨é¢æ¨¡å¼,å¯¹å¤–æš´éœ²ç»Ÿä¸€æ¥å£
 */
@interface MTCMMotionTool : NSObject

/**
 1.å¯¹äºä¸€èˆ¬çš„æ‘‡ä¸€æ‘‡åŠŸèƒ½ï¼Œé˜ˆå€¼å¤§å°å¯ä»¥åœ¨1.0åˆ°2.0ä¹‹é—´ã€‚
   å¦‚æœéœ€è¦æ›´é«˜çš„çµæ•åº¦ï¼Œå¯ä»¥é€‰æ‹©è¾ƒå°çš„é˜ˆå€¼ï¼Œä¾‹å¦‚0.5åˆ°1.0ã€‚
   å¦‚æœéœ€è¦è¾ƒä½çš„çµæ•åº¦ï¼Œå¯ä»¥é€‰æ‹©è¾ƒå¤§çš„é˜ˆå€¼ï¼Œä¾‹å¦‚2.0åˆ°3.0ã€‚
 2.å¯¹äºLPFä½é€šå½•æ³¢å™¨å¹³æ»‘ç®—æ³•,é˜ˆå€¼å¤§å°å‚è€ƒèŒƒå›´ 0.33~0.88
*/
@property (nonatomic, assign) CGFloat accelerateThreshold; //åŠ é€Ÿè®¡çµæ•åº¦é˜ˆå€¼,Normalç®—æ³•é»˜è®¤ 2.45, LPFç®—æ³•0.38(å»ºè®®æ§åˆ¶åœ¨0.33~0.88)
@property (nonatomic, assign) CGFloat accelerateDetectedInterval; //åŠ é€Ÿè®¡æ£€æŸ¥åŠ¨ä½œåçš„å‰åä¸¤æ¬¡é—´éš”æ—¶é—´,é˜²æ­¢é¢‘ç¹æ£€æµ‹æ‰§è¡Œ å•ä½ç§’Senonds.default 1s.
@property (nonatomic, copy) void (^didAcceleratorDectecdBlock)(void);
@property (nonatomic, assign) MTAccelerationAlgorithm accelerationAlgorithm; //ä½¿ç”¨åŠ é€Ÿè®¡ æ£€æµ‹æ‘‡ä¸€æ‘‡ç®—æ³•ç±»å‹

//å¯åŠ¨åŠ é€Ÿè®¡
- (void)startAccelerometer;
//åœæ­¢åŠ é€Ÿè®¡
- (void)stopAccelerometer;

@end
```

//.mæ–‡ä»¶

``` objc
#define kFilteringFactor 0.1  // åˆå§‹åŒ–ä½é€šæ»¤æ³¢å™¨

@interface MTCMMotionTool() <UIAccelerometerDelegate>

@property (nonatomic, strong) CMMotionManager *motionManager;
@property (nonatomic, strong) NSOperationQueue *cmMotionOperationQueue;
@property (nonatomic, assign) CFAbsoluteTime beforeTime;

/// ä¼ ç»ŸåŠ é€Ÿè®¡æš‚å­˜å€¼
@property (nonatomic, assign) UIAccelerationValue accelerationX;
@property (nonatomic, assign) UIAccelerationValue accelerationY;
@property (nonatomic, assign) double currentRawReading;

/// ä½é€šæ»¤æ³¢å™¨å¹³æ»‘ç”¨åˆ°åŠ é€Ÿè®¡
@property (nonatomic, assign) CMAcceleration previousAcceleration;

@end

@implementation MTCMMotionTool

- (instancetype)init
{
    self = [super init];
    if (self) {
        self.accelerateThreshold = 0.0f;
        self.accelerateDetectedInterval = 1; //1s
        CMAcceleration acceleration;
        acceleration.x = 0;
        acceleration.y = 0;
        acceleration.z = 0;
        self.previousAcceleration = acceleration;
        self.beforeTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘å‰çš„æ—¶é—´
    }
    return self;
}

#pragma mark -
#pragma mark - private methods ç§æœ‰æ–¹æ³•
//Note that when the updates are stopped, all operations in the given NSOperationQueue will be cancelled
- (void)createOperationQueueIfNeeded
{
    if (self.cmMotionOperationQueue == nil) {
        self.cmMotionOperationQueue = [[NSOperationQueue alloc] init];
    }
}

- (void)startAccelerometerUpdates {
    [self createOperationQueueIfNeeded]; //æŒ‰éœ€åˆ›å»ºé˜Ÿåˆ—,å½“é˜Ÿé‡Œä¸­çš„å„ç§ä¼ æ„Ÿå™¨stopæ—¶ ä¼šè‡ªåŠ¨ç§»é™¤operation.
    if (self.motionManager == nil) {
        self.motionManager = [[CMMotionManager alloc] init];
    }
    if (self.motionManager.isAccelerometerAvailable) {
        self.motionManager.accelerometerUpdateInterval = 0.2;
        __weak typeof(self) weakSelf = self;
        [self.motionManager startAccelerometerUpdatesToQueue:self.cmMotionOperationQueue
                                                 withHandler:^(CMAccelerometerData *accelerometerData, NSError *error) {
            __strong typeof(weakSelf) strongSelf = weakSelf;
            if (accelerometerData) {
                [self detectShake:accelerometerData.acceleration];
            }
        }];
    }
}

- (void)stopAccelerometerUpdates
{
    if (self.motionManager) {
        [self.motionManager stopAccelerometerUpdates];
        self.motionManager = nil;
    }
}

- (void)detectShake:(CMAcceleration)acceleration {
    if (self.accelerationAlgorithm == MTAccelerationAlgorithmNormal) {
        [self normalDetectShake:acceleration];
    } else if (self.accelerationAlgorithm == MTAccelerationAlgorithmLPF) {
        [self lpfDetectShake:acceleration];
    } else {
        //ä½¿ç”¨å…¶å®ƒç®—æ³•å®ç°æ‘‡ä¸€æ‘‡
    }
}

- (void)normalDetectShake:(CMAcceleration)acceleration
{
    double threshold = self.accelerateThreshold;
    if (fabs(acceleration.x) > threshold || fabs(acceleration.y) > threshold || fabs(acceleration.z) > threshold) {
        // æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ
        CFAbsoluteTime afterTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘åçš„æ—¶é—´
        CFTimeInterval timeDifference = afterTime - self.beforeTime; // è®¡ç®—æ—¶é—´å·® å•ä½ç§’ s
        CFTimeInterval intervalSenonds = self.accelerateDetectedInterval;
        if (timeDifference >= intervalSenonds) { //æ§åˆ¶æ£€æµ‹å‰åé—´éš”
            //NSLog(@"æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,è·ç¦»ä¸Šæ¬¡æ£€æµ‹: 1f seconds", timeDifference);
            self.beforeTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘å‰çš„æ—¶é—´
            if (self.didAcceleratorDectecdBlock) {
                self.didAcceleratorDectecdBlock();
            }
        } else {
            //NSLog(@"æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,é—´éš”ä¸æ»¡è¶³ 1f seconds,å¿½ç•¥æœ¬æ¬¡æ£€æµ‹!",intervalSenonds);
        }
    }
}

//ä½é€šæ»¤æ³¢å™¨æ¥å¹³æ»‘åŠ é€Ÿåº¦æ•°æ®ï¼Œå¹¶è®¡ç®—åŠ é€Ÿåº¦å˜åŒ–ç‡ã€‚é€šè¿‡è°ƒæ•´ kFilteringFactor å’Œé˜ˆå€¼æ¥é€‚åº”å…·ä½“éœ€æ±‚ï¼Œå¯ä»¥å‡å°‘è¯¯è§¦çš„å¯èƒ½æ€§
- (void)lpfDetectShake:(CMAcceleration)acceleration
{
    // åº”ç”¨ä½é€šæ»¤æ³¢å™¨
    CMAcceleration filteredAcceleration;
    filteredAcceleration.x = (acceleration.x * kFilteringFactor) + (self.previousAcceleration.x * (1.0 - kFilteringFactor));
    filteredAcceleration.y = (acceleration.y * kFilteringFactor) + (self.previousAcceleration.y * (1.0 - kFilteringFactor));
    filteredAcceleration.z = (acceleration.z * kFilteringFactor) + (self.previousAcceleration.z * (1.0 - kFilteringFactor));

    // è®¡ç®—åŠ é€Ÿåº¦å˜åŒ–ç‡
    double deltaX = fabs(filteredAcceleration.x - self.previousAcceleration.x);
    double deltaY = fabs(filteredAcceleration.y - self.previousAcceleration.y);
    double deltaZ = fabs(filteredAcceleration.z - self.previousAcceleration.z);

    // æ›´æ–°ä¸Šä¸€æ¬¡åŠ é€Ÿåº¦
    self.previousAcceleration = filteredAcceleration;

    // åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†æ‘‡æ™ƒ
    double threshold = self.accelerateThreshold;
    if (deltaX > threshold || deltaY > threshold || deltaZ > threshold) {
        // æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ
        CFAbsoluteTime afterTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘åçš„æ—¶é—´
        CFTimeInterval timeDifference = afterTime - self.beforeTime; // è®¡ç®—æ—¶é—´å·® å•ä½ç§’ s
        CFTimeInterval intervalSenonds = self.accelerateDetectedInterval;
        if (timeDifference >= intervalSenonds) { //æ§åˆ¶æ£€æµ‹å‰åé—´éš”
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,è·ç¦»ä¸Šæ¬¡æ£€æµ‹: 1f seconds", timeDifference);
            self.beforeTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘å‰çš„æ—¶é—´
            if (self.didAcceleratorDectecdBlock) {
                self.didAcceleratorDectecdBlock();
            }
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨,{2f,2f,2f}",deltaX, deltaY, deltaZ);
        } else {
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,é—´éš”ä¸æ»¡è¶³ 1f seconds,å¿½ç•¥æœ¬æ¬¡æ£€æµ‹!",intervalSenonds);
        }
    }
}

#pragma mark -
#pragma mark - public methods å…¬æœ‰æ–¹æ³•
- (void)startAccelerometer
{
    [self startAccelerometerUpdates];
}

- (void)stopAccelerometer
{
    [self stopAccelerometerUpdates];
}

#pragma mark -
#pragma mark - UIAccelerometerDelegate
#pragma mark- shake change song
CGFloat KWCMMgrRadiansToDegrees(CGFloat radians) {return radians * 180/M_PI;}
#pragma clang diagnostic push
#pragma clang diagnostic ignored "-Wdeprecated-declarations"
#pragma clang diagnostic ignored "-Wdeprecated-implementations"
-(void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration{
    static double shakeDate = 0.0f;
    self.accelerationX = acceleration.x * kFilteringFactor + self.accelerationX * (1.0 - kFilteringFactor);
    self.accelerationY = acceleration.y * kFilteringFactor + self.accelerationY * (1.0 - kFilteringFactor);
    if (fabs(acceleration.x) >= self.self.accelerateThreshold||
        fabs(acceleration.y) >= self.accelerateThreshold ) {
        if ([NSDate timeIntervalSinceReferenceDate] - shakeDate > self.accelerateDetectedInterval) {
            self.accelerationX = acceleration.x * kFilteringFactor + self.accelerationX * (1.0 - kFilteringFactor);
            self.accelerationY = acceleration.y * kFilteringFactor + self.accelerationY * (1.0 - kFilteringFactor);
            self.currentRawReading =atan2(self.accelerationY, self.accelerationX);
            float rotation = -KWCMMgrRadiansToDegrees(self.currentRawReading);
            if (fabsf(rotation) > 70.0 ) {
                if (self.didAcceleratorDectecdBlock) {
                    self.didAcceleratorDectecdBlock();
                }
                shakeDate = [NSDate timeIntervalSinceReferenceDate];
            }
        }
    }
}

#pragma mark -
#pragma mark - life cycle è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸ
- (void)dealloc
{
    if (self.cmMotionOperationQueue) {
        [self.cmMotionOperationQueue cancelAllOperations];
        self.cmMotionOperationQueue = nil;
    }
}

@end

```

ä»¥ä¸Šå°±æ˜¯ CMMotionManageræ–¹æ¡ˆçš„å®ç°ä»£ç .

## UIAccelerometer

è¿™ä¸ªç±»è¿œå¤æ—¶æœŸçš„æ–¹æ¡ˆ,ä»iOS2.0~iOS5.0çš„æ–¹å¼, ç°åœ¨éƒ½iOS17æ—¶ä»£äº†,æˆ‘è§‰å¾—å®ƒåº”è¯¥é¢†é€€ä¼‘é‡‘äº†,å¯æ˜¯å®ƒåšæŒä¾ç„¶åšå®ˆå²—ä½,ä¾ç„¶åœ¨å‘æŒ¥ä½œç”¨.

``` objc
UIKIT_EXTERN API_DEPRECATED("UIAcceleration has been replaced by the CoreMotion framework", ios(2.0, 5.0)) API_UNAVAILABLE(visionos) API_UNAVAILABLE(tvos) NS_SWIFT_UI_ACTOR
```

ä½¿ç”¨èµ·æ¥æ¯”è¾ƒç®€å•ç²—æš´.

``` objc
if (enableShake) {
	[[UIAccelerometer sharedAccelerometer] setDelegate:nil];
	[[UIAccelerometer sharedAccelerometer] setDelegate:self];
	[[UIAccelerometer sharedAccelerometer] setUpdateInterval:0.1];
} else {
	[[UIAccelerometer sharedAccelerometer] setDelegate:nil];
}
```

ç„¶åå®ç°ä»£ç†å.

``` objc
- (void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration
{
	 acceleration.x  ...
	 acceleration.y ...
	 acceleration.z ...
	 ...	 
	 åšå’Œä¹‹å‰CMMotionManagerå›è°ƒä¸­åŒæ ·é€»è¾‘checkå°±å¥½.
	 ...
}

```

è¿™ä¸ª`UIAcceleration`ç±»åœ¨iOS6ä¹‹å‰æ˜¯ä¸€ä¸ªclass

``` objc
@interface UIAcceleration : NSObject

@property(nonatomic,readonly) NSTimeInterval timestamp;
@property(nonatomic,readonly) UIAccelerationValue x;
@property(nonatomic,readonly) UIAccelerationValue y;
@property(nonatomic,readonly) UIAccelerationValue z;

@end
```

åœ¨åæ¥çš„ä¼ æ„Ÿå™¨æ•´åˆä¸­ å˜æˆäº†ç»“æ„ä½“,

å¦‚æœéè¦è¯´UIAccelerationæœ‰å•¥ä¼˜åŠ¿çš„è¯,è«è¿‡äºå®ƒä¸ç”¨åœ¨plistä¸­æ·»åŠ éšç§æè¿°å°±èƒ½æ‹¿åˆ°ç”¨æˆ·ä¼ æ„Ÿå™¨æ•°æ®,ä¸çŸ¥é“æœ‰æ²¡æœ‰å•¥é€‚é…é—®é¢˜å¦‚æœä¸åŠ éšç§æè¿°.

### 2024å¹´3æœˆ26æ—¥æ›´æ–°

å¢åŠ ä½é€šæ»¤æ³¢å™¨å¹³æ»‘ç®—æ³•,é˜²æ­¢æ‘‡æ™ƒå¯¼è‡´è¯¯è§¦.

``` objc

//ä½é€šæ»¤æ³¢å™¨æ¥å¹³æ»‘åŠ é€Ÿåº¦æ•°æ®ï¼Œå¹¶è®¡ç®—åŠ é€Ÿåº¦å˜åŒ–ç‡ã€‚é€šè¿‡è°ƒæ•´ kFilteringFactor å’Œé˜ˆå€¼æ¥é€‚åº”å…·ä½“éœ€æ±‚ï¼Œå¯ä»¥å‡å°‘è¯¯è§¦çš„å¯èƒ½æ€§
- (void)lpfDetectShake:(CMAcceleration)acceleration
{
    // åº”ç”¨ä½é€šæ»¤æ³¢å™¨
    CMAcceleration filteredAcceleration;
    filteredAcceleration.x = (acceleration.x * kFilteringFactor) + (self.previousAcceleration.x * (1.0 - kFilteringFactor));
    filteredAcceleration.y = (acceleration.y * kFilteringFactor) + (self.previousAcceleration.y * (1.0 - kFilteringFactor));
    filteredAcceleration.z = (acceleration.z * kFilteringFactor) + (self.previousAcceleration.z * (1.0 - kFilteringFactor));

    // è®¡ç®—åŠ é€Ÿåº¦å˜åŒ–ç‡
    double deltaX = fabs(filteredAcceleration.x - self.previousAcceleration.x);
    double deltaY = fabs(filteredAcceleration.y - self.previousAcceleration.y);
    double deltaZ = fabs(filteredAcceleration.z - self.previousAcceleration.z);

    // æ›´æ–°ä¸Šä¸€æ¬¡åŠ é€Ÿåº¦
    self.previousAcceleration = filteredAcceleration;

    // åˆ¤æ–­æ˜¯å¦å‘ç”Ÿäº†æ‘‡æ™ƒ
    double threshold = self.accelerateThreshold;
    if (deltaX > threshold || deltaY > threshold || deltaZ > threshold) {
        // æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ
        CFAbsoluteTime afterTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘åçš„æ—¶é—´
        CFTimeInterval timeDifference = afterTime - self.beforeTime; // è®¡ç®—æ—¶é—´å·® å•ä½ç§’ s
        CFTimeInterval intervalSenonds = self.accelerateDetectedInterval;
        if (timeDifference >= intervalSenonds) { //æ§åˆ¶æ£€æµ‹å‰åé—´éš”
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,è·ç¦»ä¸Šæ¬¡æ£€æµ‹: 1f seconds", timeDifference);
            self.beforeTime = CFAbsoluteTimeGetCurrent(); // è®°å½•æ‰§è¡Œæ‘‡æ™ƒæ£€æµ‹é€»è¾‘å‰çš„æ—¶é—´
            if (self.didAcceleratorDectecdBlock) {
                self.didAcceleratorDectecdBlock();
            }
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨,{2f,2f,2f}",deltaX, deltaY, deltaZ);
        } else {
            //NSLog(@"LFPç®—æ³•æ£€æµ‹åˆ°æ‘‡æ™ƒåŠ¨ä½œ,é—´éš”ä¸æ»¡è¶³ 1f seconds,å¿½ç•¥æœ¬æ¬¡æ£€æµ‹!",intervalSenonds);
        }
    }
}

```


# æ€»ç»“

ä»¥ä¸Šå°±æ˜¯å‡ ç§ä¸åŒæ–¹å¼æ£€æµ‹ç±»ä¼¼æ‘‡æ™ƒã€æ‘‡ä¸€æ‘‡åŠŸèƒ½çš„ä»£ç ,æŒ‰éœ€ç´¢å–,å¤æ‚ä¸€äº›å°±é€‰æ‹©CMMotionManager,å¦‚æœå°±ç®€å•æƒ³å®ç°æ‘‡ä¸€æ‘‡å°±é€‰æ‹©ç³»ç»Ÿçš„äº‹ä»¶å°±å¥½äº†, éå¸¸è§„æƒ…å†µä¸‹ä½¿ç”¨UIAcceleration.

å½“ç„¶å¤§å®¶ä¹Ÿå¯ä»¥æŠŠä¸‰ç§æ–¹æ¡ˆéƒ½å°è£…ä¸€ä¸‹å†…éƒ¨å¯ä»¥é€šè¿‡é€‰æ‹©æ¥æ§åˆ¶ä½¿ç”¨å“ªç§.

ä»¥ä¸Šå°±æ˜¯è¿åŠ¨ä¼ æ„Ÿå™¨çš„åŠ é€Ÿè®¡åœ¨åº”ç”¨ä¸­çš„å®ç°ä¼˜åŒ–,æ°´æ–‡è§ç¬‘è§ç¬‘.

[å‚è€ƒCMDeviceâ€‹Motion](https://nshipster.com/cmdevicemotion/)  
[Swift â€“ å¯¦ç¾æ–ä¸€æ–åŠŸèƒ½](https://badgameshow.com/steven/swift/https-badgameshow-com-steven-195/)  




URL: https://sunyazhou.com/2024/01/mpremotecommandlikecommand/index.html.md
Published At: 2024-01-25 05:03:00 +0000

# iOSæ§åˆ¶ä¸­å¿ƒæ”¶è—æŒ‰é’®likeCommandåŠ¨ç”»

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## èƒŒæ™¯æè¿°

æœ€è¿‘å¼€å‘ä¸­,äº§å“è¦æ±‚åœ¨éŸ³é¢‘æ’­æ”¾æ§åˆ¶ä¸­å¿ƒä¸­å¢åŠ  æ”¶è—æŒ‰é’®, æŸ¥çœ‹äº†QQéŸ³ä¹å’Œç½‘æ˜“äº‘éŸ³ä¹å‘ç°ä»–ä»¬éƒ½å·²ç»æœ‰äº†æ­¤æŒ‰é’®,ç„¶è€Œåœ¨é…·æˆ‘éŸ³ä¹çš„appåˆ‡åå°é”å±åè¿™ä¸ªæŒ‰é’®æ²¡æœ‰æ¼å‡º,æŸ¥äº†ä¸€ä¸‹ä»£ç å‘ç°æŒ‰é’®æ²¡æœ‰æ·»åŠ ,äºæ˜¯åŠ äº†æŒ‰é’®å‘ç°æ²¡æœ‰åŠ¨ç”»æ•ˆæœ.

å°±æ­¤é—®é¢˜æŸ¥äº†å…¨ç½‘æ²¡æœ‰ä¸€ä¸ªè¯´æ¸…æ¥šçš„,ç»è¿‡åå¤æµ‹è¯•å‘ç°,è‹¹æœç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–°çš„apiæˆ‘ä»¬æ²¡æœ‰æ³¨æ„.

å…ˆçœ‹çœ‹åšå®Œå•¥æ•ˆæœ,

![](/assets/images/20240125MPRemoteCommandLikecommand/MPRemoteCommand.gif)

è¿™é‡Œè¦ç”¨åˆ°çš„å…³é”®ä»£ç apiå¦‚ä¸‹:

``` objc
@interface MPFeedbackCommand : MPRemoteCommand

/// Whether the feedback command is in an "active" state. An example of when a
/// feedback command would be active is if the user already "liked" a particular
/// content item.
@property (nonatomic, assign, getter = isActive) BOOL active;   //å°±æ˜¯è¿™ä¸ª
...  
@end
```
ä¸‹é¢æ˜¯å®Œæ•´çš„æ·»åŠ æ­¤åŠŸèƒ½çš„ä»£ç .

``` objc
if (@available(iOS 17.1, *)) {
    MPRemoteCommandCenter *center = [MPRemoteCommandCenter sharedCommandCenter];
    [center.likeCommand setEnabled:YES];
    [center.likeCommand setLocalizedTitle:@"æ”¶è—"];
    [center.likeCommand setLocalizedShortTitle:@"æ”¶è—æ­¤æ­Œæ›²"];
    //TODO: check æ˜¯å¦ å·²æ”¶è—
    [center.likeCommand setActive:NO]; //å‡è®¾é»˜è®¤æ­¤æ­Œæ›²æ²¡æœ‰è¢«æ”¶è—çš„æ•ˆæœæ˜¯æ²¡æœ‰ ç”µé‡å–œæ¬¢
    [center.likeCommand addTargetWithHandler:^MPRemoteCommandHandlerStatus(MPRemoteCommandEvent * _Nonnull event) {
        // ... å¤„ç†æ”¶è—æ­Œæ›²é€»è¾‘çš„ä»£ç  æ­¤å¤„çœç•¥
        if (@available(iOS 17.1, *)) {
            MPFeedbackCommand *likeCommand = (MPFeedbackCommand *)event.command;
            if (likeCommand && likeCommand.isEnabled) {
                BOOL lastActive = likeCommand.isActive;
                [likeCommand setActive:!lastActive]; //TODO: æ­¤å¤„ä»£ç æ¨¡æ‹Ÿå·²æ”¶è—å’Œå–æ¶ˆæ”¶è—,è¿™é‡Œå¾—åˆ°ç»“æœå å†æ¬¡è®¾ç½®Activeå°†ä¼šå‡ºç°åŠ¨ç”»æ•ˆæœ
            }
        }
        return MPRemoteCommandHandlerStatusSuccess; //å¦‚æœç‚¹å‡»æ”¶è—æˆåŠŸå¯ä»¥è¿”å›è¿™ä¸ªçŠ¶æ€
    }];
}];
}
```

ä»¥ä¸Šæ˜¯å®ç° æ”¶è—åŠ¨æ•ˆçš„å…¨éƒ¨ä»£ç .

## è¸©å‘è®°å½•

è¿™é‡Œæ³¨æ„ä¸‹ `MPRemoteCommandCenter `ä¸­ æœ‰å¦‚ä¸‹ä»£ç 

``` objc
// Feedback Commands
// These are generalized to three distinct actions. Your application can provide
// additional context about these actions with the localizedTitle property in
// MPFeedbackCommand.
@property (nonatomic, readonly) MPFeedbackCommand *likeCommand;
@property (nonatomic, readonly) MPFeedbackCommand *dislikeCommand;
```

ä¸€å¼€å§‹æˆ‘å°è¯•ä½¿ç”¨disklikeCommandæŒ‰é’®,ç»“æœå‘ç°æ²¡æœ‰æ•ˆæœ, è‹¹æœè¿™ä¸ªæ“ä½œæˆ‘ä¹Ÿæ˜¯çœŸæ²¡çœ‹æ‡‚,å¦‚æœæƒ³è¦ä¸€ä¸ªæŒ‰é’®è§£å†³ä¸¤ç§çŠ¶æ€ é‚£ä¸ºä½•ä¸æä¾›è¿™ä¸ªæŒ‰é’®å¯ä»¥é€‰ä¸­çš„çŠ¶æ€,ä¸ºå•¥æä¸¤ä¸ªæŒ‰é’®è¿·æƒ‘å¼€å‘è€…,æ•´å¾—æˆ‘è¯»å®Œæ–‡æ¡£æˆ‘ä¹Ÿæ²¡æœ‰ç†è§£ä¸€ä¸ªæŒ‰é’®èƒ½å‡ºåŠ¨æ•ˆ,ä¸¤ä¸ªæŒ‰é’®å°±ä¸èƒ½å‡ºåŠ¨æ•ˆçš„æ–¹å¼. è¿™æ˜¯ä¸€ä¸ªå¯ä»¥è¢«åºŸå¼ƒçš„æŒ‰é’®,ç•™ç€æ„ä¹‰ä¸å¤§,å»ºè®®è‹¹æœå®˜æ–¹çœ‹åˆ°çš„è¯å»æ‰å§ï¼è‡³å°‘èƒ½è®©å¼€å‘è€…å°‘èµ°ä¸€äº›å¼¯è·¯

# æ€»ç»“

å¼€å‘ä¸­æ€»ä¼šå‡ºç°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„API,å–„äºç§¯ç´¯,å‹¤äºå®è·µ,è®°å½•è¿‡ç¨‹,è§£å†³é—®é¢˜,ä»¥ä¸Šå°±æ˜¯æœ¬ç« çš„å…¨éƒ¨å†…å®¹.


URL: https://sunyazhou.com/2024/01/arktsbasic/index.html.md
Published At: 2024-01-19 02:19:00 +0000

# ArkTSå’ŒArkUIåŸºç¡€è¯­æ³•

![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/harmonyOS.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

ä»¥ä¸‹å†…å®¹æ˜¯å­¦ä¹ è®°å½•

## DevEco Studioå¿«æ·é”®

| å¿«æ·é”® | ç”¨é€” | å¤‡æ³¨ |
| ------| ------ | ------ |
| âŒ˜(Command) + `B` |  è¿›å…¥åˆ°ç±»æˆ–è€…å¯¹è±¡çš„å®šä¹‰æ–‡ä»¶ä¸­ä¸­ | ç±»ä¼¼Xcodeä¸­çš„  âŒ˜(Command) + `â†’`|
| âŒ˜(Command) +  â‡§(Shift) + âŒ«(Back) |  ä¸ä¸Šé¢ç›¸å,è¿”å›ä¸Šä¸€çº§ | ç±»ä¼¼Xcodeä¸­çš„  âŒ˜(Command) + `â†`|
| | | |
| | | |

åœ¨çœ‹è¿‡å‡ éé¸¿è’™æ•™ç¨‹è§†é¢‘å’Œæ–‡æ¡£å,æˆ‘è§‰å¾—æŠŠå®¹æ˜“é—å¿˜çš„åŸºç¡€éƒ½è®°å½•ä¸‹æ¥,ä»¥å¤‡åç»­ä½¿ç”¨çš„æ—¶å€™éšæ—¶æŸ¥æ‰¾.

## ArkTSåŸºç¡€éƒ¨åˆ†

### é¡µé¢å’Œè‡ªå®šä¹‰ç»„ä»¶ç»„æˆç”Ÿå‘½å‘¨æœŸ

é¦–å…ˆæˆ‘ä»¬è¦äº†è§£ä¸€ä¸‹ä¸€ä¸ªç»„ä»¶æ˜¯ç»„æˆUIçš„åŸºæœ¬å•å…ƒ,æˆ‘ä»¬è¦æ˜ç¡®è‡ªå®šä¹‰ç»„ä»¶å’Œé¡µé¢çš„å…³ç³»

* è‡ªå®šä¹‰ç»„ä»¶ï¼š`@Component`è£…é¥°çš„UIå•å…ƒï¼Œå¯ä»¥ç»„åˆå¤šä¸ªç³»ç»Ÿç»„ä»¶å®ç°UIçš„å¤ç”¨ï¼Œå¯ä»¥è°ƒç”¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚
* é¡µé¢ï¼šå³åº”ç”¨çš„UIé¡µé¢ã€‚å¯ä»¥ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªè‡ªå®šä¹‰ç»„ä»¶ç»„æˆï¼Œ[@Entry](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-create-custom-components-0000001580025742-V2#ZH-CN_TOPIC_0000001711026924__%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BB%84%E4%BB%B6%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84)è£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ä¸ºé¡µé¢çš„å…¥å£ç»„ä»¶ï¼Œå³é¡µé¢çš„æ ¹èŠ‚ç‚¹ï¼Œä¸€ä¸ªé¡µé¢æœ‰ä¸”ä»…èƒ½æœ‰ä¸€ä¸ª@Entryã€‚åªæœ‰è¢«@Entryè£…é¥°çš„ç»„ä»¶æ‰å¯ä»¥è°ƒç”¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸã€‚

``` ts
@Entry
@Component
struct LiftCycle {
  build() {
   	... 
   }
}
```

* structï¼šè‡ªå®šä¹‰ç»„ä»¶åŸºäºstructå®ç°ï¼Œstruct + è‡ªå®šä¹‰ç»„ä»¶å + {...}çš„ç»„åˆæ„æˆè‡ªå®šä¹‰ç»„ä»¶ï¼Œä¸èƒ½æœ‰ç»§æ‰¿å…³ç³»ã€‚å¯¹äºstructçš„å®ä¾‹åŒ–ï¼Œå¯ä»¥çœç•¥new (__è‡ªå®šä¹‰ç»„ä»¶åã€ç±»åã€å‡½æ•°åä¸èƒ½å’Œç³»ç»Ÿç»„ä»¶åç›¸åŒã€‚__)
* @Componentï¼š@Componentè£…é¥°å™¨ä»…èƒ½è£…é¥°structå…³é”®å­—å£°æ˜çš„æ•°æ®ç»“æ„ã€‚structè¢«@Componentè£…é¥°åå…·å¤‡ç»„ä»¶åŒ–çš„èƒ½åŠ›ï¼Œéœ€è¦å®ç°buildæ–¹æ³•æè¿°UIï¼Œä¸€ä¸ªstructåªèƒ½è¢«ä¸€ä¸ª@Componentè£…é¥°ã€‚(__ä»API version 9å¼€å§‹ï¼Œè¯¥è£…é¥°å™¨æ”¯æŒåœ¨ArkTSå¡ç‰‡ä¸­ä½¿ç”¨ã€‚__)
* build()å‡½æ•°ï¼šbuild()å‡½æ•°ç”¨äºå®šä¹‰è‡ªå®šä¹‰ç»„ä»¶çš„å£°æ˜å¼UIæè¿°ï¼Œè‡ªå®šä¹‰ç»„ä»¶å¿…é¡»å®šä¹‰build()å‡½æ•°ã€‚
* @Entryï¼š@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶å°†ä½œä¸ºUIé¡µé¢çš„å…¥å£ã€‚åœ¨å•ä¸ªUIé¡µé¢ä¸­ï¼Œæœ€å¤šå¯ä»¥ä½¿ç”¨@Entryè£…é¥°ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ã€‚@Entryå¯ä»¥æ¥å—ä¸€ä¸ªå¯é€‰çš„LocalStorageçš„å‚æ•°ã€‚

> ä»API version 9å¼€å§‹ï¼Œè¯¥è£…é¥°å™¨æ”¯æŒåœ¨ArkTSå¡ç‰‡ä¸­ä½¿ç”¨ã€‚  
> ä»API version 10å¼€å§‹ï¼Œ@Entryå¯ä»¥æ¥å—ä¸€ä¸ªå¯é€‰çš„[LocalStorage](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-localstorage-0000001630265133-V2)çš„å‚æ•°æˆ–è€…ä¸€ä¸ªå¯é€‰çš„EntryOptionså‚æ•°ã€‚

#### EntryOptions10+ 
å‘½åè·¯ç”±è·³è½¬é€‰é¡¹

| åç§° | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
| ------| ------ | ------ | ------ |
| routeName | string | å¦ |  è¡¨ç¤ºä½œä¸ºå‘½åè·¯ç”±é¡µé¢çš„åå­—ã€‚ |
| storage | [LocalStorage](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-localstorage-0000001630265133-V2)  |  å¦  | é¡µé¢çº§çš„UIçŠ¶æ€å­˜å‚¨ã€‚ |

``` ts
@Entry({ routeName : 'myPage' })
@Component
struct MyComponent {

}
```

* @Reusableï¼š@Reusableè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶å…·å¤‡å¯å¤ç”¨èƒ½åŠ›

``` ts
@Reusable
@Component
struct MyComponent {
}
```
> ä»API version 10å¼€å§‹ï¼Œè¯¥è£…é¥°å™¨æ”¯æŒåœ¨ArkTSå¡ç‰‡ä¸­ä½¿ç”¨ã€‚

### é¡µé¢å’Œç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

è¢«ï¼Ÿ**@Entry**è£…é¥°çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸæ¥å£ï¼š  
* `onPageShow`ï¼šé¡µé¢æ¯æ¬¡æ˜¾ç¤ºæ—¶è§¦å‘ä¸€æ¬¡ï¼ŒåŒ…æ‹¬è·¯ç”±è¿‡ç¨‹ã€åº”ç”¨è¿›å…¥å‰å°ç­‰åœºæ™¯ï¼Œä»…@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ç”Ÿæ•ˆã€‚  
* `onPageHide`ï¼šé¡µé¢æ¯æ¬¡éšè—æ—¶è§¦å‘ä¸€æ¬¡ï¼ŒåŒ…æ‹¬è·¯ç”±è¿‡ç¨‹ã€åº”ç”¨è¿›å…¥åå°ç­‰åœºæ™¯ï¼Œä»…@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ç”Ÿæ•ˆã€‚  
* `onBackPress`ï¼šå½“ç”¨æˆ·ç‚¹å‡»è¿”å›æŒ‰é’®æ—¶è§¦å‘ï¼Œä»…@Entryè£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶ç”Ÿæ•ˆã€‚

//è¢«@Entryè£…é¥°çš„ç»„ä»¶ çš„ç”Ÿå‘½å‘¨æœŸ ä»£ç å¦‚ä¸‹æ¼”ç¤º

``` ts
//é¡µé¢æ¯æ¬¡æ˜¾ç¤ºçš„æ—¶å€™è¢«è§¦å‘
onPageShow(): void {
	console.log("LiftCycle onPageShow")
}

//é¡µé¢æ¯æ¬¡éšè—çš„æ—¶å€™è¢«è§¦å‘
onPageHide(): void {
	console.log("LiftCycle onPageHide")
}
//ç‚¹å‡»è¿”å›æŒ‰é’®æ—¶è§¦å‘
onBackPress(): boolean | void {
	console.log("LiftCycle onBackPress")
}
```

ç»„ä»¶ç”Ÿå‘½å‘¨æœŸï¼Œå³ä¸€èˆ¬ç”¨**@Component**è£…é¥°çš„è‡ªå®šä¹‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸæ¥å£ï¼š

* `aboutToAppear`ï¼šç»„ä»¶å³å°†å‡ºç°æ—¶å›è°ƒè¯¥æ¥å£ï¼Œå…·ä½“æ—¶æœºä¸ºåœ¨åˆ›å»ºè‡ªå®šä¹‰ç»„ä»¶çš„æ–°å®ä¾‹åï¼Œåœ¨æ‰§è¡Œå…¶build()å‡½æ•°ä¹‹å‰æ‰§è¡Œã€‚
* `aboutToDisappear`ï¼šaboutToDisappearå‡½æ•°åœ¨è‡ªå®šä¹‰ç»„ä»¶ææ„é”€æ¯ä¹‹å‰æ‰§è¡Œã€‚ä¸å…è®¸åœ¨aboutToDisappearå‡½æ•°ä¸­æ”¹å˜çŠ¶æ€å˜é‡ï¼Œç‰¹åˆ«æ˜¯@Linkå˜é‡çš„ä¿®æ”¹å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºè¡Œä¸ºä¸ç¨³å®š

``` ts
//è¢«@Componentä¿®é¥°çš„ è‡ªå®šä¹‰ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ
aboutToAppear(): void {
	console.log("LiftCycle aboutToAppear")
}
  
aboutToDisappear(): void {
	console.log("LiftCycle aboutToDisappear")
}
```

ç”Ÿå‘½å‘¨æœŸæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸‹å›¾å±•ç¤ºçš„æ˜¯è¢«**@Entryè£…é¥°çš„ç»„ä»¶ï¼ˆé¦–é¡µï¼‰ç”Ÿå‘½å‘¨æœŸã€‚  
![](/assets/images/20240119ArkTSBasic/EntryLifeCycle.webp)  
**ç”±æ­¤å¯çŸ¥, @Componentç»„ä»¶çš„å£°æ˜å‘¨æœŸæ–¹æ³• ä¸­é—´åŒ…å«äº†@Entryæ–¹æ³•å…¨éƒ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•è°ƒç”¨.**

ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº†ä¸€ä¸ªLifeCycleä¸­ æ·»åŠ ä¸€ä¸ªChildå­ç»„ä»¶,ç‚¹å‡»æŒ‰é’®pushåˆ°æ–°é¡µé¢LifeCycleDetail

``` ts
// LiftCycle.ets
import router from '@ohos.router';

@Entry
@Component
struct LiftCycle {
  @State showChild: boolean = true;
  @State btnColor:string = "#FF007DFF"

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear() {
    console.info('LiftCycle aboutToAppear');
  }

  // åªæœ‰è¢«@Entryè£…é¥°çš„ç»„ä»¶æ‰å¯ä»¥è°ƒç”¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ
  onPageShow() {
    console.info('LiftCycle onPageShow');
  }
  // åªæœ‰è¢«@Entryè£…é¥°çš„ç»„ä»¶æ‰å¯ä»¥è°ƒç”¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ
  onPageHide() {
    console.info('LiftCycle onPageHide');
  }

  // åªæœ‰è¢«@Entryè£…é¥°çš„ç»„ä»¶æ‰å¯ä»¥è°ƒç”¨é¡µé¢çš„ç”Ÿå‘½å‘¨æœŸ
  onBackPress() {
    console.info('LiftCycle onBackPress');
    this.btnColor ="#FFEE0606"
    return true // è¿”å›trueè¡¨ç¤ºé¡µé¢è‡ªå·±å¤„ç†è¿”å›é€»è¾‘ï¼Œä¸è¿›è¡Œé¡µé¢è·¯ç”±ï¼›è¿”å›falseè¡¨ç¤ºä½¿ç”¨é»˜è®¤çš„è·¯ç”±è¿”å›é€»è¾‘ï¼Œä¸è®¾ç½®è¿”å›å€¼æŒ‰ç…§falseå¤„ç†
  }

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  aboutToDisappear() {
    console.info('LiftCycle aboutToDisappear');
  }

  build() {
    Column() {
      // this.showChildä¸ºtrueï¼Œåˆ›å»ºChildå­ç»„ä»¶ï¼Œæ‰§è¡ŒChild aboutToAppear
      if (this.showChild) {
        Child()
      }
      // this.showChildä¸ºfalseï¼Œåˆ é™¤Childå­ç»„ä»¶ï¼Œæ‰§è¡ŒChild aboutToDisappear
      Button('delete Child')
        .margin(20)
        .backgroundColor(this.btnColor)
        .onClick(() => {
          this.showChild = false;
        })
      // pushåˆ°pageé¡µé¢ï¼Œæ‰§è¡ŒonPageHide
      Button('push to next page')
        .onClick(() => {
          router.pushUrl({ url: 'pages/LifeCycleDetail' });
        })
    }

  }
}

@Component
struct Child {
  @State title: string = 'SUNYAZHOU.COM';
  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  aboutToAppear() {
    console.info('Child aboutToAppear')
  }

  // ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
  aboutToDisappear() {
    console.info('Child aboutToDisappear')
  }

  build() {
    Text(this.title).fontSize(50).margin(20).onClick(() => {
      this.title = 'SUNYAZHOU.COM ArkUI';
    })
  }
}
```

LifeCycleDetailä»£ç å¦‚ä¸‹

``` ts
@Entry
@Component
struct LifeCycleDetail {
  @State textColor: Color = Color.Black;
  @State num: number = 0

  onPageShow() {
    this.num = 5
    console.log("LifeCycleDetail onPageShow");
  }

  onPageHide() {
    console.log("LifeCycleDetail onPageHide");
  }

  onBackPress() { // ä¸è®¾ç½®è¿”å›å€¼æŒ‰ç…§falseå¤„ç†
    this.textColor = Color.Grey
    this.num = 0
    console.log("LifeCycleDetail onBackPress");
  }

  aboutToAppear() {
    this.textColor = Color.Blue
  }

  build() {
    Column() {
      Text(`num çš„å€¼ä¸ºï¼š${this.num}`)
        .fontSize(30)
        .fontWeight(FontWeight.Bold)
        .fontColor(this.textColor)
        .margin(20)
        .onClick(() => {
          this.num += 5
        })
    }
    .width('100%')
  }
}
```
å½“æˆ‘ä»¬å¯åŠ¨é¢„è§ˆçš„æ—¶å€™å£°æ˜å‘¨æœŸå‡½æ•°å¦‚ä¸‹:

``` sh
app Log: LiftCycle aboutToAppear
app Log: Child aboutToAppear
app Log: LiftCycle onPageShow
```

å½“æˆ‘ä»¬ç‚¹å‡»Pushçš„æ—¶å€™

``` sh
app Log: LiftCycle onPageHide
app Log: LifeCycleDetail onPageShow
```

ç‚¹å‡»è¿”å›çš„æ—¶å€™

``` sh
LifeCycleDetail onBackPress
LifeCycleDetail onPageHide
LiftCycle onPageShow
```

åˆ é™¤ Childçš„æ—¶å€™

``` sh
app Log: Child aboutToDisappear
```

![](/assets/images/20240119ArkTSBasic/EntryLifeCycle.gif)

[é¡µé¢å’Œè‡ªå®šä¹‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ å®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-page-custom-components-lifecycle-0000001630265125-V2)


### åŸºç¡€ç±»å‹å’Œå‡½æ•°æ–¹æ³•

``` ts
let number1: number = 99 // é»˜è®¤æƒ…å†µä¸‹ æ­£å¸¸æƒ…å†µä¸‹ç»™çš„æ•°å­— å°±æ˜¯åè¿›åˆ¶çš„å“¦
let number2: number = 0b10011 // 2è¿›åˆ¶ ç”±0bå¼€å¤´çš„
let number3: number = 0o1234567 // 8è¿›åˆ¶ ç”±0oå¼€å¤´çš„
let number4: number = 0x6464ab // 16è¿›åˆ¶ ç”±æ—¥xå¼€å¤´çš„

// TODO å­—ç¬¦ä¸²
let string1: string = 'sunyazhou'
let string2: string = "sunyazhou"
let string3:string = "ä½ çš„åå­—æ˜¯: ${string2}"

// TODO è”åˆç±»å‹ã€ å¸ƒå°” çœŸture/å‡false
let objectType : string | number | boolean
objectType = true
objectType = "sunyazhou"
objectType = 635464
objectType = false

// TODO æ•°ç»„
let stringArray1: Array<string> = ['AAA','BBB','CCC']; //0ä¸‹æ ‡å¼€å§‹çš„
let stringArray2: string[] = ['AAA','BBB','CCC'];

// TODO æšä¸¾
enum Color {Red, Green, Yellow};
let color: Color = Color.Red;

// TODO å…ƒç»„ å’Œswiftä¸­çš„å…ƒç»„ä¸€æ ·,å¯ä»¥ç†è§£ä¸ºå¤šç±»å‹çš„å­—å…¸,keyéƒ½æ˜¯å­—ç¬¦ä¸² valueæ˜¯ä¸åŒçš„æ•°æ®ç±»å‹
let name1:[string, number];
name1 = [@"å­™å…ˆç”Ÿ", 20]; //å¿…é¡»æŒ‰ç…§è§„å®šé¡ºåºå’Œç±»å‹å†™å†…å®¹

// TODO void æ— è¿”å›ç±»å‹å‹
function name(params): void {}

// Null
let str1: null = null
// undefined
let str2: undefined = undefined
```

### ä½œç”¨åŸŸèŒƒå›´

``` ts
@Entry
@Component
struct LearnDetail {
  @State message: string = 'Hello World';
  
  // é‡Œé¢ä¸åŠ let,å¤–é¢çš„æˆå‘˜éœ€è¦åŠ let
  number1: number = 99
  
  build() {
    Row() {
      Column() {
        Text(this.message)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
      }
      .width('100%')
    }
    .height('100%')
  }
}
```

## ArkUIéƒ¨åˆ†

### å›¾ç‰‡æ§ä»¶

åŠ è½½ å¸¸è§„æœ¬åœ°èµ„æº

``` ts
Image($r(app.media.icon))
```  

åŠ è½½ ç½‘ç»œèµ„æº

``` ts
Image("https://www.sunyazhou.com/assets/images/20240116HarmonyPhoneSendFileTomacOS/harmonyOS.webp")
```
åŠ è½½ æœ¬åœ°ä»»ä½•èµ„æº

``` ts
Image($rawfile("sunyazhou.png"))
```

### è£…é¥°å™¨@Styles

@Stylesè£…é¥°å™¨å¯ä»¥å°†å¤šæ¡æ ·å¼è®¾ç½®æç‚¼æˆä¸€ä¸ªæ–¹æ³•ï¼Œç›´æ¥åœ¨ç»„ä»¶å£°æ˜çš„ä½ç½®è°ƒç”¨ã€‚é€šè¿‡@Stylesè£…é¥°å™¨å¯ä»¥å¿«é€Ÿå®šä¹‰å¹¶å¤ç”¨è‡ªå®šä¹‰æ ·å¼ã€‚ç”¨äºå¿«é€Ÿå®šä¹‰å¹¶å¤ç”¨è‡ªå®šä¹‰æ ·å¼.  

* å½“å‰@Stylesä»…æ”¯æŒé€šç”¨å±æ€§å’Œé€šç”¨äº‹ä»¶ã€‚
* @Stylesæ–¹æ³•ä¸æ”¯æŒå‚æ•°

> ä»API version 9å¼€å§‹ï¼Œè¯¥è£…é¥°å™¨æ”¯æŒåœ¨ArkTSå¡ç‰‡ä¸­ä½¿ç”¨ã€‚

ä½¿ç”¨å…¨å±€çš„@Styleså°è£…çš„æ ·å¼  

``` ts
@Styles function globalStyles() {
  .width(150)
  .height(300)
  .backgroundColor(Color.Pink)
}
```

å®šä¹‰åœ¨ç»„ä»¶å†…çš„@Styleså°è£…çš„æ ·å¼

``` ts
struct LearnDetail {
  @State heightValue: number = 100
  // å®šä¹‰åœ¨ç»„ä»¶å†…çš„@Styleså°è£…çš„æ ·å¼
  @Styles innerStyle() {
    .width(200)
    .height(this.heightValue)
    .backgroundColor(Color.Yellow)
    .onClick(() => {
      this.heightValue = 200
    })
  }

  build() {
    ...  
  }
}
```

å¦‚ä½•ä½¿ç”¨

``` ts
@Entry
@Component
struct LearnDetail {
  @State heightValue: number = 100
  // å®šä¹‰åœ¨ç»„ä»¶å†…çš„@Styleså°è£…çš„æ ·å¼
  @Styles innerStyle() {
    .width(200)
    .height(this.heightValue)
    .backgroundColor(Color.Yellow)
    .onClick(() => {
      this.heightValue = 200
    })
  }

  build() {
    Row() {
      Column() {
        // ä½¿ç”¨å…¨å±€çš„@Styleså°è£…çš„æ ·å¼
        Text('sunyazhou.com')
          .globalStyles ()
          .fontSize(30)
        // ä½¿ç”¨ç»„ä»¶å†…çš„@Styleså°è£…çš„æ ·å¼
        Text('è¿ˆè…¾å¤§é˜Ÿé•¿')
          .innerStyle()
          .fontSize(30)
      }
      .width('100%')
    }
    .height('100%')
  }
}

@Styles function globalStyles() {
  .width(150)
  .height(300)
  .backgroundColor(Color.Pink)
}
```

ä»¥ä¸Šæ˜¯æ˜¯å¦‚ä½•ä½¿ç”¨ @Stylesè£…é¥°å™¨çš„ä»£ç , [å‚è€ƒå®˜æ–¹@Stylesæ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-style-0000001630145729-V2)

### @Extendè£…é¥°å™¨: å®šä¹‰æ‰©å±•ç»„ä»¶æ ·å¼

è£…é¥°å™¨ä½¿ç”¨è¯­æ³•

``` ts
@Extend(UIComponentName) function functionName { ... }
```

* å’Œ@Stylesä¸åŒï¼Œ@Extendä»…æ”¯æŒåœ¨å…¨å±€å®šä¹‰ï¼Œä¸æ”¯æŒåœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ã€‚

* å’Œ@Stylesä¸åŒï¼Œ@Extendæ”¯æŒå°è£…æŒ‡å®šçš„ç»„ä»¶çš„ç§æœ‰å±æ€§å’Œç§æœ‰äº‹ä»¶ï¼Œä»¥åŠé¢„å®šä¹‰ç›¸åŒç»„ä»¶çš„@Extendçš„æ–¹æ³•ã€‚
* å’Œ@Stylesä¸åŒï¼Œ@Extendè£…é¥°çš„æ–¹æ³•æ”¯æŒå‚æ•°ï¼Œå¼€å‘è€…å¯ä»¥åœ¨è°ƒç”¨æ—¶ä¼ é€’å‚æ•°ï¼Œè°ƒç”¨éµå¾ªTSæ–¹æ³•ä¼ å€¼è°ƒç”¨ã€‚
* @Extendè£…é¥°çš„æ–¹æ³•çš„å‚æ•°å¯ä»¥ä¸ºfunctionï¼Œä½œä¸ºEventäº‹ä»¶çš„å¥æŸ„
* @Extendçš„å‚æ•°å¯ä»¥ä¸ºçŠ¶æ€å˜é‡ï¼Œå½“çŠ¶æ€å˜é‡æ”¹å˜æ—¶ï¼ŒUIå¯ä»¥æ­£å¸¸çš„è¢«åˆ·æ–°æ¸²æŸ“ã€‚
* @Extendå¯ä»¥åå˜è°ƒç”¨

å¦‚ä¸‹è°ƒç”¨åå˜è°ƒç”¨

``` ts
// @Extend(Text)å¯ä»¥æ”¯æŒTextçš„ç§æœ‰å±æ€§fontColor
@Extend(Text) function fancy () {
  .fontColor(Color.Red)
}
// superFancyTextå¯ä»¥è°ƒç”¨é¢„å®šä¹‰çš„fancy
@Extend(Text) function superFancyText(size:number) {
    .fontSize(size)
    .fancy() //è¿™é‡Œè°ƒç”¨çš„æ˜¯ä¸Šæ–¹å®šä¹‰çš„@extend
}
```

ä½¿ç”¨@Extendç¤ºä¾‹ä»£ç å¦‚ä¸‹:

``` ts
@Entry
@Component
struct LearnDetail {
  @State heightValue: number = 100

  build() {
    Row() {
      Column() {
        Text("sunyazhou.com").textExtend1(20, Color.Green)
        Text("è¿ˆè…¾å¤§é˜Ÿé•¿")
          .textExtend1(20, Color.Blue)
      }
      .width('100%')
    }
    .height('100%')
  }
}

@Extend(Text) function textStyles1() {
  .textAlign(TextAlign.Center)
  .fontStyle(FontStyle.Italic)
  .decoration({
    type: TextDecorationType.Underline
  })
}

@Extend(Text) function textExtend1(fontSize: number, fontColor: Color) {
  .fontSize(fontSize)
  .fontColor(fontColor)
  .textStyles1()
}

```

![](/assets/images/20240119ArkTSBasic/extend_example.webp)

[å‚è€ƒ@Extendå®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-extend-0000001580345074-V2)

### @Propè£…é¥°å™¨:çˆ¶å­å•å‘åŒæ­¥

åˆå§‹åŒ–è§„åˆ™å›¾ç¤º  
![](/assets/images/20240119ArkTSBasic/rules.webp)

ä¸‹é¢æ˜¯å•å‘ä¼ é€’ç¤ºä¾‹ä»£ç 

* Propä¸èƒ½èµ‹å€¼

``` ts
@Entry
@Component
struct LearnDetail {
  @State msg: string = "sunyazhou.com"
  build() {
    Row() {
      Column() {
        Text(this.msg).textExtend1(30, Color.Green)
        Button("ç‚¹å‡»ä¿®æ”¹ä¼ é€åˆ°å­ç»„ä»¶",{type: ButtonType.Normal})
          .borderRadius(8)
          .backgroundColor(0x317aff)
          .width(180)
          .height(40)
          .onClick(()=>{
              console.log('ç‚¹å‡»ä¿®æ”¹ä¼ é€åˆ°å­ç»„ä»¶')
              this.msg = this.msg === "sunyazhou.com" ? "è¿ˆè…¾å¤§é˜Ÿé•¿" : "sunyazhou.com"
          })
        LearnDetailProp1({name :this.msg})
      }
      .width('100%')
    }
    .height('100%')
  }
}

// @propè£…é¥°çŠ¶æ€æ•°æ®ï¼Œæ–¹ä¾¿çˆ¶ä¸å­ç»„ä»¶ä¹‹é—®è¿›è¡Œæ•°æ®ä¼ é€’ä¸åŒæ­¥ çˆ¶State--------->prop å•å‘
@Component
struct LearnDetailProp1 {
  @Prop name: string //Propä¸èƒ½èµ‹å€¼
  build() {
    Column() {
      Text("www." + this.name).textStyles1()
      Button("å•å‘ä¼ é€’").buttonStyle1(ButtonType.Normal)
        .onClick(()=>{
          this.name = "Propä¿®é¥°å™¨ä¿®æ”¹å†…å®¹"
        })
    }
  }
}

@Extend(Button) function buttonStyle1 (type :ButtonType) {
  .type(type)
  .borderRadius(8)
  .backgroundColor(0x317aff)
  .width(90)
  .height(40)
}

@Extend(Text) function textStyles1() {
  .textAlign(TextAlign.Center)
  .fontStyle(FontStyle.Italic)
  .decoration({
    type: TextDecorationType.Underline
  })
}

@Extend(Text) function textExtend1(fontSize: number, fontColor: Color) {
  .fontSize(fontSize)
  .fontColor(fontColor)
  .textStyles1()
}
```

![](/assets/images/20240119ArkTSBasic/prop.gif)

[@Propå‚è€ƒæ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-prop-0000001580185150-V2)

### @Linkè£…é¥°å™¨:çˆ¶å­åŒå‘åŒæ­¥

ç¤ºä¾‹ä»£ç å¦‚æœ

``` ts
// @Linkè£…é¥°çŠ¶æ€æ•°æ®ï¼Œæ–¹ä¾¿çˆ¶ä¸å­ç»„ä»¶ä¹‹é—®è¿›è¡Œæ•°æ®ä¼ é€’ä¸åŒæ­¥ çˆ¶State <--------->prop åŒå‘ä¼ é€’
@Component
struct  LearnDetailLink1 {
  @Link lineName: string //@Linkä¸èƒ½èµ‹å€¼
  build() {
    Column() {
      Text("Linkæ•°æ®:" + this.lineName).textStyles1()
      Button("åŒå‘ä¼ é€’").buttonStyle1(ButtonType.Normal)
        .onClick(()=> {
            this.lineName = "è¢«ä¿®æ”¹çš„ Linkæ•°æ®"
        })
    }
  }
}
```

æ•ˆæœå±•ç¤º

![](/assets/images/20240119ArkTSBasic/link.gif)

åŸºäºä¸Šè¿°@Propä»£ç å®Œæ•´å±•ç¤º

``` ts
@Entry
@Component
struct LearnDetail {
  @State msg: string = "sunyazhou.com"
  build() {
    Row() {
      Column() {
        Text(this.msg).textExtend1(30, Color.Green)
        Button("ç‚¹å‡»ä¿®æ”¹ä¼ é€åˆ°å­ç»„ä»¶",{type: ButtonType.Normal})
          .borderRadius(8)
          .backgroundColor(0x317aff)
          .width(180)
          .height(40)
          .onClick(()=>{
              console.log('ç‚¹å‡»ä¿®æ”¹ä¼ é€åˆ°å­ç»„ä»¶')
              this.msg = this.msg === "sunyazhou.com" ? "è¿ˆè…¾å¤§é˜Ÿé•¿" : "sunyazhou.com"
          })
        Divider()
        LearnDetailProp1({name :this.msg})
        Divider()
        LearnDetailLink1({lineName :this.msg})
      }
      .width('100%')
    }
    .height('100%')
  }
}

@Component
struct LearnDetailProp1 {
  @Prop name: string //Propä¸èƒ½èµ‹å€¼
  build() {
    Column() {
      Text("www." + this.name).textStyles1()
      Button("å•å‘ä¼ é€’").buttonStyle1(ButtonType.Normal)
        .onClick(()=>{
          this.name = "Propä¿®é¥°å™¨ä¿®æ”¹å†…å®¹"
        })
    }
  }
}
// @Linkè£…é¥°çŠ¶æ€æ•°æ®ï¼Œæ–¹ä¾¿çˆ¶ä¸å­ç»„ä»¶ä¹‹é—®è¿›è¡Œæ•°æ®ä¼ é€’ä¸åŒæ­¥ çˆ¶State <--------->prop åŒå‘ä¼ é€’
@Component
struct  LearnDetailLink1 {
  @Link lineName: string //@Linkä¸èƒ½èµ‹å€¼
  build() {
    Column() {
      Text("Linkæ•°æ®:" + this.lineName).textStyles1()
      Button("åŒå‘ä¼ é€’").buttonStyle1(ButtonType.Normal)
        .onClick(()=> {
            this.lineName = "è¢«ä¿®æ”¹çš„ Linkæ•°æ®"
        })
    }
  }
}

@Extend(Button) function buttonStyle1 (type :ButtonType) {
  .type(type)
  .borderRadius(8)
  .backgroundColor(0x317aff)
  .width(90)
  .height(40)
}

@Extend(Text) function textStyles1() {
  .textAlign(TextAlign.Center)
  .fontStyle(FontStyle.Italic)
  .decoration({
    type: TextDecorationType.Underline
  })
}

@Extend(Text) function textExtend1(fontSize: number, fontColor: Color) {
  .fontSize(fontSize)
  .fontColor(fontColor)
  .textStyles1()
}
```

[@Linkå‚è€ƒæ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-link-0000001630145733-V2)

## @Provideè£…é¥°å™¨å’Œ@Consumeè£…é¥°å™¨:ä¸åä»£ç»„ä»¶åŒå‘åŒæ­¥

@Provideå’Œ@Consumeï¼Œåº”ç”¨äºä¸åä»£ç»„ä»¶çš„åŒå‘æ•°æ®åŒæ­¥ï¼Œåº”ç”¨äºçŠ¶æ€æ•°æ®åœ¨å¤šä¸ªå±‚çº§ä¹‹é—´ä¼ é€’çš„åœºæ™¯ã€‚ä¸åŒäºä¸Šæ–‡æåˆ°çš„çˆ¶å­ç»„ä»¶ä¹‹é—´é€šè¿‡å‘½åå‚æ•°æœºåˆ¶ä¼ é€’ï¼Œ@Provideå’Œ@Consumeæ‘†è„±å‚æ•°ä¼ é€’æœºåˆ¶çš„æŸç¼šï¼Œå®ç°è·¨å±‚çº§ä¼ é€’ã€‚

å…¶ä¸­@Provideè£…é¥°çš„å˜é‡æ˜¯åœ¨ç¥–å…ˆç»„ä»¶ä¸­ï¼Œå¯ä»¥ç†è§£ä¸ºè¢«â€œæä¾›â€ç»™åä»£çš„çŠ¶æ€å˜é‡ã€‚@Consumeè£…é¥°çš„å˜é‡æ˜¯åœ¨åä»£ç»„ä»¶ä¸­ï¼Œå»â€œæ¶ˆè´¹ï¼ˆç»‘å®šï¼‰â€ç¥–å…ˆç»„ä»¶æä¾›çš„å˜é‡ã€‚

#### @Provide/@Consumeè£…é¥°çš„çŠ¶æ€å˜é‡æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

* @Provideè£…é¥°çš„çŠ¶æ€å˜é‡è‡ªåŠ¨å¯¹å…¶æ‰€æœ‰åä»£ç»„ä»¶å¯ç”¨ï¼Œå³è¯¥å˜é‡è¢«â€œprovideâ€ç»™ä»–çš„åä»£ç»„ä»¶ã€‚ç”±æ­¤å¯è§ï¼Œ@Provideçš„æ–¹ä¾¿ä¹‹å¤„åœ¨äºï¼Œå¼€å‘è€…ä¸éœ€è¦å¤šæ¬¡åœ¨ç»„ä»¶ä¹‹é—´ä¼ é€’å˜é‡ã€‚

* åä»£é€šè¿‡ä½¿ç”¨@Consumeå»è·å–@Provideæä¾›çš„å˜é‡ï¼Œå»ºç«‹åœ¨@Provideå’Œ@Consumeä¹‹é—´çš„åŒå‘æ•°æ®åŒæ­¥ï¼Œä¸@State/@Linkä¸åŒçš„æ˜¯ï¼Œå‰è€…å¯ä»¥åœ¨å¤šå±‚çº§çš„çˆ¶å­ç»„ä»¶ä¹‹é—´ä¼ é€’ã€‚

* @Provideå’Œ@Consumeå¯ä»¥é€šè¿‡ç›¸åŒçš„å˜é‡åæˆ–è€…ç›¸åŒçš„å˜é‡åˆ«åç»‘å®šï¼Œå»ºè®®ç±»å‹ç›¸åŒï¼Œå¦åˆ™ä¼šå‘ç”Ÿç±»å‹éšå¼è½¬æ¢ï¼Œä»è€Œå¯¼è‡´åº”ç”¨è¡Œä¸ºå¼‚å¸¸ã€‚

``` ts
// é€šè¿‡ç›¸åŒçš„å˜é‡åç»‘å®š
@Provide a: number = 0;
@Consume a: number;

// é€šè¿‡ç›¸åŒçš„å˜é‡åˆ«åç»‘å®š
@Provide('a') b: number = 0;
@Consume('a') c: number;
```

æ˜¾ç„¶è¿™ä¿®é¥°å™¨æ˜¯ç»Ÿä¸€æ ‡è¯† ç±»å‹ä¸€ç›´ æ ¹æ®æ–‡æ¡£è¯´æ˜å¦‚ä¸‹

| @Provideå˜é‡è£…é¥°å™¨ | 	è¯´æ˜  |
| ------| ------ |
| è£…é¥°å™¨å‚æ•° | åˆ«åï¼šå¸¸é‡å­—ç¬¦ä¸²ï¼Œå¯é€‰ã€‚å¦‚æœæŒ‡å®šäº†åˆ«åï¼Œåˆ™é€šè¿‡åˆ«åæ¥ç»‘å®šå˜é‡ï¼›å¦‚æœæœªæŒ‡å®šåˆ«åï¼Œåˆ™é€šè¿‡å˜é‡åç»‘å®šå˜é‡ã€‚ |
| åŒæ­¥ç±»å‹ | åŒå‘åŒæ­¥ã€‚ä»@Provideå˜é‡åˆ°æ‰€æœ‰@Consumeå˜é‡ä»¥åŠç›¸åçš„æ–¹å‘çš„æ•°æ®åŒæ­¥ã€‚åŒå‘åŒæ­¥çš„æ“ä½œä¸@Stateå’Œ@Linkçš„ç»„åˆç›¸åŒã€‚ |

... æ›´å¤šå†…å®¹è¯·å‚ç…§å®˜æ–¹æ–‡æ¡£[å®˜ç½‘æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-provide-and-consume-0000001580345078-V2)


``` ts
@Entry
@Component
struct ProvideConsumeDemo {
  @Provide("com.sunyazhou.message.provide_consume") message: string = "sunyazhou.com"
  build() {
    Row() {
      Column() {
        Text(this.message).textExtend2(30, Color.Black)
          .onClick( ()=> {
            this.message = this.message === "è¿ˆè…¾å¤§é˜Ÿé•¿"? "sunyazhou.com": "è¿ˆè…¾å¤§é˜Ÿé•¿"
          })
        Divider()
        //... å‡è®¾è¿™é‡Œä¸­é—´æœ‰ 100å±‚Componentåˆ›å»ºå’Œä½¿ç”¨
        ProvideConsumeDemo2()
      }
      .width('100%')
    }
    .height('100%')
  }
}

@Component
struct  ProvideConsumeDemo2 {
  @Consume("com.sunyazhou.message.provide_consume") info: string //å’Œä¹‹å‰ä»‹ç»çš„@Prop @Linkä¸€æ · consumeä¸èƒ½èµ‹å€¼
  build() {
    Column() {
      Text(this.info).textExtend2(45, Color.Green)
    }
  }
}

@Extend(Button) function buttonStyle2 (type :ButtonType) {
  .type(type)
  .borderRadius(8)
  .backgroundColor(0x317aff)
  .width(90)
  .height(40)
}

@Extend(Text) function textStyles2() {
  .textAlign(TextAlign.Center)
  .fontStyle(FontStyle.Italic)
  .decoration({
    type: TextDecorationType.Underline
  })
}

@Extend(Text) function textExtend2(fontSize: number, fontColor: Color) {
  .fontSize(fontSize)
  .fontColor(fontColor)
  .textStyles2()

```

æ•ˆæœå¦‚ä¸‹:

![](/assets/images/20240119ArkTSBasic/provideconsume.gif)

[@Provideè£…é¥°å™¨å’Œ@Consumeè£…é¥°å™¨å®˜ç½‘æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-provide-and-consume-0000001580345078-V2)

## @Watchä¿®é¥°å™¨ ç”¨äºç›‘å¬çŠ¶æ€å˜é‡æ›´æ”¹é€šçŸ¥

@Watchåº”ç”¨äºå¯¹çŠ¶æ€å˜é‡çš„ç›‘å¬ã€‚å¦‚æœå¼€å‘è€…éœ€è¦å…³æ³¨æŸä¸ªçŠ¶æ€å˜é‡çš„å€¼æ˜¯å¦æ”¹å˜ï¼Œå¯ä»¥ä½¿ç”¨@Watchä¸ºçŠ¶æ€å˜é‡è®¾ç½®å›è°ƒå‡½æ•°ã€‚


``` ts
@State @Watch("didMessageChanged") num1: number = 10;
didMessageChanged () {  //æ­¤æ–¹æ³•è¢«è§¦å‘,ä»£è¡¨å…¶å®ƒåœ°æ–¹ä¿®æ”¹äº† @Watch ä¿®é¥°çš„å˜é‡
	console.log("ç›‘å¬åˆ°æ¶ˆæ¯å‘ç”Ÿå˜åŒ–:" + this.num1)
}
```
![](/assets/images/20240119ArkTSBasic/watch.gif)

å®Œæ•´ç¤ºä¾‹ä»£ç 

``` ts
@Entry
@Component
struct WatchDemo {
  @State @Watch("didMessageChanged") price: number = 0;
  didMessageChanged () {  //æ­¤æ–¹æ³•è¢«è§¦å‘,ä»£è¡¨å…¶å®ƒåœ°æ–¹ä¿®æ”¹äº† @Watch ä¿®é¥°çš„å˜é‡
    if (this.price >= 10) {
      //TODO: å¤„ç†äº«å—9æŠ˜...
      console.log("ç›‘å¬åˆ°æ¶ˆæ¯å‘ç”Ÿå˜åŒ–:" + this.price * 0.9)
    } else {
      console.log("ç›‘å¬åˆ°æ¶ˆæ¯å‘ç”Ÿå˜åŒ–:" + this.price)
    }

  }

  build() {
    Row() {
      Column() {
        Text("æµ‹è¯•å€¼" + this.price)
          .fontSize(50)
          .fontWeight(FontWeight.Bold)
          .onClick( ()=> {
            this.price ++
          })
      }
      .width('100%')
    }
    .height('100%')
  }
}
```

[@Watchè£…é¥°å™¨å®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/arkts-watch-0000001630305681-V2)

## ForEach:å¾ªç¯æ¸²æŸ“

å‡è®¾æˆ‘ä»¬è¦åšä¸€ä¸ªåƒiOSä¸­çš„UITableViewåˆ—è¡¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ArkUIä¸­çš„`ForEach`


``` ts
@Entry
@Component
struct ForEachDemo {
  @State message: string = 'sunyazhou.com';
  @State tags: Array<string> = ['Algorithm29','ArkTS1','AVFoundation15','AVKit1','C++19','Cocoapods5','Dart2','Git3','HarmonyOS3','iOS119','...']

  build() {
    Row() {
      Column() {
        Text(this.message)
          .fontSize(38)
          .fontWeight(FontWeight.Bold)
        Divider()
        ForEach(this.tags, (tag : string) => {
            Text("Blog tag has "+ tag)
              .textAlign(TextAlign.Start)
              .fontSize(18)
              .width('80%')
              .backgroundColor('#00E5EE')
        }, (tag: string)=>{
          return tag
        })
      }
      .width('100%')
    }
    .height('100%')
  }
}
```

![](/assets/images/20240119ArkTSBasic/ForEach.webp)

è¿™é‡Œæœ‰ä¸ªå‘, __ForEach(this.tags, (tag : string*è¿™é‡Œå¿…é¡»æ ‡æ³¨ç±»å‹åœ¨Harmonry4.1ä¸­*) => {}__

å¦‚æœä¸æ ‡æ³¨ç±»å‹å°±å®¹æ˜“æŠ¥é”™

``` sh
Use explicit types instead of "any", "unknown" (arkts-no-any-unknown) <ArkTSCheck>
```
![](/assets/images/20240119ArkTSBasic/ForEachError.webp)  


[ForEach:å¾ªç¯æ¸²æŸ“](å®˜æ–¹æ–‡æ¡£)

## ç»„ä»¶é€šç”¨ç‰¹æ€§-ç‚¹å‡»äº‹ä»¶

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»äº‹ä»¶å¯¹è±¡æ‹¿åˆ°ç›¸åº”çš„ä½ç½®ä¿¡æ¯.

``` ts
@Entry
@Component
struct UniversalEventDemo {
  @State message: string = 'https://www.sunyazhou.com/';
  //TODO æ‰€æœ‰çš„ ç»„ä»¶ çš„ é€šç”¨ç‰¹æ€§ä¹‹ äº‹ä»¶ç³»
  build() {
    Column(){
      Row() {
        Button('æŒ‰é’®1', {type: ButtonType.Normal}).width('100').height('66')
          .onClick((event: ClickEvent) => {
            this.message =
              `å±å¹•X:${event.windowX} \nå±å¹•Y:${event.windowY} \næŒ‰é’®X:${event.x} \næŒ‰é’®Y:${event.y} \nå®½åº¦:${event.target.area.width} \né«˜åº¦:${event.target.area.height}`
          })
      }
      Text(this.message).margin(20).fontSize(12)
    }.height('100%').alignItems(HorizontalAlign.Start).padding({top: 33, left: 50})
  }
}
```

`ClickEvent `ç±»å¯ä»¥æ‹¿åˆ°å¦‚ä¸‹å„ç§å˜é‡

![](/assets/images/20240119ArkTSBasic/ClickEvent.webp)  

## ç»„ä»¶é€šç”¨ç‰¹æ€§-è§¦æ‘¸äº‹ä»¶

``` ts
@Entry
@Component
struct UniversalEventDemo {
  @State message: string = 'https://www.sunyazhou.com/';
  @State eventType :string = ''
  build() {
    Column(){
      Row() {
        Button('æŒ‰é’®1', {type: ButtonType.Normal}).width('100').height('66')
          .onTouch((event: TouchEvent)=> {
            if (event.type == TouchType.Down) {
              this.eventType = 'æŒ‰ä¸‹-Down'
            }
            if (event.type == TouchType.Up) {
              this.eventType = 'æŠ¬èµ·-Up'
            }
            if (event.type == TouchType.Move) {
              this.eventType = 'è§¦æ‘¸ä¸­-Move'
            }
            this.message = 'è§¦æ‘¸ç±»å‹:'+ this.eventType + '\n' +
              'x:' + event.touches[0].x + '\n' +
              'y:' + event.touches[0].y + '\n' +
              'å®½åº¦:' + event.target.area.width + '\n'
              'é«˜åº¦:' + event.target.area.height + '\n'
          })
      }
      Text(this.message).margin(20).fontSize(12)
    }.height('100%').alignItems(HorizontalAlign.Start).padding({top: 33, left: 50})
  }
}
```

![](/assets/images/20240119ArkTSBasic/TouchEvent.gif)  

## ç»„ä»¶é€šç”¨çš„å°ºå¯¸æ’ç‰ˆå­¦ä¹ 

``` ts
@Entry
@Component
struct LayoutDemo {
  build() {
    Column() {
      Text('ç»„ä»¶é€šç”¨çš„å°ºå¯¸æ’ç‰ˆå­¦ä¹ ')
      Divider()
      Row() {
        Text('https://www.sunyazhou.com/').fontSize(20).fontColor(Color.Green).width('90%')
          .textAlign(TextAlign.Center)
      }
      .backgroundColor("#00F5FF")
      Row(){
        Text('å·¦ä¾§').fontSize(20).backgroundColor(Color.Yellow).height(100)
        Row() {
          Row() {
            Text('æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. ' +
              'æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨,' +
              'è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ.' +
              ' å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,' +
              'è¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯.')
              .fontSize(15)
              .fontColor(Color.Pink)
              .width('90%')
          }
        }
        .width(200)
        .height(200)
        .backgroundColor(Color.Gray)
        .padding(20) //å¤–è¾¹è·
        .margin({top: 28, bottom: 28, left:20, right:20}) //å†…è¾¹è·
        .border({width: 10, color: Color.Blue}) //å†…éƒ¨è¾¹æ¡†

        Text('å³ä¾§').fontSize(22).backgroundColor(Color.Red).backgroundColor(Color.Green)
      }
      Row() {
        Text('Â© 2024 sunyazhou. ä¿ç•™éƒ¨åˆ†æƒåˆ©').fontSize(20).fontColor(Color.White).width('90%')
          .textAlign(TextAlign.Center)
      }
      .backgroundColor(Color.Orange)
    }
    .backgroundColor(Color.Transparent)
  }
}
```

![](/assets/images/20240119ArkTSBasic/LayoutStudy1.webp) 

`position`å’Œ`markAnchor`,ä»¥åŠ`offset`çš„ä½¿ç”¨å¦‚ä¸‹.

``` ts
@Entry
@Component
struct LayoutDemo2 {
  build() {
    Column({space:8}) { //
      Row() {
        Text('A').fontSize(24).fontColor(Color.Blue).width('25%').backgroundColor(Color.Red)
        Text('B').fontSize(24).fontColor(Color.Blue).width('25%').backgroundColor(Color.Black)
        Text('C').fontSize(24).fontColor(Color.Blue).width('25%').backgroundColor(Color.Yellow)
        Text('D').fontSize(24).fontColor(Color.Blue).width('25%').backgroundColor(Color.Grey)
      }
      .backgroundColor(Color.Green)
      .width('100%')
      .height(100)
      .direction(Direction.Rtl)

      Divider()
      Column({space: 8}) {
        Row() {
          Text('A').fontSize(24).fontColor(Color.Orange).width('25%').backgroundColor(Color.Red)
          Text('B').fontSize(24).fontColor(Color.Orange).width('25%').backgroundColor(Color.Black)
            .position({x: 66, y: 10})  //è¿™ç§æŒ‡å®šx y é€‚é…æ€§è¾ƒå·®
          Text('C').fontSize(24).fontColor(Color.Orange).width('25%').backgroundColor(Color.Yellow)
          Text('D').fontSize(24).fontColor(Color.Orange).width('25%').backgroundColor(Color.Grey)
            .position({x: '70%',y: '70%'}) //æ¨èæ–¹å¼é€‚é…æ€§æ¯”è¾ƒå¥½
        }
        .backgroundColor(Color.Green)
        .width('90%')
        .height(100)
        .direction(Direction.Ltr)
      }
      Divider()
      //å½“å‰ mark  é»˜è®¤: .markAnchor({x: 0, y: 0})
      Column({ space: 8}) {
        Stack() {
          Row().width(111).height(111).backgroundColor(Color.Grey)
        }
        Text("100").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Red)
          .markAnchor({x: 88, y: 100}) //è‡ªå·±å½“å‰å€¼ + x 80, y 100.
        Text("200").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Green)
          .markAnchor({x: 88, y: 100}) //è‡ªå·±å½“å‰å€¼ + x 80, y 100.
        Text("300").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Blue)
          .markAnchor({x: -88, y: 160})
        Text("400").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Red)
          .markAnchor({x: -88, y: 160})
      }
    }
  }
}
```  

![](/assets/images/20240119ArkTSBasic/LayoutStudy2.webp) 

``` ts
//å½“å‰ offset
Column({ space: 8}) {
  Stack() {
    Row().width(111).height(111).backgroundColor(Color.Grey)
  }
  Text("100").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Red)
    .offset({x: '-22%', y: '-12%'}) //è‡ªå·±å½“å‰å€¼ + xå€¼%, yå€¼%.
  Text("200").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Green)
    .offset({x: '-22%', y: '-12%'}) //è‡ªå·±å½“å‰å€¼ + xå€¼%, yå€¼%.
  Text("300").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Blue)
    .offset({x: '22%', y: '-20%'}) //è‡ªå·±å½“å‰å€¼ + xå€¼%, yå€¼%.
  Text("400").fontSize(22).fontColor(Color.Black).width('25').height(25).backgroundColor(Color.Red)
    .offset({x: '22%', y: '-20%'}) //è‡ªå·±å½“å‰å€¼ + xå€¼%, yå€¼%.
}
```

![](/assets/images/20240119ArkTSBasic/LayoutStudy3.webp) 

### ç»„ä»¶çš„å¯¹é½æ–¹å¼

ä¸¤è€…ä¸€è‡´çš„ç‰¹ç‚¹ï¼ˆç‰¹ç‚¹: ä»å¤–åˆ°å†…çš„è·å–å®½é«˜ï¼‰

Column ä¸»è½´æ–¹å‘â†“, äº¤å‰è½´â†’  justifyContent å‚ç›´
Row ä¸»è½´æ–¹å‘â†’,  äº¤å‰è½´â†“ justifycontent æ°´å¹³

### Flexå¯è‡ªä¸»é€‰æ‹©æ°´å¹³å’Œå‚ç›´å¸ƒå±€å®¹å™¨

* **direction: FlexDirection.Column**  çºµå‘
* **direction: FlexDirection.Row**  æ¨ªå‘

``` ts
@Entry
@Component
struct FlexPage {
  build() {
    Column({space: 20}) {
      Flex({
        direction: FlexDirection.Row, //è¿™é‡ŒRowå’ŒColumnè‡ªä¸»é€‰æ‹©
        justifyContent: FlexAlign.SpaceEvenly, //ä¸»è½´æ–¹å‘ .Columnå‚ç›´ .Rowæ°´å¹³
        alignItems: ItemAlign.Start, //äº¤å‰è½´æ–¹å‘ .Cotumn å·¦è¾¹å¼€å§‹ å³è¾¹å¼€å§‹ .Row
        //wrap: FlexWrap.Wrap //æ¢è¡Œ
        wrap: FlexWrap.NoWrap //ä¸æ¢è¡Œ
      }) {
        Text("10").width('6%').height(60).backgroundColor(Color.Orange)
        Text("20").width('20%').height(70).backgroundColor(Color.Red)
        Text("30").width('30%').height(80).backgroundColor(Color.Blue)
        Text("40").width('16%').height(90).backgroundColor(Color.Black)
        Text("50").width('50%').height(100).backgroundColor(Color.Pink)
        Text("60").width('30%').height(90).backgroundColor(Color.Brown)
        Text("70").width('15%').height(120).backgroundColor(Color.White)
      }
      .height(180)
      .width('90%')
      .backgroundColor(Color.Gray)
    }
    .backgroundColor('#ff8ce53d')
    .width('100%')
  }
}
```

ä¸‹é¢æ˜¯Columnçš„å¯¹é½æ–¹å‘

![](/assets/images/20240119ArkTSBasic/FlexColumn.webp) 

ä¸‹é¢æ˜¯Rowçš„å¯¹é½æ–¹å‘

![](/assets/images/20240119ArkTSBasic/FlexRow.webp) 


# æ€»ç»“

éšæ—¶ç§¯ç´¯è®°å½•


URL: https://sunyazhou.com/2024/01/HarmonyPhoneSendFileTomacOS/index.html.md
Published At: 2024-01-16 01:49:00 +0000

# è§£å†³å¦‚ä½•ä»é¸¿è’™æ‰‹æœºä¼ æ–‡ä»¶åˆ°macOS

![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/harmonyOS.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## é—®é¢˜æè¿°

æœ€è¿‘å­¦ä¹ ä¸­é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜,ç”¨macç”µè„‘å¼€å‘é¸¿è’™, å…¬å¸å†…éƒ¨çš„æµ‹è¯•æœºæ˜¯HUAWEI Mate 60 Pro, å®‰è£…çš„æ˜¯HarmonyOS NEXT Developer Preview. 

å¯¹äºä¸€ä¸ªæ–°å¼æ‰‹æœºéœ€è¦å’Œå®ƒè¿›è¡Œå†…éƒ¨æ–‡ä»¶äº’ä¼ æˆäº†ç—›ç‚¹,æœ€è¿‘å¼€å‘æ€»éœ€è¦ä»æ‰‹æœºå½•å±ä¸­è·å–mp4è§†é¢‘æ–‡ä»¶å’Œæˆªå›¾,å› ä¸ºé¸¿è’™æ˜¯å®Œå…¨è„±ç¦»äº†Android, æ‰¾äº†ä¸€äº›æ‰‹æœºåŠ©æ‰‹æ ¹æœ¬è¯†åˆ«ä¸åˆ°æ­¤æ‰‹æœº,åŒ…æ‹¬å®˜æ–¹æ¨èä½¿ç”¨çš„[HiSuiteåä¸ºæ‰‹æœºåŠ©æ‰‹](https://consumer.huawei.com/cn/support/hisuite/)

![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/HiSuite.webp)

é¸¿è’™ç³»ç»Ÿå¹¶ä¸æƒ³è‹¹æœç”µè„‘, ä¸€å¥—é€šç”¨çš„AirDropå¯ä»¥ è‡ªç”±ä¼ è¾“äº è‡ªå®¶ç”Ÿæ€ä¸‹çš„å¤§éƒ¨åˆ†è®¾å¤‡,é¸¿è’™ç›®å‰çš„é˜¶æ®µè¿˜å®ç°ä¸äº†,é¸¿è’™çš„AirDropå« `åä¸ºå…±äº«`, ä¹Ÿéœ€è¦åä¸ºç”Ÿæ€ä½“ç³»ä¸‹çš„è®¾å¤‡æ‰èƒ½å…±äº«æ–‡ä»¶æ— ç¼ä¼ è¾“,ä½†æ˜¯macOSæ˜¾ç„¶ä¸æ˜¯åä¸ºç”Ÿæ€ä¸‹çš„äº§å“,é‚£æ€ä¹ˆè§£å†³æ­¤é—®é¢˜å‘¢?

## ä½¿ç”¨androidä¼ ç»Ÿçš„hdcæ–¹å¼

#### hdc

hdcï¼ˆHarmonyOS Device Connectorï¼‰æ˜¯HarmonyOSä¸ºå¼€å‘äººå‘˜æä¾›çš„ç”¨äºè°ƒè¯•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡è¯¥å·¥å…·å¯ä»¥åœ¨windows/linux/macç³»ç»Ÿä¸Šä¸çœŸå®è®¾å¤‡è¿›è¡Œäº¤äº’ã€‚

> [hdcå®˜æ–¹æ–‡æ¡£](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V2/ide-command-line-hdc-0000001237908229-V2#section116322265308)

#### å‡†å¤‡å·¥ä½œ

é€šè¿‡usbæ•°æ®çº¿è¿æ¥åˆ°macç”µè„‘,
ä¸‹é¢æ˜¯æˆ‘ç”µè„‘çš„é…ç½®
![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/systeminfo.webp)

ç„¶åå®‰è£…hdcç¯å¢ƒåˆ°ç”µè„‘ä¸Š,ä¸Šè¿°æ–‡æ¡£éƒ½æœ‰è¯´æ˜è¿™é‡Œä¸å†èµ˜è¿°,å‡è®¾ä½ æˆåŠŸå®‰è£…å¹¶è¿è¡Œ.

è¾“å…¥`hdc -v`

``` sh
Ver: 1.2.0a
```

#### å¼€å§‹è¿æ¥è®¾å¤‡ ä¼ æ–‡ä»¶


æŸ¥çœ‹ç«¯å£æ‰€æœ‰è®¾å¤‡

``` sh
è¾“å…¥:  hdc list targets -v

start server at tcp:7035
FMR0223823025245		USB	Connected	localhost	hd
```

ç„¶å æŒ‚è½½è®¾å¤‡  

``` sh
è¾“å…¥ï¼šhdc target mount

Mount finish
```
æˆäºˆè®¾å¤‡ç«¯hdcåå°æœåŠ¡è¿›ç¨‹rootæƒé™

``` sh
hdc smode
```

è¿æ¥è®¾å¤‡æ—¶ï¼Œè‹¥ä»…æœ‰ä¸€å°ï¼Œæ— éœ€æŒ‡å®šè®¾å¤‡æ ‡è¯†ã€‚è‹¥æœ‰å¤šå°ï¼Œä¸€æ¬¡ä»…èƒ½è¿æ¥ä¸€å°ï¼Œæ¯æ¬¡è¿æ¥æ—¶éœ€è¦æŒ‡å®šè¿æ¥è®¾å¤‡çš„æ ‡è¯†ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹

``` sh
hdc -t FMR0223823025245 shell
```
ç„¶åè¾“å‡ºå¦‚ä¸‹

``` sh
#  
```
> è¿™æ ·å°±è¿›å…¥äº†äº¤äº’å¼ç»ˆç«¯å¼€å§‹ä½¿ç”¨shellé€šè®¯äº†.

æ¥ä¸‹æ¥æˆ‘ä»¬æ‰¾åˆ°æˆ‘ä»¬è¦copyçš„æ–‡ä»¶ç›®å½•,å¦‚æœæ‰¾ä¸åˆ°ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹æ–‡ä»¶å¤§å°çš„æ–¹å¼

``` sh
du -sh *
```

é¸¿è’™ çš„æ–‡ä»¶ç›®å½• æ¯”å¦‚ ç›¸å†Œ æ˜¯å­˜åœ¨äº`/storage/media/100/local/files/Photo`ç›®å½•ä¸‹.

å¦‚æœä¸å¯¹åŸºæœ¬éƒ½å¤§åŒå°å¼‚.

æˆ‘ä»¬å…ˆæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬è¦ä»æ‰‹æœº copyåˆ°ç”µè„‘çš„æ–‡ä»¶ä½¿ç”¨  `du -sh *`å‘½ä»¤çœ‹çœ‹å¤§å°

``` sh
# du -sh *
3.5K	1
3.5K	16
13M	2
1.5M	3
1.7M	4
```
 
 æ•°å­—æ˜¯æ–‡ä»¶ç›®å½•çš„åç§°,æˆ‘ä»¬ æ‰¾åˆ°ç›¸å…³ç›®å½•æ–‡ä»¶ åä½¿ç”¨pwdæ‰“å°ä¸€ä¸‹å½“å‰å·¥ä½œç›®å½•,æ‹¼æ¥ä¸Šæƒ³è¦copyçš„æ–‡ä»¶å³å¯å®ç°copy.
 
 å‡è®¾æˆ‘ä»¬è·å–çš„æ–‡ä»¶ç»å¯¹è·¯å¾„æ˜¯`/storage/media/100/local/files/Photo/4/VID_1705287805_004.mp4`
 
è¿™æ—¶å€™æˆ‘ä»¬æ–°å¼€ä¸€ä¸ªç»ˆç«¯.å¹¶è¾“å…¥å¦‚ä¸‹å‘½ä»¤.(å‚è€ƒæ–‡æ¡£å¯ä»¥æ‰¾åˆ°æ›´å¤šå…³äºæ–‡ä»¶æ“ä½œçš„æŒ‡ä»¤)

``` sh
hdc file recv /storage/media/100/local/files/Photo/4/VID_1705287805_004.mp4 ~/Downloads/
```

è¾“å‡º

``` sh
[I][2024-01-16 11:11:29] HdcFile::TransferSummary success
FileTransfer finish, Size:1823388, File count = 1, time:140ms rate:13024.20kB/s
```

![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/file.webp)

é€šè¿‡ä¸Šè¿°æ“ä½œæˆ‘ä»¬å°±ä»åä¸ºçš„é¸¿è’™æ‰‹æœºä¸­æŠŠç›¸åº”çš„æ–‡ä»¶ä¼ åˆ°äº†æˆ‘ä»¬çš„macOSä¸Šäº†


## å…¶å®ƒæ“ä½œ

æ¯”å¦‚æŠŠæ–‡ä»¶ ä»macOSä¸Šä¼ åˆ°é¸¿è’™æ‰‹æœºä¸Š è¿™é‡Œå°±ä¸ä¸€ä¸€æµ‹è¯•äº†,è¿™æ ·æ“ä½œéå¸¸æ–¹ä¾¿,å®Œå…¨å‘½ä»¤è¡Œå¼çš„æ–¹å¼


## ä½¿ç”¨IDE è®¾å¤‡æ–‡ä»¶æµè§ˆå·¥å…·(2024å¹´3æœˆ2æ—¥æ›´æ–°)


åœ¨æœ€æ–°ç‰ˆæœ¬çš„Dev-Eco Studio(DevEco Studio NEXT Developer Preview2)ä¸­,åŠ å…¥äº†æ–°çš„è®¾å¤‡ä¿¡æ¯æµè§ˆå·¥å…·

ä½ç½®åœ¨IDEçš„å³ä¸‹è§’
![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/DeviceFileBrowserEntry.webp),
![](/assets/images/20240116HarmonyPhoneSendFileTomacOS/DeviceFileBrowser.webp)

è¿™é‡Œæ‹¿æˆªå›¾ä¸¾ä¸ªä¾‹å­,ä¸Šè¿°æ˜¯æˆªå›¾çš„å›¾ç‰‡ä¿å­˜è·¯å¾„.

## æ›´æ–°æ–°ç‰ˆæœ¬hdcå·¥å…·çš„ç¯å¢ƒå˜é‡é…ç½®

``` sh
export PATH=$PATH:~/Library/Huawei/sdk/HarmonyOS-NEXT-DP2/base/toolchains
export HDC_SERVER_PORT=7035
export OHPM_HOME=~/Library/Huawei/ohpm
export PATH=${OHPM_HOME}/bin:${PATH}
```

æˆ‘ç”¨çš„`.zshrc`çš„æ–‡ä»¶,æ‰€ä»¥ç¯å¢ƒå˜é‡å†™åˆ°äº†`.zshrc`é‡Œé¢.

# æ€»ç»“

ä¸å¾—ä¸è¯´ è¿™ä¸ªåŠŸèƒ½å¯¹äºç°åœ¨çš„ç¯å¢ƒæ¥è¯´éå¸¸å¿…è¦å¼€å‘ä¸€ä¸ªå›¾å½¢é¡µé¢appæ¥ä¼ æ‰‹æœºä¸Šçš„æ–‡ä»¶åˆ°å…¶å®ƒç«¯,åŒ…æ‹¬å…¼å®¹ç°åœ¨çš„macOS,iOS,iPadOSç­‰ç­‰è‹¹æœç”Ÿæ€ä»¥åŠAndroidç”Ÿæ€çš„ä¸‹çš„è®¾å¤‡è¿›è¡Œç»„ç½‘,å®ç°è¿‘åœºé€šä¿¡äº’ä¼ æ–‡ä»¶,è¿™æ ·çš„appéå¸¸å¿…è¦.





URL: https://sunyazhou.com/2024/01/harmonyoslaunchpage/index.html.md
Published At: 2024-01-15 12:55:00 +0000

# é¸¿è’™å¯åŠ¨é¡µé¢å¼€å‘

![](/assets/images/20240115HarmonyOSLaunchPage/HarmonyLogo.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## é¸¿è’™OSå¼€å‘

2024å¹´æŠ€æœ¯ä¸èƒ½åªåœç•™åœ¨å˜´ä¸Š,è¡Œèƒœäºè¨€,ç»è¿‡å‡ ä¸ªæœˆçš„é¸¿è’™å¼€å‘çš„å­¦ä¹ ,è§‰å¾—è¿˜æ˜¯è¦æŠŠå®¹æ˜“å¿˜è®°çš„å†…å®¹è®°å½•ä¸‹æ¥,ä»Šå¤© å¸¦äº†çš„ç¬¬ä¸€ä¸ªç®€å•ä»£ç æ˜¯å¼€å¯é¸¿è’™å¼€å‘çš„å…¥é—¨ç¯‡,åšä¸€ä¸ªç®€å•çš„é—ªå±é¡µ


### å…ˆçœ‹ä¸‹å®ç°æ•ˆæœ

![](/assets/images/20240115HarmonyOSLaunchPage/launch.gif)

### è¿™é‡Œä½¿ç”¨çš„HarmonyOS4.1ç¯å¢ƒ

ä»£ç å¦‚ä¸‹:

``` ts
import router from '@ohos.router'

@Entry
@Component
struct Index {
  onPageShow() {
    setTimeout(()=> {
      console.log("é—ªå±1sç»“æŸ")
      router.pushUrl({
        url:'pages/Home'
      })
    }, 3000)
  }

  build() {
    Flex({
      direction: FlexDirection.Column,
      alignItems: ItemAlign.Center,
      justifyContent: FlexAlign.Center
    }) {
      Image($r("app.media.sunyazhou"))
        .width(100)
        .height(100)
      Text("è¿ˆè…¾å¤§é˜Ÿé•¿")
        .fontSize(26)
        .fontColor(Color.White)
        .margin({top: 300})
      Text("SUNYAZHOU.COM ç‰ˆæƒæ‰€æœ‰")
        .fontSize(16)
        .textAlign(TextAlign.Center)
        .fontColor(Color.White)
        .margin({top: 10})
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#66CDAA')
  }
}
```

è¿›å…¥é¦–é¡µçš„åŸºæœ¬ä»£ç 

``` ts  
@Entry
@Component
struct Home {
  build() {
    Column(){
      Text("Homeé¦–é¡µ")
        .fontSize(26)
        .fontColor(Color.White)
        .margin({top: 300})
    }.width('100%').height('100%').backgroundColor('#00FFFF')
  }
}
```

ä¸Šè¿°ä»£ç æ¯”è¾ƒé‡è¦çš„æ˜¯`onPageShow()`ä¸­çš„`setTimeout`å‡½æ•°,è¿™ä¸ªå‡½æ•°è‡ªå¸¦å®šæ—¶å™¨, 3000ä»£è¡¨ 3s,  ä¹Ÿå°±æ˜¯è¯´ 3ç§’ååˆ©ç”¨è·¯ç”±ç›´æ¥è¿›å…¥Homeé¡µ.

è¿™é‡Œä½¿ç”¨çš„æ˜¯Flexå¸ƒå±€,

* direction: FlexDirection.Column,
* alignItems: ItemAlign.Center,
* justifyContent: FlexAlign.Center

è¿™ä¸‰ä¸ªåˆ†åˆ«ä»£è¡¨äº†Flexä¸»è½´æ–¹å‘ã€å†…å®¹å¯¹é½æ–¹å‘ã€äº¤å‰è½´æ–¹å‘.å¦‚æœæœ‰ä¸ç†è§£çš„è¯è¯·è‡ªè¡Œåé¦ˆ[åä¸ºå¼€å‘æ–‡æ¡£](https://developer.harmonyos.com/cn/develop/)

# æ€»ç»“

ä»Šå¤©çš„ç®€å•çš„ä»‹ç»å¯åŠ¨é—ªå±é¡µçš„ç®€å•å¼€å‘,å¤§å®¶å¯ä»¥åŸºäºè¿™ä¸ªåšä¸€äº›å¹¿å‘Šå’Œå¯åŠ¨é¡µé…ç½®.è‡³äºå¤æ‚çš„å†…å®¹æœ‰å¾…åç»­æ¢ç´¢,æ„Ÿè°¢è§‚çœ‹.


URL: https://sunyazhou.com/2023/12/FinalSummary/index.html.md
Published At: 2023-12-31 08:02:00 +0000

# 2023å¹´ç»ˆæ€»ç»“

![](/assets/images/20231231FinalSummary/banner.webp)  
<button type="button" class="btn btn-info" data-toggle="popover" title="Magotan1990" data-content="å»æ‰“å°çƒçš„è·¯ä¸Š">ç¹åçš„åŒ—äº¬äºŒç¯ä¸œå››åæ¡å¤©æ¡¥å¤œæ™¯</button>


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

``` txt
ä¸‰åå‡ å²æƒ³ä»å‰,äººç”Ÿå·²ç»å¤ªè‰°éš¾.
å¢æ•ˆå¢ç¬‘å¢å¢ç¬‘,è£å‘˜è£æºè£å‰©é—².
è½»èˆŸæƒ³è¿‡ä¸‡é‡å±±,å¿…å°†æ­¤èˆŸå·ä¸Šå¤©.
é‡æŒ¯æ——é¼“å·å·¨æµª,ç ´å£å‰è¡Œå‹‡å‘å‰.
```
> è¿™ä¸æ˜¯AIå†™çš„è¯—å“ˆ,chatGPTç›®å‰è¿˜å†™ä¸å‡ºæˆ‘è¿™æ°´(ä½)å¹³(æ¡£).

è¿™ä¸€å¹´,æˆ‘æƒ³ç”¨Bç«™ä¸Šéå¸¸niceä¸‰å›½å‘¨éƒçš„ç»å…¸PUAè¯­å½•æ¥æŠ’å‘ä¸€ä¸‹ä¸å ªå›é¦–çš„2023, "è¿‘æ—¥å…»ä¼¤,æ·±æ„Ÿäººç”Ÿä¹‹è‰°éš¾,å°±åƒé‚£ä¸æ¯ä¹‹é•¿æ²³,è™½æœ‰ä¸œå»å¤§æµ·ä¹‹å¿—,å´æµç¨‹ç¼“æ…¢å¾ç¨‹å¤šè‰°.å”‰! ç„¶æ±Ÿæ²³æ°´æ€»æœ‰å…¥æµ·ä¹‹æ—¶,è€Œäººç”Ÿä¹‹å¿—,å´å¸¸å¸¸éš¾ä»¥å®ç°,ä»¤äººæŠ±æ¨ç»ˆèº«."

è¿™æ˜¯åšæŒå†™å¹´ç»ˆæ€»ç»“çš„ç¬¬å‡ ä¸ªå¹´å¤´æˆ‘å·²ç»ä¸çŸ¥é“äº†,å¦‚æœéè¦ç»™ä»Šå¹´çš„æ€»ç»“å†™ä¸ªä¸»é¢˜çš„è¯æˆ‘è‚¤æµ…çš„è®¤ä¸º:  
"å¤§éƒ½ç£,é—²è¨€å°‘å™å§,ä¿ºè€å­™åªæƒ³ä¿ä½å·¥ä½œ,å‹‰å¼ºç³Šå£,åœ¨å®Œæˆæ­¤ç›®çš„çš„å‰æä¸‹,æˆ‘æ‰æœ‰å¯èƒ½è·Ÿå¤§éƒ½ç£è®¨è®ºä¸€ä¸‹æ‚¨çš„äººç”Ÿä¹‹å¿—,é„™äººæ²¡æœ‰å¤§éƒ½ç£ä¹‹å¿—,é„™äººä¹‹å¿—,ç”šä¸ºè‚¤æµ…,è‹Ÿä½å·¥ä½œå,æ‰èƒ½ä¸å…¬ç‘¾æŠ¬å¤´ç›¸è§."æœ€ä¸ºè´´åˆ‡.

* [2022å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2022/12/FinalSummary/)  
* [2021å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2021/12/FinalSummary/)
* [2020å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2020/12/FinalSummary/)
* [2019å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2019/12/FinalSummary/)
* [2018å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2018/12/FinalSummary/)
* [2017å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2017/12/FinalSummary/)

## 2023å¹´å›é¡¾

* åœ°çƒçš„å’Œå¹³
* å¯ç¬‘çš„å®äº‹
* å¹³åº¸çš„ç”Ÿæ´»
* åŠªåŠ›çš„å·¥ä½œ
* ä¸å–„äºå­¦ä¹ 
* è‚¤æµ…çš„çˆ±å¥½
* è´¥å®¶çš„å¥½ç‰©

æˆ‘ä¸€ç›´éƒ½è®¤ä¸ºè‡ªå·±æ˜¯ä¸ªè‚¤æµ…çš„äºº,å¦‚æœè¯»è€…æ…·æ…¨çš„è¯è¯·ç»§ç»­è¯»ä¸‹å»,è™½ç„¶éƒ½æ˜¯ä¸€å †æµæ°´è´¦,ä¹Ÿè®¸è‚¤æµ…çš„äººç”Ÿä¹Ÿæœ‰å‘å…‰ç‚¹,ä¹Ÿè®¸èƒ½ç…§äº®ä½ åœ¨è‚¤æµ…çš„é“è·¯ä¸Šä¸æ–­ä¿®æ­£è‡ªå·±çš„ä¸è¶³ä¸”æå‡ä½ çš„è®¤çŸ¥.

### åœ°çƒçš„å’Œå¹³

![](/assets/images/20231231FinalSummary/peace.webp)

ä»Šå¹´çœŸçš„ä¸å ªå›é¦–,ä¸‰å¹´çš„ç–«æƒ…ç»ˆäºè½ä¸‹æ¥å¸·å¹•,å¤§å®¶éƒ½æ•¢æ‘˜æ‰å£ç½©äº†,æ¯ä¸ªäººéƒ½æœ‰äº†æŠ—ä½“(ç›´åˆ°æœ¬æ–‡æ’°å†™çš„ç°åœ¨2023å¹´12æœˆä»½å¤§å®¶åˆæŠŠå£ç½©æˆ´ä¸Šäº†,ç”²æµä¹™æµæ”¯åŸä½“ç­‰æ„ŸæŸ“çš„èƒè¿«ä¸‹ä¸å¾—ä¸é˜²èŒƒèµ·æ¥). ä»ä¿„ä¹Œå¼€æˆ˜è‡³ä»Šéƒ½æ²¡æœ‰åœæˆ˜çš„è¿¹è±¡çš„åŒæ—¶,å·´ä»¥å†²çªåˆé‡è¹ˆä¿„ä¹Œçš„è¦†è¾™.æ´»åœ¨å’Œå¹³å›½åº¦çš„æˆ‘ä»¬ä¹Ÿæœªå°å¹¸ç¦,ä¹Ÿè®¸å’Œå¹³çœŸçš„åªåœ¨å¤§ç‚®å°„ç¨‹èŒƒå›´ä¹‹å†…,çœŸç†çœŸçš„åªåœ¨å‰‘é”‹ä¹‹é—´å§! å’Œå¹³ç»ˆå°†è¿˜å¾—æˆ‘ä»¬ä¸­åå´›èµ·æ‰èƒ½å®ç°.

ç”±äºä¸–ç•Œçš„æ ¼å±€é£èµ·äº‘æ¶Œ,æˆ‘ä»¬çš„ç”Ÿæ´»æ­¥å±¥è‰°éš¾,ä¼ä¸šè£å‘˜,å‘˜å·¥å¤±ä¸šæˆä¸ºè¿™ä¸ªæ—¶ä»£çš„ä¸»é¢˜, æ¶ˆè´¹ä½è¿·,ç¾å…ƒä¸æ–­åŠ æ¯,è´§å¸è´¬å€¼ä¸¥é‡,é«˜æ˜‚çš„æˆ¿ä»·å·²ç»ä¸æ˜¯æˆ‘è¿™ç§è‚¤æµ…çš„äººæ•¢å“å¤´è®ºè¶³çš„å¥¢ä¾ˆå“äº†,å°±å› ä¸ºä¸–ç•Œæ²¡æœ‰äº†å’Œå¹³,ç»æµé™·å…¥åœæ»,åœæ»ä¹Ÿå°±ç®—äº†ç½—å®¾è¿˜è”åˆè„šç›†é¸¡ã€å°æºªå§,å°è¢‹é¼ ä»å„ç§å›½é™…è´¸æ˜“ä¸Šå¯¹æˆ‘ä»¬è¿›è¡Œæ— å·®åˆ«åˆ¶è£,å„ç§åŒæ ‡å¯¼è‡´æˆ‘ä»¬åœ¨åœ°çƒæ‘çš„åœ°ä½è¢«æ’¼åŠ¨,å¯¼è‡´æˆ‘ä»¬çš„ä¼ä¸šå‡ºä¸å»å›½é—¨å‘å±•è´¸æ˜“,æˆ‘ä»¬é™·å…¥äº†ç»æµå†…å¾ªç¯,GMåˆåœ¨è¿‘10å¹´çš„æ—¶é—´å†…æç©ºäº†æˆ‘ä»¬çš„é’±åŒ…,æˆ‘ä»¬ç°åœ¨çš„ç”Ÿæ´»æ°´å¹³æˆ‘åªèƒ½è¯´â€œå³°å³¦å¦‚èšï¼Œæ³¢æ¶›å¦‚æ€’, æˆ‘æ‰€æœ‰çš„åŠªåŠ›éƒ½ä¸å¦‚åœŸ(åœŸåœ°è´¢æ”¿),å…´ï¼Œç™¾å§“è‹¦ï¼›äº¡ï¼Œç™¾å§“è‹¦â€,åˆ«ç¬‘å¼ å…»æµ©,æˆ‘çŸ¥é“ä½ ä¹Ÿè‹¦,æ‰€ä»¥ä½ æ‰å†™å‡ºã€Šå±±å¡ç¾ŠÂ·æ½¼å…³æ€€å¤ã€‹.

bidenä¹Ÿå¿«åˆ°ä»»æœŸäº†,åœ¨ä»–åœ¨ä½çš„è¿™å‡ å¹´é—´ä¸–ç•Œäººæ°‘çœŸçš„é™·å…¥åˆ°ä»æœªæœ‰è¿‡çš„ææƒ§æ„Ÿçš„ä¸–ç•Œä¸­,å¿çœ‹ç¡çƒŸä¹‹åœ°é‡ç”Ÿæˆ˜ç«, ç—›æƒœè´Ÿä¼¤ä¹‹å…µå†ä¸¾åˆ€æª.ä»ä¼Šæ‹‰å…‹æ’¤ç¦»ç¾å†›,æ”¯æŒåŒ—çº¦åŠ å…¥ä¹Œå…‹å…°çš„ç­å›½æˆ˜äº‰,æ”¯æŒä¹Œå…‹å…°æç”Ÿç‰©å®éªŒç­ç»äººç±»,æ”¯æŒä»¥è‰²åˆ—æ‰“å·´å‹’æ–¯å¦,æ”¾ä»»è„šç›†é¸¡æ’æ”¾æ ¸æ±¡æ°´å‘å¤ªå¹³æ´‹,ç–¯ç‹‚å°é’è‡´ä½¿ç¾é‡‘è¶…å‘æ”¶å‰²å…¨ä¸–ç•Œ,å“ªé‡Œæœ‰æˆ˜äº‰å“ªé‡Œå°±ä¸€å®šæœ‰ç½—å®¾,å“ªé‡Œå°±æ°¸æ— å®æ—¥.

ç§‘å­¦æ›¾ç»æ— å›½ç•Œ,ç°åœ¨å¤§å›½çš„ç«äº‰ä¹Ÿè®©ç§‘å­¦æœ‰äº†å›½ç•Œ,RTX4090æ˜¾å¡è¯´ä¸è®©ä½ ç”Ÿäº§å°±ä¸è®©ä½ ç”Ÿäº§,A100æ˜¾å¡è¯´ä¸å–ç»™æˆ‘ä»¬å°±ä¸å–ç»™æˆ‘ä»¬,æ•´çš„é©¬æ–¯å…‹éƒ½è¯´ä¹°æ˜¾å¡å°±åƒä¹°è¿ç¦å“ä¸€æ ·å›°éš¾.æ²¡æœ‰äº†è¿™äº›é«˜ç«¯çš„æ˜¾å¡æˆ‘ä»¬å¯èƒ½ä¸èƒ½æ›´å¿«çš„å‘å±•äººå·¥æ™ºèƒ½ã€è‡ªåŠ¨é©¾é©¶ã€äººè„¸è¯†åˆ«ã€è®¡ç®—æœºè§†è§‰ã€åŒ»å­¦å›¾åƒå¤„ç†,ç­‰ç­‰.å°±ä¸€å—ç ´æ˜¾å¡å°±èƒ½å¡ä¸»æˆ‘ä»¬è„–å­,å°±ä¸€å—æ˜¾å¡å°±èƒ½è®©æˆ‘ä»¬çš„ç”Ÿæ´»é™·å…¥æ— å°½çš„æ²¼æ³½æ³¥æ½­.

æˆ‘å–œæ¬¢æŠ›å¼€å¤–è¡¨çœ‹æœ¬è´¨,æœ¬è´¨æ˜¯æˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„åŸºç¡€ç§‘å­¦çš„æ”¯æ’‘åšæŠ€æœ¯ç§¯ç´¯,æˆ‘ä»¬æ‰€æ‹¥æœ‰çš„çŸ¥è¯†è¿˜ä¸è¶³ä»¥æ‰“è´¥ä¸–ç•Œåˆ¶é€ é¡¶å°–èŠ¯ç‰‡çš„æ°´å¹³.æœ¬è´¨è¿˜æ˜¯æˆ‘ä»¬æ— çŸ¥.æ— æ³•ç”¨ç°æœ‰çš„çŸ¥è¯†æ­¦è£…è‡ªå·±æˆä¸ºåˆ¶é€ é¡¶çº§èŠ¯ç‰‡çš„å·¥ç¨‹å¸ˆ,ä¹Ÿå°±æ— æ³•ååˆ¶ç½—å®¾çš„åˆ¶è£,ä¹Ÿå°±æ— æ³•æ”¹å˜ç°åœ¨ä¸–ç•Œçš„æ ¼å±€,ç”šè‡³ç»´æŠ¤ä¸–ç•Œçš„å’Œå¹³ç§©åº.

åœ¨ä¸€ä¸ªè¿è‡ªå·±å·¥ä½œéƒ½ä¿ä¸ä½çš„ç¯å¢ƒä¸‹,åœ°çƒæ‘çš„å’Œå¹³,æœ‰ç‚¹å¯ç¬‘.æ›´å¯ç¬‘çš„æ˜¯ä¹Ÿä¸çŸ¥é“ç°åœ¨å¡æˆ‘ä»¬è„–å­çš„å¤§å­¦ç»è¥å’‹æ ·äº†,å¦‚æœå¯èƒ½çš„è¯æˆ‘çœŸåƒç»™è€æ›¹å‘é‚®ä»¶é—®é—®,ç¦è€€ç§‘æŠ€å¤§å­¦ç°åœ¨ä»€ä¹ˆè¿›åº¦,èƒ½ä¸èƒ½å‘æˆ‘æ±‡æŠ¥ä¸€ä¸‹,æˆ‘å¯æ˜¯å­˜ç€34é¡¹å¡è„–å­ä¸“ä¸šç­‰ç€ä½ è¿™å¤§å­¦å¼€å¹²æŒ¨ä¸ªçªç ´å‘¢!

æˆ‘å¸Œæœ›é€šè¿‡è‡ªå·±çš„å»–èƒœäºæ— çš„åŠªåŠ›,åœ¨æœªæ¥çš„å‘å±•æ—¶é—´é‡Œ,å¯¹ä¸–ç•Œå’Œå¹³åšå‡ºä¸€äº›ä¸çŸ¥é“èƒ½åˆ°ä»€ä¹ˆç¨‹åº¦çš„è´¡çŒ®å§!æˆ‘åº”è¯¥äº’ç›¸å‹‰åŠ±ä¸€ä¸‹å¤§å®¶å¯æ˜¯åˆæ‹…å¿ƒè¿™æ˜¯PUA,ç®—äº†,æˆ‘ä»¬è¡Œèƒœäºè¨€.

### å¯ç¬‘çš„å®äº‹

è¿™ä¸€å¹´å¯ç¬‘çš„äº‹çœŸæ˜¯å±‚å‡ºä¸ç©·,æˆ‘åªè¯´ä¸¤ä»¶äººæ°‘æœ€å…³åˆ‡çš„é—®é¢˜.æˆ¿äº§æš´é›·å’Œæˆ¿å­è§£é™è´­

#### æ’å¤§æš´é›·

æˆ‘åœ¨2021å¹´çš„æ—¶å€™æ›¾å°±è®¸å®¶å°é€ è½¦è¿™äº‹å°±è¯´è¿‡,è¿™æœ‰é’±äººæœ‰é’±ä»–ä¸ä¼šèŠ±,è¿™è¯åœ¨2023å¹´ç»ˆäºå¾—åˆ°äº†éªŒè¯,æ’å¤§æˆ¿åœ°äº§ç‡å…ˆæš´é›·,å‡‰äº†,æ’å¤§çš„æ±½è½¦å“ç‰Œæ’é©°ä¹Ÿæœªèƒ½å¹¸å…,è®¸å®¶å°è¿™æ­¥æˆ‘æ˜¯çœŸæ²¡çœ‹æ‡‚,åˆ°åº•æ˜¯xé’±è¿˜æ˜¯çœŸä¸ä¼šèŠ±é’±,æˆ‘å½“æ—¶å°±è¯´ä½ ç»™å›½å®¶é€ ä¸€æ‰€å¤§å­¦,è¿™å¤§å­¦ä¸“é—¨å¼€è®¾è§£å†³å¡ä¸­å›½è„–å­çš„æŠ€æœ¯ä¸“ä¸š,åŸ¹å…»ä¸“ä¸šæå¼ºçš„å¤§å­¦ç”Ÿ,å¹²ä¸å¥½å°±æŠŠè¿™èµ„äº§ç”³è¯·ç ´äº§ç»™å›½å®¶,ä¸è¯´åˆ«çš„ä½ èŠ±å‡ åä¸ªäº¿æ‰“é€ å‡ ä¸ªä¸–ç•Œé¡¶çº§å®éªŒå®¤,è‚¯å®šæ¯”é€ è½¦æ›´æœ‰å¸Œæœ›,ç°åœ¨å€’å¥½,æˆ‘ä¹Ÿä¸æ¸…æ¥šä½ æ˜¯Xé’±è¿˜æ˜¯åœ¨å¹²å•¥,ç»™è‡ªå·±å¹²ç¬†ç¯±å­å»äº†.

ä½†å‡¡è®¸å®¶å°æœ‰ç‚¹æˆ‘è¿™ç§è‚¤æµ…çš„è®¤çŸ¥éƒ½ä¸ä¼šèµ°åˆ°ä»Šå¤©è¿™ç§åœ°æ­¥.ä¹Ÿè®¸è¿™å°±æ˜¯ç»æµä¸‹è¡Œå‹åŠ›å¤§,CPIæ¶ˆè´¹é™çº§,æ‰å¯¼è‡´æˆ¿åœ°äº§æš´é›·.å¯æ˜¯ä¹°æ’å¤§æˆ¿äº§çš„ä¸šä¸»å¯æ˜¯å¤§éƒ¨åˆ†éƒ½æ˜¯åƒæˆ‘è¿™æ ·çš„å¹³æ°‘ç™¾å§“,ä½ åƒçš„äº”é¥±å…­é¥±,åˆ°åº•æœ‰æ²¡æœ‰å…³æ³¨è¿‡æˆ‘è¿™ç§åº•å±‚è€ç™¾å§“çš„æ°‘ç”Ÿ,åˆ°åº•èƒ½ä¸èƒ½çƒ‚å°¾,ä¿äº¤æ¥¼éƒ½æ‰¯æ·¡å§!è¿™ä¸ªå›½å®¶è¦æ˜¯æœ‰ä½ è¿™æ ·çš„è´ªå©ªèµ„æœ¬å®¶,è€ç™¾å§“è¿˜æ€ä¹ˆå®ç°å…±åŒå¯Œè£•,è¿˜æ€ä¹ˆå¥”å°åº·,è¿˜æ€ä¹ˆè§£å†³æ¸©é¥±.

å¸Œæœ›è€è®¸è‰¯å¿ƒæ²¡å®Œå…¨æ³¯ç­,ç»™ä¹°æ’å¤§æˆ¿å­çš„ä¸šä¸»ä¸€ä¸ªäº¤ä»£.æˆ‘æ²¡ä¹°è¿™çš„æˆ¿å­,æˆ‘åªæ˜¯æ›¿ä¹°æ’å¤§æˆ¿äº§çš„ä¸šä¸»æä¸ªè¯,ç”¨ä»¥è¯æ˜æˆ‘ä¸€è‚¡æ­£ä¹‰æ„Ÿæ¶Œä¸Šå¿ƒå¤´.

#### æˆ¿å­è§£é™è´­

![](/assets/images/20231231FinalSummary/policy.webp)

åŒ—äº¬ä¹°æˆ¿ç»ˆäºè§£å¼€äº†é™æˆ¿ä¸é™è´·äº†,ä¸å†è¢«å¤–åœ°ä¹°æˆ¿è´·æ¬¾è®°å½•æ‰€å›°æ‰°äº†,åŒ—äº¬çš„æˆ¿äº§è§£é™è´­ä¹Ÿè®¸å°±ä»ä»Šå¹´å¼€å§‹,é¦–éƒ½çš„åº•ç‰Œä¹Ÿæ²¡æœ‰å‡ å¼ å¥½ç‰Œäº†,ä¸ºäº†æŒ½å›ç»æµä¸‹è¡Œçš„é¢“åŠ¿, å…¬ç§¯é‡‘ä»Šå¹´11æœˆä»½ç»ˆäºå®ç°äº†è®¤æˆ¿ä¸è®¤å•†è´·,ä¹Ÿå°±æ˜¯è¯´åƒæˆ‘è¿™ç§2017å¹´ä¹°è€å®¶çš„æˆ¿å­æ²¡æœ‰æœºä¼šä½¿ç”¨åŒ—äº¬å…¬ç§¯é‡‘ç”¨å•†è´·è´·æ¬¾,è¿™ç§æƒ…å†µåœ¨åŒ—äº¬è¿˜ç®—é¦–å¥—æˆ¿,è¿˜èƒ½äº«å—å…¬ç§¯é‡‘é¦–å¥—æˆ¿è´·æ¬¾. 

è¿™æ˜¯ä»Šå¹´ä¹Ÿè®¸æœ€å¥½çš„æ”¿ç­–äº†,ç„¶è€Œå¥½åƒä¹Ÿæ²¡å•¥åµç”¨,å·¥ä½œä¸ç¨³å®šçš„å¤§å®¶è§‰å¾—æ”¿åºœè¿™æ˜¯æŒ ç—’ç—’,å·¥ä½œä¸ç¨³å®šä¼ä¸šè£å‘˜,è°éƒ½ä¸æ•¢è½»æ˜“ä¹°æˆ¿,æ˜¯å‘€!ç»è¿‡3å¹´çš„ç–«æƒ…æ¶ˆè€—,å¤§å®¶ä¹Ÿè®¤æ¸…äº†ç°å®,æ”’é’±ä¸æ¶ˆè´¹,å°‘æ¶ˆè´¹,ä¹°ä¸œè¥¿å¤Ÿç”¨å°±è¡Œ,ä¸ç”¨è¿½æ±‚å¤šå¥½,æ¶ˆè´¹è§‚å¿µå¾ˆåŠ¡å®.è¿™æ˜¯å¥½äº‹ä¹Ÿæ˜¯åäº‹,å¥½äº‹æ˜¯å¤§å®¶éƒ½æ‡‚äº†å‹¤ä¿­èŠ‚çº¦,åäº‹æ˜¯æ¶ˆè´¹ä½è¿·åç»æµå¢é€Ÿæ”¾ç¼“,å°±ä¸šå°±æ›´éš¾äº†, ç»æµçš„ä¸‰é©¾é©¬è½¦ä¸­çš„ä¸€æ¶ä¸çµäº†,å¸¦æ¥çš„å‰¯ä½œç”¨å¯æ˜¯å¤§å®¶éå¸¸éš¾ä»¥æ‰¿å—çš„.

![](/assets/images/20231231FinalSummary/policynew.webp)

å¥½æ”¿ç­–ä¸€ä¸ªæ¥ç€ä¸€ä¸ª,é¦–ä»˜é™è‡³30%äº†,è´·æ¬¾å•†è´·ä¹Ÿé™åˆ°4.2%çš„åˆ©ç‡äº†.åœ¨æˆ‘çœ‹æ¥è¿™æ˜¯æˆ¿å­å–ä¸åŠ¨,ä¸ºäº†åˆºæ¿€ç»æµ,å‰²éŸ­èœéƒ½å‰²åˆ°éŸ­èœæ ¹äº†.

> ä¸çŸ¥é“ä»ä½•æ—¶èµ·,é€æ¸å¼€å§‹å–œæ¬¢æµè§ˆæ”¿åºœçš„å®˜æ–¹ç½‘ç«™å¹¶å…³æ³¨å®ƒçš„åŠ¨å‘.æœ‰æ—¶å€™æˆ‘è§‰å¾—ç¼ºå°‘ä¸€ä¸ªèƒ½æŠŠå®˜æ–¹ç½‘ç«™è§£è¯»æ¸…æ¥šçš„æ¬¡çº§ç½‘ç«™,ä¸“é—¨ç”¨å¤§ç™½è¯è§£è¯»æ”¿åºœçš„ä¸€ä¸¾ä¸€åŠ¨,è¿™æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„å¸‚åœº.

### å¹³åº¸çš„ç”Ÿæ´»

#### çˆ¶äº²çš„ç¦»å»

ä»Šå¹´å®¶çˆ¶å»ä¸–äº†,æˆ‘å¾ˆæ‚²ä¼¤,çˆ¶äº²çš„ç¦»å¼€è®©æˆ‘å˜çš„æ„å¿—æ¶ˆæ²‰,ä»å‰æˆ‘éƒ½æ˜¯ä¾èµ–æ€§å¾ˆå¼ºçš„å­©å­,æœ‰æ—¶å€™å¾ˆæ€€å¿µå°æ—¶å€™çˆ¶äº²è´Ÿè´£ç»™æ‘é‡Œçš„è‡ªæ¥æ°´å¡”æŠ½æ°´,æ¯å¹´çš„å†¬å¤©è¿‡å¹´æ”¶æ‹¾é™¢å­,å‡†å¤‡æŸ´è‰,æ­£æœˆåäº”çš„æ—¶å€™ç”¨åºŸæ—§çš„æœºæ²¹å¼•ç‡ƒé™¢å­çš„ç¯ç«.å¤å¤©è€çˆ¸æ”¶æ‹¾å®¶é‡Œçš„é“è·¯å’Œè¡—è§’,é‚£äº›å¹´å®¶é‡ŒçœŸçš„å¾ˆç©·,è¿˜åœ¨ä½¿ç”¨é•¿æ˜¥ä¸€æ±½åˆ¶é€ çš„12é©¬åŠ›æ‹–æ‹‰æœº,ä¹Ÿè®¸è¿™è½¦å°±åƒçˆ¶äº²çš„çµé­‚,ç ´æ—§ä½†å¹²å‡€çš„å°±å·®åˆ®è…»å­å–·æ¼†è®©ä»–ç„•ç„¶ä¸€æ–°ä¸€æ ·.

æ¯å½“æƒ³èµ·çˆ¶äº²çš„èƒŒå½±,ä¹Ÿè®¸åªæœ‰æå®—ç››çš„ã€Šæ–°å†™çš„æ—§æ­Œã€‹èƒ½è¡¨è¾¾æˆ‘å’Œçˆ¶äº²ä¹‹é—´çš„æ„Ÿæƒ…, è¿™äº›å¹´æˆ‘åªé¡¾è‡ªå·±, æœ‰æ—¶å€™æˆ‘çš„è¿½æ±‚ä»–æ— åŠ›å‚ä¸, å½“åº¸ç¢Œæ— ä¸ºçš„æ—¥å­æ‚„ç„¶å¦‚çº¦è€Œè‡³, æˆ‘åªé¡¾ç€è‡ªå·±å‘å¾®çš„å–˜æ¯,ç”šè‡³æ²¡æœ‰é™ªä»–,å¤±å»å‘¼å¸. çˆ¸,å½“æˆ‘æœ‰ä¸€å¤©ä¹˜é£å»è§ä½ ,å†èŠèŠè¿™æ–‡ç« é‡Œæ¥ä¸åŠè¯´çš„åƒè¨€ä¸‡è¯­.

è¯´çœŸçš„,æˆ‘å³ä¾¿ä¸Šå¤§å­¦çš„æ—¶å€™éƒ½æ²¡æœ‰æ„è¯†åˆ°è¿™äº›åœºæ™¯å°†æˆä¸ºå›ä¸å»çš„ä»å‰.ç›´åˆ°å·¥ä½œäº†è¿™äº›å¹´è¿‡å¹´å›å®¶æ‰æ¸æ¸åœ°æ„è¯†åˆ°,å†œæ‘å‘åŸå¸‚è¿ç§»çš„é€Ÿåº¦é€æ¸åŠ å¿«,æˆ‘å¾ˆå–œæ¬¢å†œæ‘å®¶é‡Œç§çš„è”¬èœ,å¤å¤©å›å»ç»™çˆ¶äº²ä¸ŠåŸæ—¶,æˆ‘å›äº†è¶Ÿå®¶,æ‹¿äº†ä¸€äº›èœ,å®¶é‡Œå›­å­å’Œé™¢å­ç°åœ¨åªèƒ½ç•™ç»™è®¤è¯†çš„è¿˜æ²¡æ¬è¿›åŸé‡Œçš„å·¦é‚»å³èˆä½¿ç”¨äº†.

#### å®¶é‡Œçš„å°æœ‹å‹

çˆ¶äº²ç¦»å¼€å‡ ä¸ªæœˆå,å®¶é‡Œçš„å°æœ‹å‹å‡ºç”Ÿäº†,æ˜¯ä¸ªçš®å¤¹å…‹,å°æœ‹å‹å‡ºç”Ÿæ—¶å¥½èƒ–,ä¹Ÿè®¸å’Œæˆ‘å°æ—¶å€™å·®ä¸å¤š,å°å®¶ä¼™å¾ˆæ´»æ³¼,æˆ‘å®¶é‚£ä½åšæŒåœ¨è€å®¶ç”Ÿ.è¿èµ·åå­—éƒ½æ˜¯è€å©†å®¶çš„ä¸¤ä½èµ„æ·±åŒ»å­¦åšå£«ç›¸äº’äº¤æ¢æ„è§å†³å®šçš„.é—æ†¾çš„è€çˆ¸æ²¡æœ‰çœ‹åˆ°.

å‰©ä¸‹çš„ä»»åŠ¡ä¹Ÿè®¸å°±æ˜¯é™ªç€ä»–å¥åº·æˆé•¿,ä¸€èµ·è·Ÿæˆ‘å­¦ä¹ è‹±è¯­.  
è¿™ä½å°æœ‹å‹çš„åˆ°æ¥è®©æˆ‘æ„æƒ³ä¸åˆ°å®¶é‡Œäº²æˆšéå¸¸å–œæ¬¢,è€å©†å®¶äº²æˆšä»è€åˆ°å°,æ¯å¤©éƒ½é™ªç€å·¦å³.

#### å·¥ä½œå±…ä½è¯

åœ¨TMEè¿™ä¸€å¹´å¤šé‡Œ,æˆ‘æˆåŠŸçš„æ‹¿åˆ°äº†å¤±å»å¾ˆä¹…çš„å·¥ä½œå±…ä½è¯,åœ¨åŒ—äº¬ä¹°æˆ¿ã€æ‘‡è½¦ç‰Œå†ä¹Ÿä¸ç”¨5å¹´ç¤¾ä¿äº†,ä¸‹è¯çš„ç¬¬ä¸€æ—¶é—´ç»™å°æœ‹å‹åŠç†åŒ»ä¿å¡"ä¸€è€ä¸€å°",ç„¶åæ‘‡å·èµ„æ ¼ç”³è¯·.

æ²¡æƒ³åˆ°å°æœ‹å‹æ‰å‡ºç”Ÿå‡ ä¸ªæœˆå°±æ‹¥æœ‰äº†æˆ‘ä»¬å‚åŠ å·¥ä½œæ‰æœ‰çš„ç¤¾ä¿å¡, åœ¨åŒ»ç–—æ–¹é¢ä½œä¸ºä¸€ä¸ªçº³ç¨äººæˆ‘äº«å—åˆ°äº†æˆ‘è¯¥æœ‰çš„ç¦åˆ©.

#### å…±äº§æˆ¿

æœ‰äº†å·¥ä½œå±…ä½è¯ç¬¬ä¸€æ—¶é—´å®‰æ’ä¸ŠåŒ—äº¬çš„å…±äº§æˆ¿, åŒ—äº¬çš„å…¬äº§æˆ¿æ˜¯æˆ‘ç­‰å”¯ä¸€æœ‰å¯èƒ½æ€§ä¸Šè½¦çš„æˆ¿å­,æˆ·å‹å’Œé¢ç§¯éƒ½éœ€è¦åšç›¸åº”çš„å–èˆ,ç”šè‡³åç»­çš„å–æˆ¿å’Œå‡ºç§Ÿ.  
![](/assets/images/20231231FinalSummary/gongchanfang1.webp)  
![](/assets/images/20231231FinalSummary/gongchanfang2.webp)  
è¿™ä¸ªå…±äº§æˆ¿å¯¹è´­ä¹°çš„è´­æˆ¿è€…è¦æ±‚éå¸¸è‹›åˆ»,ä¸æ˜¯æœ‰é’±å°±è¡Œ,ä½ å¾—ä»æœªåœ¨åŒ—äº¬æœ‰è¿‡ä»»ä½•æˆ¿å±‹ä½å®…äº¤æ˜“è®°å½•,å•èº«äººå£«è¿˜å¾—30å‘¨å²ä»¥ä¸Š,è‡ªä»åŒ—äº¬è§£å¼€é™æˆ¿ä¸é™è´·,è¿™å‡ å¤©æœ‰å‡ºæ¥ä¸ªé™ä½é¦–ä»˜æ¯”ä¾‹åˆ°30%çš„æ”¿ç­–å,ä¹°æˆ¿è€…å¯èƒ½ä¼šå¤šé‚£ä¹ˆä¸€ç‚¹è‡ªä¿¡, éäº¬ç±ä¹°å…±äº§æˆ¿è¿˜åˆ†å¥½å‡ ç»„, ä¸»è¦æ˜¯çœ‹ç”³è´­äººæ•°å’Œä¾›åº”å¥—æ•°. æ€»ä¹‹ä¸€å †æ¡æ¡æ¡†æ¡†å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥å‚è€ƒ[å¤§å…´åŒºäº¦ç”Ÿæ‚¦å°åŒºå…±æœ‰äº§æƒä½æˆ¿é¡¹ç›®ç”³è´­ç™»è®°å…¬å‘Š](https://www.bjdx.gov.cn/bjsdxqrmzf/zwxx/ztfw/zfbzztfw/tzgg3442/2101376/index.html)çœ‹çœ‹è¿™ä¸ªå…±äº§æˆ¿åœ¨åŒ—äº¬å’‹å›äº‹. åŸºæœ¬å¤§æ¦‚ç‡å¤–åœ°éäº¬ç±ä¹°æˆ¿é™åˆ¶ äº”å¹´è¿ç»­ç¤¾ä¿ä¹‹ç±»çš„ã€å·¥ä½œåœ°ç‚¹ã€ç¤¾ä¿ç¼´çº³åŒºåŸŸã€æ˜¯å¦æ˜¯åŒºå¼•è¿›äººæ‰ä¹‹ç±»çš„äººä¼˜å…ˆç»„.åƒæˆ‘è¿™ç§ç¤¾ä¿åœ¨æµ·æ·€åŒºåªèƒ½æ²¦ä¸ºéäº¬ç±æœ€åä¸€ç»„é€‰æˆ¿, å¥½æˆ¿å­å¾—å…ˆå¯ç€åŒ—äº¬äººã€å’Œä¾›åº”åœ°å—çš„åŒº ç¤¾ä¿äººç¾¤, åŸå…­åŒºåŸºæœ¬å°±æ˜¯å‡‘çƒ­é—¹. 

é€šè¿‡ä¸€ä¸ªå…±äº§æˆ¿æˆ‘å‘ç°ä¸¤ä¸ªäº‹æƒ…:

* åŒ—äº¬å„ä¸ªåŒºä¹‹é—´ä¹Ÿæœ‰åœ°åŸŸçš„æ­§è§†,æ¯”å¦‚å¤§å…´åœ°å—å¿…é¡»åœ¨å¤§å…´ç¼´çº³ç¤¾ä¿çš„äººç¾¤ç¬¬ä¸€ç»„é€‰æˆ¿æ‘‡å·ä¼˜å…ˆ.å…¶å®ƒåŒºåŸºæœ¬æ²¡å•¥æœºä¼šçœ‹çƒ­é—¹
* æœ‰åŒ—äº¬äººçš„åœ°æ–¹åŸºæœ¬å°±ä¼šè¢«æ”¿ç­–å€¾æ–œ,é‚£äº›ä¸ºé¦–éƒ½äº¤ç¨åšè´¡çŒ®çš„äººæ²¡æœ‰å¾—åˆ°ä»–ä»¬æœ€åŸºæœ¬çš„å°Šé‡.åŸºæœ¬éƒ½æ˜¯æœ‰åŒ—äº¬äººçš„åœ°æ–¹å¯¹å¤–åœ°äººè€Œè¨€å°±æ²¡æœ‰å…¬å¹³å¯è¨€

è¿™ä¸ªå…±äº§æˆ¿æŠŠä»¥ä¸Šä¸¤æ¡ä½“ç°çš„æ·‹æ¼“å°½è‡´.è¿™ç§å±ˆè¾±çš„æ‰“å‡»ä¹Ÿè®¸æ˜¯æˆ‘ä»¬å¤§éƒ¨åˆ†äººä¸€ç”Ÿä¸­ä¸å¾—ä¸å“å°çš„`è‹¦æ¶©ç»å†`.å¸Œæœ›é‚£äº›å’Œæˆ‘ä¸€æ ·çš„äººèƒ½ä»æ¶ˆæ²‰ä¸­èµ°å‡ºæ¥ç»§ç»­æœŸå¾…è¿˜æœªå‡èµ·çš„å¤ªé˜³. æˆ‘å…¶å®éå¸¸å¸Œæœ›æŠŠåŒ—äº¬è¿˜ç»™åŒ—äº¬äºº,æˆ‘ä»¬è‡ªå·±çš„å®¶ä¹¡ä½†å‡¡æœ‰ä¸€ç‚¹ç‚¹å‘å±•çš„æœºä¼šæˆ‘ä»¬éƒ½ä¸ä¼šè‹Ÿä¸”åœ¨åŒ—äº¬çš„åœŸåœ°ä¸Šè·ŸåŒ—äº¬äººæŠ¢æˆ¿å­.ä»€ä¹ˆGDPå•Šã€CPIå•Š éƒ½é åŒ—äº¬äººå°±å¥½äº†.å¤–åœ°äººç»™è‡ªå·±çš„å®¶ä¹¡è´¡çŒ®æ¶ˆè´¹å’ŒGDPå°±å¥½.åˆ°æ—¶å€™å¤–åœ°åŒºåŸŸä¹ŸæåƒåŒ—äº¬è¿™æ ·çš„æ”¿ç­–,ä¹°å…±äº§æˆ¿ å¤–åœ°äººæ‘‡å·æœ€åä¸€ç»„.æœ¬åœ°äººä¼˜å…ˆ.

è¿™æ˜¯åœ¨21ä¸–çºªçš„ä¸­å›½,ç¤¾ä¼šçš„æ–‡æ˜è¿˜æœªæ›¾åˆ°è¾¾äººäººå¹³ç­‰åœ°æ­¥,è¨€è®ºçš„è‡ªç”±è¢«æ‰“å‹çš„åªå‰©å–˜æ¯çš„å£°å“. è¯´åˆ°è¿™å¤§å®¶åº”è¯¥ä¹Ÿå°±æ˜ç™½äº†,å¾ˆæœ‰ä¸­äº§æœ‰é’±äº†ä¸ºå•¥éƒ½å»äº†åˆ«çš„å›½å®¶,æ–°åŠ å¡äº†ï¼ŒåŠ æ‹¿å¤§ã€æ¾³æ´²ä¹‹ç±»çš„äº†. å› ä¸ºå…¬æ°‘æ²¡æœ‰è¢«æˆäºˆå¹³ç­‰çš„æƒåŠ›.æ²¡æœ‰å¹³ç­‰çš„äººæƒå’Œè¨€è®ºè‡ªç”±ã€åªæœ‰æ‰“å‹ã€æ”¿ç­–å€¾æ–œã€å˜ç›¸è½¬ç§»ç¦åˆ©ç»™æœ¬åœ°äºº,ä¸‰å¹´çš„å£ç½©è®©å¤§å®¶é€æ¸è®¤è¯†åˆ°äº†,æˆ‘ä»¬çš„è¿™ä¸ªå›½åº¦è¿˜å­˜åœ¨å¾ˆå¤šç¤¾ä¼šæ»åçš„æœåŠ¡,å·²ç»ä¸¥é‡è·Ÿä¸ä¸Šæ—¶ä»£å‘å±•çš„è„šæ­¥.

å…±äº§æˆ¿åœ¨æœ¬æ–‡å‘è¡¨æ—¶ä»åœ¨æ‘‡å·é€‰æˆ¿ä¸­,æˆ‘åŸºæœ¬ä¸æŠ±å¸Œæœ›,å°±å‡‘ä¸ªçƒ­é—¹æ„Ÿå—ä¸€ä¸‹æµç¨‹,ä»€ä¹ˆæ—¶å€™åŒ—äº¬äººä¸åšæ¥ç›˜ä¾ äº†æˆ‘ä¹Ÿè®¸è¿˜èƒ½æœ‰æœºä¼šä¸Šè½¦.

é€šè¿‡æ­¤æ¬¡ä¹°å…±äº§æˆ¿çš„ç»å†è®©æˆ‘æ·±åˆ»çš„é¢†æ‚Ÿåˆ°äº†ä¸€ä»¶äº‹,é¦–éƒ½æ¸æ¸åœ°ä¼šåˆ†ä¸ºå¯ŒäººåŒºå’Œç©·äººåŒº,è€ŒåŸå¸‚æ›´æ„¿æ„å¸çº³é«˜å­¦å†é«˜æ”¶å…¥çš„å¯Œäºº,æé«˜æˆ¿ä»·å’Œä¸€äº›é—¨æ§›åªä¸ºè®©è¿™äº›äººä¸ºåŸå¸‚è´¡çŒ®æ›´å¤š,è€Œå‰”é™¤æ— æ³•ç»™ä¸æ›´å¤šè´¡çŒ®çš„ç©·äºº,å¯Œäººä¼šæ‹¥æœ‰æ›´å¥½çš„æ•™è‚²ç¯å¢ƒå’Œç”Ÿæ´»ç¯å¢ƒ,åœ¨åŸå¸‚å½¢æˆå„æ–­å’Œèµ„æœ¬,äº«å—æ›´å¤šèµ„æº,è€Œæ™®é€šæ— æ³•ç«‹è¶³çš„äººä¼šæ…¢æ…¢æ·˜æ±°å›å®¶ä¹¡,å›åˆ°å®¶ä¹¡å¯¹å½“åœ°æ”¿åºœçš„è´¢æ”¿å’Œå…»è€ä¼šé€ æˆå‹åŠ›å’Œè´Ÿæ‹…,å°åŸå¸‚é‡Œä¸€å®¶äººè¾›è‹¦åŸ¹å…»çš„é«˜æç”Ÿ,ä¼šå»å‘è¾¾åŸå¸‚å’Œæ›´å¥½çš„å›½å®¶,å®¶ä¹¡å› ä¸ºæ²¡æœ‰æ›´å¥½çš„èµ„æºç•™ä½äººæ‰,è€Œå‘å±•ä¸èµ·æ¥,å°åŸå¸‚å‘å±•è¶Šæ¥è¶Šä¸å¥½,å¤§åŸå¸‚è¶Šæ¥è¶Šå¥½,å½¢æˆæ¶æ€§å¾ªç¯,é¦–éƒ½é€šè¿‡ç¦åˆ©å¸å¼•äº†å…¨ä¸­å›½çš„å¯Œäººå’Œæœ‰çŸ¥è¯†çš„äººæ¥æ­¤,å½¢æˆäº†å„æ–­å’Œç¹è£,å…¨å›½å„åœ°çš„äººæ‰éƒ½ä¾›åº”åˆ°äº†é¦–éƒ½,åŸå¸‚çš„é“¶è¡Œ80%çš„è´¢åŠ¡é›†ä¸­åœ¨ä¸åˆ°5%çš„äººæ‰‹ä¸­,å¤§åŸå¸‚å½¢æˆç‰¢å›ºçš„é˜¶å±‚,å æ®ä¼˜ç§€çš„æ–‡åŒ–èµ„æºå’Œå¤§é‡çš„è´¢å¯Œ,è€Œå…¶å®ƒå°åŸå¸‚æˆ–è€…å°åŸé•‡æœ€ç»ˆæˆäº†å¤§åŸå¸‚çš„é™ªè‘¬, åŒ—äº¬çš„æŠ¢æˆ¿ç»å†è®©æˆ‘æ˜ç™½,ä¸€ä¸ªåŸå¸‚çš„ç¹è£æ˜¯å¸çº³äº†è®¸å¤šä¸åŒçš„äººç¾¤,ä»–ä»¬æ¥è‡ªå¤©å—æµ·åŒ—,ä¸ºè¿™ä¸ªåŸå¸‚å»ºè®¾å’Œæ”«å–è´¢å¯Œ, å½“åŸå¸‚å¤±å»å…¬å¹³, å½¢æˆé˜¶å±‚å’Œå„æ–­, è‚†æ„æ„šå¼„å’Œå æ®ä»–äººçš„æƒåˆ©,æœ€ç»ˆä¼šå¾—åˆ°æŠ¥åº”.å³ä½¿åŒ—äº¬æˆä¸ºäº†å›½é™…åŒ–çš„å¤§éƒ½å¸‚,ä½†æ—è¾¹å®‰é™è‹å‡‰çš„å…¶å®ƒçœä»½åœŸåœ°ä¸Š,ä¸€ç›´åœ¨è§è¯è€…è¿™é‡Œæ›¾ç»å‘ç”Ÿè¿‡çš„ä¸€åˆ‡,æˆ‘çœŸçš„å¸Œæœ›åŒ—äº¬è¿™åº§ç‰¹å¤§åŸå¸‚èƒ½ç»™äºˆè®¸å¤šå¥‹æ–—åœ¨åŸå¸‚çš„äººä»¬æ›´å¤šçš„æ¸©æš–å’Œç«‹è¶³ä¹‹åœ°,ä¸€èµ·äº«å—åŸå¸‚å‘å±•çš„æˆæœ, åˆ›é€ ä¸€ä¸ªå…¬å¹³çš„ç°ä»£æ–‡æ˜,å–„å¾…æˆ‘ä»¬è¿™äº›åŒ—æ¼‚, å› ä¸ºè¿™äº›äººæ˜¯ç±ç±æ— åçš„å¥‹æ–—è€…,è¿™äº›äººè±¡å¾ç€æ— æ•°çš„æ™®é€šäºº,ä¸è¦è®©æˆ‘ä»¬è¿™äº›äººåšäº†è´¡çŒ®åè¢«èµ¶èµ°å˜å¾—äº†å´æ— ç—•.

### åŠªåŠ›çš„å·¥ä½œ

![](/assets/images/20231231FinalSummary/work.webp)  

æœ€è¿‘è¿™ä¸€å¹´åŠæ—¶é—´é‡Œ,å‡ ä¹éƒ½æ˜¯åœ¨è…¾è®¯éŸ³ä¹å¨±ä¹-é…·æˆ‘éŸ³ä¹å›¢é˜Ÿæ•ˆåŠ›å¹¶è‹Ÿæ´», å…¬å¸ä¹‹å‰åœ¨å›½å®¶ä¼šè®®ä¸­å¿ƒåŠå…¬, ä»Šå¹´7æœˆä»½æ¬åˆ°äº†ä¸œå››åæ¡,ä»4ç¯å¤–æ¬åˆ°äº†2ç¯é‡Œ,å¸¦æ¥æœ€ç›´æ¥çš„ç—›ç‚¹æ˜¯ä¸Šç­æ—¶é—´ä»30åˆ†é’Ÿæ‘©æ‰˜è½¦åˆ°1ä¸ªå°æ—¶åœ°é“çš„å·®è·,æœ€ä¸»è¦çš„æ˜¯æ‘©æ‰˜è½¦éª‘ä¸äº†äº†.å¾ˆå¿§ä¼¤,ä½†ä¹Ÿæœ‰å¥½å¤„,å¥½å¤„å°±æ˜¯æˆ‘æ¯å¤©åœ¨åœ°é“ä¸Šçš„æ—¶é—´å¤šäº†å°±æœ‰äº†å¾ˆå¤šæ—¶é—´å­¦ä¹ ,æ¯å¤©éƒ½åœ¨åœ°é“ä¸Šä¸‹ç­çš„æ—¶é—´å¤šæœ‰2ä¸ªå°æ—¶çš„å­¦ä¹ æ—¶é—´,å½“ç„¶æ¡ä»¶è‰°è‹¦ä¸€äº›,éœ€è¦äººæŒ¤äºº,ä¸€è·¯å‡ ä¹éƒ½æ˜¯ç«™ç€.

æœ‰æ—¶å€™æˆ‘éƒ½ä¸æƒ³è·Ÿè€å®¶çš„åŒå­¦ã€è€å¸ˆè¯´è¿™ä¸ª,ä½†æœ‰äº›äº‹æ€»éœ€è¦é¢å¯¹,ä¸è¯´äººå®¶ä¹Ÿæ‡‚,åªæ˜¯è¿™å‡ å¹´éšç€å·¥ä½œæœºä¼šçš„å‡å°‘,åœ°é“ä¸Šæœ‰å¾ˆå¤šäººæ‹¿èµ·æ¥ä¹¦æœ¬,æ‹¿èµ·äº†æ‰‹æœºçœ‹æ•™ç¨‹,æˆ‘çœŸçš„ä¸æ˜¯å±è¨€è€¸å¬,å½“ä½ æ¥åŒ—äº¬ååœ°é“å°±ä¼šæ„Ÿå—åˆ°äº†,åªæœ‰ä¸æ–­å­¦ä¹ æé«˜è®¤çŸ¥æ‰èƒ½æ›´å‡ºè‰²,å¤§éƒ¨åˆ†äººéƒ½åœ¨åŠªåŠ›,å¦‚æœè‡ªå·±æ­¢æ­¥ä¸å‰é‚£ä¸å°±æ˜¯æ··åƒç­‰æ­»å—?è¯´åˆ°è¿™ä¼šä¸ä¼šè§‰å¾—å¾ˆå·,è¿™ä¸ç®—å·è¿™æœ€å¤šæ˜¯æ¯ä¸ªäººéƒ½åˆç†çš„åˆ©ç”¨ä¸šä½™æ—¶é—´ç»™è‡ªå·±å……ç”µè€Œå·².

å›¢é˜Ÿæœ€è¿‘è¢«è£å‘˜æ•´èµ°äº†ä¸¤ä¸ªäºº, å·¥ä½œä¸Šå¾ˆå¤šåŒäº‹éƒ½åœ¨è¸©åˆ¹è½¦,æˆ‘æœ‰æ—¶å€™è¸©æ²¹é—¨,æœ‰æ—¶å€™è¸©åˆ¹è½¦, æœ‰æ—¶å€™çš„æ„Ÿå—æ˜¯,è¿™åªæ˜¯ä¸€ä»½å·¥ä½œ,åˆ«æƒ³å¤ªå¤š,å¯¹äºä¸€ä¸ªå¼ºè¿«ç—‡ç¥ç»è´¨çš„ç¨‹åºå‘˜,æ¸æ¸åœ°å­¦ä¼šäº†å¦¥åå’Œå®‰é™,å¯¹äºå…¬å¸çš„å„ç§é™æœ¬å¢æ•ˆæ‰‹æ®µæŠ˜ç£¨çš„å‘˜å·¥å·²ç»æ²¡æœ‰ä»€ä¹ˆå¿ƒæƒ…åŠªåŠ›å·¥ä½œ, æ„Ÿè§‰çŠ¶æ€å°±åƒæ˜¯ ç­‰ç€è¢«è£,æ‹¿äº†å¤§ç¤¼åŒ…èµ°äººçš„æ„Ÿå—.å·²ç»å¯¹è‡ªå·±æ“…é•¿çš„å¼€å‘å¤±å»äº†å¤ªå¤šä¿¡å¿ƒ.

ä¸è¿‡æˆ‘è¿˜æ˜¯èƒ½åœ¨ä¸€äº›æŠ€æœ¯çš„å¼€å‘ä¸Šåšä¸€äº›æŠ€æœ¯æ²‰æ·€.ä¿ç•™æ›¾ç»é‚£ä»½å¯¹æŠ€æœ¯çš„çƒ­çˆ±å’Œå½±å“åŠ›çš„æå‡.

10æœˆä»½å¼€å‘çš„å°ç»„ä»¶,æˆ‘å‘è…¾è®¯éŸ³ä¹æŠ€æœ¯å›¢é˜Ÿçš„å…¬ä¼—å·æŠ•äº†ä¸€ç¯‡æ–‡ç« ,ä»‹ç»ä¸€äº›å¼€å‘ç»†èŠ‚
![](/assets/images/20231231FinalSummary/article.webp) 

å½“å†…éƒ¨å®¡æ ¸ç¨¿ä»¶çš„æ—¶å€™è¢«ç æ‰çš„åªå‰©ä¸‹ä¸€äº›æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡çš„ç»†èŠ‚,æ ¸å¿ƒçš„å†…å®¹ä¸å…è®¸è¢«publicå‡ºæ¥,ä¸»è¦æ˜¯ä¸ºäº†ä¿æŒä¸šç•Œçš„é¢†å…ˆæ€§.æˆ‘å¸Œæœ›åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘å¯¹æ–‡ç« æŠ•ç¨¿è¢«åˆ å‡å¼•å‘çš„æ€è€ƒ:

æœ‰æ—¶å€™æˆ‘è§‰å¾—æˆä¸ºTMEçš„ä¸€åiOSå¼€å‘è€…å¾ˆæƒ­æ„§ï¼Œå®ƒè®©æˆ‘è§‰å¾—è‡ªå·±å¾ˆè‡ªç§ï¼Œæˆ‘ä»¬ä¸€å‘³çš„ä»äº’è”ç½‘æ‘„å…¥çŸ¥è¯†çš„åŒæ—¶å´ä»æœªå‘å¤–è¾“å‡ºæœ‰ä»·å€¼çš„å†…å®¹ï¼Œæ²¡æœ‰å¼€æºç²¾ç¥ï¼Œç„¶è€Œå‡ºç°è¿™ç§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯åšç‚¹æœ‰ä»·å€¼çš„ä¸œè¥¿ä¸å…è®¸å¯¹å¤–public,å°±æ˜¯ä¸ºäº†ä¿è¯æ­¤æŠ€æœ¯åœ¨ä¸šç•Œçš„é¢†å…ˆæ€§ï¼Œå½“ç„¶è¿™ç§æŠ€æœ¯ä¹Ÿä»…é™äºä¸€äº›æ²¡æœ‰å¤ªé«˜æŠ€æœ¯å«é‡çš„å†…å®¹ï¼Œè¿™ç§å°é—­çš„é¢†å…ˆæ€§è®©æˆ‘è§‰å¾—åˆå¯ç¬‘åˆå¯æ‚²ï¼Œå¯ç¬‘çš„æ˜¯æˆ‘ä»¬æ€»åœ¨å¼ºè°ƒä¸€äº›æ²¡æœ‰æŠ€æœ¯å«é‡çš„æŠ€å·§ç»†èŠ‚çš„é¢†å…ˆï¼Œå¯æ‚²çš„æ˜¯æˆ‘ä»¬éƒ½åœ¨é—­æºçš„ç¯å¢ƒä¸­é—­é—¨é€ è½¦å¼çš„æˆé•¿ï¼Œæ‰ä¼šé€ æˆä»Šå¤©çš„è¡Œä¸šå†…å·ï¼Œä»æœªåœ¨åŸºç¡€ç§‘å­¦ä¸Šçš„é¢†å…ˆã€‚æˆ‘ä»¬å…¶å®å†…å¿ƒéƒ½å¾ˆæ¸…æ¥šæˆ‘ä»¬æ˜¯è¸©åœ¨å¼€æºä»£ç è¿™ä½å·¨äººçš„è‚©è†€ä¸Šæ‰æœ‰äº†ä»Šå¤©ï¼Œç„¶è€Œæˆ‘ä»¬ä¸å¾—ä¸å¦¥åäºä»Šå¤©çš„å°±ä¸šç¯å¢ƒæ‰€é€ æˆçš„ç°çŠ¶ï¼Œå¼€æºç­‰äºæ”¾å¼ƒé¢†å…ˆæ€§ï¼Œç­‰äºä¸å¬æŒ‡æŒ¥ï¼Œç­‰äºè¢«è£å‘˜ã€‚

æ­¤åˆ»æˆ‘æ˜ç™½äº†æˆ‘åšä¸åˆ°æˆä¸ºå…·æœ‰å¼€æºç²¾ç¥çš„å¼€å‘è€…çš„æœ€å¤§æ•Œäººæ˜¯"è´¢å¯Œçš„è´«ç©·",é€šä¿—ç‚¹å°±æ˜¯å·®é’±å„¿ã€‚æœ¬è´¨ä¸Šè¿˜æ˜¯å› ä¸ºè´«ç©·è¿«ä½¿æˆ‘ä»¬æ²¡æœ‰é€‰æ‹©çš„æƒåˆ©ï¼Œæ¢å¥è¯è¯´æˆ‘ä»¬ç¼ºä¹ç›¸å…³çš„çŸ¥è¯†å»è§£å†³è‡ªå·±è¢«è´«ç©·å—é™çš„é—®é¢˜ã€‚  
æ‰€ä»¥æˆ‘è¿˜æ˜¯éœ€è¦é€šè¿‡å­¦ä¹ æå‡è‡ªå·±çš„çŸ¥è¯†æ°´å¹³å±‚æ¬¡å’Œè®¤çŸ¥,åœ¨æœªæ¥è§£å†³è´¢å¯Œè‡ªç”±çš„é—®é¢˜ã€‚

2023å¹´æˆ‘è‚¤æµ…çš„è®¤ä¸ºå·¥ä½œçš„åŸºæœ¬å†…å®¹æ˜¯ç”¨è‡ªå·±ä½å»‰çš„æŠ€æœ¯æ¢å–ç”Ÿæ´»çš„åŸºæœ¬ä¿éšœ.æ²¡æœ‰å•¥å¥½è¯´çš„,å°±æ˜¯å„ç§èŒ«ç„¶çš„ä¸çŸ¥æ‰€æª.æ²¡æœ‰èŒä¸šè§„åˆ’,æ²¡æœ‰è¿œå¤§çš„ç†æƒ³,åªæœ‰åŸ‹å¤´è‹¦å¹²çš„åšéŸ§ä¸æ‹”.


### ä¸å–„äºå­¦ä¹ 

2023å¹´å­¦ä¹ çš„è¯¾ç¨‹æœ‰:
* flutterå¼€å‘æ•™ç¨‹
* SwiftUIå¼€å‘æ•™ç¨‹
* é¸¿è’™OS 4.0å¼€å‘æ•™ç¨‹

å¹´åˆçš„æ—¶å€™ä¸ºäº†æ‹¯æ•‘å…¬å¸å³å°†å¢é€Ÿæ”¾ç¼“çš„app æ³¢ç‚¹éŸ³ä¹,æˆ‘è¿™è¾¹è¢«æŠ½è°ƒè¿‡å»æ”¯æ´flutterå¼€å‘,ä¸»è¦å·¥ä½œå°±æ˜¯è¿ç§»é›†å›¢æä¾›çš„ç›´æ’­SDK,å’Œflutteräº¤äº’,ç¼ºåŸºå»ºå°±æåŸºå»º,ç¼ºæŒç»­é›†æˆå°±ææŒç»­é›†æˆ,ç¼ºè·³è½¬åº“å°±å¼€å‘é›†æˆæ··åˆå¯¼èˆªæ ˆ.è¶ç€è¿™ä¸ªæ—¶é—´æˆ‘ä¸šä½™çš„å‘¨æœ«éƒ½åœ¨å­¦ä¹ flutter,å¤§æ¦‚ç”¨äº†6ä¸ªå‘¨æœ«å°±æŠŠæ•´å¥—æ•™ç¨‹çœ‹å®Œäº†,ä¹Ÿæ˜ç™½å’‹å›äº‹äº†,å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯ç»™æ³¢ç‚¹å¹²æ´»æflutter.

![](/assets/images/20231231FinalSummary/flutter.webp)   
ä¸Šé¢æ˜¯Bç«™ä¸Šçš„flutteræ•™ç¨‹åˆ†äº«ç»™å¤§å®¶[æœ€æ–°Dartã€Flutteræ•™ç¨‹-å¸¦ä½ è¿›å…¥Flutterçš„ä¸–ç•Œ](https://www.bilibili.com/video/BV1KE41117XV?p=1)

å­¦ä¹ äº†ä¸€æ®µæ—¶é—´å‘ç°,å®ƒçš„æ¡†æ¶å¤ªå¥½äº†,åŸºæœ¬éƒ½æŠŠæ‰€æœ‰çš„å·¥ä½œéƒ½åšäº†.

ä¸‹åŠå¹´ æ¥åˆ°ä»»åŠ¡,å¼€å‘iOS17å°ç»„ä»¶,è€Œä¸”è¿™å°ç»„ä»¶è¿˜å¿…é¡»ç”¨SwiftUI.ä»å­¦ä¹ å®ŒFlutterç«‹é©¬ç”¨è‡³å°‘10å‡ ä¸ªå‘¨æœ«çš„æ—¶é—´å­¦ä¹ SwiftUI.
![](/assets/images/20231231FinalSummary/swiftUI.webp)   

[SwiftUIå¼€å‘æ•™ç¨‹](https://www.bilibili.com/video/BV1pW4y1j7MC/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)

è¿™æ˜¯ä¸€ä¸ªå°æ¹¾çš„ç¾å¥³æ¨å‡ºçš„æ•™ç¨‹,æ„Ÿè§‰åƒæ˜¯æ¨å‡ºäº†å¤§åŠå¹´,è¿˜å‰©ä½™ä¸€äº›SwiftUIçš„æ–°å†…å®¹æ²¡æœ‰æåŠ,æ•´ä½“æ€è·¯æ¯”è¾ƒæ¸…æ™°,åªæ˜¯å¥¹è®²è¯¾çš„é£æ ¼æ¯”è¾ƒä¸Šè¹¿ä¸‹è·³,å­¦ä¹ å‰è¦æœ‰æ€æƒ³å‡†å¤‡.

æœ€åç”¨äº†è¿™ä¸ªSwiftUIå¼€å‘äº†é…·æˆ‘éŸ³ä¹çš„å°ç»„ä»¶,è¿˜ç®—æ˜¯ä»å­¦ä¹ è½åœ°åˆ°äº†ä»£ç ,å®Œæˆäº†ä¸€æ¬¡æ ‡å¿—æ€§çš„è·¨è¶Š.

è¿˜æœ‰é¸¿è’™å¼€å‘  
[HarmonyOS4.0æ•™ç¨‹](https://www.bilibili.com/video/BV1pb4y1g75m/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)
[é¸¿è’™HarmonyOSè®²æ˜ç™½äº†ï¼ˆé¸¿è’™4ï¼‰å¼€å‘åº”ç”¨ä»å…¥é—¨](https://www.bilibili.com/video/BV1dw411b7Jm/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)
é¸¿è’™è¿™é‡Œåªæ˜¯ä¸€äº›åŸºç¡€

å®˜æ–¹èµ„æ–™:
ArkUIå®æˆ˜ æ–‡æ¡£ [https://www.arkui.club/](https://www.arkui.club/)
å¼€å‘è€…æŒ‡å—ï¼š [https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/start-overview-0000001478061421-V3?catalogVersion=V3](https://developer.harmonyos.com/cn/docs/documentation/doc-guides-V3/start-overview-0000001478061421-V3?catalogVersion=V3)

å®˜æ–¹å†…éƒ¨æä¾›æœªå‘å¸ƒçš„[SDK IDEä»¥åŠæ¨¡æ‹Ÿå™¨ ](https://developer.harmonyos.com/deveco-developer-suite/enabling/kit?currentPage=1&pageSize=100)

å­¦ä¹ é¸¿è’™å­¦äº†æœ‰ä¸€æ®µæ—¶é—´äº†,æˆ‘çš„ç†è§£å°±æ˜¯å‹¤åŠ ç»ƒä¹ ,æŒæ¡å¤§æ¦‚æ¡†æ¶å’Œåº•å±‚æœåŠ¡å°±å¥½.ä¸€äº›å…¶å®ƒçš„æ·±å…¥å†…å®¹è¾¹æˆ˜æ–—è¾¹å­¦ä¹ å°±å¥½.

ç°åœ¨çš„Bç«™å¤ªå¥½äº†,èƒ½å­¦ä¹ å„ç§è¯¾ç¨‹è¿˜æ²¡æœ‰å¹¿å‘Šè¿˜å…è´¹.çœŸçš„è‰¯å¿ƒ.è¿˜è®°å¾—å»å¹´å­¦ä¹ å®Œæˆswiftçš„è¯¾ç¨‹,æ„Ÿè§‰ä¹Ÿæ²¡ä»€ä¹ˆ,ä½†æ˜¯swiftå’ŒSwiftUIæ¯å¹´å‘å¸ƒä¸€ç‰ˆæˆ‘å°±å¾—å­¦ä¹ ä¸€é,æ¯æ¬¡çš„æ”¹åŠ¨å¤ªå¤šäº†,æ ¹æœ¬è·Ÿä¸è¿‡æ¥.

å°±è¿™æ ·å­¦ä¹ çš„æ—¶é—´ç»å¸¸è¢«æ‰“ä¹±èŠ‚å¥,ç”±äºç»å¸¸è¢«æŠ¢å å¼è°ƒåº¦å­¦ä¹ ä»»åŠ¡,å¯¼è‡´æ²¡èƒ½æŒç»­ä¸æ–­çš„æŠŠè¿™æœ¬ä¹¦çœ‹å®Œ.è¿™æ˜¯ç›®å‰çš„è¿›åº¦  
![](/assets/images/20231231FinalSummary/cxxprmerplus.webp) 
æˆ‘è§£é‡Šä¸€ä¸‹å•¥æ˜¯`æŠ¢å å¼è°ƒåº¦`,å°±æ˜¯åŸè®¡åˆ’æˆ‘æ˜¯æŒ‰ç…§æ¯å¤©çš„ä¸Šä¸‹ç­æ—¶é—´çœ‹è¿™æœ¬ä¹¦,ä½†æ˜¯å¾€å¾€éƒ½æ˜¯çœ‹åˆ°ä¸€åŠæˆ–è€…å…¶ä»–è¿›åº¦è¿‡ç¨‹ä¸­è¢«ä¸€äº›æ–°æŠ€æœ¯ä¾‹å¦‚é¸¿è’™å¼€å‘æ•™ç¨‹çš„è§†é¢‘æ‰“æ–­,å¯¼è‡´æˆ‘åªèƒ½å…ˆæŠŠå·¥ä½œç›¸å…³çš„æŠ€æœ¯å­¦ä¹ ä»»åŠ¡å…ˆå­¦ä¹ å®Œ,å†æŠ½æ—¶é—´å­¦ä¹ å‰©ä½™çš„ä»»åŠ¡.å°±è¿™æ ·ååå¤å¤è¢«å„ç§æŠ¢å å¼è°ƒåº¦å ç”¨äº†å¾ˆå¤šä¸šä½™æ—¶é—´.  
å¦‚æœä½ å’Œæˆ‘ä¸€æ ·,é‚£ä¹ˆæ­å–œä½ ,ç›®å‰æˆ‘æ²¡æœ‰æ‰¾åˆ°æœ€ä¼˜è§£å»è§£å†³ï¼Œæ—¶é—´å¦‚ä½•è¢«æŠ¢å å¼è°ƒåº¦,æˆ‘åªèƒ½è¯´è´¢å¯Œè‡ªç”±çš„æ—¶å€™æˆ‘ä¹Ÿè®¸ä¼šæœ‰.

ä¸€å †æ²¡æœ‰æ—¶é—´çœ‹çš„ä¹¦,å †èµ·æ¥éƒ½å¿«æœ‰PS5é«˜äº†å§!
![](/assets/images/20231231FinalSummary/books.gif)  

è¿™ä¸€å¹´æ„Ÿè§‰å¾ˆç´¯,å­¦ä¹ çš„ä¸œè¥¿è¶Šæ¥è¶Šå¤š,ä»flutteråˆ°SwiftUI,ä»SwiftUIåˆ°HarmonyOSç„¶åå†åˆ°ä¸€å †æ²¡æœ‰çœ‹å®Œçš„iBook.ä»¥åŠè‡ªå·±å–œæ¬¢çš„æ— äººæœºå¼€å‘æ–¹å‘éƒ½è¿˜æœªå¯åŠ¨å­¦ä¹ è®¡åˆ’. ä»äº‹è®¡ç®—æœºè¡Œä¸šæœ¬æ¥ä¹Ÿè®¸å°±éœ€è¦è¿™ä¹ˆç´¯.æ€»æœ‰ä¸€å †å­¦ä¹ ä¸å®Œçš„è¯¾ç¨‹ã€ä¹¦ç±ã€æ–‡ç« ã€æ•™ç¨‹ã€ç­‰ç­‰.

### è‚¤æµ…çš„çˆ±å¥½-å°çƒ  

![](/assets/images/20231231FinalSummary/cueball.webp)  
æœ€è¿‘è¿™ä¸€å¹´æ—¶é—´é‡Œ,å…¬å¸æœ‰ç¤¾å›¢æ´»åŠ¨,æˆ‘è·ŸåŒäº‹ä¸€èµ·é€æ¸çš„å­¦èµ·äº†å°çƒ,ç›´åˆ°ç°åœ¨æˆ‘è¿˜ä¸€ç›´ç»„ç»‡å…¬å¸çš„å°çƒæ´»åŠ¨.å°çƒæœ‰ä¸€ç§é­”åŠ›,èƒ½è®©æˆ‘è¿™ä¸ªæ²¡æœ‰ä»»ä½•ä¸šä½™çˆ±å¥½çš„äººçˆ±ä¸é‡Šæ‰‹,æˆ‘çš„çƒæŠ€ä¹Ÿæ—¥ç›Šå¢è¿›,æ¯æ¬¡çœ‹è§ç»¿è‰²å°å°¼çœ¼ç›å¾ˆèˆ’æœ,æ‹¿èµ·çƒæ†æ—¶ä¼šæŠŠå·¥ä½œå’Œç”Ÿæ´»ä¸Šçš„ä¸€äº›ä¸æ„‰å¿«é—å¿˜.

ä»¥å‰è‡ªå·±å¯¹å°çƒçš„ç†è§£åªèƒ½è¯´æµ®çš®æ½¦è‰,è¿™ä¸€å¹´é‡Œè‡ªå·±é€šè¿‡è§‚çœ‹Bç«™çš„å°çƒæ•™å­¦å’Œæ¯”èµ›é€æ¸å¯¹è¿™ä¸ªçƒä½“æ’å‡»è¿åŠ¨äº§ç”Ÿäº†æµ“åšçš„å…´è¶£, ä»é€€å°ã€å ä½ã€å…¥ä½ã€å§¿åŠ¿ã€æ¡æ†ã€ç„ç‚¹ã€è¿æ†ã€å‘åŠ›, ä¸‹æ†æ³•ã€é«˜ä¸­ä½æ†ã€å·¦å³æ—‹è½¬ã€å¤§ä¸­å°åŠ›çš„æŒæ§. äº”åˆ†ç‚¹ã€è·³çƒã€åŠ å¡è®©ç‚¹ã€æ¸…å°æ€è·¯ã€Kçƒã€ç­‰å…¨éƒ½ä¸€ä¸€å°è¯•å¹¶è®­ç»ƒ.
è¿™ä¸€å¹´åœ¨å°çƒé¢†åŸŸçš„å­¦ä¹ å’Œæ—¶é—´æŠ•å…¥éå¸¸å¤š,å½“ç„¶ä¹Ÿä»…é™äºä¸šä½™æ—¶é—´.

è¿™æœŸé—´ä¹Ÿé€æ¸äº†è§£äº†å¾ˆå¤šå°çƒæ˜æ˜Ÿä»¥åŠå™¨æå“ç‰Œ,ä»¥åŠè¿™é¡¹è¿åŠ¨çš„å‘å±•,ç›®å‰åªæœ‰ä¹”æ°åœ¨å¤§åŠ›æ¨è¿›å°çƒè¿™é¡¹è¿åŠ¨å‘å¥¥æ—åŒ¹å…‹èµ›äº‹è¿ˆè¿›,è¿™åŸºæœ¬å°±æ˜¯å›½æ°‘çº§çš„ä½“è‚²è¿åŠ¨.åœ¨å°çƒçš„ä¸–ç•Œé‡Œåªæœ‰å®åŠ›çš„æ¯”æ‹¼,æ²¡æœ‰å­¦å†çš„æ­§è§†.

åœ¨è¿‘å‡ å¹´çš„å‘å±•ä¸­,å°çƒé€æ¸æˆä¸ºäº†å¤§ä¼—ä¼‘é—²å¨±ä¹çš„è¿åŠ¨é¡¹ç›®ä¹‹ä¸€,è¿™é¡¹è¿åŠ¨ä¸åƒç¾½æ¯›çƒæˆ–è€…å…¶å®ƒè¿åŠ¨ç±»é¡¹ç›®é‚£ä¹ˆè€—è´¹ä½“åŠ›,ä½†æŒ‘æˆ˜éš¾åº¦å’Œè§‚èµæ€§éå¸¸åœ¨çº¿.

è¿™é‡Œæ¨èä¸€äº›Bç«™çš„å°çƒæ•™ç¨‹

å­¦ä¹ å°çƒå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ Bç«™å°çƒæ•™å­¦   

 *  [è°¢å¬è¾‰å°çƒæ•™å­¦](https://www.bilibili.com/video/BV1wX4y1a7m8/?spm_id_from=333.999.0.0)   
 * [çŸ³é‘« å°çƒæ•™å­¦](https://www.bilibili.com/video/BV1Vs4y1P7LF/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)
 *  [å¤©ç‹ä»£å‹‡ å°çƒæ•™å­¦](https://www.bilibili.com/video/BV1ep4y1G7gM/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)
 *  [åŠ é›·æ–¯Â·æ³¢èŒ¨å°çƒæ•™å­¦](https://www.bilibili.com/video/BV1wX4y1J7Dq/?spm_id_from=333.999.0.0&vd_source=9309f71afe97e633abeadc8407870e76)

è¿™é¡¹è¿åŠ¨ç»ˆå°†ä¼šæˆä¸ºä¸€é¡¹ä½“è‚²èµ›äº‹,åœ¨åŒ—äº¬æœ‰ä¸€äº›çƒé¦†æ˜¯æ— çƒŸçƒé¦†,å¤§å®¶å–œæ¬¢çš„è¯å¯ä»¥å°è¯•ä¸€ä¸‹.

æˆ‘è¯´è¯´æˆ‘ä¸ºå•¥èŠ±æ—¶é—´åœ¨è¿™ä¸Šè¾¹,è¿™å‡ å¹´å¤§å®¶è¿‡å¾—å¾ˆå‹æŠ‘,å¹´è½»äººå¤§éƒ¨åˆ†çœ‹ä¸åˆ°æœªæ¥çš„å¸Œæœ›,å¤§éƒ¨åˆ†äººé€‰æ‹©èººå¹³åŠæ—¶è¡Œä¹,è¿™ä¸ªè¿åŠ¨éå¸¸é€‚åˆåŠæ—¶è¡Œä¹,æ¶ˆè´¹è¿˜ç®—å¯ä»¥,å¤§ä¼—æ¶ˆè´¹å¾—èµ·,è¿˜ä¹è¶£å¾ˆå¤š.ä¹Ÿè®¸è¿™å°±æ˜¯å¹´è½»äººçš„è§‰é†’,å†…å·å·çš„æ®‹é…·,æˆ¿ä»·é«˜çš„ç¦»è°±,å‹¤åŠ³ä¸èƒ½è‡´å¯Œ,æœªæ¥æ²¡æœ‰å‡ºè·¯,æ—¢ç„¶äººç”Ÿè¿™èˆ¬è¾›è‹¦,åˆä¸ºä½•é£å°˜ä»†ä»†,ä¸å…¶å¥‹æ–—ä¸å¦‚èººå¹³.

æˆ‘æ˜¯è¿™æ ·çœ‹å¾…ç°åœ¨çš„è£å‘˜æ½®å’Œå†…å·èººå¹³æ²¡å‡ºè·¯çš„é—®é¢˜,å°±ä¸‰ä¸ªå­— `"éšå®ƒå»" `let it be, ä¸è¦ä¸ºè¿™äº›äº‹æƒ…è´¹ç¥ä¸Šå¿ƒ,å› ä¸ºå®ƒå®Œå…¨è¶…å‡ºäº†ä½ çš„èƒ½åŠ›,ä½ æ ¹æœ¬å½±å“ä¸äº†,æ— è®ºäº‹æƒ…å‘å±•åˆ°å“ªä¸€æ­¥,ä½ åªèƒ½æ¥å—,å°±ç®—ä½ æ„Ÿåˆ°ç—›è‹¦å’Œçƒ¦æ¼,éš¾é“ä¼šæ”¹å˜å±€é¢å—ï¼Ÿæˆ‘ä»¬çš„æ—¶é—´å¾ˆå®è´µ,ä¸è¦ç”¨äºé‚£äº›æ”¹å˜ä¸äº†çš„äº‹æƒ…,è€Œè¦ç”¨äºä½ èƒ½å¤Ÿæ”¹å˜çš„äº‹æƒ….å¹¶ä¸”è¿™å‡ å¹´çš„è£å‘˜å±äºå…¨è¡Œä¸šæ”¶ç¼©,ä¸æ˜¯å‘˜å·¥çš„é—®é¢˜,`è¡Œä¸šçš„é—®é¢˜è¶…å‡ºäº†ä½ ä¸ªäººçš„åŠªåŠ›`.å¦‚æœå…¬å¸æŠŠæ•´ä¸ªéƒ¨é—¨å’Œä¸šåŠ¡çº¿éƒ½ç äº†,é‡Œé¢æœ€å¥½çš„å‘˜å·¥ä¹Ÿä¸å¯é¿å…ä¼šå—åˆ°å½±å“.ä¸è¦ç°å¿ƒç„¦è™‘,æ›´ä¸è¦æ€€ç–‘è‡ªå·±,æ—¢ç„¶äº‹æƒ…å·²ç»å‘ç”Ÿäº†,ä½ æ‰€èƒ½åšçš„å°±æ˜¯éšå®ƒå»,åˆ«æŠŠæ—¶é—´ç”¨äºé•¿åçŸ­å¹ã€æ„¤ä¸–å«‰ä¿—ã€è€Œè¦ä¿æŒå­¦ä¹ ,ç£¨ç‚¼è‡ªå·±çš„æŠ€æœ¯,ç­‰åˆ°è¡Œä¸šå›æš–æ—¶,å°±ä¼šæœ‰å›æŠ¥,è¿™äº›è¡Œä¸šä¹‹æ‰€ä»¥ä¼šæ”¶ç¼©,å°±æ˜¯å› ä¸ºå‰æœŸçš„å¸‚åœºéœ€æ±‚æ—ºç››,æ‰©å¼ å¤ªå¿«,è¿™è¯´æ˜ä»–ä»¬çš„å¸‚åœºéœ€æ±‚æ˜¯çœŸå®å­˜åœ¨çš„,åªè¦å¸‚åœºéœ€æ±‚è¿˜åœ¨,å°±æœ‰å‘å±•ç©ºé—´,ä½ ç»ƒå¥½æœ¬é¢†,ä¸æ„å°†æ¥æ²¡æœ‰ç”¨æ­¦ä¹‹åœ°.

å°çƒè®©æˆ‘çš„ä¸šä½™æ—¶é—´ä¸åœ¨å­¤ç‹¬,ç»¿è‰²çš„å°å°¼èƒ½è®©æˆ‘ç–²åŠ³ä¸€å‘¨çš„çœ¼ç›å¾—åˆ°æ”¾æ¾.å…¶å®å°±æ˜¯ä¸€ç§èº«å¿ƒå¥åº·çš„è¿åŠ¨æ–¹å¼è€Œå·².æ¯”ä¸‹ç­å’ŒåŒäº‹æœ‹å‹ä¸€èµ·åƒåƒå–å–ä¼šæ›´æœ‰æ„æ€.

### è´¥å®¶çš„å¥½ç‰©

è¿™ä¸€å¹´éå¸¸æ·±åº¦ä½¿ç”¨PDDä¹°ä¸œè¥¿,è€Œä¸”éƒ½å¾ˆå®ç”¨,é™¤äº†å…¶å®ƒå¹³å°æ›´å…·æ€§ä»·æ¯”å¤–é¦–é€‰pdd,ç°åœ¨ä¹°ä¸œè¥¿å…»æˆäº†ä¸€ä¸ªä¹ æƒ¯æˆ‘æŠŠå®ƒç§°ä¸º`é›è´§`,å°±æ˜¯æˆ‘å¦‚æœå¾ˆæƒ³ä¹°ä¸€ä»¶å•†å“,æˆ‘å°±æŒ‰è€å¿ä½åŠä¸ªæœˆè§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªå•†å“ä»·æ ¼,å¦‚æœä»–è·Œäº†å°±ä¸‹æ‰‹,æ¶¨äº†å°±ä¸ä¹°,å•¥æ—¶å€™è·Œå•¥æ—¶å€™ä¹°,ç»è¿‡å‡ æ¬¡`é›è´§`æˆ‘å‘ç°pddä¹°è´µäº†æŠ•è¯‰å®˜æ–¹å®¢æœæŒ‡å®šèƒ½ç»™é€€,ç›´æ¥æŠ•è¯‰åˆ°åº•å°±å®Œäº‹äº†.

ä»Šå¹´è´¥å®¶çš„ä¸œè¥¿æ¯”è¾ƒå°‘,éšç€æ¶ˆè´¹é™çº§,è‡ªå·±ä¹°ç”Ÿæ´»ç”¨å“éƒ½å¾ˆå°‘äº†,ä¸‹é¢çš„æ˜¯çº¯ä¸šä½™çˆ±å¥½.

* å¨è”é€šNAS
* å°çƒæ†
* HomePod
* AppleWatch
* è‹¹æœè§¦æ‘¸æ¿
* PS5æ¸¸æˆå…‰ç›˜
* æ‘©æ‰˜è½¦å¤´ç›”
* æŒåŒ…
* æ˜¾ç¤ºå™¨æ€»æˆçº¿æ§ç‰ˆ
* åˆ¨ä¸å™¨


#### å¨è”é€šNAS  464C-8G

![](/assets/images/20231231FinalSummary/nas1.webp)  
![](/assets/images/20231231FinalSummary/nas2.webp)  
è¿™è£…å¤‡å¯ä»¥è¯´å­˜å‚¨ä¸€ç”Ÿçš„èµ„æ–™éƒ½å¤Ÿç”¨äº†å§. åŒ11å‰å¤•äº¬ä¸œç‰¹ä»·ä¿ƒé”€ ä¼šå‘˜ä»·1823ä¹°çš„.
ä¹°åˆ°æ‰‹åŠ äº†4å—4Tå¸Œæ·é…·ç‹¼Nasä¸“ç”¨ç¡¬ç›˜.ä¸»è¦æ˜¯å­˜å‚¨èµ„æ–™å’Œå­¦ä¹ çš„ä¸€äº›å†…å®¹.å¯ä»¥ç”¨è¿™ä¸ªæ¶è®¾gitæœåŠ¡å™¨,ç”¨è¿™ä¸ªå¼€è®¾ä¸ªäººåšå®¢ç½‘ç«™ä½œä¸ºäº‘å­˜å‚¨ç­‰ç­‰,è¿™ä¸ªä¹Ÿè®¸åªæœ‰å¼€å‘äººå‘˜æ‰æ‡‚å®ƒçš„ä½œç”¨,ä»¥åå†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ¢ç”µè„‘äº†,èµ„æ–™äº‘ç«¯æœ¬åœ°ä¼ åˆ°nasä¸Š,å…¶å®ƒç”µè„‘è½»æ¾è®¿é—®.

#### å°çƒæ†

![](/assets/images/20231231FinalSummary/cue.webp) 

è¿™ä¸ªå°çƒæ†å¯ä»¥è¯´1å€çš„ä»·é’±åŒå€çš„å¿«ä¹,æˆ‘é€‰çš„æ˜¯å‡ ç™¾å—é’±çš„æ‰‹å·¥æ†,ä¸æ˜¯å¾ˆå‡ºå,æ˜¯ä¸€ä¸ªå¹¿ä¸œå°å±±çš„å¾ˆå¤è€çš„æ‰‹å·¥æ†å“ç‰Œ.ç™½æ²™.ç”¨ç€è´¨æ„Ÿå’Œä½¿ç”¨ä½“éªŒéå¸¸å¥½.æˆ‘å¾ˆå–œæ¬¢è¿™åªçƒæ†.å®ƒé™ªä¼´æˆ‘æ‰“çƒçš„è¿‡ç¨‹ä¸­æœ‰å¾ˆå¤šè¿æ°”åŠ æŒ.


#### HomePod

![](/assets/images/20231231FinalSummary/homepod.webp)

åŒ12 é›è´§é›äº†å¥½å‡ ä¸ªæœˆ,è§‚å¯Ÿå®ƒçš„ä»·æ ¼ä½äºå¸¸è§„ä»·æ ¼åæœæ–­ä¸‹æ‰‹,éŸ³è´¨éå¸¸å¥½,å°±æ˜¯å»¶è¿Ÿå¤ªé«˜,æ²¡æœ‰è“ç‰™å»¶è¿Ÿä½.è¿™ä¸ªæ€§ä»·æ¯”ä¸é«˜å“ˆ,ä¸æ¨èå¤§å®¶ä¹°,å› ä¸ºè¿™ä¸ªä¸€ä¸ªå¾ˆè´µ,æœ‰é’±çš„å°ä¼™ä¼´éƒ½ä¹°å¥½å‡ ä¸ªç»„è£…æˆç«‹ä½“å£°æ’­æ”¾,å¥½å¤„å°±æ˜¯å®ƒå¯ä»¥å•ç‹¬æ§åˆ¶ä¹Ÿå¯ä»¥é›†ç¾¤æ§åˆ¶,äº¦å¯ä»¥ å•ç‹¬åˆ†å¼€æ§åˆ¶,æ§åˆ¶å¾ˆç®€å•è·Ÿå®ƒè¯´ "hi siri ..."
     
####  Apple Watch

![](/assets/images/20231231FinalSummary/applewatch.webp)

ä¹‹å‰çš„æ‰‹è¡¨ç”µæ± ä¸è¡Œäº†,pddä¹°äº†ä¸€å—ç”µæ± ,ç»“æœè‡ªå·±åŠ¨æ‰‹çš„æ—¶å€™å‘ç°,å±å¹•çº¿åœˆæœ‰ä¸€å±‚nfcæ¥è§¦ç”µè·¯,å¯¼è‡´æŠŠä¹‹å‰çš„æ‰‹è¡¨å¼„åäº†,æŸ¥äº†ä¸€ä¸‹ç»´ä¿®æ¯”ä¹°äºŒæ‰‹ä»·æ ¼è¿˜è´µ,æœæ–­æ”¾å¼ƒ,pddä¹°ä¸ªæœ€ä¾¿å®œçš„se.

#### è‹¹æœè§¦æ‘¸æ¿

![](/assets/images/20231231FinalSummary/trackpad.webp)

è‹¹æœçš„è®¾å¤‡è¿˜æ˜¯è§¦æ‘¸æ¿æ¯”è¾ƒå¥½ç”¨,å­¦ä¹ å·¥ä½œå†™ä»£ç ,è¿˜æ˜¯è§¦æ‘¸æ¿æ¯”å¦™æ§é¼ æ ‡è¦å¥½å¾ˆå¤š,äºæ˜¯æ·˜æ±°äº†æ—§çš„å¦™æ§é¼ æ ‡,æ¢æˆäº†è§¦æ‘¸æ¿.

#### PS5æ¸¸æˆå…‰ç›˜

![](/assets/images/20231231FinalSummary/games.webp)

ä¸šä½™è´¥å®¶ä¹°äº†å‡ æœ¬DVDå…‰ç›˜ç¢Ÿç‰‡æ¸¸æˆ.å½“åšæ”¶è—å§ï¼

#### æ‘©æ‰˜è½¦å¤´ç›”

![](/assets/images/20231231FinalSummary/helmet.webp)

éª‘æ‘©æ‰˜è½¦çš„æ—¶å€™æ¯”è¾ƒä¸å®‰å…¨,ä¹°äº†ä¸€ä¸ªå¥½ä¸€äº›çš„.å®‰å…¨é‡è¦

#### æŒåŒ…

![](/assets/images/20231231FinalSummary/bags.webp)

ä¸ºäº†è§£å†³æ¯æ¬¡å‡ºé—¨å¸¦å„ç§ä¸œè¥¿å¼„å¾—è£¤å…œéå¸¸éš¾çœ‹,é¼“é¼“çš„ä¸€ç‚¹éƒ½ä¸ä¼˜é›…,å²æ•°å¤§äº†,æ¸æ¸åœ°å˜å¾—æ³¨æ„è‡ªå·±çš„ä½“é¢å’Œå½¢è±¡,è‡ªå·±ä¹°äº†ä¸€ä¸ªæŒåŒ…, å®é™…ä¸Šæ˜¯ä¹°äº†3ä¸ª,å…¶ä½™ä¸¤ä¸ªé€ç»™äº†åŒå­¦å’Œæœ‹å‹,åœ¨æˆ‘çˆ¶äº²å»ä¸–çš„æ—¶å€™æˆ‘å€Ÿå“¥ä»¬çš„è½¦ç”¨äº†å¥½å‡ å¤©,å…„å¼Ÿä¸€åˆ†é’±éƒ½æ²¡æ”¶,ä¸ºäº†è¡¨è¾¾æˆ‘çš„æ„Ÿè°¢,æˆ‘é€ä»–ä»¬ä¸¤ä¸ªäººä¸€äººä¸€ä¸ªæŒåŒ….

#### æ˜¾ç¤ºå™¨æ€»æˆ

![](/assets/images/20231231FinalSummary/lcd.webp)
ä¹‹å‰æœ‰ä¸€ä¸ªæ—§çš„è‹¹æœç”µè„‘,å¤ªè€äº†å¾ˆå¡,äºæ˜¯æŠŠç”µè„‘æ‹†äº†ä¹‹åå‘ç°å±å¹•æ˜¯å¥½çš„,ä¸Šç½‘ä¸Šæœäº†ä¸€ä¸‹å¯ä»¥ä¹°ä¸ªmvdsé©±åŠ¨æ¿å¯ä»¥æ”¹æˆ æ˜¾ç¤ºå™¨,äºæ˜¯èŠ±äº†200å¤šä¹°äº†é©±åŠ¨æ¿å®‰è£…ä¸Šæœç„¶ä¸é”™,å˜åºŸä¸ºå®åˆç†åˆ©ç”¨å®¶é‡Œçš„ç”µå™¨.

#### åˆ¨ä¸å™¨

![](/assets/images/20231231FinalSummary/grater.webp)

æˆ‘ç›¸ä¿¡è¿™ä¸ªå¦‚æœä½ ä¸åšé¥­æ ¹æœ¬ä¸ä¼šæ„è¯†åˆ°å®ƒçš„é‡è¦æ€§,æˆ‘ç»å¸¸ä¸‹å¨åšé¥­,å¯¹å¨æˆ¿å·¥å…·æ¯”è¾ƒé‡è§†,åˆ‡åœŸè±†ä¸æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹,å¦‚æœä¸æ˜¯ä¸ºäº†ç»ƒä¹ æŠ€æœ¯,æˆ‘å»ºè®®è¿˜æ˜¯ä¹°ä¸€ä¸ªé¥­åº—ç”¨çš„åˆ¨ä¸å™¨,å°±æ˜¯ä¸Šå›¾çš„å·¥å…·,ä¹°å›æ¥å‘ç°,é¥­åº—çš„å¨å¸ˆå¥½åƒä¹Ÿä¸é¦™äº†,å·¥å…·åˆ‡çš„éå¸¸å¥½.

# æ€»ç»“

2023å¹´åœ¨ä¸çŸ¥ä¸è§‰ä¸­å°±åˆ°äº†å¹´ç»ˆ,æœ‰æ—¶å€™çœŸçš„æ„Ÿå¹,æˆ‘è¿˜èƒ½èµ¶ä¸Š 1æ‰“å¤´å’Œ2æ‰“å¤´çš„ å¹´ä»½,è·¨ä¸–çºªçš„äº‹æˆ‘èµ¶ä¸Šäº†,æ—¶é—´è¿‡å¾—çœŸçš„å¤ªå¿«äº†,æ²¡æ€ä¹ˆå¼€å§‹ä¸€å¹´å°±ç»“æŸäº†,å¸Œæœ›2024å¹´æˆ‘å¼€å¯æ–°çš„å­¦ä¹ è®¡åˆ’,æŒç»­è¾“å‡ºé«˜ç²¾å°–æŠ€æœ¯æ–‡ç« ,æ‹“å®½è®¤çŸ¥,æ—©æ—¥å®ç°å…±åŒå¯Œè£•,2024 å¹³ç¨³åº¦è¿‡å°±å¥½, æ˜å¹´è§!


URL: https://sunyazhou.com/2023/10/sqlstandard/index.html.md
Published At: 2023-10-31 02:01:00 +0000

# SQLè¯­å¥çš„æ ‡å‡†

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯ä»‹ç»

æœ€è¿‘å·¥ä½œå¤ªå¿™,æ²¡æœ‰ä¿è¯åšå®¢çš„äº§å‡º,ä»Šå¤©å¶æœ‰æ—¶é—´æ¥æ¢è®¨ä¸€ä¸‹æœ€è¿‘çœ‹åˆ°çš„ä¸€ç¯‡æ–‡ç« 

[oronaæŠ€æœ¯ä¸“é¢˜-æ—¶åºæ•°æ®åˆ†æ](https://mp.weixin.qq.com/s/CMgxtw0AisqtNeY1gRgJsQ) æ¥è‡ªäºç½‘æ˜“äº‘éŸ³ä¹æŠ€æœ¯å›¢é˜Ÿ, è¿™ç¯‡æ–‡ç« ç®€å•çš„é˜è¿°äº†ä¸€ä¸‹åšæ•°æ®ç»Ÿè®¡ç›¸å…³çš„å¤§æ•°æ®å·¥ä½œ, ä¸è¿‡è¿™ä¸æ˜¯æˆ‘ä»Šå¤©è¦ä»‹ç»çš„é‡ç‚¹,æˆ‘æƒ³ä»‹ç»çš„é‡ç‚¹æ¥è‡ªäºè¿™ç¯‡æ–‡ç« ç”¨åˆ°çš„sqlè¯­å¥


åœ¨æˆ‘ä¸Šå¤§å­¦æ—¶å€™è€å¸ˆæ•™çš„SQLè¯­å¥åœ¨å½“æ—¶çœ‹æ¥å·²ç»å¾ˆå®ç”¨ä¸”ç®€å•.ä½†å¿½è§†äº†ä¸€ä¸ªå¾ˆé‡è¦çš„å†…å®¹,ä»£ç çš„æ•´é½åˆ’ä¸€,ä»£ç æ ‡å‡†å’Œè§„èŒƒ.

ä»Šå¤©æ¥åˆ°äº†æ¥è‡ªç½‘æ˜“äº‘éŸ³ä¹çš„æ–‡ç« å†…å®¹ä¸­,æˆ‘è§‚å¯Ÿäº†ä¸€ä¸‹SQLè¯­å¥

``` sql
SELECT toStartOfDay(time), avg(degree)
FROM table_temperature
WHERE
    time>='2023-09-01' AND
    time<'2023-10-01' AND
    city='æ­å·'
GROUP BY toStartOfDay(time)
```

ç»§ç»­è§‚å¯Ÿ

``` sql
SELECT toYear(time), model, avg(price)
FROM table_gas
WHERE
    time>='2013-01-01' AND
    time<'2023-01-01'
GROUP BY toYear(time), model
```

é¡¿æ—¶è®©æˆ‘æ„Ÿè§‰ è¿™ä¸ªå†™æ³•æˆ‘å¿…é¡»è®°å½•ä¸€ä¸‹,çœŸçš„å¾ˆæ ‡å‡†

``` sql
CREATE CONTINUE QUERY "cq_event" ON "apm_log"
BEGIN
  SELECT SUM("pv") as pv
  INTO "one_year"."cq_hour_event"
  FROM "one_week"."cq_minute_event"
  GROUP BY time(1h), *
END
```

è¿˜æœ‰ä¸‹é¢

``` sql
SELECT
   TUMBLE_START(PROCTIME(), INTERVAL '1' MINUTE) as wTime,
   count(os) as pv,
   os as osName,
   moduleName as moduleName
FROM performance_log
WHERE
    props['mspm'] = 'ReactNativeApplication'
GROUP BY
    TUMBLE(PROCTIME(), INTERVAL '1' MINUTE),
    os,
    props['moduleName']
```

ç­‰ç­‰

#### åˆ›å»ºè¡¨

``` sql
CREATE TABLE rn_monitor_cold_boot_stage_local
(
    `appName` String, -- åº”ç”¨åï¼Œå¦‚ äº‘éŸ³ä¹
    `osName` String, -- æ“ä½œç³»ç»Ÿå
    `appVersion` String, -- åº”ç”¨ç‰ˆæœ¬
    `rnModuleName` String, -- ReactNative æ¨¡å—å
    `deviceTag` String, -- è®¾å¤‡æ€§èƒ½åˆ†æ¡£
    `uploadTime` DateTime, -- æ—¥å¿—åˆ°è¾¾æœåŠ¡ç«¯æ—¶é—´
    `uid` String, -- ç”¨æˆ· uid
    `stageName` String, -- é˜¶æ®µå
    `stageCost` Float32, -- é˜¶æ®µè€—æ—¶
)
ENGINE = MergeTree
PARTITION BY (appName, osName, toYYYYMMDD(uploadTime))
ORDER BY (rnModuleName, uploadTime)
TTL uploadTime + toIntervalDay(90)
SETTINGS index_granularity = 8192, use_minimalistic_part_header_in_zookeeper = 1
```

#### æŸ¥è¯¢è¡¨

``` sql
SELECT
 toStartOfDay(uploadTime) as "time",
 avg(stageCost) AS "avg",
 quantiles(0.5, 0.9)(stageCost) AS "quantiles",
 count() AS "pv",
 uniq(uid) AS "uv"
FROM rn_monitor_cold_boot_stage_shard
WHERE
   uploadTime>=1682006400 AND
   uploadTime<=1682611199 AND
   stageName='render' AND
   rnModuleName='rn-playlistrank'
GROUP BY toStartOfDay(uploadTime)
ORDER BY toStartOfDay(uploadTime) ASC
```

ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰çœŸæ­£è§‚å¯Ÿ

* 1.å…³é”®å­—å•ç‹¬ä¸€è¡Œ
* 2.æ‹¬å·æ¢è¡Œå•ç‹¬ä¸€è¡Œå¹¶ä¸”å¯¹å…¶
* 3.å­—æ®µå•ç‹¬ä¸€è¡Œç”¨`,`é€—å·éš”å¼€
* 4.å¼€å§‹ç»“æŸé…å¯¹
* 5.å…³é”®å­—å¿…é¡»é å‰å¯¹å…¶é¦–è¡Œ
* 6.ANDå’Œ ASCdç­‰å…³é”®å­— æ”¾å

è™½ç„¶æˆ‘æ€»ç»“çš„è¿‡äºé›¶æ•£, ä½†æ˜¯ä»ä¸Šè¿°æ ‡å‡†çš„å†™æ³•æ¥çœ‹,æˆ‘è‚¤æµ…çš„è®¤ä¸ºè¿™å°±æ˜¯SQLåº”è¯¥æœ‰çš„æ ‡å‡†,å†™SQLå°±åº”è¯¥è¿™æ ·å†™,ç»™åˆ«äººæä¾›æ›´å¥½çš„é˜…è¯»æ€§.


# æ€»ç»“

ä»Šå¤©ç®€å•çš„ä»‹ç»äº†ä¸€ä¸‹SQLçš„æ ‡å‡†å†™æ³•,è¿™å¯¹ç»å¸¸æ“ä½œæ•°æ®åº“çš„åŒå­¦å¯èƒ½æ˜¯å®¶å¸¸ä¾¿é¥­,ä¹Ÿå¯èƒ½å¤§å®¶éƒ½è®¤ä¸ºè‡ªå·±çŸ¥é“å°±æˆ‘ä¸çŸ¥é“è§‰å¾—æˆ‘å¯ç¬‘,æ€»ä¹‹ è¿™æ˜¯æˆ‘å¯¹çŸ¥è¯†çš„ç§¯ç´¯å’Œä¸æ–­æé«˜è‡ªå·±çš„è®¤çŸ¥.ä¸ºäº†è®°å½•è¿™äº›å¥½çš„ä»£ç æˆ‘è®°å½•äº†ä¸‹æ¥è¿™ç¯‡æ–‡ç« 


[SQL å‚è€ƒçš„ oronaæŠ€æœ¯ä¸“é¢˜-æ—¶åºæ•°æ®åˆ†æ](https://mp.weixin.qq.com/s/CMgxtw0AisqtNeY1gRgJsQ) 


URL: https://sunyazhou.com/2023/09/ios17widgetURL/index.html.md
Published At: 2023-09-12 01:54:00 +0000

# è§£å†³iOSå°ç»„ä»¶å¼€å‘ä¸­widgetURLé—®é¢˜

![](/assets/images/20230912iOS17WidgetURL/banner.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## èƒŒæ™¯æè¿°

æœ€è¿‘å†å¼€å‘iOS17çš„å°ç»„ä»¶é‡åˆ°ä¸€ä¸ªéå¸¸å¥‡æ€ªä¸”å¾ˆè„‘æ®‹çš„é—®é¢˜

åœ¨å°ç»„ä»¶å¼€å‘è¿‡ç¨‹ä¸­æœ‰å¦‚ä¸‹ä»£ç ä½¿ç”¨æ·±åº¦é“¾æ¥(deeping URL )è°ƒç”¨open URL æ‰“å¼€host app.

å½“æˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨ä¸‹é¢ä»£ç çš„æ—¶å€™ æ€»æ˜¯æœ€åä¸€ä¸ªç”Ÿæ•ˆ

``` swift
HStack(alignment: .bottom) {
    Image(itemInfo!.didCollected ? "kw_widget_absorption_color_like" : "kw_widget_absorption_color_unlike")
        .resizable()
        .aspectRatio(contentMode: .fit)
        .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
        .widgetURL(URL(string: "sunyazhou://collectOrNot"))
        .border(.red)
    Image(itemInfo!.isPlay ? "kw_widget_absorption_color_play" : "kw_widget_absorption_color_pause")
        .resizable()
        .aspectRatio(contentMode: .fit)
        .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
        .widgetURL(URL(string: "sunyazhou://playOrPause"))
        .border(.cyan)
    Image("kw_widget_absorption_color_next")
        .resizable()
        .aspectRatio(contentMode: .fit)
        .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
        .widgetURL(URL(string: "sunyazhou://playNext"))
        .border(.blue)
}
```

![](/assets/images/20230912iOS17WidgetURL/widget1.webp)

ä¹Ÿå°±æ˜¯è¿™ä¸‰ä¸ªæŒ‰é’®æˆ‘ç‚¹å‡»å“ªä¸ªéƒ½æ˜¯æœ€åä¸€ä¸ªImageç”Ÿæ•ˆ,æˆ‘è®¤çœŸç¿»é˜…äº†ä¸€ä¸‹æ–‡æ¡£,åªèƒ½è¯´å¤ªå‘äº†

``` swift
@available(iOS 14.0, macOS 11.0, watchOS 9.0, *)
@available(tvOS, unavailable)
extension View {

    /// Sets the URL to open in the containing app when the user clicks the widget.
    /// - Parameter url: The URL to open in the containing app.
    /// - Returns: A view that opens the specified URL when the user clicks
    ///   the widget.
    ///
è¿™è¡Œ    /// Widgets support one `widgetURL` modifier in their view hierarchy.
è¿™è¡Œ    /// If multiple views have `widgetURL` modifiers, the behavior is
è¿™è¡Œ    /// undefined.
    public func widgetURL(_ url: URL?) -> some View

}
```

å®ƒæ˜ç¡®æ ‡è¯†å¦‚æœå¹¶æ’æ·»åŠ å¤šä¸ªwidgetURLçš„è¯,è¿™ç§è¡Œä¸ºæ˜¯æœªå®šä¹‰ä¸ç¡®å®šçš„,ä½œä¸ºä¸€ä¸ªè´Ÿè´£ä»»çš„iOSå¼€å‘è€…æˆ‘å¿…é¡»å¯¹è¿™ç§æ³¨é‡Šæå‡ºæ‰¹è¯„, å¦‚æœä½ è¦æ˜¯å‘Šè¯‰æˆ‘ä¸ç¡®å®šé‚£å°±åœ¨ç¼–è¾‘ä»£ç çš„æ—¶å€™å‘Šè¯‰å¼€å‘è€…è¿™ç©æ„æœ€å¤šåªèƒ½æ·»åŠ ä¸€ä¸ªViewä¸Š,å¦‚æœæ·»åŠ å¤šä¸ªçš„è¯è¦ç”¨ å…¶å®ƒæ–¹æ³• ç„¶åç»™ä¸ªç›¸å…³é“¾æ¥

#### è§£å†³åŠæ³•

ä½¿ç”¨å¦‚ä¸‹ä»£ç 

``` swift
Link(destination: URL(string: "wig://\(item.id)")!) {
	 ZStack {
	    // some views
	 }
}
```

äºæ˜¯æˆ‘å°±æ”¹æˆäº†å¦‚ä¸‹ ï¼š

``` swift
HStack(alignment: .bottom) {
    Link(destination: URL(string: "sunyazhou://collectOrNot")!) {
        Image(itemInfo!.didCollected ? "kw_widget_absorption_color_like" : "kw_widget_absorption_color_unlike")
            .resizable()
            .aspectRatio(contentMode: .fit)
            .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
            .border(.red)
    }
    Link(destination: URL(string: "sunyazhou://playOrPause")!) {
        Image(itemInfo!.isPlay ? "kw_widget_absorption_color_play" : "kw_widget_absorption_color_pause")
            .resizable()
            .aspectRatio(contentMode: .fit)
            .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
            .border(.cyan)
    }
    Link(destination: URL(string: "sunyazhou://playNext")!) {
        Image("kw_widget_absorption_color_next")
            .resizable()
            .aspectRatio(contentMode: .fit)
            .frame(minWidth: itemSize.width, maxWidth: .infinity, minHeight:itemSize.height, maxHeight:.infinity)
            .border(.blue)
    }
}
```

> æ³¨æ„: `Link` ä»…æ”¯æŒwidgetçš„`Families`ä¸­çš„`systemMedium`å’Œ`systemLarge`,ä¸æ”¯æŒ`systemSmall`


# æ€»ç»“

å°ç»„ä»¶å¼€å‘ä¸­å¾ˆå¤šåœ¨å¸¸è§„swiftUIä¸­ç¬¦åˆè‡ªå·±é¢„æœŸçš„åŠŸèƒ½åœ¨å°ç»„ä»¶ä¸­å°±å¾ˆä¸ç¬¦åˆé¢„æœŸ,è¯·å¤§å®¶å¼€å‘å°ç»„ä»¶çš„è¯è®°å¾—å¤šçœ‹çœ‹æ–‡æ¡£.

[å°ç»„ä»¶å¼€å‘ç›¸å…³æ–‡ç« ](https://mp.weixin.qq.com/s/684dX2rFCUq1Tum6D0oJeA) 


URL: https://sunyazhou.com/2023/09/learnswiftuichapter5/index.html.md
Published At: 2023-09-09 07:55:00 +0000

# SwiftUIç¬¬äº”ç« å­¦ä¹ æ€»ç»“

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## SwiftUIè¯¾ç¨‹

æœ€è¿‘åšæŒå­¦ä¹ swiftUI,å‘¨æœ«æœ‰ç©ºæŠŠç¬¬å››ç« éƒ½çœ‹å®Œäº†,æˆ‘è¿™é‡Œè¯´çš„çœ‹æ˜¯åŠ¨æ‰‹å®è·µ+æ•™ç¨‹å­¦ä¹ .è®°å½•ä¸€äº›å®¹æ˜“é—å¿˜çš„å†…å®¹


### ä¸»è¦å†…å®¹åŒ…æ‹¬

* å¤„ç†tabbaré€æ˜é—®é¢˜é—®é¢˜
*  å¤„ç†å•ä½æ ¼å¼åŒ–é—®é¢˜

### tabbaré€æ˜é—®é¢˜é—®é¢˜

ç”¨SwiftUIå†™å®Œå„ç§UIåå‘ç° tabbarçš„è§†å›¾è¢«é®æŒ¡,

![](/assets/images/20230805LearnSwiftUIChapter5/before.gif)
![](/assets/images/20230805LearnSwiftUIChapter5/after.gif)

éœ€è¦å¯åŠ¨appçš„æ—¶å€™ä½¿ç”¨å¦‚ä¸‹å‡½æ•°`applyTabbarBackground()`

``` swfit
import SwiftUI

@main
struct AppEntry: App {
    init() {
        applyTabbarBackground()
    }
    
    var body: some Scene {
        WindowGroup {
            HomeScreen()
        }
    }
    
    func applyTabbarBackground() {
        let tabbarAppearence = UITabBarAppearance()
        tabbarAppearence.configureWithTransparentBackground()
        tabbarAppearence.backgroundColor = .secondarySystemBackground.withAlphaComponent(0.3)
        tabbarAppearence.backgroundEffect = UIBlurEffect(style: .systemChromeMaterial)
        UITabBar.appearance().scrollEdgeAppearance = tabbarAppearence
    }
}
```

####  å¤„ç†å•ä½æ ¼å¼åŒ–é—®é¢˜

iOSç³»ç»Ÿæä¾›äº†å›½å®¶åŒ–çš„å•ä½ç±» `Measurement `,å¸®æˆ‘ä»¬å¤„ç† å…‹ï¼Œg, è‹±é•‘, poundsç­‰å•ä½çš„å¤„ç†

``` swift
var desciption : String {
        let preferredUnit = Unit.getPreferredUnit(from: store)
        let measureMent = Measurement(value: wrappedValue, unit: unit.dimension)
        let converted = measureMent.converted(to: preferredUnit.dimension)
//        return converted.formatted(.measurement(width: .abbreviated, usage: .asProvided, numberFormatStyle: .number.precision(.fractionLength(0...1))))
        return converted.value.formatted(.number.precision(.fractionLength(0...1))) + " " + preferredUnit.localizedSymbol
    }
```

è¿™é‡Œæ¨èçœ‹ä¸€ä¸‹å®˜æ–¹çš„WWDC20è§†é¢‘[Formatters: Make data human-friendly](https://developer.apple.com/videos/play/wwdc2020/10160/)

å½±ç‰‡ä¸­ä»‹ç´¹äº†èƒ½æŠŠæ—¥æœŸã€å–®ä½ã€æ•¸å­—å’Œæ–‡å­—ç­‰ç­‰è³‡æ–™ï¼Œæ ¹æ“šä½¿ç”¨è€… Locale é€²è¡Œæ ¼å¼åŒ–çš„å·¥å…·



# æ€»ç»“

å…¶å®ç¬¬äº”ç« è®²çš„æ¯”è¾ƒå¤šçš„æ˜¯å±æ€§å°è£…å™¨çš„é«˜åº¦å°è£…,æˆ‘çœ‹ç¯‡å¹…å®åœ¨å¤ªå¤§,ä¸å…¶æˆ‘åœ¨è¿™è®°å½•ä¸€ä¸‹ä¸å¦‚å¤§å®¶äº²è‡ªçœ‹ä¸€ä¸‹[æ•™ç¨‹è§†é¢‘](https://www.bilibili.com/video/BV1bA411y71h/?spm_id_from=333.788&vd_source=9309f71afe97e633abeadc8407870e76),è®²çš„æ¯”è¾ƒé€å½»ã€‚

å…¶æ¬¡å¤§ç¯‡è®²è¿°å•å…ƒæµ‹è¯•, è¿™é‡Œç”±äºæœ¬äººä¸å¤ªæ„¿æ„å†™å•å…ƒæµ‹è¯•ç›´æ¥è·³è¿‡ã€‚ã€‚ã€‚

ä¸€ç›´è·Ÿè¿›è¿™é—¨è¯¾ç¨‹å¸Œæœ›æœ‰æ‰€æ”¶è·,ä¸‹é¢æ˜¯æ•´ç†çš„ä¸€å¯¹è¯¾ç¨‹èµ„æ–™ è¯·æŸ¥é˜…

# SwiftUI å…¥é–€èª²ç¨‹
æ”¾ç½® [SwiftUI å…¥é–€èª²ç¨‹](https://www.youtube.com/playlist?list=PLXM8k1EWy5khONZ9M9ytK8mMrcEOXvGsE) çš„ç›¸é—œæª”æ¡ˆï¼Œä»¥åŠæ¯ä¸€ç« ç¯€çš„ç›¸é—œé€£çµã€å»¶ä¼¸é–±è®€ã€‚

### Chapter 1ï¼šåŸºæœ¬ä»‹ç´¹
ä»‹ç´¹ Xcode ä»‹é¢å’Œ SwiftUI çš„åŸºæœ¬æ¶æ§‹ã€‚

##### ç›¸é—œé€£çµ
* [1-1 å±•ç¤ºçš„æ‰‹æ©Ÿç‰ˆæœ¬ã€å‡ç´šè¶¨å‹¢ç¶²ç«™](https://mixpanel.com/trends)
* [1-3 ä½¿ç”¨çš„ç›¤å­åœ–ç‰‡ä¾†æº](https://www.flaticon.com/free-sticker/dinner_7603521)
* [1-5 å±•ç¤ºçš„è£ç½®è³‡è¨Šç¶²ç«™](https://iosref.com/res)
* [1-5 æ’ç‰ˆé¡å‹å»¶ä¼¸é–±è®€](http://defagos.github.io/understanding_swiftui_layout_behaviors/)
* å¦‚æœä½ å¾ UIKit éä¾†å¯èƒ½æœƒå• AppDelegate å»å“ªäº†ã€‚
è«‹æ­é…[é€™å€‹ property wrapper](https://developer.apple.com/documentation/swiftui/uiapplicationdelegateadaptor) ä½¿ç”¨ã€‚
ä¸éï¼Œå¦‚æœåªæ˜¯è¦å•Ÿå‹•æ™‚é€²è¡Œä¸€äº›æ“ä½œï¼Œåœ¨ App çš„ init ä¸­é€²è¡Œå³å¯ï¼›å¦‚æœæ˜¯ç•«é¢åˆ‡æ›ç›¸é—œäº‹ä»¶ï¼Œè«‹ç”¨ [ScenePhase](https://developer.apple.com/documentation/swiftui/scenephase)ã€‚

---

### Chapter 2ï¼šæ’ç‰ˆ
ç·´ç¿’æ’ç‰ˆå’ŒåŸºæœ¬çš„é‡æ§‹ç¨‹å¼ç¢¼ã€‚

##### ç›¸é—œé€£çµ
* [åœ¨ SwiftUI ä¸­å®ç°è§†å›¾å±…ä¸­çš„è‹¥å¹²ç§æ–¹æ³•](https://www.fatbobman.com/posts/centering_the_View_in_SwiftUI/)
* é™¤äº†å½±ç‰‡ä¸­æ­é…è¨ˆç®—å±¬æ€§ä½¿ç”¨ **@ViewBuilder**ï¼Œä½ å¯èƒ½ä¹Ÿæœƒ[åœ¨å•Ÿå‹•æˆ– closure ä¸­ä½¿ç”¨å®ƒ](https://swiftontap.com/viewbuilder)ã€‚

---

### Chapter 3ï¼šå±¬æ€§åŒ…è£
ä»‹ç´¹ SwiftUI ä¸­å¸¸ç”¨çš„å±¬æ€§åŒ…è£ï¼šStateã€Binding å’Œ Environmentï¼›ç·´ç¿’å»ºç«‹æ¸…å–®ã€è¡¨å–®ï¼Œä¸¦ä½¿ç”¨ enum æ•´ç†ç¨‹å¼ç¢¼ã€‚

##### ç›¸é—œé€£çµ
* [EnvironmentValues ç’°å¢ƒè®Šæ•¸](https://developer.apple.com/documentation/swiftui/environmentvalues)
* å½±ç‰‡ä¸­æåˆ°çš„ã€Œ**åœ¨ result builder ä¸­ï¼Œlocal è®Šæ•¸æœƒè¢«ç•¶ä½œå»ºé€ çš„ block**ã€ï¼Œè©³ç´°çš„è³‡è¨Šå¯ä»¥åœ¨é€™å€‹ [evolution è¨˜éŒ„](https://github.com/apple/swift-evolution/blob/main/proposals/0289-result-builders.md#the-result-builder-transform)ä¸­äº†è§£ï¼Œåœ¨ *The result builder transform* çš„åˆ†é¡ä¸‹å¯ä»¥èªè­˜ result builder å°ä¸åŒèªå¥çš„åˆ¤æ–·ã€‚

---

### Chapter 4ï¼šè³‡æ–™æŒä¹…åŒ–
ä»‹ç´¹ iOS ç’°å¢ƒåŸç”Ÿçš„è³‡æ–™æŒä¹…åŒ–æ–¹å¼ä»¥åŠç·¨ç¢¼çš„æ¦‚å¿µä»‹ç´¹ï¼Œä¸¦å¯¦ä½œä¸€å€‹è¨­å®šç•«é¢ï¼Œä½¿ç”¨ AppStorage å„²å­˜å¸ƒæ—ã€enum å’Œ Array çš„è³‡æ–™ã€‚

##### ç›¸é—œé€£çµ
* [å®˜æ–¹çš„è³‡æ–™æŒä¹…åŒ–æ–‡ä»¶](https://developer.apple.com/documentation/swiftui/persistent-storage)
* [æœƒæ–°å¢ Presentation çš„èª¿æ•´å™¨](https://developer.apple.com/documentation/swiftui/view-presentation)
* å½±ç‰‡ä¸­æåˆ°å¯ä»¥å˜—è©¦**å»ºç«‹è‡ªå·±çš„ AppStorage å±¬æ€§åŒ…è£**ï¼Œå¦‚æœæœ‰èˆˆè¶£å¯ä»¥åƒè€ƒ [SwiftLee çš„é€™ç¯‡æ–‡ç« ](https://www.avanderlee.com/swift/appstorage-explained/
)ï¼Œä¸éé€™å€‹æ˜¯å€‹ç›¸å°é€²éšçš„å…§å®¹ï¼Œä½ æœƒéœ€è¦æœ‰åŸºæœ¬ Combine æ¦‚å¿µã€äº†è§£ ObservableObject å’Œ DynamicProperty ã€‚
* ä½¿ç”¨ FileManager æ™‚ï¼Œä½ å¯èƒ½æœƒéœ€è¦çŸ¥é“[å¦‚ä½•å–å¾—æª”æ¡ˆ URL](https://chaocode.co/blog/getting-url)ã€‚

---

### Chapter 5ï¼šæ¸¬è©¦
ä»‹ç´¹æ¸¬è©¦çš„åŸºæœ¬æ¦‚å¿µã€Xcode çš„æ¸¬è©¦ä»‹é¢ä¸¦å¯¦ä½œä¸€å€‹æ¸¬è©¦ï¼Œä»¥åŠä½¿ç”¨ Measurement é€²è¡Œå–®ä½è½‰æ›ä¸¦ä¸”æ ¹æ“šä½¿ç”¨è€… Locale é¡¯ç¤ºåœ¨åœ°åŒ–çš„å–®ä½å­—ä¸²ã€‚

##### ç›¸é—œé€£çµ
* [WWDC20: åœ¨åœ°åŒ–çš„æ ¼å¼åŒ–å·¥å…·](https://developer.apple.com/videos/play/wwdc2020/10160/)ï¼Œå½±ç‰‡ä¸­ä»‹ç´¹äº†èƒ½æŠŠæ—¥æœŸã€å–®ä½ã€æ•¸å­—å’Œæ–‡å­—ç­‰ç­‰è³‡æ–™ï¼Œæ ¹æ“šä½¿ç”¨è€… Locale é€²è¡Œæ ¼å¼åŒ–çš„å·¥å…·ã€‚
* [WWDC19: æ¸¬è©¦ã€Test Planã€CICD ä»‹ç´¹](https://developer.apple.com/wwdc19/403)
* äº†è§£ [Locale](https://developer.apple.com/documentation/foundation/locale)ï¼ŒLocale ä¸¦ä¸å–®æŒ‡èªè¨€ï¼Œè€Œæ˜¯çµåˆèªè¨€åŠ ä¸Šåœ°å€ï¼Œæä¾›æ›´ç²¾ç¢ºçš„æ…£ç”¨æ³•ã€‚ä¾‹å¦‚åŒæ¨£æ˜¯è‹±æ–‡ï¼Œåœ¨ä¸åŒåœ‹å®¶å¯«æ—¥æœŸçš„é †åºä¾ç„¶æœƒæœ‰æ‰€ä¸åŒã€‚
    - åœ¨ä½ çš„ app æ²’æœ‰åšå…¶ä»–èªè¨€ä¹‹å‰ï¼Œ**Locale æœƒè¢«è¨­å®šæˆä½ çš„å°ˆæ¡ˆçš„ base language**ï¼Œè©³ç´°çš„ä»‹ç´¹å¯ä»¥çœ‹[é€™ç¯‡æ–‡ç« ](https://medium.com/swlh/know-your-language-locale-in-swift-beae4fcc5174)ï¼Œè£¡é¢ä¹Ÿæä¾›äº†`å–å¾—ä½¿ç”¨è€…åå¥½ / æ­£åœ¨ä½¿ç”¨çš„èªè¨€çš„æ–¹æ³•`ï¼Œåœ¨ä½ é‚„æ²’åšå¤šèªè¨€ä¹‹å‰ï¼Œä½ å¯ä»¥å˜—è©¦å–å¾—é€™äº›å€¼ä¾†å¼·åˆ¶ä¿®æ”¹ Localeã€‚
  
* [åœ¨ iOS16 åŠ ä¸Šå·¥å…·åˆ—çš„èƒŒæ™¯è‰²](https://sarunw.com/posts/swiftui-tabview-color/)ï¼šæ–‡ç« æ˜¯é‡å° TabBar ä»‹ç´¹ï¼Œä¸éé€™å€‹èª¿æ•´å™¨ `toolbarBackground` ä¹Ÿèƒ½ç”¨ä¾†ä¿®æ”¹ Navigation Barã€‚
* ä½ å¯èƒ½æœƒç™¼ç¾ TabBar åœ¨ iOS14 ä»¥å‰é•·å¾—ä¸ä¸€æ¨£ ğŸ¥²ï¼Œå¦‚æœä½ æƒ³è¦å…¨éƒ¨çµ±ä¸€çš„è©±å¯ä»¥åƒè€ƒ[é€™ç¯‡æ–‡ç« ä¸­çš„ç¨‹å¼ç¢¼](https://blog.personal-factory.com/2021/12/29/ios15-transparent-navigationbar-and-tabbar-by-default/)åšä¿®æ”¹ã€‚

---

### Chapter 6ï¼šç¶²è·¯å‘¼å«
ä»‹ç´¹åŸºæœ¬çš„ç¶²è·¯æ¦‚å¿µå’Œ Codable çš„é€²ä¸€æ­¥æ‡‰ç”¨ï¼Œä¸¦ä¸”å»ºç«‹ä¸€å€‹ä¸²æ¥ [The Cat API](https://thecatapi.com/) çš„æ–°å°ˆæ¡ˆã€‚
æ–°å°ˆæ¡ˆçš„å¯¦ä½œå…§å®¹åŒ…å«ï¼š
- å»ºç«‹ä¸€å€‹å°ˆé–€è™•ç†ç¶²è·¯çš„ Managerã€‚
- è™•ç†éŒ¯èª¤å’Œé¡¯ç¤º alertã€‚
- **è§€å¯Ÿ reference type**çš„`ObservableObject`ã€‚
- è‡ªå‹•è¼‰å…¥æ›´å¤šå…§å®¹çš„ Infinite Scrollã€‚
- èªè­˜`.task` èª¿æ•´å™¨å’Œå»ºç«‹ä¸€å€‹æ–°çš„`Task`çš„å·®åˆ¥ã€‚

##### ç›¸é—œé€£çµ
* 6-2 [å¸¸è¦‹ HTTP ç‹€æ…‹ç¢¼](https://developer.mozilla.org/zh-TW/docs/Web/HTTP/Status)
* 6-2 [MIME é¡å‹åç¨±å°ç…§](https://www.iana.org/assignments/media-types/media-types.xhtml)
* 6-2 [åˆ¤æ–·æ˜¯å¦ä½¿ç”¨ Cache è³‡æ–™çš„æµç¨‹åœ–](https://developer.apple.com/documentation/foundation/nsurlrequest/cachepolicy/useprotocolcachepolicy)
* 6-3 å½±ç‰‡ä¸­æåˆ°çš„[å°‡å›å‚³åŠ å…¥ cache çš„æ¢ä»¶](https://developer.apple.com/documentation/foundation/urlsessiondatadelegate/1411612-urlsession)
* 6-5 å½±ç‰‡ä¸­ä½¿ç”¨çš„[å¿«é€Ÿç”¢ç”Ÿ JSON è§£æç¨‹å¼ç¢¼çš„ç¶²ç«™](https://app.quicktype.io/)ã€‚è¦è¨˜å¾—ç”¨è‡ªå‹•ç”¢ç”Ÿçš„ç¨‹å¼ç¢¼çš„æ™‚å€™ï¼Œä¸ç®¡å¤šç°¡å–®çš„è³‡æ–™éƒ½è¦è‡ªå·±å†æª¢æŸ¥ä¸€éå“¦
* 6-8 [StateObject çš„æ–‡ä»¶](https://developer.apple.com/documentation/swiftui/stateobject)ï¼šé€™å€‹æ–‡ä»¶ç°¡å–®ä»‹ç´¹äº†æ­é… `ObservableObject` çš„ä¸‰å€‹å±¬æ€§åŒ…è£å™¨ï¼Œä»¥åŠå®ƒå€‘çš„æ›´æ–°æ™‚æ©Ÿã€‚å»ºè­°å¤§æ¦‚é–±è®€å•Ÿå‹•å’Œæ›´æ–°çš„éƒ¨åˆ†ï¼Œç•¶æœªä¾†é‡åˆ° StateObject é‡è¤‡è¢«å•Ÿå‹•æˆ–æ˜¯æ²’æœ‰å¦‚é æœŸçš„æ›´æ–°çš„æ™‚å€™å†æ¬¡å›ä¾†é–±è®€ã€‚
* 6-8 å¦‚æœå° **StateObject å’Œ ObservedObject** çš„å·®åˆ¥æœ‰ç–‘æƒ‘ï¼Œå¯ä»¥åƒè€ƒ onevcat çš„[é€™ç¯‡æ–‡ç« ](https://onevcat.com/2020/06/stateobject/)ã€‚
* 6-11 [onAppear å’Œ task èª¿æ•´å™¨çš„å·®åˆ¥](https://byby.dev/swiftui-task-vs-onappear)ï¼Œé€™ç¯‡æ–‡ç« æåˆ°çš„å·®åˆ¥æˆ‘è¦ºå¾—éƒ½è »é‡è¦çš„ï¼Œé™¤äº†å½±ç‰‡ä¸­æéçš„ï¼Œé‚„æœ‰é¡å¤–è¬›åˆ° task æ­é… id çš„ç”¨æ³•ã€‚
* 6-11 å¦‚æœå°æ–¼ä½¿ç”¨`Task`å’Œ`Task.detached`çš„æ™‚æ©Ÿä¸å¤ªç¢ºå®šï¼Œå¯ä»¥åƒè€ƒ[é€™ç¯‡æ–‡ç« ](https://www.donnywals.com/understanding-unstructured-and-detached-tasks-in-swift/)è£¡é¢çš„ **When to use unstructured tasks** å’Œ **When to use detached tasks**ã€‚
  ###### å¦å¤–ï¼Œç›®å‰ä¸»æµçš„åšæ³•æ˜¯é¿å…ä½¿ç”¨ detachedï¼Œé€™ä¸¦ä¸æ˜¯å› ç‚ºå®ƒä¸å¥½ï¼Œè€Œæ˜¯æ²’æœ‰ä»€éº¼éå¾—è¦ç”¨çš„åŸå› ï¼ˆi.e. æ²’å¿…è¦è®“è‡ªå·±çš„ç¨‹å¼ç¢¼è®Šè¤‡é›œï¼‰ã€‚ä¸éï¼Œæˆ‘å€‹äººè¦ºå¾— detached çš„ explicit å°æ–¼åˆæœŸæŒæ¡è‡ªå·±çš„ç¨‹å¼ç¢¼åœ¨åšä»€éº¼å¾ˆæœ‰å¹«åŠ©ï¼Œé‚„æœ‰å› ç‚ºå®ƒæ²’æœ‰ç¹¼æ‰¿è€Œç”¢ç”Ÿçš„ä¸€äº›å ±éŒ¯å’Œè­¦å‘Šä¹Ÿå°åˆæœŸå­¸ç¿’å¾ˆæœ‰å¹«åŠ©ã€‚
* 6-11 å¦‚æœæƒ³ç­è§£æ›´å¤šé—œæ–¼`onAppear`å‡ºç¾çš„æ™‚æ©Ÿï¼Œå¯ä»¥çœ‹é€™ç¯‡é—œæ–¼ [View çš„ç”Ÿå‘½é€±æœŸ](https://www.vadimbulavin.com/swiftui-view-lifecycle/) çš„æ–‡ç« ã€‚
* 6-11 å½±ç‰‡ä¸­æåˆ°çš„ï¼ŒObservableObject æœƒè®“æ•´å€‹ View é€²åˆ° MainActorï¼Œ[é€™ç¯‡æ–‡ç« ](https://oleb.net/2022/swiftui-task-mainactor/)è©³ç´°è¬›äº†é—œæ–¼ View struct ç¥ç§˜çš„ @MainActor æƒ…æ³ã€‚å†ä¸€æ¬¡å¼·èª¿ï¼Œæˆ‘è¦ºå¾—ä¸ç”¨å¤ªåœ¨æ„é€™å€‹ï¼Œé‡åˆ°é€™å€‹éŒ¯èª¤å°±ç›´æ¥æ”¹é€² MainActor ä¸­å°±å¥½ã€‚.


URL: https://sunyazhou.com/2023/09/learnswiftuichapter4/index.html.md
Published At: 2023-09-03 02:51:00 +0000

# SwiftUIç¬¬å››ç« å­¦ä¹ æ€»ç»“

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## SwiftUIè¯¾ç¨‹

æœ€è¿‘åšæŒå­¦ä¹ swiftUI,å‘¨æœ«æœ‰ç©ºæŠŠç¬¬å››ç« éƒ½çœ‹å®Œäº†,æˆ‘è¿™é‡Œè¯´çš„çœ‹æ˜¯åŠ¨æ‰‹å®è·µ+æ•™ç¨‹å­¦ä¹ .è®°å½•ä¸€äº›å®¹æ˜“é—å¿˜çš„å†…å®¹

### ä¸»è¦å†…å®¹åŒ…æ‹¬

* SwiftUIä¸­å¯¹åº”çš„UIKitç›¸ä¼¼ç»„ä»¶
* @AppStorage UserDefaultçš„å±æ€§å°è£…å™¨
* .environment(\\.colorScheme, shouldUseDarkMode ? .dark : .light)
* ç¼–ç å’Œè§£ç (åºåˆ—åŒ–ç±»å‹Json)
* å®ç°Codableåè®®è‡ªåŠ¨ç”Ÿæˆ`Decoder`å’Œ`Encoder`


#### SwiftUIä¸­å¯¹åº”çš„UIKitç›¸ä¼¼ç»„ä»¶

ä¸‹é¢æ˜¯è¯¥SwiftUIæ¡†æ¶å¯¹åº”çš„UIç¤ºæ„å›¾

![](/assets/images/20230805LearnSwiftUIChapter4/SwiftUIMap.webp)

``` swift
var body: some View {
        Form {
            Section("åŸºæœ¬è®¾å®š") {
                Toggle(isOn: $shouldUseDarkMode) {
                    Label("æ·±è‰²æ¨¡å¼", systemImage: .moon)
                }
                
                Picker(selection: $unit) {
                    ForEach(Unit.allCases) { $0 }
                } label: {
                    Label("å•ä½", systemImage: .unitSign)
                }
                
                Picker(selection: $startTab) {
                    Text("éšæœºé£Ÿç‰©").tag(HomeScreen.Tab.picker)
                    Text("é£Ÿç‰©æ¸…å•").tag(HomeScreen.Tab.list)
                } label: {
                    Label("å¯åŠ¨ç”»é¢", systemImage: .house)
                }
            }
            
            Section("å±é™©åŒºåŸŸ") {
                ForEach(Dialog.allCases){ dialog in
                    Button(dialog.rawValue) { confirmationDialog = dialog }
                        .tint(Color(.label))
                }
            }
            .confirmationDialog(confirmationDialog.rawValue, isPresented: shouldShowDialog, titleVisibility: .visible) {
                Button("ç¡®å®š", role: .destructive, action: confirmationDialog.action)
                Button("å–æ¶ˆ", role: .cancel) { }
                } message: {
                    Text(confirmationDialog.message)
                }
        }
    }
```

* Form --> æœ‰ç‚¹ç±»ä¼¼UIKitä¸­çš„UITableView
* Section --> æœ‰ç‚¹ç±»ä¼¼UIKitä¸­çš„UITableViewä¸­çš„Section åœ¨swiftUIä¸­è¢«ç‹¬ç«‹æˆä¸€ç§å®¹å™¨
* Toggle/Picker/Button --> æœ‰ç‚¹ç±»ä¼¼UIKitä¸­çš„UITableViewCellå¹¶ä¸”é‡Œé¢å·²ç»å¸ƒå±€å¥½äº†Switchå’Œå…¶ä»–é€‰æ‹©å™¨ã€æŒ‰é’®ç­‰

#### @AppStorage UserDefaultçš„å±æ€§å°è£…å™¨

è¿™ä¸ª`@AppStorage` æ˜¯SwiftUIä¸­çš„UserDefaultçš„å°è£…å½¢å¼,ç”¨äºæœ¬åœ°å­˜å‚¨ç±»ä¼¼NSUserDefaultçš„æ–¹å¼å­˜å‚¨keyå’Œvalueæˆ–è€…object,æœ€ç»ˆå½’æ¡£åˆ°plistæ–‡ä»¶ä¸­.

ä¸¾ä¸ªä¾‹å­

``` swift
@AppStorage("shouldUseDarkMode") private var shouldUseDarkMode: Bool = false
```

å½“åœ¨swiftUIä¸­å£°æ˜ä¸€ä¸ªå˜é‡å«åš`shouldUseDarkMode` å®ƒçš„é»˜è®¤å€¼æ˜¯false,å½“UserDefaultä¸­å–å€¼å–åˆ°çš„æ—¶å€™,è¿™ä¸ª`shouldUseDarkMode`æˆå‘˜å˜é‡å°±æ˜¯å–åˆ°çš„çœŸå®å€¼,å¦‚æœæ²¡å–åˆ° falseä½œä¸ºæ²¡å–åˆ°çš„å¤‡é€‰é»˜è®¤å€¼.

@AppStorage("shouldUseDarkMode") è¿™é‡Œçš„å­—ç¬¦ä¸²å°±æ˜¯UserDefaultè¦å–å€¼æ—¶å€™çš„key.

#### .environment ç¯å¢ƒå˜é‡

``` swift
@AppStorage(.shouldUseDarkMode) private var shouldUseDarkMode: Bool = false //æ·±è‰²æ¨¡å¼
@AppStorage(.unit) private var unit: Unit = .gram
@AppStorage(.startTab) private var startTab: HomeScreen.Tab = .picker
@State private var confirmationDialog: Dialog = .inactive
```

![](/assets/images/20230805LearnSwiftUIChapter4/darkmode.webp)

è¿™é‡Œçš„Toggleä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¹‹å‰åœ¨UIKitä¸­å­¦ä¹ çš„switchå¼€å…³è§¦å‘çš„å€¼ç›´æ¥å…³è”åˆ°`@AppStorage("shouldUseDarkMode")`ä¸­,å¹¶ä¸”ä¹Ÿä¼šæ›´æ–°æˆå‘˜å˜é‡,è¿™äº›æ“ä½œéƒ½æ˜¯SwiftUIå¸®æˆ‘ä»¬åšçš„.

å½“åšå®Œè¿™ä¸ªæ“ä½œåè¦é©¬ä¸Šç”Ÿæ•ˆ

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦æ”¹åŠ¨ç±»ä¼¼å·¥ç¨‹ä¸­çš„å¦‚ä¸‹ä»£ç :

``` swift

var body: some View {
    TabView(selection: $tab) {
        ForEach(Tab.allCases, id: \.self) { $0 }
    }
    .environment(\.colorScheme, shouldUseDarkMode ? .dark : .light)
}

```  
è¿™æ ·æ”¹åŠ¨è™½ç„¶é©¬ä¸Šç”Ÿæ•ˆä½†æ˜¯å¹¶ä¸ä¼šä½œç”¨äºå…¨å±€çš„ViewControllerä¹‹ç±»çš„è§†å›¾ä¸Š,è¿™ä¸ªæ”¹åŠ¨åªä¼šæ”¹åŠ¨ä»å“åº”è€…é“¾æ¡ä¸­æœ€é¡¶å±‚çš„VC,å‡è®¾æœ‰ä¸ªæŸæŸDetailVC presentå‡ºæ¥ å®ƒå°†ä¸å—æ­¤ç¯å¢ƒæ§åˆ¶

![](/assets/images/20230805LearnSwiftUIChapter4/darkmode2.webp)

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜éœ€è¦åœ¨é¡¶å±‚ä½¿ç”¨å¦‚ä¸‹ä»£ç åŒ…è£¹èµ·æ¥,å¹¶ä½¿ç”¨`preferredColorScheme()`å‡½æ•°æ›´æ”¹æ‰ä¼šå…¨å±€ç”Ÿæ•ˆ

``` swift
NavigationStack {
    TabView(selection: $tab) {
        ForEach(Tab.allCases, id: \.self) { $0 }
    }
    .preferredColorScheme(shouldUseDarkMode ? .dark : .light)
}
```

![](/assets/images/20230805LearnSwiftUIChapter4/darkmode3.webp)

å¦‚ä¸Šå°±æ˜¯è¿™ä¸€éƒ¨åˆ†å­¦ä¹ åˆ°çš„æŠ€å·§

å®Œæˆä»£ç å¦‚ä¸‹ ï¼š

``` swift
struct HomeScreen: View {
    @AppStorage("shouldUseDarkMode") var shouldUseDarkMode = false
    @State var tab: Tab = .settings
    var body: some View {
        NavigationStack {
            TabView(selection: $tab) {
                ForEach(Tab.allCases, id: \.self) { $0 }
            }
//            .environment(\.colorScheme, shouldUseDarkMode ? .dark : .light)
            .preferredColorScheme(shouldUseDarkMode ? .dark : .light)
        }
    }
}
```

#### ç¼–ç å’Œè§£ç (åºåˆ—åŒ–ç±»å‹Json)

ä¸Šè¿°ä»£ç éƒ½æ˜¯ç®€å•çš„ç”¨@AppStorage å­˜å‚¨æ™®é€šæ•°æ®ç±»å‹,ä½†æ˜¯ å¦‚æœå®ƒæ˜¯ä¸€ä¸ªPersonå¯¹è±¡çš„è¯è¯¥å¦‚ä½•å­˜å‚¨å‘¢ï¼Ÿ

å¦‚æœæƒ³è¢«@AppStorageä½¿ç”¨,ä¹Ÿå°±æ˜¯UserDefaultä½¿ç”¨åˆ™å¿…é¡»è¦å®ç°ç¼–ç å’Œè§£ç ,æœ‰ç‚¹ç±»ä¼¼NSObjectè¦æ˜¯Copyåè®®ä¸€æ ·ç±»ä¼¼çš„æ“ä½œ,åœ¨swifté‡Œé¢æ˜¯ä¸€ä¸ªåˆæˆåè®®å«`Codable`,è¿™ä¸ª`Codable`ä¸­åŒ…å«Decodable & Encodable

å¦‚ä¸‹ä»£ç :

``` swift
struct Person : Codable {
    var name: String
    var age: Int
}

//ç¼–ç  è°ƒç”¨æ—¶
let person = Person(name: "sunyazhou.com", age: 33)
let data: Data = try! JSONEncoder().encode(person)
let string: String = try! String(data: data, encoding: .utf8) ?? ""
print(string)  //è¾“å‡º; {"name":"sunyazhou.com","age":33}

//è§£ç è°ƒç”¨æ—¶
let string = """
{"name":"sunyazhou.com","age":33}
"""
let data: Data = string.data(using: .utf8)!
let person: Person = try! JSONDecoder().decode(Person.self, from: data)
print(person)  //è¾“å‡º:Person(name: "sunyazhou.com", age: 33)

```

#### å®ç°Codableåè®®è‡ªåŠ¨ç”Ÿæˆ`Decoder`å’Œ`Encoder`

Xcode14ä»¥åä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªstructçš„ç¼–ç å’Œè§£ç æ–¹å¼

å½“æˆ‘ä»¬ æŒ‰ä½`command+å·¦é”®`ç‚¹å‡»Pseronçš„ç»“æ„ä½“çš„æ—¶å€™ä¼šå‡ºç°ä¸€ä¸ªåˆ—è¡¨

å¦‚ä¸‹å›¾:

![](/assets/images/20230805LearnSwiftUIChapter4/RawRepresentable.gif)

ç‚¹å‡»AddExplicitCodableImplementationé€‰é¡¹ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬ä¸ºPersonç”Ÿæˆå¦‚ä¸‹.

``` swift
struct Food: Equatable, Identifiable, Codable {
    var id = UUID()
    var name: String
    var image: String
    
    @Suffix("å¤§å¡") var calorie : Double = .zero
    @Suffix("g") var carb      : Double = .zero
    @Suffix("g") var fat       : Double = .zero
    @Suffix("g") var protein   : Double = .zero
    
    enum CodingKeys: CodingKey {
        case id
        case name
        case image
        case calorie
        case carb
        case fat
        case protein
    }
    
    init(from decoder: Decoder) throws {
        let container: KeyedDecodingContainer<Food.CodingKeys> = try decoder.container(keyedBy: Food.CodingKeys.self)

        self.id = try container.decode(UUID.self, forKey: Food.CodingKeys.id)
        self.name = try container.decode(String.self, forKey: Food.CodingKeys.name)
        self.image = try container.decode(String.self, forKey: Food.CodingKeys.image)
        self._calorie = try container.decode(Suffix.self, forKey: Food.CodingKeys.calorie)
        self._carb = try container.decode(Suffix.self, forKey: Food.CodingKeys.carb)
        self._fat = try container.decode(Suffix.self, forKey: Food.CodingKeys.fat)
        self._protein = try container.decode(Suffix.self, forKey: Food.CodingKeys.protein)

    }

    func encode(to encoder: Encoder) throws {
        var container: KeyedEncodingContainer<Food.CodingKeys> = encoder.container(keyedBy: Food.CodingKeys.self)

        try container.encode(self.id, forKey: Food.CodingKeys.id)
        try container.encode(self.name, forKey: Food.CodingKeys.name)
        try container.encode(self.image, forKey: Food.CodingKeys.image)
        try container.encode(self._calorie, forKey: Food.CodingKeys.calorie)
        try container.encode(self._carb, forKey: Food.CodingKeys.carb)
        try container.encode(self._fat, forKey: Food.CodingKeys.fat)
        try container.encode(self._protein, forKey: Food.CodingKeys.protein)
    }
}
```

> `@Suffix()`æ˜¯æˆ‘è‡ªå®šä¹‰çš„ä¸€ä¸ªå±æ€§å°è£…å™¨ç”¨äºç»™æŸä¸ªå˜é‡å­—ç¬¦æ·»åŠ é»˜è®¤çš„åç¼€,è¿™é‡Œå¯ä»¥ä¸ç”¨careå®ƒ.

è¿™é‡Œæ³¨æ„æœ‰çš„xcodeä¸ä¼šç”Ÿæˆè¿™ä¹ˆå…¨é¢æ˜¯å› ä¸ºæœ‰å¾ˆå¤šextension æ¯”å¦‚:

``` swift
extension Food: Codable{

}
```	
è¿™çš„ä»£ç æ˜¯åœ¨æ‰©å±•é‡Œå†™çš„ä¸æ˜¯åœ¨Personå£°æ˜çš„åœ°æ–¹å†™çš„Xcodeä¼šæ‰¾ä¸åˆ°,æœ€å¥½çš„æ–¹å¼è‚¯å®šæ˜¯å†™åœ¨ä¸€èµ·æœ€å¥½.

# æ€»ç»“

ä»¥ä¸Šæ˜¯å­¦ä¹ å®Œç¬¬å››ç« çš„å†…å®¹æ€»ç»“,æ½¦è‰äº†äº›,å¸Œæœ›é€šè¿‡è®°å½•èƒ½è®©ä»¥åä½¿ç”¨çš„æ—¶å€™å°è±¡æ›´åŠ æ·±åˆ»ä¹Ÿæ–¹ä¾¿åˆ†äº«ç»™å…¶å®ƒéœ€è¦çš„äºº.

[ç¬¬å››ç« demo](https://github.com/sunyazhou13/FoodPicker)	



URL: https://sunyazhou.com/2023/08/learnswiftuichapter3/index.html.md
Published At: 2023-08-05 06:13:00 +0000

# SwiftUIç¬¬ä¸‰ç« å­¦ä¹ æ€»ç»“

![](/assets/images/20230604LearnSwiftUIChapter1/swiftuilogo.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## SwiftUIè¯¾ç¨‹

æœ€è¿‘åšæŒå­¦ä¹ swiftUIå·²ç»å­¦ä¹ åˆ°ç¬¬ä¸‰ç« äº†,æŠŠä¸€äº›é‡è¦çš„å†…å®¹éƒ½è®°å½•ä¸‹æ¥

### ä¸»è¦å†…å®¹åŒ…æ‹¬

* presentå­VC
* ç”¨enumç®¡ç†icon
* æ³¨é‡Šä¸­å¯ä»¥ä½¿ç”¨markdown
* extensionå†™æ³•

### presentå­VC

åœ¨swiftUIä¸­ä¸èƒ½è¯´æ˜¯å¼¹å‡ºVCè€Œæ˜¯å¼¹å‡º some Viewçš„è§†å›¾.

``` swift
var foodDetailView: some View {
        VStack {
            if (shouldShowInfo) {
                Grid(horizontalSpacing: 12, verticalSpacing: 12) {
                    GridRow {
                        Text("è›‹ç™½è´¨")
                        Text("è„‚è‚ª")
                        Text("ç¢³æ°´")
                    }.frame(minWidth: 40)
                    
                    Divider()
                        .gridCellUnsizedAxes(.horizontal)
                        .padding(.horizontal, -10)
                    
                    GridRow {
                        Text(selectedFood!.$protein)
                        Text(selectedFood!.$carb)
                        Text(selectedFood!.$fat)
                    }
                }
                .font(.title3)
                .padding(.horizontal)
                .padding()
                .roudedRectBackground()
                .transition(.moveUpWithOpacity)
            }
        }
        .maxWidth()
        .clipped()
    }
```

å…¶å®å°±æ˜¯åˆ›å»ºä¸€ä¸ªViewå°±å®Œäº‹äº†æ ¹æœ¬ä¸éœ€è¦å¤æ‚çš„æ“ä½œ,æ²¡æœ‰ æˆ‘ä»¬åœ¨UIKitä¸­çš„pushå’Œpop,æˆ–è€…presentå’Œdismissã€‚è¿™é‡ŒåŸºæœ¬éƒ½æ˜¯ä¸€äº›è§†å›¾åŸºäºçŠ¶æ€çš„ç›‘å¬ showä¸showæ”¹å˜äº†æˆ‘ä»¬ä¹‹å‰çš„ä½¿ç”¨æ–¹å¼.

### ç”¨enumç®¡ç†icon

å½“ä½¿ç”¨iconå¤šäº†çš„æ—¶å€™éœ€è¦ç”¨å˜é‡æ¥ä»ç»Ÿä¸€çš„æ•°æ®æºå–å›¾,å› ä¸ºswiftçš„æšä¸¾å¯ä»¥å£°æ˜å„ç§ç±»å‹,ä¸€èˆ¬éƒ½æ˜¯å­—ç¬¦ä¸².æ‰€ä»¥å­—ç¬¦ä¸²æšä¸¾å˜é‡å°±åº”å£°è€Œå‡º 

``` swift
import SwiftUI

enum SFSymbol: String {
    case pencil
    case plus = "plus.circle.fill"
    case chevronUp = "chevron.up"
    case chevronDown = "chevron.down"
    case xmark = "xmark.circle.fill"
    case forkAndKnife = "fork.knife"
    case info = "info.circle.fill"
}

extension SFSymbol : View {
    var body: Image {
        Image(systemName: rawValue)
    }
    
    func resizable() -> Image {
        self.body.resizable()
    }
}

extension Label where Title == Text, Icon == Image {
    init(_ text: String, systemImage: SFSymbol) {
        self.init(text, systemImage: systemImage.rawValue)
    }
}
```

ä½¿ç”¨çš„æ—¶å€™

``` swift
var addButton : some View {
        Button {
            sheet = .newFood { food.append($0) }
        } label: {
            SFSymbol.plus  //ç›´æ¥ä½¿ç”¨
                .font(.system(size: 50))
                .padding()
                .symbolRenderingMode(.palette)
                .foregroundStyle(.white, Color.accentColor.gradient)
        }
    }
```

####  æ³¨é‡Šä¸­å¯ä»¥ä½¿ç”¨markdown

å…ˆçœ‹ä¸¤ä¸ªå‡½æ•°

``` swift
/// - Tag:push
func push(to alignment: TextAlignment) -> some View {
    switch alignment {
    case .leading:
        return frame(maxWidth: .infinity, alignment:  .leading)
    case .center:
        return frame(maxWidth: .infinity, alignment:  .center)
    case .trailing:
        return frame(maxWidth: .infinity, alignment:  .trailing)
    }
}
    
/// ä½¿ç”¨æœ€å¤§å®½åº¦ Shortcut:[push(to:.center)](x-source-tag://push)
func maxWidth() -> some View {
    push(to: .center)
}
```

> æ³¨æ„: /// ä½¿ç”¨æœ€å¤§å®½åº¦ Shortcut:\[push(to:.center)\](x-source-tag://push)

ä½ å‘ç°æ²¡æœ‰æ³¨é‡Šé»˜è®¤æ”¯æŒäº†markdown

![](/assets/images/20230805LearnSwiftUIChapter3/note1.webp)

è“è‰²è·³è½¬æ‹¦æˆªçš„å‡½æ•°å£°æ˜ `/// - Tag:push`, `Tag`å¿…é¡»å¤§å°å†™å†™æ¸…æ¥š,ä¸èƒ½æœ‰ç©ºæ ¼,ä½¿ç”¨`x-source-tag`çš„`scheme`è·³è½¬è‡³`push`

![](/assets/images/20230805LearnSwiftUIChapter3/note2.webp)

### extensionå†™æ³•

å½“ç»™swiftå·¥ç¨‹å†™å¾ˆå¤šæ‰©å±•ä¹‹å,ç±»ä¼šå˜å¾—è¶Šæ¥è¶Šå¤šå¹¶ä¸”è¶Šæ¥è¶Šä¸å¥½ç®¡ç†,ä¸ºäº†è§£å†³ä¸å¥½ç®¡ç†,å¯è¯»æ€§å·®é—®é¢˜

æˆ‘ä»¬çº¦å®šä¿—æˆ,**å½“åˆ›å»ºswiftæ‰©å±•çš„æ—¶å€™ä½¿ç”¨å°¾éƒ¨æ–‡ä»¶è¿½åŠ +å·æ¥å‘½å**

å¦‚ä¸‹å›¾:  

![](/assets/images/20230805LearnSwiftUIChapter3/extension.webp)

# æ€»ç»“

ç¬¬ä¸‰ç« çš„å†…å®¹ç‰¹åˆ«æ¼«é•¿,éœ€è¦æœ‰è€å¿ƒ, ä¸­é—´è¿˜è®²äº†ä¸€ä¸ªè¡¨å•,æˆ‘æ²¡æœ‰åœ¨è¿™é‡Œè¡¨è¿°æ˜¯å› ä¸º ä¸œè¥¿å¤šè€Œä¸”è¿˜å¤æ‚,éœ€è¦å¤§å®¶è®¤çœŸçœ‹è§†é¢‘æ¯”æˆ‘åœ¨è¿™é‡Œå†™æ€»ç»“è¦æ›´æœ‰è¯´æœåŠ›. 

[ç¬¬ä¸‰ç« è¯¾ç¨‹é“¾æ¥](https://www.bilibili.com/video/BV1A84y147o8/?spm_id_from=333.880.my_history.page.click&vd_source=9309f71afe97e633abeadc8407870e76)  
[å·¥ç¨‹ä»£ç ](https://github.com/jane-chao/SwiftUIBeginnerCourse)  
[æœ¬æ–‡å®Œç»“ä»£ç ç¤ºä¾‹](https://github.com/sunyazhou13/FoodPicker)




URL: https://sunyazhou.com/2023/08/ios17widget/index.html.md
Published At: 2023-08-04 06:56:00 +0000

# å¼€å‘iOS17å°ç»„ä»¶

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# iOS17å…³äºå°ç»„ä»¶çš„WWDC

[WWDC23](https://developer.apple.com/wwdc23/)ä¸­æä¾›äº†ä¸€äº›å…³äºå°ç»„ä»¶çš„è§†é¢‘,æœ€è¿‘å¼€å‘å°ç»„ä»¶é‡åˆ°äº†ä¸€äº›é—®é¢˜,åœ¨è¿™é‡Œè§£è¯»ä¸€ä¸‹è§†é¢‘ä¸­çš„å†…å®¹

## Bring widgets to new places

[Bring widgets to new places](https://developer.apple.com/videos/play/wwdc2023/10027/?time=180)

The widget ecosystem is expanding: Discover how you can use the latest WidgetKit APIs to make your widget look great everywhere. We'll show you how to identify your widget's background, adjust layout dynamically, and prepare colors for vibrant rendering so that your widget can sit seamlessly in any environment.

å°éƒ¨ä»¶ç”Ÿæ€ç³»ç»Ÿæ­£åœ¨æ‰©å±•:äº†è§£å¦‚ä½•ä½¿ç”¨æœ€æ–°çš„WidgetKit apiä½¿æ‚¨çš„å°éƒ¨ä»¶åœ¨ä»»ä½•åœ°æ–¹çœ‹èµ·æ¥éƒ½å¾ˆæ£’ã€‚æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•è¯†åˆ«å°éƒ¨ä»¶çš„èƒŒæ™¯ï¼ŒåŠ¨æ€è°ƒæ•´å¸ƒå±€ï¼Œå¹¶ä¸ºå……æ»¡æ´»åŠ›çš„æ¸²æŸ“å‡†å¤‡é¢œè‰²ï¼Œä»¥ä¾¿æ‚¨çš„å°éƒ¨ä»¶å¯ä»¥åœ¨ä»»ä½•ç¯å¢ƒä¸­æ— ç¼åœ°è¿è¡Œã€‚



###  Transition to content margins

[ Transition to content margins](https://developer.apple.com/videos/play/wwdc2023/10027/?time=104)

ä» ios14 å¼•å…¥æ¡Œé¢å°ç»„ä»¶ï¼Œååˆåœ¨ ios16 å¢åŠ é”å±å°ç»„ä»¶ï¼Œç°åœ¨ï¼Œå®ƒå¯ä»¥æ‰©å±•åˆ°ï¼šmac æ¡Œé¢ã€pad é”å±ã€iphone StandBy ä»¥åŠ iwatch çš„ new Smart Stackã€‚æ‰€ä»¥ç¡®ä¿ä¸€æ¬¡ç¼–ç ååœ¨å„ä¸ªä½ç½®éƒ½èƒ½è¡¨ç°å‡ºè‰²æ˜¯ä»¶å¾ˆé‡è¦çš„äº‹ã€‚æˆ‘çš„ç†è§£å°±æ˜¯iOS, iPadOS, WatchOS, macOS å…¨è‹¹æœå¹³å°é€šç”¨é€‚é….ä¹Ÿå°±æ˜¯è¯´ç¼–ç ä¸€æ¬¡å°ç»„ä»¶å¯ä»¥è¿è¡Œåˆ°æ‰€æœ‰è‹¹æœçš„ç³»ç»Ÿä¸Š.

ä»¥ watchOS çš„ safe area ä¸ºä¾‹:

* watchOS9 and below: ä½¿ç”¨äº†system-defined çš„ safe area ä»¥é¿å…å°ç»„ä»¶å¤ªè´´è¾¹ã€‚ä½†å¼€å‘è€…å¯ä»¥é€šè¿‡`Color.blue.ignoresSafeArea()` æ¥å¿½ç•¥å®ƒ
* watchOS10 and above: æ–¹æ³•`ignoresSafeArea()`ä¸åœ¨èµ·ä½œç”¨ï¼Œè€Œåº”è¯¥å¯¹ `widget configuration` åº”ç”¨ `contentMarginsDisabled`ä¿®æ”¹å™¨æ¥å®ç°è¿™ä¸€ç›®çš„

![](/assets/images/20230804iOS17Widget/widget1.gif)

![](/assets/images/20230804iOS17Widget/widget2.webp)
![](/assets/images/20230804iOS17Widget/widget3.webp)

### Add a removable background

ç°æœ‰çš„ accessory family å°ç»„ä»¶å¯ä»¥è‡ªåŠ¨é€‚é…åˆ° ipad çš„é”å±ä¸Šã€‚ipad can also show system small widgets right alongside themã€‚ ä½†ä¼šæœ‰ä¸€ä¸ªåŠé€æ˜çš„èƒŒæ™¯ï¼Œå¦‚æœæƒ³å»æ‰å®ƒï¼Œå¯ä»¥ä½¿ç”¨ï¼š

``` swift
ZStack {
    // TODO
}.containerBackground(for: .widget) {
    Color.gameBackground
}
```

è¿™æ ·ç³»ç»Ÿå°±å¯ä»¥æ ¹æ®æ˜¾ç¤ºçš„ä½ç½®æ¥è‡ªåŠ¨å†³å®šæ˜¯å¦è¦æ˜¾ç¤ºèƒŒæ™¯ã€‚å¯¹äºï¼ŒwatchOS ä¸Šçš„ç»„ä»¶ä¹Ÿä¸€æ ·ï¼Œç³»ç»Ÿä¼šé»˜è®¤ç»™äºˆä¸€ä¸ªåŠé€æ˜èƒŒæ™¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼äº¤ç»™ç³»ç»Ÿæ¥è¿›è¡Œå¤„ç†èƒŒæ™¯ï¼Œä»¥å±•ç¤ºä¸°å¯Œå¤šå½©çš„æ ·å¼ã€‚

å¦‚æœç¡®å®ä¸æƒ³ç³»ç»Ÿå¯¹æŸäº›ç»„ä»¶(å¦‚ï¼šiosä¸Šçš„æ¡Œé¢ç…§ç‰‡ç»„ä»¶)ä½¿ç”¨å¯ç§»é™¤çš„èƒŒæ™¯ï¼Œå¯ä»¥åœ¨å°ç»„ä»¶çš„ widget configuration ä¸Šåº”ç”¨ `containerBackgroundRemovable(false)` ä¿®æ”¹å™¨ã€‚

### Dynamically adjust layout

å½“ä½¿ç”¨ StandBy mode æ—¶ï¼Œå°ç»„ä»¶ä¼šè¢«æ”¾å¤§ï¼Œå¹¶ä¸”ä¼šç§»é™¤èƒŒæ™¯ã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥æ£€æŸ¥èƒŒæ™¯æ˜¯å¦è¢«ç§»é™¤æ¥è¿›è¡Œé€‚é…ï¼š

``` swift
@Environment(\.showsWidgetContainerBackground) var showsWidgetBackground
```

### Prepare for vibrant rendering

åœ¨ ipad lock screen ä¸Šçš„å°ç»„ä»¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šæ ¹æ®éœ€è¦è°ƒæ•´é¥±å’Œåº¦(desaturate)ï¼Œä¹Ÿå°±æ˜¯è¯´å°ç»„ä»¶å¯èƒ½éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¸åŒçš„è‰²å½©ã€èƒŒæ™¯ç­‰æ ·å¼å¾®è°ƒï¼Œæ­¤æ—¶å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ¥æ£€æŸ¥æ¸²æŸ“æ˜¯å¦ä¸º .vibrant æ¥è¿›è¡Œé€‚é…ï¼š

``` swift
@Environment(\.widgetRenderingMode) var widgetRender 
```

## Adding interactivity to widgets and Live Activities

[Adding interactivity to widgets and Live Activities
](https://developer.apple.com/documentation/WidgetKit/Adding-interactivity-to-widgets-and-Live-Activities)

### AppIntent 

è¿™å¯èƒ½æ˜¯æ­¤æ¬¡WWDCä¸­å°ç»„ä»¶å¼€å‘æœ€æ„Ÿå…´è¶£çš„å†…å®¹ä¹‹ä¸€äº†ï¼Œå®ƒç®€åŒ–äº†äº¤äº’å¼å°ç»„ä»¶çš„ç°æœ‰å®ç°æ–¹å¼ï¼ŒåŒæ—¶ä¹Ÿå¯¹ç°æœ‰çš„äº¤äº’æ•ˆæœæœ‰äº†æ˜æ˜¾çš„æ”¹å–„ã€‚

ä» iOS 17, iPadOS 17, ä»¥åŠ macOS 14 å¼€å§‹ï¼Œwidgets å’Œ Live Activities å¯ä»¥ä½¿ç”¨ buttons å’Œ toggles åœ¨ä¸å¯åŠ¨ä¸» app çš„æƒ…å†µä¸‹æä¾›ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ã€‚  
> æ³¨æ„ï¼šä»…ä»… Button å’Œ Toggle ç»„ä»¶æ”¯æŒï¼Œéœ€è¦å¼•å…¥import AppIntentsæ¨¡å—  

ä»¥ä¸‹ç±»å‹çš„å°ç»„ä»¶åœ¨æ–°ç‰ˆæœ¬ sdk ä¸­åŒ…å«æ­¤ç‰¹æ€§çš„ Button å’Œ Toggleï¼š

``` swift
WidgetFamily.systemSmall
WidgetFamily.systemMedium
WidgetFamily.systemLarge
WidgetFamily.systemExtraLarge
WidgetFamily.accessoryCircular on iPhone and iPad
WidgetFamily.accessoryRectangular on iPhone and iPad
```

åœ¨å…·ä½“å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦å®ç°è‡ªå·±çš„ AppIntent å¯¹è±¡ï¼š

``` swift
struct MyIntent : AppIntent {
    static var title: LocalizedStringResource = "title"

    func perform() async throws -> some IntentResult {
        await MyActionWhichMaybeAsync()
        return .result()
    }
}
```

è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼š  

* å½“ perform() è¿”å›åï¼Œç³»ç»Ÿä¼šç«‹å³è§¦å‘ timeline æ›´æ–°
* æ‰€ä»¥ perform ä¸­å¦‚æœæ˜¯å¼‚æ­¥æ“ä½œæ—¶ï¼Œéœ€è¦ await å¼‚æ­¥æ“ä½œç»“æŸ
* éœ€è¦åœ¨ perform ä¸­æ›´æ–°å°ç»„ä»¶æ•°æ®å¹¶æŒä¹…åŒ–

AppIntent å·¥ä½œçš„æœ¬è´¨å°±æ˜¯ç”±ç³»ç»Ÿè§¦å‘ timeline æ¥å®ç°å°ç»„ä»¶è§†å›¾(ä¸å¯å˜å¯¹è±¡)æ›´æ–°ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ[å®˜æ–¹ä»£ç ç¤ºä¾‹](https://developer.apple.com/documentation/WidgetKit/Adding-interactivity-to-widgets-and-Live-Activities)ã€‚

### Preview

è¿™é‡Œæœ‰ä¸ªæœ‰è¶£çš„åœ°æ–¹å°±æ˜¯æ›´æ–°äº† preview çš„æ–¹å¼ï¼šç›¸æ¯”åŸæ¥çš„ï¼š

``` swift
struct MyWidgetView_Previews: PreviewProvider {
   static var previews: some View {
       MyWidgetView().previewContext(WidgetPreviewContext(family: .systemLarge))
   }
}
```

å¢åŠ äº† timeline çš„æ”¯æŒï¼Œå¯ä»¥æ–¹ä¾¿çš„è§‚å¯ŸåŠ¨ç”»æ•ˆæœç­‰ï¼š

``` swift
#Preview(as: WidgetFamily.systemLarge) {
    // TODOï¼šview
} timeline: {
    // TODOï¼štimeline list
}
```

### Animating data updates in widgets and Live Activities

[Animating data updates in widgets and Live Activities](https://developer.apple.com/documentation/WidgetKit/Animating-data-updates-in-widgets-and-live-activities)

æŠŠ Live Activity ä¸­çš„æ•ˆæœæ‰©å±•åˆ°äº† Widget ä¸Šï¼ŒLive Activity ä¸­çš„ timer ç±»å‹ Text è‡ªå¸¦ç¿»é¡µç‰¹æ•ˆï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨çš„è¯å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å»æ‰ï¼š

``` swift
Text(Date.now, style: .timer).contentTransition(.identity)
```

# æ€»ç»“

iOSå°ç»„ä»¶æœ‰ä¸€äº›ç»†å¾®æ”¹åŠ¨çš„,ç»è¿‡WWDCåˆ†æ æˆ‘ä»¬è¿˜æ˜¯éœ€è¦è®¤çœŸå­¦ä¹ çš„.




URL: https://sunyazhou.com/2023/08/swiftuiextention1/index.html.md
Published At: 2023-08-02 09:13:00 +0000

# SwiftUIå¯ç”¨æ€§æ£€æµ‹,è§£å†³å°ç»„ä»¶iOS17 availableé—®é¢˜

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# é—®é¢˜

![](/assets/images/20230802swiftuiextention1/WidgetiOS17.webp)

æœ€è¿‘åœ¨å¼€å‘iOS17ä¸Šçš„å°ç»„ä»¶ä½¿ç”¨SwiftUIæ¡†æ¶,ç¬¬ä¸€æ¬¡è¿›è¡Œå·¥ç¨‹åŒ–é‡åˆ°ä¸€ä¸ª apiå¯ç”¨æ€§æ£€æµ‹é—®é¢˜

ä¹‹å‰çš„å°ç»„ä»¶æ˜¯é”å±å°ç»„ä»¶,åœ¨iOS16ä¸Šè¿è¡Œ,æœ€è¿‘iOS17æ›´æ–°äº†æ–°å†…å®¹,å¯¼è‡´è¿è¡Œèµ·æ¥ä¹‹åè¢«æç¤ºéœ€è¦å¢åŠ 

``` swift
containerBackground(.red.gradient, for: .widget)
```

è¿™æ ·çš„é€‚é…å®¹å™¨,è¿™å°±å¯¼è‡´ åœ¨iOS16ä¸Šçš„api `some View`è¦ä½¿ç”¨iOS17çš„API

``` swift
ZStack(alignment: .bottomTrailing) {
        Image("widget_clock")
            .resizable()
            .aspectRatio(contentMode: .fill)
        
        VStack(spacing: 0) {
            Text("\(entry.date.hour)")
            Text("\(entry.date.min)")
        }
        .font(.system(size: 60, weight: .bold))
        .foregroundColor(.white)
    }
    . if #available(iOSApplicationExtension 17.0, *) {   //è¿™è¡Œä»£ç æŠ¥é”™ å‘ŠçŸ¥æˆ‘ä¸èƒ½è¿™æ ·åš ä¸è¯†åˆ«if 
            $0.containerBackground(.red.gradient, for: .widget)
        } else {
            // Fallback on earlier versions
        }
```

ç ”ç©¶åŠå¤© å‘ç°è¿˜å¾—ç»™viewæ‰©å±•ä¸€ä¸ªè¿”å›è‡ªå·±çš„å‡½æ•°æ¥é“¾å¼é…ç½®.

è¿™å†™æ³•çœŸæ˜¯ä¸å¤ªæ˜ç™½å’‹å†™åˆé€‚æœ€ç»ˆåªèƒ½ ç»™Viewå†™ä¸ªextension


``` swift
import Foundation
import SwiftUI

public extension View {
    func modify<Content>(@ViewBuilder _ transform: (Self) -> Content) -> Content {
        transform(self)
    }
}

```

ç„¶åä½¿ç”¨çš„æ—¶å€™ 

``` swift
.modify{
    if #available(iOSApplicationExtension 17.0, *) {
        $0.containerBackground(.red.gradient, for: .widget)
    } else {
        // Fallback on earlier versions
    }
}
```

è¿™æ ·åœ¨swiftUIçš„ body é‡Œé¢æ‰èƒ½é¡ºåˆ©ç¼–è¯‘é€šè¿‡

å®Œæ•´çš„æµ‹è¯•ä»£ç å¦‚ä¸‹ 

``` swift
struct MomentsWidget: Widget {
    let kind: String = WidgetType.moments.kind
    
    var body: some WidgetConfiguration {
        IntentConfiguration(kind: kind, intent: ConfigurationIntent.self, provider: MomentsWidgetProvider()) { entry in
            MomentsWidgetEntryView(entry: entry)
                .modify{  //è¿™é‡Œæ˜¯é€‚é…ä»£ç 
                    if #available(iOSApplicationExtension 17.0, *) {
                        $0.containerBackground(.white.gradient, for: .widget)
                    } else {
                        // Fallback on earlier versions
                    }
                }
        }
        // è¿™é‡Œå®šä¹‰çš„å°±æ˜¯å°ç»„ä»¶å¼¹å‡ºç•Œé¢ä¸­çš„æ ‡é¢˜ä¸å‰¯æ ‡é¢˜
        .configurationDisplayName("å¥½å‹åŠ¨æ€")
        .description("é€šè¿‡è¯¥ç»„ä»¶å¯ä»¥åˆ›å»ºå¥½å‹åŠ¨æ€åˆ—è¡¨")
        .supportedFamilies([.systemLarge])
    }
}
```

# æ€»ç»“

1.å†™swiftUIæ„Ÿè§‰åƒæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦UIKitæ—¶å€™é‚£æ · ä¸€å¼€å§‹æ¯”è¾ƒå›°éš¾æ—¶å› ä¸ºå¯¹å®ƒç¼ºå°‘è®¤çŸ¥  
2.swiftUIçš„æ¡†æ¶è®¾è®¡åº”è¯¥æŠŠè¿™ç§é—®é¢˜è€ƒè™‘è¿›å» æä¾›ä¸€ä¸ªä¸“ç”¨çš„API,æˆ–è€…è‡³å°‘ä¸è¦è®©Xcodeçš„æç¤ºå‡ºé”™å§,Xcodeæä¾›çš„ä¸œè¥¿éƒ½å‡ºé”™åªèƒ½è¯´æ˜è¿™ä¸ªä¸œè¥¿è¿˜ä¸æˆç†Ÿ.

[å‚è€ƒstackoverflow](https://stackoverflow.com/questions/76595240/widget-on-ios-17-beta-device-adopt-containerbackground-api)


URL: https://sunyazhou.com/2023/06/learnswiftuichapter2/index.html.md
Published At: 2023-06-18 10:52:00 +0000

# SwiftUIç¬¬äºŒç« å­¦ä¹ æ€»ç»“

![](/assets/images/20230604LearnSwiftUIChapter1/swiftuilogo.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# SwiftUIè¯¾ç¨‹

æœ€è¿‘åœ¨å¬Bç«™ä»¥ä¸ºæ¥è‡ªç¥–å›½å®å²›å°æ¹¾çœçš„ä¸€ä¸ªå¥³åšä¸»(å£°éŸ³å¾ˆå—²dia)è®²è§£SwiftUIè¯¾ç¨‹,è®²çš„ä¸é”™æŠŠå­¦ä¹ çš„å†…å®¹è®°å½•ä¸‹æ¥:

## ä¸»è¦å†…å®¹åŒ…å«

* @propertyWrapper
* VStackã€HStackã€ZStackç­‰ä½¿ç”¨
* å°è£…extensionå¤„ç†é¢œè‰²ã€è½¬åœºåŠ¨ç”»ã€ShapeStyle
* @ViewBuilderã€Groupå®¹å™¨ä½¿ç”¨ã€Gridçš„è¡Œåˆ—ä½¿ç”¨


#### å±æ€§å°è£…å™¨

åˆ›å»ºäº†ä¸€ä¸ª`SwiftUI`çš„ç±»`SuffixWrapper.swift`

``` swift
//
//  SuffixWrapper.swift
//  FoodPicker
//
//  Created by sunyazhou on 2023/6/18.
//

import Foundation
import SwiftUI

@propertyWrapper struct Suffix: Equatable {
    var wrappedValue: Double
    private let suffix: String
     
    init(wrappedValue: Double, _ suffix: String) {
        self.wrappedValue = wrappedValue
        self.suffix = suffix
    }
    
    var projectedValue : String {
        wrappedValue.formatted() + " \(suffix)"
    }
}
```

> è¿™é‡Œè®°å½•ä¸€ä¸‹é‡åˆ°çš„å‘æ˜¯`projectedValue `

åœ¨ä½¿ç”¨çš„ä»£ç çš„æ—¶å€™å¦‚æœæƒ³è®©å·¦å³Doubleç±»å‹çš„å˜é‡æä¾›ä¸€ä¸ª å­—ç¬¦ä¸² ä»¥` g`ç»“å°¾çš„å­—ç¬¦ä¸²å˜é‡å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§å°è£…å™¨.

``` swift
selectedFood.$protein  //ç”¨$åŠ å˜é‡åç§°å°±æ˜¯è®¿é—®çš„projectedValue
```

è¿™ä¸ªä¸»è¦çœ‹ä¸‹ Foodæ¨¡å‹ä»£ç å¤§å®¶å¯ä»¥ä¸€ç›®äº†ç„¶æˆ‘è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€äº†.

``` swift
import Foundation

struct Food: Equatable {
    var name: String
    var image: String
    
    @Suffix("å¤§å¡") var calorie : Double = .zero
    @Suffix("g") var carb      : Double = .zero
    @Suffix("g") var fat       : Double = .zero
    @Suffix("g") var protein   : Double = .zero
    
    static let examples = [
        Food(name: "æ¼¢å ¡", image: "ğŸ”", calorie: 294, carb: 14, fat: 24, protein: 17),
        Food(name: "æ²™æ‹‰", image: "ğŸ¥—", calorie: 89, carb: 20, fat: 0, protein: 1.8),
        Food(name: "æŠ«è–©", image: "ğŸ•", calorie: 266, carb: 33, fat: 10, protein: 11),
        Food(name: "ç¾©å¤§åˆ©éºµ", image: "ğŸ", calorie: 339, carb: 74, fat: 1.1, protein: 12),
        Food(name: "é›è…¿ä¾¿ç•¶", image: "ğŸ—ğŸ±", calorie: 191, carb: 19, fat: 8.1, protein: 11.7),
        Food(name: "åˆ€å‰Šéºµ", image: "ğŸœ", calorie: 256, carb: 56, fat: 1, protein: 8),
        Food(name: "ç«é‹", image: "ğŸ²", calorie: 233, carb: 26.5, fat: 17, protein: 22),
        Food(name: "ç‰›è‚‰éºµ", image: "ğŸ„ğŸœ", calorie: 219, carb: 33, fat: 5, protein: 9),
        Food(name: "é—œæ±ç…®", image: "ğŸ¥˜", calorie: 80, carb: 4, fat: 4, protein: 6),
    ]
}
```

> å¸¦@Suffixå…³é”®å­—å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„å±æ€§å°è£…å™¨,ä¸ºæ™®é€šå˜é‡æä¾›ä¸€ä¸ªå­—ç¬¦ä¸²å¸¦`g`åç¼€çš„å­—ç¬¦æ–¹æ³•

####  VStackã€HStackã€ZStackç­‰ä½¿ç”¨

ä»–ä»¬åˆ†åˆ«æ˜¯:

* çºµè½´
* æ¨ªè½´
* Zè½´

> æ³¨æ„: å®ƒæœ€å¤šæ”¯æŒ10å±‚è§†å›¾,å¦‚æœè¶…è¿‡äº†è¯·ä½¿ç”¨Groupåœˆä¸€ä¸‹.

è¿™é‡Œè¯´å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„ç‚¹

å½“æ­é…è¿™äº›è§†å›¾ä½¿ç”¨çš„æ—¶å€™ é¿å…ä¸äº†å­è§†å›¾ä¹‹é—´è¦ç”¨é—´è·,SwiftUIæä¾›äº†é»˜è®¤çš„é—´è·å¯¹è±¡

``` swift
Spacer().layoutPriority(1)  //æ³¨æ„è¿™é‡Œçš„layoutPriority(1)
```

å½“æˆ‘ä»¬ç•™æœ‰ç©ºç™½å¤§å°çš„ä½ç½®éœ€è¦å¡«å……æ—¶å¯ä»¥ä½¿ç”¨`Spacer()`,è¿™ç©æ„æœ‰ä¸ªå‘å°±æ˜¯å¦‚æœå¤–ä¸å„ç§Stackä¸ç»™å®šå®ƒå¤§å°ä»–å°†å¹³å‡å–æ‰€æœ‰Stackä¸­æœ€å°çš„. éœ€è¦ç»™å®ƒæé«˜ä¼˜å…ˆçº§è®©å®ƒæå‰å¸ƒå±€çŸ¥é“è¿˜å‰©ä½™å¤šå¤§ç©ºé—´éœ€è¦æ’‘æ»¡,æ‰ä¸ä¼šæ˜¾ç¤ºå¼‚å¸¸.æ‰€ä»¥ä½¿ç”¨`layoutPriority(1)`ä¸ºäº†è®©å®ƒæå‰æ¨å¯¼å‡ºå®ƒéœ€è¦çš„ç©ºç™½å¤§å°.

å®¹å™¨çš„å¤–éƒ¨è®¾ç½®å¯ä»¥è‡ªåŠ¨è¢«ç»§æ‰¿ç»™å­å®¹å™¨(è¿™é‡Œçš„å®¹å™¨eg: ScrollViewã€VStack...)

``` swift
ScrollView {
            VStack(spacing: 30) {
                foodImage
                Text("ä»Šå¤©åƒä»€ä¹ˆ?").bold()
                selectedFoodInfoView
                Spacer().layoutPriority(1)
                selectFoodButton
                cancelButton
            }
            .padding()
            .frame(maxWidth: .infinity, minHeight: UIScreen.main.bounds.height - 100)
            .font(.title)
            .mainButtonStyle()
            .animation(.mySpring, value: shouldShowInfo)
            .animation(.myEase, value: selectedFood)
        }
        .background(.bg2)
```
å‡è®¾`.background(.bg2)`é»˜è®¤VStackä¹Ÿæ˜¯`.bg2`é¢œè‰²çš„èƒŒæ™¯

#### å°è£…extensionå¤„ç†é¢œè‰²ã€è½¬åœºåŠ¨ç”»ã€ShapeStyle

SwiftUIé‡Œé¢æ¯”objcä¸­ä½¿ç”¨ æ‰©å±•æ›´åŠ é¢‘ç¹

``` swift
//
//  Extensions.swift
//  FoodPicker
//
//  Created by sunyazhou on 2023/6/18.
//

import Foundation
import SwiftUI

extension View {
    func mainButtonStyle() -> some View {
        buttonStyle(.borderedProminent)
            .buttonBorderShape(.capsule)
            .controlSize(.large)
    }
    
    func roudedRectBackground(radius: CGFloat = 8,
                              fill: some ShapeStyle = .bg ) -> some View {
        background(RoundedRectangle(cornerRadius: radius).fill(fill))
    }
}

extension Animation {
    static let mySpring = Animation.spring(dampingFraction: 0.55)
    static let myEase = Animation.easeInOut(duration: 0.6)
}

extension ShapeStyle where Self == Color {
    static var bg: Color {  Color(.systemBackground) }
    static var bg2: Color { Color(.secondarySystemBackground) }
}

extension AnyTransition {
    static let delayInsertionOpacity = Self.asymmetric(
        insertion:.opacity.animation(.easeInOut(duration: 0.5).delay(0.2)),
        removal:.opacity.animation(.easeInOut(duration: 0.4))
    )
    
    static let moveUpWithOpacity = Self.move(edge: .top).combined(with: .opacity)
}

```

è¿™é‡Œè¯´ä¸€ä¸‹è¿™ä¸ª`extension ShapeStyle where Self == Color`

å› ä¸ºæœ‰ä¸€ä¸ªåè®®å«`ShapeStyle `ä¸å•çº¯æ˜¯ä¸€ä¸ªé¢œè‰²æˆ–è€…å¡«å……çš„å¯¹è±¡å¯ä»¥è®¾ç½®èƒŒæ™¯é¢œè‰²,å…¶å®ƒç±»ä¼¼æ¸å˜çš„å›¾åƒä¹Ÿç®—ä½¿ç”¨éµå®ˆ`ShapeStyle `çš„æ ·å¼.è¿™é‡Œå‡†ç¡®æ¥è¯´`Color`åªæ˜¯ShapeStyleçš„ä¸€ç§.

å½“æˆ‘ä»¬è®¿é—®é¢œè‰²çš„æ—¶å€™æ­£å¸¸ç”¨çš„æ˜¯

``` swift
Color().bg2  //bg2é¢œè‰²
```

è€Œç¬¦åˆ`ShapeStyle`åè®®çš„å¯¹è±¡å¯ä»¥ç›´æ¥ç”¨

``` swift
.bg2 //è®¾ç½®é¢œè‰² çœç•¥äº†è¾“å…¥Color
```

#### @ViewBuilderã€Groupå®¹å™¨ä½¿ç”¨ã€Gridçš„è¡Œåˆ—ä½¿ç”¨

`@ViewBuilder`é™åˆ¶äº†some Viewä¸­ ä¾‹å¦‚VStackã€HStackç­‰å„ç§Stackçš„æ•°é‡æœ€å¤šåå±‚

å¦‚æœæƒ³ä½¿ç”¨çš„è¯éœ€è¦æŠŠå¤šçº§è§†å›¾ç”¨`Group `æˆ–è€…`Grid`åœˆèµ·æ¥

è¿™æ ·è¯´ä½ å¯èƒ½ç†è§£ä¸äº†æˆ‘ä¸¾ä¸ªä¾‹å­:

å‡è®¾ä¸€ä¸ªViewBuilderçš„UIViewæœ€å¤šè®©ä½ `addSubView:`10æ¬¡,ä½ æœ‰å¾ˆå¤šsubview,é‚£ä¹ˆä½ å°±éœ€è¦æŠŠä½ çš„subviewæŒ‰ç…§ä½ çš„åŠŸèƒ½åˆ’åˆ†æˆ–è€…è§„åˆ™ å‡ ä¸ªæ”¾åœ¨ä¸€ä¸ªUIViewä¸Š,å‡è®¾å®ƒå°±å«GroupViewå§,è®©åæŠŠGroupViewçš„å®ä¾‹addåˆ°ç¬¦åˆ`ViewBuilder `çš„åè®®Viewä¸Š.è¿™æ ·å°±ç›¸å½“äºä¸€ä¸ªGroupé‡Œé¢å¯ä»¥æ”¾1~9ä¸ªä¸ç­‰, ä½†æ˜¯ä½ æœ€ç»ˆæä¾›çš„è¿˜æ˜¯ä¸€ä¸ªUIViewçš„å®ä¾‹addåˆ°ä¸Šå»äº†.

> è¿™å°±ç›¸å½“äºè·³æ¿åŸç†,ä¸€ä¸ªå…¬å¸æœ‰ä¸€ä¸ªå±€åŸŸç½‘ã€ä½†æ˜¯äº¤æ¢æœºæœ€å¤šæœ‰10ä¸ªç«¯å£,ä¸ºäº†è®©æ›´å¤šäººåŠ å…¥å¿…é¡»é€šè¿‡1æ‹–10çš„å½¢å¼å¢è®¾äº¤æ¢æœºæ¥æ»¡è¶³æ›´å¤šäººä¸Šç½‘çš„éœ€æ±‚.è¿™æ ·ä½ ç†è§£äº†å§!

è‡³äºä¸ºå•¥æ˜¯10ä¸ª æˆ‘æ‰¾åˆ°äº†è¿™æ ·çš„ä»£ç 

``` swift
@available(iOS 13.0, macOS 10.15, tvOS 13.0, watchOS 6.0, *)
extension ViewBuilder {

    public static func buildBlock<C0, C1, C2, C3, C4, C5, C6, C7, C8, C9>(_ c0: C0, _ c1: C1, _ c2: C2, _ c3: C3, _ c4: C4, _ c5: C5, _ c6: C6, _ c7: C7, _ c8: C8, _ c9: C9) -> TupleView<(C0, C1, C2, C3, C4, C5, C6, C7, C8, C9)> where C0 : View, C1 : View, C2 : View, C3 : View, C4 : View, C5 : View, C6 : View, C7 : View, C8 : View, C9 : View
}
```

å¦‚æœä½ æƒ³è®©å®ƒæ”¯æŒæ›´å¤šä½ å¾—å¤„ç†ä»–ä»¬çš„é¡ºåºå…³ç³»,è¿™æ˜¯å®ƒæä¾›æœ€å¤šå¤„ç†å„ç§å±‚çº§å…³ç³»çš„å‡½æ•°æ¥å£æ²¡æœ‰å®ç°ä»£ç .ä¸çŸ¥é“æˆ‘ä»¬è‡ªå·±ä¸ºå®ƒæ‰©å±•è¡Œä¸è¡Œ!

#### Group å’Œ Grid

Groupç›¸å½“äºFultteré‡Œé¢çš„container.å¯ä»¥å½“å‡ ä¸ªè§†å›¾è¿›å»è¿›è¡Œç»Ÿä¸€é…ç½®,é‡‡ç”¨ç»Ÿä¸€ç®¡ç†,å†…éƒ¨å­è§†å›¾å¯ä»¥é»˜è®¤ä½¿ç”¨å®ƒçš„é…ç½®ä¹Ÿå¯ä»¥è¦†ç›–å®ƒçš„é…ç½®ä¿®æ”¹ä½¿ç”¨è‡ªå·±çš„é…ç½®,æ€»ä¹‹å°±æ˜¯å¸®å¼€å‘è€…åšäº†å¾ˆå¤šç»Ÿä¸€ç®¡ç†å­è§†å›¾çš„å®¹å™¨,æƒ³è‡ªå®šä¹‰éœ€è¦è‡ªå·±é…ç½®å°±å¥½.

Grid ä½¿æ ¼å­å¸ƒå±€é‚£ç§ åº”è¯¥æ˜¯iOS16ä»¥åæ¨å‡ºçš„ç±»ä¼¼Groupä¸€æ ·çš„å®¹å™¨,ä¸»è¦æ˜¯è´Ÿè´£ç®¡ç†Nè¡ŒNåˆ—è¿™ç§ç±»ä¼¼Excelè¡¨æ ¼ä¸€æ ·çš„åˆ¶è¡¨å®¹å™¨.èƒ½åŠ åˆ†å‰²çº¿

``` swift
VStack {
	    if (shouldShowInfo) {
	        Grid {
	            GridRow {
	                Text("è›‹ç™½è´¨")
	                Text("è„‚è‚ª")
	                Text("ç¢³æ°´")
	            }.frame(minWidth: 40)
	            
	            Divider()
	                .gridCellUnsizedAxes(.horizontal)
	                .padding(.horizontal, -10)
	            
	            GridRow {
	                Text(selectedFood!.$protein)
	                Text(selectedFood!.$carb)
	                Text(selectedFood!.$fat)
	            }
	        }
	        .font(.title3)
	        .padding(.horizontal)
	        .padding()
	        .roudedRectBackground()
	        .transition(.moveUpWithOpacity)
	    }
	}
	.frame(maxWidth: .infinity)
	.clipped()
```
åˆ†å‰²çº¿`Divider`

ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢ä»£ç æ‰‹åŠ¨åŠ åˆ†å‰²

``` swift
HStack {
            VStack(spacing: 12) {
                Text("è›‹ç™½è´¨")
                Text(selectedFood!.protein.formatted() + " g")
            }
            Divider().frame(width: 1).padding(.horizontal)
            VStack(spacing: 12) {
                Text("è„‚è‚ª")
                Text(selectedFood!.fat.formatted() + " g")
            }
            Divider().frame(width: 1).padding(.horizontal)
            VStack(spacing: 12) {
                Text("ç¢³æ°´")
                Text(selectedFood!.carb.formatted() + " g")
            }
        }
        .font(.title3)
        .padding(.horizontal)
        .padding()
        .background(RoundedRectangle(cornerRadius: 8).foregroundColor(Color(.systemBackground)))
```

# æ€»ç»“

å·¥ä½œæ—¶é—´å¾ˆç´§å¼ ,å‘¨æœ«æœ‰æ—¶é—´è®°å½•ä¸€äº›é‡è¦å®¹æ˜“è¢«é—å¿˜çš„å†…å®¹,å¾ˆæ°´,å¸Œæœ›å¤§å®¶ä¸è¦ä»‹æ„.ç¬¬äºŒç« æ¯”è¾ƒå®ç”¨ä¸€äº›,å¸Œæœ›èƒ½è®°å½•å’Œåˆ†äº«æŠ€æœ¯.å¤©æ°”å¤ªçƒ­äº†,ä½åœ¨æ²¡æœ‰ç©ºè°ƒçš„åŒ—äº¬æŸå‡ºç§Ÿå±‹,å­¦ä¹ çœŸçš„æ˜¯ä¸€ä»¶æ±—æµæµƒèƒŒ,ä½“éªŒé…·æš‘çš„è‹¦æ¶©ç»å†.


[ç¬¬äºŒç« demo](https://github.com/sunyazhou13/FoodPicker)  
[2-1 æ’ç‰ˆç»ƒä¹  (1/2) - SwiftUI æ–°æ‰‹å…¥é—¨](https://www.bilibili.com/video/BV1pW4y1j7MC/?spm_id_from=333.788&vd_source=9309f71afe97e633abeadc8407870e76)


URL: https://sunyazhou.com/2023/06/ios16wkwebview/index.html.md
Published At: 2023-06-15 00:24:00 +0000

# è§£å†³iOS16 WKWebviewæ— æ³•è°ƒè¯•é—®é¢˜

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



## é—®é¢˜

æœ€è¿‘åœ¨IOS16æ›´æ–°å,æ— æ³•åœ¨macç«¯çš„safariçœ‹åˆ°è°ƒè¯•ä¿¡æ¯äº†.è¿™è®©æˆ‘å¾ˆæ˜¯å¤´ç–¼,ç»è¿‡æŸ¥å„ç§èµ„æ–™å‘ç°ä¸€ä¸ªAeppl WebKitå›¢é˜Ÿå¾ˆè„‘æ®‹çš„ä¸€ä¸ªæ“ä½œ

[Enabling the Inspection of Web Content in Apps](https://webkit.org/blog/13936/enabling-the-inspection-of-web-content-in-apps/)

æŸç‰ˆæœ¬æ›´æ–°ä»¥åï¼Œæ–°å¢äº†ä¸ªisInspectableçš„å±æ€§ï¼Œè€Œä¸”é»˜è®¤æ˜¯å…³é—­çš„ã€‚å¦‚æœæ˜¯iOS16ä»¥ä¸‹å°±æ²¡æœ‰è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºiOS16çš„SDKä¸­æ‰æœ‰çš„è¿™ä¸ªå­—æ®µ, è¿™ç§16.4çš„æ–°ç‰¹æ€§å¾ˆSB,ä¸åšå‘ä¸‹å…¼å®¹è€ƒè™‘.

æ­£ç¡®çš„æ–¹å¼åº”è¯¥æ˜¯è®¾ç½®`webView.inspectable` ä¸º`YES`

``` objc
WKWebViewConfiguration *webConfiguration = [WKWebViewConfiguration new];
WKWebView *webView = [[WKWebView alloc] initWithFrame:CGRectZero configuration:webConfiguration];
webView.inspectable = YES;
```

> æ³¨æ„è¿™ä¸ªAPIæ˜¯iOS16.4æ‰æœ‰çš„ç‰¹æ€§,è®°å¾—åŠ ä¸Šå¯ç”¨æ€§æ£€æµ‹çš„API  
> è¿˜æœ‰å¦‚æœä½ å…¬å¸çš„æ‰“åŒ…æœºæ²¡æœ‰æœ€è¿‘ç‰ˆæœ¬çš„Xcodeè¯·è®°å¾—å‡çº§,å¦åˆ™æœ‰å¯èƒ½é€ æˆè¿™ä¸ªAPIåœ¨è‹¹æœçš„iOS16SDKä¸­æ‰æœ‰,å…¶å®ƒSDKä¸­æ²¡æœ‰å¼•èµ·çš„æ‰“åŒ…æœºæ‰“åŒ…å¤±è´¥.


# æ€»ç»“

å¦‚æœå¼€å‘WKWebViewçš„åŒå­¦è®°å¾—å…³æ³¨ä¸€ä¸‹,æœ‰å¾ˆå¤šå¼€å‘è€…è§‰å¾—çœ‹åˆ°äº†ä¸æ˜¯å¹²è¿™ä¸ªä¸šåŠ¡çš„è¿™ä¸ªä¸éœ€è¦å…³æ³¨,å¾€å¾€å¾ˆå¤šæ—¶å€™ä½ å¶å°”é‡åˆ°å°±ä¼šæ‰‹è¶³æ— æª,è¿˜æ˜¯å»ºè®®ä½ è¦ä¹ˆè®°ä½è¿™ä¸ªé—®é¢˜,è¦ä¹ˆå‘Šè¯‰ä¸€ä¸‹å‘¨å›´åŒäº‹å‘¨çŸ¥è¿™ä¸ªäº‹æƒ…,æ€»ä¹‹ä¸è¦çŠ¯æ²¡æœ‰ç»éªŒè€Œä¸å»å­¦ä¹ äº†è§£çš„é”™è¯¯.

[å®˜æ–¹å¯¹æ­¤é—®é¢˜è§£é‡Š](https://webkit.org/blog/13936/enabling-the-inspection-of-web-content-in-apps/)  
[https://zhuanlan.zhihu.com/p/622049301](https://zhuanlan.zhihu.com/p/622049301)



URL: https://sunyazhou.com/2023/06/blackwhitefilter/index.html.md
Published At: 2023-06-14 01:37:00 +0000

# UIImageé»‘ç™½æ»¤é•œ

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯

æœ€è¿‘å¼€å‘åŠŸèƒ½äº§å“æœ‰ä¸€ä¸ªéœ€æ±‚æ˜¯è¿™æ ·çš„,å°†ä¸€å¼ å›¾ç‰‡å˜æˆé»‘ç™½å›¾ç‰‡,æˆ‘ä»¬ç¬¬ä¸€æƒ³æ³•æ˜¯åŠ renderç€è‰²,ç„¶è€Œç€è‰²ä¸äº§å“æƒ³è¦çš„éœ€æ±‚,äº§å“çš„æ„æ€æ˜¯åŠ é»‘ç™½æ»¤é•œ,ä¹‹å‰å¼€å‘çš„åŒäº‹æ›¾ç»æè¿‡ä¸€äº›ç§æœ‰APIåšæ··æ·†çš„æ–¹å¼å®ç°äº†å…¬ç¥­æ—¥ä¹‹ç±»çš„çºªå¿µæ´»åŠ¨æŠŠå·¥ç¨‹é‡Œæ‰€æœ‰çš„è§†å›¾éƒ½ææˆäº†é»‘ç™½è‰².å¯æ˜¯æˆ‘æ€»ä¸èƒ½ä¸ºäº†ä¸€ä¸ªè‰°éš¾çš„åŠŸèƒ½åŠ¨ç”¨ç§æœ‰APIåšæ··æ·†è¢«è‹¹æœæ•™è‚²å§!

ç»è¿‡å„ç§æŸ¥æ‰¾éƒ½æ²¡æœ‰æœ€ä¼˜è§£,æˆ‘æƒ³åˆ°äº†ChatGPT,ç»è¿‡å’ŒChatGPTé—®ç­”çš„å½¢å¼å®ƒç»™å‡ºäº†å¦‚ä¸‹ä»£ç :

``` objc

#import <UIKit/UIKit.h>
#import <CoreImage/CoreImage.h>

@interface UIImage (RenderingColor)

/// ç»™ä¸€å¼ å›¾ç‰‡åŠ é»‘ç™½æ»¤é•œ
/// - Parameter image: å›¾ç‰‡
+ (UIImage *)applyBlackWhiteFilterToImage:(UIImage *)image;

@end

@implementation UIImage (RenderingColor)

+ (UIImage *)applyBlackWhiteFilterToImage:(UIImage *)image
{
    if (image == nil) { return nil; }
    CIImage *ciImage = [CIImage imageWithCGImage:image.CGImage];
    CIFilter *filter = [CIFilter filterWithName:@"CIPhotoEffectMono"]; // Create the black-and-white filter
    [filter setValue:ciImage forKey:kCIInputImageKey];
    CIContext *context = [CIContext contextWithOptions:nil];
    CIImage *outputImage = [filter outputImage];
    CGImageRef cgImage = [context createCGImage:outputImage fromRect:[outputImage extent]];
    UIImage *filteredImage = [UIImage imageWithCGImage:cgImage];
    CGImageRelease(cgImage);
    return filteredImage;
}

@end
```

é€šè¿‡ä¸Šè¿°æ“ä½œæˆ‘ä»¬å°±è½»æ¾çš„å®ç°äº†ç»™ä¸€ä¸ªUIImage åŠ é»‘ç™½æ»¤é•œè®©å®ƒå˜æˆç°ç™½è‰²çš„æ•ˆæœ,

![](/assets/images/20230614BlackWhiteFilter/BlackWhiteFilter.webp)



#### èƒ½ç»™CALayeråŠ å—ï¼Ÿ

èƒ½

``` objc
#import <QuartzCore/QuartzCore.h>
#import <CoreImage/CoreImage.h>

@interface CALayer (BlackWhiteFilter)

- (void)applyBlackWhiteFilter;

@end

@implementation CALayer (BlackWhiteFilter)

- (void)applyBlackWhiteFilter {
    CIFilter *filter = [CIFilter filterWithName:@"CIPhotoEffectMono"]; // Create the black-and-white filter
    
    // Convert the CALayer's contents to a CIImage
    if ([self.contents isKindOfClass:[UIImage class]]) {
        CIImage *ciImage = [CIImage imageWithCGImage:(CGImageRef)self.contents];
        
        // Set the input image for the filter
        [filter setValue:ciImage forKey:kCIInputImageKey];
        
        // Apply the filter
        CIContext *context = [CIContext contextWithOptions:nil];
        CIImage *outputImage = [filter outputImage];
        CGImageRef cgImage = [context createCGImage:outputImage fromRect:[outputImage extent]];
        
        // Set the filtered image as the layer's contents
        self.contents = (__bridge id)cgImage;
        
        CGImageRelease(cgImage);
    }
}

@end

```

æœ¬è´¨æ ¸å¿ƒæ˜¯ä½¿ç”¨`CIPhotoEffectMono`å†…ç½®æ»¤é•œå¯¹å›¾ç‰‡è¿›è¡Œç»˜åˆ¶

> 1.è¿™ä¸ªæ˜¯iOS5.0ä»¥ä¸Šæä¾›çš„æ–¹æ³•,å¤§å®¶ä¸ç”¨æ‹…å¿ƒç³»ç»Ÿå…¼å®¹é—®é¢˜  
> 2.è¿™ä¸ªä¸æ˜¯ç§æœ‰APIè¯·æ”¾å¿ƒä½¿ç”¨,æ²¡æœ‰å®¡æ ¸é£é™©

è¿™ä¸ªæ–¹æ³•çš„æœ€ä½å…¼å®¹iOSç³»ç»Ÿæ˜¯iOS 5.0åŠä»¥ä¸Šç‰ˆæœ¬ã€‚å…³äºç§æœ‰APIå’ŒApp Storeå®¡æ ¸é£é™©çš„é—®é¢˜ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

* 1.è¯¥æ–¹æ³•å¹¶ä¸ä½¿ç”¨ç§æœ‰APIï¼Œå®ƒæ˜¯ä½¿ç”¨äº†Core Imageæ¡†æ¶æä¾›çš„å…¬å…±æ¥å£æ¥åˆ›å»ºå’Œåº”ç”¨æ»¤é•œæ•ˆæœã€‚  
* 2.Core Imageæ¡†æ¶æ˜¯iOSçš„å…¬å…±æ¡†æ¶ï¼Œä¸å±äºç§æœ‰APIã€‚å› æ­¤ï¼Œä½¿ç”¨è¯¥æ–¹æ³•ä¸ä¼šè¿åè‹¹æœçš„App Storeå®¡æ ¸æŒ‡å—ã€‚  
* 3.æä¾›äº†é€‚å½“çš„é”™è¯¯å¤„ç†å’Œå®‰å…¨æ£€æŸ¥ï¼Œä»¥ç¡®ä¿åœ¨ä¸æ”¯æŒçš„è®¾å¤‡ä¸Šä¸ä¼šå‘ç”Ÿå´©æºƒæˆ–å¼‚å¸¸è¡Œä¸ºã€‚ 

# æ€»ç»“

ç»è¿‡åå¤æ‰¾å¯»äº’è”ç½‘ä¸Šçš„èµ„æ–™ï¼Œåƒç¯‡ä¸€å¾‹,å„ç§å¤åˆ¶ç²˜è´´çš„æ–‡ç« çœŸæ˜¯æ²¡æ³•çœ‹,ä¸å¥½ä½¿ä¸è¯´è¿˜ä¸è§£å†³é—®é¢˜çš„åŒæ—¶åˆ¶é€ å¾ˆå¤šäº’è”ç½‘åƒåœ¾.å¸Œæœ›äº’è”ç½‘ä¸Šè¿™æ ·çš„äº‹æƒ…èƒ½å˜çš„çº¯å‡€ä¸€äº›.




URL: https://sunyazhou.com/2023/06/learnaboutvisionos/index.html.md
Published At: 2023-06-09 09:08:00 +0000

# å­¦ä¹ å¦‚ä½•åœ¨visionOSä¸Šå¼€å‘APP

![](/assets/images/20230609LearnAboutVisionOS/visionos.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## åˆè¯†visionOS

visionOS å¯ä»¥ç†è§£ä¸ºæ–°çš„è¿è¡Œåœ¨è‹¹æœå¤´æ˜¾ä¸Šçš„iOSç³»ç»Ÿ, ç”¨è‹¹æœçš„è¯å°±æ˜¯å„ç§é«˜å¤§ä¸Šä»€ä¹ˆç©ºé—´æŠ€æœ¯...ã€‚é‡Œé¢ä¼šç”¨åˆ°SwiftUI, UIKit, RealityKitå’ŒARKitæ¡†æ¶ï¼Œåœ¨visionOSä¸Šå¼€å‘APPçš„è¯æœ€å¥½æ˜¯æ‹¥æœ‰ä»¥ä¸Šå„ç§Kitå¼€å‘ç»éªŒ,å¦‚æœä¸äº†è§£è¿˜æ˜¯å¸Œæœ›ä½ å­¦å­¦.æˆ–è€…ç›´æ¥ä»SwiftUIå¼€å§‹.

* SwiftUI ç›¸å½“äºä¹‹å‰çš„UIKitåªä¸è¿‡æ˜¯æ–°çš„å†™UIçš„æ¡†æ¶ç³»ç»Ÿç”¨äºswiftå¼€å‘
* UIKitæ˜¯åŸå§‹Objective-Cçš„UIç³»ç»Ÿ
* RealityKitå¢å¼ºç°å®æ¡†æ¶
* ARKitè™šæ‹Ÿç°å®æ¡†æ¶

## spatial computing(ç©ºé—´è®¡ç®—)

äº†è§£æ„æˆç©ºé—´è®¡ç®—çš„åŸºç¡€â€”çª—å£(windows)ã€ä½“ç§¯(volumes )å’Œç©ºé—´(spaces)â€”å¹¶äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›å…ƒç´ æ¥æ„å»ºå¼•äººå…¥èƒœçš„æ²‰æµ¸å¼ä½“éªŒã€‚æˆ‘ä»¬å°†å¸¦æ‚¨äº†è§£ç”¨äºä¸ºvisionOSåˆ›å»ºåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•è®¾è®¡æ·±åº¦ï¼Œè§„æ¨¡å’Œæ²‰æµ¸æ„Ÿã€‚æ¢ç´¢å¦‚ä½•ä½¿ç”¨æ¥è‡ªAppleçš„å·¥å…·ï¼Œå¦‚Xcodeå’Œæ–°çš„Reality Composer Proï¼Œä»¥åŠå¦‚ä½•åˆ¶ä½œé€‚åˆæ¯ä¸ªäººçš„ç©ºé—´è®¡ç®—åº”ç”¨ç¨‹åºã€‚

*  windows è¿™ç©æ„å¾ˆé‡è¦,å°±æ˜¯æˆ‘ä»¬ä¹‹å‰ç°å®UIViewä¹‹ç±»çš„window,ä¸€èˆ¬ç”¨äºæ˜¾ç¤º2Dçš„å†…å®¹è§†å›¾å®¹å™¨,
*  volumes è¿™ä¸ªæ˜¯å¯¹windowçš„æ‰©å……å’Œå¢å¼ºå®¹å™¨,ç”¨äºå®¹çº³2Då’Œ3Då†…å®¹
*  spaces ç›¸å½“äºæ‘„å½±æœº,ä¹Ÿå°±æ˜¯æˆ‘ä»¬äººçœ¼çš„ä½ç½®,ç”¨äºæ˜¾ç¤ºæ¬¾è´¯ç©¿å’Œå…¨å±ä»¥åŠ3Då¤§å±æ›²é¢æ¨¡å¼çš„ä¸€ç§ç±»å‹.

![](/assets/images/20230609LearnAboutVisionOS/visionos0.webp)

å®˜æ–¹çš„è§£é‡Šå¦‚ä¸‹:

* windows
ä½ å¯ä»¥åœ¨ä½ çš„visionOSåº”ç”¨ä¸­åˆ›å»ºä¸€ä¸ªæˆ–å¤šä¸ªçª—å£ã€‚å®ƒä»¬æ˜¯ç”¨SwiftUIæ„å»ºçš„ï¼ŒåŒ…å«ä¼ ç»Ÿçš„è§†å›¾å’Œæ§ä»¶ï¼Œä½ å¯ä»¥é€šè¿‡æ·»åŠ 3Då†…å®¹æ¥å¢åŠ ä½“éªŒçš„æ·±åº¦ã€‚

* volumes
ä½¿ç”¨3Dä½“ç§¯ä¸ºä½ çš„åº”ç”¨æ·»åŠ æ·±åº¦ã€‚å·æ˜¯SwiftUIåœºæ™¯ï¼Œå¯ä»¥ä½¿ç”¨RealityKitæˆ–Unityå±•ç¤º3Då†…å®¹ï¼Œåˆ›å»ºå¯ä»å…±äº«ç©ºé—´æˆ–åº”ç”¨ç¨‹åºçš„å®Œæ•´ç©ºé—´çš„ä»»ä½•è§’åº¦æŸ¥çœ‹çš„ä½“éªŒã€‚
* spaces
é»˜è®¤æƒ…å†µä¸‹ï¼Œåº”ç”¨ç¨‹åºå¯åŠ¨åˆ°å…±äº«ç©ºé—´ï¼Œå®ƒä»¬å¹¶æ’å­˜åœ¨ï¼Œå°±åƒMacæ¡Œé¢ä¸Šçš„å¤šä¸ªåº”ç”¨ç¨‹åºä¸€æ ·ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çª—å£å’Œå·æ¥æ˜¾ç¤ºå†…å®¹ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»–ä»¬å–œæ¬¢çš„ä»»ä½•åœ°æ–¹é‡æ–°å®šä½è¿™äº›å…ƒç´ ã€‚ä¸ºäº†è·å¾—æ›´èº«ä¸´å…¶å¢ƒçš„ä½“éªŒï¼Œåº”ç”¨ç¨‹åºå¯ä»¥æ‰“å¼€ä¸€ä¸ªä¸“é—¨çš„Full Spaceï¼Œåªæ˜¾ç¤ºè¯¥åº”ç”¨ç¨‹åºçš„å†…å®¹ã€‚åœ¨Full Spaceä¸­ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨çª—å£å’Œå·ï¼Œåˆ›å»ºæ— é™çš„3Då†…å®¹ï¼Œæ‰“å¼€é€šå¾€ä¸åŒä¸–ç•Œçš„é—¨æˆ·ï¼Œç”šè‡³è®©äººå®Œå…¨æ²‰æµ¸åœ¨ä¸€ä¸ªç¯å¢ƒä¸­ã€‚

äº†è§£æ„æˆç©ºé—´è®¡ç®—çš„åŸºç¡€â€”çª—å£ã€ä½“ç§¯å’Œç©ºé—´â€”å¹¶äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›å…ƒç´ æ¥æ„å»ºå¼•äººå…¥èƒœçš„æ²‰æµ¸å¼ä½“éªŒã€‚æˆ‘ä»¬å°†å¸¦æ‚¨äº†è§£ç”¨äºä¸ºvisionOSåˆ›å»ºåº”ç”¨ç¨‹åºçš„æ¡†æ¶ï¼Œå¹¶å‘æ‚¨å±•ç¤ºå¦‚ä½•è®¾è®¡æ·±åº¦ï¼Œè§„æ¨¡å’Œæ²‰æµ¸æ„Ÿã€‚æ¢ç´¢å¦‚ä½•ä½¿ç”¨æ¥è‡ªAppleçš„å·¥å…·ï¼Œå¦‚Xcodeå’Œæ–°çš„Reality Composer Proï¼Œä»¥åŠå¦‚ä½•åˆ¶ä½œé€‚åˆæ¯ä¸ªäººçš„ç©ºé—´è®¡ç®—åº”ç”¨ç¨‹åºã€‚

è¿™é‡Œæœ‰äº†è§£è¿™ä¸ªçš„4ä¸ªè§†é¢‘

![](/assets/images/20230609LearnAboutVisionOS/MeetSpatialComputing1.webp)

* [Get started with building apps for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10260/)
* [Principles of spatial design](https://developer.apple.com/videos/play/wwdc2023/10072/)
* [Create accessible spatial experiences](https://developer.apple.com/videos/play/wwdc2023/10034/)
* [Develop your first immersive app](https://developer.apple.com/videos/play/wwdc2023/10203/)

ä¸€æ—¦æ‚¨ç†Ÿæ‚‰äº†visionOSçš„åŸºç¡€çŸ¥è¯†ï¼Œå°±å¯ä»¥è¿›ä¸€æ­¥äº†è§£æ”¯æŒè¯¥å¹³å°çš„æ¡†æ¶ã€‚å‚è§‚ä¸€ä¸‹visionOSçš„SwiftUIï¼Œäº†è§£å¦‚ä½•ä¸ºçª—å£å’Œå·æ·»åŠ æ·±åº¦ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨Full Spaceè®©äººä»¬ä»¥å‰æ‰€æœªæœ‰çš„æ–¹å¼ä½“éªŒæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬è¿˜å°†å‘æ‚¨ä»‹ç»ç”¨äºç©ºé—´è®¡ç®—çš„UIKitï¼Œå¹¶åˆ†äº«å¦‚ä½•ä¸SwiftUIä¸€èµ·ä½¿ç”¨å®ƒã€‚

![](/assets/images/20230609LearnAboutVisionOS/MeetSpatialComputing2.webp)

[Meet SwiftUI for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10109/)
[Meet UIKit for spatial computing](https://developer.apple.com/videos/play/wwdc2023/111215/)

è¿™ä¿©æ˜¯UIKitå’ŒSwiftKitçš„å†…å®¹

## æ¢ç´¢SwiftUIå’Œ RealityKit

è¦æ›´æ·±å…¥åœ°äº†è§£SwiftUIå’ŒRealityKitï¼Œè¯·æ¢ç´¢ä¸“æ³¨äºSwiftUIåœºæ™¯ç±»å‹çš„ä¸“é—¨ç³»åˆ—ä¼šè®®ï¼Œä»¥å¸®åŠ©æ‚¨è·¨çª—å£ã€å·å’Œç©ºé—´æ„å»ºå‡ºè‰²çš„ä½“éªŒã€‚äº†è§£Model 3D APIï¼Œäº†è§£å¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ·±åº¦å’Œç»´åº¦ï¼Œå¹¶äº†è§£å¦‚ä½•ä½¿ç”¨RealityViewæ¸²æŸ“3Då†…å®¹ã€‚æˆ‘ä»¬å°†å¸®åŠ©æ‚¨å‡†å¤‡å¥½è¿›å…¥ImmersiveSpaceâ€”ä¸€ç§æ–°çš„SwiftUIåœºæ™¯ç±»å‹ï¼Œå¯ä»¥è®©æ‚¨ä¸ºvisionOSåˆ›é€ å‡ºè‰²çš„æ²‰æµ¸å¼ä½“éªŒã€‚å­¦ä¹ ç®¡ç†åœºæ™¯ç±»å‹çš„æœ€ä½³å®è·µï¼Œå¢åŠ æ²‰æµ¸æ„Ÿï¼Œå¹¶å»ºç«‹ä¸€ä¸ªâ€œèµ°å‡ºè¿™ä¸ªä¸–ç•Œâ€çš„ä½“éªŒã€‚

![](/assets/images/20230609LearnAboutVisionOS/ExploreSwiftUIandRealityKit1.webp)

* [Elevate your windowed app for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10110/)
* [Take SwiftUI to the next dimension](https://developer.apple.com/videos/play/wwdc2023/10113/)
* [Go beyond the window with SwiftUI](https://developer.apple.com/videos/play/wwdc2023/10111/)

åœ¨æˆ‘ä»¬çš„ç¬¬äºŒä¸ªç³»åˆ—ä¸­ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨RealityKitä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå¸¦æ¥å¼•äººå…¥èƒœçš„æ²‰æµ¸å¼å†…å®¹ã€‚å¼€å§‹ä½¿ç”¨RealityKitå®ä½“ï¼Œç»„ä»¶å’Œç³»ç»Ÿï¼Œå¹¶äº†è§£å¦‚ä½•å°†3Dæ¨¡å‹å’Œæ•ˆæœæ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æ‚¨çš„å†…å®¹åµŒå…¥åˆ°å®ä½“å±‚æ¬¡ç»“æ„ä¸­ï¼Œä½¿ç”¨é”šå°†è™šæ‹Ÿå†…å®¹å’Œç°å®ä¸–ç•Œæ··åˆåœ¨ä¸€èµ·ï¼Œå°†ç²’å­æ•ˆæœå¸¦å…¥æ‚¨çš„åº”ç”¨ç¨‹åºï¼Œæ·»åŠ è§†é¢‘å†…å®¹ï¼Œå¹¶é€šè¿‡é—¨æˆ·åˆ›å»ºæ›´èº«ä¸´å…¶å¢ƒçš„ä½“éªŒã€‚

![](/assets/images/20230609LearnAboutVisionOS/ExploreSwiftUIandRealityKit2.webp)

* [Enhance your spatial computing app with RealityKit](https://developer.apple.com/videos/play/wwdc2023/10081/)
* [Build spatial experiences with RealityKit](https://developer.apple.com/videos/play/wwdc2023/10080/)

## é‡æ–°å­¦ä¹ ARKit

æœ€åï¼Œæˆ‘ä»¬å°†å¸®åŠ©æ‚¨äº†è§£visionOSä¸Šçš„ARKitã€‚è¯¥å¹³å°ä½¿ç”¨ARKitç®—æ³•æ¥å¤„ç†æŒä¹…æ€§ã€ä¸–ç•Œæ˜ å°„ã€åˆ†å‰²ã€æŠ å›¾å’Œç¯å¢ƒç…§æ˜ç­‰åŠŸèƒ½ã€‚è¿™äº›ç®—æ³•ä¸€ç›´åœ¨è¿è¡Œï¼Œå…è®¸åº”ç”¨ç¨‹åºå’Œæ¸¸æˆåœ¨å…±äº«ç©ºé—´ä¸­è‡ªåŠ¨å—ç›ŠäºARKitã€‚ä¸€æ—¦ä½ çš„åº”ç”¨æ‰“å¼€äº†ä¸€ä¸ªä¸“ç”¨çš„Full Spaceï¼Œå®ƒå°±å¯ä»¥åˆ©ç”¨ARKit apiå¹¶å°†è™šæ‹Ÿå†…å®¹ä¸ç°å®ä¸–ç•Œèåˆåœ¨ä¸€èµ·ã€‚

æˆ‘ä»¬å°†åˆ†äº«è¿™ä¸ªæ¡†æ¶æ˜¯å¦‚ä½•å®Œå…¨é‡æ–°æ„æƒ³çš„ï¼Œè®©ä½ åœ¨ä¿æŠ¤éšç§çš„åŒæ—¶å»ºç«‹äº’åŠ¨ä½“éªŒã€‚äº†è§£å¦‚ä½•åˆ¶ä½œä¸æŸäººæˆ¿é—´äº¤äº’çš„3Då†…å®¹-æ— è®ºæ‚¨æ˜¯æƒ³å°†è™šæ‹Ÿçƒä»åœ°æ¿ä¸Šå¼¹èµ·è¿˜æ˜¯å°†è™šæ‹Ÿæ²¹æ¼†æ‰”åˆ°å¢™ä¸Šã€‚æ¢ç´¢ARKit APIçš„æœ€æ–°æ›´æ–°ï¼Œå¹¶è·Ÿéšæˆ‘ä»¬æ¼”ç¤ºå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­åˆ©ç”¨æ‰‹è·Ÿè¸ªå’Œåœºæ™¯å‡ ä½•ã€‚
 
 ![](/assets/images/20230609LearnAboutVisionOS/RediscoverARKit.webp)
 
 * [Meet ARKit for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10082/)
 * [Evolve your ARKit app for spatial experiences](https://developer.apple.com/videos/play/wwdc2023/10091/)
 
## è®¾è®¡åŒå­¦éœ€è¦å…³æ³¨çš„visionOS

äº†è§£å¦‚ä½•ä¸ºç©ºé—´è®¡ç®—è®¾è®¡å‡ºè‰²çš„åº”ç”¨ç¨‹åºã€æ¸¸æˆå’Œä½“éªŒã€‚å‘ç°å…¨æ–°çš„è¾“å…¥å’Œç»„ä»¶ã€‚æ½œå…¥æ·±åº¦å’Œè§„æ¨¡ã€‚å¢åŠ æ²‰æµ¸çš„æ—¶åˆ»ã€‚åˆ›å»ºç©ºé—´éŸ³é¢‘éŸ³æ™¯ã€‚å¯»æ‰¾åˆä½œå’Œè”ç³»çš„æœºä¼šã€‚å¹¶å¸®åŠ©äººä»¬åœ¨æ¢ç´¢å…¨æ–°ä¸–ç•Œçš„åŒæ—¶ä¿æŒå¯¹å‘¨å›´ç¯å¢ƒçš„è„šè¸å®åœ°ã€‚æ— è®ºè¿™æ˜¯æ‚¨ç¬¬ä¸€æ¬¡è®¾è®¡ç©ºé—´ä½“éªŒï¼Œè¿˜æ˜¯æ‚¨å¤šå¹´æ¥ä¸€ç›´åœ¨æ„å»ºå®Œå…¨æ²‰æµ¸å¼çš„åº”ç”¨ç¨‹åºï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨visionOSåˆ›å»ºç¥å¥‡çš„è‹±é›„æ—¶åˆ»ï¼Œè¿·äººçš„éŸ³æ™¯ï¼Œä»¥äººä¸ºä¸­å¿ƒçš„UIç­‰ç­‰ã€‚

![](/assets/images/20230609LearnAboutVisionOS/DesignforvisionOS.webp)

* [Principles of spatial design](https://developer.apple.com/videos/play/wwdc2023/10072/)
* [Design for spatial user interfaces](https://developer.apple.com/videos/play/wwdc2023/10076/)
* [Design for spatial input](https://developer.apple.com/videos/play/wwdc2023/10073/)
* [Explore immersive sound design](https://developer.apple.com/videos/play/wwdc2023/10271/)
* [Design considerations for vision and motion](https://developer.apple.com/videos/play/wwdc2023/10078/)

## visionOSå¼€å‘å·¥å…·åŒ…

Appleæä¾›äº†ä¸€å¥—å…¨é¢çš„å·¥å…·æ¥å¸®åŠ©æ‚¨ä¸ºvisionOSæ„å»ºå‡ºè‰²çš„åº”ç”¨ç¨‹åºã€æ¸¸æˆå’Œä½“éªŒã€‚äº†è§£å¦‚ä½•åœ¨Xcodeä¸­å¼€å§‹æ‚¨çš„ç¬¬ä¸€ä¸ªvisionOSé¡¹ç›®ï¼Œæ¢ç´¢å·¥å…·å’Œæµ‹è¯•çš„æ›´æ–°ï¼Œäº†è§£å¦‚ä½•åœ¨æ‚¨çš„3Då¼€å‘å·¥ä½œæµç¨‹ä¸­åˆ©ç”¨Reality Composer Proï¼Œå¹¶äº†è§£å¦‚ä½•ä½¿ç”¨Unityçš„åˆ›ä½œå·¥å…·ä¸ºç©ºé—´è®¡ç®—åˆ›é€ å‡ºè‰²çš„ä½“éªŒã€‚

## Xcodeå¼€å‘éœ€è¦å…³æ³¨çš„

ç”¨Xcodeå¼€å§‹ä¸ºvisionOSå¼€å‘ã€‚æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†visionOSç›®çš„åœ°æ·»åŠ åˆ°æ‚¨ç°æœ‰çš„é¡¹ç›®æˆ–æ„å»ºä¸€ä¸ªå…¨æ–°çš„åº”ç”¨ç¨‹åºï¼Œåœ¨Xcodeé¢„è§ˆä¸­çš„åŸå‹ï¼Œå¹¶ä»Reality Composer Proå¯¼å…¥å†…å®¹ã€‚æˆ‘ä»¬è¿˜å°†åˆ†äº«å¦‚ä½•ä½¿ç”¨visionOSæ¨¡æ‹Ÿå™¨æ¥è¯„ä¼°æ‚¨å¯¹å„ç§æ¨¡æ‹Ÿåœºæ™¯å’Œç…§æ˜æ¡ä»¶çš„ä½“éªŒã€‚äº†è§£å¦‚ä½•åˆ›å»ºæµ‹è¯•å’Œå¯è§†åŒ–ï¼Œä»¥æ¢ç´¢ç©ºé—´å†…å®¹çš„ç¢°æ’ã€é®æŒ¡å’Œåœºæ™¯ç†è§£ï¼Œå¹¶ä¼˜åŒ–è¯¥å†…å®¹çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚

![](/assets/images/20230609LearnAboutVisionOS/ExploredevelopertoolsforvisionOS.webp)

* [What's new in Xcode 15](https://developer.apple.com/videos/play/wwdc2023/10165/)
* [Develop your first immersive app](https://developer.apple.com/videos/play/wwdc2023/10203/)
* [Meet RealityKit Trace](https://developer.apple.com/videos/play/wwdc2023/10099/)
* [Explore rendering for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10095/)
* [Optimize app power and performance for spatial computing
](https://developer.apple.com/videos/play/wwdc2023/10100/)
* [Meet Core Location for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10146/)

## Reality Composer Pro

å‘ç°é¢„è§ˆå’Œå‡†å¤‡3Då†…å®¹çš„æ–°æ–¹æ³•ä¸ºæ‚¨çš„visionOSåº”ç”¨ç¨‹åºã€‚æœ¬æœˆæ™šäº›æ—¶å€™ï¼Œç°å®ä½œæ›²å®¶ä¸“ä¸šåˆ©ç”¨ç¾å…ƒçš„åŠ›é‡æ¥å¸®åŠ©æ‚¨æ’°å†™ï¼Œç¼–è¾‘å’Œé¢„è§ˆèµ„äº§ï¼Œå¦‚3Dæ¨¡å‹ï¼Œææ–™å’Œå£°éŸ³ã€‚æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•åˆ©ç”¨æ­¤å·¥å…·ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºåˆ›å»ºèº«ä¸´å…¶å¢ƒçš„å†…å®¹ï¼Œå‘å¯¹è±¡æ·»åŠ ææ–™ï¼Œå¹¶å°†æ‚¨çš„ç°å®ä½œæ›²å®¶Proå†…å®¹å¸¦å…¥Xcodeä¸­ã€‚æˆ‘ä»¬è¿˜å°†å¸¦æ‚¨äº†è§£Appleå¹³å°ä¸Šé€šç”¨åœºæ™¯æè¿°(USD)çš„æœ€æ–°æ›´æ–°ã€‚

![](/assets/images/20230609LearnAboutVisionOS/MeetRealityComposerPro.webp)

* [Meet Reality Composer Pro](https://developer.apple.com/videos/play/wwdc2023/10083/)
* [Explore materials in Reality Composer Pro](https://developer.apple.com/videos/play/wwdc2023/10202/)
* [Work with Reality Composer Pro content in Xcode](https://developer.apple.com/videos/play/wwdc2023/10273/)
* [Explore the USD ecosystem](https://developer.apple.com/videos/play/wwdc2023/10086/)

## å­¦ä¹ Unity

![](/assets/images/20230609LearnAboutVisionOS/GetstartedwithUnity.webp)

## TestFlight and App Store Connect

![](/assets/images/20230609LearnAboutVisionOS/LearnaboutTestFlightandAppStoreConnect.webp)

[Explore App Store Connect for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10012/)

## æ¸¸æˆå’ŒéŸ³è§†é¢‘å¤šåª’ä½“

äº†è§£å¦‚ä½•ä½¿ç”¨visionOSåœ¨æ¸¸æˆå’Œåª’ä½“ä½“éªŒä¸­åˆ›é€ çœŸæ­£èº«ä¸´å…¶å¢ƒçš„æ—¶åˆ»ã€‚æ¸¸æˆå’Œåª’ä½“å¯ä»¥åˆ©ç”¨å…¨æ–¹ä½çš„æ²‰æµ¸æ„Ÿæ¥è®²è¿°ä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ•…äº‹ï¼Œå¹¶ä»¥ä¸€ç§æ–°çš„æ–¹å¼ä¸äººä»¬å»ºç«‹è”ç³»ã€‚æˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¯ç”¨çš„é€”å¾„ï¼Œè®©æ‚¨å¼€å§‹ä¸visionOSçš„æ¸¸æˆå’Œå™äº‹å¼€å‘ã€‚å­¦ä¹ ä½¿ç”¨RealityKitæœ‰æ•ˆæ¸²æŸ“3Då†…å®¹çš„æ–¹æ³•ï¼Œæ¢ç´¢è§†è§‰å’Œè¿åŠ¨çš„è®¾è®¡è€ƒè™‘å› ç´ ï¼Œå¹¶äº†è§£å¦‚ä½•åˆ›å»ºå®Œå…¨èº«ä¸´å…¶å¢ƒçš„ä½“éªŒï¼Œå°†äººä»¬å¸¦å…¥ä¸€ä¸ªæ–°çš„ä¸–ç•Œ

![](/assets/images/20230609LearnAboutVisionOS/Buildgamesandmediaexperiences1.webp)  

* [Build great games for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10096/)
* [Explore rendering for spatial computing](https://developer.apple.com/videos/play/wwdc2023/10095/)
* [Design considerations for vision and motion](https://developer.apple.com/videos/play/wwdc2023/10078/)
* [Create immersive Unity apps](https://developer.apple.com/videos/play/wwdc2023/10088/)
* [Bring your Unity VR app to a fully immersive space
](https://developer.apple.com/videos/play/wwdc2023/10093/)
* [Discover Metal for immersive apps](https://developer.apple.com/videos/play/wwdc2023/10089/)

å£°éŸ³ä¹Ÿå¯ä»¥æå¤§åœ°å¢å¼ºä½ çš„visionOSåº”ç”¨ç¨‹åºå’Œæ¸¸æˆçš„ä½“éªŒ-æ— è®ºä½ æ·»åŠ ä¸€ä¸ªæ•ˆæœçš„æŒ‰é’®æŒ‰ä¸‹æˆ–åˆ›å»ºä¸€ä¸ªå®Œå…¨èº«ä¸´å…¶å¢ƒçš„éŸ³æ™¯ã€‚äº†è§£Appleè®¾è®¡å¸ˆå¦‚ä½•é€‰æ‹©å£°éŸ³å’Œæ„å»ºå£°æ™¯ï¼Œåœ¨çª—å£ã€ä½“é‡å’Œç©ºé—´ä¸­åˆ›é€ å¯Œæœ‰è´¨æ„Ÿçš„æ²‰æµ¸å¼ä½“éªŒã€‚æˆ‘ä»¬å°†åˆ†äº«å¦‚ä½•åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ä¸°å¯Œå£°éŸ³çš„åŸºæœ¬äº¤äº’ï¼Œå½“æ‚¨åœ¨ç©ºé—´ä¸Šæ”¾ç½®éŸ³é¢‘çº¿ç´¢æ—¶ï¼Œå˜åŒ–é‡å¤çš„å£°éŸ³ï¼Œå¹¶åœ¨æ‚¨çš„åº”ç”¨ç¨‹åºä¸­æ„å»ºå£°éŸ³æ„‰æ‚¦çš„æ—¶åˆ»ã€‚

![](/assets/images/20230609LearnAboutVisionOS/Buildgamesandmediaexperiences2.webp)  

* [Explore immersive sound design](https://developer.apple.com/videos/play/wwdc2023/10271/)

å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæˆ–æ¸¸æˆå…·æœ‰åª’ä½“å†…å®¹ï¼Œæˆ‘ä»¬æœ‰ä¸€ç³»åˆ—çš„ä¼šè®®ï¼Œæ—¨åœ¨å¸®åŠ©æ‚¨æ›´æ–°æ‚¨çš„è§†é¢‘ç®¡é“ï¼Œå¹¶ä¸ºvisionOSå»ºç«‹ä¸€ä¸ªä¼Ÿå¤§çš„æ’­æ”¾ä½“éªŒã€‚äº†è§£å¦‚ä½•æ‰©å±•äº¤ä»˜ç®¡é“ä»¥æ”¯æŒ3Då†…å®¹ï¼Œå¹¶è·å¾—åº”ç”¨ç¨‹åºä¸­ç©ºé—´åª’ä½“æµçš„æç¤ºå’ŒæŠ€æœ¯ã€‚æˆ‘ä»¬è¿˜å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨ä¸ºvisionOSæä¾›è§†é¢‘æ’­æ”¾çš„æ¡†æ¶å’Œapiåˆ›å»ºå¼•äººå…¥èƒœå’Œèº«ä¸´å…¶å¢ƒçš„æ’­æ”¾ä½“éªŒã€‚

![](/assets/images/20230609LearnAboutVisionOS/Buildgamesandmediaexperiences3.webp)  

* [Deliver video content for spatial experiences](https://developer.apple.com/videos/play/wwdc2023/10071/)
* [Create a great spatial playback experience](https://developer.apple.com/videos/play/wwdc2023/10070/)

## åä½œã€å…±äº«å’Œç”Ÿäº§åŠ›

å…±äº«å’Œåä½œæ˜¯visionOSçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šè¿‡åœ¨åº”ç”¨ç¨‹åºå’Œæ¸¸æˆä¸­æä¾›ä½“éªŒï¼Œè®©äººä»¬æ„Ÿè§‰ä»¿ä½›ç½®èº«äºåŒä¸€ä¸ªç©ºé—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäººä»¬å¯ä»¥é€šè¿‡FaceTimeé€šè¯ä¸ä»–äººå…±äº«ä»»ä½•åº”ç”¨ç¨‹åºçª—å£ï¼Œå°±åƒä»–ä»¬åœ¨Macä¸Šä¸€æ ·ã€‚ä½†æ˜¯å½“ä½ é‡‡ç”¨GroupActivitiesæ¡†æ¶æ—¶ï¼Œä½ å¯ä»¥åˆ›å»ºä¸‹ä¸€ä»£åä½œä½“éªŒã€‚

é€šè¿‡äº†è§£æ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­åˆ›å»ºçš„å…±äº«æ´»åŠ¨ç±»å‹ï¼Œå¼€å§‹åœ¨Apple Vision Proä¸Šè®¾è®¡å’Œæ„å»ºSharePlayã€‚äº†è§£å¦‚ä½•åœ¨ä½“éªŒä¸­çš„å‚ä¸è€…ä¹‹é—´å»ºç«‹å…±äº«ä¸Šä¸‹æ–‡ï¼Œå¹¶äº†è§£å¦‚ä½•é€šè¿‡æ”¯æŒç©ºé—´äººç‰©è§’è‰²åœ¨åº”ç”¨ç¨‹åºä¸­æ”¯æŒæ›´æœ‰æ„ä¹‰çš„äº¤äº’ã€‚
 
![](/assets/images/20230609LearnAboutVisionOS/Buildforcollaborationsharingandproductivity.webp)

* [Design spatial SharePlay experiences](https://developer.apple.com/videos/play/wwdc2023/10075/)
* [Build spatial SharePlay experiences](https://developer.apple.com/videos/play/wwdc2023/10087/) 

## webç›¸å…³å’Œåˆ›å»º3Dæ¨¡å‹ç›¸å…³

![](/assets/images/20230609LearnAboutVisionOS/Buildwebexperiences1.webp)
![](/assets/images/20230609LearnAboutVisionOS/Buildwebexperiences2.webp)

## å¦‚æœè®©æˆ‘ä»¬çš„è¿è¡Œåœ¨iPhoneå’ŒiPadçš„appè¿è¡Œåœ¨visionOSä¸Š

äº†è§£å¦‚ä½•åœ¨visionOSä¸­è¿è¡Œç°æœ‰çš„ipadå’ŒiOSåº”ç”¨ç¨‹åºã€‚æ¢ç´¢iPadå’ŒiOSåº”ç”¨ç¨‹åºå¦‚ä½•åœ¨è¿™ä¸ªå¹³å°ä¸Šè¿è¡Œï¼Œäº†è§£æ¡†æ¶ä¾èµ–å…³ç³»ï¼Œå¹¶äº†è§£ä¸“ä¸ºiPadè®¾è®¡çš„åº”ç”¨ç¨‹åºäº¤äº’ã€‚å½“æ‚¨å‡†å¤‡å¥½å°†ç°æœ‰åº”ç”¨ç¨‹åºæå‡åˆ°ä¸€ä¸ªæ–°çš„æ°´å¹³æ—¶ï¼Œæˆ‘ä»¬å°†å‘æ‚¨å±•ç¤ºå¦‚ä½•ä¼˜åŒ–å…±äº«ç©ºé—´çš„iPadå’ŒiPhoneåº”ç”¨ç¨‹åºä½“éªŒï¼Œå¹¶å¸®åŠ©æ‚¨æ”¹å–„è§†è§‰æ•ˆæœã€‚

![](/assets/images/20230609LearnAboutVisionOS/RunyouriPadandiPhoneappsinvisionOS.webp)

* [Run your iPad and iPhone apps in the Shared Space](https://developer.apple.com/videos/play/wwdc2023/10090/)
* [Enhance your iPad and iPhone apps for the Shared Space](https://developer.apple.com/videos/play/wwdc2023/10094/)

ä¸Šè¾¹è¿™é‡Œä½œä¸ºä¸€ä¸ªiOSå¼€å‘å¿…çœ‹


# æ€»ç»“ 

æ•´ç†äº†ä¸€äº›å­¦ä¹ visionOSçš„å…¨éƒ¨èµ„æ–™å’Œè§†é¢‘,å¸Œæœ›å¤§å®¶èƒ½åœ¨æ–°çš„visionOSä¸Šå¼€è¾Ÿæ–°çš„ä¸–ç•Œ,å°±åƒæˆ‘ä»¬åœ¨iOSèµ·æ­¥çš„æ—¶å€™é‚£æ ·.

[Learn about visionOSå®˜æ–¹åœ°å€](https://developer.apple.com/visionos/learn/)


URL: https://sunyazhou.com/2023/06/batchconvertheictopng/index.html.md
Published At: 2023-06-07 02:01:00 +0000

# Shellè„šæœ¬æ‰¹é‡å°†heicè½¬pngå’Œwebp

# å‰è¨€

![](/assets/images/20230607BatchConvertHEICtoPNG/chatgpt.webp)

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## å¦‚ä½•æ‰¹é‡å°†HECIå›¾ç‰‡è½¬æˆpng

æœ€è¿‘å…¬å¸ææ´»åŠ¨éœ€è¦æˆ‘ä»¬ç»„ç»‡å°ç»„ä¸šä½™çˆ±å¥½å¹¶è®°å½•ç¾å¥½ç”Ÿæ´»,é¿å…ä¸äº†æ‹ä¸€äº›ç…§ç‰‡,æˆ‘æ‰‹æœºå¿˜è®°äº†è®¾ç½®æ‰€ä»¥æ‹æ‘„å‡ºæ¥çš„ç…§ç‰‡éƒ½æ˜¯HEIC(H.265)ç¼–ç çš„æ ¼å¼,ç„¶è€Œå…¬å¸éœ€è¦çš„æ˜¯æŠŠè¿™äº›å›¾ç‰‡è½¬æˆpngæˆ–è€…jpegä¸Šä¼ ,æ‰€ä»¥å°±å› ä¸ºäº†ä»Šå¤©è¿™æ‰¹æŠ€æœ¯æ–‡ç« 

### ç¼–å†™è„šæœ¬HECIè½¬PNG

å…ˆçœ‹ä¸‹ä¹‹å‰çš„æ•ˆæœ
![](/assets/images/20230607BatchConvertHEICtoPNG/heic.webp)  
è½¬æ¢å®Œæˆåçš„æ•ˆæœ
![](/assets/images/20230607BatchConvertHEICtoPNG/pngs.webp)

ä¸‹é¢æ¥ç¼–å†™è„šæœ¬å®ç°

ä½œä¸ºä¸€ä¸ªå¾ˆå¤šå¹´éƒ½ä¸æ€ä¹ˆå­¦ä¹ ä½¿ç”¨è„šæœ¬çš„æˆ‘é¢å¯¹è¿™ä¸ªä¸€ä¸ªçªå¦‚å…¶æ¥çš„éœ€æ±‚æ¯”è¾ƒéº»æœ¨,å–µç¥æ›¾ç»è¯´è¿‡:"å¯¹äºä¸€äº›ä¸æ“…é•¿çš„æŠ€æœ¯å¾ˆå¤šäººåˆšæ¥è§¦çš„æ—¶å€™ä¼šæœ‰ä¸€ç§ææƒ§æ„Ÿ,è¿™ç§ææƒ§æºäºæœªçŸ¥!"ã€‚é‚£ä¹ˆæ€ä¹ˆè§£å†³è‡ªå·±ä¸äº†è§£çš„æŠ€æœ¯éš¾é¢˜çš„å‘¢?--`ChatGPT`

å…ˆæ‰“å¼€[ChatGPT](https://chat.openai.com/), è¾“å…¥å¦‚ä¸‹:

``` txt
å†™ä¸ªshellè„šæœ¬ æŒ‡å®š Mac  ä¸­Downloadsç›®å½•ä¸‹çš„æ‰€æœ‰HEICæ ¼å¼ä¸€æ¬¡æ‰¹é‡è½¬æˆpng
```

å½“ä½¿ç”¨Shellè„šæœ¬å°†`Mac`ä¸­`Downloads`ç›®å½•ä¸‹çš„æ‰€æœ‰`HEIC`æ ¼å¼æ–‡ä»¶æ‰¹é‡è½¬æ¢ä¸º`PNG`æ ¼å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`sips`å‘½ä»¤æ¥å®Œæˆã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼š

``` sh
#!/bin/bash

# å®šä¹‰Downloadç›®å½•è·¯å¾„
download_dir="$HOME/Downloads"

# è½¬æ¢HEICæ–‡ä»¶ä¸ºPNGæ ¼å¼
convert_heic_to_png() {
  local file_path="$1"
  local file_name="$(basename "$file_path")"
  local file_extension="${file_name##*.}"
  local file_name_no_extension="${file_name%.*}"
  
  if [[ "$file_extension" == "HEIC" || "$file_extension" == "heic" ]]; then
    png_file_path="$download_dir/$file_name_no_extension.png"
    sips -s format png "$file_path" --out "$png_file_path"
    echo "è½¬æ¢å®Œæˆ: $png_file_path"
  fi
}

# éå†Downloadç›®å½•ä¸‹çš„æ–‡ä»¶
find "$download_dir" -type f | while read -r file; do
  convert_heic_to_png "$file"
done

```

è¯·å°†ä¸Šè¿°è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼ˆä¾‹å¦‚`convert_heic_to_png.sh`ï¼‰ï¼Œç„¶åæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç»™è„šæœ¬æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ï¼š

``` sh
chmod +x convert_heic_to_png.sh
```

ä¹‹åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ï¼š

``` sh
./convert_heic_to_png.sh

```

è„šæœ¬å°†ä¼šéå†Downloadç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶å°†HEICæ ¼å¼çš„æ–‡ä»¶è½¬æ¢ä¸ºPNGæ ¼å¼ï¼Œè½¬æ¢åçš„PNGæ–‡ä»¶å°†å­˜å‚¨åœ¨ç›¸åŒç›®å½•ä¸‹ã€‚è„šæœ¬ä¼šè¾“å‡ºæ¯ä¸ªè½¬æ¢å®Œæˆçš„PNGæ–‡ä»¶è·¯å¾„ã€‚æ³¨æ„ï¼Œè„šæœ¬ä»…åœ¨Macç³»ç»Ÿä¸Šæœ‰æ•ˆï¼Œä¸”éœ€è¦å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·ä»¥è·å–`sips`å‘½ä»¤ã€‚

### ç¼–å†™è„šæœ¬HECIè½¬webp

å½“ä½¿ç”¨Shellè„šæœ¬å°†Macä¸­Downloadsç›®å½•ä¸‹çš„æ‰€æœ‰HEICæ ¼å¼æ–‡ä»¶æ‰¹é‡è½¬æ¢ä¸ºWebPæ ¼å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨`cwebp`å‘½ä»¤æ¥å®Œæˆã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹è„šæœ¬ï¼š

``` sh
#!/bin/bash

# å®šä¹‰Downloadsç›®å½•è·¯å¾„
downloads_dir="$HOME/Downloads"

# è½¬æ¢HEICæ–‡ä»¶ä¸ºWebPæ ¼å¼
convert_heic_to_webp() {
  local file_path="$1"
  local file_name="$(basename "$file_path")"
  local file_extension="${file_name##*.}"
  local file_name_no_extension="${file_name%.*}"
  
  if [[ "$file_extension" == "HEIC" || "$file_extension" == "heic" ]]; then
    webp_file_path="$downloads_dir/$file_name_no_extension.webp"
    cwebp -q 80 "$file_path" -o "$webp_file_path"
    echo "è½¬æ¢å®Œæˆ: $webp_file_path"
  fi
}

# éå†Downloadsç›®å½•ä¸‹çš„æ–‡ä»¶
find "$downloads_dir" -type f | while read -r file; do
  convert_heic_to_webp "$file"
done

```

è¯·å°†ä¸Šè¿°è„šæœ¬ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼ˆä¾‹å¦‚`convert_heic_to_webp.sh`ï¼‰ï¼Œç„¶åæ‰“å¼€ç»ˆç«¯ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç»™è„šæœ¬æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™ï¼š

``` sh
chmod +x convert_heic_to_webp.sh
```

ä¹‹åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ï¼š

``` sh
./convert_heic_to_webp.sh
```
è„šæœ¬å°†ä¼šéå†Downloadsç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œå¹¶å°†HEICæ ¼å¼çš„æ–‡ä»¶è½¬æ¢ä¸ºWebPæ ¼å¼ï¼Œè½¬æ¢åçš„WebPæ–‡ä»¶å°†å­˜å‚¨åœ¨ç›¸åŒç›®å½•ä¸‹ã€‚è„šæœ¬ä¼šè¾“å‡ºæ¯ä¸ªè½¬æ¢å®Œæˆçš„WebPæ–‡ä»¶è·¯å¾„ã€‚æ³¨æ„ï¼Œè„šæœ¬ä»…åœ¨Macç³»ç»Ÿä¸Šæœ‰æ•ˆï¼Œä¸”éœ€è¦å®‰è£…`webp`åº“ä»¥è·å–`cwebp`å‘½ä»¤ã€‚ä½ å¯ä»¥é€šè¿‡Homebrewæ¥å®‰è£…`webp`åº“ï¼š

``` sh
brew install webp
```

è‡³äºå¦‚ä½•è½¬æ¢å…¶å®ƒç±»å‹ æˆ‘åº”è¯¥ä¸ç”¨å†è¯´äº†å§!

# æ€»ç»“

ç®€ç›´è¢«ChatGPTçš„ç¥å¥‡åŠ›é‡ç‚¸è£‚,æˆ‘ä¸å’‹ä¼šå†™è„šæœ¬,è¿™å¤ªå¥½ç”¨äº†.åˆ†äº«ç»™å¤§å®¶.

[ç‚¹å‡»è¿™é‡Œä¸‹è½½æœ¬æ–‡çš„è„šæœ¬æ–‡ä»¶](https://github.com/sunyazhou13/BatchConvertImagesShells)


URL: https://sunyazhou.com/2023/06/learnswiftuichapter1/index.html.md
Published At: 2023-06-04 05:32:00 +0000

# SwiftUIç¬¬ä¸€ç« å­¦ä¹ æ€»ç»“

![](/assets/images/20230604LearnSwiftUIChapter1/swiftuilogo.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# SwiftUIè¯¾ç¨‹

æœ€è¿‘åœ¨å¬Bç«™ä»¥ä¸ºæ¥è‡ªç¥–å›½å®å²›å°æ¹¾çœçš„ä¸€ä¸ªå¥³åšä¸»(å£°éŸ³å¾ˆå—²dia)è®²è§£SwiftUIè¯¾ç¨‹,è®²çš„ä¸é”™æŠŠå­¦ä¹ çš„å†…å®¹è®°å½•ä¸‹æ¥:

## ä¸»è¦å†…å®¹åŒ…å«

![](/assets/images/20230604LearnSwiftUIChapter1/finalproject.gif)

1-5 ç¬¬ä¸€ç« è¡¥å……ï¼šsome Viewã€æ’ç‰ˆè§„åˆ™ã€è®¾è®¡ç»†èŠ‚ - SwiftUI æ–°æ‰‹å…¥é—¨


* SwiftUIåŸºæœ¬æ¶æ„
* View å’Œ è°ƒæ•´å™¨(å°±æ˜¯ä¸€äº›è§†å›¾çš„å‡½æ•°æ–¹æ³•)
* @State å±æ€§å°è£…å™¨
* å˜å½¢å’Œè½¬åœºåŠ¨ç”» SwiftUIé»˜è®¤æœ‰è½¬åœºå’Œå˜å½¢çš„æ˜¾ç¤ºåŠ¨ç”»
* Viewçš„èº«ä»½ 
* SwiftUI å¦‚ä½•æ’ç‰ˆå’Œ Viewçš„å¸¦ä¸‹ç±»å‹ å°¤å…¶æ˜¯ `some View`æ˜¯å’‹å›äº‹


è®²çš„æ¯”è¾ƒä¸é”™

## ä»£ç è®°å½•

``` swift
//
//  ContentView.swift
//  FoodPicker
//
//  Created by sunyazhou on 2023/4/16.
//

import SwiftUI

struct ContentView: View {
    let food = ["æ±‰å ¡", "æ²™æ‹‰", "æŠ«è¨", "æ„å¤§åˆ©é¢", "é¸¡è…¿ä¾¿å½“", "åˆ€å‰Šé¢", "ç«é”…", "ç‰›è‚‰é¢", "å…³ä¸œç…®"]
    @State private var selectedFood: String?
    var body: some View {
        VStack(spacing: 30) {
            Image("dinner")
                .resizable()
                .aspectRatio(contentMode: .fit)
            Text("ä»Šå¤©åƒä»€ä¹ˆ?")
                .bold()
            if selectedFood != .none {
                Text(selectedFood ?? "")
                    .font(.largeTitle)
                    .bold()
                    .foregroundColor(.green)
                    .id(selectedFood)
                    .transition(.asymmetric(
                        insertion:.opacity
                                  .animation(.easeInOut(duration: 0.5).delay(0.2)),
                        removal:.opacity
                                .animation(.easeInOut(duration: 0.4))))
            }
            
            Button {
//                withAnimation {
//                }
                selectedFood = food.shuffled().filter {$0 != selectedFood }.first
            } label: {
                Text(selectedFood == .none ? "å‘Šè¯‰æˆ‘!": "æ¢ä¸€ä¸ª").frame(width: 200, alignment: .center)
                    .animation(.none, value: selectedFood)
                    .transformEffect(.identity)
            }.padding(.bottom, -15)
            
            Button {
//                withAnimation {
//                    selectedFood = .none
//                }
                selectedFood = .none
            } label: {
                Text("é‡ç½®").frame(width: 200)
            }.buttonStyle(.bordered)
        }
        .padding()
        .frame(maxHeight: .infinity)
        .background(Color(.secondarySystemBackground))
        .font(.title)
        .buttonStyle(.borderedProminent)
        .buttonBorderShape(.capsule)
        .controlSize(.large)
        .animation(.easeInOut(duration: 0.6), value: selectedFood)
    }
}

struct ContentView_Previews: PreviewProvider {
    static var previews: some View {
        ContentView()
    }
}

```

è¿™é‡Œæœ‰å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„å†…å®¹

![](/assets/images/20230604LearnSwiftUIChapter1/ViewSizeType1.webp)

![](/assets/images/20230604LearnSwiftUIChapter1/ViewSizeType2.webp)

* 1.åŠ¨æ€å­—ä½“å¤§å° Dynamic type [Human Interface Guildlines](https://developer.apple.com/design/human-interface-guidelines/)
* 2.å±å¹•ç¼©æ”¾ç³»æ•° [å±å¹•å¤§å°å’Œ Scale factor](https://iosref.com/res
)

è¿™é‡Œçš„ä¸€äº›åŠ¨ç”»å¾ˆå¥½,è¿™é‡Œä¸å±•å¼€ç»†èŠ‚è®¨è®ºäº†,è®°å½•ä¸€äº›ä»£ç demoæˆ‘æ”¾åœ¨ä¸‹æ–¹é“¾æ¥

# æ€»ç»“

å·¥ä½œæ—¶é—´å¾ˆç´§å¼ ,å‘¨æœ«æœ‰æ—¶é—´è®°å½•ä¸€äº›é‡è¦å®¹æ˜“è¢«é—å¿˜çš„å†…å®¹,å¾ˆæ°´,å¸Œæœ›å¤§å®¶ä¸è¦ä»‹æ„.

[æœ¬æ–‡demo](https://github.com/sunyazhou13/FoodPicker)  
[1-5 ç¬¬ä¸€ç« è¡¥å……ï¼šsome Viewã€æ’ç‰ˆè§„åˆ™ã€è®¾è®¡ç»†èŠ‚ - SwiftUI æ–°æ‰‹å…¥é—¨
](https://www.bilibili.com/video/BV1CG411776w/?p=6&spm_id_from=pageDriver)


URL: https://sunyazhou.com/2023/04/cocoapodsuserguide/index.html.md
Published At: 2023-04-26 03:22:00 +0000

# CocoaPodså®Œå…¨ä½¿ç”¨æŒ‡å—

![](/assets/images/20201010PodSpec/cocoapods.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


åœ¨æˆ‘çš„æŠ€æœ¯è®¤çŸ¥é‡Œ, Cocoapodså·²ç»æˆä¸ºæ¯ä¸€ä½iOSå¼€å‘è€…å¿…å¤‡çš„æŠ€èƒ½ä¹‹ä¸€,ç„¶åè¿™ä¹ˆå¤šå¹´è¿‡å»äº†,åœ¨æˆ‘è®¤ä¸ºå®ƒå·²ç»è¿‡æ—¶äº†çš„æ—¶å€™å±…ç„¶è¿˜æœ‰äººå¯¹è¿™ä¸ªä¸œè¥¿ç©çš„ä¸é€å½»,ä»Šå¤©æˆ‘å°±æŠŠæˆ‘è¿™ä¹ˆå¤šå¹´ä½¿ç”¨çš„ç»éªŒé«˜é˜¶éƒ¨åˆ†å…¨éƒ¨éƒ½æ‹¿å‡ºæ¥è·Ÿä¸ç†Ÿæ‚‰è¿™ä¸ªå·¥å…·çš„åŒè¡Œåˆ†äº«ä¸€ä¸‹.

å¯¹äºå¤§å¤šæ•°è½¯ä»¶å¼€å‘å›¢é˜Ÿæ¥è¯´ï¼Œä¾èµ–ç®¡ç†å·¥å…·å¿…ä¸å¯å°‘ï¼Œå®ƒèƒ½é’ˆå¯¹å¼€æºå’Œç§æœ‰ä¾èµ–è¿›è¡Œå®‰è£…ä¸ç®¡ç†ï¼Œä»è€Œæå‡å¼€å‘æ•ˆç‡ï¼Œé™ä½ç»´æŠ¤æˆæœ¬ã€‚é’ˆå¯¹ä¸åŒçš„è¯­è¨€ä¸å¹³å°ï¼Œå…¶ä¾èµ–ç®¡ç†å·¥å…·ä¹Ÿå„æœ‰ä¸åŒï¼Œä¾‹å¦‚`npm`ç®¡ç†`Javascript`ã€`Gradle `ã€`Maven` ç®¡ç†`Jar` åŒ…ã€`pip `ç®¡ç† `Python `åŒ…ï¼Œ`Bundler`ã€`RubyGems`ç­‰ç­‰ã€‚æœ¬æ–‡èšç„¦äº` iOS `æ–¹é¢ï¼Œå¯¹ `CocoaPods `çš„ä½¿ç”¨å’Œéƒ¨åˆ†åŸç†è¿›è¡Œé˜è¿°ã€‚


## ç®€å•æ˜“ç”¨çš„ CocoaPods

å¯¹äº iOSer æ¥è¯´ï¼ŒCocoaPods å¹¶ä¸é™Œç”Ÿï¼Œå‡ ä¹æ‰€æœ‰çš„ iOS å·¥ç¨‹éƒ½ä¼šæœ‰å®ƒçš„èº«å½±ã€‚CocoaPods é‡‡ç”¨ Ruby æ„å»ºï¼Œå®ƒæ˜¯ Swift å’Œ Objective-C Cocoa é¡¹ç›®çš„ä¾èµ–ç®¡ç†å·¥å…·ã€‚åœ¨ MacOS ä¸Šï¼Œæ¨èä½¿ç”¨é»˜è®¤çš„ Ruby è¿›è¡Œå®‰è£… (ä»¥ä¸‹æ“ä½œå‡åœ¨ CocoaPods 1.10.1ã€Ruby 2.7.2 è¿›è¡Œ)ï¼š


``` objc
sudo gem install cocoapods
```

å¦‚æœå®‰è£…æˆåŠŸï¼Œä¾¿å¯ä»¥ä½¿ç”¨ pod çš„ç›¸å…³å‘½ä»¤äº†ã€‚é’ˆå¯¹ä¸€ä¸ªç®€å•çš„é¡¹ç›®æ¥è¯´ï¼Œåªéœ€ä¸‰æ­¥ä¾¿å¯å¼•å…¥å…¶ä»–çš„ä¾èµ–ï¼š

* 1.åˆ›å»º Podfile æ–‡ä»¶( CocoaPods æä¾›äº† pod init å‘½ä»¤åˆ›å»º)
* 2.å¯¹ Podfile æ–‡ä»¶è¿›è¡Œç¼–å†™ï¼Œæ·»åŠ ä¾èµ–çš„åº“ï¼Œç‰ˆæœ¬ç­‰ä¿¡æ¯ã€‚
* 3.åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ `pod install` å‘½ä»¤

é¡ºåˆ©çš„è¯ï¼Œè¿™æ—¶åœ¨é¡¹ç›®ç›®å½•ä¸‹ä¼šå‡ºç°ä»¥ä¸‹æ–‡ä»¶ï¼š

* .xcworkspaceï¼šCocoaPods å°†é¡¹ç›®åˆ†ä¸ºäº†ä¸»å·¥ç¨‹ä¸ä¾èµ–å·¥ç¨‹(Pods)ã€‚ä¸ .xcodeproj ç›¸æ¯” .xcworkspace å¯¹äºç®¡ç†å¤šä¸ªé¡¹ç›®çš„èƒ½åŠ›æ›´å¼ºï¼Œä½ ä¹Ÿå¯ä»¥å°†å¤æ‚çš„å¤§å‹åº”ç”¨è½¬æ¢ä¸ºä»¥ .xcworkspace æ„å»ºçš„å¤šä¸ªå…„å¼Ÿé¡¹ç›®ï¼Œä»è€Œæ›´è½»æ¾çš„ç»´æŠ¤å’Œå…±äº«åŠŸèƒ½ã€‚
* Podfile.lockï¼šè®°å½•å¹¶è·Ÿè¸ªä¾èµ–åº“ç‰ˆæœ¬ï¼Œå°†ä¾èµ–åº“é”å®šäºæŸä¸ªç‰ˆæœ¬ã€‚
* Pods æ–‡ä»¶å¤¹ï¼šå­˜æ”¾ä¾èµ–åº“ä»£ç ã€‚
* Pods/Manifest.lockï¼šæ¯æ¬¡ pod install æ—¶åˆ›å»ºçš„ `Podfile.lock`çš„å‰¯æœ¬ï¼Œç”¨äºæ¯”è¾ƒè¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚ä¸€èˆ¬æ¥è¯´, Podfile.lock ä¼šçº³å…¥ç‰ˆæœ¬æ§åˆ¶ç®¡ç†ï¼Œè€Œ Pods æ–‡ä»¶å¤¹åˆ™ä¸ä¼šçº³å…¥ç‰ˆæœ¬æ§åˆ¶å˜æ›´ï¼›è¿™æ„å‘³ç€ Podfile.lock è¡¨ç¤ºé¡¹ç›®åº”è¯¥ä¾èµ–çš„åº“ç‰ˆæœ¬ä¿¡æ¯ï¼Œè€Œ Manifest.lock åˆ™ä»£è¡¨æœ¬åœ° Pods çš„ä¾èµ–åº“ç‰ˆæœ¬ä¿¡æ¯ã€‚åœ¨ pod install åä¼šå°†è„šæœ¬æ’å…¥åˆ° Build Phasesï¼Œåä¸º `[CP] Check Pods Manifest.lock`ï¼Œä»è€Œä¿è¯å¼€å‘è€…åœ¨è¿è¡Œ app ä¹‹å‰èƒ½å¤Ÿæ›´æ–° Podsï¼Œä»¥ç¡®ä¿ä»£ç æ˜¯æœ€æ–°çš„ã€‚

## pod install vs. pod update

* `pod install`ï¼šåœ¨æ¯ä¸€æ¬¡ç¼–è¾‘ Podfile ä»¥æ·»åŠ ã€æ›´æ–°æˆ–åˆ é™¤ pod æ—¶ä½¿ç”¨ã€‚å®ƒä¼šä¸‹è½½å¹¶å®‰è£…æ–°çš„ Podï¼Œå¹¶å°†å…¶ç‰ˆæœ¬ä¿¡æ¯å†™å…¥ Podfile.lock ä¸­ã€‚
* `pod outdated`ï¼šåˆ—å‡ºæ‰€æœ‰æ¯” Podfile.lock ä¸­å½“å‰è®°å½•çš„ç‰ˆæœ¬ newer ç‰ˆæœ¬çš„ podã€‚
* `pod update [PODNAME]`ï¼šCocoaPods ä¼šæŸ¥æ‰¾ newer ç‰ˆæœ¬çš„ PODNAMEï¼ŒåŒæ—¶å°† pod æ›´æ–°åˆ°å¯èƒ½çš„æœ€æ–°ç‰ˆæœ¬(é¡»ç¬¦åˆ Podfile é™åˆ¶)ã€‚è‹¥æ²¡æœ‰ PODNAMEï¼Œåˆ™ä¼šå°†æ¯ä¸€ä¸ª pod æ›´æ–°åˆ°å¯èƒ½çš„æœ€æ–°ç‰ˆæœ¬ã€‚

ä¸€èˆ¬æ¥è¯´ï¼Œæ¯æ¬¡ç¼–è¾‘ Podfile æ—¶ä½¿ç”¨ `pod install`ï¼Œä»…åœ¨éœ€è¦æ›´æ–°æŸä¸ª pod ç‰ˆæœ¬(æ‰€æœ‰ç‰ˆæœ¬)æ—¶æ‰ä½¿ç”¨ pod updateã€‚åŒæ—¶ï¼Œéœ€æäº¤ Podfile.lock æ–‡ä»¶è€Œä¸æ˜¯ Pods æ–‡ä»¶å¤¹æ¥è¾¾åˆ°åŒæ­¥æ‰€æœ‰ pod ç‰ˆæœ¬çš„ç›®çš„ã€‚

> newer ä»£è¡¨æ›´åŠ æ–°çš„ï¼Œè‹¥é‡‡ç”¨ä¸­æ–‡ç†è§£èµ·æ¥æ¯”è¾ƒåˆ«æ‰­ã€‚

## Podfile è¯­æ³•è§„èŒƒ

Podfile æè¿°äº†ä¸€ä¸ªæˆ–å¤šä¸ª Xcode é¡¹ç›®çš„ target ä¾èµ–å…³ç³»ï¼Œå®ƒæ˜¯ä¸€ç§ DSLï¼Œäº†è§£å®ƒå¯¹æˆ‘ä»¬ä½¿ç”¨å¥½ CocoaPods æ˜¯ä¸€ä¸ªå¿…ä¸å¯å°‘çš„æ­¥éª¤ã€‚ä¸‹é¢åˆ—å‡ºå…¶ç›¸å…³çš„è¯­æ³•è§„èŒƒï¼š

#### Root Options

`install!`ï¼šæŒ‡å®š CocoaPods å®‰è£… Podfile æ—¶ä½¿ç”¨çš„å®‰è£…æ–¹æ³•å’Œé€‰é¡¹ã€‚å¦‚ï¼š

``` sh
install! 'cocoapods',
         :deterministic_uuids => false,
         :integrate_targets => false
```

* `:clean`ï¼šæ ¹æ® podspec å’Œé¡¹ç›®æ”¯æŒå¹³å°çš„æŒ‡å®šï¼Œæ¸…ç†æ‰€æœ‰ä¸è¢« pod ä½¿ç”¨çš„æ–‡ä»¶ï¼Œé»˜è®¤ä¸º trueã€‚
* `:deduplicate_targets`ï¼šæ˜¯å¦å¯¹ pod target è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤ï¼Œé»˜è®¤ä¸º trueã€‚
* `:deterministic_uuids`ï¼šåˆ›å»º pod project æ˜¯å¦äº§ç”Ÿç¡®å®šæ€§ UUIDï¼Œé»˜è®¤ä¸º trueã€‚
* `:integrate_targets`ï¼šæ˜¯å¦ç»§æ‰¿åˆ°ç”¨æˆ·é¡¹ç›®ä¸­ï¼Œä¸º false ä¼šå°† Pod ä¸‹è½½å¹¶å®‰è£…åˆ°åˆ° project_path/Pods ç›®å½•ä¸‹ï¼Œé»˜è®¤ä¸º trueã€‚
* `:lock_pos_sources`ï¼šæ˜¯å¦é”å®š pod çš„æºæ–‡ä»¶ï¼Œå½“ Xcode å°è¯•ä¿®æ”¹æ—¶ä¼šæç¤ºè§£é”æ–‡ä»¶ï¼Œé»˜è®¤ä¸º trueã€‚
* `:warn_for_multiple_pod_sources`ï¼šå½“å¤šä¸ª source åŒ…å«åŒååŒç‰ˆæœ¬ pod æ—¶æ˜¯å¦å‘å‡ºè­¦å‘Šï¼Œé»˜è®¤ä¸º trueã€‚
* `:warn_for_unused_master_specs_repo`ï¼šå¦‚æœæ²¡æœ‰æ˜ç¡®æŒ‡å‡º master specs repo çš„ git æ˜¯å¦å‘å‡ºè­¦å‘Šï¼Œé»˜è®¤ä¸º trueã€‚
* `:share_schemes_for_development_pods`ï¼šæ˜¯å¦ä¸ºå¼€å‘ä¸­çš„ pod åˆ†äº« schemesï¼Œé»˜è®¤ä¸º falseã€‚
* `:disable_input_output_paths`ï¼šæ˜¯å¦ç¦ç”¨ CocoaPods è„šæœ¬é˜¶æ®µçš„è¾“å…¥è¾“å‡ºè·¯å¾„ï¼ˆCopy Frameworks å’Œ Copy Resourcesï¼‰ï¼Œé»˜è®¤ä¸º falseã€‚
* `:preserve_pod_file_structure`ï¼šæ˜¯å¦ä¿ç•™æ‰€æœ‰ pod çš„æ–‡ä»¶ç»“æ„ï¼Œé»˜è®¤ä¸º falseã€‚
* `:generate_multiple_pod_projects`ï¼šæ˜¯å¦ä¸ºæ¯ä¸€ä¸ª pod target ç”Ÿæˆ ä¸€ä¸ª projectï¼Œç”Ÿæˆä¸ Pods/Pods æ–‡ä»¶å¤¹ä¸­ï¼Œé»˜è®¤ä¸º falseã€‚
* `:incremental_installation`ï¼šä»…å¯¹è‡ªä¸Šæ¬¡å®‰è£…çš„ target ä¸å…¶å…³è”çš„ project çš„å˜æ›´éƒ¨åˆ†è¿›è¡Œé‡æ–°ç”Ÿæˆï¼Œé»˜è®¤ä¸º falseã€‚
* `:skip_pods_project_generation`ï¼šæ˜¯å¦è·³è¿‡ç”Ÿæˆ Pods.xcodeproj å¹¶ä»…è¿›è¡Œä¾èµ–é¡¹è§£æä¸ä¸‹è½½ï¼Œé»˜è®¤ä¸º falseã€‚
`ensure_bundler!`ï¼šå½“ bundler ç‰ˆæœ¬ä¸åŒ¹é…æ—¶å‘å‡ºè­¦å‘Šã€‚

``` ruby
ensure_bundler! '~> 2.0.0'
```

#### Dependencies

`pod`ï¼šæŒ‡å®šé¡¹ç›®çš„ä¾èµ–é¡¹

* ä¾èµ–ç‰ˆæœ¬æ§åˆ¶ï¼š`=`ã€`>`ã€`>=`ã€`<`ã€`<=` ä¸ºå­—é¢æ„æ€ï¼›`~> 0.1.2` è¡¨ç¤º `0.1.2 <= currVersion < 0.2` ä¹‹é—´çš„ç¬¦åˆè¦æ±‚çš„æœ€æ–°ç‰ˆæœ¬ç‰ˆæœ¬ã€‚
* Build configurationsï¼šé»˜è®¤ä¾èµ–å®‰è£…åœ¨æ‰€æœ‰çš„æ„å»ºé…ç½®ä¸­ï¼Œä½†ä¹Ÿå¯ä»…åœ¨æŒ‡å®šæ„å»ºé…ç½®ä¸­å¯ç”¨ã€‚
* Modular Headersï¼šç”¨äºå°† pod è½¬æ¢ä¸º module ä»¥æ”¯æŒæ¨¡å—ï¼Œè¿™æ—¶åœ¨ Swift ä¸­å¯ä»¥ä¸ç”¨å€ŸåŠ© `bridging-header` æ¡¥æ¥å°±å¯ä»¥ç›´æ¥å¯¼å…¥ï¼Œç®€åŒ–äº† Swift å¼•ç”¨ Objective-C çš„æ–¹å¼ï¼›ä¹Ÿå¯ä»¥é‡‡ç”¨ `use_modular_headers!` è¿›è¡Œå…¨å±€çš„å˜æ›´ã€‚
* Sourceï¼šæŒ‡å®šå…·æœ‰ä¾èµ–é¡¹çš„æºï¼ŒåŒæ—¶ä¼šå¿½ç•¥å…¨å±€æºã€‚
* Subspecsï¼šé»˜è®¤ä¼šå®‰è£…æ‰€æœ‰çš„ subspecsï¼Œä½†å¯åˆ¶å®šå®‰è£…æŸäº› subspecsã€‚
* Test Specsï¼šé»˜è®¤ä¸ä¼šå®‰è£… test specsï¼Œä½†å¯é€‰æ‹©æ€§å®‰è£… test specsã€‚
* Local pathï¼šå°†å¼€å‘çš„ pod ä¸å…¶å®¢æˆ·ç«¯ä¸€èµ·ä½¿ç”¨ï¼Œå¯é‡‡ç”¨ pathã€‚
* æŒ‡å®šæŸä¸ªç‰¹æ®Šæˆ–è€…æ›´ä¸ºå…ˆè¿›çš„ pod ç‰ˆæœ¬

``` ruby 
# ä¾èµ–ç‰ˆæœ¬æ§åˆ¶
pod 'Objection', '~> 0.9'Â 
# Build configurations
pod 'PonyDebugger', :configurations => ['Debug', 'Beta']Â 
# Modular Headers
pod 'SSZipArchive', :modular_headers => trueÂ 
# Source
pod 'PonyDebugger', :source => 'https://github.com/CocoaPods/Specs.git'
# Subspecs
pod 'QueryKit', :subspecs => ['Attribute', 'QuerySet']Â 
# Test Specs
pod 'AFNetworking', :testspecs => ['UnitTests', 'SomeOtherTests']
# Local path
pod 'AFNetworking', :path => '~/Documents/AFNetworking'
# æŒ‡å®šæŸä¸ªç‰¹æ®Šæˆ–è€…æ›´ä¸ºå…ˆè¿›çš„ Pod ç‰ˆæœ¬
pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :branch => 'dev'
pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :tag => '0.7.0'
pod 'AFNetworking', :git => 'https://github.com/gowalla/AFNetworking.git', :commit => '082f8319af'
# æŒ‡å®šæŸä¸ª podspec
pod 'JSONKit', :podspec => 'https://example.com/JSONKit.podspec'

```

`inherit`ï¼šè®¾ç½®å½“å‰ target çš„ç»§æ‰¿æ¨¡å¼ã€‚

`:complete` ç»§æ‰¿çˆ¶çº§ target çš„æ‰€æœ‰è¡Œä¸ºï¼Œ`:none` ä¸ç»§æ‰¿çˆ¶çº§ target çš„ä»»ä½•è¡Œä¸ºï¼Œ`:search_paths` ä»…ç»§æ‰¿çˆ¶çº§çš„æœç´¢è·¯å¾„ã€‚

``` ruby
target 'App' do
  target 'AppTests' do
    inherit! :search_paths
  end
end
```

`target`ï¼šä¸ Xcode ä¸­çš„ target ç›¸å¯¹åº”ï¼Œblock ä¸­æ˜¯ target çš„ä¾èµ–é¡¹ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œtarget åŒ…å«åœ¨çˆ¶çº§ target å®šä¹‰çš„ä¾èµ–é¡¹ï¼Œä¹Ÿå³` inherit! `ä¸º `:complete`ã€‚å…³äº `:complete`å’Œ `:search_paths`ï¼Œ`:complete` ä¼šæ‹·è´çˆ¶çº§ target çš„ pod å‰¯æœ¬ï¼Œè€Œ `:search_paths` åˆ™åªè¿›è¡Œ `FRAMEWORK_SEARCH_PATHS` å’Œ `HEADER_SEARCH_PATHS` çš„ç›¸å…³æ‹·è´ï¼Œå…·ä½“å¯é€šè¿‡æ¯”å¯¹ Pods/Target Support Files çš„ç›¸å…³æ–‡ä»¶å¾—ä»¥éªŒè¯ï¼Œä¸€èˆ¬åœ¨ `UnitTests` ä¸­ä½¿ç”¨ï¼Œä»¥å‡å°‘å¤šä½™çš„ `install_framework` è¿‡ç¨‹ã€‚

``` ruby
target 'ShowsApp' do
Â  pod 'ShowsKit'
Â  # æ‹¥æœ‰ ShowsKit å’Œ ShowTVAuth çš„æ‹·è´
Â  target 'ShowsTV' do
Â  Â  pod 'ShowTVAuth'
Â  end
Â  # æ‹¥æœ‰ Specta å’Œ Expecta çš„æ‹·è´
Â  # å¹¶ä¸”èƒ½å¤Ÿé€šè¿‡ ShowsApp è¿›è¡Œè®¿é—® ShowsKit, ç›¸å½“äº ShowsApp æ˜¯ ShowsTests çš„å®¿ä¸»APP
Â  target 'ShowsTests' do
Â  Â  inherit! :search_paths
Â  Â  pod 'Specta'
Â  Â  pod 'Expecta'
Â  end
end

```

`abstract_target`ï¼šå®šä¹‰ `abstract_target`ï¼Œæ–¹ä¾¿ target è¿›è¡Œä¾èµ–ç»§æ‰¿ï¼Œåœ¨ CocoaPods 1.0 ç‰ˆæœ¬ä¹‹å‰ä¸º `link_with`ã€‚

``` ruby
abstract_target 'Networking' do
  pod 'AlamoFire'
  target 'Networking App 1'
  target 'Networking App 2'
end
```

`abstract`ï¼šè¡¨ç¤ºå½“å‰ target æ˜¯æŠ½è±¡çš„ï¼Œä¸ä¼šé“¾æ¥åˆ° Xcode çš„ target ä¸­ã€‚

`script_phase`ï¼šæ·»åŠ è„šæœ¬é˜¶æ®µ

åœ¨æ‰§è¡Œå®Œ `pod install` ä¹‹å CocoaPods ä¼šå°†è„šæœ¬æ·»åŠ åˆ°å¯¹åº”çš„ `target build phases`ã€‚

``` ruby
target 'App' do
script_phase {
:name => 'scriptName' # è„šæœ¬åç§°,
Â  Â  Â  Â  :script => 'echo "nihao"' # è„šæœ¬å†…å®¹,
Â  Â  Â  Â  :execution_position => :before_compile / :after_compile
Â  Â  Â  Â  :shell_path => '/usr/bin/ruby' # è„šæœ¬è·¯å¾„
Â  Â  Â  Â  :input_files => ['/input/filePath'], # è¾“å…¥æ–‡ä»¶
Â  Â  Â  Â  :output_files => ['/outpput/filePath'] # è¾“å‡ºæ–‡ä»¶
}
end

```

#### Target configuration

`platform`ï¼šæŒ‡å®šå…¶æ„å»ºå¹³å°ã€‚

é»˜è®¤å€¼ä¸º iOS 4.3ã€OSX 10.6ã€tvOS 9.0 å’Œ watchOS 2.0ã€‚CocoaPods 1.0 ä¹‹å‰çš„ç‰ˆæœ¬ä¸º xcodeproj

``` ruby
platform :ios, '4.0'

```

`project`ï¼šæŒ‡å®šåŒ…å« target çš„ Xcode projectã€‚è¿™ä¸€èˆ¬åœ¨ workspace å­˜åœ¨å¤šä¸ª xcode project ä¸­ä½¿ç”¨ï¼š

``` ruby 
# åœ¨ FastGPS Project ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåä¸º MyGPSApp çš„ target
target 'MyGPSApp' do
  project 'FastGPS'
  ...
end
```

`inhibit_all_warnings!`ï¼šç¦æ­¢æ‰€æœ‰è­¦å‘Šã€‚å¦‚æœé’ˆå¯¹å•ä¸ª Podï¼Œåˆ™å¯ä»¥é‡‡ç”¨ï¼š

``` ruby
pod 'SSZipArchive', :inhibit_warnings => true
pod 'SSZipArchive', :inhibit_warnings => true
```

`user_modular_headers!`ï¼šå°†æ‰€æœ‰ Pod æ¨¡å—åŒ–ã€‚å¦‚æœé’ˆå¯¹å•ä¸ª Podï¼Œåˆ™å¯ä»¥é‡‡ç”¨ï¼š

``` ruby
pod 'SSZipArchive', :modular_headers => true
pod 'SSZipArchive', :modular_headers => false

```

`user_frameworks!`ï¼šé‡‡ç”¨ framework è€Œä¸æ˜¯ .a æ–‡ä»¶çš„é™æ€åº“ã€‚ å¯ä»¥é€šè¿‡ `:linkage` æŒ‡å®šä½¿ç”¨é™æ€åº“è¿˜æ˜¯åŠ¨æ€åº“ï¼š

``` ruby
use_frameworksï¼:linkage => :dynamic / :static
```

`supports_swift_versions`ï¼šæŒ‡å®š target definition æ”¯æŒçš„ swift ç‰ˆæœ¬è¦æ±‚

``` ruby
supports_swift_versions '>= 3.0', '< 4.0'
```

#### Workspace

`workspace`ï¼šæŒ‡å®šåŒ…å«æ‰€æœ‰é¡¹ç›®çš„ Xcode workspaceã€‚

#### Sources

`sources`ï¼šPodfile ä»æŒ‡å®šçš„æºåˆ—è¡¨ä¸­è¿›è¡Œæ£€ç´¢ã€‚sources é»˜è®¤å­˜å‚¨åœ¨ ~/.cocoapods/repos ä¸­ï¼Œæ˜¯å…¨å±€çš„è€ŒéæŒ‰ target definition å­˜å‚¨ã€‚å½“æœ‰å¤šä¸ªç›¸åŒçš„ Pod æ—¶ï¼Œä¼˜å…ˆé‡‡ç”¨æ£€ç´¢åˆ°çš„ Pod çš„ç¬¬ä¸€ä¸ªæºï¼Œå› æ­¤å½“æŒ‡å®šå¦ä¸€ä¸ªæ¥æºæ—¶ï¼Œåˆ™éœ€æ˜¾ç¤ºæŒ‡å®š CocoaPods çš„æºã€‚

``` ruby
source 'https://github.com/artsy/Specs.git'
source 'https://github.com/CocoaPods/Specs.git'
```

#### Hooks

`plugin`ï¼šæŒ‡å®šåœ¨å®‰è£…æœŸé—´ä½¿ç”¨çš„æ’ä»¶ã€‚

``` ruby
plugin 'cocoapods-keys', :keyring => 'Eidolon'
plugin 'slather'
```

`pre_install`ï¼šåœ¨ä¸‹è½½åå’Œåœ¨å®‰è£… Pod å‰è¿›è¡Œæ›´æ”¹ã€‚

``` ruby
pre_install do |installer|
  # Do something fancy!
end
```

`pre_integrate`ï¼šåœ¨ project å†™å…¥ç£ç›˜å‰è¿›è¡Œæ›´æ”¹ã€‚

``` ruby
pre_integrate do |installer|
  # perform some changes on dependencies
end
```

`post_install`ï¼šå¯¹ç”Ÿæˆ project å†™å…¥ç£ç›˜å‰è¿›è¡Œæœ€åçš„ä¿®æ”¹ã€‚

``` ruby
post_install do |installer|
    installer.generated_projects.each do |project|
        project.targets.each do |target|
            target.build_configurations.each do |config|
                config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '11.0'
            end
        end
    end
end

```

`post_integrate`ï¼šåœ¨ project å†™å…¥ç£ç›˜åè¿›è¡Œæœ€åæ›´æ”¹ã€‚

``` ruby
post_integrate do |installer|
  # some change after project write to disk
end
```

## podspec è¯­æ³•è§„èŒƒ

podspec = pod Specificationï¼Œæ„ä¸º pod è§„èŒƒï¼Œå®ƒæ˜¯ä¸€ä¸ª Ruby æ–‡ä»¶ã€‚åŒ…å«äº† Pod çš„åº“ç‰ˆæœ¬è¯¦ç»†ä¿¡æ¯ï¼Œä¾‹å¦‚åº”ä»ä½•å¤„è·å–æºã€ä½¿ç”¨å“ªäº›æ–‡ä»¶ã€è¦åº”ç”¨æ„å»ºè®¾ç½®ç­‰ä¿¡æ¯ï¼›ä¹Ÿå¯ä»¥çœ‹ä½œè¯¥æ–‡ä»¶æ˜¯æ•´ä¸ªä»“åº“çš„ç´¢å¼•æ–‡ä»¶ï¼Œäº†è§£å®ƒå¯¹æˆ‘ä»¬çŸ¥é“ Pod åº“æ˜¯å¦‚ä½•ç»„ç»‡ã€è¿ä½œçš„æä¾›äº†å¾ˆå¤§å¸®åŠ©ã€‚podspec çš„ DSL æä¾›äº†æå¤§çš„çµæ´»æ€§ï¼Œæ–‡ä»¶å¯é€šè¿‡ `pod spec create` åˆ›å»ºã€‚

#### Root

| åç§° | 	ç”¨é€”    | å¿…éœ€  |
| :------| :------: | :------ |
| `name` | pod åç§°   | required |
| `version`  | pod ç‰ˆæœ¬ï¼Œéµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶   |  required  |
| `swift_version`  | æ”¯æŒçš„ Swift ç‰ˆæœ¬ |  |
| `cocoapods_version` | æ”¯æŒçš„ CocoaPods ç‰ˆæœ¬ | |
| `authors` | pod ç»´æŠ¤è€…çš„å§“åå’Œç”µå­é‚®ä»¶ï¼Œç”¨â€œ, â€è¿›è¡Œåˆ†å‰² |  required  |
| `license`  | pod çš„è®¸å¯è¯ | required  |
| `homepage` | pod ä¸»é¡µçš„ URL | required |
| `source` | æºåœ°å€ï¼Œå³æºæ–‡ä»¶çš„å­˜æ”¾åœ°å€ï¼Œæ”¯æŒå¤šç§å½¢å¼æº | required |
| `summary`  |  pod çš„ç®€çŸ­æè¿° | required  |
| `prepare_command`  | ä¸‹è½½ pod åæ‰§è¡Œçš„ bash è„šæœ¬ | |
| `static_framework` | æ˜¯å¦é‡‡ç”¨é™æ€ framework åˆ†å‘  | |
| `deprecated` | è¯¥åº“æ˜¯å¦å·²è¢«å¼ƒç”¨  | |
| `deprecated_in_favor_of` | è¯¥åº“åç§°å·²è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹    | |


``` ruby
Pod::Spec.new do |s|
Â  s.name Â  Â  Â  Â  Â  Â  = 'CustomPod'
Â  s.versionÂ  Â  Â  Â  Â  = '0.1.0'
Â  s.summaryÂ  Â  Â  Â  Â  = 'A short description of CustomPod.'
Â  s.swift_versions Â  = ['3.0', '4.0', '4.2']
Â  s.cocoapods_versionÂ  =Â  '>= 0.36'
Â  s.author Â  Â  Â  Â  Â  = { 'nihao' => 'XXXX@qq.com' }
Â  s.licenseÂ  Â  Â  Â  Â  = { :type => 'MIT', :file => 'LICENSE' }
Â  s.homepage Â  Â  Â  Â  = 'https://github.com/XXX/CustomPod'
# Supported Key
# :git=> :tag, :branch, :commit,:submodules
# :svn=> :folder, :tag,:revision
# :hg=>:revision
# :http=> :flatten, :type, :sha256, :sha1,:headers
Â  s.source Â  Â  Â  Â  Â  = { :git => 'https://github.com/XX/CustomPod.git', :tag => s.version.to_s }
Â  s.prepare_commandÂ  =Â  'ruby build_files.rb'
Â  s.static_framework = true
Â  s.deprecated Â  Â  Â  = true
Â  s.deprecated_in_favor_ofÂ  =Â  'NewMoreAwesomePod'
end

```

#### Platform

`platform`ï¼špod æ”¯æŒçš„å¹³å°ï¼Œç•™ç©ºæ„å‘³ç€ pod æ”¯æŒæ‰€æœ‰å¹³å°ã€‚å½“æ”¯æŒå¤šå¹³å°æ—¶åº”è¯¥ç”¨ `deployment_target` ä»£æ›¿ã€‚

``` ruby
spec.platform = :osx, '10.8'
```

`deployment_target`ï¼šå…è®¸æŒ‡å®šæ”¯æŒæ­¤ pod çš„å¤šä¸ªå¹³å°ï¼Œä¸ºæ¯ä¸ªå¹³å°æŒ‡å®šä¸åŒçš„éƒ¨ç½²ç›®æ ‡ã€‚

``` ruby
spec.ios.deployment_target = '6.0'
spec.osx.deployment_target = '10.8'
```

#### Build settings

`dependency`ï¼šåŸºäºå…¶ä»– pods æˆ–å­è§„èŒƒçš„ä¾èµ–

``` ruby
spec.dependency 'AFNetworking', '~> 1.0', :configurations => ['Debug']
```

`info_plist`ï¼šåŠ å…¥åˆ°ç”Ÿæˆçš„ Info.plist çš„é”®å€¼å¯¹ï¼Œä¼šå¯¹ CocoaPods ç”Ÿæˆçš„é»˜è®¤å€¼è¿›è¡Œè¦†ç›–ã€‚ä»…å¯¹ä½¿ç”¨ framework çš„æ¡†æ¶æœ‰å½±å“ï¼Œå¯¹é™æ€åº“æ— æ•ˆã€‚å¯¹äºåº”ç”¨è§„èŒƒï¼Œè¿™äº›å€¼å°†åˆå¹¶åˆ°åº”ç”¨ç¨‹åºä¸»æœºçš„ `Info.plist`ï¼›å¯¹äºæµ‹è¯•è§„èŒƒï¼Œè¿™äº›å€¼å°†åˆå¹¶åˆ°æµ‹è¯•åŒ…çš„ Info.plistã€‚

``` ruby
spec.info_plist = {
  'CFBundleIdentifier' => 'com.myorg.MyLib',
  'MY_VAR' => 'SOME_VALUE'
}
```

`requires_arc`ï¼šå…è®¸æŒ‡å®šå“ªäº› source_files é‡‡ç”¨ ARCï¼Œä¸ä½¿ç”¨ ARC çš„æ–‡ä»¶å°†å…·æœ‰ `-fno-objc-arc` ç¼–è¯‘å™¨æ ‡å¿—

``` ruby
spec.requires_arc = false
spec.requires_arc = 'Classes/Arc'
spec.requires_arc = ['Classes/*ARC.m', 'Classes/ARC.mm']
```

`frameworks`ï¼šä½¿ç”¨è€… target éœ€è¦é“¾æ¥çš„ç³»ç»Ÿæ¡†æ¶åˆ—è¡¨

``` ruby
spec.ios.framework = 'CFNetwork'
spec.frameworks = 'QuartzCore', 'CoreData'
```

`weak_frameworks`ï¼šä½¿ç”¨è€… target éœ€è¦å¼±é“¾æ¥çš„æ¡†æ¶åˆ—è¡¨

``` ruby
spec.weak_framework = 'Twitter'
spec.weak_frameworks = 'Twitter', 'SafariServices'
```

`libraries`ï¼šä½¿ç”¨è€… target éœ€è¦é“¾æ¥çš„ç³»ç»Ÿåº“åˆ—è¡¨

``` ruby
spec.ios.library = 'xml2'
spec.libraries = 'xml2', 'z'
```

`compiler_flags`ï¼šåº”ä¼ é€’ç»™ç¼–è¯‘å™¨çš„ flags

``` ruby
spec.compiler_flags = '-DOS_OBJECT_USE_OBJC=0', '-Wno-format'

```

`pod_target_xcconfig`ï¼šå°†æŒ‡å®š flag æ·»åŠ åˆ°æœ€ç»ˆ pod çš„ xcconfig æ–‡ä»¶

``` ruby
spec.pod_target_xcconfig = { 'OTHER_LDFLAGS' => '-lObjC' }
```

`user_target_xcconfig`ï¼šğŸ™… å°†æŒ‡å®š flag æ·»åŠ åˆ°æœ€ç»ˆèšåˆçš„ target çš„ xcconfigï¼Œä¸æ¨èä½¿ç”¨æ­¤å±æ€§ï¼Œå› ä¸ºä¼šæ±¡æŸ“ç”¨æˆ·çš„æ„å»ºè®¾ç½®ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†²çªã€‚

``` ruby
spec.user_target_xcconfig = { 'MY_SUBSPEC' => 'YES' }
```

`prefix_header_contents`ï¼šğŸ™… åœ¨ Pod ä¸­æ³¨å…¥çš„é¢„ç¼–è¯‘å†…å®¹ï¼Œä¸æ¨èä½¿ç”¨æ­¤å±æ€§ï¼Œå› ä¸ºå…¶ä¼šæ±¡æŸ“ç”¨æˆ·æˆ–è€…å…¶ä»–åº“çš„é¢„ç¼–è¯‘å¤´ã€‚

``` ruby
spec.prefix_header_contents = '#import <UIKit/UIKit.h>', '#import <Foundation/Foundation.h>'
```

`prefix_header_file`ï¼šé¢„ç¼–è¯‘å¤´æ–‡ä»¶ï¼Œfalse è¡¨ç¤ºä¸ç”Ÿæˆé»˜è®¤çš„ CocoaPods çš„ä¸ç¼–è¯‘å¤´æ–‡ä»¶ã€‚ğŸ™… ä¸æ¨èä½¿ç”¨è·¯å¾„å½¢å¼ï¼Œå› ä¸ºå…¶ä¼šæ±¡æŸ“ç”¨æˆ·æˆ–è€…å…¶ä»–åº“çš„é¢„ç¼–è¯‘å¤´ã€‚

``` ruby
spec.prefix_header_file = 'iphone/include/prefix.pch'
spec.prefix_header_file = false
```

`module_name`ï¼šç”Ÿæˆçš„ framrwork / clang module ä½¿ç”¨çš„åç§°ï¼Œè€Œéé»˜è®¤åç§°ã€‚

``` ruby
spec.module_name = 'Three20'

```

`header_dir`ï¼šå­˜å‚¨å¤´æ–‡ä»¶çš„ç›®å½•ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«ç ´åã€‚

``` ruby
spec.header_dir = 'Three20Core'
```

`header_mappings_dir`ï¼šç”¨äºä¿ç•™å¤´æ–‡ä»¶æ–‡ä»¶å¤¹çš„ç›®å½•ã€‚å¦‚æœªæä¾›ï¼Œå¤´æ–‡ä»¶å°†è¢«ç¢¾å¹³ã€‚

``` ruby
spec.header_mappings_dir = 'src/include'
```

`script_phases`ï¼šè¯¥å±æ€§å…è®¸å®šä¹‰è„šæœ¬åœ¨ pod ç¼–è¯‘æ—¶æ‰§è¡Œï¼Œå…¶ä½œä¸º `xcode build` å‘½ä»¤çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œè¿˜å¯ä»¥åˆ©ç”¨ç¼–è¯‘æœŸé—´æ‰€è®¾ç½®çš„ç¯å¢ƒå˜é‡ã€‚

``` ruby
spec.script_phases = [
Â  Â  { :name => 'Hello World', :script => 'echo "Hello World"' },
Â  Â  { :name => 'Hello Ruby World', :script => 'puts "Hello World"', :shell_path => '/usr/bin/ruby' },
Â  ]
```

#### File patterns

æ–‡ä»¶æ¨¡å¼æŒ‡å®šäº†åº“çš„æ‰€æœ‰æ–‡ä»¶ç®¡ç†æ–¹å¼ï¼Œå¦‚æºä»£ç ã€å¤´æ–‡ä»¶ã€frameworkã€libariesã€ä»¥åŠå„ç§èµ„æºã€‚å…¶æ–‡ä»¶æ¨¡å¼é€šé…ç¬¦å½¢å¼å¯å‚è€ƒ[é“¾æ¥](https://guides.cocoapods.org/syntax/podspec.html#group_file_patterns)

`source_files`ï¼šæŒ‡å®šæºæ–‡ä»¶

``` ruby
spec.source_files = 'Classes/**/*.{h,m}', 'More_Classes/**/*.{h,m}'
```

`public_header_files`ï¼šæŒ‡å®šå…¬å…±å¤´æ–‡ä»¶ï¼Œè¿™äº›å¤´æ–‡ä»¶ä¸æºæ–‡ä»¶åŒ¹é…ï¼Œå¹¶ç”Ÿæˆæ–‡æ¡£å‘ç”¨æˆ·æä¾›ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™å°† source_files ä¸­çš„æ‰€æœ‰å¤´æ–‡ä»¶éƒ½åŒ…å«ç”Ÿæˆã€‚

``` ruby
spec.public_header_files = 'Headers/Public/*.h'
```

`project_header_files`ï¼šæŒ‡å®šé¡¹ç›®å¤´æ–‡ä»¶ï¼Œä¸å…¬å…±å¤´æ–‡ä»¶ç›¸å¯¹åº”ï¼Œä»¥æ’é™¤ä¸åº”å‘ç”¨æˆ·é¡¹ç›®å…¬å¼€ä¸”ä¸åº”ç”¨äºç”Ÿæˆæ–‡æ¡£çš„æ ‡å¤´ï¼Œä¸”ä¸ä¼šå‡ºç°åœ¨æ„å»ºç›®å½•ä¸­ã€‚

``` ruby
spec.project_header_files = 'Headers/Project/*.h'

```

`private_header_files`ï¼šç§æœ‰å¤´æ–‡ä»¶ï¼Œä¸å…¬å…±å¤´æ–‡ä»¶å¯¹åº”ï¼Œä»¥æ’é™¤ä¸åº”å‘ç”¨æˆ·é¡¹ç›®å…¬å¼€ä¸”ä¸åº”ç”¨äºç”Ÿæˆæ–‡æ¡£çš„æ ‡å¤´ï¼Œè¿™äº›å¤´æ–‡ä»¶ä¼šå‡ºç°åœ¨äº§ç‰©ä¸­çš„ PrivateHeader æ–‡ä»¶å¤¹ä¸­ã€‚

``` ruby
spec.private_header_files = 'Headers/Private/*.h'
```

`vendered_frameworks`ï¼špod é™„åŠ çš„ framework è·¯å¾„

``` ruby
spec.ios.vendored_frameworks = 'Frameworks/MyFramework.framework'
spec.vendored_frameworks = 'MyFramework.framework', 'TheirFramework.xcframework'
```

`vendered_libraries`ï¼špod é™„åŠ çš„ libraries è·¯å¾„

``` ruby
spec.ios.vendored_library = 'Libraries/libProj4.a'
spec.vendored_libraries = 'libProj4.a', 'libJavaScriptCore.a'
```

`on_demand_resources`ï¼šæ ¹æ® [Introducing On demand Resources](https://developer.apple.com/videos/play/wwdc2015/214/)æŒ‰éœ€åŠ è½½èµ„æºï¼Œä¸æ¨èä¸ä¸»å·¥ç¨‹å…±äº«æ ‡ç­¾ï¼Œé»˜è®¤ç±»åˆ«ä¸º `category => :download_on_demand`

``` ruby
s.on_demand_resources = {
Â  'Tag1' => { :paths => ['file1.png', 'file2.png'], :category => :download_on_demand }
}
s.on_demand_resources = {
Â  'Tag1' => { :paths => ['file1.png', 'file2.png'], :category => :initial_install }
}

```

`resources`ï¼šä¸º pod æ„å»ºçš„ bundle çš„åç§°å’Œèµ„æºæ–‡ä»¶ï¼Œå…¶ä¸­ key ä¸º bundle åç§°ï¼Œå€¼ä»£è¡¨å®ƒä»¬åº”ç”¨çš„æ–‡ä»¶æ¨¡å¼ã€‚

``` ruby
spec.resource_bundles = {
'MapBox' => ['MapView/Map/Resources/*.png'],
Â  Â  'MapBoxOtherResources' => ['MapView/Map/OtherResources/*.png']
}
```

`exclude_files`ï¼šæ’é™¤çš„æ–‡ä»¶æ¨¡å¼åˆ—è¡¨

``` ruby
spec.ios.exclude_files = 'Classes/osx'
spec.exclude_files = 'Classes/**/unused.{h,m}'
```

`preserve_paths`ï¼šä¸‹è½½åä¸åº”åˆ é™¤çš„æ–‡ä»¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCocoaPods ä¼šåˆ é™¤ä¸å…¶ä»–æ–‡ä»¶æ¨¡å¼ä¸åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶

``` ruby
spec.preserve_path = 'IMPORTANT.txt'
spec.preserve_paths = 'Frameworks/*.framework'
```

`module_map`ï¼špod ç»§æ‰¿ä¸º framework æ—¶ä½¿ç”¨çš„æ¨¡å—æ˜ å°„æ–‡ä»¶ï¼Œé»˜è®¤ä¸º trueï¼ŒCocoaPods æ ¹æ® å…¬å…±å¤´æ–‡ä»¶åˆ›å»º module_map æ–‡ä»¶ã€‚

``` ruby
spec.module_map = 'source/module.modulemap'
spec.module_map = false
```


#### Subspecs

`subspec`ï¼šå­æ¨¡å—çš„è§„èŒƒï¼›å®è¡ŒåŒé‡ç»§æ‰¿ï¼šspecs è‡ªåŠ¨ç»§æ‰¿æ‰€æœ‰ subspec ä½œä¸ºä¾èµ–é¡¹(é™¤éæŒ‡å®šé»˜è®¤ spec)ï¼›subspec ç»§æ‰¿äº†çˆ¶çº§çš„å±æ€§ï¼›

``` ruby
# é‡‡ç”¨ä¸åŒæºæ–‡ä»¶çš„ Specs, CocoaPods è‡ªåŠ¨å¤„ç†é‡å¤å¼•ç”¨é—®é¢˜
subspec 'Twitter' do |sp|
Â  sp.source_files = 'Classes/Twitter'
end

subspec 'Pinboard' do |sp|
Â  sp.source_files = 'Classes/Pinboard'
end

# å¼•ç”¨å…¶ä»–å­è§„èŒƒ
s.subspec "Core" do |ss|
Â  Â  ss.source_filesÂ  = "Sources/Moya/", "Sources/Moya/Plugins/"
Â  Â  ss.dependency "Alamofire", "~> 5.0"
Â  Â  ss.frameworkÂ  = "Foundation"
Â  end
Â  s.subspec "ReactiveSwift" do |ss|
Â  Â  ss.source_files = "Sources/ReactiveMoya/"
Â  Â  ss.dependency "Moya/Core"
Â  Â  ss.dependency "ReactiveSwift", "~> 6.0"
Â  end
Â  s.subspec "RxSwift" do |ss|
Â  Â  ss.source_files = "Sources/RxMoya/"
Â  Â  ss.dependency "Moya/Core"
Â  Â  ss.dependency "RxSwift", "~> 5.0"
Â  end
end

# åµŒå¥—å­è§„èŒƒ
Pod::Spec.new do |s|
Â  s.name = 'Root'
Â  s.subspec 'Level_1' do |sp|
Â  Â  sp.subspec 'Level_2' do |ssp|
Â  Â  end
Â  end
end
```

`default_subspecs`ï¼šé»˜è®¤å­è§„èŒƒæ•°ç»„åç§°ï¼Œä¸æŒ‡å®šå°†å…¨éƒ¨å­è§„èŒƒä½œä¸ºé»˜è®¤å­è§„èŒƒï¼Œ`:none` è¡¨ç¤ºä¸éœ€è¦ä»»ä½•å­è§„èŒƒã€‚

``` ruby
spec.default_subspec = 'Core'
spec.default_subspecs = 'Core', 'UI'
spec.default_subspecs = :none
```

`scheme`ï¼šç”¨ä»¥ç»™æŒ‡å®š scheme configuration æ·»åŠ æ‹“å±•

``` ruby
spec.scheme = { :launch_arguments => ['Arg1'] }
spec.scheme = { :launch_arguments => ['Arg1', 'Arg2'], :environment_variables => { 'Key1' => 'Val1'} }
```

`test_spec`ï¼šæµ‹è¯•è§„èŒƒï¼Œåœ¨ 1.8 ç‰ˆæœ¬æ”¯æŒã€‚å¯å‚è€ƒï¼š[CocoaPods 1.8 Beta](https://blog.cocoapods.org/CocoaPods-1.8.0-beta/)   
`requires_app_host`ï¼šæ˜¯å¦éœ€è¦å®¿ä¸» APP è¿è¡Œæµ‹è¯•ï¼Œä»…é€‚ç”¨äºæµ‹è¯•è§„èŒƒã€‚  
`app_host_name`ï¼šå¿…è¦æ—¶ä½œç”¨äºåº”ç”¨ç¨‹åºçš„åº”ç”¨ç¨‹åºè§„èŒƒåç§°  
`app_spec`ï¼šå®¿ä¸» APP è§„èŒƒ  

``` ruby
Pod::Spec.new do |s|
Â  s.name Â  Â  Â  Â  = 'CannonPodder'
Â  s.versionÂ  Â  Â  = '1.0.0'
Â  # ...rest of attributes here
Â  s.app_spec 'DemoApp' do |app_spec|
Â  Â  app_spec.source_files = 'DemoApp/**/*.swift'
Â  Â  # Dependency used only by this app spec.
Â  Â  app_spec.dependency 'Alamofire'
Â  end
Â  s.test_spec 'Tests' do |test_spec|
Â  Â  test_spec.requires_app_host = true
Â  Â  # Use 'DemoApp' as the app host.
Â  Â  test_spec.app_host_name = 'CannonPodder/DemoApp'
Â  Â  # ...rest of attributes here
Â  Â  # This is required since 'DemoApp' is specified as the app host.
Â  Â  test_spec.dependency 'CannonPodder/DemoApp'
Â  end
end
```

#### Multi-Platform support

å­˜å‚¨ç‰¹å®šäºæŸä¸€ä¸ªå¹³å°çš„å€¼ï¼Œåˆ†åˆ«ä¸º iosã€osxã€macOSã€tvosã€watchosï¼š

``` ruby
spec.resources = 'Resources/**/*.png'
spec.ios.resources = 'Resources_ios/**/*.png'
```

## Pod çš„å¼€å‘æµç¨‹

äº†è§£å®Œ Podfile å’Œ podspec çš„ç›¸å…³çš„è§„èŒƒä¹‹åï¼Œé‚£ä¹ˆå¼€å‘è‡ªå·±çš„ pod åº”è¯¥æ˜¯ä¸€ä»¶é©¾è½»å°±ç†Ÿçš„äº‹ã€‚


#### Spec Repo

Spec Repo æ˜¯ podspec çš„ä»“åº“ï¼Œå³æ˜¯å­˜å‚¨ç›¸å…³çš„ podspec æ–‡ä»¶çš„åœ°æ–¹ã€‚æœ¬åœ°æºå­˜å‚¨äº ~/.cocoapods/reposä¸­ï¼Œå®ƒä» git ä¸Šæ‹‰å–å¹¶å®Œå…¨ä¿ç•™ç›®å½•ç»“æ„ã€‚å¯ä»¥å‘ç°ï¼Œ Master Specs Repo çš„ç°åœ¨ç›®å½•ç»“æ„æœ‰äº›ç‰¹æ®Šï¼›ä»¥å¾€ç‰ˆæœ¬çš„ Master Spec Repo æ˜¯å®Œå…¨åœ¨åŒä¸€ç›®å½•ä¸‹çš„ï¼Œä½†è‹¥å¤§é‡æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸­ä¼šå¯¼è‡´äº† [Github ä¸‹è½½æ…¢](https://github.com/CocoaPods/CocoaPods/issues/4989#issuecomment-193772935) çš„é—®é¢˜ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‡‡ç”¨æ•£åˆ—è¡¨å½¢å¼å¤„ç†ã€‚å…·ä½“æ–¹å¼ä¸ºå¯¹åç§°è¿›è¡Œ MD5 è®¡ç®—å¾—åˆ°æ•£åˆ—å€¼ï¼Œå–å‰ä¸‰ä½ä½œä¸ºç›®å½•å‰ç¼€ï¼Œä»¥å¯¹æ–‡ä»¶åˆ†æ•£åŒ–ã€‚åˆæ¬¡ä¹‹å¤–ï¼ŒCocoaPods åç»­è¿˜é‡‡ç”¨ CDN ä»¥åŠ trunk è¿›ä¸€æ­¥åŠ å¿«ä¸‹è½½é€Ÿåº¦ï¼Œæœ‰å…´è¶£å¯ä»¥å‚è€ƒ [CocoaPods Source ç®¡ç†æœºåˆ¶](http://chuquan.me/2022/01/07/source-analyze-principle/)ã€‚


å¦‚ï¼š`md5("CJFoundation") => 044d913fdd5a52b303222c357521f744`ï¼›`CJFoundation` åˆ™åœ¨ /Specs/0/4/4 ç›®å½•ä¸­

![](/assets/images/20230426CocoaPodsUserGuide/1.webp)

#### Create

åªéœ€åˆ©ç”¨Â  `pod lib create [PodName] ` å‘½ä»¤ä¾¿å¯ä»¥å¿«é€Ÿåˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ pod ã€‚å¡«å†™å¥½ä½¿ç”¨å¹³å°ã€ä½¿ç”¨è¯­è¨€ã€æ˜¯å¦åŒ…å« Demoã€æµ‹è¯•æ¡†æ¶ç­‰ä¿¡æ¯ï¼ŒCocoaPods ä¼šä»é»˜è®¤çš„ Git åœ°å€ä¸­æ‹‰å–ä¸€ä»½ pod æ¨¡ç‰ˆï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ `--template-url=URL` æŒ‡å®šæ¨¡ç‰ˆåœ°å€ã€‚åœ¨æ‰§è¡Œå®Œåï¼Œæ•´ä¸ªæ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼š

``` swift
tree CustomPod -L 2
CustomPod
â”œâ”€â”€ CustomPod
â”‚ Â  â”œâ”€â”€ Assets // å­˜æ”¾èµ„æºæ–‡ä»¶
â”‚ Â  â””â”€â”€ Classes
â”‚ Â  Â  Â  â””â”€â”€ RemoveMe.[swift/m] // å•ä¸€æ–‡ä»¶ä»¥ç¡®ä¿æœ€åˆç¼–è¯‘å·¥ä½œ
â”œâ”€â”€ CustomPod.podspec // Pod çš„ spec æ–‡ä»¶, æ˜¯ä¸€ä¸ª Pod ä¾èµ–çš„ç´¢å¼•ä»¥åŠè§„èŒƒä¿¡æ¯
â”œâ”€â”€ Example // ç”¨ä½œæ¼”ç¤º/æµ‹è¯•çš„ç¤ºä¾‹é¡¹ç›®
â”‚ Â  â”œâ”€â”€ CustomPod
â”‚ Â  â”œâ”€â”€ CustomPod.xcodeproj
â”‚ Â  â”œâ”€â”€ CustomPod.xcworkspace
â”‚ Â  â”œâ”€â”€ Podfile
â”‚ Â  â”œâ”€â”€ Podfile.lock
â”‚ Â  â”œâ”€â”€ Pods
â”‚ Â  â””â”€â”€ Tests
â”œâ”€â”€ _Pods.xcodeproj -> Example/Pods/Pods.xcodeproj // æŒ‡å‘ Pods é¡¹ç›®çš„ä»¥è·å¾— Carthage æ”¯æŒ
â”œâ”€â”€ LICENSE // è®¸å¯è¯
â””â”€â”€ README.mdÂ  // è‡ªè¿°æ–‡ä»¶
```

#### Development

å°†æºæ–‡ä»¶å’Œèµ„æºåˆ†åˆ«æ”¾å…¥ Classes / Assets æ–‡ä»¶å¤¹ä¸­ï¼Œæˆ–è€…æŒ‰ä½ å–œæ¬¢çš„æ–¹å¼ç»„ç»‡æ–‡ä»¶ï¼Œå¹¶åœ¨ podspec æ–‡ä»¶ä¸­ç¼–è¾‘ç›¸åº”é¡¹ã€‚å¦‚æœä½ æœ‰ä»»ä½•æƒ³ä½¿ç”¨çš„é…ç½®é¡¹ï¼Œå¯å‚è€ƒå‰é¢çš„podsepc è¯­æ³•è§„èŒƒ ã€‚
ä¸€èˆ¬æ¥è¯´ï¼Œå¼€å‘ Pod ä¸€èˆ¬éƒ½æ˜¯ä½œä¸ºæœ¬åœ° Pod è¢«å…¶ä»– Project æ‰€ä¾èµ–è¿›è¡Œå¼€å‘ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ example æ–‡ä»¶å¤¹çš„ project æˆ–è€…å…¶ä»–çš„ Projectã€‚

`pod 'Name', :path => '~/CustomPod/'`

#### Testing

é€šè¿‡ `pod lib lint `ä»¥éªŒè¯ Pod ä»“åº“çš„ä½¿ç”¨æ˜¯å¦æ­£å¸¸ã€‚

#### Release

å‰é¢æåˆ°è¿‡ podspec å¯ä»¥çœ‹ä½œæ˜¯æ•´ä¸ªä»“åº“çš„ç´¢å¼•æ–‡ä»¶ï¼Œæœ‰äº†è¿™ä¸ªæ–‡ä»¶ä¹Ÿå°±èƒ½ç»„ç»‡èµ·ä¸€ä¸ª Podã€‚å› æ­¤å®˜æ–¹çš„æºä»¥åŠç§æœ‰æºéƒ½åªéœ€è¦ podspec å³å¯ï¼Œè€Œå…¶ä»–æ–‡ä»¶åˆ™åº”æ¨é€åˆ° podspec ä¸­ source ä¸­æŒ‡å®šä»“åº“ï¼Œè¿™ä¸ªä»“åº“åº”è¯¥æ˜¯ä½ è‡ªåˆ›å»ºçš„ã€‚
åœ¨å‡†å¤‡å‘å¸ƒæ¨é€æºä»£ç æ—¶ï¼Œéœ€è¦æ›´æ–°ç‰ˆæœ¬å·ä»¥åŠåœ¨ git ä¸Šæ‰“ä¸Š tagï¼Œè¿™æ˜¯ä¸ºäº†è¿›è¡Œç‰ˆæœ¬å·åŒ¹é…ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹çš„ podspec æ–‡ä»¶ä¸­ï¼š

``` ruby
s.source = { :git => 'https://github.com/XXX/CustomPod.git', :tag => s.version.to_s }
```

å¯èƒ½ä½ çš„å·¥ä½œæµæ“ä½œå¦‚ä¸‹ï¼š

``` sh
$ cd ~/code/Pods/NAME
$ edit NAME.podspec
# set the new version to 0.0.1
# set the new tag to 0.0.1
$ pod lib lint
$ git add -A && git commit -m "Release 0.0.1."
$ git tag '0.0.1'
$ git push --tags
```

å­˜æœ‰å‡ ç§æ–¹å¼æ¨é€ podspec æ–‡ä»¶ï¼š

* 1.æ¨é€åˆ°[å…¬å…±ä»“åº“](https://github.com/CocoaPods/Specs)ï¼Œéœ€è¦ç”¨åˆ°çš„ trunk å­å‘½ä»¤ï¼Œæ›´å¤šå¯ä»¥å‚è€ƒ [Getting setup with Trunk](https://guides.cocoapods.org/making/getting-setup-with-trunk)ï¼š

``` sh
# é€šè¿‡ç”µå­é‚®ç®±è¿›è¡Œæ³¨å†Œ
pod trunk register orta@cocoapods.org 'Orta Therox' --description='macbook air'Â 
# å°†æŒ‡å®špodspecæ–‡ä»¶æ¨é€åˆ°å…¬å…±ä»“åº“ä¸­
pod trunk push [NAME.podspec]Â 
# æ·»åŠ å…¶ä»–äººä½œä¸ºåä½œè€…
pod trunk add-owner ARAnalytics kyle@cocoapods.orgÂ 
```

* 2.æ¨é€åˆ°ç§æœ‰æºï¼Œä¾‹å¦‚ [Artsy/Specs](https://github.com/artsy/Specs)ï¼Œéœ€è¦ç”¨åˆ° repo å­å‘½ä»¤ï¼Œæ›´å¤šå¯ä»¥å‚è€ƒ [Private Pods](https://guides.cocoapods.org/making/private-cocoapods)ï¼š

``` sh
# å°†ç§æœ‰æºåœ°å€æ·»åŠ åˆ°æœ¬åœ°
pod repo add REPO_NAME SOURCE_URLÂ 
# æ£€æŸ¥ç§æœ‰æºæ˜¯å¦å®‰è£…æˆåŠŸå¹¶å‡†å¤‡å°±ç»ª
cd ~/.cocoapods/repos/REPO_NAME
pod repo lint .
# å°†Podçš„podspecæ·»åŠ åˆ°æŒ‡å®šREPO_NAMEä¸­
pod repo push REPO_NAME SPEC_NAME.podspec
```

* 3.ä¸æ¨é€åˆ°ä»»ä½•æºä¸­ï¼Œè‹¥èƒ½å­˜åœ¨ä»¥ URL æ–¹å¼æ£€ç´¢åˆ° podspecæ–‡ä»¶ï¼Œåˆ™å¯ç”¨è¯¥ URLï¼Œä¸€èˆ¬é‡‡ç”¨ä»“åº“åœ°å€ï¼Œä¾‹å¦‚ï¼š

``` ruby
pod 'AFNetworking', :git => 'https://github.com/XXX/CustomPod.git'
```

#### Semantic Versioning

è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶é¡¾åæ€ä¹‰æ˜¯ä¸€ç§è¯­ä¹‰ä¸Šçš„ç‰ˆæœ¬æ§åˆ¶ï¼Œå®ƒä¸è¦æ±‚å¼ºåˆ¶éµå¾ªï¼Œåªæ˜¯å¸Œæœ›å¼€å‘è€…èƒ½å¤Ÿå°½é‡éµå®ˆã€‚å¦‚æœåº“ä¹‹é—´ä¾èµ–å…³ç³»è¿‡é«˜ï¼Œå¯èƒ½é¢ä¸´ç‰ˆæœ¬æ§åˆ¶è¢«é”æ­»çš„é£é™©ï¼ˆå¯èƒ½éœ€è¦å¯¹æ¯ä¸€ä¸ªä¾èµ–åº“æ”¹ç‰ˆæ‰èƒ½å®ŒæˆæŸæ¬¡å‡çº§ï¼‰ï¼›å¦‚æœåº“ä¹‹é—´ä¾èµ–å…³ç³»è¿‡äºæ¾æ•£ï¼Œåˆå°†æ— æ³•é¿å…ç‰ˆæœ¬çš„æ··ä¹±ï¼ˆå¯èƒ½åº“å…¼å®¹æ€§ä¸å†èƒ½æ”¯æŒä»¥å¾€ç‰ˆæœ¬ï¼‰ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶æ­£æ˜¯ä½œä¸ºè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚æ— è®ºåœ¨ CocoaPods ä¸­ï¼Œè¿˜æ˜¯ Swift Packager Manager ä¸Šï¼Œå®˜æ–¹éƒ½å¸Œæœ›åº“å¼€å‘è€…çš„çš„ç‰ˆæœ¬å·èƒ½éµå¾ªè¿™ä¸€åŸåˆ™ï¼š

ä¾‹å¦‚ï¼Œç»™å®šç‰ˆæœ¬å· `MAJOR.MINOR.PATCH`ï¼š

* 1.`MAJOR`ï¼šè¿›è¡Œä¸å…¼å®¹çš„ API æ›´æ”¹æ—¶è¿›è¡Œä¿®æ”¹
* 2.`MINOR`ï¼šå‘åå…¼å®¹çš„æ–¹å¼æ·»åŠ æ–°åŠŸèƒ½æ—¶è¿›è¡Œä¿®æ”¹
* 3.`PATCH`ï¼šè¿›è¡Œå‘åå…¼å®¹çš„é”™è¯¯ä¿®å¤æ—¶è¿›è¡Œä¿®æ”¹

å…ˆè¡Œç‰ˆæœ¬å·ä»¥åŠç‰ˆæœ¬ç¼–è¯‘ä¿¡æ¯å¯ä»¥æ·»åŠ åˆ° `MAJOR.MINOR.PATCH` åé¢ä»¥ä½œä¸ºå»¶ä¼¸ã€‚

## CocoaPods åŸç†æµ…æ

#### CococaPods æ ¸å¿ƒç»„ä»¶

CocoaPods è¢« Ruby ç®¡ç†ï¼Œå…¶æ ¸å¿ƒéƒ¨åˆ†ä¹Ÿè¢«åˆ†ä¸ºä¸€ä¸ªä¸€ä¸ªç»„ä»¶ã€‚ä¸‹è½½æºç ï¼Œå¯ä»¥çœ‹åˆ° Gemfile æ–‡ä»¶å¦‚ä¸‹ï¼Œå…¶ä¾èµ–äº†è‹¥å¹²ä¸ª `gem`ï¼Œæœ‰æ„æ€çš„æ˜¯ `cp_gem` å‡½æ•°ï¼Œé€šè¿‡ `SKIP_UNRELEASED_VERSIONS` ä¸ `path`æ¥æ§åˆ¶æ˜¯å¦é‡‡ç”¨æœ¬åœ°çš„ gem è·¯å¾„ï¼Œå®ç°äº† DEVELOPMENT ä¸ RELEASE ç¯å¢ƒçš„åˆ‡æ¢ã€‚

``` ruby
SKIP_UNRELEASED_VERSIONS = false
# Declares a dependency to the git repo of CocoaPods gem. This declaration is
# compatible with the local git repos feature of Bundler.
def cp_gem(name, repo_name, branch = 'master', path: false)
Â  return gem name if SKIP_UNRELEASED_VERSIONS
Â  opts = if path
Â Â  Â  Â  Â  Â  { :path => "../#{repo_name}" }
Â Â  Â  Â  Â  else
Â Â  Â  Â  Â  Â  url = "https://github.com/CocoaPods/#{repo_name}.git"
Â Â  Â  Â  Â  Â  { :git => url, :branch => branch }
Â Â  Â  Â  Â  end
Â  gem name, opts
end

source 'https://rubygems.org'

gemspec

group :development do
Â  cp_gem 'claide',Â  Â  Â  Â  Â  Â  Â  Â  'CLAide'
Â  cp_gem 'cocoapods-core',Â  Â  Â  Â  'Core'
Â  cp_gem 'cocoapods-deintegrate', 'cocoapods-deintegrate'
Â  cp_gem 'cocoapods-downloader',Â  'cocoapods-downloader'
Â  cp_gem 'cocoapods-plugins', Â  Â  'cocoapods-plugins'
Â  cp_gem 'cocoapods-search',Â  Â  Â  'cocoapods-search'
Â  cp_gem 'cocoapods-trunk', Â  Â  Â  'cocoapods-trunk'
Â  cp_gem 'cocoapods-try', Â  Â  Â  Â  'cocoapods-try'
Â  cp_gem 'molinillo', Â  Â  Â  Â  Â  Â  'Molinillo'
Â  cp_gem 'nanaimo', Â  Â  Â  Â  Â  Â  Â  'Nanaimo'
Â  cp_gem 'xcodeproj', Â  Â  Â  Â  Â  Â  'Xcodeproj'
Â  gem 'cocoapods-dependencies', '~> 1.0.beta.1'
Â  ...
end
```

è¿™äº›ç»„ä»¶ç›¸å¯¹ç‹¬ç«‹ï¼Œè¢«åˆ†æˆä¸€ä¸ªä¸€ä¸ª Gem åŒ…ï¼Œåœ¨ [Core Components](https://guides.cocoapods.org/contributing/components.html) ä¸­ï¼Œå¯ä»¥æ‰¾åˆ°å¯¹è¿™äº›ç»„ä»¶çš„ç®€è¦æè¿°ã€‚åŒæ—¶ä¹Ÿå¯ä»¥åˆ° CocoaPods çš„ Github ä¸­å»çœ‹è¯¦ç»†æ–‡æ¡£ã€‚

![](/assets/images/20230426CocoaPodsUserGuide/2.webp)

* `CocoaPods`ï¼šå‘½ä»¤è¡Œæ”¯æŒä¸å®‰è£…ç¨‹åºï¼Œä¹Ÿä¼šå¤„ç† CocoaPods çš„æ‰€æœ‰ç”¨æˆ·äº¤äº’ã€‚
* `cocoapods-core`ï¼šå¯¹æ¨¡ç‰ˆæ–‡ä»¶çš„è§£æï¼Œå¦‚ Podfileã€.podspec ç­‰æ–‡ä»¶ã€‚
* `CLAide`ï¼šä¸€ä¸ªç®€å•çš„å‘½ä»¤è§£æå™¨ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¿«é€Ÿåˆ›å»ºåŠŸèƒ½é½å…¨çš„å‘½ä»¤è¡Œç•Œé¢çš„ APIã€‚
* `cocoapods-downloader`ï¼šç”¨äºä¸‹è½½æºç ï¼Œä¸ºå„ç§ç±»å‹çš„æºä»£ç æ§åˆ¶å™¨(HTTP/SVN/Git/Mercurial) æä¾›ä¸‹è½½å™¨ã€‚å®ƒæä¾› tagsã€commitesã€revisionsã€branches ä»¥åŠ zips æ–‡ä»¶çš„ä¸‹è½½ä¸è§£å‹ç¼©æ“ä½œã€‚
* `Monlinillo`ï¼šCocoaPodsï¼šå¯¹äºä¾èµ–ä»²è£ç®—æ³•çš„å°è£…ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…·æœ‰å‰é¡¹æ£€å¯Ÿçš„å›æº¯ç®—æ³•ã€‚ä¸ä»…åœ¨ pods ä¸­ï¼ŒBundler å’Œ RubyGems ä¹Ÿæ˜¯ä½¿ç”¨è¿™ä¸€å¥—ä»²è£ç®—æ³•ã€‚
* `Xcodeproj`ï¼šé€šè¿‡ Ruby æ¥å¯¹ Xcode projects è¿›è¡Œåˆ›å»ºäºä¿®æ”¹ã€‚å¦‚ï¼šè„šæœ¬ç®¡ç†ã€libraries æ„å»ºã€Xcode workspece å’Œé…ç½®æ–‡ä»¶çš„ç®¡ç†ã€‚
* `cocoapods-plugins`ï¼šæ’ä»¶ç®¡ç†ï¼Œå…¶ä¸­æœ‰ pod plugins å‘½ä»¤å¸®åŠ©ä½ è·å–çš„å¯ç”¨æ’ä»¶åˆ—è¡¨ä»¥åŠå¼€å‘ä¸€ä¸ªæ–°æ’ä»¶ç­‰åŠŸèƒ½ï¼Œå…·ä½“å¯ç”¨ pod plugins --help äº†è§£ã€‚

#### pod install åšäº†ä»€ä¹ˆ

æ‰§è¡Œ `pod install --verbose`ï¼Œä¼šæ˜¾ç¤º pod install è¿‡ç¨‹ä¸­çš„æ›´å¤š debugging ä¿¡æ¯ã€‚ä¸‹æ–‡ä¸»è¦å‚è€ƒ[æ•´ä½“æŠŠæ¡ CocoaPods æ ¸å¿ƒç»„ä»¶
](https://www.desgard.com/2020/08/17/cocoapods-story-2.html)

ç»è¿‡æ¶ˆæ¯è½¬å‘ä¸ CLAide å‘½ä»¤è§£æï¼Œæœ€ç»ˆè°ƒç”¨äº† CocoaPods/lib/cocoapods/installer.rb çš„ install! å‡½æ•°ï¼Œä¸»è¦æµç¨‹å›¾å¦‚ä¸‹ï¼š

![](/assets/images/20230426CocoaPodsUserGuide/3.webp)

``` ruby
def install!
prepare
resolve_dependencies
download_dependencies
validate_targets
clean_sandbox
if installation_options.skip_pods_project_generation?
show_skip_pods_project_generation_message
run_podfile_post_install_hooks
else
integrate
end
write_lockfiles
perform_post_install_actions
end
```

#### 1. Install ç¯å¢ƒå‡†å¤‡ï¼ˆprepareï¼‰

``` ruby
def prepare
Â  # å¦‚æœæ£€æµ‹å‡ºå½“å‰ç›®å½•æ˜¯ Podsï¼Œç›´æ¥ raise ç»ˆæ­¢
Â  if Dir.pwd.start_with?(sandbox.root.to_path)
Â  Â  message = 'Command should be run from a directory outside Pods directory.'
Â  Â  message << "\n\n\tCurrent directory is #{UI.path(Pathname.pwd)}\n"
Â  Â  raise Informative, message
Â  end
Â  UI.message 'Preparing' do
Â  Â  # å¦‚æœ lock æ–‡ä»¶çš„ CocoaPods ä¸»ç‰ˆæœ¬å’Œå½“å‰ç‰ˆæœ¬ä¸åŒï¼Œå°†ä»¥æ–°ç‰ˆæœ¬çš„é…ç½®å¯¹ xcodeproj å·¥ç¨‹æ–‡ä»¶è¿›è¡Œæ›´æ–°
Â  Â  deintegrate_if_different_major_version
Â  Â  # å¯¹ sandbox(Pods) ç›®å½•å»ºç«‹å­ç›®å½•ç»“æ„
Â  Â  sandbox.prepare
Â  Â  # æ£€æµ‹ PluginManager æ˜¯å¦æœ‰ pre-install çš„ plugin
Â  Â  ensure_plugins_are_installed!
Â  Â  # æ‰§è¡Œæ’ä»¶ä¸­ pre-install çš„æ‰€æœ‰ hooks æ–¹æ³•
Â  Â  run_plugins_pre_install_hooks
Â  end
end
```

åœ¨ prepare é˜¶æ®µä¼šå®Œæˆ `pod install` çš„ç¯å¢ƒå‡†å¤‡ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ã€ç‰ˆæœ¬ä¸€è‡´æ€§ä»¥åŠ `pre_install` çš„ hookã€‚


#### 2. è§£å†³ä¾èµ–å†²çªï¼ˆresolve dependenciesï¼‰

``` ruby
def resolve_dependencies
Â  Â  # è·å– Sources
Â  Â  plugin_sources = run_source_provider_hooks
Â  Â  # åˆ›å»ºä¸€ä¸ª Analyzer
Â  Â  analyzer = create_analyzer(plugin_sources)
Â  Â  # å¦‚æœå¸¦æœ‰ repo_update æ ‡è®°
Â  Â  UI.section 'Updating local specs repositories' do
Â  Â  Â  Â  # æ‰§è¡Œ Analyzer çš„æ›´æ–° Repo æ“ä½œ
Â  Â  Â  Â  analyzer.update_repositories
Â  Â  end if repo_update?
Â  Â  UI.section 'Analyzing dependencies' do
Â  Â  Â  Â  # ä» analyzer å–å‡ºæœ€æ–°çš„åˆ†æç»“æœï¼Œ@analysis_resultï¼Œ@aggregate_targetsï¼Œ@pod_targets
Â  Â  Â  Â  analyze(analyzer)
Â  Â  Â  Â  # æ‹¼å†™é”™è¯¯é™çº§è¯†åˆ«ï¼Œç™½åå•è¿‡æ»¤
Â  Â  Â  Â  validate_build_configurations
Â  Â  end
Â  Â  # å¦‚æœ deployment? ä¸º trueï¼Œä¼šéªŒè¯ podfile & lockfile æ˜¯å¦éœ€è¦æ›´æ–°
Â  Â  UI.section 'Verifying no changes' do
Â  Â  Â  Â  verify_no_podfile_changes!
Â  Â  Â  Â  verify_no_lockfile_changes!
Â  Â  end if deployment?
Â  Â  analyzer
end
```

é€šè¿‡ Podfileã€Podfile.lock ä»¥åŠ manifest.lock ç­‰ç”Ÿæˆ Analyzer å¯¹è±¡ï¼Œå…¶å†…éƒ¨ä¼šä½¿ç”¨ä¸ª Molinillo ç®—æ³•è§£æå¾—åˆ°ä¸€å¼ ä¾èµ–å…³ç³»è¡¨ï¼Œè¿›è¡Œä¸€ç³»åˆ—çš„åˆ†æä¸ä¾èµ–å†²çªè§£å†³ã€‚

#### 3. ä¸‹è½½ä¾èµ–æ–‡ä»¶ï¼ˆdownload dependenciesï¼‰

``` ruby
def download_dependencies
Â  UI.section 'Downloading dependencies' do
Â  Â  # æ„é€  Pod Source Installer
Â  Â  install_pod_sources
Â  Â  # æ‰§è¡Œ podfile å®šä¹‰çš„ pre install çš„ hooks
Â  Â  run_podfile_pre_install_hooks
Â  Â  # æ ¹æ®é…ç½®æ¸…ç† pod sources ä¿¡æ¯ï¼Œä¸»è¦æ˜¯æ¸…ç†æ— ç”¨ platform ç›¸å…³å†…å®¹
Â  Â  clean_pod_sources
Â  end
end
```   

ç»è¿‡å‰é¢åˆ†æä¸è§£å†³ä¾èµ–å†²çªåï¼Œè¿™æ˜¯ä¼šè¿›è¡Œä¾èµ–ä¸‹è½½ã€‚ä¼šæ ¹æ®ä¾èµ–ä¿¡æ¯æ˜¯å¦è¢«æ–°æ·»åŠ æˆ–è€…ä¿®æ”¹ç­‰ä¿¡æ¯è¿›è¡Œä¸‹è½½ï¼ŒåŒæ—¶ä¸‹è½½åä¹Ÿä¼šåœ¨æœ¬åœ°ç•™æœ‰ä¸€ä»½ç¼“å­˜ï¼Œå…¶ç›®å½•åœ¨ ï½/Library/Caches/CocoaPods ã€‚

#### 4. éªŒè¯ targetsï¼ˆvalidate targetsï¼‰

``` ruby
def validate_targets
Â  Â  validator = Xcode::TargetValidator.new(aggregate_targets, pod_targets, installation_options)
Â  Â  validator.validate!
end

def validate!
Â  Â  verify_no_duplicate_framework_and_library_names
Â  Â  verify_no_static_framework_transitive_dependencies
Â  Â  verify_swift_pods_swift_version
Â  Â  verify_swift_pods_have_module_dependencies
Â  Â  verify_no_multiple_project_names if installation_options.generate_multiple_pod_projects?
end
```

* `verify_no_duplicate_framework_and_library_names`ï¼šéªŒè¯æ˜¯å¦æœ‰é‡åçš„ framework / library
* `verify_no_static_framework_transitive_dependencies`ï¼šéªŒè¯åŠ¨æ€åº“æ˜¯å¦æœ‰é™æ€é“¾æ¥åº“ä¾èµ–ã€‚ä¸ªäººè®¤ä¸ºï¼Œè¿™ä¸ªéªŒè¯æ˜¯ä¸å¿…è¦çš„ï¼Œèµ·ç ä¸å¿…è¦ errorã€‚
* `verify_swift_pods_swift_version`ï¼šéªŒè¯ Swift pod çš„ Swift ç‰ˆæœ¬é…ç½®ä¸”ç›¸äº’å…¼å®¹
* `verify_swift_pods_have_module_dependencies`ï¼šéªŒè¯ Swift pod æ˜¯å¦æ”¯æŒ module
* `verify_no_multiple_project_names`ï¼šéªŒè¯æ²¡æœ‰é‡åçš„ project åç§°

#### 5. ç”Ÿæˆå·¥ç¨‹ï¼ˆIntegrateï¼‰

``` ruby
def integrate
Â  Â  generate_pods_project
Â  Â  if installation_options.integrate_targets?
Â  Â  Â  Â  # é›†æˆç”¨æˆ·é…ç½®ï¼Œè¯»å–ä¾èµ–é¡¹ï¼Œä½¿ç”¨ xcconfig æ¥é…ç½®
Â  Â  Â  Â  integrate_user_project
Â  Â  else
Â  Â  Â  Â  UI.section 'Skipping User Project Integration'
Â  Â  end
end

def generate_pods_project
Â  Â  # åˆ›å»º stage sanbox ç”¨äºä¿å­˜å®‰è£…å‰çš„æ²™ç›’çŠ¶æ€ï¼Œä»¥æ”¯æŒå¢é‡ç¼–è¯‘çš„å¯¹æ¯”
Â  Â  stage_sandbox(sandbox, pod_targets)
Â  Â  # æ£€æŸ¥æ˜¯å¦æ”¯æŒå¢é‡ç¼–è¯‘ï¼Œå¦‚æœæ”¯æŒå°†è¿”å› cache result
Â  Â  cache_analysis_result = analyze_project_cache
Â  Â  # éœ€è¦é‡æ–°ç”Ÿæˆçš„ target
Â  Â  pod_targets_to_generate = cache_analysis_result.pod_targets_to_generate
Â  Â  # éœ€è¦é‡æ–°ç”Ÿæˆçš„ aggregate target
Â  Â  aggregate_targets_to_generate = cache_analysis_result.aggregate_targets_to_generate
Â  Â  # æ¸…ç†éœ€è¦é‡æ–°ç”Ÿæˆ target çš„ header å’Œ pod folders
Â  Â  clean_sandbox(pod_targets_to_generate)
Â  Â  # ç”Ÿæˆ Pod Projectï¼Œç»„è£… sandbox ä¸­æ‰€æœ‰ Pod çš„ pathã€build settingã€æºæ–‡ä»¶å¼•ç”¨ã€é™æ€åº“æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ç­‰
Â  Â  create_and_save_projects(pod_targets_to_generate, aggregate_targets_to_generate,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cache_analysis_result.build_configurations, cache_analysis_result.project_object_version)
Â  Â  # SandboxDirCleaner ç”¨äºæ¸…ç†å¢é‡ pod å®‰è£…ä¸­çš„æ— ç”¨ headersã€target support files ç›®å½•
Â  Â  SandboxDirCleaner.new(sandbox, pod_targets, aggregate_targets).clean!
Â  Â  # æ›´æ–°å®‰è£…åçš„ cache ç»“æœåˆ°ç›®å½• `Pods/.project_cache` ä¸‹
Â  Â  update_project_cache(cache_analysis_result, target_installation_results)
end
```

å°†ä¹‹å‰ç‰ˆæœ¬ä»²è£çš„æ‰€æœ‰ç»„ä»¶é€šè¿‡ project æ–‡ä»¶çš„å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œå¹¶å¯¹ project ä¸­åšä¸€äº›ç”¨æˆ·æŒ‡å®šçš„é…ç½®ã€‚

#### 6. å†™å…¥ä¾èµ–ï¼ˆwrite lockfilesï¼‰

``` ruby
def write_lockfiles
Â  @lockfile = generate_lockfile
Â  UI.message "- Writing Lockfile in #{UI.path config.lockfile_path}" do
Â  Â  # No need to invoke Sandbox#update_changed_file here since this logic already handles checking if the
Â  Â  # contents of the file are the same.
Â  Â  @lockfile.write_to_disk(config.lockfile_path)
Â  end
Â  UI.message "- Writing Manifest in #{UI.path sandbox.manifest_path}" do
Â  Â  # No need to invoke Sandbox#update_changed_file here since this logic already handles checking if the
Â  Â  # contents of the file are the same.
Â  Â  @lockfile.write_to_disk(sandbox.manifest_path)
Â  end
end
```

å°†ä¾èµ–æ›´æ–°å†™å…¥ Podfile.lock ä¸ Manifest.lock


#### 7. ç»“æŸå›è°ƒï¼ˆperform post install actionï¼‰

``` ruby
def perform_post_install_actions
Â  # è°ƒç”¨ HooksManager æ‰§è¡Œæ¯ä¸ªæ’ä»¶çš„ post_install æ–¹æ³•Â 
Â  run_plugins_post_install_hooks
Â  # æ‰“å°è¿‡æœŸ pod target è­¦å‘Š
Â  warn_for_deprecations
Â  # å¦‚æœ pod é…ç½®äº† script phases è„šæœ¬ï¼Œä¼šä¸»åŠ¨è¾“å‡ºä¸€æ¡æç¤ºæ¶ˆæ¯
Â  warn_for_installed_script_phases
Â  # è­¦å‘Šç§»é™¤çš„ master specs repo çš„ specs
Â  warn_for_removing_git_master_specs_repo
Â  # è¾“å‡ºç»“æŸä¿¡æ¯ `Pod installation complete!`
Â  print_post_install_message
end
```

æœ€åçš„æ”¶å°¾å·¥ä½œï¼Œè¿›è¡Œ post install action çš„ hook æ‰§è¡Œä»¥åŠä¸€äº› warning æ‰“å°ã€‚


## CocoaPods + Plugins

æ—©åœ¨ 2013 å¹´ï¼ŒCocoaPods å°±æ·»åŠ äº†å¯¹æ’ä»¶çš„æ”¯æŒï¼Œä»¥æ·»åŠ ä¸ç¬¦åˆä¾èµ–ç®¡ç†å’Œç”Ÿæ€ç³»ç»Ÿå¢é•¿ä¸ºä¸»è¦ç›®æ ‡çš„åŠŸèƒ½ã€‚CocoaPods Plugins å¯ä»¥ï¼šåœ¨ install å‰åæ·»åŠ  hookã€æ·»åŠ æ–°å‘½ä»¤åˆ° podã€ä»¥åŠåˆ©ç”¨ Ruby åŠ¨æ€æ€§åšä»»ä½•äº‹ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹å¸¸è§çš„æ’ä»¶ï¼š

* [cocoapods-binary](https://github.com/leavez/cocoapods-binary)ï¼šä¸€ä¸ªæ¯”è¾ƒæ—©æœŸçš„äºŒè¿›åˆ¶æ’ä»¶åº“ï¼Œæ˜¯è¯¸å¤šäºŒè¿›åˆ¶æ–¹æ¡ˆçš„çµæ„Ÿæ¥æº
* [cocoapods-repo-update](https://github.com/wordpress-mobile/cocoapods-repo-update)ï¼šè‡ªåŠ¨åŒ– pod repo update
* [cocoapods-integrate-flutter](https://github.com/upgrad/cocoapods-integrate-flutter)ï¼šå°† flutter ä¸ç°æœ‰ iOS åº”ç”¨ç¨‹åºé›†æˆ
* [cocoapods-uploader](https://github.com/alibaba-archive/cocoapods-uploader)ï¼šä¸Šä¼ æ–‡ä»¶/ç›®å½•åˆ°è¿œç¨‹ä»“åº“

> è®¸å¤šæ’ä»¶å¯èƒ½è®¸ä¹…æœªç»´æŠ¤ï¼Œè¯»è€…ä½¿ç”¨éœ€è‡ªè¡Œæ–Ÿé…Œã€‚


## ä¸å¤ªå¸¸è§æ¦‚å¿µ

CocoaPods çš„é…ç½®å†…å®¹å‡ ä¹åŒ…å«äº† Xcode Build çš„æ–¹æ–¹é¢é¢ï¼Œå› æ­¤å­˜åœ¨è®¸å¤šä¸å¤ªå¸¸è§çš„æ¦‚å¿µï¼Œåœ¨æ­¤åšä¸€ä¸ªé“¾æ¥èšåˆä»¥ä¾›å‚è€ƒã€‚

* Clang Module / module_map / umbrella headerï¼šClang Module æ˜¯ Clang 16.0.0 ä¸­å¼•å…¥çš„æ¦‚å¿µï¼Œç”¨ä»¥è§£å†³ #include / #import å¤´æ–‡ä»¶å¼•å…¥å¯¼è‡´çš„ç›¸å…³é—®é¢˜ï¼›module_map æ˜¯ç”¨ä»¥æè¿° clang module ä¸ header çš„å…³ç³»ï¼›umbrella header åˆ™æ˜¯ module_map ä¸­çš„è¯­æ³•è§„èŒƒï¼Œè¡¨ç¤ºæŒ‡å®šç›®å½•ä¸­çš„å¤´æ–‡ä»¶éƒ½åº”åŒ…å«åœ¨æ¨¡å—ä¸­ã€‚

* [Modules](https://clang.llvm.org/docs/Modules.html#introduction)
* [Clang Module](http://chuquan.me/2021/02/11/clang-module/)
* [LLVM ä¸­çš„ Module](https://www.stephenw.cc/2017/08/23/llvm-modules/)
* Hmap / Xcode Header / CocoaPods Headers

Header Map æ˜¯ä¸€ç»„å¤´æ–‡ä»¶ä¿¡æ¯æ˜ å°„è¡¨ï¼Œç”¨ .hmap åç¼€è¡¨ç¤ºï¼Œæ•´ä½“ç»“æ„ä»¥ Key-Value å½¢å¼å­˜å‚¨ï¼›Keyä¸ºå¤´æ–‡ä»¶åç§°ã€Value ä¸º å¤´æ–‡ä»¶ç‰©ç†åœ°å€ã€‚

Xcode Phases - Header åœ¨æ„å»ºé…ç½®ä¸­åˆ†ä¸º publicã€private ä¸ project ï¼Œç”¨ä»¥ä¸ target å…³è”ï¼›å…¶ä¸­ public ã€private å°±å¤åˆ¶åˆ°æœ€ç»ˆäº§ç‰©çš„ header å’Œ PrivateHeaders ä¸­ï¼Œè€Œ project å¤´æ–‡ä»¶ä¸å¯¹å¤–ä½¿ç”¨ï¼Œåˆ™ä¸ä¼šæ”¾åˆ°æœ€ç»ˆäº§ç‰©ã€‚

* [ä¸€æ¬¾å¯ä»¥è®©å¤§å‹iOSå·¥ç¨‹ç¼–è¯‘é€Ÿåº¦æå‡50%çš„å·¥å…·](https://tech.meituan.com/2021/02/25/cocoapods-hmap-prebuilt.html)
* [What are build phases?](https://help.apple.com/xcode/mac/current/#/dev50bab713d)
* [Xcconfig](https://nshipster.com/xcconfig/): ä¸€ç§é…ç½®æ–‡ä»¶ï¼Œç”¨ä»¥å¯¹æ„å»ºè®¾ç½®è¿›è¡Œå£°æ˜ä¸ç®¡ç†ï¼Œæ¯”å¦‚åŒºåˆ†ä¸åŒçš„å¼€å‘ç¯å¢ƒç­‰ã€‚
* [On demand resource](https://developer.apple.com/videos/play/wwdc2015/214/)ï¼šWWDC 2015 å¼•å…¥çš„æ¦‚å¿µï¼Œå¯¹èµ„æºæ–‡ä»¶çš„æŒ‰éœ€åŠ è½½ã€‚


# æ€»ç»“

Cocoapodså‘å±•è¿™ä¹ˆå¤šå¹´å´ä¾ç„¶æœå½¹äºç°æœ‰çš„iOSå·¥ç¨‹,è¶³ä»¥è¯´æ˜å…¶åŒ…ç®¡ç†çš„é‡è¦æ€§,æœ‰å¾ˆå¤šSDKå‚å•†ç”¨å®ƒåšSDKåˆ¶å“å·¥ç¨‹çš„ç®¡ç†,æœ‰å¾ˆå¤šä¸šåŠ¡å›¢é˜Ÿç”¨å®ƒåšå·¥ç¨‹ç»„ä»¶åŒ–ç¼–è¯‘,å‡¡æ­¤ç§ç§éƒ½è¶³ä»¥è¯´æ˜è¿™ä¸ªå·¥å…·æ˜¯ä¸€ä¸ªiOSå¼€å‘è€…å¿…å¤‡çš„ä¸“ä¸šå·¥å…·,æœ‰å¾ˆå¤šç»†èŠ‚å¸Œæœ›å¤§å®¶è®¤çœŸæŒ–æ˜.

å‚è€ƒåˆ—è¡¨:

[Cocoapods.orgå®˜æ–¹ç½‘ç«™](https://cocoapods.org/)  
[æ·±å…¥ç†è§£ CocoaPods](https://objccn.io/issue-6-4/)  
[ç³»ç»Ÿç†è§£ iOS åº“ä¸æ¡†æ¶](http://chuquan.me/2021/02/14/understand-ios-library-and-framework/)
[Cocoapods script phases](https://swiftunwrap.com/article/cocoapods-script-phases/)
[CocoaPods Podfile è§£æåŸç†
](http://chuquan.me/2021/12/24/podfile-analyze-principle/)     
[Semantic Versioning 2.0.0](https://semver.org/)   
[ä¸€æ¬¾å¯ä»¥è®©å¤§å‹iOSå·¥ç¨‹ç¼–è¯‘é€Ÿåº¦æå‡50%çš„å·¥å…·](https://tech.meituan.com/2021/02/25/cocoapods-hmap-prebuilt.html)  
[CocoaPods Source ç®¡ç†æœºåˆ¶](http://chuquan.me/2022/01/07/source-analyze-principle/#more)  
[ç‰ˆæœ¬ç®¡ç†å·¥å…·åŠ Ruby å·¥å…·é“¾ç¯å¢ƒ](https://www.desgard.com/2020/06/11/cocoapods-story-1.html#podfilelock)  
[æ•´ä½“æŠŠæ¡ CocoaPods æ ¸å¿ƒç»„ä»¶
](https://www.desgard.com/2020/08/17/cocoapods-story-2.html)  
[å·¥ç¨‹æ•ˆç‡ä¼˜åŒ–ï¼šCocoaPodsä¼˜åŒ–](https://binlogo.github.io/post/gong-cheng-xiao-lu-you-hua-cocoapods-you-hua/)  
[podä»“åº“çš„å¸¸ç”¨å‘½ä»¤](https://www.sunyazhou.com/2023/04/podcommands/)  
[å¦‚ä½•åœ¨podä¸­çš„podspecä½¿ç”¨XCAssets
](https://www.sunyazhou.com/2023/03/podxcassets/)  
[Pod specé›†æˆç¬¬ä¸‰frameworkå’Œ.aå·¥ä½œè®°å½•](https://www.sunyazhou.com/2020/10/PodSpec/)  


URL: https://sunyazhou.com/2023/04/podcommands/index.html.md
Published At: 2023-04-03 09:10:00 +0000

# podä»“åº“çš„å¸¸ç”¨å‘½ä»¤

![](/assets/images/20201010PodSpec/cocoapods.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## æ·»åŠ ç§æœ‰æºç«™çš„ä»“åº“

``` sh
pod repo add sunyazhou-specs https://www.sunyazhou.com/xxproject/Specs.git --verbose
```

## å•ç‹¬æ›´æ–°æŸä¸ªpod specçš„ä»“åº“ç´¢å¼•

``` sh 
pod repo update sunyazhou-specs --verbose
```

## pushæœ¬åœ° repo çš„podspecåˆ°è¿œç«¯ç§æœ‰æºç«™


``` sh
pod repo push sunyazhou-specs xxxxlib.podspec --allow-warnings --use-libraries --verbose --skip-import-validation
```


è¿™é‡Œçš„pushæ“ä½œä¼šè‡ªåŠ¨è§¦å‘git push.æŠŠpodspecæ¨é€åˆ°è¿œç«¯ç´¢å¼•ä»“åº“,åé¢åŠ äº†ä¸€å †å‚æ•°æ˜¯ä¸ºäº†å»é™¤è­¦å‘Šæ–¹ä¾¿ç¼–è¯‘é€šè¿‡.

å¦‚æœæ˜¯æ‰‹åŠ¨çš„è¯éœ€è¦åœ¨specä»“åº“ åˆ›å»º **åº“å**/**ç‰ˆæœ¬å·**/**xxxlib.spec**æ–‡ä»¶




URL: https://sunyazhou.com/2023/03/podxcassets/index.html.md
Published At: 2023-03-22 02:08:00 +0000

# å¦‚ä½•åœ¨podä¸­çš„podspecä½¿ç”¨XCAssets

![](/assets/images/20201010PodSpec/cocoapods.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# èƒŒæ™¯ 

æœ€è¿‘è¿™å‡ å¹´,ç§»åŠ¨ç«¯å·¥ç¨‹çš„å¼€å‘æ¨¡å¼é€æ¸å˜æˆé¢å‘podå¼€å‘,å°±æ˜¯å·¥ç¨‹å¤§äº†ä»¥åæ¯ä¸ªæ¨¡å—å’Œä¸šåŠ¡å°±å˜æˆäº†å•ç‹¬çš„pod.
åœ¨è¿™ç§ä½¿ç”¨podçš„èƒŒæ™¯ä¸‹,æˆ‘ä»¬çš„å¼€å‘èµ„æºä¾‹å¦‚å›¾ç‰‡ã€æ–‡æœ¬æ–‡ä»¶ã€plistã€éŸ³é¢‘æ–‡ä»¶ç­‰ç­‰ä¼šè¢«åˆ›å»ºåæ”¾åˆ°ç›¸åº”çš„podä¸‹çš„bundleç›®å½•é‡Œ


å½“æ”¾åˆ°bundleä¸‹åå°±ä¸æ”¯æŒ@2xå’Œ@3xçš„åç¼€åæ”¯æŒäº†,å–å›¾ç‰‡çš„æ—¶å€™æ³¨æ„ä¸‹ä¸‹é¢ä»£ç 

``` objc
NSBundle *mainBundle = [NSBundle bundleForClass:self.class];
NSString *resourcePath = [mainBundle pathForResource:@"YZTools" ofType:@"bundle"];
NSBundle *resourceBundle = [NSBundle bundleWithPath:resourcePath] ?: mainBundle;
NSString *imagePath = [resourceBundle pathForResource:@"power" ofType:@"jpg"];
UIImage *image = [UIImage imageWithContentsOfFile:imagePath];
```

> 1.podä¸å‡ºæ„å¤–çš„æ—¶å€™åŸºæœ¬éƒ½ä¼šè¢«ç¼–è¯‘æˆframework,é‚£å¯¹åº”bundleæœ€åç¼–è¯‘å®Œåä¼šæ”¾åˆ°frameworkçš„ç›®å½•ä¸‹è¿™æ—¶å€™å°±ä¸èƒ½ç”¨ä¼ ç»Ÿçš„mainBundleå»å–äº†,å› ä¸ºå®ƒçš„é»˜è®¤bundleå·²ç»ä¸æ˜¯ä¸»å·¥ç¨‹bundleäº†,åº”è¯¥å–è‡ªå½“å‰æŸä¸ªæ ¸å¿ƒclassæ‰€åœ¨çš„ç›®å½•ä¸‹çš„bundle.  
> 2.å¹¶ä¸”å›¾ç‰‡åå¦‚æœå¸¦@2xæˆ–è€…@3x ç›´æ¥å–å¾—æ—¶å€™å¿…é¡»å¾—å†™ä¸Šç»å¯¹åç§° å¦‚ä¸‹ä¾‹å­  
> 	
> ``` objc
> 	[resourceBundle pathForResource:@"power@2x" ofType:@"jpg"];
> ```

ä¸Šè¿°æ˜¾ç„¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚.

![](/assets/images/20230322PodXCAssets/1.webp)

## å›¾ç‰‡éƒ½æ˜¯å¸¦2x3xçš„å›¾,æ€ä¹ˆä»é»˜è®¤çš„podé‡Œé¢å–åˆ°ç›¸å…³çš„å›¾ç‰‡å‘¢?.

è¿™æ—¶å€™æˆ‘ä»¬è¦åšå‡ ä»¶äº‹

* 1. åˆ›å»ºXCAssets
* 2. åœ¨podspecä¸­å£°æ˜å¥½ç›¸å…³åç§°
* 3. åˆ›å»ºä¸ºå›¾ç‰‡ åˆ›å»ºå¥½category ä»è¿™ä¸ªpodçš„çš„XCAssetså–å‡º

#### åˆ›å»ºXCAssets

##### å¦‚ä¸‹å›¾

![](/assets/images/20230322PodXCAssets/2.webp)


##### podspecä¸­å£°æ˜

``` ruby
spec.resource_bundles = {'YZToolsAssets' => ['Resources/*.xcassets']}
```

è¿™é‡Œçš„YZToolsAssetså’ŒYZTools.podspecé‡Œçš„spec.resource_bundles ä¸­çš„'YZToolsAssets'è¦å®Œå…¨å¯¹åº”.

ä¸‹å›¾ä¸­æ˜¯ç›¸å…³çš„æ–‡æ¡£

![](/assets/images/20230322PodXCAssets/6.webp)

è¿™ç§[podspecæ–‡æ¡£](https://guides.cocoapods.org/syntax/podspec.html#resource_bundles)ä¸­è¯´æ˜æ¼”ç¤ºçš„ä¸æ¸…æ™°,å¤§å®¶éœ€è¦æ·±å…¥å­¦ä¹ å’ŒæŒ–æ˜,

æ˜¾ç„¶è¿™ä¸ªæ–‡æ¡£æ ¹æœ¬æ²¡è¯´XCAssetså’‹åŠ çš„.

##### ä¸ºå›¾ç‰‡è·å–æ·»åŠ åˆ†ç±»

``` objc
#import <UIKit/UIKit.h>
NS_ASSUME_NONNULL_BEGIN
@interface UIImage (YZBundleImage)

/// ä»YZToolsçš„YZToolsAssetså–å›¾ç‰‡
/// - Parameter imageName: å›¾ç‰‡åç§°
+ (UIImage *)yzToolsImageNamed:(NSString *)imageName;

@end

//è¿™é‡Œçš„YZToolsAssetså’ŒYZTools.podspecé‡Œçš„spec.resource_bundles = {'YZToolsAssets' å®Œå…¨å¯¹åº”
NSString *kYZToolsAssets = @"YZToolsAssets";

@implementation UIImage (YZBundleImage)

+ (NSBundle *)yzImageBundle
{
    static NSBundle *imageBundle = nil;
    if (!imageBundle)
    {
        NSBundle *mainBundle = [NSBundle mainBundle];
        NSString *resourcePath = [mainBundle pathForResource:kYZToolsAssets ofType:@"bundle"];
        imageBundle = [NSBundle bundleWithPath:resourcePath] ?: mainBundle;
    }
    NSAssert([imageBundle bundlePath].length > 0, @"å†…éƒ¨imageBundleè·¯å¾„ä¸èƒ½ä¸ºç©º");
    return imageBundle;
}

+ (UIImage *)yzToolsImageNamed:(NSString *)imageName
{
    NSBundle *imageBundle = [self yzImageBundle];
    UIImage *image = [UIImage imageNamed:imageName inBundle:imageBundle compatibleWithTraitCollection:nil];
    return image;
}

@end


NS_ASSUME_NONNULL_END
```

åœ¨ä½¿ç”¨çš„æ—¶å€™å¦‚ä¸‹ä»£ç ï¼š

``` objc
UIImage *image = [UIImage yzToolsImageNamed:@"power"];
```  
ç»“æœå¦‚ä¸‹å›¾:

![](/assets/images/20230322PodXCAssets/3.webp)

è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹è¿™é‡Œé¢æ‹¿åˆ°çš„æ˜¯`mainBundle`.

#### å½“ç¼–è¯‘å®Œåæœ€ç»ˆçš„XCAssetsä¼šå˜æˆä¸€ä¸ªbundle

åœ¨.app/ç›®å½•ä¸‹

![](/assets/images/20230322PodXCAssets/4.webp)

``` sh
/var/containers/Bundle/Application/F3C2809A-A5E4-4808-A2AA-5962D4BE6AA1/bodianplayer.app/YZToolsAssets.bundle
```
![](/assets/images/20230322PodXCAssets/5.webp)

å¯ä»¥çœ‹åˆ°è¿™é‡Œçš„å›¾ç‰‡ç´ æå·²ç»è¢«åŠ å¯†å˜æˆä¸€ä¸ªå«åšAssets.carçš„æ–‡ä»¶,è¿™è¯´æ˜æˆ‘ä»¬çš„èµ„æºå·²ç»è¢«åŠ å¯†æ‰“åŒ…,è½»æ˜“ä¸ä¼šè¢«åˆ«çš„appæ‰¾åˆ°.

# æ€»ç»“

è¿™é‡Œçš„XCAssetsåœ¨æœ€ç»ˆè¢«åŒ…è£…æˆbundleæ”¾åœ¨ä¸»appçš„ç›®å½•ä¸‹,æœ€æ ¸å¿ƒçš„æ–¹å¼æ˜¯é€šè¿‡podå†™å¥½`resource_bundles`,å¹¶ä¸”è®°å½•å¥½ä½ ç»™å®ƒçš„åå­—

è¿™é‡Œå°±ç»™å¤§å®¶æä¾›demoäº†,éƒ½æ˜¯ä¸€äº›æŠ€å·§.


URL: https://sunyazhou.com/2023/03/flutterformtextfield/index.html.md
Published At: 2023-03-18 06:50:00 +0000

# Flutterä¸­çš„Formè¡¨å•

![](/assets/images/20230312FlutterLifeCycle/flutter0.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



# ç¬”è®°

åœ¨å­¦ä¹ flutterä¸­å¤„ç†ç”¨æˆ·åå’Œå¯†ç è¾“å…¥çš„é—®é¢˜æ—¶,Flutterè¿™è¾¹è½»æ¾æå®š,å­¦å®Œåå‘ç°flutterå†…ç½®çš„èƒ½åŠ›éå¸¸å¼ºå¤§.ä¸‹é¢æ˜¯è®°å½•ç”¨æˆ·åå¯†ç è¾“å…¥çš„ç®€å•demo.

![](/assets/images/20230318FlutterFormTextfield/flutterInput.gif)

``` dart
import 'package:flutter/material.dart';

///åˆ›å»º
void main () {
  runApp(MyApp());
}

class MyApp extends StatelessWidget  {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: "hello flutter",
      home: Scaffold(
        appBar: AppBar(
          title: Text("sunyazhou.com"),
        ),
        body: ContentWidget(),
      ),
    );
  }
}

class LoginWidgetState extends State<LoginWidget> {
  String username = "";
  String password = "";
  GlobalKey<FormState> formGlobalKey = GlobalKey();
  @override
  Widget build(BuildContext context) {
    return Form(
        key: formGlobalKey,
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            TextFormField(
              decoration: InputDecoration(
                  icon: Icon(Icons.people),
                  labelText: "ç”¨æˆ·å",

              ),
              onSaved: (value) {
                  print("æ‰§è¡Œäº†usernameçš„ onSaved:$value");
                  this.username = value!;
              },
              validator: (value) {
                if (value == null || value.length == 0) {
                  return "ç”¨æˆ·åä¸èƒ½ä¸ºç©º!";
                }
                return null;
              },
            ),
            TextFormField(
              obscureText: true,
              decoration: InputDecoration(
                icon: Icon(Icons.lock),
                labelText: "å¯†ç ",
              ),
              onSaved: (value) {
                print("æ‰§è¡Œäº†passwordçš„ onSaved:$value");
                this.password = value!;
              },
              validator: (value) {
                if (value == null || value.length == 0) {
                  return "å¯†ç ä¸èƒ½ä¸ºç©º!";
                }
                return null;
              },
            ),
            SizedBox(height: 20,),
            Container(
              width: double.infinity,
              height: 44,
              child: ElevatedButton(
                child: Text("ç™»å½•", style: TextStyle(fontSize: 20, color: Colors.white),),
                onPressed: () {
                  print("æ³¨å†ŒæŒ‰é’®è¢«ç‚¹å‡»");
                  formGlobalKey.currentState?.validate();
                  formGlobalKey.currentState?.save();
                  print("username:$username, password:$password");
                },
              ),
            ),
          ],
        ),
    );
  }
}
```

ä¸Šé¢çš„ä»£ç ä¸ä½†å…·å¤‡è¾“å…¥æ¡†çš„åŠŸèƒ½,è¿˜å…·å¤‡è¾“å…¥æ¡†å†…çš„å†…å®¹æ ¡éªŒ,å½“å‘ç”Ÿé”™è¯¯çš„æ—¶å€™ å¯ä»¥ä½¿ç”¨`formGlobalKey`æ‹¿åˆ°å½“å‰`State`è°ƒç”¨`validate()`å‡½æ•°æ¥è§¦å‘è¾“å…¥æ¡†çš„æ ¡éªŒæ–¹æ³•.

``` dart
formGlobalKey.currentState?.validate();
```

è¿™æ­¥çš„æ“ä½œåŸç†å¤§æ¦‚æ˜¯

1. å£°æ˜GlobalKey
2. æŠŠå£°æ˜çš„GlobalKey çš„å®ä¾‹ä¼ å…¥åˆ° `Form`ä¸­
3. é€šè¿‡è°ƒç”¨`formGlobalKey.currentState?.validate();`å‡½æ•°æ¥è°ƒç”¨å…¶è¡¨å•å†…å­æ§ä»¶çš„æ–¹æ³•`validator`æ¥æ ¡éªŒ
4. æœ€åæäº¤æœåŠ¡ç«¯ç™»æ“ä½œæ ¡éªŒæäº¤å†…å®¹

# æ€»ç»“

ä¸å¾—ä¸è¯´flutterè¿˜æ˜¯æœ‰ä»–çš„ä¼˜åŠ¿çš„,é€šè¿‡è¡¨å•æ§ä»¶å®Œæˆå¯¹childrençš„æ–¹æ³•æ³¨å…¥.ä»è€Œå®ç°åè®®çº¦æŸçš„å½¢å¼, ä»£ç ç®€æ´é«˜æ•ˆ.


ä¸‹é¢é™„ä¸Šå­¦ä¹ å…¶ä»–æ§ä»¶çš„è®°å½•

``` dart

class ContentWidget extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(20.0),
      child: LoginWidget(),
    );
  }
}

class LoginWidget extends StatefulWidget {
  @override
  State<StatefulWidget> createState() {
    return LoginWidgetState();
  }
}

class RegisterWidget extends StatefulWidget {
  @override
  State<StatefulWidget> createState() {
    return RegisterWidgetState();
  }
}

class RegisterWidgetState extends State <RegisterWidget> {
  final textEditingController = TextEditingController();

  @override
  void initState() {
    // TODO: implement initState
    textEditingController.text = "é»˜è®¤å€¼";
    textEditingController.addListener(() {
        print("ç›‘å¬åˆ°å€¼çš„å˜åŒ–: ${textEditingController.text}");
    });
  }
  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(20.0),
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          TextField(
              decoration: InputDecoration(
                icon: Icon(Icons.people),
                labelText: "username",
                hintText: "è¯·è¾“å…¥ç”¨æˆ·å",
                border: OutlineInputBorder(
                  borderSide: BorderSide(width: 1),
                ),
                // filled: true,
                // fillColor: Colors.purple,
              ),
            onChanged: (value) {
                print("å½“å‰å€¼ $value");
            },
            onSubmitted: (value) {
                print("æœ€åæäº¤å€¼:$value");
            },
            controller: textEditingController,
          ),
        ],
      ),
    );
  }
}

class RadiusImageDemo extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Center(
      child: ClipRRect(
        borderRadius: BorderRadius.circular(16),
        child: Image.network("https://www.sunyazhou.com/assets/images/avatar.jpg",
          width: 150,
          height: 150,
        ),
      ),
    );
  }
}

class CircleImageDemo extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return ClipOval(
      child: Image.network("https://www.sunyazhou.com/assets/images/avatar.jpg",
        width: 150,
        height: 150,
      ),
    );
  }
}

class AssertImageDemo extends StatelessWidget
{
  @override
  Widget build(BuildContext context) {
    return Image.asset("assets/images/3.webp");
  }
}

class NetworkImageDemo extends StatelessWidget
{
  @override
  Widget build(BuildContext context) {
    return Center(
      child: Container(
        width: 300,
        height: 300,
        color: Colors.red,
        child: Image.network("https://www.sunyazhou.com/assets/images/20230312FlutterLifeCycle/flutter3.webp",
          // fit: BoxFit.cover,
          repeat: ImageRepeat.repeatY,
        ),

      ),
    );
  }
}

class ButtonDemo extends StatelessWidget
{
  @override
  Widget build(BuildContext context) {
    return Column(
      children: [
        ElevatedButton(
          child: Text("ElevatedButton"),
          onPressed: () => print("ElevatedButton click"),
        ),
        OutlinedButton(
          child: Text("OutlinedButton"),
          onPressed: () => print("OutlinedButton click"),
        ),
        FloatingActionButton(
          child: Text("FloatingActionButton"),
          onPressed: () => print("FloatingActionButton click"),
        ),

      ],
    );
  }
}

class TextRichDemo extends StatelessWidget
{
  @override
  Widget build(BuildContext context) {
    return Text.rich(
      TextSpan(
        children: [
          TextSpan(
              text: "sunyazhou.com", style: TextStyle(fontSize: 30, fontWeight: FontWeight.bold, color: Colors.red)
          ),
          TextSpan(
              text: "sunyazhou", style: TextStyle(fontSize: 18,color: Colors.blue)
          ),
          TextSpan(text: "\næœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. \næœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨,\nè¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,è¿™æ ·æ‚¨å°†èƒ½åœ¨ç¬¬ä¸€æ—¶é—´è·å–æœ¬ç«™ä¿¡æ¯.",style: TextStyle(fontSize: 20, color:  Colors.deepOrangeAccent)),

        ],
      ),
      textAlign: TextAlign.center,
    );
  }
}

class TextDemo extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Text("æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,\nå¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. \næœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–ä½¿ç”¨,"
      ,style: TextStyle(
        fontSize: 20,
        color: Colors.lightBlue,
      ),
      textAlign: TextAlign.center,
      // maxLines: 2,
      overflow: TextOverflow.ellipsis,
      // textScaleFactor: 2,
    );
  }
}
```





URL: https://sunyazhou.com/2023/03/circularsliderview/index.html.md
Published At: 2023-03-17 12:38:00 +0000

# ä½¿ç”¨SwiftUIç»˜åˆ¶ç¯å½¢ Slider

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## SwiftUIç»˜åˆ¶ç¯å½¢ Slider

æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« è®²è¿°ç®€å•çš„ç”¨SwiftUIç»˜åˆ¶ä¸€ä¸ªåœ†å½¢Slider,ç»è¿‡äº²æ‰‹å®è·µæœç„¶å¾ˆç®€å•,è®°å½•ä¸€ä¸‹ä»£ç å®ç°å’Œæ•ˆæœ.


![](/assets/images/20230317CircularSliderView/slider.gif)

``` swift
//
//  CircularSliderView.swift
//  CircleSliderDemo
//
//  Created by sunyazhou on 2023/3/16.
//

import Foundation
import SwiftUI

struct CircularSliderView: View
{
    @Binding var progress: Double
    @State private var rotationAngle = Angle(degrees: 0)
    
    private var minValue = 0.0
    private var maxValue = 1.0
    
    init(value progress: Binding<Double>, in bounds: ClosedRange<Int> = 0...1) {
        self._progress = progress
        self.minValue = Double(bounds.first ?? 0)
        self.maxValue = Double(bounds.last ?? 1)
        self.rotationAngle = Angle(degrees: progressFraction * 360.0)

    }
    
    private var progressFraction: Double {
        return ((progress - minValue) / (maxValue - minValue))
    }
    
    private func changeAngle(location: CGPoint) {
        // ä¸ºä½ç½®åˆ›å»ºä¸€ä¸ªå‘é‡ï¼ˆåœ¨ iOS ä¸Šåè½¬ y åæ ‡ç³»ç»Ÿï¼‰
        let vector = CGVector(dx: location.x, dy: -location.y)
        
        //è®¡ç®—å‘é‡çš„è§’åº¦
        let angleRadians = atan2(vector.dx, vector.dy)
        
        // å°†è§’åº¦è½¬æ¢ä¸º 0 åˆ° 360 çš„èŒƒå›´ï¼ˆè€Œä¸æ˜¯è´Ÿè§’åº¦ï¼‰
        let positiveAngle = angleRadians < 0.0 ? angleRadians + (2.0 * .pi) : angleRadians
        
        // æ ¹æ®è§’åº¦æ›´æ–°æ»‘å—è¿›åº¦å€¼
        progress = ((positiveAngle / (2.0 * .pi)) * (maxValue - minValue )) + minValue
        rotationAngle = Angle(radians: positiveAngle)
    }
    
    var body: some View {
        GeometryReader { gr in
            let radius = (min(gr.size.width, gr.size.height) / 2.0) * 0.9
            let sliderWidth = radius * 0.1
            
            VStack(spacing: 0) {
                ZStack {
                    Circle() //å¤–åœ†
                        .stroke(Color(hue: 0.0, saturation: 0.0, brightness: 0.9), lineWidth: 20.0)
                        .overlay() {
                            Text("\(progress, specifier: "%.2f")")
                                .font(.system(size: radius * 0.6, weight: .bold, design: .rounded))
                        }
                    Circle() //è¿›åº¦æ¡
                        .trim(from: 0, to: progressFraction)
                        .stroke(Color(hue: 0.0, saturation: 0.5, brightness: 0.9),
                                style: StrokeStyle(lineWidth: sliderWidth, lineCap: .round))
                        .rotationEffect(Angle(degrees: -90))
                    Circle() //æ—‹é’®
                        .fill(Color.white)
                        .shadow(radius: sliderWidth * 0.3)
                        .frame(width: sliderWidth, height: sliderWidth)
                        .offset(y: -radius)
                        .rotationEffect(rotationAngle)
                        .gesture(
                            DragGesture(minimumDistance: 0.0)
                                .onChanged() { value in
                                    changeAngle(location: value.location)
                                }
                        )
                }
                .frame(width: radius * 2.0, height: radius * 2.0, alignment: .center)
                .padding(radius * 0.1)
            }
            
            .onAppear {
                self.rotationAngle = Angle(degrees: progressFraction * 360.0)
            }
            
        } 
    }
}

```

# æ€»ç»“

SwiftUIå†™ä»£ç å¾ˆå¿«,apiéå¸¸å¤š,æ¯”UIKitä¾¿æºäº†å¾ˆå¤š,ä¹Ÿç®€å•äº†å¾ˆå¤š,æˆ‘çš„ä¹ æƒ¯æ˜¯åˆ«äººçš„ä¸œè¥¿æ‹¿æ¥æ¶ˆåŒ–å¸æ”¶çš„åŒæ—¶å¿…é¡»å‡ºdemo.


[æœ¬æ–‡demo](https://github.com/sunyazhou13/CircleSliderDemo)  
[åœ¨ SwiftUI ä¸­åˆ›å»ºä¸€ä¸ªç¯å½¢ Slider
](https://mp.weixin.qq.com/s/DUFEB5aOTx1jurPP4gP0MQ)


URL: https://sunyazhou.com/2023/03/flutterlifecycle/index.html.md
Published At: 2023-03-12 06:38:00 +0000

# Flutterçš„æœ‰çŠ¶æ€StatefulWidgetç”Ÿå‘½å‘¨æœŸ

![](/assets/images/20230312FlutterLifeCycle/flutter0.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## Flutterçš„å£°æ˜å‘¨æœŸ


æœ€è¿‘åœ¨è´Ÿè´£æ³¢ç‚¹éŸ³ä¹çš„ç›¸å…³å¼€å‘,ç”±äºæ³¢ç‚¹æ˜¯ç”¨flutterå†™çš„,æ‰€ä»¥å‘¨æœ«ä¸å¾—ä¸åšä¸€äº›Flutterå¼€å‘çš„åŠŸè¯¾æ¥å¼¥è¡¥è‡ªå·±åœ¨ç§»åŠ¨ç«¯æŠ€æœ¯æ ˆçš„ç¼ºå¤±.

Flutterçš„å£°æ˜å‘¨æœŸä¸»è¦æ˜¯`StatefulWidget`å’Œ`State`ä¹‹é—´é…åˆ

ä¸‹é¢ä»ç¥–ä¼ çš„hello worldå¼€å§‹

``` dart
import 'package:flutter/material.dart';

///åˆ›å»º
void main () {
  runApp(MyApp());
}

class MyApp extends StatelessWidget  {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: "hello flutter",
      home: Scaffold(
        appBar: AppBar(
          title: Text("sunyazhou.com"),
        ),
        body: ContentWidget(),
      ),
    );
  }
}

class ContentWidget extends StatefulWidget
{
  ContentWidget(){
    print("ContentWidgetæ„é€ å‡½æ•°è¢«è°ƒç”¨");
  }
   @override
  State<StatefulWidget> createState() {
     print("createStateè¢«è°ƒç”¨");
    return ContentWidgetState();
  }
}

class ContentWidgetState extends State<ContentWidget>
{
  int counter = 0;
  ContentWidgetState()
  {
    print("ContentWidgetStateæ„é€ å‡½æ•°è¢«è°ƒç”¨");
  }

  @override
  void initState() {
    // TODO: implement initState
    super.initState();
    print("ContentWidgetStateçš„ initStateè¢«è°ƒç”¨");
  }

  @override
  void didChangeDependencies() {
    super.didChangeDependencies();
    print("ContentWidgetStateçš„ didChangeDependenciesè¢«è°ƒç”¨");
  }

  @override
  void didUpdateWidget(covariant ContentWidget oldWidget) {
    super.didUpdateWidget(oldWidget);
    print("ContentWidgetStateçš„ didUpdateWidgetè¢«è°ƒç”¨");
  }

  @override
  Widget build(BuildContext context) {
    print("ContentWidgetStateçš„ buildè¢«è°ƒç”¨");
    return Center(
        child: Column (
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          ElevatedButton(onPressed: (){
             setState(() {
               counter++;
             });
          }, child: Text("è®¡æ•°+1")),
          Text("hello world $counter", style: TextStyle(fontSize: 30),),
        ],
      ),
    );
  }
}

```

![](/assets/images/20230312FlutterLifeCycle/flutter1.webp)

æ‰“å°å¦‚ä¸‹:

``` sh
flutter: ContentWidgetæ„é€ å‡½æ•°è¢«è°ƒç”¨
flutter: createStateè¢«è°ƒç”¨
flutter: ContentWidgetStateæ„é€ å‡½æ•°è¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ initStateè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ didChangeDependenciesè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetæ„é€ å‡½æ•°è¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ didUpdateWidgetè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
```

####  didUpdateWidget

`didUpdateWidget()` è¿™ä¸ªå‡½æ•°çˆ¶ç±»æ›´æ–°æ‰ä¼šè¢«è°ƒç”¨

#### å½“ç‚¹å‡»åçš„ç»“æœ

å½“æ¯æ¬¡ç‚¹å‡»å°±ä¼šæ¯æ¬¡éƒ½è°ƒç”¨ build

![](/assets/images/20230312FlutterLifeCycle/flutter2.gif)

``` sh
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
flutter: ContentWidgetStateçš„ buildè¢«è°ƒç”¨
```

ä¸‹é¢æ˜¯flutterçš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å›¾

![](/assets/images/20230312FlutterLifeCycle/flutter3.webp)

> å›¾ç‰‡å¼•ç”¨è‡ª[Flutter(ä¸ƒ)ä¹‹æœ‰çŠ¶æ€çš„StatefulWidget](https://zhuanlan.zhihu.com/p/83782208),å¦‚æœæœ‰ç‰ˆæƒé—®é¢˜è¯·è”ç³»æˆ‘.

# æ€»ç»“

è¿™ä¸ªç”Ÿå‘½å‘¨æœŸå’ŒiOSä¸­çš„UIViewControllerå¾ˆåƒ.
åˆ©ç”¨å‘¨æœ«çš„æ—¶é—´å­¦ä¹ ä¸€äº›æ–°çš„æŠ€æœ¯,  ç§‰æ‰¿è¾¹æˆ˜æ–—è¾¹å­¦ä¹ çš„æ€åº¦.

[å‚è€ƒ](https://www.geeksforgeeks.org/life-cycle-of-flutter-widgets/)


URL: https://sunyazhou.com/2023/03/whimsical/index.html.md
Published At: 2023-03-08 03:09:00 +0000

# whimsicalæ¨¡å—è®¾è®¡

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# èƒŒæ™¯

åœ¨å¾ˆå¤šå¼€å‘ä¸­ç»å¸¸ä¼šå¯¹æ¨¡å—è¿›è¡ŒæŠ€æœ¯è®¾è®¡,å…¶ä¸­ç”¨åˆ°å¾ˆå¤šç»˜å›¾çš„å·¥å…·,æœ€è¿‘å‘ç°ä¸€ä¸ªå¾ˆå¥½çš„å›½å¤–åœ¨çº¿è®¾è®¡å·¥å…·

[https://whimsical.com/](https://whimsical.com/)  

> éœ€è¦ç§‘å­¦ä¸Šç½‘æ‰èƒ½è®¿é—®.


# æ€»ç»“ 

æ”¶è—å¼€å‘è¿‡ç¨‹ä¸­ä¸€äº›å·¥å…·æ–¹ä¾¿æé«˜å·¥ä½œæ•ˆç‡




URL: https://sunyazhou.com/2023/03/safecast/index.html.md
Published At: 2023-03-06 02:28:00 +0000

# objcä¸­çš„ç±»å‹å®‰å…¨è½¬æ¢

![](/assets/images/20230306SafeCast/cast.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


# CAST

`Cast`ä¹Ÿå«æŸ¯é‡ŒåŒ–,å°±æ˜¯ä¸€ç§ç®€å•çš„ç±»å‹è½¬æ¢è¿‡ç¨‹.åœ¨iOSä¸­æˆ‘ä»¬ç»å¸¸å¯¹æŸç§æ•°æ®ç±»å‹è¿›è¡Œå¼ºåˆ¶è½¬æ¢.æ¯æ¬¡ä¸å¾—ä¸å†™ä¸€äº›è‡ƒè‚¿çš„ä»£ç ,äºæ˜¯å¤§å®¶ä¹ æƒ¯å†™æˆå®æ¥check æŸå®ä¾‹å˜é‡æ˜¯å¦æ•°æ®æŸclass.

ä¸‹é¢ä»£ç åˆ†äº«å‡ºæ¥ç»å¸¸ç”¨åˆ°å® åˆ©ç”¨objcè¿è¡Œæ—¶æä¾›çš„åŠ¨æ€ç‰¹æ€§æ¥å¤„ç†å¸¸ç”¨çš„ç±»å‹check.

``` objc
#ifdef __cplusplus
extern "C" {
#endif

id YZSafeCast(id obj, Class classType);

#ifdef __cplusplus
}
#endif


#ifndef YZ_SAFE_CAST

/// å®‰å…¨ç±»å‹è½¬æ¢(æŸ¯é‡ŒåŒ–)
#define YZ_SAFE_CAST(obj, asClass)  YZSafeCast(obj, [asClass class])

#endif
```

å®ç°æ–‡ä»¶

``` objc
#import <Foundation/Foundation.h>
#import "YZSafeCast.h"

id YZSafeCast(id obj, Class classType)
{
    if ([obj isKindOfClass:classType])
    {
        return obj;
    }
    return classType ? nil : obj;
}

```

ä½¿ç”¨çš„æ—¶å€™å¦‚ä¸‹

``` objc

```

## æ€»ç»“ 

è®°å½•ä¸€äº›å¸¸ç”¨ä¸”æ‰¾çš„æ—¶å€™ä¸æ˜¯é©¬ä¸Šèƒ½æ‰¾åˆ°çš„æŠ€å·§

[demo](https://github.com/sunyazhou13/SafeCastDemo)


URL: https://sunyazhou.com/2023/02/nsdateistoday/index.html.md
Published At: 2023-02-13 11:39:00 +0000

# iOSä¸­NSDateæ˜¯å¦æ˜¯ä»Šå¤©Today

![](/assets/images/20230213NSDateIsToday/date.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



## èƒŒæ™¯

æ¯å¤©çš„iOSå¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå‡ºç°Checkä¸€äº›é€»è¾‘æ˜¯å¦æ¯å¤©ä»…å‘ç”Ÿä¸€æ¬¡,ä¸€èˆ¬æˆ‘ä»¬çš„é€šç”¨æ˜¯ç”¨NSDateåˆ¤æ–­æ˜¯å¦æ˜¯ä»Šå¤©,ç„¶åå¯¹NSDateåšæŒä¹…åŒ–å­˜å‚¨ eg: `MMKV`ã€æˆ–è€…`NSUserDefault`,ä½†éšç€å·¥ç¨‹çš„æ—¥æ¸åºå¤§,æˆ‘ä»¬é€æ¸å…³æ³¨ä¸€äº›ç»†èŠ‚å’Œä»£ç 
çš„è€—æ—¶.

é¦–å…ˆæ¥çœ‹ä¸€ä¸‹å‡ ç§ä¸åŒçš„é€»è¾‘åˆ¤æ–­`NSDate`isTodayçš„ä»£ç å®ç°

* 1.ç³»ç»ŸNSCalendaræ—¥å†

``` objc
NSDate *date = [NSDate date]; //è¿™é‡Œå–å½“å‰æ—¥æœŸ,æ­£å¸¸åº”è¯¥åšä¸ºå‚æ•°ä¼ å…¥NSDate
BOOL inToday = [[NSCalendar currentCalendar] isDateInToday:date]
```

* 2.å¢åŠ æ›´å¤šå‚æ•°è°ƒç”¨NSCalendar

``` objc
- (BOOL)isToday {
    NSCalendar *cal = [NSCalendar currentCalendar];
    NSDateComponents *components = [cal components:(NSCalendarUnitEra|NSCalendarUnitYear|NSCalendarUnitMonth|NSCalendarUnitDay) fromDate:[NSDate date]];
    NSDate *today = [cal dateFromComponents:components];
    components = [cal components:(NSCalendarUnitEra|NSCalendarUnitYear|NSCalendarUnitMonth|NSCalendarUnitDay) fromDate:self];
    NSDate *otherDate = [cal dateFromComponents:components];
    return [today isEqualToDate:otherDate];
}
```

* 3.é€šè¿‡æ¯”è¾ƒæ—¶é—´

``` objc
- (BOOL)isTodayWithDate:(NSDate *)date {
    NSDate *selfBegin = [self dateByBeginDay];
    NSDate *dateBegin = [date dateByBeginDay];
    if (fabs([selfBegin timeIntervalSinceDate:dateBegin]) < 1.0e-6) {
        return YES;
    }
    return NO;
}

- (NSDate *)dateByBeginDay {
    //å‰ä¸€å¤©çš„ç»“æŸ  16:00ä¸ºç»“æŸ  8å°æ—¶æ—¶åŒº  ä»Šå¤©å¼€å§‹ ä¹Ÿå°±æ˜¯è¯´ å‰ä¸€å¤©çš„00:00:00
    unsigned int flags      = NSCalendarUnitYear | NSCalendarUnitMonth | NSCalendarUnitDay | NSCalendarUnitHour | NSCalendarUnitMinute | NSCalendarUnitSecond;
    NSDateComponents *parts = [[NSCalendar currentCalendar] components:flags fromDate:self];
    [parts setHour:0];
    [parts setMinute:0];
    [parts setSecond:0];
    return [[NSCalendar currentCalendar] dateFromComponents:parts];
}
```

è¿™å‡ ç§éƒ½æ˜¯æ£€æµ‹æ˜¯å¦æ˜¯å½“å¤©çš„ä»£ç 

#### æ•…äº‹çš„å¼€å§‹

ä»Šå¤©å·¥ä½œä¸­Reviewä»£ç  å¯¹NSDateçš„æ£€æŸ¥åˆ¤æ–­æ˜¯å¦æ˜¯todayçš„è€—æ—¶é—®é¢˜äº§ç”Ÿäº†åˆ†æ­§,å·¥ç¨‹å¸ˆè§£å†³é—®é¢˜çš„æ–¹å¼å¾ˆç®€å•,å®è·µä»£ç è¯æ˜æ˜¯å¦è€—æ—¶.

æˆ‘é€‰ä¸­äº† ç¬¬ä¸€ç§å’Œç¬¬ä¸‰ç§åšæµ‹è¯•.ä»£ç å¦‚ä¸‹:

![](/assets/images/20230213NSDateIsToday/result.webp)

``` sh
2023-02-13 19:59:08.855078+0800 NSDateSpeedDemo[1837:197213] NSCalendarè€—æ—¶:0.011064
2023-02-13 19:59:11.108141+0800 NSDateSpeedDemo[1837:197213] NSDate (YZUtils)è€—æ—¶:0.030793
```

å®Œæ•´çš„ä»£ç å¦‚ä¸‹:

``` objc
- (IBAction)didSysDateClick:(id)sender {
    NSDate *date = [NSDate date];
    CFTimeInterval startTime = CACurrentMediaTime();
    for (int i = 0; i < 1000; i++) {
        __unused BOOL inToday = [[NSCalendar currentCalendar] isDateInToday:date];
    }
    CFTimeInterval endTime = CACurrentMediaTime();
    NSString *log = [NSString stringWithFormat:@"NSCalendarè€—æ—¶:%f",endTime - startTime];
    NSLog(@"%@", log);
    self.l1.text = log;
    
}

- (IBAction)didOnCusDateClick:(id)sender {
    NSDate *date = [NSDate date];
    CFTimeInterval startTime = CACurrentMediaTime();
    for (int i = 0; i < 1000; i++) {
        __unused BOOL inToday = [date isTodayWithDate:date];
        self.l2.text = [NSString stringWithFormat:@"SysDate:%d",i];
    }
    CFTimeInterval endTime = CACurrentMediaTime();
    NSString *log = [NSString stringWithFormat:@"NSDate (YZUtils)è€—æ—¶:%f",endTime - startTime];
    NSLog(@"%@", log);
    self.l2.text = log;
}

```

# æ€»ç»“

è¿™æ—¶é—´ä¸Šè¿˜æ˜¯å·®è‡³å°‘1xå·¦å³,å¦‚æœé¢‘ç¹çš„æ“ä½œç¡®å®ä¼šå½±å“ä¸€äº›æ€§èƒ½.


[demo](https://github.com/sunyazhou13/NSDateSpeedDemo)


URL: https://sunyazhou.com/2023/02/webpenhancement/index.html.md
Published At: 2023-02-05 09:09:00 +0000

# åšå®¢çš„å›¾ç‰‡èµ„æºä¼˜åŒ–

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯

æœ€è¿‘å‘¨æœ«æœ‰ç‚¹æ—¶é—´,å¯¹åšå®¢çš„èµ„æºå›¾ç‰‡è¿›è¡Œäº†æ•´ä½“ä¼˜åŒ–,ä¼˜åŒ–åå›¾ç‰‡èµ„æºå‡å°‘äº†ä¸€åŠ.è¦ä¸ç„¶ä»¥ç›®å‰æˆ‘å†™æ–‡ç« çš„é€Ÿåº¦,ä¸å‡ºå‡ å¹´è¿åŒèµ„æºå¾ˆå¿«å°±ä¼šè¶…è¿‡1G.å¦‚æœè¶…è¿‡1Gçš„è¯github pageså°†åœæ­¢å¯¹ä»“åº“æä¾›æ”¯æŒ,éœ€è¦é¢å¤–è´­ä¹°ä»“åº“ç©ºé—´.

å‰ä¸€é˜µå¶ç„¶å‘ç°è‡ªå·±çš„åšå®¢å›¾ç‰‡å¤ªå¤šäº†è¿è¡Œèµ·æ¥æ…¢ åŠ è½½ä¹Ÿæ…¢,èµ„æºæ–‡ä»¶ä¼˜åŒ–å‡è´Ÿé€æ¸æˆä¸ºè¿«åœ¨çœ‰ç«çš„ç„¦è™‘ä»»åŠ¡.

ç„¶åå°è¯•ä¸€ä¸‹webpå›¾ç‰‡å’Œpngå¯¹æ¯”å‘ç°,ç®€ç›´å°±æ˜¯é™ç»´æ‰“å‡»,é€šç”¨çš„å›¾ç‰‡,åœ¨webpä¸‹27k,åœ¨pngä¸‹80k+,è¿™å®Œå…¨å°±æ˜¯å‡ ä½•å€æ•°çš„ä¼˜åŒ–.å†å›å¤´çœ‹çœ‹ç”»è´¨,è™½ç„¶è‰²å½©æ²¡æœ‰ä¹‹å‰é²œè‰³äº†ä¸è¿‡ä¹Ÿä¸æ˜¯ä¸€äº›é‡è¦çš„å›¾ç‰‡,æ²¡æœ‰å¿…è¦æå¾—é‚£ä¹ˆé«˜æ¸….äºæ˜¯èŒç”Ÿä¼˜åŒ–åšå®¢èµ„æºçš„æƒ³æ³•.

æƒ³æ³•æœ‰äº† å¯æ˜¯é¢å¯¹çš„æ˜¯è‡ªå·±å†™äº†å¥½å¤šå¹´çš„èµ„æº éš¾ä¸æˆè¦æŒ¨ä¸ªæ›¿æ¢å—ï¼Ÿ

ä½œä¸ºNBçš„å·¥ç¨‹å¸ˆå¿…é¡»å¾—ç”¨è„šæœ¬æŠŠæ‰€æœ‰çš„å›¾ç‰‡è¿›è¡Œæ‰¹å¤„ç†,å…¨éƒ¨è½¬æˆ webp

äºæ˜¯æˆ‘ä½¿ç”¨ brew å®‰è£…äº† libwebpçš„åº“

``` sh
brew install jpeg-turbo
brew install libpng
brew install libtiff
brew install webp
```

ç»è¿‡ä¸€é¡¿æ“ä½œç»ˆäºå®‰è£…å¥½äº† webpå‘½ä»¤

å¦‚æœæŠŠå…¶ä»–å›¾ç‰‡è½¬webp åº”è¯¥ä½¿ç”¨`cwebp`å‘½ä»¤(codec ç¼–ç ),åä¹‹`dwebp`å°±æ˜¯decodecè§£ç 

å·¥å…·å®Œæˆåå¼€å§‹æ•´æ´»

`touch` ä¸€ä¸ª`webp.sh`

éå†æ‰€æœ‰èµ„æºç›®å½• ç„¶åæ‰§è¡Œè½¬ç æ“ä½œ,è½¬å®Œå.é¡ºä¾¿æŠŠä¹‹å‰çš„`png`,`jpg`ç­‰é€šé€šåˆ é™¤æ‰.

``` sh
#!/bin/sh

for dir in `ls .` 
do   
    if [ -d $dir ]   
    then     
        echo $dir     
        cd $dir     
            `for file in *.png *.jp*g *.PNG ; do cwebp -q 80 "$file" -o "${file%.*}.webp"; done`
            rm -rf *.png *.jp*g 
        cd ..   
    fi
done

#è¯»å–ç¬¬ä¸€ä¸ªå‚æ•°
read_dir $1

#for file in *.png *.jp*g *.PNG ; do cwebp -q 80 "$file" -o "${file%.*}.webp"; done

```

è¿™ä¸ªè„šæœ¬æ”¾åˆ°`/assets/images`ç›®å½•æ‰§è¡Œ

![](/assets/images/20230205WebpEnhancement/webp1.webp)

å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ‰¾åˆ°å·¦å³postæ–‡ç« çš„markdownç»Ÿä¸€æ›´æ”¹å›¾ç‰‡åç¼€

![](/assets/images/20230205WebpEnhancement/webp2.webp)

ç„¶åé€šè¿‡sourceTreeè¿›è¡Œæœ€åçš„æ ¡å¯¹ reviewä¸€éæ”¹åŠ¨é˜²æ­¢æ”¹é”™,è¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«,è™½ç„¶å¾ˆå¤š ä½†æ˜¯å›¾ç‰‡çš„åç¼€ä¿®æ”¹ååˆ†ç®€å•å®¹æ˜“è¯†åˆ«.
![](/assets/images/20230205WebpEnhancement/webp3.webp)

æœ€åbuildåšå®¢ éƒ¨ç½²åˆ°è¿œç«¯å³å¯

# æ€»ç»“

å°±ç›®å‰è¿™ä¸ªæ¡ˆä¾‹,æ‰‹åŠ¨æ”¹è‚¯å®šæ˜¯ååˆ†ç´¯å¹¶ä¸”å…¨æ˜¯ä½“åŠ›æ´»,ä¸€å®šè¦å­¦ä¼šé©¾é©­æŠ€æœ¯,ç”¨æŠ€æœ¯å»è§£å†³å®é™…é—®é¢˜.


URL: https://sunyazhou.com/2023/02/jekyllpost/index.html.md
Published At: 2023-02-02 02:21:00 +0000

# å¦‚ä½•ä½¿ç”¨jekyllå‘å¸ƒä¸€ç¯‡æ–‡ç« 

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## jekyll 

æˆ‘çš„åšå®¢å¼€å§‹ä½¿ç”¨çš„æ˜¯hexo,åæ¥[`å–µç¥`](https://onevcat.com/) æŠŠåšå®¢æ¢æˆä»¥jekyllçš„å½¢å¼,æˆ‘è¿˜æ˜¯å¾ˆå–œæ¬¢çš„.å¯æ˜¯ä¹‹å‰hexoè¦å†™ä¸€ç¯‡æ–‡ç« ç›´æ¥å°±å¯ä»¥ç”¨

``` sh
hexo new "202300202XXXPaper"

```
çš„å½¢å¼ é€šè¿‡æ¨¡ç‰ˆç”Ÿæˆä¸€ä¸ªmarkdownæ–‡ä»¶.

> å…·ä½“ä½¿ç”¨ä¸€çœ‹çœ‹[hexo æŒ‡ä»¤](https://hexo.io/zh-cn/docs/commands.html)


ç„¶è€Œæ–°çš„[https://github.com/cotes2020/jekyll-theme-chirpy/ ä¸»é¢˜](https://github.com/cotes2020/jekyll-theme-chirpy/) åœ¨å–µå¤§çš„ç®€åŒ–ç‰ˆæœ¬é‡Œé¢è¿˜æ˜¯æ¯”è¾ƒç®€å•å®ç”¨çš„,å”¯ç‹¬ç¼ºå°‘äº† å¦‚ä½•å¿«é€Ÿå†™æ–‡ç« çš„æ“ä½œ.

ç»è¿‡å’Œå–µç¥é‚®ä»¶è¯·æ•™

![](/assets/images/20230202JekyllPost/email.webp)

å–µç¥ä¸ä½†å›å¤äº†æˆ‘å¹¶è¡¨ç¤º ä»–ä¸æ˜¯å¾ˆç»å¸¸å†™æ–‡ç« ,è¿™ç§æ“ä½œä»–éƒ½æ˜¯å¤åˆ¶ä¸€ä¸‹åŸæ¥çš„ä¹Ÿä¸éº»çƒ¦.é‚®ä»¶æœ«å°¾å–µç¥ç»™å‡ºæ¥ä¸€ä¸ªéå¸¸å®ç”¨çš„ stackoverflowçš„ç­”æ¡ˆ.

![](/assets/images/20230202JekyllPost/answer.webp)

åœ¨æˆ‘çš„åšå®¢ä¸­æœ‰ä¸€ä¸ª`Gemfile`æ–‡ä»¶ 

``` sh
source "https://rubygems.org"

gem "jekyll", ">=3.8.6"

# Official Plugins
group :jekyll_plugins do
  gem "jekyll-paginate"
  gem "jekyll-redirect-from"
  gem "jekyll-seo-tag", "~> 2.6.1"
  gem 'jekyll-compose' //æ–°å¢è¿™ä¸ª
end

group :test do
  gem "html-proofer"
end

```

ç„¶åæ‰§è¡Œä¸€æ¬¡

``` sh
bundle install
```
è¿™æ ·ä¼šä¿è¯æ‰€éœ€è¦çš„ç±»åº“å…¨éƒ¨load, è¿™é‡Œå¯ä»¥é…ç½® rubychinaçš„é•œåƒæˆ–è€…ç§‘å­¦ä¸Šç½‘

å‰©ä¸‹çš„å°±æ˜¯æ¯æ¬¡å‘æ–‡ç« æ‰§è¡Œ

``` sh
$ bundle exec jekyll post "My New Post"
```

> `$`è¿™ä¸ªç¬¦å·ä¸è¦å¤åˆ¶å“ˆ,è¿™æ˜¯è¡¨ç¤ºä½ ç”¨shellç»ˆç«¯æ‰§è¡Œçš„å‘½ä»¤. 

ç”Ÿæˆåè¿™ç©æ„ä¼šè‡ªåŠ¨æ ‡è¯†å¹´æœˆæ ¼å¼

``` sh
bundle exec jekyll post "jekyllpost"
```

![](/assets/images/20230202JekyllPost/post.webp)

### ç–‘é—®

è¿™é‡Œç”Ÿæˆçš„markdownæ²¡æœ‰hexoä¸­çš„æ¨¡ç‰ˆé‚£æ ·èƒ½è‡ªå®šä¹‰,æˆ‘æ²¡æ‰¾åˆ° å¦‚æœä½ æ„Ÿå…´è¶£å¯ä»¥ä¸€èµ·ç ”ç©¶ä¸€ä¸‹.

[Why isn't there a "jekyll post" command to create posts like in hexo?](https://stackoverflow.com/questions/43416113/why-isnt-there-a-jekyll-post-command-to-create-posts-like-in-hexo)

# æ€»ç»“

è¿™ä¸ªå‘½ä»¤å·¥å…·éå¸¸é€‚åˆæˆ‘è¿™ç§ç»å¸¸å‘è¡¨æ–‡ç« çš„ä½¿ç”¨,å¸Œæœ›èƒ½å¸®åŠ©ä¸€äº›ä½¿ç”¨jekyllçš„ä¼™ä¼´.





URL: https://sunyazhou.com/2023/02/swift-defer/index.html.md
Published At: 2023-02-01 02:10:58 +0000

# Swiftä¸­çš„deferå…³é”®å­—

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## deferå…³é”®å­—

åœ¨swiftä¸­æœ‰ä¸€ä¸ªå…³é”®å­—éå¸¸ ç±»ä¼¼ try catch finallyä¸­çš„`finally`,åœ¨ä¸€ä¸ªä»£ç å—ä¸­æ‰§è¡Œå®Œæˆå æ‰§è¡Œæœ€åçš„æ”¶å°¾ä»£ç å®Œæˆä¸€äº›æ”¶å°¾å·¥ä½œ.

ä¾‹å¦‚: 

æ¸…ç†å·¥ä½œã€å›æ”¶èµ„æº
è·Ÿ swift æ–‡æ¡£ä¸¾çš„ä¾‹å­ç±»ä¼¼ï¼Œdeferä¸€ä¸ªå¾ˆé€‚åˆçš„ä½¿ç”¨åœºæ™¯å°±æ˜¯ç”¨æ¥åšæ¸…ç†å·¥ä½œã€‚æ–‡ä»¶æ“ä½œå°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼š
å…³é—­æ–‡ä»¶

``` swift
func foo() {
  let fileDescriptor = open(url.path, O_EVTONLY)
  defer {
    close(fileDescriptor)
  }
  // use fileDescriptor...
}
```

åœ¨ä¾‹å¦‚ï¼š

dealloc æ‰‹åŠ¨åˆ†é…çš„ç©ºé—´,æœ€åé”€æ¯å†…å­˜

``` swift
func foo() {
  let valuePointer = UnsafeMutablePointer<T>.allocate(capacity: 1)
  defer {
    valuePointer.deallocate(capacity: 1)
  }
  // use pointer...
}
```

#### ç®€å•ç†è§£

æˆ‘å¯ä»¥ç®€å•çš„æŠŠ`defer`å…³é”®å­—ç†è§£ä¸º returnä¹‹å‰è¦è°ƒç”¨çš„æœ€åä¸€ä¸ªå‡½æ•°.æ— è®ºæ˜¯switchè¿˜æ˜¯å…¶å®ƒæ¡ä»¶å¯¼è‡´å‡½æ•°returnè¿”å›,å¦‚æœæˆ‘ä»¬æƒ³åœ¨returnä¹‹å‰åšä¸€äº›æ”¶å°¾å·¥ä½œé‚£ä¹ˆ`defer`éå¸¸åˆé€‚.

``` swift
func foo() {
	...
	defer {
		//è¿™é‡Œä»£ç å—åœ¨returnä¹‹å‰è°ƒç”¨
	}
	...
	return;
}
```

å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¤šä¸ªdeferçš„è¯ ä¼šæŒ‰ç…§ deferå‹æ ˆé¡ºåºæ‰§è¡Œ.éä¸è¦ä¸å»ºè®®è¦åŠ å¤šä¸ª`defer`

``` swift 
func foo() {
  print("1")
  defer {
    print("6")
  }
  print("2")
  defer {
    print("5")
  }
  print("3")
  defer {
    print("4")
  }
}
```

ä¸€ä¸ª scope å¯ä»¥æœ‰å¤šä¸ª deferï¼Œé¡ºåºæ˜¯åƒæ ˆä¸€æ ·å€’ç€æ‰§è¡Œçš„ï¼šæ¯é‡åˆ°ä¸€ä¸ª defer å°±åƒå‹è¿›ä¸€ä¸ªæ ˆé‡Œï¼Œåˆ° scope ç»“æŸçš„æ—¶å€™ï¼Œåè¿›æ ˆçš„å…ˆæ‰§è¡Œã€‚å¦‚ä¸‹é¢çš„ä»£ç ï¼Œä¼šæŒ‰ 1ã€2ã€3ã€4ã€5ã€6 çš„é¡ºåº print å‡ºæ¥ã€‚


## å®˜æ–¹å®šä¹‰

> You use a defer statement to execute a set of statements just before code execution leaves the current block of code. This statement lets you do any necessary cleanup that should be performed regardless of how execution leaves the current block of codeâ€”whether it leaves because an error was thrown or because of a statement such as return or break. For example, you can use a defer statement to ensure that file descriptors are closed and manually allocated memory is freed.

> A defer statement defers execution until the current scope is exited. This statement consists of the defer keyword and the statements to be executed later. The deferred statements may not contain any code that would transfer control out of the statements, such as a break or a return statement, or by throwing an error. Deferred actions are executed in the reverse of the order that theyâ€™re written in your source code. That is, the code in the first defer statement executes last, the code in the second defer statement executes second to last, and so on. The last defer statement in source code order executes first.

``` swift
func processFile(filename: String) throws {
    if exists(filename) {
        let file = open(filename)
        defer {
            close(file)
        }
        while let line = try file.readline() {
            // Work with the file.
        }
        // close(file) is called here, at the end of the scope.
    }
}
```

The above example uses a defer statement to ensure that the `open(_:)` function has a corresponding call to `close(_:)`.

> You can use a defer statement even when no error handling code is involved.


[Specifying Cleanup Actions](https://docs.swift.org/swift-book/LanguageGuide/ErrorHandling.html)

## æ€»ç»“

2023å¹´swiftèƒ½å¤šå†™ä¸€äº›äº†,å¸Œæœ›è®°å½•ä¸€äº›ç»å¸¸å¿˜è®°çš„å†…å®¹,æ–¹ä¾¿ä½¿ç”¨æ—¶åŠæ—¶ç¿»é˜…æŸ¥æ‰¾.



URL: https://sunyazhou.com/2022/12/FinalSummary/index.html.md
Published At: 2022-12-24 06:54:00 +0000

# 2022å¹´ç»ˆæ€»ç»“

![](/assets/images/20221231FinalSummary/2022F1.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


``` txt
å¹´ç»ˆå°†è‡³,ä½œä¸šå‚¬äº¤.  
å·å¸ä¸´é—¨,ç—…æ¯’è¢«ç§’.  
è¯¸äº‹çš†é¡º,æ—¶å…‰æ¸å°‘.  
åŠ±ç²¾å›¾æ²»,åœ°ä¸Šé€é¥.  
```

è¿™æ˜¯åšæŒå†™å¹´ç»ˆæ€»ç»“çš„ç¬¬5ä¸ªå¹´å¤´äº†,å¦‚æœéè¦ç»™ä»Šå¹´çš„æ€»ç»“å†™ä¸ªä¸»é¢˜çš„è¯æˆ‘è‚¤æµ…çš„è®¤ä¸º`æ¯å¤©éƒ½æ´»åœ¨è‡ªæˆ‘å¦å®šåçš„ä¸æ–­å¦¥åä¸­çš„ä¸€å¹´`æœ€ä¸ºè´´åˆ‡.

* [2021å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2021/12/FinalSummary/)
* [2020å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2020/12/FinalSummary/)
* [2019å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2019/12/FinalSummary/)
* [2018å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2018/12/FinalSummary/)
* [2017å¹´ç»ˆæ€»ç»“](https://www.sunyazhou.com/2017/12/FinalSummary/)

> çœŸçš„æ˜¯æœ‰é‡çš„ç§¯ç´¯ï¼Œæ‰æœ‰è´¨çš„é£è·ƒ.

## 2022å›é¡¾

* å…³äºç”Ÿæ´»
* å…³äºå·¥ä½œ
* å…³äºå­¦ä¹ 
* å…³äºç†æƒ³
* å…³äºå¥½ç‰©

## å…³äºç”Ÿæ´»

ç–«æƒ…3å¹´å¤šäº†,ç›´åˆ°è¿™ä¸ªæœˆåˆæ‰çœŸæ­£çš„æ”¾å¼€,ç»è¿‡3é’ˆç–«è‹—å,æ”¾å¼€çš„ç¬¬ä¸€å‘¨ä¸å¹¸ä¸­æ‹›.è¿˜å¥½åº·å¤çš„å¾ˆå¿«.  
2022å¹´çš„æ˜¥èŠ‚æ˜¯åœ¨åŒ—äº¬è¿‡çš„,è¿™æ˜¯è‡ªå‚åŠ å·¥ä½œä»¥æ¥å”¯ä¸€ä¸€æ¬¡è¢«ç–«æƒ…é€¼è¿«ä¸å¾—ä¸åœ¨åŒ—äº¬è¿‡å¹´.è¯´åˆ°åº•è¿˜æ˜¯å› ä¸ºç©·äººçš„ä¸–ç•Œå¤„å¤„éƒ½æ˜¯å›°éš¾.å°±åœ¨ä¸æ­¤åŒæ—¶ ä¿„ç½—æ–¯å’Œä¹Œå…‹å…°å±•å¼€äº†æ—·æ—¥æŒä¹…çš„æˆ˜äº‰.
æ­¤æ—¶æ­¤åˆ»2022å¹´12æœˆ24æ—¥æ™š,æˆ˜äº‰ä»åœ¨ç»§ç»­,éšç€é€æ­¥æ”¾å¼€çš„ç–«æƒ…ç®¡æ§,ç–«æƒ…ç»ˆå°†è¢«æ¶ˆç­.å¯æ˜¯è¿™æˆ˜äº‰ä½•æ—¥ä¼‘æˆ˜ä¸Šä¸æ˜æœ—,ç¾å›½çš„`ç‰¹æœ—æ™®`èµ°äº†,æ¥äº†`æ‹œç™»biden`å½“æ€»ç»Ÿ,è¿™è€å¤´è¿˜çœŸä¸å¦‚ç‰¹æœ—æ™®é‚£ä¸¤æŠŠåˆ·å­,ä½†æ˜¯ä»–å…¶ä¸­çš„ä¸€æŠŠåˆ·å­å‘ä¸­å›½åˆ·æ¥,å¦ä¸€æŠŠåˆ·å­å‘ç€åŒ—çº¦ä¿„ç½—æ–¯åˆ·å».  

![](/assets/images/20221231FinalSummary/2022Biden.webp)
> æ‹œç™»è‹±æ–‡åå­—biden,ä»¥ä¸‹ç»Ÿç§°biden

åœ¨æ­¤ç§æ“ä½œä¹‹ä¸‹,æˆ‘ä»¬çš„æ±½æ²¹ä»·æ ¼ä»å¹³å¸¸çš„6.xå…ƒæ¶¨åˆ°ç›®å‰çš„8.xå…ƒ(92å·æ±½æ²¹),è€Œä¸”ä»2æœˆä¿„ä¹Œå¼€æˆ˜åˆ°ç°åœ¨ä»ç„¶æ²¡æœ‰ä¸‹é™çš„è¶‹åŠ¿.    
æˆ‘çš„ç”Ÿæ´»å—åˆ°æˆ–å¤šæˆ–å°‘çš„å½±å“,å„ç§ç§‘æŠ€å…¬å¸é›†ä½“çš„å£å·æ°¸è¿œéƒ½æ˜¯ä¸€ä¸ª`é™æœ¬å¢æ•ˆ`,è£å‘˜çš„å£°æµªéåœ°å“€åš,æˆ‘æ‰€å¤„çš„ITè¡Œä¸šæ˜¯é‡ç¾åŒº.åˆšå›åŒ—äº¬æ²¡å¤šä¹…åˆ°ç›®å‰éƒ½å·²ç»æ¢äº†ä¸‰å®¶ä¸œå®¶äº†.  
ç»™æˆ‘çš„æ„Ÿå—æ˜¯è¿™æ˜¯æ—¶ä»£çš„æµªæ½®,å½“åˆçš„é€‰æ‹©å¯èƒ½å°†ä¼šå¯¼è‡´ç¾éš¾å‘ç”Ÿçš„å¯èƒ½æ€§æ¦‚ç‡é«˜ä½çš„å·®åˆ«,ä½†å¹¶ä¸ä¼šå†³å®šæœ€ç»ˆçš„ç»“æœ.åœ¨è¿™ç§æƒ…å†µä¸‹çš„å®ä½“ç»æµé­åˆ°äº†å‰æ‰€æœªæœ‰çš„æ‰“å‡»,ç»æµä¸æ™¯æ°”çš„åŒæ—¶å„è¡Œå„ä¸šéƒ½åœ¨æ¸å°‘è¿è¥æˆæœ¬,èƒ½åœ¨è¿™ç§æ—¶ä»£çš„èƒŒæ™¯ä¸‹æ´»ä¸‹å»çš„å°±æ˜¯ç‹è€….  
äºæ˜¯å¼•å‘äº†æˆ‘å¯¹è¿™ä¸‰å¹´å¤šçš„ç–«æƒ…æ¨¡å¼å’Œå¤„å¢ƒäº§ç”Ÿäº†æ€è€ƒ,å¾—å‡ºäº†ä¸€ä¸ªç»“è®º-`è¿™å‡ å¹´èƒ½æ´»çš„ä½“é¢å°±å¥½,å·¥èµ„å¤šå°‘ä¸é‡è¦,æ´»ä¸‹å»å¾ˆé‡è¦`,ç”Ÿæ´»æ€»æ˜¯å–œå¿§å‚åŠ,å¾—æŠ»æ‚ ç€è¿‡.

è¿™ç®€ç›´å°±æ˜¯å¯¹è‡ªå·±çš„å„ç§å¦å®šåçš„æ„Ÿå—,è¿™ä¸æ˜¯ç”Ÿæ´»`å¥½ä¸å¥½è¿‡`çš„é—®é¢˜,æ˜¯ç”Ÿæ´»`èƒ½ä¸èƒ½è¿‡`çš„é—®é¢˜.

å›åˆ°bidençš„ç¬¬ä¸€æŠŠåˆ·å­æŒ¥å‘ä¸­å›½å,æŠ•èµ„çš„å„ç§èµ„æœ¬æ’¤èµ„çš„æ’¤èµ„,å¯¼è‡´å„ç§ç§‘æŠ€å…¬å¸è‚¡ç¥¨ç‹‚è·Œ,é™è–ªè£å‘˜éƒ½åœ¨è·¯ä¸Š.è®©æˆ‘ä¸å¾—ä¸ä½©æœbidenè¿™è€å¤´çš„åˆ·å­ç¡®å®æŒºçŒ›,åˆ·å‡ºäº†æ–°å¢ƒç•Œçš„åŒæ—¶ä¹Ÿå¹²æ®‹äº†ç¾å›½çš„ç§‘æŠ€å·¨å¤´,ä»twitterè¢«é©¬æ–¯å…‹(musk)æ”¶è´­åè£å‘˜75%,ç´§éšå…¶åçš„æ˜¯Metaå°±æ˜¯é‚£Facebook,å†åæ˜¯googleå’Œå„ç§æ›¾ç»é£å…‰æ— é™çš„ç¾å›½ç§‘æŠ€å…¬å¸.

è¿™è½®æ“ä½œå®Œåbidençš„åˆ·å­åˆ·å®Œå¢™è„çš„åŒæ—¶è¿˜æ•´è‡ªå·±ä¸€èº«æ²¹æ¼†,çœŸæ˜¯åˆ·çš„æ¼‚äº®.

#### çºªå¿µå›¾çµ

åœ¨ä¹‹å‰æˆ‘æ‰¿è¯ºè¿‡è‹±é•‘å‘è¡Œå,æˆ‘ä¼šä¹°å‡ å¼ æ”¶è—ç”¨ä»¥çºªå¿µæ¨åŠ¨è®¡ç®—æœºè¡Œä¸šå‘å±•çš„å…ˆé©±-é˜¿å…°å›¾çµ.

![](/assets/images/20221231FinalSummary/2022F2.webp)

æ˜¯ä»–é¼“åŠ±äº†æˆ‘çš„çµé­‚,è®©æˆ‘å¯¹è®¡ç®—æœºç§‘å­¦çš„å‘å±•ä¸æ–­å¼€æ‹“è¿›å–,åŠªåŠ›é©æ–°.

ä»Šå¹´å¤å¤©å»æ‹›å•†é“¶è¡Œ,é¢„çº¦å¾—åˆ°äº†2å¼ å´­æ–°çš„50è‹±é•‘,æ­£é¢æ˜¯è‹±å›½å¥³ç‹,èƒŒé¢æ˜¯è¿™ä½è®¡ç®—æœºå…ˆé©±çš„çµé­‚äººç‰©å›¾çµ.è¿™è‹±é•‘ç¡®å®æ¯”äººæ°‘å¸è´¨é‡å¥½,ä¸Šè¾¹è¿˜æœ‰èŠ¯ç‰‡ç”µè·¯.å’±ä¹Ÿä¸çŸ¥é“å¹²å•¥ç”¨çš„åæ­£æ˜¯400å¤šRMBå…‘æ¢ä¸€å¼ é¢å€¼50è‹±é•‘.

çœ‹åˆ°è¿™é‡Œçš„å„ä½è§‰å¾—æˆ‘çš„å¹´ç»ˆæ€»ç»“è¿˜ç®—æœ‰é‚£ä¹ˆä¸€ç‚¹ä»·å€¼çš„è¯è¯·å¸®å¿™è½¬å‘,æˆ‘æ‰“ç®—æŠŠå¦ä¸€å¼ 50è‹±é•‘é€å‡ºç»™å…³æ³¨æˆ‘çš„åšå®¢çš„å“¥å‡ ä¸ª,ç”¨ä»¥å‹‰åŠ±å„ä½è®©è®¡ç®—æœºè¡Œä¸šå‘å±•çš„æ›´å¥½.å½“ç„¶è¿™ä¸ªæ“ä½œè¦çœ‹å“ªä½è€å“¥å­¦è¯†é«˜æ·±æŠ€æœ¯å“è¶Šåšå®¢å‡ºä¼—å¯¹æŠ€æœ¯çš„å‘å±•æœ‰å“è¶Šå¾—è´¡çŒ®è€…å“ˆ.

#### åšèœ

ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™èµ·å…»æˆäº†ä¸€ä¸ªä¹ æƒ¯,é—²ç€æ— èŠçš„æ—¶å€™å–œæ¬¢åçœè‡ªå·±çš„å„ç§ç¼ºé™·,ç„¶åä¸æ–­æ€»ç»“é”™è¯¯å’Œä¸è¶³.ä¸ºäº†éªŒè¯è‡ªå·±æ˜¯ä¸æ˜¯ç§‰æ‰¿`è¡Œèƒœäºè¨€`çš„ç†å¿µ.ä»ä¸€é“ä¸œåŒ—æœ€è€ƒéªŒæŠ€æœ¯çš„èœå¼€å§‹ç»ƒèµ·-é”…åŒ…è‚‰.

æ€ä¹ˆæ‰ç®—æ˜¯å®Œæ•´çš„åšå¥½å‘¢ï¼Ÿ

æˆ‘åœ¨æŸè§†é¢‘appä¸Šåå¤è§‚çœ‹å‡ ä¸ªå–œæ¬¢åšèœåˆ†äº«çš„åšä¸»,ç»è¿‡åå¤10æ¬¡çš„è§‚çœ‹å’Œæ€»ç»“æˆ‘å‘ç°,ä¸œåŒ—èœè¿˜å¾—ä¸œåŒ—å¨å¸ˆåš.

é‚£ä»€ä¹ˆæ‰æ˜¯å¥½èœçš„æ ‡å‡†å‘¢?

å¥½åƒå°±æ˜¯æ ‡å‡†.ç°åœ¨éƒ½æµè¡Œè€èœæ–°åš,æœ‰çš„è¯´é”…åŒ…è‚‰æ©™æ±å¥½åƒ,æœ‰çš„è¯´ç•ªèŒ„æ±å¥½åƒ,æœ€åŸå§‹çš„é”…åŒ…è‚‰åšæ³•æ˜¯å’¸é²œå£çš„ä¸æ˜¯ç³–é†‹å£çš„.ä¸ç®¡å•¥æ±å•¥å£å‘³,æ‚¨è§‰å¾—å¥½åƒå°±å¥½.

è¿™æ˜¯ç¬¬ä¸€æ¬¡è¯•éªŒçš„æ ·å­.  
![](/assets/images/20221231FinalSummary/2022F3.webp)

è¿™æ˜¯ç¬¬äºŒæ¬¡å®éªŒçš„æ ·å­.  
![](/assets/images/20221231FinalSummary/2022F4.webp)

...

ä¸è¡Œäº†åœ¨å¾€åå°±æ²¡å‘å±•ç¤ºäº†.ä¸è¿‡ç»è¿‡ç†Ÿèƒ½ç”Ÿå·§çš„ä¸æ–­ç»ƒä¹ å‘ç°ï¼Œè¿™é“èœæˆ‘æœ‰ä¿¡å¿ƒèƒ½åšåˆ°å®Œç¾,å°±æ˜¯è¿™èœå¤ªè´¹ææ–™,é£Ÿæä¹Ÿç€å®ä¸ä¾¿å®œ,è¦æ˜¯æœ‰è¶³å¤Ÿçš„é£Ÿæç»ƒæ‰‹é‚£åšå¥½å®ƒå°±æ˜¯æ—¶é—´çš„é—®é¢˜.

ç»è¿‡åŠ¨æ‰‹å®è·µæˆ‘åšä¸ªæŠ€æœ¯æ€»ç»“:

* ç³Š(hÃºå››å£°)çš„è°ƒåˆ¶,æœ€å¥½æå‰æ³¡å¥½æ°´æ·€ç²‰(åœŸè±†æ·€ç²‰),ç„¶åå¿…é¡»è¦è°ƒæ•´åˆ°éç‰›é¡¿æµä½“çš„çŠ¶æ€.
* é‡Œè„Šè‚‰å¿…é¡»æ”¥å¹²æ°´åˆ†,ä¸èƒ½å‡ºç°è¡€æ°´,å¦åˆ™ç‚¸å‡ºæ¥åä¼šå‘é»‘.è‚‰ç‰‡è¦æ”¥åˆ°å‘ç™½çš„çŠ¶æ€ä¸ºæœ€ä½³
* é«˜æ²¹æ¸©ç‚¸åˆ¶,å¦‚æœæ˜¯è‡ªå·±å®¶ç‡ƒæ°”ç¶çš„è¯æ²¹æ¸©æœ€å¥½åˆ°è¾¾180Â°ä»¥ä¸Š(å°±æ˜¯æ²¹å†’çƒŸçš„çŠ¶æ€),ç¬¬ä¸€éç‚¸åˆ¶åˆ°é‡‘é»„çŠ¶æ€,ç¬¬äºŒç¬¬ä¸‰éè¦ç­‰æ²¹æ¸©å†æ¬¡å‡é«˜(åˆ°å†’çƒŸçŠ¶æ€)è¿›è¡Œå¤ç‚¸,è¿™æ­¥å«`é—¯æ²¹`,å°±æ˜¯è¶ç€æ²¹æ¸©å‡é«˜æ”¾é‡Œå¤ç‚¸.æœ€ç»ˆç»è¿‡å‡ éé—¯æ²¹æ“ä½œåé”…åŒ…è‚‰ä¼šå˜æˆæ£é»„è‰²åŸºæœ¬å®Œæˆ
* å‰©ä¸‹å°±æ˜¯è°ƒæ•´æ±æŠ€å·§äº†,è¿™ç©æ„è¿˜åˆ†çƒ¹æ±å’Œæ¡æ±.å…·ä½“æ“ä½œå¤§å®¶çœ‹ç½‘ç»œä¸Šçš„è§†é¢‘æ•™ç¨‹å°±ä¼šçŸ¥é“æˆ‘ä¸è¿‡å¤šä»‹ç»äº†.

ç»è¿‡ä¸Šè¿°çš„æ“ä½œ,æˆ‘è®¤ä¸ºæœ€é‡è¦çš„å°±æ˜¯æ‰‹æ³•å’Œè®¤çœŸç¨‹åº¦,å‹¤åŠ ç»ƒä¹ .

åœ¨è¿™é‡Œæˆ‘æ¨èå¤§å®¶ä¹°ä¸€ç§å«åšé£è½¦ç‰Œçš„æ·€ç²‰

![](/assets/images/20221231FinalSummary/2022F5.webp)

å¦‚æœç»å¸¸åšå»ºè®®ä¹°2.5KGä»¥ä¸Šçš„,è¿™é“èœååˆ†è´¹æ·€ç²‰.åˆ«é—®ä¸ºä»€ä¹ˆ,è¿™éƒ½æ˜¯äº¤çš„å­¦è´¹.åˆ«çš„æ·€ç²‰åŸºæœ¬éƒ½æ²¡æœ‰å®ƒçº¯åº¦é«˜.

ç”±äºæˆ‘çš„å‹¤åŠ ç»ƒä¹ æˆ‘åœ¨ä¸€æ¬¡åŒäº‹é’“é±¼æ´»åŠ¨å¨±ä¹åå»åƒé¥­,å¸­é—´æœ‰ä¸€é“èœå«åš`é‚£å¹´ç§‹å¤©çš„èŒ„å­`

åƒå®Œæˆ‘æ„Ÿè§‰ä¸é”™æˆ‘è¦å›å»å¤åˆ»å‡ºæ¥.ä¸‹é¢æ˜¯é¥­åº—çš„æ ·å­  
![](/assets/images/20221231FinalSummary/2022F7.webp)

ä¸‹é¢æ˜¯æˆ‘å¤åˆ»åçš„æ ·å­.  
![](/assets/images/20221231FinalSummary/2022F6.webp)

è¿™é“èœå¾ˆå¥½åƒ,æˆæœ¬éå¸¸å»‰ä»·,æˆ‘å¯ä»¥éå¸¸è´Ÿè´£å‘Šè¯‰ä½ è¿™ç›˜èœé£Ÿæ+è°ƒæ–™æˆæœ¬ä¸è¶…è¿‡10å…ƒ,éº»çƒ¦å°±éº»çƒ¦åœ¨å¦‚ä½•ç†¬åˆ¶é‚£ä¸ªæ‹”ä¸çŠ¶æ€çš„ç³Š. åƒè¿‡å°±çŸ¥é“äº†,ä¸€ç‚¹ä¸æ²¹è…»,æˆ‘åšçš„å¾ˆæ²¹è…»ä¸æ˜¯å¾ˆæˆåŠŸè¿˜å¾—å¤šç»ƒç»ƒ.

2022å¹´çš„ç”Ÿæ´»å°±ä»‹ç»åˆ°è¿™é‡Œå§,éƒ½æ˜¯ä¸€å †çç¢çš„è®°å¿†å’Œä¸€äº›æ‰¯æ·¡çš„ç»éªŒä»¥åŠä¸æˆç†Ÿçš„æ”¿æ²»è§‚å¿µå„ä½è§ç¬‘äº†.


## å…³äºå·¥ä½œ

å¹´åˆçš„æ—¶å€™åœ¨æ—·è§†è´Ÿè´£äººè„¸è¯†åˆ«çš„ç¾é¢œSDKå¼€å‘,è¿™å®¶å…¬å¸ç»å¯¹æ˜¯ä¸€å®¶æ²¡æœ‰äººæ–‡ä¸»ä¹‰ç²¾ç¥å’Œè‰ºæœ¯æ°”è´¨çš„å…¬å¸.ç»„å†…åŒäº‹çš„æ­§è§†æ„Ÿæ¯”è¾ƒå¼ºæ€»è®¤ä¸ºè‡ªå·±éå¸¸NBå’±ä¹Ÿä¸çŸ¥é“å“ªé‡Œæ¥çš„è‡ªè±ªæ„Ÿ,å¦‚æœåç»­åŒè¡Œæ‰¾å·¥ä½œè¿˜æ˜¯ä¸è¦æ‰¾è¿™å®¶äº†å§,åˆ›å§‹äººè‡ªç§°æ¸…åå§šç­æ¯•ä¸šè§‰çš„è‡ªå·±å‡ºèº«é«˜è´µ,å‚²æ°”è¾ƒé‡ç»™æˆ‘çš„ç›´è§‚æ„Ÿå—æ˜¯æ¸…åæ˜¯å¥½æ¸…å,é€šè¿‡è§‚å¯Ÿè¿™äº›äººå¸¦é¢†çš„å…¬å¸æƒ…å†µè§‰å¾—,æ€ä¹ˆæŠŠå…¬å¸æå¾—è¿™ä¹ˆä¹ŒçƒŸç˜´æ°”,ç…ç…æ‹›è˜å…¬å¸è¿™äº›äººéƒ½æ˜¯å•¥äºº,æœ‰çš„äººè¿˜ä¸é”™,æœ‰çš„äººå´å¾ˆä¸€èˆ¬,æœ‰çš„äººè¿˜ä¸çŸ¥é“è‡ªå·±æ˜¯åƒåœ¾çš„åƒåœ¾,æ€»æƒ³ç€æŠŠåˆ«äººæ•´èµ°,è€Œä¸æ˜¯æƒ³ç€æ€ä¹ˆæŠŠé˜Ÿå‹å¸¦å¥½,å›¢é˜Ÿå¸¦å¥½. æˆ‘ç»™è¿™ä¸ªå…¬å¸æœ€åçš„è¯„ä»·æ˜¯â€œè„šè¸å®åœ°ä¸€ç‚¹,åˆ«æ‹¿ç€é‚£ç‚¹æ‰€è°“çš„AIè¯´äº‹äº†,è¿™åªæ˜¯ä¸€ä¸ªå“ªå®¶éƒ½ä¼šæŠ€æœ¯,è®©è‡ªå·±æ´»ä¸‹å»,åˆ›é€ çš„æŠ€æœ¯é©æ–°,å¦åˆ™ä½ æ‰“ä¸è¿‡å•†æ±¤éƒ½æ˜¯æœ‰åŸå› çš„â€.ä¹Ÿè®¸è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„`å·`å§! èƒ½å·çš„ç•™ä¸‹ä¸èƒ½å·çš„å°±èµ°å§!å¦‚æœä¸€å®¶å…¬å¸è¿›å…¥è¿™ç§çŠ¶æ€çš„è¯èƒ½èµ°å°±èµ°å§!ä¸å€¼å¾—ä»˜å‡ºè¿‡å¤šçš„åŠªåŠ›,å› ä¸ºå®ƒçš„çŠ¶æ€å°±æ³¨å®šäº§å‡ºä½å¢æ•ˆä½æ²¡æœ‰æ”¶å…¥åªæœ‰æŠ•å…¥.æ¯”è¾ƒæç¬‘çš„æ˜¯æŠ€æœ¯é¢è¯•åˆ°å…¥èŒä¸€å…±5é¢,4é¢æŠ€æœ¯,è¿™4é¢ä¸­,3é¢ç®—æ³•,3é¢ç®—æ³•ä¸­2ä¸ªéƒ½æ˜¯äºŒåˆ†æŸ¥æ‰¾.æˆ‘ä¸å¹ç‰›é€¼åœ¨è¿™è´Ÿè´£çš„è¯´è¿™è¾¹é¢è¯•å®˜ç®—æ³•åªä¼šäºŒåˆ†æŸ¥æ‰¾,å¦‚æœæˆ‘è¦è®©ä»–å†™ä¸ªäºŒå‰æ ‘å±‚åºéå†é”¯é½¿éå†æˆ–è€…LRUä¹‹ç±»çš„ä»–åŸºæœ¬å†™ä¸å‡ºæ¥å§!æ€»ä¹‹æˆ‘è¿˜æ˜¯åœ¨ç®—æ³•ä¸Šåšäº†å¾ˆå¤šåŠŸè¯¾çš„.
 
 æˆ‘ä¹‹å‰æŠŠæ¸…åçš„å…„å¼Ÿåˆ†ä¸ºä¸¤æ´¾.
 
 * æ±‚çœŸåŠ¡å®æ´¾
 * å¾’æœ‰è™šåæ´¾  
 
ç»è¿‡äº²èº«é‰´å®š,æ­¤å±äºå¾’æœ‰è™šåæ´¾,é‰´å®šå®Œæ¯•!  

 
#### è¿‘å†µ

æˆ‘ç›®å‰å°±èŒäºTMEè…¾è®¯éŸ³ä¹å¨±ä¹é›†å›¢ä¸‹çš„é…·æˆ‘éŸ³ä¹å›¢é˜Ÿ,è¿™æ˜¯ç»è¿‡è¿™ä¸¤å¹´å¤šçš„ç–«æƒ…è£å‘˜æ½®ä¸‹æˆ‘èƒ½æ‰¾åˆ°ä¸ºæ•°ä¸å¤šçš„å…¬å¸äº†.

TMEä¸‹é¢çš„äº§å“

* QQéŸ³ä¹
* é…·ç‹—éŸ³ä¹
* é…·æˆ‘éŸ³ä¹
* æ‡’äººå¬ä¹¦
* é…·æˆ‘ç•…å¬
* æ³¢ç‚¹éŸ³ä¹

... 

ç”±äºéŸ³ä¹æ˜¯æœ‰ç‰ˆæƒçš„,æ‰€ä»¥åœ¨TMEä¸‹çš„äº§å“å¤§éƒ¨åˆ†éƒ½æ˜¯æ”¶è´¹çš„.å…¬å¸ç›®å‰å‘å±•éƒ½æ˜¯èµ°é™æœ¬å¢æ•ˆçš„è·¯çº¿

#### è¯´è¯´æˆ‘çš„æ„Ÿå—

æ—©äº›å¹´åœ¨ç™¾åº¦å·¥ä½œçš„æ—¶å€™å›¢é˜Ÿå’Œå›¢é˜Ÿä¹‹é—´æ˜¯å°é—­çš„,å‡ ä¹æ²¡æœ‰æŠ€æœ¯äº¤æµçš„æœºä¼š,å³ä¾¿æŸäº›å›¢é˜Ÿåšå‡ºäº†å¾ˆé…·ç‚«çš„åŠŸèƒ½æˆ–è€…å¾ˆæœ‰æŠ€æœ¯å«é‡çš„æŠ€æœ¯æ¶æ„å’Œå·¥å…·ä¹Ÿå¾ˆéš¾å’Œå…„å¼Ÿå›¢é˜Ÿç”šè‡³ç™¾åº¦å†…éƒ¨å…¶å®ƒå›¢é˜Ÿå…±äº«æˆæœ.è¿™ä¸€ç‚¹æˆ‘å¾ˆåæ„Ÿ,ä¸€å®¶å…¬å¸å†…éƒ¨åˆ†è£‚çš„å¥½åƒNå®¶å°å…¬å¸,äº’ç›¸ä¸é€šæ°”,å°é—­é—­é—¨é€ è½¦,å®Œå…¨ä¸å¼€æºè‡³å°‘å…„å¼Ÿå›¢é˜Ÿå…±äº«æŠ€æœ¯æˆæœæ˜¯ä¸€ä»¶ååˆ†ç³Ÿç³•çš„äº‹æƒ…,è¿™ä¹Ÿå¯¼è‡´ç™¾åº¦ä¸ºä»€ä¹ˆç›´åˆ°ç°åœ¨ä¾ç„¶æ˜¯è¿™æ ·,å› ä¸ºå¤§å®¶éƒ½åœ¨è€ƒè™‘è‡ªå·±å›¢é˜Ÿçš„ORI,è¿™å°±æ˜¯å…¸å‹çš„èµ°ä¸‹å¡è·¯çš„è¡¨ç°,å¦‚æœRobinçœ‹åˆ°æˆ‘è¿™ç¯‡å¹´ç»ˆæ€»ç»“è®°å¾—æ”¹ä¸€æ”¹å…¬å¸è¿™ä¸ªå¾ˆä¸å¥½çš„ç‚¹.è‡³å°‘è®©ç™¾åº¦çš„è‚¡ç¥¨å‡ä¸€ä¸ªç™¾åˆ†ç‚¹ä¸æ˜¯é—®é¢˜.

åœ¨TMEè™½ç„¶æƒ…å†µä¹Ÿæ˜¯è¿™æ ·,ä½†ç›¸å¯¹æœ‰å¾ˆå¤šæ”¹å–„,QéŸ³çš„åŠŸèƒ½æˆ‘ä»¬å¯ä»¥éšæ—¶æ‹¿æ¥,QéŸ³æä¾›å†…éƒ¨æŠ€æœ¯æ”¯æŒ,èƒ½ä¿è¯æŠ€æœ¯å…±äº«,æˆ‘æƒ³ä¹Ÿè®¸è¿™å°±æ˜¯è…¾è®¯ä¸ºä»€ä¹ˆèƒ½æ¯”ç™¾åº¦å¼ºçš„åŸå› å§!

![](/assets/images/20221231FinalSummary/2022F8.webp)

è¿™å·²ç»æ˜¯èŒä¸šç”Ÿæ¶¯é‡Œèµ¶ä¸Šçš„ç¬¬äºŒå®¶ä¸Šå¸‚å…¬å¸äº†.æˆ‘æ²¡è‚¡ç¥¨å“ˆ.

#### è¯´è¯´å›¢é˜Ÿ

æ€»ä½“æ„Ÿè§‰è¿™è¾¹çš„å›¢é˜Ÿäººéƒ½æŒºå¥½çš„

* æ²¡æœ‰æ–°äººæ’æ–¥æ„Ÿ
* å¤§å®¶è™½ç„¶è–ªèµ„ä¸é«˜,ä½†å›¢é˜Ÿå†…éƒ¨æ°”æ°›å¾ˆå¥½
* è€å¤§æ²¡æœ‰å¾ˆä¸å¥½çš„æ¶å­,è¿˜æ˜¯ä¸€ä¸ªåˆæ ¼çš„leader

ç°åœ¨çš„ç¯å¢ƒä¸‹èƒ½é‡åˆ°è¿™æ ·çš„å›¢é˜Ÿå·²ç»éå¸¸niceäº†.

#### è¯´è¯´æŠ€æœ¯

æˆ‘ä»¬å›¢é˜Ÿå¯¹æŠ€æœ¯çš„è¿½æ±‚è¿˜æ˜¯å¾ˆå¥½çš„.

è‡ªä»åŠ å…¥åˆ°è¿™ä¸ªå›¢é˜Ÿå,æŠŠåœ¨å¿«æ‰‹å›¢é˜Ÿçš„å¥½çš„å†…å®¹æˆ‘åŸºæœ¬éƒ½å¸¦åˆ°äº†è¿™ä¸ªå›¢é˜Ÿ

* å¼€å¯åˆç†åŒ–åˆ†æ”¯ç®¡ç†
* å› åœ°åˆ¶å®œçš„ä»£ç review
* æ¢è®¨æŠ€æœ¯
* è®¨è®ºæµè¡Œçš„æŠ€æœ¯æ–¹æ¡ˆå’Œè®¾è®¡æŠ€å·§
* å¯¹ç¼–ç¨‹çš„çƒ­çˆ±åŒæ—¶æŠŠå¹³å¸¸çš„éš¾ç‚¹é›†ä¸­æ”»ç ´.
* å¯¹ä¸€äº›æœ‰ä»·å€¼å’Œé«˜æŠ€æœ¯å«é‡çš„å¼€å‘ä¼šåšæŠ€æœ¯åˆ†äº«


è¯´ä¸€ä»¶æ¯”è¾ƒæç¬‘çš„äº‹æƒ…,åœ¨è¿›å…¥åˆ°å›¢é˜Ÿå¼€å‘2ä¸ªæœˆå¤šçš„æ—¶å€™é‡åˆ°ä¸€ä¸ªéå¸¸å¥‡è‘©çš„é—®é¢˜,æœ‰ä¸€ä¸ªç»„å†…çš„å°ä¼™å†™åŠ¨ç”»é”™è¯¯çš„æŠŠ`CAReplicatorLayer`é‡Œçš„`instanceCount`è®¾ç½®æˆäº†`MAXFLOAT`ã€‚

å¯¼è‡´æ‰‹æœºæ’­æ”¾æ­Œæ›²çš„æ—¶å€™ç›´æ¥æ­»æœºé‡å¯,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ç”¨äº†ä¸€å¤©çš„æ—¶é—´,ä¸æ–­çš„äºŒåˆ†æ³•ç¼©å°ä»£ç å·®è·.å› ä¸ºdebugä¸€æ¬¡çš„æ—¶é—´åŒ…å«é‡å¯æ‰‹æœºè¦3åˆ†é’Ÿ.æœ€ç»ˆé”å®šè¯¥bug. è¿™æ˜¯æˆ‘ä»ä¸šè‡³ä»Šä¸ºæ­¢é‡åˆ°æœ€å¥‡è‘©çš„bugå¿…é¡»markä¸€ä¸‹.

## å…³äºå­¦ä¹ 

è¿™ä¸€å¹´çš„ä¸ŠåŠå¹´æ¥è§¦äº†äººè„¸è¯†åˆ«æŠ€æœ¯å’ŒAIç›¸å…³,äº†è§£äº†ä¸€äº›æœºå™¨å­¦ä¹ ç›¸å…³çš„æŠ€æœ¯.ä¸‹åŠå¹´åœ¨åšéŸ³ä¹ç±»app, å½“ç„¶éŸ³ä¹ä¹Ÿä¸æ˜¯é‚£ä¹ˆå¥½åšçš„,é¦–å…ˆå¾—ä¼šæ•°å­—ä¿¡å·å¤„ç†.è°ˆåˆ°ä¿¡å·å¤„ç†å°±ç¦»ä¸å¼€å‚…é‡Œå¶å˜æ¢.å› ä¸ºæ‡‚äº†è¿™äº›åæ‰èƒ½åšæ›´å¥½çš„åŠŸèƒ½,æ¯”å¦‚æ’­æ”¾çš„æ¯ä¸€é¦–æ­Œè½¬æ¢æˆå„ç§æ ¼å¼çš„æ—¶å€™éœ€è¦æŠŠæ ¼å¼è½¬æˆåŸå§‹çš„æ•°æ®é‡‡æ ·,æ¯”å¦‚ AACæˆ–è€…mp3æˆ‘æƒ³è½¬æˆæ— é™¨éŸ³è´¨,è¿™ä¸­é—´éœ€è¦æŠŠå°è£…å¥½çš„æ ¼å¼è½¬å›PCM(è„‰å†²è°ƒåˆ¶ç¼–ç ),ç»è¿‡ç¼–ç å™¨å°è£…æˆå…¶å®ƒæ ¼å¼.è¿™ä¸­é—´è‚¯å®šä¸æ­¢æ˜¯ä¼šç‚¹éŸ³è§†é¢‘æŠ€æœ¯å°±å®Œäº‹äº†,è¿˜è¦è´Ÿè´£å¯¹æ•°æ®é¢‘åŸŸè½¬æ—¶åŸŸ,ç»è¿‡FFT(å¿«é€Ÿå‚…é‡Œå¶å˜æ¢)åç”Ÿæˆå¤šå£°é“ä¿¡å·æ ·æœ¬æ–¹ä¾¿å¯¹éŸ³é¢‘åšé¢‘å¸¦åŠ¨ç”».æ¯”å¦‚åŠ æƒå¹³å‡ç®—æ³•,Aè®¡æƒç®—æ³•,åŠ çª—å‡½æ•°çš„æ‹Ÿåˆå¤„ç†,æ»¤æ³¢å¤„ç†ç­‰ç­‰.å¤§éƒ¨åˆ†äººåº”è¯¥ä¸æ¥è§¦è¿™é¢†åŸŸéƒ½ä¼šæ„Ÿåˆ°å¾ˆæ™¦æ¶©,æˆ‘ä¹Ÿä¸€æ ·.

#### æ•°å­—ä¿¡å·å¤„ç†

æ‰€ä»¥æˆ‘åœ¨Bç«™ä¸Šå­¦èŠ±äº†ç‚¹æ—¶é—´å­¦ä¹ å®Œäº†ä¸€é—¨ æ•°å­—ä¿¡å·å¤„ç†çš„è¯¾ç¨‹

![](/assets/images/20221231FinalSummary/2022F9.webp)

è¿™é—¨è¯¾ç¨‹å­¦å®Œä¹‹åæ„Ÿè§‰å’Œæ²¡å­¦ä¸€æ ·,å› ä¸ºå®ƒå…¨æ˜¯å„ç§å…¬å¼æ¨å¯¼å¹¶æ²¡æœ‰ä»£ç ä¹Ÿæ²¡æœ‰å·¥å…·çš„ä½¿ç”¨æ•™ç¨‹,åªæ˜¯èƒ½ä½œä¸ºä¸€ä¸ªå…¥é—¨çš„åŸºç¡€çŸ¥è¯†å‚è€ƒ,æ¯”å¦‚ä½é€šæ»¤æ³¢å™¨ã€é«˜é€šæ»¤æ³¢å™¨ã€å¸¦é€šæ»¤æ³¢å™¨ã€å¸¦é˜»æ»¤æ³¢å™¨ã€FIRæ»¤æ³¢å™¨ã€BFåŠå¸¦æ»¤æ³¢å™¨ç­‰ç­‰å„ç§æ»¤æ³¢ç®—æ³•ã€å†æ¯”å¦‚ä¸€äº›æ‹‰æ™®æ‹‰æ–¯å®šç†,å¸Œå°”æ³¢ç‰¹å®šç†ç­‰ç­‰éƒ½æ˜¯åå­¦æœ¯å’ŒåŸºç¡€,æ ¹æœ¬ä¸é€‚åˆä¸€ä¸ªå®æˆ˜ç¨‹åºå‘˜å­¦ä¹ .

#### éŸ³è§†é¢‘è¯¾ç¨‹

* å¿«æ‰‹ Â· éŸ³è§†é¢‘æŠ€æœ¯å…¥é—¨è¯¾
* å¿«æ‰‹ Â· ç§»åŠ¨ç«¯éŸ³è§†é¢‘å¼€å‘å®æˆ˜

è¿™ä¸¤é—¨è¯¾ç¨‹æˆ‘éƒ½ä¿è¯100%å­¦å®Œ,ä½†æ˜¯å­¦å®Œå¹¶ä¸ä»£è¡¨å°±ä¼šäº†,è¿˜å¾—å˜æˆ˜æ–—è¾¹å­¦ä¹ .

![](/assets/images/20221231FinalSummary/2022F10.webp)  
![](/assets/images/20221231FinalSummary/2022F11.webp)

å­¦å®Œçš„è¯ä¹¦ç•™ä¸ªçºªå¿µ,è™½ç„¶è¿™è¯´æ˜ä¸äº†ä»€ä¹ˆ,

è¿™ä¸¤é—¨è¯¾ç¨‹éå¸¸é€‚åˆiOSè½¬C/C++å­¦ä¹ éŸ³è§†é¢‘.å¦‚æœæˆ‘æ¨èçš„è¯ä¸€å®šæ˜¯10é¢—æ˜Ÿ.

#### ç›®å‰æ­£åœ¨å­¦ä¹ 

ä¾¯æ·C++

![](/assets/images/20221231FinalSummary/2022F12.webp)

å› ä¸ºéŸ³è§†é¢‘å…¥é—¨çš„é—¨æ§›å°±æ˜¯C/C++ï¼Œä¸ºäº†èƒ½å’ŒæŠ€æœ¯å¥‘åˆæˆ‘è¿™è¾¹æ­£åœ¨åŠªåŠ›è·Ÿè¿›å­¦ä¹ .

#### çœ‹ä¹¦

![](/assets/images/20221231FinalSummary/2022Books.webp)

è¿™ä¸€å¹´éƒ½åœ¨å­¦ä¹ è¿™ä¸¤æœ¬ä¹¦. æ¯›çˆ·çˆ·å†™çš„æŒºå¥½,æˆ‘æ‰¾å·¥ä½œçš„æ—¶å€™æ—¶å¸¸ç¿»çœ‹,ä»–é¼“èˆäº†æˆ‘çš„ä¿¡å¿ƒ.
é‚£æœ¬å°±æ˜¯å·¥å…·ä¹¦,æ—¶å¸¸ç¿»é˜…ç»†èŠ‚.æ²¡å•¥å¯è¯´çš„,åœ¨ä¸€é¡¹æŠ€æœ¯é¢å‰,å¦‚æœæ²¡æœ‰çµæ´»æŒæ§é©¾é©­å®ƒ,åƒä¸‡ä¸è¦è¯´è‡ªå·±ä¼šäº†,æ‰¿è®¤å§ä½ ä¸ä¼š.

### å°ç»“

åšæŠ€æœ¯çœŸçš„éœ€è¦ä¸æ–­å­¦ä¹ ,è€Œä¸”æˆ‘è¿˜è®¤ä¸ºæŠ€æœ¯æ˜¯éœ€è¦å˜æˆ˜æ–—è¾¹å­¦ä¹ æœ€å¥½.è¿™è¾¹è¦ç”¨é‚£è¾¹è¦å­¦,ä¸¤è€…ç»“åˆæ‰èƒ½å‹¤å®è·µ,æŠ€æœ¯æ‰èƒ½æœ‰æ‰€é•¿è¿›.

å¯ä»¥è¿™æ ·ç›´ç™½çš„è¯´,å³ä¾¿å¤§å­¦ä½ å­¦äº†ä¸€éC++ä½ å¥½å¤šå¹´ä¸ç”¨å®ƒ==0.

å›é¦–é¢è¯•çš„æ—¶å€™è‡ªå·±å¤ä¹ äº†ç®—æ³•å¤ä¹ Né.å‘ä¸€å¼ å›¾èŠè¡¨çºªå¿µ.

![](/assets/images/20221231FinalSummary/2022F13.webp)

## å…³äºç†æƒ³

æˆ‘çš„ç†æƒ³æ˜¯é€ ä¸€æ‰€è§£å†³å¡ä¸­å›½è„–å­æŠ€æœ¯å¤§å­¦,ç„¶è€Œç°å®æ˜¯æˆ‘è¿™ç†æƒ³è¿‡äºè’è°¬.ä½†æ˜¯æœ‰ä¸€ä¸ªäºº,ä»–æ€»èƒ½å®ç°æˆ‘çš„ç†æƒ³-æ›¹å¾·æ—º

ä»–åˆ›åŠçš„ç¦è€€ç§‘æŠ€å¤§å­¦å‡ ä¹æ˜¯æŠŠæˆ‘çš„æ¢¦æƒ³å˜æˆäº†ä»–çš„ç°å®.æˆ‘æ‰¿è®¤ä¸€ä¸ªè¿ç”Ÿæ´»æ¸©é¥±éƒ½è§£å†³ä¸äº†çš„äººé€ ä¸€æ‰€è§£å†³å¡ä¸­å›½æŠ€æœ¯è„–å­çš„å¤§å­¦çš„äº‹æƒ…æ˜¯å¯ç¬‘çš„.ä»–æŠ•èµ„100ä¸ªäº¿.è¿™å¦¥å¦¥å°±æ˜¯æŒ‰ç…§æˆ‘çš„æ ‡å‡†è®¾è®¡äº†å¤§å­¦,å“,æˆ‘æ‰¿è®¤è‡ªå·±è¿‡äºåƒåœ¾.

æˆ‘è®°å¾—å»å¹´æˆ‘å°±è¯´è®¸å®¶å°èŠ±é‡é‡‘é€ è½¦,æˆ‘è¯´è¿™æœ‰é’±äººæœ‰é’±å§ä»–ä¸ä¼šèŠ±.ç‹æ€èªæœ‰é’±ä¹Ÿä¸ä¼šèŠ±.å°±è§£å†³å¡ä¸­å›½è„–å­è¿™äº‹ä½ èŠ±ä¸€ä¸ª100wéƒ½æ¯”ç‹å¥æ—çš„å°ç›®æ ‡ç‰›é€¼å¤šäº†.ä¸çŸ¥é“è¿™å¸®äººæœ‰é’±çš„æƒ³æ³•å’Œä¸–ç•Œéƒ½æ˜¯å•¥æ ·çš„.

![](/assets/images/20221231FinalSummary/2022F14.webp)

æ€»ä¹‹å¸Œæœ›æ›¹å¾·æ—ºçš„äººè®¾ä¸ä¼šå´©å¡Œ,å¸Œæœ›ä»–æŠŠå¤§å­¦åŠå¥½,ä»–åŠä¸å¥½æˆ‘æ¥åŠ,åœ¨æˆ‘æœ‰ç”Ÿä¹‹å¹´ä¸€å®šè§£å†³å¡ä¸­å›½è„–å­çš„34é¡¹æŠ€æœ¯.[34é¡¹æŠ€æœ¯ç‚¹å‡»è¿™é‡ŒæŸ¥çœ‹](https://www.sunyazhou.com/2019/12/FinalSummary/)

ä»¥ç›®å‰å’±æ›¹å¤§çˆ·çš„æ“ä½œ,æŒ‡æ—¥å¯å¾….

è¿™é‡Œæˆ‘ä¸å¾—ä¸æ‹¿å‡ºå’±æ›¹å¤§çˆ·è¯´çš„è¯

![](/assets/images/20221231FinalSummary/2022F15.webp)

æ²¡æœ‰æ¶ˆè´¹èƒ½åŠ›+1


## å…³äºå¥½ç‰©

#### MagSafeç£å¸å……ç”µå®  

![](/assets/images/20221231FinalSummary/2022F16.webp)  
å¦‚æœä½ ç»å¸¸å‡ºé—¨,æ‹¥æœ‰iPhone12 ä»¥ä¸Šæœºå‹,æˆ‘å»ºè®®ä¹°ä¸ªè¿™ç©æ„,ä¸ç”¨ç¹ççš„å……ç”µçº¿,ç›´æ¥å¸åœ¨æ‰‹æœºèƒŒé¢æ— çº¿å……ç”µ.è¿™ç©æ„å‡ºé—¨ç»å¯¹ä½¿ç”¨.

#### 8ä½å ‚æ¸¸æˆæ‰‹æŸ„

![](/assets/images/20221231FinalSummary/2022F17.webp)  

åœ¨ä¸šä½™æ—¶é—´æˆ‘ç»å¸¸å–œæ¬¢ç©ç©ç›Šæ™ºæ¸¸æˆå’ŒåŸå§‹çš„è¡—æœºæ¸¸æˆ,æœ‰ä¸€ä¸ªæ¨¡æ‹Ÿå™¨å«åš[RetroArch](https://www.retroarch.com/)

![](/assets/images/20221231FinalSummary/2022F18.webp)  

è¿™ä¸ªæ¨¡æ‹Ÿå™¨å¯ä»¥åœ¨å„ç§å¹³å°ç©,å°±æ˜¯é…ç½®èµ·æ¥å¾ˆéº»çƒ¦,ä½ éœ€è¦å…ˆå»è¥¿ç“œè§†é¢‘æˆ–è€…Bç«™çœ‹çœ‹é…ç½®æ•™ç¨‹.ä¸šä½™æ—¶é—´ç©ç©æ¸¸æˆè¿˜æ˜¯å¾ˆä¸é”™çš„æœ‰ç›Šäºèº«å¿ƒå¥åº·çš„äº‹æƒ…,å½“ç„¶è¿˜æ˜¯å·¥ä½œå’Œå®¶åº­é‡è¦,åˆ†æ¸…ä¸»æ¬¡å°±å¥½.åˆç†å®‰æ’æ—¶é—´.

#### ç¨šæ™–å›å‘æ˜çš„Quark-N

![](/assets/images/20221231FinalSummary/2022F19.webp)  

è¿™ç©æ„æ˜¯æœ€å°çš„å¡ç‰‡ç”µè„‘ä½ ä¿¡å—.è¿™æ¥è‡ªäºåä¸ºçš„å¤©æ‰å°‘å¹´å‡ºå“.[ç¨šæ™–å›çš„Bç«™ä¸»é¡µ](https://space.bilibili.com/20259914),å–œæ¬¢çš„å¯ä»¥ç‚¹å¼€çœ‹çœ‹.å…¨æ˜¯ç¨šæ™–å›çš„å‡ºå“,å¦‚æœæˆ‘å‘Šè¯‰ä½ ä»–å¼€æºäº†å…¨éƒ¨ç¡¬ä»¶å’ŒåŸè½¯ä»¶åŒ…å«ç¡¬ä»¶çš„è®¾è®¡å›¾çº¸å’Œç”µè·¯ä½ ä¹Ÿå¾ˆéš¾é€ å‡ºæ¥ä½ ç›¸ä¿¡å—?

è¿™ä¸ªå¡ç‰‡ç”µè„‘èƒ½è£…ä¹Œç­å›¾linuxï¼Œéå¸¸é€‚åˆå­¦ä¹ .

# æ€»ç»“

è¿™ä¸€å¹´è¿‡å¾—,å‰åŠå¹´å¾ˆæ— èŠ,ååŠå¹´è¿˜å¥½,åªæ˜¯ä¸çŸ¥é“è£å‘˜å½“ä¸‹çš„å…¬å¸åˆ°åº•æƒ³è£å‘˜åˆ°ä»€ä¹ˆæ—¶å€™,å¸Œæœ›å¤§å®¶å’Œæˆ‘ä¸€æ ·åŠªåŠ›å­¦ä¹ è‡ªå·±çš„æŠ€æœ¯,æŠŠè‡ªå·±çš„æŠ€æœ¯ç©åˆ°å‡ºç¥å…¥åŒ–çš„çŠ¶æ€,æ‰“ç ´èµ„æœ¬è£å‘˜çš„é•°åˆ€,æ„å»ºè‡ªå·±çš„é˜²ç©ºç³»ç»Ÿ,åœ¨å±é™©æ¥ä¸´ä¹‹å‰èƒ½æœ‰æƒæ— æ,æ—©æ—¥å®ç°è´¢å¯Œè‡ªç”±.

æ´»çš„ä½“é¢ä¸è¦å‡‰,æœªæ¥çš„è·¯è¿˜å¾ˆé•¿.





URL: https://sunyazhou.com/2022/12/gradientlayeranimation/index.html.md
Published At: 2022-12-07 08:00:00 +0000

# æ¨¡ä»¿QéŸ³å¾„å‘æ¸å˜åŠ¨ç”»

![](/assets/images/20221207RadialGradientlayer/RadialCenter.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

å…ˆä¸Šæˆå“çœ‹çœ‹æ•ˆæœ

![](/assets/images/20221207RadialGradientlayer/final.gif)

# æ·±å…¥CAGradientLayer 

æœ€è¿‘å¼€å‘åŠŸèƒ½,è§†è§‰è®¾è®¡åŒå­¦å¯¹QQéŸ³ä¹çš„æ¡Œé¢æ­Œè¯é¢„è§ˆå›¾çš„æµä½“æ¸å˜åŠ¨ç”»å¾ˆæ„Ÿå…´è¶£,æƒ³è®©å¼€å‘è¿™è¾¹å®ç°è¿™ä¸ªæ•ˆæœ.

![](/assets/images/20221207RadialGradientlayer/qqmusicanimation1.gif)

ä»”ç»†è§‚å¯Ÿæ­Œè¯èƒŒæ™¯( è‹¥ä¸æ˜¯æˆ‘å·¦å³çœ¼éƒ½æ˜¯5.0 æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°QQéŸ³ä¹çš„æ•ˆæœæˆ‘ä»¥ä¸ºæ²¡åŠ¨ç”».å¹¼ç¨šè¢«æ•™è‚²äº†),ä¼šæœ‰ä¸€ä¸ªç±»ä¼¼æŸ”å…‰çš„æ•ˆæœåƒä¸ªç¯å…‰ä¸€æ ·ç…§å°„å¹¶ç§»åŠ¨.è§†è§‰è®¾è®¡åŒå­¦æŠŠè¿™ä¸ªæ•ˆæœç§°ä¸º`æµä½“è¿‡æ¸¡åŠ¨ç”»`.

ä¸ºäº†ç ”ç©¶è¿™ä¸ªæ•ˆæœæˆ‘æ·±å…¥äº†è§£äº†ä¸€ä¸‹`CAGradientLayer`,å‘ç°è¿™é‡Œé¢æœ‰å‡ ä¸ªé‡è¦çš„ç±»å‹å’Œå¤§å®¶ä»‹ç»ä¸€ä¸‹

`CAGradientLayer`ä¸­æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡å«`type`

``` objc
@property(copy) CAGradientLayerType type; //objcä¸­çš„æˆå‘˜å˜é‡
```

``` swift
open var type: CAGradientLayerType  //swiftä¸­çš„æˆå‘˜å˜é‡
```

è¿™é‡Œæ‹¿Objcä¸¾ä¾‹

* kCAGradientLayerAxial è¿™ç§å«åšè½´å‘æ¢¯åº¦æˆ–è€…çº¿æ€§æ¸å˜
* kCAGradientLayerRadial è¿™ç§å«åšå¾„å‘æ¸å˜
* kCAGradientLayerConic  è¿™ç§å«åšé”¥å½¢æ¸å˜

#### kCAGradientLayerAxial

è¿™ç§Linear (Axial) Gradients å¦‚å›¾
![](/assets/images/20221207RadialGradientlayer/linear.webp)

``` objc
// Objective C

gradientLayer.type = kCAGradientLayerAxial;
gradientLayer.colors =
@[
    (id)[UIColor colorWithRed: 48.0/255.0 green: 35.0/255.0 blue: 174.0/255.0 alpha: 1.0].CGColor,
    (id)[UIColor colorWithRed: 200.0/255.0 green: 109.0/255.0 blue: 215.0/255.0 alpha: 1.0].CGColor
];

```

``` swift
// Swift
gradientLayer.type = .axial;
gradientLayer.colors =
[
    UIColor(red: 48.0/255.0, green: 35.0/255.0, blue: 174.0/255.0, alpha: 1.0).cgColor,
    UIColor(red: 200.0/255.0, green: 109.0/255.0, blue: 215.0/255.0, alpha: 1.0).cgColor
]
```

ä¸ºäº†ç ”ç©¶æ˜ç™½è¿™å‡ ç§ç±»å‹æœ‰å•¥åŒºåˆ«ä¹‹å‰æˆ‘ä»¬è¦å¤ä¹ ä¸€ä¸‹æ¸å˜layerçš„å¼€å§‹ç‚¹å’Œç»“æŸç‚¹.

##### Start Point and End Point

è¿™ä¸ªå¼€å§‹ç‚¹å’Œç»“æŸç‚¹å¯ä»¥æ”¹å˜æ¸å˜æ–¹å‘.
é»˜è®¤  
`startPoint = (0.5, 0)`,`endPoint = (0.5, 1.0)`

å¦‚æœæŠŠè¿™ä¸ªæ¸å˜å˜æˆå·¦å³æ¨ªå‘çš„å¯ä»¥å‚è€ƒä¸‹é¢å›¾ç¤ºå’Œä»£ç .

å¯ä»¥å‚è€ƒä¸‹å›¾  

![](/assets/images/20221207RadialGradientlayer/corners.webp)  
![](/assets/images/20221207RadialGradientlayer/LinearHorizontal.webp)

ç¤ºä¾‹ä»£ç å¦‚ä¸‹:

``` objc
// Objective C

// Set type (Axial is already the default value)
gradientLayer.type = kCAGradientLayerAxial;
// Set the colors (these need to be CGColor's, not UIColor's)
gradientLayer.colors =
@[
    (id)[UIColor colorWithRed: 48.0/255.0 green: 35.0/255.0 blue: 174.0/255.0 alpha: 1.0].CGColor,
    (id)[UIColor colorWithRed: 200.0/255.0 green: 109.0/255.0 blue: 215.0/255.0 alpha: 1.0].CGColor
];
// Set the start and end points
gradientLayer.startPoint = CGPointMake(0, 0);
gradientLayer.endPoint = CGPointMake(1, 0);
```

``` swift
// Swift

// Set type (Axial is already the default value)
gradientLayer.type = CAGradientLayerType.axial
// Set the colors (these need to be CGColor's, not UIColor's)
gradientLayer.colors =
[
    UIColor(red: 48.0/255.0, green: 35.0/255.0, blue: 174.0/255.0, alpha: 1.0).cgColor,
    UIColor(red: 200.0/255.0, green: 109.0/255.0, blue: 215.0/255.0, alpha: 1.0).cgColor
]
// Set the start and end points
gradientLayer.startPoint = CGPoint(x: 0, y: 0)
gradientLayer.endPoint = CGPoint(x: 1, y: 0)
```

##### å¤šé¢œè‰²å’Œä½ç½®æ§åˆ¶

ç ”ç©¶æ˜ç™½æ¸å˜æ–¹å‘å…ˆåˆ«ç€æ€¥,æˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹å¤šä¸ªé¢œè‰²çš„æ§åˆ¶å’Œæ¸å˜æ®µçš„ä½ç½®æ˜¯å¦‚ä½•è®¾ç½®çš„.

gradientLayerçš„æˆå‘˜å˜é‡`colors`æ˜¯ä¸ªæ•°ç»„,å¯ä»¥æ¥æ”¶å¤šä¸ªé¢œè‰²å€¼.é€šå¸¸æˆ‘ä»¬ä½¿ç”¨2ä¸ªé¢œè‰²åšæ¸å˜,å¦‚æœå¤æ‚çš„è¯å¯ä»¥è®¾ç½®å¤šä¸ª

ä¸‹é¢ä»£ç ç¤ºä¾‹å¤šç§é¢œè‰²æ¸å˜å’Œå“åº”çš„ä»£ç   
![](/assets/images/20221207RadialGradientlayer/rainbow.webp)  

``` objc
gradientLayer.colors =
@[
    (id)[UIColor blueColor].CGColor,
    (id)[UIColor orangeColor].CGColor,
    (id)[UIColor greenColor].CGColor,
    (id)[UIColor redColor].CGColor,
    (id)[UIColor purpleColor].CGColor
];
```

ä¸‹å›¾æ˜¯æ¼”ç¤ºå…³é”®æ¸å˜çš„ä½ç½®è®¾ç½®
![](/assets/images/20221207RadialGradientlayer/locations.webp)  

ä½ç½®è®¾ç½®ä»£ç å¦‚ä¸‹

``` objc
// ObjC
gradientLayer.locations = @[
    @0,   // blueColor
    @0.1, // orangeColor
    @0.6, // greenColor
    @0.7, // redColor
    @1    // purpleColor
];
```

``` swift
// Swift
gradientLayer.locations = [
    0,   // blueColor
    0.1, // orangeColor
    0.6, // greenColor
    0.7, // redColor
    1    // purpleColor
]
```
å¯ä»¥ç®€å•ç†è§£ä¸º`locations`å®é™…æ§åˆ¶çš„æ˜¯æ¸å˜çš„ä½ç½®å¤§å°,ç›¸å¯¹äºå‰åçš„è·ç¦»(ä¹Ÿå¯èƒ½æ˜¯å„ç§æ–¹å‘).

#### Radial Gradientså¾„å‘æ¸å˜

æ˜ç™½äº†é¢œè‰²å’Œä½ç½® ä¸‹é¢æˆ‘ä»¬çœ‹çœ‹ ä»€ä¹ˆæ˜¯å¾„å‘æ¸å˜ï¼Ÿ

å½“æˆ‘ä»¬ä½¿ç”¨`kCAGradientLayerRadial `ç±»å‹çš„æ—¶å€™ æˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹å¾„å‘æ¸å˜éœ€è¦çš„å¼€å§‹ç‚¹å’Œç»“æŸç‚¹. ä¸‹å›¾æ¼”ç¤ºçš„æ˜¯ä¸€ä¸ªæ¤­åœ†çš„æ¸å˜layer.å½“ç„¶å¯ä»¥è®¾ç½®åœ†å½¢.

![](/assets/images/20221207RadialGradientlayer/RadialCenter.webp)

``` objc
// Objective C

// Set the type
gradientLayer.type = kCAGradientLayerRadial;
gradientLayer.colors =
@[
    (id)[UIColor colorWithRed: 0.0/255.0 green: 101.0/255.0 blue: 255.0/255.0 alpha: 1.0].CGColor,
    (id)[UIColor colorWithRed: 0.0/255.0 green: 40.0/255.0 blue: 101.0/255.0 alpha: 1.0].CGColor
];
// Start in the center
gradientLayer.startPoint = CGPointMake(0.5, 0.5);
// End at the outer edge of the view
gradientLayer.endPoint = CGPointMake(0, 0.75);
```

``` swift
// Swift

// Set type to radial
gradientLayer.type = CAGradientLayerType.radial
// Set the colors
gradientLayer.colors =
[
    UIColor(red: 0.0/255.0, green: 101.0/255.0, blue: 255.0/255.0, alpha: 1.0).cgColor,
    UIColor(red: 0.0/255.0, green: 40.0/255.0, blue: 101.0/255.0, alpha: 1.0).cgColor
]
// Start point of first color in the middle of the view
gradientLayer.startPoint = CGPoint(x: 0.5, y: 0.5)
// End points to the edges of the view
gradientLayer.endPoint = CGPoint(x: 0, y: 0.75)
```

#### é”¥å½¢æ¸å˜kCAGradientLayerConic

> é”¥å½¢æ¸å˜ä»…æ”¯æŒ`@available(iOS 12.0, *)`

![](/assets/images/20221207RadialGradientlayer/conic.webp)

æ³¨æ„è§‚å¯Ÿå¼€å§‹ç‚¹å’Œç»“æŸç‚¹ä½ç½®

``` objc
// Objective C

gradientLayer.type = kCAGradientLayerConic;
// Set the colors
gradientLayer.colors =
@[
    (id)[UIColor blueColor].CGColor,
    (id)[UIColor colorWithRed: 50.0/255.0 green: 251.0/255.0 blue: 255.0/255.0 alpha: 1.0].CGColor,
    (id)[UIColor blackColor].CGColor
];
// Start point of first color in the middle of the view
gradientLayer.startPoint = CGPointMake(0.5, 0.5);
// End points to the edges of the view
gradientLayer.endPoint = CGPointMake(0.5, 0);
```

``` swift
// Swift

gradientLayer.type = CAGradientLayerType.conic
gradientLayer.colors =
[
    UIColor.blue,
    UIColor(red: 50.0/255.0, green: 251.0/255.0, blue: 255.0/255.0, alpha: 1.0).cgColor,
    UIColor.black
]
gradientLayer.startPoint = CGPoint(x: 0.5, y: 0.5)
gradientLayer.endPoint = CGPoint(x: 0.5, y: 0)
```

![](/assets/images/20221207RadialGradientlayer/finaldemo.webp)

#### å®ç°QéŸ³æ•ˆæœçš„æ€è·¯

æˆ‘ä»¬å…ˆè§‚å¯Ÿä¸€ä¸‹QQéŸ³ä¹çš„æ•ˆæœ

![](/assets/images/20221207RadialGradientlayer/qqmusicanimation1.gif)

æˆ‘ä»¬çš„æ€è·¯

![](/assets/images/20221207RadialGradientlayer/qqmusicanimation2.gif)

* åˆ›å»ºä¸€ä¸ªå¾„å‘æ¸å˜å›¾å±‚
* æ”¾åœ¨è§†å›¾å¤–éƒ¨é€šè¿‡åŠ `CABasicAnimation`å®ç°`position.x`ä»å³å‘å·¦ç§»åŠ¨åŠ¨ç”»
* æ³¨æ„é¢œè‰²é…ç½®
* ç§»åŠ¨ç»“æŸä¸ºæ­¢ä¸€å®šè¦åœ¨å±å¹•å¤–éƒ¨

ä¸‹é¢çœ‹ä¸‹ å®ç°æ€è·¯ç¤ºæ„å›¾  
![](/assets/images/20221207RadialGradientlayer/qqmusicanimation3.gif)

ä»£ç å¦‚ä¸‹

``` swift

var backgroundView: UIView!
var gradientLayer: CAGradientLayer!

...

override func viewDidLoad() {
    super.viewDidLoad()
    self.backgroundView = UIView(frame: .zero)
    let bgColor = UIColor(red: 231.0/255, green: 223.0/255, blue: 239.0/255, alpha: 1) //è¦æƒ³è¿‡æ¸¡è‡ªç„¶å¿…é¡»ä¿è¯èƒŒæ™¯é¢œè‰²å’Œæ¸å˜ä¸»é¢œè‰²ä¸€è‡´
    self.backgroundView.backgroundColor = bgColor
    self.view.addSubview(self.backgroundView)
    self.backgroundView.snp.makeConstraints { make in
        make.centerX.equalTo(self.view)
        make.centerY.equalTo(self.view)
        make.size.equalTo(CGSize(width: 360, height: 70))
    }
    //å¾„å‘æ¸å˜layer
    self.gradientLayer = CAGradientLayer()
    self.gradientLayer.frame = CGRect(x: 360 * 1.15, y: -70, width: 360 * 1.15, height: 70 * 2)
    self.gradientLayer.contentsScale = UIScreen.main.scale
    self.gradientLayer.startPoint = CGPoint(x: 0.5, y: 0.5)
    self.gradientLayer.endPoint = CGPoint(x: 0, y: 1)
    self.gradientLayer.type = .radial
    self.gradientLayer.locations = [0.25, 1]
    self.gradientLayer.colors = [UIColor(red: 203.0/255, green: 190.0/255, blue: 224.0/255, alpha: 1).cgColor, bgColor.cgColor]
    self.backgroundView.layer.addSublayer(self.gradientLayer)
    self.backgroundView.layer.cornerRadius = 5
    self.backgroundView.layer.maskedCorners = [.layerMinXMinYCorner,.layerMinXMaxYCorner,.layerMaxXMinYCorner,.layerMaxXMaxYCorner];
    self.backgroundView.layer.masksToBounds = true
}

```

æ·»åŠ åŠ¨ç”»æ•ˆæœ

``` swift
private func addPositionAnimation ()
{
    if ((self.gradientLayer.animationKeys()?.contains("kAnimationKey")) != nil) {
        return;
    }
    let width = CGRectGetWidth(self.backgroundView.frame)
    let gradientWidth = CGRectGetWidth(self.gradientLayer.frame)
    let locationAniamtion: CABasicAnimation = CABasicAnimation(keyPath: "position.x")
    locationAniamtion.fromValue = gradientWidth + self.gradientLayer.anchorPoint.x * width
    locationAniamtion.toValue = -gradientWidth
    locationAniamtion.duration = 7
    locationAniamtion.repeatCount = Float.infinity
    locationAniamtion.fillMode = .forwards;
    self.gradientLayer.add(locationAniamtion, forKey: "kAnimationKey")
}
```

å®ç°å®Œæˆä¸è¶…è¿‡80è¡Œä»£ç ,å»æ‰æ— ç”¨å†—ä½™ä»£ç ä¹Ÿå°±40è¡Œä»£ç 

##### é‡åˆ°é—®é¢˜

* 1.é¢œè‰²ä¸åŒå¾ˆå¥‡æ€ª
* 2.è¶…å‡ºèŒƒå›´åè¦æˆªæ‰


##### è§£å†³é—®é¢˜1é¢œè‰²ä¸åŒå¾ˆå¥‡æ€ª

``` swift
let bgColor = UIColor(red: 231.0/255, green: 223.0/255, blue: 239.0/255, alpha: 1) //è¦æƒ³è¿‡æ¸¡è‡ªç„¶å¿…é¡»ä¿è¯èƒŒæ™¯é¢œè‰²å’Œæ¸å˜ä¸»é¢œè‰²ä¸€è‡´
self.backgroundView.backgroundColor = bgColor

...

self.gradientLayer.colors = [UIColor(red: 203.0/255, green: 190.0/255, blue: 224.0/255, alpha: 1).cgColor, bgColor.cgColor]

```
##### è§£å†³é—®é¢˜2è¶…å‡ºèŒƒå›´åè¦æˆªæ‰

``` swift
self.backgroundView.layer.cornerRadius = 5 //è®¾ç½®å€’è§’åŠå¾„
self.backgroundView.layer.maskedCorners = [.layerMinXMinYCorner,.layerMinXMaxYCorner,.layerMaxXMinYCorner,.layerMaxXMaxYCorner]; //è®¾ç½®åœ†è§’æ–¹å‘
self.backgroundView.layer.masksToBounds = true //è¶…å‡ºå±å¹•æˆªæ‰
```

è¿™é‡Œæˆ‘ç”¨äº†ä¸€ä¸ªiOS11ä»¥åçš„api `maskedCorners`å¯ä»¥å¯¼ä¸åŒæ–¹å‘çš„è§’.å¾ˆå¤šäººéƒ½ä¼šæœ‰ç–‘é—®,è®¾ç½®å€’è§’åŠå¾„å’Œ`masksToBounds` å®¹æ˜“è§¦å‘ç¦»å±æ¸²æŸ“,å¯¼è‡´å¸¦æ¥é¢å¤–çš„å¼€é”€. å¦‚æœä½ æœ‰è¿™ä¸ªç–‘é—®è¯·å‚è€ƒä¸€ä¸‹æˆ‘çš„[UIViewä¸åŒæ–¹å‘çš„å¯¼è§’](https://www.sunyazhou.com/2018/05/HowToCreateTopBottomRoundedCornersForViews/)

ä¸‹é¢çœ‹ä¸‹åšå®Œçš„æ•ˆæœ

![](/assets/images/20221207RadialGradientlayer/final.gif)

## æ€»ç»“

é¦–å…ˆå£°æ˜è¿™é‡Œä¸æ˜¯ä¸ºäº†ç‚«è€€æŠ€æœ¯,è¿™ä¸ªä¸œè¥¿ä¹Ÿæ²¡æœ‰å¤šå°‘æŠ€æœ¯å«é‡,åªæ˜¯ç¼ºå°‘æˆ‘ä»¬ä¸æ–­æ¢ç©¶æŠ€æœ¯çš„ç²¾ç¥,åœ¨è¿™é‡Œä¾‹å­ä¸­æˆ‘ä»¬å­¦åˆ°å¦‚ä½•åˆ©ç”¨å¾„å‘æ¸å˜å®ç°2Dä¸‹ç±»ä¼¼æµä½“ç¯å…‰çš„æ•ˆæœ.è¿™ä¸ªè¿‡ç¨‹ä¸­å¸Œæœ›å¤§å®¶èƒ½å­¦åˆ°æœ‰ç”¨çš„æŠ€æœ¯çŸ¥è¯†,å¥½äº†æ–‡ç« å°±å†™åˆ°è¿™é‡Œ,Demoå’Œå‚è€ƒæˆ‘æ”¾åœ¨ä¸‹æ–‡çš„é“¾æ¥é‡Œé¢,æ„Ÿå…´è¶£å¯ä»¥çœ‹çœ‹,æ„Ÿè°¢è§‚çœ‹.

[æœ¬æ–‡Demo](https://github.com/sunyazhou13/RadialGradientDemo)

[å¼•ç”¨CAGradientLayer Explained](https://ikyle.me/blog/2020/cagradientlayer-explained)  
[å¼•ç”¨Location](https://www.cnblogs.com/YouXianMing/p/3793913.html)





URL: https://sunyazhou.com/2022/12/thesunyazhoutheoryii/index.html.md
Published At: 2022-12-03 03:32:00 +0000

# ã€ŠThe Sunyazhou Theory â…¡ã€‹çš„è¯ç”Ÿ

![](/assets/images/20221203TheSunyazhouTheoryII/thesunyazhoutheoryii.webp)

# å‰è¨€

ç”±äºåŸºç¡€çŸ¥è¯†è–„å¼±ï¼Œæˆ‘æ‰€åšåˆ°çš„å†…å®¹ä»…é™äºå­¦ä¹ å’Œè§‚å¯Ÿåˆ°çš„ä¸€äº›äº‹å®ï¼Œæœªèƒ½ä¸Šå‡ä¸ºç†è®ºå­¦è¯´.

## éè‘—åçš„ã€ŠThe Sunyazhou Theory IIã€‹

æœªæ¥è‡ªåŠ¨é©¾é©¶å¿…é¡»ä¸”ä¸€å®šæ˜¯çœ¼ç›(æ‘„åƒå¤´)+è€³æœµ(é›·è¾¾è¶…å£°æ³¢æˆ–æ¿€å…‰)ä¸€èµ·ç”¨æ‰æ˜¯æœ€ä¼˜è§£ï¼Œè®¡ç®—æœºè§†è§‰+æ¿€å…‰é›·è¾¾ï¼Œæ¥å®ç°å®‰å…¨è½¦è§„çº§è‡ªåŠ¨é©¾é©¶ã€‚  

è®¡ç®—æœºè§†è§‰æœ€å¤šåªèƒ½è¯†åˆ«ç‰©ä½“è¡¨é¢ï¼Œç»è¿‡è®¡ç®—ç»“æœæŒ‡çº¹æ¯”å¯¹æ–¹å¼æ‰èƒ½å¾—çŸ¥å·²è¯†åˆ«åˆ°å·²çŸ¥ç‰©ä½“å¯†åº¦å’Œè´¨é‡(è¯†åˆ«åˆ°æœªçŸ¥ç‰©ä½“åˆ™æ˜¯ç›²åŒº)ï¼Œç›®å‰è¿˜åšä¸åˆ°æ„ŸçŸ¥ç‰©ä½“è¿œè¿‘è·ç¦»çš„ç²¾ç¡®åˆ°æ¯«ç±³çº§ï¼Œå³ä¾¿åšåˆ°äº†ä¹Ÿæ˜¯ç†è®ºçº§ï¼Œç»éç‰©ç†çº§ï¼Œè€Œè¶…å£°æ³¢é›·è¾¾åˆ™å¯ä»¥å¿«é€Ÿæ„ŸçŸ¥ï¼Œè¾¾åˆ°ç‰©ç†çº§æ„ŸçŸ¥ï¼Œè¿™æ‰æ˜¯å®ƒå­˜åœ¨çš„åˆç†æ€§ã€‚

--

ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘æˆç«‹å­™äºšæ´²ç¬¬äºŒç†è®ºï¼Œæœªæ¥è‡ªåŠ¨é©¾é©¶ä¸€å®šçœ¼ç›è€³æœµä¸€èµ·ç”¨ã€‚

ç›®å‰ä»¥æˆ‘è‚¤æµ…çš„è®¤çŸ¥è¿˜æ²¡å‡ºç°è¿™ä¸ªç³»ç»Ÿï¼Œæˆ‘åº”è¯¥äº«æœ‰`ä¼˜å…ˆå‘½åæƒ`:  

* `TSTâ…¡CVLRS` (The Sunyazhou Theory â…¡ Computer Vision Laser Radar System) å­™äºšæ´²ç¬¬äºŒç†è®ºè®¡ç®—æœºè§†è§‰æ¿€å…‰é›·è¾¾ç³»ç»Ÿ.

![](/assets/images/20221203TheSunyazhouTheoryII/laserladar1.webp)


> æ³¨:  
> è®¡ç®—æœºè§†è§‰æ˜¯ä¸€ç§å›¾å½¢å›¾åƒè¯†åˆ«æŠ€æœ¯ç§‘å­¦  
> æ¿€å…‰é›·è¾¾æ˜¯ä¸€ç§å‘å°„æ¿€å…‰æŸæ¢æµ‹ä½ç½®çš„é›·è¾¾ç³»ç»Ÿ


## éªŒè¯ç†è®º

æœªæ¥æ±½è½¦é¢†åŸŸå‡ åå¹´çš„å‘å±•ä¸­ä¼šé€æ¸éªŒè¯

# æ€»ç»“

æœ‰äº›æƒ³æ³•å¯èƒ½ç¨šå«©å¯ç¬‘, æˆ‘å–œæ¬¢è¡Œèƒœäºè¨€,ç”¨æ—¶ä»£å‘å±•æ¥éªŒè¯æˆ‘æ­¤åˆ»çš„ç»“è®ºæ˜¯å¦æ­£ç¡®.

é™„: ç›®å‰å›½å†…å„å®¶é€ è½¦æ–°åŠ¿åŠ›é›·è¾¾ä½¿ç”¨æƒ…å†µ


![](/assets/images/20221203TheSunyazhouTheoryII/laserladar2.webp)


[å‚è€ƒè‡ª ä¸­å›½å¸‚åœºæ•™æ¿€å…‰é›·è¾¾å…¬å¸åšç”Ÿæ„](https://www.ithome.com/0/658/343.htm)  
[å­™äºšæ´²ç†è®º](https://www.sunyazhou.com/2020/02/SunyazhouTheory/)





URL: https://sunyazhou.com/2022/11/swiftuipropertywrapper/index.html.md
Published At: 2022-11-25 10:45:00 +0000

# SwiftUIå±æ€§åŒ…è£…å™¨:Stateã€Bindingã€ObservableObjectã€EnvironmentObject

![](/assets/images/20221125SwiftUIPropertyWrapper/swiftUIPropertyWrappers.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



## ä¸»è¦å†…å®¹

æœ¬æ–‡ä¸»è¦è®²è¿°SwiftUIä¸­çš„å±æ€§åŒ…è£…å™¨ï¼Œè¿™äº›åŒ…è£…å™¨éƒ½æ˜¯ç”¨æ¥æ•°æ®ç»‘å®šçš„ï¼Œä½œä¸ºè§†å›¾çš„å”¯ä¸€çœŸå€¼æ¥æºï¼Œå››ç§æ–¹å¼åœ¨å®ç°åŠŸèƒ½ä¸Šæœ‰ç»†å¾®å·®åˆ«ã€‚æœ€åä¼šè¿›è¡Œæ€»ç»“æ¯”è¾ƒ

* State
* Binding
* ObservableObject
* EnvironmentObject

#### 1.@State

SwiftUIç®¡ç†å£°æ˜ä¸º`state`çš„å­˜å‚¨å±æ€§ã€‚å½“å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`SwiftUI`ä¼šæ›´æ–°è§†å›¾å±‚æ¬¡ç»“æ„ä¸­ä¾èµ–äºè¯¥å€¼çš„éƒ¨åˆ†ã€‚ä½¿ç”¨`@State`ä½œä¸ºå­˜å‚¨åœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­çš„ç»™å®šå€¼çš„å”¯ä¸€çœŸå€¼æ¥æºã€‚

`@State`ä¿®é¥°çš„å±æ€§è™½ç„¶æ˜¯å­˜å‚¨å±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œã€‚  

çˆ¶è§†å›¾å’Œå­è§†å›¾è¿›è¡Œä¼ é€’è¯¥å±æ€§åªèƒ½æ˜¯å€¼ä¼ é€’ã€‚  

éœ€è¦åœ¨å±æ€§åç§°å‰åŠ ä¸Šä¸€ä¸ªç¾å…ƒç¬¦å·$æ¥è·å¾—è¿™ä¸ªå€¼ã€‚å› ä¸ºå®ƒæ˜¯æŠ•å½±å±æ€§

ä»£ç ï¼š

``` swift
struct ContentView: View {
    @State private var str: String = ""
    var body: some View {
        VStack {
            TextField("Placeholder", text: $str)
            Text("\(str)")
        }
    }
}
```

è¯´æ˜:

1. åœ¨strä¸Šè®¾ç½®äº†@Stateä¿®é¥°ï¼Œé‚£ä¹ˆæˆ‘åœ¨æ–‡æœ¬è¾“å…¥æ¡†ä¸­è¾“å…¥çš„æ•°æ®ï¼Œå°±ä¼šä¼ å…¥åˆ°strä¸­
2. åŒæ—¶stråˆç»‘å®šåœ¨æ–‡æœ¬è§†å›¾ä¸Šï¼Œæ‰€ä»¥ä¼šå°†æ–‡æœ¬è¾“å…¥æ¡†è¾“å…¥çš„æ–‡æœ¬æ˜¾ç¤ºåˆ°æ–‡æœ¬è§†å›¾ä¸Š
3. è¿™å°±æ˜¯æ•°æ®ç»‘å®šçš„å¿«æ·å®ç°ã€‚

> æ³¨æ„:     

> * ä¸è¦åœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­å®ä¾‹åŒ–è§†å›¾çš„ä½ç½®åˆå§‹åŒ–è§†å›¾çš„çŠ¶æ€å±æ€§ï¼Œå› ä¸ºè¿™å¯èƒ½ä¸SwiftUIæä¾›çš„å­˜å‚¨ç®¡ç†å†²çªã€‚  
> * ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæ€»æ˜¯å°†stateå£°æ˜ä¸ºprivateï¼Œå¹¶å°†å…¶æ”¾åœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­éœ€è¦è®¿é—®è¯¥å€¼çš„æœ€é«˜è§†å›¾ä¸­ã€‚  
> *  ç„¶åä¸ä»»ä½•ä¹Ÿéœ€è¦è®¿é—®çš„å­è§†å›¾å…±äº«è¯¥çŠ¶æ€ï¼Œå¯ä»¥ç›´æ¥ç”¨äºåªè¯»è®¿é—®ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¯»å†™è®¿é—®çš„ç»‘å®šã€‚


#### 2. Binding

`@State`ä¿®é¥°çš„å±æ€§æ˜¯å€¼ä¼ é€’ï¼Œå› æ­¤åœ¨çˆ¶è§†å›¾å’Œå­è§†å›¾ä¹‹é—´ä¼ é€’å±æ€§æ—¶ã€‚å­è§†å›¾é’ˆå¯¹å±æ€§çš„ä¿®æ”¹æ— æ³•ä¼ é€’åˆ°çˆ¶è§†å›¾ä¸Šã€‚  

`Binding`ä¿®é¥°åä¼šå°†å±æ€§ä¼šå˜ä¸ºä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œè§†å›¾ä¹‹é—´çš„ä¼ é€’ä»å€¼ä¼ é€’å˜ä¸ºäº†å¼•ç”¨ä¼ é€’ï¼Œå°†çˆ¶è§†å›¾å’Œå­è§†å›¾çš„å±æ€§å…³è”èµ·æ¥ã€‚è¿™æ ·å­è§†å›¾é’ˆå¯¹å±æ€§çš„ä¿®æ”¹ï¼Œä¼šä¼ é€’åˆ°çˆ¶è§†å›¾ä¸Šã€‚

éœ€è¦åœ¨å±æ€§åç§°å‰åŠ ä¸Šä¸€ä¸ªç¾å…ƒç¬¦å·$æ¥è·å¾—è¿™ä¸ªå€¼ã€‚å› ä¸ºå®ƒæ˜¯æŠ•å½±å±æ€§

ä¸‹é¢ä»£ç åœ¨ä¸»è§†å›¾ä¸Šæ·»åŠ ä¸€ä¸ª`BtnView`è§†å›¾ï¼Œè§†å›¾ä¸Šæ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼ŒæŒ‰é’®ç‚¹å‡»åä¿®æ”¹`isShowText`å˜é‡ã€‚è¿™é‡Œçš„å˜é‡é€šè¿‡ä¼ å…¥å‚æ•°ä¸ä¸»è§†å›¾çš„`isShowText`è¿›è¡Œç»‘å®šã€‚ç»‘å®šåˆ°ä¸»è§†å›¾çš„`isShowText`å˜é‡ä¸Šã€‚ä¸»è§†å›¾çš„å˜é‡ç”¨æ¥å†³å®šæ–‡æœ¬è§†å›¾çš„éšè—å’Œæ˜¾ç¤ºã€‚

ç¤ºä¾‹ä»£ç :

``` swift
struct BtnView: View {
    @Binding var isShowText: Bool
    
    var body: some View {
        Button {
            isShowText.toggle()
        } label: {
            Text("ç‚¹å‡»")
        }

    }
}

struct ContentView: View {
    @State private var isShowText: Bool = true
    var body: some View {
        VStack {
            if(isShowText) {
                Text("ç‚¹å‡»åä¼šè¢«éšè—")
            } else {
                Text("ç‚¹å‡»åä¼šè¢«æ˜¾ç¤º").hidden()
            }
            BtnView(isShowText: $isShowText)
        }
    }
}
```

è¯´æ˜:

1. æŒ‰é’®åœ¨BtnViewè§†å›¾ä¸­ï¼Œå¹¶ä¸”é€šè¿‡ç‚¹å‡»ï¼Œä¿®æ”¹isShowTextçš„å€¼ã€‚
2. å°†BtnViewè§†å›¾æ·»åŠ åˆ°ContentViewä¸Šä½œä¸ºå®ƒçš„å­è§†å›¾ã€‚å¹¶ä¸”ä¼ å…¥isShowTextã€‚
3. æ­¤æ—¶çš„ä¼ å€¼æ˜¯æŒ‡é’ˆä¼ é€’ï¼Œä¼šå°†ç‚¹å‡»åçš„å±æ€§å€¼ä¼ é€’åˆ°çˆ¶è§†å›¾ä¸Šã€‚
4. çˆ¶è§†å›¾æ‹¿åˆ°åä¹Ÿä½œç”¨åœ¨è‡ªå·±çš„å±æ€§ï¼Œå› æ­¤ä»–çš„æ–‡æœ¬è§†å›¾ä¼šä¾æ®è¯¥å±æ€§è€Œéšè—æˆ–æ˜¾ç¤º
5. å¦‚æœå°†`@Binding`æ”¹ä¸º`@State`ï¼Œä¼šå‘ç°ç‚¹å‡»åä¸èµ·ä½œç”¨ã€‚è¿™æ˜¯å› ä¸ºå€¼ä¼ é€’å­è§†å›¾çš„æ›´æ”¹ä¸ä¼šåæ˜ åˆ°çˆ¶è§†å›¾ä¸Š

#### 3.@ObservableObject

å¯¹å®ä¾‹è¿›è¡Œç›‘å¬ï¼Œå…¶ç”¨å¤„å’Œ@Stateéå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡å¿…é¡»æ˜¯å¯¹è±¡ï¼Œè€Œä¸”è¿™ä¸ªè¢«ç›‘å¬çš„å¯¹è±¡å¯ä»¥è¢«å¤šä¸ªè§†å›¾ä½¿ç”¨ã€‚éœ€è¦æ³¨æ„ç”¨æ³•

``` swift
class DelayedUpdater: ObservableObject {
    @Published var value = 0
    init() {
        for i in 1...10 {
            DispatchQueue.main.asyncAfter(deadline: .now() + Double(i)) {
                self.value += 1
            }
        }
    }
}

struct ContentView: View {
    @ObservedObject var updater = DelayedUpdater()
    var body: some View {
        VStack {
            Text("\(updater.value)").padding()
        }
    }
}
```

è¯´æ˜:

1. ç»‘å®šçš„æ•°æ®æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚
2. è¢«ä¿®é¥°çš„å¯¹è±¡ï¼Œå…¶ç±»å¿…é¡»éµå®ˆObservableObjectåè®®
3. æ­¤æ—¶è¿™ä¸ªç±»ä¸­è¢«@Publishedä¿®é¥°çš„å±æ€§éƒ½ä¼šè¢«ç»‘å®š
4. ä½¿ç”¨@ObservedObjectä¿®é¥°è¿™ä¸ªå¯¹è±¡ï¼Œç»‘å®šè¿™ä¸ªå¯¹è±¡ã€‚
5. è¢«@Publishedä¿®é¥°çš„å±æ€§å‘ç”Ÿæ”¹å˜æ—¶ï¼ŒSwiftUIå°±ä¼šè¿›è¡Œæ›´æ–°ã€‚
6. è¿™é‡Œå½“valueå€¼ä¼šéšç€æ—¶é—´å‘ç”Ÿæ”¹å˜ã€‚æ‰€ä»¥updaterå¯¹è±¡ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ã€‚æ­¤æ—¶æ–‡æœ¬è§†å›¾çš„å†…å®¹å°±ä¼šä¸æ–­æ›´æ–°ã€‚

#### 4.@EnvironmentObject

åœ¨å¤šè§†å›¾ä¸­ï¼Œä¸ºäº†é¿å…æ•°æ®çš„æ— æ•ˆä¼ é€’ï¼Œå¯ä»¥ç›´æ¥å°†æ•°æ®æ”¾åˆ°ç¯å¢ƒä¸­ï¼Œä¾›å¤šä¸ªè§†å›¾è¿›è¡Œä½¿ç”¨ã€‚

``` swift
struct EnvView: View {
    @EnvironmentObject var updater: DelayedUpdater
    
    var body: some View {
        Text("\(updater.value)")
    }
}

struct BtnvView: View {
    @EnvironmentObject var updater: DelayedUpdater
    
    var body: some View {
        Text("\(updater.value)")
    }
}
struct ContentView: View {
    let updater = DelayedUpdater()
    var body: some View {
        VStack {
            EnvView().environmentObject(updater)
            BtnvView().environmentObject(updater)
        }
    }
}

```

è¯´æ˜ï¼š

* ç»™å±æ€§æ·»åŠ @EnvironmentObjectä¿®æ”¹ï¼Œå°±å°†å…¶æ”¾åˆ°äº†ç¯å¢ƒä¸­ã€‚
* å…¶ä»–è§†å›¾ä¸­æƒ³è¦è·å–è¯¥å±æ€§ï¼Œå¯ä»¥é€šè¿‡.environmentObjectä»ç¯å¢ƒä¸­è·å–ã€‚
* å¯ä»¥çœ‹åˆ°åˆ†åˆ«å°†EnvViewå’ŒBtnvViewçš„å±æ€§åˆ†åˆ«æ”¾åˆ°äº†ç¯å¢ƒä¸­
* ä¹‹åæˆ‘ä»¬ContentViewè§†å›¾ä¸­è·å–æ•°æ®æ—¶ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ç¯å¢ƒè·å–ã€‚
* ä¸éœ€è¦å°†æ•°æ®ä¼ é€’åˆ°ContentViewï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç¯å¢ƒè·å–ï¼Œè¿™æ ·é¿å…äº†æ— æ•ˆçš„æ•°æ®ä¼ é€’ï¼Œæ›´åŠ é«˜æ•ˆ
* å¦‚æœæ˜¯åœ¨å¤šå±‚çº§è§†å›¾ä¹‹é—´è¿›è¡Œä¼ é€’ï¼Œä¼šæœ‰æ›´æ˜æ˜¾çš„æ•ˆæœã€‚


# æ€»ç»“

* @Stateå°†å±æ€§å’Œè§†å›¾è¿›è¡Œç»‘å®šï¼Œæ˜¯å”¯ä¸€çœŸå®æ•°æ®æºã€‚å­è§†å›¾å’Œçˆ¶è§†å›¾ä¹‹é—´æ˜¯å€¼ä¼ é€’
* @Bindingåœ¨å­è§†å›¾å’Œçˆ¶è§†å›¾ä¹‹é—´æ˜¯æŒ‡é’ˆä¼ é€’
* @ObservableObjectåªèƒ½ç›‘å¬å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨å¤šä¸ªè§†å›¾ä¸­ç›‘å¬
* @EnvironmentObjectå°†æ•°æ®æ”¾åˆ°ç¯å¢ƒä¸­ï¼Œæ›´é€‚ç”¨åœ¨å¤šè§†å›¾ä¸­

[å‚è€ƒSwiftUIæ•™ç¨‹ï¼ˆä¸ƒï¼‰å±æ€§åŒ…è£…å™¨](https://juejin.cn/post/7112984613102092325)  
[SwiftUIæ•™ç¨‹ç³»åˆ—æ–‡ç« æ±‡æ€»](https://juejin.cn/post/7110918270743478279)



URL: https://sunyazhou.com/2022/09/howtousensoptions/index.html.md
Published At: 2022-09-16 09:02:00 +0000

# NS-OPTIONSçš„ç”¨æ³•

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


#### å®šä¹‰:

``` objc
typedef NS_OPTIONS(NSUInteger, MyOption) {
  MyOptionNone = 0, //äºŒè¿›åˆ¶0000,åè¿›åˆ¶0
  MyOption1 = 1 << 0,//0001,1
  MyOption2 = 1 << 1,//0010,2
  MyOption3 = 1 << 2,//0100,4
  MyOption4 = 1 << 3,//1000,8
};
```


#### ä½¿ç”¨

``` objc
//å£°æ˜å®šä¹‰æšä¸¾å˜é‡
MyOption option = MyOption1 | MyOption2;//0001 | 0010 = 0011,3

//æ£€æŸ¥æ˜¯å¦åŒ…å«æŸé€‰å‹
if (option & MyOption3) { //0011 & 0100 = 0000
     //åŒ…å«MyOption3
} else {
     //ä¸åŒ…å«MyOption3
}

//å¢åŠ é€‰é¡¹
option = option | MyOption4;//0011 | 1000 = 1011, 11
//å‡å°‘é€‰é¡¹
option = option & (~MyOption4);//1011 & (~1000) = 1011 & 0111 = 0011, 3

//é™¤äº†MyOption2ä»¥å¤–éƒ½æ¢å¤åˆ°é»˜è®¤  
option =  option & MyOption2
// ç›¸å½“äºæ“¦é™¤ MyOption2ä»¥å¤–çš„æ‰€æœ‰å€¼åªä¿ç•™MyOption2
option &= MyOption2
// ä¹Ÿç›¸å½“äº
option = MyOption2


```

#### æšä¸¾ç¤ºä¾‹ä»£ç ç‰‡æ®µ(å¯å¤åˆ¶ä½¿ç”¨)

``` objc
typedef NS_OPTIONS(NSUInteger, YZOptionsFlag) {
    YZOptionsFlagNone            = 0,       //äºŒè¿›åˆ¶0000,åè¿›åˆ¶0
    YZOptionsFlagNormal          = 1 <<  0, //0001,1 å¸¸è§„çŠ¶æ€ ä¸‹é¢ä»¥æ­¤ç±»æ¨
    YZOptionsFlag1               = 1 <<  1, //0010,2 
    YZOptionsFlag2               = 1 <<  2, // 
    YZOptionsFlag3               = 1 <<  3, // 
    YZOptionsFlag4               = 1 <<  4, // 
    YZOptionsFlag5               = 1 <<  5, // 
    YZOptionsFlag6               = 1 <<  6, // 
    YZOptionsFlag7               = 1 <<  7, // 
//    YZOptionsFlag              = 1 <<  8, //
//    YZOptionsFlag              = 1 <<  9, //
//
//    YZOptionsFlag              = 0 << 16, //
//    YZOptionsFlag              = 1 << 16,
//    YZOptionsFlag              = 2 << 16,
//    YZOptionsFlag              = 3 << 16,
//
//    YZOptionsFlag              = 0 << 20, //
//    YZOptionsFlag              = 1 << 20,
//    YZOptionsFlag              = 2 << 20,
//    YZOptionsFlag              = 3 << 20,
//    YZOptionsFlag              = 4 << 20,
//    YZOptionsFlag              = 5 << 20,
//    YZOptionsFlag              = 6 << 20,
//    YZOptionsFlag              = 7 << 20,
//
//    YZOptionsFlag              = 0 << 24,
//    YZOptionsFlag              = 3 << 24,
//    YZOptionsFlag              = 7 << 24,
} API_AVAILABLE(ios(4.0));

```


URL: https://sunyazhou.com/2022/09/fbmemorychecktool/index.html.md
Published At: 2022-09-16 02:11:00 +0000

# FBå†…å­˜æ£€æµ‹å·¥å…·åˆ†äº«

![](/assets/images/20220916FBMemoryCheckTool/FBMemoryProfiler.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## è®¨è®º

å¦‚æœç”³è¯·ä¸€å¤§å—å†…å­˜æ²¡æœ‰è¢«releaseè¿™å±äºå†…å­˜æ³„æ¼,å¹¶ä¸å±äºå†…å­˜ç«äº‰å¯¼è‡´çš„æŒæœ‰,æ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰æ­£ç¡®çš„release.
åœ¨å¸¸è§„æµç¨‹ä¸‹(æ­£å¸¸ alloc,releaseæˆ–è€… malloc free,äº¦æˆ–æ˜¯ new  delete)åˆç†ä½¿ç”¨å†…å­˜,é€ æˆå†…å­˜æ³„æ¼çš„æœ€ä¸»è¦åŸå› æ˜¯èµ„æºçš„ç«äº‰é€ æˆçš„ç›¸äº’æŒæœ‰.è¿™æ˜¯è¯±å› å¯¼è‡´ èµ„æºæ²¡æœ‰è¢«æ­£å¸¸é‡Šæ”¾. æ­¤å·¥å…·æ“…é•¿è§£å†³ ç›¸äº’æŒæœ‰å…³ç³»ä¸é‡Šæ”¾å†…å­˜é—®é¢˜,ç²¾ç¡®åˆ°å®ä¾‹ç±»å‹å’Œå†…å­˜åœ°å€,å¹¶ç›´è§‚çœ‹åˆ° æ‰¾åˆ°ç›¸å…³å¯¹è±¡.

## å†…å­˜æ£€æµ‹å·¥å…·-ä»‹ç»

* FBMemoryProfiler  
	> FBMemoryProfiler æ˜¯å‡ ä¸ªç»„ä»¶çš„ç»“åˆã€‚å…¶ä¸­åŒ…æ‹¬ FBAllocationTracker å’Œ FBRetainCycleDetectorã€‚
 å¯è§†åŒ–å·¥å…·ï¼Œç›´æ¥åµŒå…¥åˆ° App ä¸­ï¼Œå¯ä»¥èµ·åˆ°åœ¨ App ä¸­ç›´æ¥æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶ç­›é€‰æ½œåœ¨æ³„æ¼å¯¹è±¡çš„ä½œç”¨

* FBAllocationTracker  
 > ä¸»è¦ç”¨äºå¿«é€Ÿæ£€æµ‹æ½œåœ¨çš„å†…å­˜æ³„æ¼å¯¹è±¡ï¼Œå¹¶æä¾›ç»™ FBRetainCycleDetector è¿›è¡Œæ£€æµ‹
 è¿™æ˜¯ä¸€ä¸ªç”¨æ¥ä¸»åŠ¨è¿½è¸ªæ‰€æœ‰ NSObject çš„å­ç±»çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾æ“ä½œçš„å·¥å…·ã€‚
 
 > FBAllocationTracker ç”¨äºæ£€æµ‹åº”ç”¨åœ¨è¿è¡Œæ—¶æ‰€æœ‰å®ä¾‹çš„åˆ†é…ã€‚å®ƒçš„åŸç†å…¶å®å°±æ˜¯ç”¨ method swizzling æ›¿æ¢åŸæœ¬çš„ alloc æ–¹æ³•ã€‚è¿™æ ·å°±å¯ä»¥è®°å½•ä¸‹æ‰€æœ‰çš„å®ä¾‹åˆ†é…äº†ã€‚
 
 >  åœ¨éœ€è¦çš„æ—¶å€™è°ƒç”¨ currentAllocationSummary æ–¹æ³•ï¼Œå°±å¯ä»¥å¾—åˆ°å½“å‰æ•´ä½“çš„å®ä¾‹åˆ†é…æƒ…å†µï¼ˆå‰ææ˜¯åœ¨ main ä¸­åˆå§‹åŒ–è¿‡ï¼Œä¸‹é¢æœ‰ä»‹ç»ï¼‰ï¼š
 	
 	``` objc
 	NSArray<FBAllocationTrackerSummary *> *summaries = [[FBAllocationTrackerManager sharedManager] currentAllocationSummary];
 	```
 
* FBRetainCycleDetector
 >  FBRetainCycleDetector æ¥å—ä¸€ä¸ªè¿è¡Œæ—¶çš„å®ä¾‹ï¼Œç„¶åä»è¿™ä¸ªå®ä¾‹å¼€å§‹éå†å®ƒæ‰€æœ‰çš„å±æ€§ï¼Œé€çº§é€’å½’ã€‚ å¦‚æœå‘ç°éå†åˆ°é‡å¤çš„å®ä¾‹ï¼Œå°±è¯´æ˜å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œå¹¶ç»™å‡ºæŠ¥å‘Šã€‚

 ``` objc
  FBRetainCycleDetector *detector = [FBRetainCycleDetector new];
 [detector addCandidate:myObject];
 NSSet *retainCycles = [detector findRetainCycles];
 NSLog(@"%@", retainCycles);

 ```
 

## ä»£ç æ£€æµ‹å¾ªç¯å¼•ç”¨-åŸç†

åœ¨è¿è¡Œæ—¶ä¸­æ£€æµ‹å¯¹è±¡ çš„å†…å­˜å¸ƒå±€,å®ä¾‹åœ°å€ 

``` objc
const char *class_getIvarLayout(Class cls);
const char *class_getWeakIvarLayout(Class cls);
```
>  support for Objective-C++

ä»£ç ä¸­ä½¿ç”¨

``` objc
FBRetainCycleDetector *detector = [[FBRetainCycleDetector alloc] initWithConfiguration:nil];
[detector addCandiate:myObject];
NSSet<NSArray<FBObjectiveCGraphElement *> *> *retainCycles = [detector findRetainCycles];
NSLog(@"%@", retainCycles);
```  
> è¿™é‡Œçš„ `myObject `ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰€æ€€ç–‘çš„å®ä¾‹å˜é‡

`FBObjectiveCGraphElement` æ˜¯æ‰€æœ‰ç”¨æ¥æŸ¥æ‰¾å¯¹è±¡ç±»å‹çš„åŸºç±»ã€‚æ‰€æœ‰çš„æŸ¥æ‰¾å¯¹è±¡éƒ½åŸºäºå®ƒå®ç°ã€‚è¯¥ç±»å¹¶ä¸éœ€è¦å¤–éƒ¨çš„è°ƒç”¨ï¼Œä¸»è¦æ˜¯ä¾›å†…éƒ¨æŸ¥è¯¢ä½¿ç”¨ã€‚å…¶æä¾›çš„åŠŸèƒ½ä¸»è¦æ˜¯ï¼š

* æä¾›åˆå§‹åŒ–æ–¹æ³•å°è£…`object`ï¼ˆå³è°ƒç”¨`addCandiate`ä¼ å…¥çš„`object`ï¼‰
* è·å–æ‰€æœ‰è¯¥å¯¹è±¡æ‰€æŒæœ‰å¯¹è±¡`- (NSSet *)allRetainedObjects;`ã€‚
åŸºç±»`FBObjectiveCGraphElement`æ‰€è·å–çš„å¯¹è±¡ç±»å‹æ˜¯é€šè¿‡`associated object`æ‰€æŒæœ‰çš„å¯¹è±¡ã€‚ `associated object`å¯¹è±¡çš„è·å–æ˜¯é€šè¿‡`Facebook`è‡ªèº«çš„`fishhook`å»`hook`åŸå…ˆçš„`objc_setAssociatedObject`å’Œ`objc_removeAssociatedObjects`æ¥å®ç°å¯¹è±¡çš„æŒæœ‰æ ‡è®°ã€‚
* æä¾›è¿‡æ»¤æ¥å£`- (NSSet *)filterObjects:(nullable NSArray *)objects`;ï¼Œè¿‡æ»¤æ¥å£ä¸»è¦æ˜¯ä¸`FBObjectGraphConfiguration`ç›¸ç»“åˆä½¿ç”¨ï¼Œ`FBObjectGraphConfiguration`ä¼šåœ¨ä¸‹æ–‡ä»‹ç»ã€‚

`FBObjectGraphConfiguration ` æ˜¯æä¾›è¿‡æ»¤ç›¸å…³ç™½åå•çš„ç±»,ç›¸å…³çš„é…ç½®

å…¶ä½™çš„ä¸å°±åœ¨è¿™é‡Œè¿‡å¤šä»‹ç»äº†.

#### findRetainCyclesæŸ¥è¯¢æ–¹å¼ - DFSæ·±åº¦ä¼˜å…ˆ

è¿™é‡ŒæŸ¥æ‰¾å¯¹è±¡çš„æ–¹å¼ç”¨çš„æ˜¯æ·±åº¦ä¼˜å…ˆéå†æœç´¢

![](/assets/images/20220916FBMemoryCheckTool/retainCycle.gif)


## å¦‚ä½•ä½¿ç”¨

![](/assets/images/20220916FBMemoryCheckTool/retainCycle1.gif)

ç¤ºä¾‹åœºæ™¯åˆ†æ

![](/assets/images/20220916FBMemoryCheckTool/retainCycle2.webp)

ç¤ºä¾‹ä»£ç 

``` objc
@property (nonatomic, strong) NSTimer *timer;
@property(copy,nonatomic)NSString *name;

 self.timer = [NSTimer scheduledTimerWithTimeInterval:0.1
                                              target:self
                                            selector:@selector(handleTimer)
                                            userInfo:nil
                                             repeats:YES];

- (void)handleTimer
{
     self.name = @"123";
}
```

å‚è€ƒ

[FBRetainCycleDetectoråˆ†æ](https://www.jianshu.com/p/bdce04214cf3)  
[automatic-memory-leak-detection-on-ios](https://engineering.fb.com/2016/04/13/ios/automatic-memory-leak-detection-on-ios/)


URL: https://sunyazhou.com/2022/08/nsstringenum/index.html.md
Published At: 2022-08-22 11:23:00 +0000

# iOSå¼€å‘ä¸­çš„å­—ç¬¦ä¸²æšä¸¾

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



# æšä¸¾


åœ¨`Objective-C`ä¸­å¹¶æ²¡æœ‰ä¸€ä¸ªä¸“é—¨çš„ç±»å‹æ¥å®šä¹‰å­—ç¬¦ä¸²æšä¸¾.æˆ‘ä»¬å¸¸ç”¨çš„æšä¸¾éƒ½æ˜¯æ•´å½¢,å¹¶ä¸”è‡ªåŠ¨ä¼¸é•¿ç´¯åŠ +1.

``` objc
typedef NS_ENUM(NSInteger, YZAnimationType) {
    YZAnimationTypeDefault = 0,
    YZAnimationType1       = 1,
    YZAnimationType2       = 2,
    YZAnimationType3       = 3,
    YZAnimationType4       = 4,
    YZAnimationTypeCount,
};
```

åœ¨C++ä¸­æœ‰ä¸“é—¨çš„æšä¸¾ç±»,ä½†æ˜¯åœ¨iOSçš„objcä¸­å¹¶æ²¡æœ‰C++ä¸­çš„ä¸“é—¨æšä¸¾ç±»,ä»Šå¤©å°±æ¥å­¦ä¹ ä¸€ä¸ªå¸¸é‡å­—ç¬¦ä¸²å­—é¢é‡å®šä¹‰çš„æšä¸¾ç±»å‹

æˆ‘ä»¬æ–°å»ºä¸€ä¸ªclass, å°±å«`YZEnumConst.h`,ç„¶å å†™ä¸Šä»¥ä¸‹ä»£ç 

``` objc
#import <Foundation/Foundation.h>

typedef NSString * const kComponentMessage NS_STRING_ENUM;
FOUNDATION_EXPORT kComponentMessage const kComponentMessageXXXXX;
```

åœ¨`YZEnumConst.m`ä¸­ å†™ä¸Š

``` objc
kComponentMessage const kComponentMessageXXXXX = @"ComponentMessageXXXXX";

```

è¿™æ ·é€šè¿‡ç±»å‹åˆ«åçš„å½¢å¼å°±æ„æˆäº† objcä¸­çš„å­—ç¬¦ä¸²æšä¸¾ç±»å‹.

> æ³¨æ„: å£°æ˜å¿…é¡»åœ¨`.h`ä¸­,å®ç°å¿…é¡»åœ¨`.m`ä¸­,è¿™æ ·æ‰ä¸ä¼šé€ æˆæ‰¾ä¸åˆ°ç¬¦å·ç¼–è¯‘æŠ¥é”™.


è¿™é‡Œå¤§å®¶ä¼šæ³¨æ„åˆ°æœ‰ä¸ªå…³é”®å­— `NS_STRING_ENUM `å’Œ`FOUNDATION_EXPORT`

* `NS_STRING_ENUM `ä»£è¡¨ ç±»å‹ ä¸“ç”¨äºæšä¸¾å­—ç¬¦ä¸²
* `FOUNDATION_EXPORT`ä»£è¡¨ å¯¹å¤–æš´æ¼å£°æ˜ çš„å­—ç¬¦ä¸²å¸¸é‡.

ç»“åˆä»¥ä¸Šä½¿ç”¨è§„åˆ™æˆ‘ä»¬å¯ä»¥å‚è€ƒä¸€ä¸‹è‹¹æœå†…éƒ¨çš„å®šä¹‰,ä¾‹å¦‚åŠ¨ç”»å¸¸ç”¨çš„å·®æ—¶å™¨å¸¸é‡.

``` objc
typedef NSString * CAMediaTimingFunctionName NS_TYPED_ENUM;
CA_EXTERN CAMediaTimingFunctionName const kCAMediaTimingFunctionLinear
    API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));
CA_EXTERN CAMediaTimingFunctionName const kCAMediaTimingFunctionEaseIn
    API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));
CA_EXTERN CAMediaTimingFunctionName const kCAMediaTimingFunctionEaseOut
    API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));
CA_EXTERN CAMediaTimingFunctionName const kCAMediaTimingFunctionEaseInEaseOut
    API_AVAILABLE(macos(10.5), ios(2.0), watchos(2.0), tvos(9.0));
CA_EXTERN CAMediaTimingFunctionName const kCAMediaTimingFunctionDefault
    API_AVAILABLE(macos(10.6), ios(3.0), watchos(2.0), tvos(9.0));
```

`CA_EXTERN `å®šä¹‰åœ¨`<CoreGraphics/CGBase.h>`ä¸­

``` objc
#ifndef CA_EXTERN
# define CA_EXTERN extern __attribute__((visibility("default")))
#endif
```

è¿™é‡Œçš„å®ç°æ˜¯å‚ç…§è‹¹æœçš„å·®æ—¶å™¨å­—ç¬¦ä¸²æšä¸¾å®ç°çš„.

# æ€»ç»“

å¼€å‘è¿‡ç¨‹ä¸­è®°å½•ä¸€äº›æœ‰ä»·å€¼çš„çŸ¥è¯†ç‚¹,å½“ä½¿ç”¨æ—¶æ‰èƒ½æ›´åŠ å¿«é€Ÿçš„å®Œæˆå·¥ä½œ,æé«˜å·¥ä½œæ•ˆç‡.


[å‚è€ƒ åˆæ¢ `NS_STRING_ENUM`](https://juejin.cn/post/6844903638226173966)


URL: https://sunyazhou.com/2022/08/checkcellscrolloutscreen/index.html.md
Published At: 2022-08-01 14:08:00 +0000

# æ£€æŸ¥Cellæ˜¯å¦æ»šåŠ¨å‡ºå±å¹•ä¹‹å¤–

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## å¦‚ä½•æ£€æµ‹ä¸€ä¸ªcellæ»‘åŠ¨åˆ°å±å¹•ä»¥å¤–?


``` objc

//åˆ¤æ–­cellè§†å›¾æ˜¯å¦åœ¨å±å¹•ä¸Š.ä¸åœ¨çš„è¯åœæ­¢æ’­æ”¾
- (void)scrollViewDidScroll:(UIScrollView *)scrollView{
    if (_currentPlayIndexPath) {
        CGRect cellR = [self.tableViewrectForRowAtIndexPath:_currentPlayIndexPath];
        if(scrollView.contentOffset.y > cellR.origin.y + cellR.size.height || scrollView.contentOffset.y < cellR.origin.y - scrollView.frame.size.height){
            _currentPlayIndexPath = nil;
            //åšä¸€äº› æ»šåŠ¨å‡ºå±å¹•ä»¥å¤–çš„é€»è¾‘ä»£ç 
        }
        NSLog(@"-------:%@",NSStringFromCGPoint(scrollView.contentOffset));
    }
}

```



URL: https://sunyazhou.com/2022/07/iosinterviewproblems/index.html.md
Published At: 2022-07-14 00:58:00 +0000

# iOSé¢è¯•é—®é¢˜è®°å½•

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## NSObject Categoryé—®é¢˜

å¦‚æœä¸€ä¸ªç»™NSObjectå¯¹è±¡æ‰©å±•Category, ä¸‹é¢çš„ä»£ç èƒ½è°ƒç”¨å—ï¼Ÿ

``` objc
#import <Foundation/Foundation.h>

@interface NSObject (Test)

+ (void)test;

@end

@implementation NSObject (Test)

- (void)test {
    NSLog(@"11111");
}

@end

```

è°ƒç”¨ä»£ç 

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    [NSObject test];
}
```

æ‰“å°ç»“æœ

``` sh
2022-07-14 09:03:41.039406+0800 UIViewTest[1700:16744] 11111
```

#### ç­”æ¡ˆ

å› ä¸ºå¯¹è±¡çš„`isa`æŒ‡é’ˆæœ€ç»ˆæŒ‡å‘å…ƒç±»,å…ƒç±»ä¹Ÿå°±æ˜¯è‡ªå·±çš„å®ä¾‹,æ‰€ä»¥ä¼šè°ƒç”¨åˆ°å®ä¾‹æ–¹æ³•ã€‚

## Blocké—®é¢˜

ä¸‹é¢æ‰“å°ç»“æœæ˜¯ä»€ä¹ˆæ ·çš„,åœ°å€æŒ‡é’ˆè°å’Œè°ç›¸åŒ.

``` objc
__block int a = 10;
NSLog(@"begin %d, %p",a,&a);
dispatch_async(dispatch_get_main_queue(), ^{
    NSLog(@"in block %d, %p",a,&a);
});
a = 20;
NSLog(@"end %d, %p",a,&a);
```

ç»“æœ

``` sh
2022-07-14 09:09:04.562941+0800 UIViewTest[2035:23455] begin 10, 0x30998ff08
2022-07-14 09:09:04.563160+0800 UIViewTest[2035:23455] end 20, 0x600003973538
2022-07-14 09:09:04.652175+0800 UIViewTest[2035:23455] in block 20, 0x600003973538

```


## çº¿ç¨‹é—®é¢˜

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    dispatch_queue_t queue = dispatch_queue_create("test", DISPATCH_QUEUE_SERIAL);
    dispatch_async(queue, ^{
        sleep(5);
        NSLog(@"1");
    });
    dispatch_sync(queue, ^{
        sleep(3);
        NSLog(@"2");
    });
    sleep(1);
    NSLog(@"3");
}
```

æ‰“å°ç»“æœ

``` sh
2022-07-14 09:12:46.798861+0800 UIViewTest[2179:26391] 1
2022-07-14 09:12:49.801871+0800 UIViewTest[2179:26296] 2
2022-07-14 09:12:50.804045+0800 UIViewTest[2179:26296] 3
```

è§£ç­”

åŒæ­¥ä»»åŠ¡çš„é¡ºåºä¼šä¾æ®dispatch_sync()å‡½æ•°æ‰€åœ¨çš„ä»£ç è¡Œå±äºé‚£ä¸ªçº¿ç¨‹.å¦‚æœæ˜¯ä¸»çº¿ç¨‹åˆ™ä¼šé˜»å¡ä¸»çº¿ç¨‹ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ.æ‰€ä»¥ä¼šæ‰“å° 1å’Œ2. æœ€åæ‰“å° 3 å› ä¸º å‰é¢çš„ä»£ç å—è¢«åŒæ­¥é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰€é˜»å¡.

# æ€»ç»“

å¼€å‘ä¸­çš„ç»†èŠ‚é—®é¢˜è¦å–„äºç ”å…¶æ ¹ç©¶å…¶æœ¬, å–„äºå­¦ä¹ å’Œç§¯ç´¯æ˜¯æˆä¸ºä¸€ä¸ªä¼˜ç§€å¼€å‘è€…çš„å¿…è¦æ¡ä»¶.


URL: https://sunyazhou.com/2022/07/iosoom/index.html.md
Published At: 2022-07-11 03:04:00 +0000

# iOSä¸­çš„OOM

![](/assets/images/20220711iOSCrashType/kernel.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## OOM


åœ¨iOSå¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šç»å¸¸çœ‹åˆ°appç”¨ç€ç”¨ç€å°±å´©æºƒäº†ï¼Œè€Œåœ¨åå°æŸ¥çœ‹å´©æºƒæ ˆçš„æ—¶å€™ï¼Œæ‰¾ä¸åˆ°å´©æºƒæ—¥å¿—ã€‚å…¶å®è¿™å¤§å¤šæ•°çš„å¯èƒ½æ˜¯ç³»ç»Ÿäº§ç”Ÿäº†ä½å†…å­˜å´©æºƒï¼Œä¹Ÿå°±æ˜¯`OOM`(è¿˜æœ‰ä¸€ç§å¯èƒ½æ˜¯ä¸»çº¿ç¨‹å¡æ­»ï¼Œå¯¼è‡´`watchdog`æ€æ‰äº†åº”ç”¨)ï¼Œè€Œä½å†…å­˜å´©æºƒçš„æ—¥å¿—ï¼Œå¾€å¾€éƒ½æ˜¯ä»¥`JetsamEvent`å¼€å¤´çš„ï¼Œæ—¥å¿—ä¸­æœ‰å†…å­˜é¡µå¤§å°(`pageSize`)ï¼ŒCPUæ—¶é—´(`cpuTime`)ç­‰å­—æ®µã€‚

#### ä»€ä¹ˆæ˜¯OOMï¼Ÿ

ä»€ä¹ˆæ˜¯`OOM`å‘¢ï¼Œå®ƒæ˜¯`out-of-memory`çš„ç¼©å†™ï¼Œå­—é¢æ„æ€å°±æ˜¯å†…å­˜è¶…è¿‡äº†é™åˆ¶ã€‚å®ƒæ˜¯ç”±äº `iOS` çš„`Jetsam`æœºåˆ¶é€ æˆçš„ä¸€ç§`å¦ç±»`Crashï¼Œå®ƒä¸åŒäºå¸¸è§„çš„`Crash`ï¼Œé€šè¿‡`Signal`æ•è·ç­‰Crashç›‘æ§æ–¹æ¡ˆæ— æ³•æ•è·åˆ°`OOM`äº‹ä»¶ã€‚

å½“ç„¶è¿˜ä¼šæœ‰`FOOM`è¿™æ ·çš„è¯ï¼Œä»£è¡¨çš„æ˜¯`Foreground-out-of-memory`ï¼Œæ˜¯æŒ‡`App`åœ¨å‰å°å› æ¶ˆè€—å†…å­˜è¿‡å¤šå¼•èµ·ç³»ç»Ÿå¼ºæ€ã€‚è¿™ä¹Ÿå°±æ˜¯æœ¬æ–‡è¦è®¨è®ºçš„ã€‚åå°å‡ºç°`OOM`ä¸ä¸€å®šéƒ½æ˜¯appæœ¬èº«é€ æˆçš„ï¼Œå¤§å¤šæ•°æ˜¯å› ä¸ºå½“å‰åœ¨å‰å°çš„Appå ç”¨å†…å­˜è¿‡å¤§ï¼Œç³»ç»Ÿä¸ºäº†ä¿è¯å‰å°åº”ç”¨æ­£å¸¸è¿è¡Œï¼ŒæŠŠåå°åº”ç”¨æ¸…ç†æ‰äº†ã€‚

#### ä»€ä¹ˆæ˜¯Jetsamæœºåˆ¶?

`Jetsam`æœºåˆ¶å¯ä»¥ç†è§£ä¸ºæ“ä½œç³»ç»Ÿä¸ºäº†æ§åˆ¶å†…å­˜èµ„æºè¿‡åº¦ä½¿ç”¨è€Œé‡‡ç”¨çš„ä¸€ç§ç®¡ç†æœºåˆ¶ã€‚`Jetsam`æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªå†…å­˜é˜ˆå€¼ï¼Œä¸€æ—¦è¶…è¿‡è¿™ä¸ªé˜ˆå€¼Jetsamå°±ä¼šç«‹åˆ»æ€æ‰è¿™ä¸ªè¿›ç¨‹ã€‚

#### ä¸ºä»€ä¹ˆè¦è®¾è®¡Jetsamæœºåˆ¶?

é¦–å…ˆè®¾å¤‡çš„å†…å­˜æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¹¶ä¸æ˜¯æ— é™å¤§çš„ï¼Œæ‰€ä»¥å†…å­˜èµ„æºéå¸¸é‡è¦ã€‚ç³»ç»Ÿè¿›ç¨‹åŠç”¨æˆ·ä½¿ç”¨çš„å…¶ä»–`app`çš„è¿›ç¨‹éƒ½ä¼šäº‰æŠ¢è¿™ä¸ªèµ„æºã€‚ç”±äº`iOS`ä¸æ”¯æŒäº¤æ¢ç©ºé—´ï¼Œä¸€æ—¦è§¦å‘ä½å†…å­˜äº‹ä»¶ï¼Œ`Jetsam`å°±ä¼šå°½å¯èƒ½å¤šçš„é‡Šæ”¾åº”ç”¨å ç”¨çš„å†…å­˜ï¼Œè¿™æ ·åœ¨`iOS`ç³»ç»Ÿä¸Šå‡ºç°ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œåº”ç”¨å°±ä¼šè¢«ç³»ç»Ÿç»ˆæ­¢ã€‚

####  ç©ºé—´äº¤æ¢ 

ç‰©ç†å†…å­˜ä¸å¤Ÿä½¿ç”¨è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿåƒä¸€äº›æ¡Œé¢æ“ä½œç³»ç»Ÿï¼Œä¼šæœ‰å†…å­˜`äº¤æ¢ç©ºé—´`ï¼Œåœ¨windowä¸Šç§°ä¸º`è™šæ‹Ÿå†…å­˜`ã€‚å®ƒçš„æœºåˆ¶æ˜¯ï¼Œåœ¨éœ€è¦æ—¶èƒ½å°†ç‰©ç†å†…å­˜ä¸­çš„ä¸€éƒ¨åˆ†äº¤æ¢åˆ°ç¡¬ç›˜ä¸Šå»ï¼Œåˆ©ç”¨ç¡¬ç›˜ç©ºé—´æ‰©å±•å†…å­˜ç©ºé—´ã€‚

#### iOSä¸æ”¯æŒäº¤æ¢ç©ºé—´

ä½†iOSå¹¶ä¸æ”¯æŒ`äº¤æ¢ç©ºé—´`ï¼Œå¤§å¤šæ•°ç§»åŠ¨è®¾å¤‡éƒ½ä¸æ”¯æŒ`äº¤æ¢ç©ºé—´`ã€‚ç§»åŠ¨è®¾å¤‡çš„å¤§å®¹é‡å­˜å‚¨å™¨é€šå¸¸æ˜¯é—ªå­˜ï¼Œå®ƒçš„è¯»å†™é€Ÿåº¦è¿œè¿œå°äºç”µè„‘æ‰€ä½¿ç”¨çš„ç¡¬ç›˜ï¼Œè¿™å°±å¯¼è‡´åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå°±ç®—ä½¿ç”¨äº†`äº¤æ¢ç©ºé—´`ï¼Œä¹Ÿå¹¶ä¸èƒ½æå‡æ€§èƒ½ã€‚å…¶æ¬¡ï¼Œç§»åŠ¨è®¾å¤‡çš„å®¹é‡æœ¬èº«å°±ç»å¸¸çŸ­ç¼ºã€å†…å­˜çš„è¯»å†™å¯¿å‘½ä¹Ÿæœ‰é™ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æ‹¿é—ªå­˜æ¥åšå†…å­˜äº¤æ¢ï¼Œå°±æœ‰ç‚¹å¥¢ä¾ˆäº†ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç½‘ä¸Šæœ‰å°‘å‡ºæ–‡ç« è¯´iOSæ²¡æœ‰è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯iOSæ²¡æœ‰`äº¤æ¢ç©ºé—´æœºåˆ¶`ã€‚

#### å…¸å‹appå†…å­˜ç±»å‹

å½“å†…å­˜ä¸è¶³çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ä¸€å®šç­–ç•¥æ¥è…¾å‡ºæ›´å¤šç©ºé—´ä¾›ä½¿ç”¨ï¼Œæ¯”è¾ƒå¸¸è§çš„åšæ³•æ˜¯å°†ä¸€éƒ¨åˆ†ä½ä¼˜å…ˆçº§çš„æ•°æ®æŒªåˆ°ç£ç›˜ä¸Šï¼Œè¿™ä¸ªæ“ä½œç§°ä¸º`Page Out`ã€‚ä¹‹åå½“å†æ¬¡è®¿é—®åˆ°è¿™å—æ•°æ®çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè´Ÿè´£å°†å®ƒé‡æ–°æ¬å›å†…å­˜ç©ºé—´ä¸­ï¼Œè¿™ä¸ªæ“ä½œç§°ä¸º`Page In`ã€‚

#### Clean Memory

`Clean Memory`æ˜¯æŒ‡é‚£äº›å¯ä»¥ç”¨ä»¥`Page Out`çš„å†…å­˜ï¼Œåªè¯»çš„å†…å­˜æ˜ å°„æ–‡ä»¶ï¼Œæˆ–è€…æ˜¯Appæ‰€ç”¨åˆ°çš„`frameworks`ã€‚æ¯ä¸ª`frameworks`éƒ½æœ‰`_DATA_CONST`æ®µï¼Œé€šå¸¸ä»–ä»¬éƒ½æ˜¯`Clean`çš„ï¼Œä½†å¦‚æœç”¨runtimeè¿›è¡Œswizzlingï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šå˜`Dirty`ã€‚

#### Dirty Memory

`Dirty Memory`æ˜¯æŒ‡é‚£äº›è¢«Appå†™å…¥è¿‡æ•°æ®çš„å†…å­˜ï¼ŒåŒ…æ‹¬æ‰€æœ‰å †åŒºçš„å¯¹è±¡ã€å›¾åƒè§£ç ç¼“å†²åŒºï¼ŒåŒæ—¶ï¼Œç±»ä¼¼`Clean memory`ï¼Œä¹ŸåŒ…æ‹¬Appæ‰€ç”¨åˆ°çš„`frameworks`ã€‚æ¯ä¸ª`framework`éƒ½ä¼šæœ‰`_DATA`æ®µå’Œ`_DATA_DIRTY`æ®µï¼Œå®ƒä»¬çš„å†…å­˜æ˜¯`Dirty`çš„ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨`framework`çš„è¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿ`Dirty Memory`ï¼Œä½¿ç”¨å•ä¾‹æˆ–è€…å…¨å±€åˆå§‹åŒ–æ–¹æ³•æ˜¯å‡å°‘`Dirty Memory`ä¸é”™çš„æ–¹æ³•ï¼Œå› ä¸ºå•ä¾‹ä¸€æ—¦åˆ›å»ºå°±ä¸ä¼šé”€æ¯ï¼Œå…¨å±€åˆå§‹åŒ–æ–¹æ³•ä¼šåœ¨ç±»åŠ è½½æ—¶æ‰§è¡Œã€‚

#### Compressed Memory

ç”±äºé—ªå­˜å®¹é‡å’Œè¯»å†™å¯¿å‘½çš„é™åˆ¶ï¼ŒiOS ä¸Šæ²¡æœ‰`äº¤æ¢ç©ºé—´`æœºåˆ¶ï¼Œå–è€Œä»£ä¹‹ä½¿ç”¨`Compressed memory`ã€‚

`Compressed memory`æ˜¯åœ¨å†…å­˜ç´§å¼ æ—¶èƒ½å¤Ÿå°†æœ€è¿‘ä½¿ç”¨è¿‡çš„å†…å­˜å ç”¨å‹ç¼©è‡³åŸæœ‰å¤§å°çš„ä¸€åŠä»¥ä¸‹ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨éœ€è¦æ—¶è§£å‹å¤ç”¨ã€‚å®ƒåœ¨èŠ‚çœå†…å­˜çš„åŒæ—¶æé«˜äº†ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ï¼Œç‰¹ç‚¹æ€»ç»“èµ·æ¥å¦‚ä¸‹ï¼š

* Shrinks memory usage å‡å°‘äº†ä¸æ´»è·ƒå†…å­˜å ç”¨
* Improves power efficiency æ”¹å–„ç”µæºæ•ˆç‡ï¼Œé€šè¿‡å‹ç¼©å‡å°‘ç£ç›˜IOå¸¦æ¥çš„æŸè€—
* Minimizes CPU usage å‹ç¼©/è§£å‹ååˆ†è¿…é€Ÿï¼Œèƒ½å¤Ÿå°½å¯èƒ½å‡å°‘ CPU çš„æ—¶é—´å¼€é”€
* Is multicore aware æ”¯æŒå¤šæ ¸æ“ä½œ

ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨`Dictionary`å»ç¼“å­˜æ•°æ®çš„æ—¶å€™ï¼Œå‡è®¾ç°åœ¨å·²ç»ä½¿ç”¨äº†3é¡µå†…å­˜ï¼Œå½“ä¸è®¿é—®çš„æ—¶å€™å¯èƒ½ä¼šè¢«å‹ç¼©ä¸º1é¡µï¼Œå†æ¬¡ä½¿ç”¨åˆ°æ—¶å€™åˆä¼šè§£å‹æˆ3é¡µã€‚

> æœ¬è´¨ä¸Šï¼Œ`Compressed memory`ä¹Ÿæ˜¯`Dirty memory`ã€‚
å› æ­¤ï¼Œ `memory footprint ` = `dirty size` + `compressed size`ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦å¹¶ä¸”èƒ½å¤Ÿå°è¯•å»å‡å°‘çš„å†…å­˜å ç”¨ã€‚

#### Memory Warning

ç›¸ä¿¡å¯¹äº`MemoryWarning`å¹¶ä¸é™Œç”Ÿï¼Œæ¯ä¸€ä¸ª`UIViewController`éƒ½ä¼šæœ‰ä¸€ä¸ª`didReceivedMemoryWarning`çš„æ–¹æ³•ã€‚

å½“ä½¿ç”¨çš„å†…å­˜æ˜¯ä¸€ç‚¹ç‚¹ä¸Šæ¶¨æ—¶ï¼Œè€Œä¸æ˜¯ä¸€ä¸‹å­ç›´æ¥æŠŠå†…å­˜æ’‘çˆ†ã€‚åœ¨è¾¾åˆ°å†…å­˜ä¸´ç•Œç‚¹ä¹‹å‰ï¼Œç³»ç»Ÿä¼šç»™å„ä¸ªæ­£åœ¨è¿è¡Œçš„åº”ç”¨å‘å‡ºå†…å­˜è­¦å‘Šï¼Œå‘ŠçŸ¥appå»æ¸…ç†è‡ªå·±çš„å†…å­˜ã€‚è€Œå†…å­˜è­¦å‘Šï¼Œå¹¶ä¸æ€»æ˜¯ç”±äºè‡ªèº«appå¯¼è‡´çš„ã€‚

å†…å­˜å‹ç¼©æŠ€æœ¯ä½¿å¾—é‡Šæ”¾å†…å­˜å˜å¾—å¤æ‚ã€‚å†…å­˜å‹ç¼©æŠ€æœ¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢å®ç°ï¼Œå¯¹è¿›ç¨‹æ— æ„ŸçŸ¥ã€‚æœ‰è¶£çš„æ˜¯å¦‚æœå½“å‰è¿›ç¨‹æ”¶åˆ°äº†å†…å­˜è­¦å‘Šï¼Œè¿›ç¨‹è¿™æ—¶å€™å‡†å¤‡é‡Šæ”¾å¤§é‡çš„è¯¯ç”¨å†…å­˜ï¼Œå¦‚æœè®¿é—®åˆ°è¿‡å¤šçš„å‹ç¼©å†…å­˜ï¼Œå†è§£å‹ç¼©å†…å­˜çš„æ—¶å€™åè€Œä¼šå¯¼è‡´å†…å­˜å‹åŠ›æ›´å¤§ï¼Œç„¶åå‡ºç°`OOM`ï¼Œè¢«ç³»ç»Ÿæ€æ‰ã€‚

> æˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œç¼“å­˜çš„ç›®çš„æ˜¯æƒ³å‡å°‘ CPU çš„å‹åŠ›ï¼Œä½†æ˜¯è¿‡å¤šçš„ç¼“å­˜åˆä¼šå ç”¨è¿‡å¤§çš„å†…å­˜ã€‚åœ¨ä¸€äº›éœ€è¦ç¼“å­˜æ•°æ®çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨`NSCache`ä»£æ›¿`NSDictionary`ï¼Œ`NSCache`åˆ†é…çš„å†…å­˜å®é™…ä¸Šæ˜¯`Purgeable Memory`ï¼Œå¯ä»¥ç”±ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ã€‚è¿™ç‚¹åœ¨`Effective Objective 2.0`ä¸€ä¹¦ä¸­ä¹Ÿæœ‰æ¨è`NSCache`ä¸`NSPureableData`çš„ç»“åˆä½¿ç”¨æ—¢èƒ½è®©ç³»ç»Ÿæ ¹æ®æƒ…å†µå›æ”¶å†…å­˜ï¼Œä¹Ÿå¯ä»¥åœ¨å†…å­˜æ¸…ç†çš„åŒæ—¶ç§»é™¤ç›¸å…³å¯¹è±¡ã€‚

##### **å‡ºç°OOMå‰ä¸€å®šä¼šå‡ºç°Memory Warningä¹ˆ**ï¼Ÿ   

ç­”æ¡ˆæ˜¯ä¸ä¸€å®šï¼Œæœ‰å¯èƒ½ç¬é—´ç”³è¯·äº†å¤§é‡å†…å­˜ï¼Œè€Œæ°å¥½æ­¤æ—¶ä¸»çº¿ç¨‹åœ¨å¿™äºå…¶ä»–äº‹æƒ…ï¼Œå¯¼è‡´å¯èƒ½æ²¡æœ‰ç»å†è¿‡`Memory Warning`å°±å‘ç”Ÿäº†OOMã€‚å½“ç„¶å³ä¾¿å‡ºç°äº†å¤šæ¬¡`Memory Warning`åï¼Œä¹Ÿä¸è§å¾—ä¼šåœ¨æœ€åä¸€æ¬¡`Memory Warning`çš„å‡ ç§’é’Ÿåå‡ºç°`OOM`ã€‚ä¹‹å‰åš`extension`å¼€å‘çš„æ—¶å€™ï¼Œå°±ç»å¸¸ä¼šå‡ºç°`Memory Warnning`ï¼Œä½†æ˜¯ä¸ä¼šå‡ºç°`OOM`ï¼Œå†æ“ä½œä¸€ä¸¤åˆ†é’Ÿåï¼Œæ‰å‡ºç°`OOM`ï¼Œè€Œåœ¨è¿™ä¸€ä¸¤åˆ†é’Ÿå†…ï¼Œæ²¡æœ‰å†å‡ºç°è¿‡`Memory Warning`ã€‚

å½“ç„¶åœ¨å†…å­˜è­¦å‘Šæ—¶ï¼Œå¤„ç†å†…å­˜ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…å‡ºç°`OOM`ã€‚

#### å¦‚ä½•ç¡®å®šOOMçš„é˜ˆå€¼?

ä¸åŒè®¾å¤‡OOMçš„é˜ˆå€¼æ˜¯ä¸åŒçš„ã€‚é‚£æˆ‘ä»¬è¯¥å¦‚ä½•çŸ¥é“OOMçš„é˜ˆå€¼å‘¢ï¼Ÿ

##### æ–¹æ³•1

å½“æˆ‘ä»¬çš„`App`è¢«`Jetsam`æœºåˆ¶æ€æ­»çš„æ—¶å€™ï¼Œåœ¨æ‰‹æœºä¸­ä¼šç”Ÿæˆç³»ç»Ÿæ—¥å¿—ï¼Œåœ¨æ‰‹æœº`ç³»ç»Ÿè®¾ç½®`-`éšç§`-`åˆ†æ`ä¸­ï¼Œå¯ä»¥å¾—åˆ°`JetSamEvent`å¼€å¤´çš„æ—¥å¿—ã€‚è¿™äº›æ—¥å¿—ä¸­å°±å¯ä»¥è·å–åˆ°ä¸€äº›å…³äº`App`çš„å†…å­˜ä¿¡æ¯ï¼Œä¾‹å¦‚æˆ‘å½“å‰ç”¨çš„iPhone12ï¼Œåœ¨æ—¥å¿—ä¸­çš„å‰éƒ¨åˆ†çœ‹åˆ°äº†`pageSize`ï¼Œè€ŒæŸ¥æ‰¾`per-process-limit`ä¸€é¡¹(å¹¶ä¸æ˜¯æ‰€æœ‰æ—¥å¿—éƒ½æœ‰ï¼Œå¯ä»¥æ‰¾æœ‰çš„)ï¼Œç”¨è¯¥é¡¹çš„`rpages * pageSize`å³å¯å¾—åˆ°`OOM`çš„é˜ˆå€¼ã€‚

``` json
{"bug_type":"298","timestamp":"2022-07-10 01:18:15.51 +0800","os_version":"iPhone OS 15.5 (19F77)","incident_id":"893A5949-F274-434F-938F-96DF562C9486"}
{
  "crashReporterKey" : "1fccb167681199b571738b0f60a42574dace79ac",
  "kernel" : "Darwin Kernel Version 21.5.0: Thu Apr 21 21:51:27 PDT 2022; root:xnu-8020.122.1~1\/RELEASE_ARM64_T8101",
  "product" : "iPhone13,2",
  "incident" : "893A5949-F274-434F-938F-96DF562C9486",
  "date" : "2022-07-10 01:18:15.51 +0800",
  "build" : "iPhone OS 15.5 (19F77)",
  "timeDelta" : 5,
  "memoryStatus" : {
  "compressorSize" : 55911,
  "compressions" : 121377965,
  "decompressions" : 84151972,
  "zoneMapCap" : 1394786304,
  "largestZone" : "APFS_4K_OBJS",
  "largestZoneSize" : 41566208,
  "pageSize" : 16384,
  "uncompressed" : 139405,
  "zoneMapSize" : 242122752,
  "memoryPages" : {
    "active" : 55880,
    "throttled" : 0,
    "fileBacked" : 47550,
    "wired" : 51160,
    "anonymous" : 63802,
    "purgeable" : 489,
    "inactive" : 52901,
    "free" : 8686,
    "speculative" : 2571
  }
},
  "largestProcess" : "WeChat",
  "genCounter" : 0,
  "processes" : [
  {
    "uuid" : "c5bfd6df-d788-3dd4-a585-3ad5aa26b390",
    "states" : [
      "daemon",
      "idle"
    ],
    "purgeable" : 0,
    "age" : 111572686953,
    "fds" : 25,
    "coalition" : 3457,
    "rpages" : 84,
    "priority" : 0,
    "physicalPages" : {
      "internal" : [
        3,
        68
      ]
    },
    "freeze_skip_reason:" : "out-of-budget",
    "pid" : 85307,
    "cpuTime" : 0.007986,
    "name" : "EnforcementService",
    "lifetimeMax" : 87
  }
...
```
é‚£ä¹ˆå½“å‰è¿™ä¸ªMemoryTestçš„å†…å­˜é˜ˆå€¼å°±æ˜¯pageSize * rpages / 1024 / 1024 = xx MBã€‚

##### æ–¹æ³•2

é€šè¿‡Xcodeè¿›è¡ŒDEBUGæ—¶ï¼Œå½“ä½¿ç”¨çš„å†…å­˜è¶…å‡ºé™åˆ¶çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šæŠ›å‡º EXC_RESOURCE_EXCEPTION å¼‚å¸¸ã€‚

##### æ–¹æ³•3

é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ–¹æ³•å¾—åˆ°å½“å‰åº”ç”¨ç¨‹åºå ç”¨çš„å†…å­˜

é€šè¿‡æ¢æµ‹ç³»ç»Ÿå¯ç”¨å†…å­˜çš„æ–¹å¼ åˆ¤æ–­

ç›¸å…³ä»£ç è¯·å„ä½æœç´¢ä¸€ä¸‹å…¶å®ƒç½‘ç»œå¹³å°å°†ä¼šæ¯”è¿™æ›´å…¨é¢

##### æ–¹æ³•4ï¼ˆé€‚ç”¨äºiOS13ç³»ç»Ÿï¼‰

iOS13ç³»ç»Ÿ`os/proc.h`ä¸­æä¾›äº†æ–°çš„APIï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰å¯ç”¨å†…å­˜

``` objc
#import <os/proc.h>
extern size_t os_proc_available_memory(void);
+ (CGFloat)availableSizeOfMemory {
    if (@available(iOS 13.0, *)) {
        return os_proc_available_memory() / 1024.0 / 1024.0;
    }
    // ...
}
```

#### æºç æ¢ç©¶Jetsamçš„å…·ä½“å®ç°

iOS/MacOSçš„å†…æ ¸éƒ½æ˜¯XNUï¼ŒåŒæ—¶XNUæ˜¯å¼€æºçš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å¼€æºçš„XNUå†…æ ¸æºç ä¸­

XNUçš„å†…æ ¸å†…å±‚ä¸º`Mach`å±‚ï¼Œ`Mach`ä½œä¸ºå¾®å†…æ ¸ï¼Œæ˜¯ä»…æä¾›åŸºç¡€æœåŠ¡çš„ä¸€ä¸ªè–„å±‚ï¼Œå¦‚å¤„ç†å™¨ç®¡ç†å’Œè°ƒåº¦åŠIPC(è¿›ç¨‹é—´é€šä¿¡)ã€‚`XNU`çš„ç¬¬äºŒä¸ªä¸»è¦éƒ¨åˆ†æ˜¯`BSD`å±‚ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶çœ‹æˆå›´ç»•`machå±‚`çš„ä¸€ä¸ªå¤–ç¯ï¼Œ`BSD`ä¸ºæœ€ç»ˆç”¨æˆ·çš„åº”ç”¨ç¨‹åºæä¾›å˜æˆæ¥å£ï¼Œå…¶èŒè´£åŒ…æ‹¬è¿›ç¨‹ç®¡ç†ï¼Œæ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œã€‚

å†…å­˜ç®¡ç†ä¸­å„ç§å¸¸è§çš„`JetSam`æ—¶é—´ä¹Ÿæ˜¯ç”±`BSD`äº§ç”Ÿçš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä»`bsd_init`è¿™ä¸ªå‡½æ•°ä½œä¸ºå…¥å£ï¼Œæ¥æ¢ç©¶ä¸€ä¸‹åŸç†ã€‚

`bsd_init`ä¸­åŸºæœ¬éƒ½æ˜¯åœ¨åˆå§‹åŒ–å„ç§å­ç³»ç»Ÿï¼Œæ¯”å¦‚è™šæ‹Ÿå†…å­˜ç®¡ç†ç­‰ç­‰

##### BSDåˆå§‹åŒ–`bsd_init`

è·Ÿå†…å­˜ç›¸å…³çš„åŒ…æ‹¬å¦‚ä¸‹å‡ æ­¥ï¼š

``` c
//1. åˆå§‹åŒ–BSDå†…å­˜Zoneï¼Œè¿™ä¸ªZoneæ˜¯åŸºäºMachå†…æ ¸çš„zone
kmeminit();

//2.iOSä¸Šç‹¬æœ‰çš„ç‰¹æ€§ï¼Œå†…å­˜å’Œè¿›ç¨‹çš„ä¼‘çœ çš„å¸¸é©»ç›‘æ§çº¿ç¨‹
#if CONFIG_FREEZE
#ifndef CONFIG_MEMORYSTATUS
    #error "CONFIG_FREEZE defined without matching CONFIG_MEMORYSTATUS"
#endif
	/* Initialise background freezing */
	bsd_init_kprintf("calling memorystatus_freeze_init\n");
	memorystatus_freeze_init();
#endif

//3.iOSç‹¬æœ‰ï¼ŒJetSAMï¼ˆå³ä½å†…å­˜äº‹ä»¶çš„å¸¸é©»ç›‘æ§çº¿ç¨‹ï¼‰
#if CONFIG_MEMORYSTATUS
	/* Initialize kernel memory status notifications */
rticle/details/104004692
```

è¿™é‡Œé¢çš„`memorystatus_freeze_init()`å’Œ`memorystatus_init()`ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è°ƒç”¨`kern_memorystatus.c`é‡Œé¢æš´éœ²çš„æ¥å£ï¼Œä¸»è¦çš„ä½œç”¨å°±æ˜¯ä»å†…æ ¸ä¸­å¼€å¯ä¸¤ä¸ªä¼˜å…ˆçº§æœ€é«˜çš„çº¿ç¨‹ï¼Œæ¥ç›‘æ§æ•´ä¸ªç³»ç»Ÿçš„å†…å­˜æƒ…å†µã€‚

`CONFIG_FREEZE`æ¶‰åŠåˆ°çš„åŠŸèƒ½ï¼Œå½“å¯ç”¨è¿™ä¸ªå®æ—¶ï¼Œå†…æ ¸ä¼šå¯¹è¿›ç¨‹è¿›è¡Œå†·å†»è€Œä¸æ˜¯`Kill`ã€‚æ¶‰åŠåˆ°è¿›ç¨‹ä¼‘çœ ç›¸å…³çš„ä»£ç ï¼Œæš‚æ—¶ä¸åœ¨æœ¬æ–‡è®¨è®ºèŒƒå›´å†…ã€‚

å›åˆ°`iOS`çš„`OOM`å´©æºƒè¯é¢˜ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨`memorystatus_init()`æ–¹æ³•å³å¯ã€‚

#### çŸ¥è¯†ç‚¹ä»‹ç»

* å†…æ ¸é‡Œé¢å¯¹äºæ‰€æœ‰çš„è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„åˆ†å¸ƒï¼Œé€šè¿‡ä¸€ä¸ªæ•°ç»„ç»´æŠ¤ï¼Œæ•°ç»„çš„æ¯ä¸€é¡¹æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„åˆ—è¡¨ã€‚è¿™ä¸ªæ•°ç»„çš„å¤§å°åˆ™æ˜¯`JETSAM_PRIORITY_MAX + 1`ã€‚  

	``` c
	#define MEMSTAT_BUCKET_COUNT (JETSAM_PRIORITY_MAX + 1)
	typedef struct memstat_bucket {
	    TAILQ_HEAD(, proc) list;    //  ä¸€ä¸ªTAILQ_HEADçš„åŒå‘é“¾è¡¨ï¼Œç”¨æ¥å­˜æ”¾è¿™ä¸ªä¼˜å…ˆçº§ä¸‹é¢çš„è¿›ç¨‹
	    int count;  //  è¿›ç¨‹çš„ä¸ªæ•°
	} memstat_bucket_t;
	memstat_bucket_t memstat_bucket[MEMSTAT_BUCKET_COUNT];//ä¼˜å…ˆçº§é˜Ÿåˆ—(é‡Œé¢åŒ…å«ä¸åŒä¼˜å…ˆçº§çš„ç»“æ„)
	
	```
* åœ¨`kern_memorystatus.h`ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°`JETSAM_PRIORITY_MAX`å€¼ä»¥åŠè¿›ç¨‹ä¼˜å…ˆçº§ç›¸å…³çš„å®šä¹‰ï¼š

	``` c  
	#define JETSAM_PRIORITY_REVISION                  2
	
	#define JETSAM_PRIORITY_IDLE_HEAD                -2
	/* The value -1 is an alias to JETSAM_PRIORITY_DEFAULT */
	#define JETSAM_PRIORITY_IDLE                      0
	#define JETSAM_PRIORITY_IDLE_DEFERRED		  1 /* Keeping this around till all xnu_quick_tests can be moved away from it.*/
	#define JETSAM_PRIORITY_AGING_BAND1		  JETSAM_PRIORITY_IDLE_DEFERRED
	#define JETSAM_PRIORITY_BACKGROUND_OPPORTUNISTIC  2
	#define JETSAM_PRIORITY_AGING_BAND2		  JETSAM_PRIORITY_BACKGROUND_OPPORTUNISTIC
	#define JETSAM_PRIORITY_BACKGROUND                3
	#define JETSAM_PRIORITY_ELEVATED_INACTIVE	  JETSAM_PRIORITY_BACKGROUND
	#define JETSAM_PRIORITY_MAIL                      4
	#define JETSAM_PRIORITY_PHONE                     5
	#define JETSAM_PRIORITY_UI_SUPPORT                8
	#define JETSAM_PRIORITY_FOREGROUND_SUPPORT        9
	#define JETSAM_PRIORITY_FOREGROUND               10
	#define JETSAM_PRIORITY_AUDIO_AND_ACCESSORY      12
	#define JETSAM_PRIORITY_CONDUCTOR                13
	#define JETSAM_PRIORITY_HOME                     16
	#define JETSAM_PRIORITY_EXECUTIVE                17
	#define JETSAM_PRIORITY_IMPORTANT                18
	#define JETSAM_PRIORITY_CRITICAL                 19
	
	#define JETSAM_PRIORITY_MAX                      21
	
	/* TODO - tune. This should probably be lower priority */
	#define JETSAM_PRIORITY_DEFAULT                  18
	#define JETSAM_PRIORITY_TELEPHONY                19
	
	```

å…¶ä¸­æ•°å€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚åå°åº”ç”¨ç¨‹åºä¼˜å…ˆçº§`JETSAM_PRIORITY_BACKGROUND`æ˜¯`3`ï¼Œä½äºå‰å°åº”ç”¨ç¨‹åºä¼˜å…ˆçº§`JETSAM_PRIORITY_FOREGROUND` 10ï¼Œè€Œ`SpringBoard`(æ¡Œé¢ç¨‹åº)ä½äº`JETSAM_PRIORITY_HOME` 16ã€‚

* JetSamå‡ºç°çš„åŸå› 

``` c
#define JETSAM_REASON_INVALID								0
#define JETSAM_REASON_GENERIC								1
#define JETSAM_REASON_MEMORY_HIGHWATER						2
#define JETSAM_REASON_VNODE									3
#define JETSAM_REASON_MEMORY_VMPAGESHORTAGE					4
#define JETSAM_REASON_MEMORY_PROCTHRASHING					5
#define JETSAM_REASON_MEMORY_FCTHRASHING					6
#define JETSAM_REASON_MEMORY_PERPROCESSLIMIT				7
#define JETSAM_REASON_MEMORY_DISK_SPACE_SHORTAGE			8
#define JETSAM_REASON_MEMORY_IDLE_EXIT						9
#define JETSAM_REASON_ZONE_MAP_EXHAUSTION					10
#define JETSAM_REASON_MEMORY_VMCOMPRESSOR_THRASHING			11
#define JETSAM_REASON_MEMORY_VMCOMPRESSOR_SPACE_SHORTAGE	12

```

##### æºç é€»è¾‘æµç¨‹

1. JetSamçº¿ç¨‹åˆå§‹åŒ–å®Œæ¯•ï¼Œä»å¤–éƒ¨æ¥æ”¶åˆ°å†…å­˜å‹åŠ›
2. å¦‚æœæ¥æ”¶åˆ°çš„å†…å­˜å‹åŠ›æ˜¯å½“å‰ç‰©ç†å†…å­˜è¾¾åˆ°é™åˆ¶æ—¶ï¼ŒåŒæ­¥è§¦å‘per-process-limitç±»å‹çš„OOMï¼Œé€€å‡ºæµç¨‹
3. å¦‚æœæ¥å—åˆ°çš„å†…å­˜å‹åŠ›æ˜¯å…¶ä»–ç±»å‹æ—¶ï¼Œåˆ™å”¤é†’`JetSam`çº¿ç¨‹ï¼Œåˆ¤æ–­`kill_under_pressure_cause`å€¼ä¸º`kMemorystatusKilledVMThrashing`ï¼Œ`kMemorystatusKilledFCThrashing`ï¼Œ`kMemorystatusKilledZoneMapExhaustion`æ—¶ï¼Œæˆ–è€…å½“å‰å¯ç”¨å†…å­˜`memorystatus_available_pages`å°äºé˜ˆå€¼`memorystatus_available_pages_pressure`æ—¶ï¼Œè¿›å…¥`OOM`é€»è¾‘ã€‚
4. éå†ä¼˜å…ˆçº§æœ€ä½çš„æ¯ä¸ªè¿›ç¨‹ï¼Œæ ¹æ®`phys_footprint`ï¼Œåˆ¤æ–­å½“å‰è¿›ç¨‹æ˜¯å¦é«˜äºé˜ˆå€¼ï¼Œå¦‚æœæ²¡æœ‰è¶…è¿‡é˜ˆå€¼çš„ï¼Œåˆ™æ®éœ€æŸ¥æ‰¾ä¸‹ä¸€ä¸ªæ¬¡ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œç›´åˆ°æ‰¾åˆ°åï¼Œè§¦å‘`high-water`ç±»å‹`OOM`
5. æ­¤æ—¶å…ˆå›ä¸€ä¸ªæ”¶ä¼˜å…ˆçº§è¾ƒä½çš„è¿›ç¨‹æˆ–æ­£å¸¸æƒ…å†µä¸‹éšæ—¶å¯å›æ”¶çš„è¿›ç¨‹ï¼Œå†æ¬¡èµ°åˆ°`4`çš„åˆ¤æ–­é€»è¾‘
6. å½“æ‰€æœ‰ä½ä¼˜å…ˆçº§è¿›ç¨‹æˆ–æ­£å¸¸æƒ…å†µä¸‹è¯¾éšæ—¶å¯å›æ”¶çš„è¿›ç¨‹éƒ½è¢«æ€æ‰åï¼Œå¦‚æœ`memorystatus_available_pages`ä¾ç„¶å°äºé˜ˆå€¼ï¼Œå…ˆæ€æ‰åå°çš„è¿›ç¨‹ï¼Œæ¯æ€æ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œåˆ¤æ–­ä¸€ä¸‹`memorystatus_available_pages`æ˜¯å¦è¿˜å°äºé˜ˆå€¼ï¼Œå¦‚æœå·²ç»å°äºé˜ˆå€¼äº†ï¼Œåˆ™æŒ‚èµ·çº¿ç¨‹ï¼Œç­‰å¾…å”¤é†’
7. å½“æ‰€æœ‰åå°è¿›ç¨‹éƒ½è¢«æ€æ‰åï¼Œè°ƒç”¨`memorystatus_kill_top_process_aggressive`ï¼Œæ€æ‰å‰å°çš„è¿›ç¨‹ï¼ŒæŒ‚èµ·çº¿ç¨‹ï¼Œç­‰å¾…å”¤é†’
8. å¦‚æœä¸Šé¢çš„`memorystatus_kill_top_process_aggressive`æ²¡æœ‰æ€æ‰ä»»ä½•è¿›ç¨‹ï¼Œå°±é€šè¿‡LRUæ€æ­»`Jetsam`é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ŒæŒ‚èµ·çº¿ç¨‹ï¼Œç­‰å¾…å”¤é†’

#### å¦‚ä½•åˆ¤å®šå‘ç”Ÿäº†OOM

facebookå’Œå¾®ä¿¡çš„Matrixéƒ½æ˜¯é‡‡ç”¨çš„æ’é™¤æ³•ã€‚åœ¨Matrixåˆå§‹åŒ–çš„æ—¶å€™è°ƒç”¨checkRebootType`æ–¹æ³•ï¼Œæ¥åˆ¤å®šæ˜¯å¦å‘ç”Ÿäº†OOMï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹ï¼š

1. å¦‚æœå½“å‰è®¾å¤‡æ­£åœ¨DEBUGï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œä¸ç»§ç»­æ‰§è¡Œã€‚
2. ä¸Šæ¬¡æ‰“å¼€appæ˜¯å¦å‘ç”Ÿäº†æ™®é€šçš„å´©æºƒï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
3. ä¸Šæ¬¡æ‰“å¼€appåï¼Œæ˜¯ç”¨æˆ·æ˜¯å¦ä¸»åŠ¨é€€å‡ºçš„åº”ç”¨ï¼ˆç›‘å¬`UIApplicationWillTerminateNotification`æ¶ˆæ¯ï¼‰ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
4. ä¸Šæ¬¡æ‰“å¼€appåï¼Œæ˜¯å¦è°ƒç”¨`exit`ç›¸å…³çš„å‡½æ•°ï¼ˆé€šè¿‡`atexit`å‡½æ•°ç›‘æ§ï¼‰ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
5. ä¸Šæ¬¡æ‰“å¼€appåï¼Œappæ˜¯å¦æŒ‚èµ·`suspend`æˆ–è€…æ‰§è¡Œ`backgroundFetch`ï¼Œå¦‚æœæ­¤æ—¶æ²¡æœ‰è¢«çœ‹é—¨ç‹—æ€æ­»ï¼Œåˆ™æ˜¯ä¸€ç§`OOM`ï¼ŒMatrixèµ·åå«`Suspend OOM`ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
6. appçš„uuidæ˜¯å¦å˜åŒ–äº†ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
7. ä¸Šæ¬¡æ‰“å¼€appåï¼Œç³»ç»Ÿæ˜¯å¦å‡çº§äº†ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
8. ä¸Šæ¬¡æ‰“å¼€appåï¼Œè®¾å¤‡æ˜¯å¦é‡å¯äº†ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
9. ä¸Šæ¬¡æ‰“å¼€appæ—¶ï¼Œappæ˜¯å¦å¤„äºåå°ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è§¦å‘äº†`Background OOM`ï¼Œå¦‚æœä¸æ˜¯ç»§ç»­æ‰§è¡Œ
10. ä¸Šæ¬¡æ‰“å¼€appåï¼Œappæ˜¯å¦å¤„äºå‰å°ï¼Œæ˜¯å¦ä¸»çº¿ç¨‹å¡æ­»äº†ï¼Œå¦‚æœæ²¡æœ‰å¡æ­»ï¼Œåˆ™è¯´æ˜è§¦å‘äº†`Foreground OOM`ã€‚

# æ€»ç»“

å¹³æ—¶æˆ‘ä»¬è°ˆè®ºçš„å¤§éƒ¨åˆ†éƒ½æ˜¯FOOM,å› ä¸ºå¦‚æœæˆ‘ä»¬çš„ç¨‹åºåœ¨åå°ï¼Œä¼˜å…ˆçº§å¾ˆä½ï¼Œå³ä¾¿æˆ‘ä»¬ä¸å ç”¨å¤§é‡çš„å†…å­˜ï¼Œä¹Ÿå¯èƒ½ä¼šç”±äºå‰å°åº”ç”¨ç¨‹åºå ç”¨äº†å¤§é‡çš„å†…å­˜ï¼Œè€ŒæŠŠæˆ‘ä»¬åœ¨åå°çš„ç¨‹åºæ€æ‰ã€‚è¿™æ˜¯ç³»ç»Ÿçš„æœºåˆ¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¤ªå¤šçš„åŠæ³•.é’ˆå¯¹äºFOOMï¼Œæˆ‘ä»¬éœ€è¦ç€é‡å…³æ³¨`dirty pages`å’Œ`IOKit mappings`ï¼Œå½“ç„¶æ³¨æ„ç³»ç»Ÿåšçš„ç¼“å­˜ï¼Œä¾‹å¦‚å›¾ç‰‡ã€å­—ä½“ç­‰ã€‚é’ˆå¯¹äºOOMé—®é¢˜ç›‘æ§ä¸è§£å†³ï¼Œå¯ä»¥å‚è€ƒ[Matrix](https://github.com/Tencent/matrix)å’Œ[OOMDetector](https://github.com/Tencent/OOMDetector)ä¸¤ä¸ªå¼€æºåº“



[å®è·µæ–¹æ¡ˆ å¿«å½±iOSç«¯å¦‚ä½•å®ç°OOMç‡ä¸‹é™80%+](https://www.gushiciku.cn/pl/aHa7)


URL: https://sunyazhou.com/2022/07/ioscrashtype/index.html.md
Published At: 2022-07-11 01:53:00 +0000

# iOSä¸­çš„å´©æºƒç±»å‹

![](/assets/images/20220711iOSCrashType/kernel.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## å´©æºƒç±»å‹

å´©æºƒé€šå¸¸æ˜¯æŒ‡æ“ä½œç³»ç»Ÿå‘æ­£åœ¨è¿è¡Œçš„ç¨‹åºå‘é€çš„ä¿¡å·ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æŸ¥çœ‹å´©æºƒæ—¥å¿—æ—¶ï¼Œå¸¸å¸¸çœ‹åˆ°å¦‚ä¸‹é”™è¯¯æ‘˜è¦ï¼šApplication received signal SIGSEGVã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¸¸è§çš„å´©æºƒç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š

### 1.`EXC_BAD_ACCESS`

é‡æŒ‡é’ˆå¼•èµ·çš„å´©æºƒï¼Œè®¿é—®äº†ä¸€ä¸ªå·²ç»é‡Šæ”¾çš„å†…å­˜è€Œå¯¼è‡´ï¼Œå‘å·²ç»é‡Šæ”¾çš„å¯¹è±¡æˆ–å‘å®ƒå‘é€æ¶ˆæ¯æ—¶ï¼Œ`EXC_BAD_ACCESS`å°±ä¼šå‡ºç°ã€‚é€ æˆ`EXC_BAD_ACCESS`æœ€å¸¸è§çš„åŸå› æ˜¯ï¼Œåœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­åˆå§‹åŒ–å˜é‡æ—¶ç”¨é”™äº†æ‰€æœ‰æƒä¿®é¥°ç¬¦ï¼Œè¿™ä¼šå¯¼è‡´å¯¹è±¡è¿‡æ—©åœ°è¢«é‡Šæ”¾ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨`viewDidLoad`æ–¹æ³•ä¸­ä¸º`UIViewController`åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«å…ƒç´ çš„`NSArray`ï¼Œå´å°†è¯¥æ•°ç»„çš„æ‰€æœ‰æƒä¿®é¥°ç¬¦è®¾æˆäº†`assign`è€Œä¸æ˜¯`strong`ã€‚ç°åœ¨åœ¨`viewWillAppear`ä¸­ï¼Œè‹¥è¦è®¿é—®å·²ç»é‡Šæ”¾æ‰çš„å¯¹è±¡æ—¶ï¼Œå°±ä¼šå¾—åˆ°åä¸º`EXC_BAD_ACCESS`çš„å´©æºƒã€‚

è¿™ä¸ªå´©æºƒå‘ç”Ÿæ—¶ï¼ŒæŸ¥çœ‹å´©æºƒæ—¥å¿—ï¼Œå´å¾€å¾€å¾—ä¸åˆ°æœ‰ç”¨çš„æ ˆä¿¡æ¯ã€‚è¿˜å¥½ï¼Œæœ‰ä¸€ä¸ªæ–¹æ³•ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š`NSZombieEnabled`ã€‚

è¿™æ˜¯ä¸€ä¸ªç¯å¢ƒå˜é‡ï¼Œç”¨æ¥è°ƒè¯•ä¸å†…å­˜ç›¸å…³çš„é—®é¢˜ï¼Œè·Ÿè¸ªå¯¹è±¡çš„é‡Šæ”¾è¿‡ç¨‹ã€‚å¯ç”¨äº†`NSZombieEnabled`çš„è¯ï¼Œå®ƒä¼šç”¨ä¸€ä¸ªåƒµå°¸å®ç°æ¥æ›¿æ¢ä½ çš„é»˜è®¤çš„`dealloc`å®ç°ï¼Œä¹Ÿå°±æ˜¯åœ¨å¼•ç”¨è®¡æ•°é™åˆ°0æ—¶ï¼Œè¯¥åƒµå°¸å®ç°ä¼šå°†è¯¥å¯¹è±¡è½¬æ¢æˆåƒµå°¸å¯¹è±¡ã€‚åƒµå°¸å¯¹è±¡çš„ä½œç”¨æ˜¯åœ¨ä½ å‘å®ƒå‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€æ®µæ—¥å¿—å¹¶è‡ªåŠ¨è·³å…¥è°ƒè¯•å™¨ã€‚

æ‰€ä»¥ï¼Œå½“åœ¨åº”ç”¨ä¸­å¯ç”¨`NSZombie`è€Œä¸æ˜¯è®©åº”ç”¨ç›´æ¥å´©æºƒæ—¶ï¼Œä¸€ä¸ªé”™è¯¯çš„å†…å­˜è®¿é—®å°±ä¼šå˜æˆä¸€æ¡æ— æ³•è¯†åˆ«çš„æ¶ˆæ¯å‘é€ç»™åƒµå°¸å¯¹è±¡ã€‚åƒµå°¸å¯¹è±¡ä¼šæ˜¾ç¤ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼Œç„¶åè·³å…¥è°ƒè¯•å™¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥æŸ¥çœ‹åˆ°åº•å“ªæ—¶å‡ºäº†é—®é¢˜ã€‚ å¯ä»¥åœ¨`Xcode`çš„`scheme`é¡µé¢ä¸­è®¾ç½®`NSZombieEnabled`ç¯å¢ƒå˜é‡ã€‚ç‚¹å‡»`Product`çš„`Edit Scheme`æ‰“å¼€è¯¥é¡µé¢ï¼Œç„¶åå‹¾é€‰`Enable Zombie Objects`å¤é€‰æ¡†ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![](/assets/images/20220711iOSCrashType/1.webp)

åƒµå°¸åœ¨RACå‡ºç°ä»¥å‰ä½œç”¨å¾ˆå¤§ã€‚ä½†è‡ªä»æœ‰äº†ARCï¼Œå¦‚æœä½ åœ¨å¯¹è±¡çš„æ‰€æœ‰æƒæ–¹é¢æ¯”è¾ƒæ³¨æ„ï¼Œé‚£ä¹ˆé€šå¸¸ä¸ä¼šç¢°åˆ°å†…å­˜ç›¸å…³çš„å´©æºƒã€‚


### 2.`SIGSEGV`

æ®µé”™è¯¯ä¿¡æ¯ï¼ˆ`SIGSEGV`ï¼‰æ˜¯æ“ä½œç³»ç»Ÿäº§ç”Ÿçš„ä¸€ä¸ªæ›´ä¸¥é‡çš„é—®é¢˜ã€‚å½“ç¡¬ä»¶å‡ºç°é”™è¯¯ã€è®¿é—®ä¸å¯è¯»çš„å†…å­˜åœ°å€æˆ–å‘å—ä¿æŠ¤çš„å†…å­˜åœ°å€å†™å…¥æ•°æ®æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ä¸ªé”™è¯¯ã€‚

ç¡¬ä»¶é”™è¯¯è¿™ä¸€æƒ…å†µå¹¶ä¸å¸¸è§ã€‚å½“è¦è¯»å–ä¿å­˜åœ¨`RAM`ä¸­çš„æ•°æ®ï¼Œè€Œè¯¥ä½ç½®çš„`RAM`ç¡¬ä»¶æœ‰é—®é¢˜æ—¶ï¼Œä½ ä¼šæ”¶åˆ°`SIGSEGV`ã€‚`SIGSEGV`æ›´å¤šæ˜¯å‡ºç°åœ¨åä¸¤ç§æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä»£ç é¡µä¸å…è®¸è¿›è¡Œå†™æ“ä½œã€‚å½“åº”ç”¨ä¸­çš„æŸä¸ªæŒ‡é’ˆæŒ‡å‘ä»£ç é¡µå¹¶è¯•å›¾ä¿®æ”¹æŒ‡å‘ä½ç½®çš„å€¼æ—¶ï¼Œä½ ä¼šæ”¶åˆ°`SIGSEGV`ã€‚å½“è¦è¯»å–ä¸€ä¸ªæŒ‡é’ˆçš„å€¼ï¼Œè€Œå®ƒè¢«åˆå§‹åŒ–æˆæŒ‡å‘æ— æ•ˆå†…å­˜åœ°å€çš„åƒåœ¾å€¼æ—¶ï¼Œä½ ä¹Ÿä¼šæ”¶åˆ°`SIGSEGV`ã€‚

`SIGSEGV`é”™è¯¯è°ƒè¯•èµ·æ¥æ›´å›°éš¾ï¼Œè€Œå¯¼è‡´`SIGSEGV`çš„æœ€å¸¸è§åŸå› æ˜¯ä¸æ­£ç¡®çš„ç±»å‹è½¬æ¢ã€‚è¦é¿å…è¿‡åº¦ä½¿ç”¨æŒ‡é’ˆæˆ–å°è¯•æ‰‹åŠ¨ä¿®æ”¹æŒ‡é’ˆæ¥è¯»å–ç§æœ‰æ•°æ®ç»“æ„ã€‚å¦‚æœä½ é‚£æ ·åšäº†ï¼Œè€Œåœ¨ä¿®æ”¹æŒ‡é’ˆæ—¶æ²¡æœ‰æ³¨æ„å†…å­˜å¯¹é½å’Œå¡«å……é—®é¢˜ï¼Œå°±ä¼šæ”¶åˆ°`SIGSEGV`ã€‚

### 3.`SIGBUS`

æ€»çº¿é”™è¯¯ä¿¡å·ï¼ˆ`SIGBUG`ï¼‰ä»£è¡¨æ— æ•ˆå†…å­˜è®¿é—®ï¼Œå³è®¿é—®çš„å†…å­˜æ˜¯ä¸€ä¸ªæ— æ•ˆçš„å†…å­˜åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé‚£ä¸ªåœ°å€æŒ‡å‘çš„ä½ç½®æ ¹æœ¬ä¸æ˜¯ç‰©ç†å†…å­˜åœ°å€ï¼ˆå®ƒå¯èƒ½æ˜¯æŸä¸ªç¡¬ä»¶èŠ¯ç‰‡çš„åœ°å€ï¼‰ã€‚

### 4.`SIGTRAP`

`SIGTRAP`ä»£è¡¨é™·é˜±ä¿¡å·ã€‚å®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„å´©æºƒä¿¡å·ã€‚å®ƒä¼šåœ¨å¤„ç†å™¨æ‰§è¡ŒtrapæŒ‡ä»¤å‘é€ã€‚`LLDB`è°ƒè¯•å™¨é€šå¸¸ä¼šå¤„ç†æ­¤ä¿¡å·ï¼Œå¹¶åœ¨æŒ‡å®šçš„æ–­ç‚¹å¤„åœæ­¢è¿è¡Œã€‚å¦‚æœä½ æ”¶åˆ°äº†åŸå› ä¸æ˜çš„`SIGTRAP`ï¼Œå…ˆæ¸…é™¤ä¸Šæ¬¡çš„è¾“å‡ºï¼Œç„¶åé‡æ–°è¿›è¡Œæ„å»ºé€šå¸¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### 5.`EXC_ARITHETIC`

å½“è¦é™¤é›¶æ—¶ï¼Œåº”ç”¨ä¼šæ”¶åˆ°`EXC_ARITHMETIC`ä¿¡å·ã€‚è¿™ä¸ªé”™è¯¯åº”è¯¥å¾ˆå®¹æ˜“è§£å†³ã€‚

``` objc
int result = 10/0;  //0ä¸èƒ½ä½œä¸ºé™¤æ•° å¦åˆ™crash
``` 

### 6.`SIGILL`

`SIGILL`ä»£è¡¨`signal illegal instruction`(éæ³•æŒ‡ä»¤ä¿¡å·)ã€‚å½“åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œéæ³•æŒ‡ä»¤æ—¶ï¼Œå®ƒå°±ä¼šå‘ç”Ÿã€‚æ‰§è¡Œéæ³•æŒ‡ä»¤æ˜¯æŒ‡ï¼Œå°†å‡½æ•°æŒ‡é’ˆä¼šç»™å¦å¤–ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°æŒ‡é’ˆç”±äºæŸç§åŸå› æ˜¯åçš„ï¼ŒæŒ‡å‘äº†ä¸€æ®µå·²ç»é‡Šæ”¾çš„å†…å­˜æˆ–æ˜¯ä¸€ä¸ªæ•°æ®æ®µã€‚æœ‰æ—¶ä½ æ”¶åˆ°çš„æ˜¯`EXC_BAD_INSTRUCTION`è€Œä¸æ˜¯`SIGILL`ï¼Œè™½ç„¶å®ƒä»¬æ˜¯ä¸€å›äº‹ï¼Œä¸è¿‡`EXC_*`ç­‰åŒäºæ­¤ä¿¡å·ä¸ä¾èµ–ä½“ç³»ç»“æ„ã€‚

### 7. `SIGABRT`

`SIGABRT`ä»£è¡¨`SIGNAL ABORT`ï¼ˆä¸­æ­¢ä¿¡å·ï¼‰ã€‚å½“æ“ä½œç³»ç»Ÿå‘ç°ä¸å®‰å…¨çš„æƒ…å†µæ—¶ï¼Œå®ƒèƒ½å¤Ÿå¯¹è¿™ç§æƒ…å†µè¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼›å¿…è¦çš„è¯ï¼Œå®ƒèƒ½è¦æ±‚è¿›ç¨‹è¿›è¡Œæ¸…ç†å·¥ä½œã€‚åœ¨è°ƒè¯•é€ æˆæ­¤ä¿¡å·çš„åº•å±‚é”™è¯¯æ—¶ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¦™æ‹›ã€‚`Cocos2d`æˆ–`UIKit`ç­‰æ¡†æ¶é€šå¸¸ä¼šåœ¨ç‰¹å®šçš„å‰ææ¡ä»¶æ²¡æœ‰æ»¡è¶³æˆ–ä¸€äº›ç³Ÿç³•çš„æƒ…å†µå‡ºç°æ—¶è°ƒç”¨Cå‡½æ•°`abort`ï¼ˆç”±å®ƒæ¥å‘é€æ­¤ä¿¡å·ï¼‰ã€‚å½“`SIGABRT`å‡ºç°æ—¶ï¼Œæ§åˆ¶å°é€šå¸¸ä¼šè¾“å‡ºå¤§é‡çš„ä¿¡æ¯ï¼Œè¯´æ˜å…·ä½“å“ªé‡Œå‡ºé”™äº†ã€‚ç”±äºå®ƒæ˜¯å¯æ§åˆ¶çš„å´©æºƒï¼Œæ‰€ä»¥å¯ä»¥åœ¨`LLDB`æ§åˆ¶å°ä¸Šé”®å…¥`bt`å‘½ä»¤æ‰“å°å‡ºå›æº¯ä¿¡æ¯ã€‚

### 8.`çœ‹é—¨ç‹—è¶…æ—¶`

è¿™ç§å´©æºƒé€šå¸¸æ¯”è¾ƒå®¹æ˜“åˆ†è¾¨ï¼Œå› ä¸ºé”™è¯¯ç æ˜¯å›ºå®šçš„0x8badf00dã€‚åœ¨iOSä¸Šï¼Œå®ƒç»å¸¸å‡ºç°åœ¨æ‰§è¡Œä¸€ä¸ªåŒæ­¥ç½‘ç»œè°ƒç”¨è€Œé˜»å¡ä¸»çº¿ç¨‹çš„æƒ…å†µã€‚å› æ­¤ï¼Œæ°¸è¿œä¸è¦è¿›è¡ŒåŒæ­¥ç½‘ç»œè°ƒç”¨ã€‚

# æ€»ç»“

crash logç±»å‹ä¸é™äºä¸Šè¿°è¿™äº›,ç»“åˆå®é™…è·Ÿè¸ªå°†ä¼šæ‰¾åˆ°å½±å“çš„å´©æºƒä¿¡æ¯.è¿™é‡Œåªåšå‚è€ƒä½¿ç”¨. å¦‚æœæƒ³äº†è§£æ›´åŠ è¯¦ç»†è¯·å‚è€ƒgnuçš„[æºç ](http://fxr.watson.org/fxr/source/osfmk/mach/exception_types.h?v=xnu-2050.18.24)

[å‚è€ƒ](https://zhuanlan.zhihu.com/p/269371735)  
[ç†è§£ iOS å¼‚å¸¸ç±»å‹](https://juejin.cn/post/6844903866128039944)  
[æµ…è°ˆ iOS ä¸­çš„ Crash æ•è·ä¸é˜²æŠ¤
](http://shevakuilin.com/ios-crashprotection/)


URL: https://sunyazhou.com/2022/07/commonsuperview/index.html.md
Published At: 2022-07-05 00:12:00 +0000

# iOSå¯»æ‰¾ä¸¤ä¸ªUIViewçš„æœ€è¿‘çš„å…¬å…±çˆ¶ç±»

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å®ç°ä»£ç 


``` objc

//è°ƒç”¨
- (void)viewDidLoad {
    [super viewDidLoad];
    Class commonClass1 = [self commonClass1:[ViewA class] andClass:[ViewC class]];
    NSLog(@"%@",commonClass1);
    // è¾“å‡ºï¼š2022-07-03 17:36:01.868966+0800 ä¸¤ä¸ªUIViewçš„æœ€è¿‘å…¬å…±çˆ¶ç±»[84288:2458900] ViewD
}

// è·å–æ‰€æœ‰çˆ¶ç±»
- (NSArray *)superClasses:(Class)class {
    if (class == nil) {
        return @[];
    }
    NSMutableArray *result = [NSMutableArray array];
    while (class != nil) {
        [result addObject:class];
        class = [class superclass];
    }
    return [result copy];
}
//æˆ‘ä»¬å°†ä¸€ä¸ªè·¯å¾„ä¸­çš„æ‰€æœ‰ç‚¹å…ˆæ”¾è¿›NSSetä¸­.å› ä¸ºNSSetçš„å†…éƒ¨å®ç°æ˜¯ä¸€ä¸ªhashè¡¨ï¼Œæ‰€ä»¥æŸ¥è¯¢å…ƒç´ çš„æ—¶é—´çš„å¤æ‚åº¦å˜æˆO(1),æˆ‘ä»¬ä¸€å…±æœ‰Nä¸ªèŠ‚ç‚¹ï¼Œæ‰€ä»¥æ€»æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–åˆ°äº†O(N)
- (Class)commonClass2:(Class)classA andClass:(Class)classB{
    NSArray *arr1 = [self superClasses:classA];
    NSArray *arr2 = [self superClasses:classB];
    NSSet *set = [NSSet setWithArray:arr2];
    for (NSUInteger i =0; i<arr1.count; ++i) {
        Class targetClass = arr1[i];
        if ([set containsObject:targetClass]) {
            return targetClass;
        }
    }
    return nil;
}
```


# æ€»ç»“

æœ¬é¢˜ç±»ä¼¼äºŒå‰æ ‘å¯»æ‰¾æœ€è¿‘å…¬å…±çˆ¶èŠ‚ç‚¹,å¯ä»¥å‚è€ƒmasonryçš„å®ç°

[Masonry ç®—æ³•ä¹‹ æœ€è¿‘å…¬å…±çˆ¶è§†å›¾](https://www.todayios.com/ios-masonry-lca-closest-common-superview/)


URL: https://sunyazhou.com/2022/07/binarytreeorder/index.html.md
Published At: 2022-07-04 09:58:00 +0000

# äºŒå‰æ ‘çš„å‰ã€ä¸­ã€ååºéå†

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹`root`ï¼Œè¿”å› å®ƒçš„`å‰åº`ã€`ä¸­åº`ã€`ååº`éå† ã€‚


#### ç¤ºä¾‹1

![](/assets/images/20220704BinaryTreeOrder/1.webp)

``` sh 
è¾“å…¥ï¼šroot = [1,null,2,3]
è¾“å‡ºï¼š[1,2,3]
```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šroot = []
è¾“å‡ºï¼š[]
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šroot = [1]
è¾“å‡ºï¼š[1]
```

## å®ç°ä»£ç 

``` c++
struct TreeNode {
    int val;
    TreeNode *left;
    TreeNode *right;
    TreeNode() : val(0), left(nullptr), right(nullptr) {}
    TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
    TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
};

class Solution {
public:
    void inorder(TreeNode *root, vector<int> &res) {
        if (!root) {return;}
        
        //å‰åº
        res.push_back(root->val);
        preorder(root->left,res);
        preorder(root->right,res);

        //ä¸­åº
        inorder(root->left, res);
        res.push_back(root->val);
        inorder(root->right,res);

        //ååº
        postorder(root->left, res);
        postorder(root->right, res);
        res.push_back(root->val);
    }

    vector<int> inorderTraversal(TreeNode* root) {
        vector <int> ans;
        inorder(root, ans);
        return ans;
    }
};
```

[144. äºŒå‰æ ‘çš„å‰åºéå†](https://leetcode.cn/problems/binary-tree-preorder-traversal/)  
[94. äºŒå‰æ ‘çš„ä¸­åºéå†](https://leetcode.cn/problems/binary-tree-inorder-traversal/)  
[145. äºŒå‰æ ‘çš„ååºéå†](https://leetcode.cn/problems/binary-tree-postorder-traversal/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)




URL: https://sunyazhou.com/2022/07/islandscount/index.html.md
Published At: 2022-07-04 09:50:00 +0000

# å²›å±¿æ•°é‡

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸€ä¸ªç”±Â `'1'`ï¼ˆé™†åœ°ï¼‰å’Œ `'0'`ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚

å²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚

æ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚

#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šgrid = [
  ["1","1","1","1","0"],
  ["1","1","0","1","0"],
  ["1","1","0","0","0"],
  ["0","0","0","0","0"]
]
è¾“å‡ºï¼š1

```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šgrid = [
  ["1","1","0","0","0"],
  ["1","1","0","0","0"],
  ["0","0","1","0","0"],
  ["0","0","0","1","1"]
]
è¾“å‡ºï¼š3

```

## å®ç°ä»£ç 

ä½¿ç”¨æ·±åº¦ä¼˜å…ˆDFS

``` c++
class Solution {
private:
    void dfs(vector<vector<char>>& grid, int r, int c) {
        int nr = grid.size();
        int nc = grid[0].size();

        grid[r][c] = '0';
        if (r - 1 >= 0 && grid[r-1][c] == '1') dfs(grid, r - 1, c);
        if (r + 1 < nr && grid[r+1][c] == '1') dfs(grid, r + 1, c);
        if (c - 1 >= 0 && grid[r][c-1] == '1') dfs(grid, r, c - 1);
        if (c + 1 < nc && grid[r][c+1] == '1') dfs(grid, r, c + 1);
    }
public:
    int numIslands(vector<vector<char>>& grid) {
        int nr = grid.size();
        if (!nr) return 0;
        int nc = grid[0].size();

        int num_islands = 0;
        for (int r = 0; r < nr; ++r) {
            for (int c = 0; c < nc; ++c) {
                if (grid[r][c] == '1') {
                    ++num_islands;
                    dfs(grid, r, c);
                }
            }
        }
        return num_islands;
    }
};
```

[200. å²›å±¿æ•°é‡](https://leetcode.cn/problems/number-of-islands/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)




URL: https://sunyazhou.com/2022/07/longestpalindrome/index.html.md
Published At: 2022-07-04 09:41:00 +0000

# æœ€é•¿å›æ–‡å­ä¸²

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²`s`ï¼Œæ‰¾åˆ°`s`ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚

#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šs = "babad"
è¾“å‡ºï¼š"bab"
è§£é‡Šï¼š"aba" åŒæ ·æ˜¯ç¬¦åˆé¢˜æ„çš„ç­”æ¡ˆã€‚
```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šs = "cbbd"
è¾“å‡ºï¼š"bb"
```

## å®ç°ä»£ç 

``` c++
//ä¸­å¿ƒæ‰©å±•ç®—æ³•
class Solution {
public:
    pair<int, int> expandAroundCenter(const string& s, int left, int right) {
        while (left >= 0 && right < s.size() && s[left] == s[right]) {
            --left;
            ++right;
        }
        return {left + 1, right - 1};
    }

    string longestPalindrome(string s) {
        int start = 0, end = 0;
        for (int i = 0; i < s.size(); ++i) {
            auto [left1, right1] = expandAroundCenter(s, i, i);
            auto [left2, right2] = expandAroundCenter(s, i, i + 1);
            if (right1 - left1 > end - start) {
                start = left1;
                end = right1;
            }
            if (right2 - left2 > end - start) {
                start = left2;
                end = right2;
            }
        }
        return s.substr(start, end - start + 1);
    }
};
```


[5. æœ€é•¿å›æ–‡å­ä¸²](https://leetcode.cn/problems/longest-palindromic-substring/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)




URL: https://sunyazhou.com/2022/07/mergesortarray/index.html.md
Published At: 2022-07-04 09:25:00 +0000

# åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸¤ä¸ªæŒ‰`éé€’å‡é¡ºåº`æ’åˆ—çš„æ•´æ•°æ•°ç»„`nums1`å’Œ`nums2`ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•°`m`å’Œ`n` ï¼Œåˆ†åˆ«è¡¨ç¤º`nums1`å’Œ`nums2`ä¸­çš„å…ƒç´ æ•°ç›®ã€‚

è¯·ä½ `åˆå¹¶` `nums2` åˆ°`nums1`ä¸­ï¼Œä½¿åˆå¹¶åçš„æ•°ç»„åŒæ ·æŒ‰`éé€’å‡é¡ºåº`æ’åˆ—ã€‚

> æ³¨æ„ï¼šæœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„`nums1`ä¸­ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œ`nums1`çš„åˆå§‹é•¿åº¦ä¸º`m + n`ï¼Œå…¶ä¸­å‰`m`ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå`n`ä¸ªå…ƒç´ ä¸º `0`ï¼Œåº”å¿½ç•¥ã€‚`nums2`çš„é•¿åº¦ä¸º`n`ã€‚


#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šnums1 = [1,2,3,0,0,0], m = 3, nums2 = [2,5,6], n = 3
è¾“å‡ºï¼š[1,2,2,3,5,6]
è§£é‡Šï¼šéœ€è¦åˆå¹¶ [1,2,3] å’Œ [2,5,6] ã€‚
åˆå¹¶ç»“æœæ˜¯ [1,2,2,3,5,6] ï¼Œå…¶ä¸­æ–œä½“åŠ ç²—æ ‡æ³¨çš„ä¸º nums1 ä¸­çš„å…ƒç´ ã€‚

```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šnums1 = [1], m = 1, nums2 = [], n = 0
è¾“å‡ºï¼š[1]
è§£é‡Šï¼šéœ€è¦åˆå¹¶ [1] å’Œ [] ã€‚
åˆå¹¶ç»“æœæ˜¯ [1] ã€‚
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šnums1 = [0], m = 0, nums2 = [1], n = 1
è¾“å‡ºï¼š[1]
è§£é‡Šï¼šéœ€è¦åˆå¹¶çš„æ•°ç»„æ˜¯ [] å’Œ [1] ã€‚
åˆå¹¶ç»“æœæ˜¯ [1] ã€‚
æ³¨æ„ï¼Œå› ä¸º m = 0 ï¼Œæ‰€ä»¥ nums1 ä¸­æ²¡æœ‰å…ƒç´ ã€‚nums1 ä¸­ä»…å­˜çš„ 0 ä»…ä»…æ˜¯ä¸ºäº†ç¡®ä¿åˆå¹¶ç»“æœå¯ä»¥é¡ºåˆ©å­˜æ”¾åˆ° nums1 ä¸­.
```

## å®ç°ä»£ç 

``` c++
class Solution {
public:
    void merge(vector<int>& nums1, int m, vector<int>& nums2, int n) {
        for (int i = 0; i != n; ++i) {
            nums1[m + i] = nums2[i];
        }
        sort(nums1.begin(),nums1.end());
    }
};
```


[88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„](https://leetcode.cn/problems/merge-sorted-array/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)




URL: https://sunyazhou.com/2022/07/commonancestor/index.html.md
Published At: 2022-07-04 09:12:00 +0000

# äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚

[ç™¾åº¦ç™¾ç§‘](https://baike.baidu.com/item/%E6%9C%80%E8%BF%91%E5%85%AC%E5%85%B1%E7%A5%96%E5%85%88/8918834?fr=aladdin)ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ`ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ`ï¼‰ã€‚â€

#### ç¤ºä¾‹1

![](/assets/images/20220704CommonAncestor/1.webp)

``` sh 
è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 1
è¾“å‡ºï¼š3
è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 1 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 3 ã€‚

```

#### ç¤ºä¾‹2

![](/assets/images/20220704CommonAncestor/2.webp)

``` sh 
è¾“å…¥ï¼šroot = [3,5,1,6,2,0,8,null,null,7,4], p = 5, q = 4
è¾“å‡ºï¼š5
è§£é‡Šï¼šèŠ‚ç‚¹ 5 å’ŒèŠ‚ç‚¹ 4 çš„æœ€è¿‘å…¬å…±ç¥–å…ˆæ˜¯èŠ‚ç‚¹ 5 ã€‚å› ä¸ºæ ¹æ®å®šä¹‰æœ€è¿‘å…¬å…±ç¥–å…ˆèŠ‚ç‚¹å¯ä»¥ä¸ºèŠ‚ç‚¹æœ¬èº«ã€‚

```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šroot = [1,2], p = 1, q = 2
è¾“å‡ºï¼š1
```

## å®ç°ä»£ç 

``` c++

struct TreeNode {
    int val;
    TreeNode *left;
    TreeNode *right;
    TreeNode(int x) : val(x), left(NULL), right(NULL) {}
};
 
class Solution {
public:
    unordered_map<int, TreeNode *> father;
    unordered_map<int, bool> vis; //å‘¨æ¸¸è¿‡çš„

    void dfs(TreeNode *root) {
        if (root->left != nullptr) {
            father[root->left->val] = root;
            dfs(root->left);
        }
        if (root->right != nullptr) {
            father[root->right->val] = root;
            dfs(root->right);
        }
    }

    TreeNode* lowestCommonAncestor(TreeNode* root, TreeNode* p, TreeNode* q) {
        father[root->val] = nullptr;
        dfs(root);
        while (p != nullptr) {
            vis[p->val] = true;
            p = father[p->val];
        }
        while (q != nullptr) {
            if (vis[q->val]) {
                return q;
            }
            q = father[q->val];
        }
        return nullptr;
    }
};
```


[236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ](https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)




URL: https://sunyazhou.com/2022/07/searchrotatearray/index.html.md
Published At: 2022-07-04 06:53:00 +0000

# æœç´¢æ—‹è½¬æ’åºæ•°ç»„

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

æ•´æ•°æ•°ç»„`nums`æŒ‰å‡åºæ’åˆ—ï¼Œæ•°ç»„ä¸­çš„å€¼ äº’ä¸ç›¸åŒ ã€‚

åœ¨ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œ`nums` åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ `k`ï¼ˆ`0 <= k < nums.length`ï¼‰ä¸Šè¿›è¡Œäº† `æ—‹è½¬`ï¼Œä½¿æ•°ç»„å˜ä¸º `[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]`ï¼ˆä¸‹æ ‡ `ä» 0 å¼€å§‹` è®¡æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œ `[0,1,2,4,5,6,7]` åœ¨ä¸‹æ ‡ `3` å¤„ç»æ—‹è½¬åå¯èƒ½å˜ä¸ºÂ `[4,5,6,7,0,1,2]` ã€‚

ç»™ä½  æ—‹è½¬å çš„æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `target` ï¼Œå¦‚æœ `nums` ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ `target` ï¼Œåˆ™è¿”å›å®ƒçš„ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å›Â `-1`Â ã€‚

ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º `O(log n)` çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚

#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 0
è¾“å‡ºï¼š4

```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šnums = [4,5,6,7,0,1,2], target = 3
è¾“å‡ºï¼š-1
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šnums = [1], target = 0
è¾“å‡ºï¼š-1
```

## Answer

``` c++
class Solution {
public:
    int search(vector<int>& nums, int target) {
        int n = (int)nums.size();
        if (!n) { return -1; }
        if (n == 1) {
            return nums[0] == target? 0 : -1;
        }
        int left = 0, right = n -1;
        while (left <= right) {
            int mid = (right + left) /2;
            if (nums[mid] == target) {
                return mid;
            }
            if (nums[0] <= nums[mid]) {
                if (nums[0] <= target && target < nums[mid]) {
                    right = mid -1;
                } else {
                    left = mid + 1;
                }
            } else {
                if (nums[mid] < target && target <= nums[n-1]) {
                    left = mid +1;
                } else {
                    right = mid -1;
                }
            }
        }
        return -1;
    }
};
```


[33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„](https://leetcode.cn/problems/search-in-rotated-sorted-array/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)



URL: https://sunyazhou.com/2022/07/zigzaglevelorder/index.html.md
Published At: 2022-07-04 06:19:00 +0000

# äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹`root`ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„`é”¯é½¿å½¢å±‚åºéå†`ã€‚ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰ã€‚


#### ç¤ºä¾‹1

![](/assets/images/20220704ZigzagLeveOrder/1.webp)

``` sh 
è¾“å…¥ï¼šroot = [3,9,20,null,null,15,7]
è¾“å‡ºï¼š[[3],[20,9],[15,7]]
```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šroot = [1]
è¾“å‡ºï¼š[[1]]
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šroot = []
è¾“å‡ºï¼š[]
```

## å®ç°ä»£ç 

``` c++
struct TreeNode {
    int val;
    TreeNode *left;
    TreeNode *right;
    TreeNode() : val(0), left(nullptr), right(nullptr) {}
    TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
    TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
};

class Solution {
public:
    vector<vector<int>> zigzagLevelOrder(TreeNode* root) {
        vector<vector<int>> ans;
        if (root == nullptr) { return ans; }
        queue<TreeNode *> nodeQueue;
        nodeQueue.push(root);
        bool isOrderLeft = true;
        while(!nodeQueue.empty()) {
            deque<int> levelList;
            int n = nodeQueue.size();
            for (int i = 0; i < n; i++) {
                auto node = nodeQueue.front();
                nodeQueue.pop();
                if (isOrderLeft) {
                    levelList.push_back(node->val);
                } else {
                    levelList.push_front(node->val);
                }
                if (node->left) {
                    nodeQueue.push(node->left);
                }
                if (node->right) {
                    nodeQueue.push(node->right);
                }
            }
            ans.emplace_back(vector<int>{levelList.begin(),levelList.end()});
            isOrderLeft = !isOrderLeft;
        }
        return ans;
    }
};
```


[103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†](https://leetcode.cn/problems/binary-tree-zigzag-level-order-traversal/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)



URL: https://sunyazhou.com/2022/07/cyclelinktable/index.html.md
Published At: 2022-07-04 06:09:00 +0000

# ç¯å½¢é“¾è¡¨

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹`head`ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚

å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª`next`æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•°`pos`æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰.

> æ³¨æ„ï¼š`pos`ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’Â ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚

å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯Â ï¼Œåˆ™è¿”å›`true`ã€‚ å¦åˆ™ï¼Œè¿”å›`false`ã€‚

#### ç¤ºä¾‹1

![](/assets/images/20220704CycleLinkTable/1.webp)

``` sh 
è¾“å…¥ï¼šhead = [3,2,0,-4], pos = 1
è¾“å‡ºï¼štrue
è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚
```

#### ç¤ºä¾‹2

![](/assets/images/20220704CycleLinkTable/2.webp)

``` sh 
è¾“å…¥ï¼šhead = [1,2], pos = 0
è¾“å‡ºï¼štrue
è§£é‡Šï¼šé“¾è¡¨ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œå…¶å°¾éƒ¨è¿æ¥åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ã€‚
```

#### ç¤ºä¾‹3

![](/assets/images/20220704CycleLinkTable/3.webp)

``` sh 
è¾“å…¥ï¼šhead = [1], pos = -1
è¾“å‡ºï¼šfalse
è§£é‡Šï¼šé“¾è¡¨ä¸­æ²¡æœ‰ç¯ã€‚
```

## å®ç°ä»£ç 

``` c++
struct ListNode {
    int val;
    ListNode *next;
    ListNode(int x) : val(x), next(NULL) {}
};

class Solution {
public:
    bool hasCycle(ListNode *head) {
        unordered_set<ListNode *> seen;
        while (head != nullptr) {
            if (seen.count(head)){
                return true;
            } 
            seen.insert(head);
            head = head->next;
        }
        return false;
    }
};
```


[141. ç¯å½¢é“¾è¡¨](https://leetcode.cn/problems/linked-list-cycle/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)



URL: https://sunyazhou.com/2022/07/binarytreelevelorder/index.html.md
Published At: 2022-07-04 02:10:00 +0000

# äºŒå‰æ ‘çš„å±‚åºéå†

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹`root`ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„`å±‚åºéå†`.ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰.


#### ç¤ºä¾‹1

![](/assets/images/20220704BinaryTreeLevelOrder/1.webp)

``` sh 
è¾“å…¥ï¼šroot = [3,9,20,null,null,15,7]
è¾“å‡ºï¼š[[3],[9,20],[15,7]]

```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šroot = [1]
è¾“å‡ºï¼š[[1]]
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šroot = []
è¾“å‡ºï¼š[]
```

## å®ç°ä»£ç 

``` c++
struct TreeNode {
    int val;
    TreeNode *left;
    TreeNode *right;
    TreeNode() : val(0), left(nullptr), right(nullptr) {}
    TreeNode(int x) : val(x), left(nullptr), right(nullptr) {}
    TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) {}
};
  
class Solution {
public:
    vector<vector<int>> levelOrder(TreeNode* root) {
        vector<vector<int>> ret;
        if(root == nullptr) { return ret; }
        queue <TreeNode *> q;
        q.push(root);
        while(!q.empty()) {
            int levelSize = q.size();
            ret.push_back(vector<int>());
            for (int i = 1; i <= levelSize; ++i) {
                auto node = q.front();
                q.pop();
                ret.back().push_back(node->val);
                if (node->left) {
                    q.push(node->left);
                }
                if (node->right) {
                    q.push(node->right);
                }
            }
        }
        return ret;
    }
};
```


[102. äºŒå‰æ ‘çš„å±‚åºéå†](https://leetcode.cn/problems/binary-tree-level-order-traversal/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)



URL: https://sunyazhou.com/2022/07/twosum/index.html.md
Published At: 2022-07-04 02:03:00 +0000

# ä¸¤æ•°ä¹‹å’Œ

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„`nums`å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼`target`ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º`å’Œä¸ºç›®æ ‡å€¼` `target`çš„é‚£`ä¸¤ä¸ª`æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚

ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆã€‚ä½†æ˜¯ï¼Œæ•°ç»„ä¸­åŒä¸€ä¸ªå…ƒç´ åœ¨ç­”æ¡ˆé‡Œä¸èƒ½é‡å¤å‡ºç°ã€‚

ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚


#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šnums = [2,7,11,15], target = 9
è¾“å‡ºï¼š[0,1]
è§£é‡Šï¼šå› ä¸º nums[0] + nums[1] == 9 ï¼Œè¿”å› [0, 1] ã€‚

```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šnums = [3,2,4], target = 6
è¾“å‡ºï¼š[1,2]
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šnums = [3,3], target = 6
è¾“å‡ºï¼š[0,1]
```

## Answer

``` c++
class Solution {
public:
    vector<int> twoSum(vector<int>& nums, int target) {
        int n = nums.size();
        for (int i = 0; i < n; ++i) {
            for (int j = i+1; j < n; ++j) {
                if (nums[i] + nums[j] == target) {
                    return {i,j};
                }
            }
        }
        return {};
    }
};
```


[1. ä¸¤æ•°ä¹‹å’Œ](https://leetcode.cn/problems/two-sum/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/mergetwolists/index.html.md
Published At: 2022-07-01 07:38:00 +0000

# åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„`å‡åº`é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ 

#### ç¤ºä¾‹1

![](/assets/images/20220701MergeTwoLists/mergelinklist.webp)

``` sh
è¾“å…¥ï¼šl1 = [1,2,4], l2 = [1,3,4]
è¾“å‡ºï¼š[1,1,2,3,4,4]
```
#### ç¤ºä¾‹2

``` sh
è¾“å…¥ï¼šl1 = [], l2 = []
è¾“å‡ºï¼š[]
```
#### ç¤ºä¾‹3

``` sh
è¾“å…¥ï¼šl1 = [], l2 = [0]
è¾“å‡ºï¼š[0]
```

## Answer

``` c++
struct ListNode {
    int val;
    ListNode *next;
    ListNode() : val(0), next(nullptr) {}
    ListNode(int x) : val(x), next(nullptr) {}
    ListNode(int x, ListNode *next) : val(x), next(next) {}
};
 
class Solution {
public:
    ListNode* mergeTwoLists(ListNode* list1, ListNode* list2) {
        if (list1 == nullptr) {
            return list2;
        } else if (list2 == nullptr) {
            return list1;
        } else if (list1->val < list2->val) {
            list1->next = mergeTwoLists(list1->next, list2);
            return list1;
        } else {
            list2->next = mergeTwoLists(list2->next, list1);
            return list2;
        }
    }
};
```



[21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨](https://leetcode.cn/problems/merge-two-sorted-lists/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/maxsubarray/index.html.md
Published At: 2022-07-01 07:29:00 +0000

# æœ€å¤§å­æ•°ç»„å’Œ

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„`nums`ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚

`å­æ•°ç»„`æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚

#### ç¤ºä¾‹1

``` sh
è¾“å…¥ï¼šnums = [-2,1,-3,4,-1,2,1,-5,4]
è¾“å‡ºï¼š6
è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚
```

#### ç¤ºä¾‹2

``` sh
è¾“å…¥ï¼šnums = [1]
è¾“å‡ºï¼š1
```

#### ç¤ºä¾‹3

``` sh
è¾“å…¥ï¼šnums = [5,4,-1,7,8]
è¾“å‡ºï¼š23
```

## Answer

``` c++
class Solution {
public:
    int maxSubArray(vector<int>& nums) {
        int pre = 0, maxAns = nums[0];
        for (const auto &x: nums) {
            pre = max( pre + x, x);
            maxAns = max(maxAns,pre);
        }
        return maxAns;
    }
};
```



[53. æœ€å¤§å­æ•°ç»„å’Œ](https://leetcode.cn/problems/maximum-subarray/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/threesum/index.html.md
Published At: 2022-07-01 06:55:00 +0000

# ä¸‰æ•°ä¹‹å’Œ

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ ä¸€ä¸ªåŒ…å«`n`ä¸ªæ•´æ•°çš„æ•°ç»„`nums`ï¼Œåˆ¤æ–­`nums`ä¸­æ˜¯å¦å­˜åœ¨ä¸‰ä¸ªå…ƒç´ `a`ï¼Œ`b`ï¼Œ`c` ï¼Œä½¿å¾—Â `a + b + c = 0`ï¼Ÿè¯·ä½ æ‰¾å‡ºæ‰€æœ‰å’Œä¸º`0`ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚

> æ³¨æ„ï¼šç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚

#### ç¤ºä¾‹1

``` sh 
è¾“å…¥ï¼šnums = [-1,0,1,2,-1,-4]
è¾“å‡ºï¼š[[-1,-1,2],[-1,0,1]]
```

#### ç¤ºä¾‹2

``` sh 
è¾“å…¥ï¼šnums = []
è¾“å‡ºï¼š[]
```

#### ç¤ºä¾‹3

``` sh 
è¾“å…¥ï¼šnums = [0]
è¾“å‡ºï¼š[]
```

## Answer

``` c++
class Solution {
public:
    vector<vector<int>> threeSum(vector<int>& nums) {
        int n = nums.size();
        sort(nums.begin(),nums.end());
        vector<vector<int>> ans;
        for (int first = 0; first < n; ++first) {
            //check
            if (first > 0 && nums[first] == nums[first - 1]) {
                continue;
            }
            int third = n -1;
            int target = -nums[first];
            for (int second = first + 1; second < n; ++second) {
                if (second > first + 1 && nums[second] == nums[second - 1]) {
                    continue;
                }
                while (second < third && nums[second] + nums[third] > target) {
                    --third;
                }

                if (second == third) {
                    break;
                }
                if (nums[second] + nums[third] == target) {
                    ans.push_back({nums[first],nums[second],nums[third]});
                }
            }
        }
        return ans;
    }
};
```


[15. ä¸‰æ•°ä¹‹å’Œ](https://leetcode.cn/problems/3sum/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/kthlargest/index.html.md
Published At: 2022-07-01 06:44:00 +0000

# æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ 

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™å®šæ•´æ•°æ•°ç»„`nums`å’Œæ•´æ•°`k`ï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬`k`ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚

è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬`k`ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬`k`ä¸ªä¸åŒçš„å…ƒç´ ã€‚

#### ç¤ºä¾‹1

``` sh
è¾“å…¥: [3,2,1,5,6,4] å’Œ k = 2
è¾“å‡º: 5
```

#### ç¤ºä¾‹2

``` sh
è¾“å…¥: [3,2,3,1,2,4,5,5,6] å’Œ k = 4
è¾“å‡º: 4
```

## Answer

``` c++
class Solution {
public:
   void maxHeapify(vector<int> &nums, int i, int heapsize) {
        int left = i * 2+1, right = i * 2+2, largest = i;
        if (left < heapsize && nums[left] > nums[largest]) {
            largest = left;
        }
        if (right < heapsize && nums[right] > nums[largest]) {
            largest = right;
        }
        if (largest != i) {
            swap(nums[i], nums[largest]);
            maxHeapify(nums, largest, heapsize);
        }
    }

    void buildMaxHeap(vector<int> &nums, int heapsize){
        for (int i = heapsize/2; i >= 0; --i) {
            maxHeapify(nums, i , heapsize);
        }
    }

    //å †åŒ–
    int findKthLargest(vector<int> nums, int k){
        int heapsize = nums.size();
        buildMaxHeap(nums, heapsize);
        for (int i = nums.size() - 1; i >= nums.size() - k + 1; --i) {
            swap(nums[0],nums[i]);
            --heapsize;
            maxHeapify(nums, 0, heapsize);
        }
        return nums[0];
    }
};
```



[215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ ](https://leetcode.cn/problems/kth-largest-element-in-an-array/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/lrucache/index.html.md
Published At: 2022-07-01 06:35:00 +0000

# LRU ç¼“å­˜

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³`LRU(æœ€è¿‘æœ€å°‘ä½¿ç”¨)ç¼“å­˜` çº¦æŸçš„æ•°æ®ç»“æ„ã€‚
å®ç°`LRUCache`ç±»ï¼š

*  `LRUCache(int capacity)`ä»¥ `æ­£æ•´æ•°` ä½œä¸ºå®¹é‡`capacity`åˆå§‹åŒ–LRUç¼“å­˜
* `int get(int key)` å¦‚æœå…³é”®å­— `key` å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› `-1`ã€‚
* `void put(int key, int value)`å¦‚æœå…³é”®å­—`key`å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼`value`ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„`key-value`ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡`capacity`ï¼Œåˆ™åº”è¯¥`é€å‡º`æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚
å‡½æ•°`get`å’Œ`put`å¿…é¡»ä»¥`O(1)`çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚

#### ç¤ºä¾‹

``` sh
è¾“å…¥
["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]
è¾“å‡º
[null, null, null, 1, null, -1, null, -1, 3, 4]

è§£é‡Š
LRUCache lRUCache = new LRUCache(2);
lRUCache.put(1, 1); // ç¼“å­˜æ˜¯ {1=1}
lRUCache.put(2, 2); // ç¼“å­˜æ˜¯ {1=1, 2=2}
lRUCache.get(1);    // è¿”å› 1
lRUCache.put(3, 3); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {1=1, 3=3}
lRUCache.get(2);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.put(4, 4); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {4=4, 3=3}
lRUCache.get(1);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.get(3);    // è¿”å› 3
lRUCache.get(4);    // è¿”å› 4

```

## Answer

``` c++
struct DLinkedNode { //åŸºç¡€ç»“æ„
    int key, value;
    DLinkedNode* prev;
    DLinkedNode* next;
    DLinkedNode(): key(0),value(0), prev(nullptr), next(nullptr) {}
    DLinkedNode(int _key, int _value): key(_key),value(_value), prev(nullptr), next(nullptr) {}
};

class LRUCache {
private: 
    unordered_map<int, DLinkedNode*> cache;
    DLinkedNode* head;
    DLinkedNode* tail;
    int size;
    int capacity;
public:
    LRUCache(int _capacity): capacity(_capacity),size(0) {
        head = new DLinkedNode();
        tail = new DLinkedNode();
        head->next = tail; //åç»§è¿æ¥å°¾éƒ¨
        tail->prev = head; //å‰é©±è¿æ¥å¤´éƒ¨
    }
    
    void addToHead(DLinkedNode* node) {
        node->prev = head;
        node->next = head->next;
        head->next->prev = node;
        head->next = node;
    }

    void moveToHead(DLinkedNode* node) {
        removeNode(node);
        addToHead(node);
    }

    void removeNode(DLinkedNode* node) {
        node->next->prev = node->prev;
        node->prev->next = node->next;
    }

    DLinkedNode* removeTail(){
        DLinkedNode *node = tail->prev;
        removeNode(node);
        return node;
    }

    int get(int key) {
        if (!cache.count(key)) {
            return -1;
        } 
        DLinkedNode* node = cache[key];
        moveToHead(node);
        return node->value;
    }
    
    void put(int key, int value) {
        if (!cache.count(key)) { //å¦‚æœä¸å­˜åœ¨
            DLinkedNode* node = new DLinkedNode(key,value);
            cache[key] = node;
            addToHead(node);
            ++size;
            if (size > capacity) {
                DLinkedNode *node = removeTail();
                cache.erase(node->key);
                delete node;
                --size;
            }
        } else {
            DLinkedNode *node = cache[key];
            moveToHead(node);
            node->value = value;
        }
    }
};

/**
 * Your LRUCache object will be instantiated and called as such:
 * LRUCache* obj = new LRUCache(capacity);
 * int param_1 = obj->get(key);
 * obj->put(key,value);
 */
```



[146. LRU ç¼“å­˜](https://leetcode.cn/problems/lru-cache/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/longestsubstring/index.html.md
Published At: 2022-07-01 05:21:00 +0000

# æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² `s`ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ æœ€é•¿å­ä¸² çš„é•¿åº¦ã€‚

#### ç¤ºä¾‹1

``` sh
è¾“å…¥: s = "abcabcbb"
è¾“å‡º: 3 
è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "abc"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚
```

#### ç¤ºä¾‹2

``` sh
è¾“å…¥: s = "bbbbb"
è¾“å‡º: 1
è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "b"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 1ã€‚
```

#### ç¤ºä¾‹3

``` sh
è¾“å…¥: s = "pwwkew"
è¾“å‡º: 3
è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯Â "wke"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚
Â     è¯·æ³¨æ„ï¼Œä½ çš„ç­”æ¡ˆå¿…é¡»æ˜¯ å­ä¸² çš„é•¿åº¦ï¼Œ"pwke"Â æ˜¯ä¸€ä¸ªå­åºåˆ—ï¼Œä¸æ˜¯å­ä¸²ã€‚

```

## Answer

``` c++
class Solution {
public:
    int lengthOfLongestSubstring(string s) {
        unordered_set<char> charSets;//å“ˆå¸Œé›†åˆï¼Œè®°å½•æ¯ä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°è¿‡
        int n = s.size();
        int rk = -1, ans = 0;//å³æŒ‡é’ˆï¼Œåˆå§‹å€¼ä¸º -1ï¼Œç›¸å½“äºæˆ‘ä»¬åœ¨å­—ç¬¦ä¸²çš„å·¦è¾¹ç•Œçš„å·¦ä¾§ï¼Œè¿˜æ²¡æœ‰å¼€å§‹ç§»åŠ¨
        for (int i = 0; i < n; ++i) {//æšä¸¾å·¦æŒ‡é’ˆçš„ä½ç½®ï¼Œåˆå§‹å€¼éšæ€§åœ°è¡¨ç¤ºä¸º -1
            if (i != 0) {
                charSets.erase(s[i-1]);// å·¦æŒ‡é’ˆå‘å³ç§»åŠ¨ä¸€æ ¼ï¼Œç§»é™¤ä¸€ä¸ªå­—ç¬¦
            }
            while (rk + 1 < n && !charSets.count(s[rk +1 ])) {
                charSets.insert(s[rk + 1]);// ä¸æ–­åœ°ç§»åŠ¨å³æŒ‡é’ˆ
                ++rk;
            }
            ans = max(ans, rk - i + 1);// ç¬¬ i åˆ° rk ä¸ªå­—ç¬¦æ˜¯ä¸€ä¸ªæé•¿çš„æ— é‡å¤å­—ç¬¦å­ä¸²
        }
        return ans;
    }
};
```



[3. æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²](https://leetcode.cn/problems/longest-substring-without-repeating-characters/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/07/reverselist/index.html.md
Published At: 2022-07-01 04:36:00 +0000

# åè½¬é“¾è¡¨

![](/assets/images/20220701ReverseList/algorithm.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# å¦‚é¢˜

ç»™ä½ å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹`head`ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚  
![](/assets/images/20220701ReverseList/1.webp)

``` sh
è¾“å…¥ï¼šhead = [1,2,3,4,5]
è¾“å‡ºï¼š[5,4,3,2,1]
```

## Answer

``` c++
//Definition for singly-linked list.
struct ListNode {
    int val;
    ListNode *next;
    ListNode() : val(0), next(nullptr) {}
    ListNode(int x) : val(x), next(nullptr) {}
    ListNode(int x, ListNode *next) : val(x), next(next) {}
};
 
class Solution {
public:
    ListNode* reverseList(ListNode* head) {
        ListNode *prev = nullptr;
        ListNode *curr = head;
        while (curr){
            ListNode *next = curr->next;
            curr->next = prev;
            prev = curr;
            curr = next;
        }
        return prev;
    }
};
```



[206. åè½¬é“¾è¡¨](https://leetcode-cn.com/problems/reverse-linked-list/)  
[å¼•ç”¨è‡ªcodetop](https://codetop.cc/home)


URL: https://sunyazhou.com/2022/04/Mos/index.html.md
Published At: 2022-04-25 01:28:00 +0000

# macosé¼ æ ‡è½¯ä»¶MOS

![](/assets/images/20220425Mos/mos.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## æ¨èä¸€ä¸ªå¥½ç”¨çš„macä¸Šä½¿ç”¨é¼ æ ‡çš„è½¯ä»¶

å…è´¹å¼€æºmacä¸Šä½¿ç”¨windowsé¼ æ ‡æ»‘åŠ¨è‡ªç„¶çš„è½¯ä»¶[mos](https://mos.caldis.me/)


å¯ä»¥è®©windowsä¸Šçš„é¼ æ ‡æ»šè½®æ»‘åŠ¨åƒè‹¹æœè§¦æ‘¸æ¿ä¸€æ ·ä¸æ»‘

[ç‚¹æ­¤ä¸‹è½½](https://github.com/Caldis/Mos/releases/download/3.3.2/Mos.Versions.3.3.2.dmg)





URL: https://sunyazhou.com/2022/04/BranchManage/index.html.md
Published At: 2022-04-14 00:50:00 +0000

# å¼€å‘åˆ†æ”¯ç®¡ç†æ¨¡å‹

![](/assets/images/20220414BranchManage/git.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## ä¸€ç§é€‚åˆå®¢æˆ·ç«¯å¼€å‘çš„åˆ†æ”¯ç®¡ç†æ¨¡å‹

![](/assets/images/20220414BranchManage/BranchGuide.webp)

é¦–å…ˆ`DEV`ä»£è¡¨å¼€å‘åˆ†æ”¯  
é¦–å…ˆ`RB`ä»£è¡¨å‘ç‰ˆåˆ†æ”¯

> æ³¨æ„æ­¤åç§°å’Œæ€è·¯å€Ÿé‰´ä¹‹å‰å¿«æ‰‹å¼€å‘çš„å†…éƒ¨åˆ†æ”¯ç®¡ç†.

å½“å¼€å‘å®Œæˆææµ‹åè‡ªåŠ¨å¼€å‡ºä¸‹ä¸ªç‰ˆæœ¬çš„RBå’ŒDEVåˆ†æ”¯.è¿™æ ·å¾ªç¯å¾€å¤.å®ç°è¿­ä»£çš„ç®¡ç†

### å¤§å®¶å…³å¿ƒçš„é—®é¢˜

#### RBçš„ä»£ç ä¿®æ”¹å¦‚æœDEVæƒ³ç”¨å¦‚ä½•å¤„ç†ï¼Ÿ

RBåˆ†æ”¯ä¿®æ”¹åå’Œå¦‚ä½•åŒæ­¥ç»™DEVåˆ†æ”¯,å¦‚æœå¸¸è§„å¼€å‘çš„è¯åœ¨ä»£ç Reviewçš„å‰æä¸‹.å¯ä»¥ä»RB æMerge Reuqeståˆ°DEV. eg: `RB1.6.0` Merge to `DEV1.6.1`.

å¦‚æœåªæ˜¯å‡ ä¸ªç®€å•çš„commit çš„è¯ æˆ‘å»ºè®®RBä¸Šçš„æäº¤è‡ªå·±æ‰‹åŠ¨æ‰§è¡Œ`git  cherry-pick commitIDXXX`çš„å½¢å¼åˆ°DEVåˆ†æ”¯.(ä¹Ÿå°±æ˜¯è¯´ä½ è¦åˆ‡åˆ°DEVxxxåˆ†æ”¯ ç„¶åæ‰§è¡Œ `git  cherry-pick commitIDXXX`)

#### å‘å¸ƒå®Œæˆå RBåˆ†æ”¯å¦‚ä½•å¤„ç†

ç†è®ºä¸Šå‘å¸ƒå®Œæˆåéœ€è¦åš2ä»¶äº‹

1. åˆå¹¶åˆ°`master`å å¹¶æ‰“`tag`.
2. åˆ é™¤`RBxxx`åˆ†æ”¯ 

> å¦‚æœä¸Šè¿°æ“ä½œå®Œæˆå,RBçš„ä¿®æ”¹å¦‚æœdevæƒ³ç”¨ä½†æ˜¯RBåˆ†æ”¯è¢«åˆ é™¤äº†çš„è¯å¯ä»¥ç›´æ¥ä»master mergeä»£ç åˆ°DEV.

#### RBåˆ†æ”¯çš„ ç›®çš„æ˜¯ï¼Ÿ

1. åªæ¥å—bugçš„ä¿®æ”¹
2. ä¸æ¥å—éœ€æ±‚å¼€å‘,ä¸èƒ½ åˆå¹¶DEV

> æ³¨æ„: RBä¸èƒ½åˆå¹¶DEV,åªèƒ½DEV Merge RB!  
> æ³¨æ„: RBä¸èƒ½åˆå¹¶DEV,åªèƒ½DEV Merge RB!  
> æ³¨æ„: RBä¸èƒ½åˆå¹¶DEV,åªèƒ½DEV Merge RB!  

## æ€»ç»“

åˆ†æ”¯ç®¡ç†å„å®¶éƒ½æœ‰è‡ªå·±çš„ç®¡ç†æ–¹å¼,æ²¡æœ‰è°æ¯”è°æ›´å¥½,åªæœ‰é‚£äº›ç®¡ç†æ–¹å¼æ›´é€‚åˆ.

--
æœ¬æ–‡æ’°å†™è‡ª  
[sunyazhou](https://https://www.sunyazhou.com/)   
[ä¸­] sunyazhou.com   
æ­¤ææ–™å—ç‰ˆæƒä¿æŠ¤






URL: https://sunyazhou.com/2022/04/YZ3DMenu/index.html.md
Published At: 2022-04-13 01:50:00 +0000

# å¼€æºYZ3DMenuå¯¼èˆªèœå•

![](/assets/images/20220413YZ3DMenu/3dmenu.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

ä¸Šå›¾å…ˆçœ‹æ•ˆæœ

![å¼€æºé¡¹ç›®](/assets/images/20220413YZ3DMenu/3DMenuDemo1.gif) 
![å®è·µå®Œæˆ](/assets/images/20220413YZ3DMenu/3DMenuDemo2.gif)

è¿™ä¸ªèœå•æ˜¯ä¸ª3Dèœå•,ä¹‹å‰åœ¨ä¸€ä¸ªå«cosmosçš„appä¸­å‡ºç°,ä¹‹å‰ä¸€ç›´æƒ³æ‰¾ä¸ªæ—¶é—´æŠŠè¿™ä¸ªåŠŸèƒ½æå‡ºæ¥å¼€æº.ä¹‹åå‡ºç°äº†ä¸€ä¸ªç±»ä¼¼å¾®åšçš„å¼€æºé¡¹ç›®[Cosmos](https://github.com/zhnnnnn/ZHNCosmos) è¿™ä¸€é˜µå­æœ‰æ—¶é—´ æŠŠè¿™ä¸ªç»„ä»¶é‡å†™ä¸€é.

## å®ç°åŸç†

* é€šè¿‡tabbarçš„æŒ‰é’®è§¦å‘(å†…éƒ¨å°è£…panæ‰‹åŠ¿)æ—¶æœº,å¼€å§‹æ‹–æ‹½ä¸­ã€ç»“æŸæˆ–å–æ¶ˆ...
* æ·»åŠ æ–°window å¹¶åœ¨windowä¸Šè¦†ç›–äº† Bluræ¨¡ç³Šå’Œå®¹å™¨,ä»¥åŠå°è£…çš„ä»ªè¡¨ç›˜èœå•è§†å›¾
* æ»‘åŠ¨è¿‡ç¨‹ä¸­æ”¹åŠ¨èœå•è§†å›¾(ä»ªè¡¨ç›˜èœå•)çš„m34åŠ¨ç”»å±æ€§å®ç° å€¾æ–œæ»‘åŠ¨.

![å†…éƒ¨å˜é‡](/assets/images/20220413YZ3DMenu/3DMenuDemo3.gif) 

ä¸‹é¢æ˜¯æ¡†æ¶çš„ä»£ç ç»“æ„è®¾è®¡

![](/assets/images/20220413YZ3DMenu/3DMenuDesign.webp)

ä»£ç æ¯”è¾ƒå¤š æˆ‘è¿™é‡Œæ²¡æœ‰ç»™å¤§å®¶è¯¦ç»†åˆ—,æˆ‘æŠŠä»£ç  æ”¾åœ¨äº† [github](https://github.com/sunyazhou13/YZ3DMenu)ä¸Šæ„Ÿå…´è¶£çš„å¯ä»¥ç‚¹å‡»æŸ¥çœ‹ä¸€ä¸‹.



## æ€»ç»“

ä¹‹å‰ä¸€ç›´æƒ³æŠŠè¿™ä¸ªé‡å†™ä¸€ä¸‹,ä¸€ç›´æ²¡æœ‰æŠ½å‡ºæ—¶é—´,åç»­æ‰“ç®—ç”¨swifté‡å†™ä¸€ä¸ªæ–°çš„è½®å­,å¸Œæœ›è¿™ä¸ªå¼€æºç»„ä»¶èƒ½å¸®åˆ°ä½ ,æœ‰é—®é¢˜å¯ä»¥ä¸‹æ–¹ç•™è¨€, å¾ˆä¹…æ²¡æœ‰å†™åšå®¢äº†.2022å¹´è¦åšæŒå†™ä¸€äº›ç¡¬æ ¸æŠ€æœ¯.

[æœ¬æ–‡demoåœ°å€](https://github.com/sunyazhou13/YZ3DMenu)   

--
æ‘˜å½•æ¥è‡ª  
[å‚è€ƒCosmos](https://github.com/zhnnnnn/ZHNCosmos)   
[ä¸­]  zhnnnnn   
æœ¬æ–‡ææ–™å—ç‰ˆæƒä¿æŠ¤






URL: https://sunyazhou.com/2022/04/CVPixelBufferRef/index.html.md
Published At: 2022-04-06 01:50:00 +0000

# æ·±å…¥ç†è§£CVPixelBufferRef

![](/assets/images/20220406CVPixelBufferRef/Cover.webp)

åœ¨iOSé‡Œï¼Œæˆ‘ä»¬ç»å¸¸èƒ½çœ‹åˆ°`CVPixelBufferRef`è¿™ä¸ªç±»å‹ï¼Œåœ¨`Camera`é‡‡é›†è¿”å›çš„æ•°æ®é‡Œå¾—åˆ°ä¸€ä¸ª`CMSampleBufferRef`,è€Œæ¯ä¸ª`CMSampleBufferRef`é‡Œåˆ™åŒ…å«ä¸€ä¸ª`CVPixelBufferRef`,åœ¨è§†é¢‘ç¡¬è§£ç çš„è¿”å›æ•°æ®é‡Œä¹Ÿæ˜¯ä¸€ä¸ª`CVPixelBufferRef`ã€‚

é¡¾åæ€ä¹‰,`CVPixelBufferRef`æ˜¯ä¸€ç§åƒç´ å›¾ç‰‡ç±»å‹ï¼Œç”±äº`CV`å¼€å¤´ï¼Œæ‰€ä»¥å®ƒæ˜¯å±äº`CoreVideo`æ¨¡å—çš„ã€‚

iOSå–œæ¬¢åœ¨å¯¹è±¡å‘½åå‰é¢ç”¨ç¼©å†™è¡¨ç¤ºå®ƒå±äºçš„æ¨¡å—ï¼Œæ¯”å¦‚`CF`ä»£è¡¨`CoreFoundation`,`CG`ä»£è¡¨`CoreGraphic`ï¼Œ`CM`ä»£è¡¨ `CoreMedia`ã€‚æ—¢ç„¶å±äº`CoreVideo`é‚£ä¹ˆå®ƒå°±å’Œè§†é¢‘å¤„ç†ç›¸å…³äº†ã€‚

å®ƒæ˜¯ä¸€ä¸ª`C`å¯¹è±¡ï¼Œè€Œä¸æ˜¯`Objective-C`å¯¹è±¡ï¼Œæ‰€ä»¥å®ƒä¸æ˜¯ä¸€ä¸ªç±»ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»ä¼¼`Handle`çš„ä¸œè¥¿ã€‚ä»ä»£ç å¤´æ–‡ä»¶çš„å®šä¹‰æ¥çœ‹

`CVPixelBufferRef`å°±æ˜¯ç”¨`CVBufferRef` `typedef`è€Œæ¥çš„ï¼Œè€Œ`CVBufferRef`æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª`void *`ï¼Œè‡³äºè¿™ä¸ª`void *`å…·ä½“æŒ‡å‘ä»€ä¹ˆæ•°æ®åªæœ‰ç³»ç»Ÿæ‰çŸ¥é“äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ° æ‰€æœ‰å¯¹`CVPixelBufferRef`è¿›è¡Œæ“ä½œçš„å‡½æ•°éƒ½æ˜¯çº¯`C`å‡½æ•°ï¼Œè¿™å¾ˆç¬¦åˆiOS `CoreXXXX`ç³»åˆ—`API` çš„é£æ ¼ã€‚

æ¯”å¦‚`CVPixelBufferGetWidth`,`CVPixelBufferGetBytesPerRow`

é€šè¿‡APIå¯ä»¥çœ‹å‡ºæ¥ï¼Œ`CVPixelBufferRef`é‡ŒåŒ…å«å¾ˆå¤šå›¾ç‰‡ç›¸å…³å±æ€§ï¼Œæ¯”è¾ƒé‡è¦çš„æœ‰`width`ï¼Œ`height`ï¼Œ`PixelFormatType`ç­‰ã€‚

ç”±äºå¯ä»¥æœ‰ä¸åŒçš„`PixelFormatType`ï¼Œè¯´æ˜ä»–å¯ä»¥æ”¯æŒå¤šç§ä½å›¾æ ¼å¼ï¼Œé™¤äº†å¸¸è§çš„`RGB32`ä»¥å¤–ï¼Œè¿˜å¯ä»¥æ”¯æŒæ¯”å¦‚`kCVPixelFormatType_420YpCbCr8BiPlanarFullRange`ï¼Œè¿™ç§`YUV`å¤šå¹³é¢çš„æ•°æ®æ ¼å¼ï¼Œè¿™ä¸ªç±»å‹é‡Œ `BiPlanar`è¡¨ç¤ºåŒå¹³é¢ï¼Œè¯´æ˜å®ƒæ˜¯ä¸€ä¸ª`NV12`çš„`YUV`ï¼ŒåŒ…å«ä¸€ä¸ªYå¹³é¢å’Œä¸€ä¸ªUVå¹³é¢ã€‚é€šè¿‡`CVPixelBufferGetBaseAddressOfPlane`å¯ä»¥å¾—åˆ°æ¯ä¸ªå¹³é¢çš„æ•°æ®æŒ‡é’ˆã€‚åœ¨å¾—åˆ°`Address`ä¹‹å‰éœ€è¦è°ƒç”¨`CVPixelBufferLockBaseAddress`ï¼Œè¿™è¯´æ˜`CVPixelBufferRef`çš„å†…éƒ¨å­˜å‚¨ä¸ä»…æ˜¯å†…å­˜ä¹Ÿå¯èƒ½æ˜¯å…¶å®ƒå¤–éƒ¨å­˜å‚¨ï¼Œæ¯”å¦‚ç°å­˜ï¼Œæ‰€ä»¥åœ¨è®¿é—®å‰è¦`lock`ä¸‹æ¥å®ç°åœ°å€æ˜ å°„ï¼ŒåŒæ—¶`lock`ä¹Ÿä¿è¯äº†æ²¡æœ‰è¯»å†™å†²çªã€‚

ç”±äºæ˜¯Cå¯¹è±¡ï¼Œå®ƒæ˜¯ä¸å— ARC ç®¡ç†çš„ï¼Œå°±æ˜¯è¯´è¦å¼€å‘è€…è‡ªå·±æ¥ç®¡ç†å¼•ç”¨è®¡æ•°ï¼Œæ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥ç”¨`CVPixelBufferRetain`ï¼Œ`CVPixelBufferRelease`å‡½æ•°ç”¨æ¥åŠ å‡å¼•ç”¨è®¡æ•°ï¼Œå…¶å®å’Œ`CFRetain`å’Œ`CFRelease`æ˜¯ç­‰æ•ˆçš„ï¼Œæ‰€ä»¥å¯ä»¥ç”¨`CFGetRetainCount`æ¥æŸ¥çœ‹å½“å‰å¼•ç”¨è®¡æ•°ã€‚

å¦‚æœè¦æ˜¾ç¤º`CVPixelBufferRef`é‡Œçš„å†…å®¹ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªæ€è·¯ã€‚

æŠŠ`CVPixelBufferRef`è½¬æ¢æˆ`UIImage`ï¼Œå°±å¯ä»¥ç›´æ¥èµ‹å€¼ç»™`UIImageView`çš„`image`å±æ€§ï¼Œæ˜¾ç¤ºåœ¨UIImageViewä¸Šï¼Œç¤ºä¾‹ä»£ç 

``` objc
+ (UIImage*)uiImageFromPixelBuffer:(CVPixelBufferRef)p {
    CIImage* ciImage = [CIImage imageWithCVPixelBuffer:p];
    CIContext* context = [CIContext contextWithOptions:@{kCIContextUseSoftwareRenderer : @(YES)}];
    CGRect rect = CGRectMake(0, 0, CVPixelBufferGetWidth(p), CVPixelBufferGetHeight(p));
    CGImageRef videoImage = [context createCGImage:ciImage fromRect:rect];
    UIImage* image = [UIImage imageWithCGImage:videoImage];
    CGImageRelease(videoImage);
    return image;
}
```

ä»ä»£ç å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ä¸ªè½¬æ¢æœ‰ç‚¹å¤æ‚ï¼Œä¸­é—´ç»å†äº†å¤šä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥æ€§èƒ½æ˜¯å¾ˆå·®çš„ï¼Œåªé€‚åˆå¶å°”è½¬æ¢ä¸€å¼ å›¾ç‰‡ï¼Œç”¨äºè°ƒè¯•æˆªå›¾ç­‰ï¼Œç”¨äºæ˜¾ç¤ºè§†é¢‘è‚¯å®šæ˜¯ä¸è¡Œçš„ã€‚

å¦ä¸€ä¸ªæ€è·¯æ˜¯ç”¨OpenGLæ¥æ¸²æŸ“ï¼Œ`CVPixelBufferRef`æ˜¯å¯ä»¥è½¬æ¢æˆä¸€ä¸ª`openGL texture`çš„ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š

``` c
CVOpenGLESTextureRef pixelBufferTexture;
CVOpenGLESTextureCacheCreateTextureFromImage(kCFAllocatorDefault,
                                             _textureCache,
                                             pixelBuffer,
                                             NULL,
                                             GL_TEXTURE_2D,
                                             GL_RGBA,
                                             width,
                                             height,
                                             GL_BGRA,
                                             GL_UNSIGNED_BYTE,
                                             0,
                                             &pixelBufferTexture);
```

å…¶ä¸­ï¼Œ`_textureCache`ä»£è¡¨ä¸€ä¸ª`Texture`ç¼“å­˜ï¼Œæ¯æ¬¡ç”Ÿäº§çš„`Texture`éƒ½æ˜¯ä»ç¼“å­˜è·å–çš„ï¼Œè¿™æ ·å¯ä»¥çœæ‰åå¤åˆ›å»º`Texture`çš„å¼€é”€ï¼Œ`_textureCache`è¦å®ç°åˆ›å»ºå¥½ï¼Œåˆ›å»ºæ–¹æ³•å¦‚ä¸‹

``` c
CVOpenGLESTextureCacheCreate(kCFAllocatorDefault, NULL, _context, NULL, &_textureCache);
```

å…¶ä¸­`_context`æ˜¯`openGL`çš„ `context`ï¼Œåœ¨`iOS`é‡Œå°±æ˜¯ `EAGLContext *`

`pixelBufferTexture`è¿˜ä¸æ˜¯`openGL`çš„`Texture`ï¼Œè°ƒç”¨`CVOpenGLESTextureGetName`æ‰èƒ½è·å¾—åœ¨`openGL`å¯ä»¥ä½¿ç”¨çš„`Texture ID`ã€‚

å½“è·å¾—äº† `Texture ID`åå°±å¯ä»¥ç”¨`openGL`æ¥ç»˜åˆ¶äº†ï¼Œè¿™é‡Œæ¨èç”¨ `GLKView`æ¥åšç»˜åˆ¶

``` c
glUseProgram(_shaderProgram);
glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_2D, textureId);
glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glDrawArrays(GL_TRIANGLE_FAN, 0, 4);
```

å½“ç„¶è¿™ä¸æ˜¯å…¨éƒ¨ä»£ç ï¼Œå®Œæ•´çš„ç»˜åˆ¶`openGL`ä»£ç è¿˜æœ‰å¾ˆå¤šï¼Œ`openGL`æ˜¯è‘—åçš„å•°å—¦å†—é•¿ï¼Œè¿˜æœ‰`openGL` `Context`åˆ›å»º`shader`ç¼–è¯‘`DataBuffer`åŠ è½½ç­‰ã€‚

æœ¬è´¨ä¸Šè¿™æ®µä»£ç æ˜¯ä¸ºäº†æŠŠ`Texture`çš„å†…å®¹ç»˜åˆ¶åˆ° `openGLçš„frame buffer`é‡Œï¼Œç„¶åå†æŠŠ`frame buffer`è´´åˆ° `CAEAGLayer`ã€‚

è¿™ä¸ªä»`CVPixelBufferRef`è·å–çš„`texture`ï¼Œå’ŒåŸæ¥çš„`CVPixelBufferRef`å¯¹è±¡å…±äº«åŒä¸€ä¸ªå­˜å‚¨ï¼Œå°±æ˜¯è¯´å¦‚æœæ”¹å˜äº†`Texture`çš„å†…å®¹ï¼Œé‚£ä¹ˆ`CVPixelBufferRef`çš„å†…å®¹ä¹Ÿä¼šæ”¹å˜ã€‚åˆ©ç”¨è¿™ä¸€ç‚¹æˆ‘ä»¬å°±å¯å¯ä»¥ç”¨`openGL`çš„ç»˜åˆ¶æ–¹æ³•å‘`CVPixelBufferRef`å¯¹è±¡è¾“å‡ºå†…å®¹äº†ã€‚æ¯”å¦‚å¯ä»¥ç»™`CVPixelBufferRef`çš„å†…å®¹åŠ å›¾å½¢ç‰¹æ•ˆæ‰“æ°´å°ç­‰ã€‚

é™¤äº†ä»ç³»ç»ŸAPIé‡Œè·å¾—`CVPixelBufferRef`å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åˆ›å»º`CVPixelBufferRef`

``` objc
+(CVPixelBufferRef)createPixelBufferWithSize:(CGSize)size {
    const void *keys[] = {
        kCVPixelBufferOpenGLESCompatibilityKey,
        kCVPixelBufferIOSurfacePropertiesKey,
    };
    const void *values[] = {
        (__bridge const void *)([NSNumber numberWithBool:YES]),
        (__bridge const void *)([NSDictionary dictionary])
    };
    
    OSType bufferPixelFormat = kCVPixelFormatType_32BGRA;
    
    CFDictionaryRef optionsDictionary = CFDictionaryCreate(NULL, keys, values, 2, NULL, NULL);
    
    CVPixelBufferRef pixelBuffer = NULL;
    CVPixelBufferCreate(kCFAllocatorDefault,
                        size.width,
                        size.height,
                        bufferPixelFormat,
                        optionsDictionary,
                        &pixelBuffer);
    
    CFRelease(optionsDictionary);
    
    return pixelBuffer;
}
```

åˆ›å»ºä¸€ä¸ª`BGRA`æ ¼å¼çš„`PixelBuffer`ï¼Œæ³¨æ„`kCVPixelBufferOpenGLESCompatibilityKey`å’Œ`kCVPixelBufferIOSurfacePropertiesKey`è¿™ä¸¤ä¸ªå±æ€§ï¼Œè¿™æ˜¯ä¸ºäº†å®ç°å’Œ`openGL`å…¼å®¹ï¼Œå¦å¤–æœ‰äº›åœ°æ–¹è¦æ±‚`CVPixelBufferRef`å¿…é¡»æ˜¯`IO Surface`ã€‚

`CVPixelBufferRef`æ˜¯iOSè§†é¢‘é‡‡é›†å¤„ç†ç¼–ç æµç¨‹çš„é‡è¦ä¸­é—´æ•°æ®åª’ä»‹å’Œçº½å¸¦ï¼Œç†è§£`CVPixelBufferRefæœ‰åŠ©äºå†™å‡ºé«˜æ€§èƒ½å¯é çš„è§†é¢‘å¤„ç†ã€‚

è¦è¿›ä¸€æ­¥ç†è§£`CVPixelBufferRef`è¿˜éœ€è¦å­¦ä¹ `YUV`ï¼Œ`color range`ï¼Œ`openGL`ç­‰çŸ¥è¯†ã€‚

å¼•ç”¨è‡ª[æ·±å…¥ç†è§£CVPixelBufferRef](https://zhuanlan.zhihu.com/p/24762605?utm_source=ZHShareTargetIDMore&utm_medium=social&utm_oi=28280635785216)




URL: https://sunyazhou.com/2021/12/FinalSummary/index.html.md
Published At: 2021-12-26 00:00:00 +0000

# 2021å¹´ç»ˆæ€»ç»“

![](/assets/images/20211231FinalSummary/2021F1.webp)

<button type="button" class="btn btn-info" data-toggle="popover" title="Magotan1990" data-content="2021-7-7 å»é½é½å“ˆå°”æ‰é¾™è‡ªç„¶ä¿æŠ¤åŒºçš„è·¯ä¸Šè¢«è¿½å°¾å,ä¿®å¤å®Œçš„çŠ¶æ€">æ–°ä¸€ä»£å†œæ°‘å·¥çš„è‡³æš—æ—¶åˆ»</button>


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


å¹´åº•äº†,äº¤ä½œä¸š,è¿™ä¸€å¹´æ— ä¸šæ¸¸æ°‘è¹‰è·äº†ä¸å°‘.å›å†°åŸç”Ÿæ´»äº†ä¸€å¹´åˆåŒå’å•çš„å›åˆ°äº†æ›¾ä»Šå¥‹æ–—çš„æ ¹æ®åœ°-é¦–éƒ½åŒ—äº¬.åˆ«é—®ä¸ºä»€ä¹ˆ`ç”Ÿæ´»æ‰€è¿«`.

è¿™ä¸€å¹´è¿‡å¾ˆä¸é¡ºåˆ©,å®¶äººç”Ÿç—…,å¤–ç¥–æ¯ç¦»ä¸–,å·¥ä½œä¸ç¨³å®š,ç–«æƒ…å¸¸æ€åŒ–å»¶ç»­... å‡ ä¹æ²¡æœ‰å¥½çš„æ¶ˆæ¯.å¹´åˆçš„æ—¶å€™ç–«æƒ…çˆ†å‘,å¯¼è‡´è¿‡å¹´çš„æ—¶å€™ç–«æƒ…ä¸¥é‡å°åŸ. è‡ªå·±åœ¨åŒå­¦å®¶å°±åœ°è¿‡å¹´.

### è¯—å’Œè¿œæ–¹

ç¦»å¼€å¿«æ‰‹çš„æ—¶å€™åŒäº‹è¯´è¿™æ˜¯æ´²å“¥çš„è¯—å’Œè¿œæ–¹.è§ç¬‘äº†å“ˆå“ˆ,ä»Šå¤©çš„æ´²å“¥å¾—ä¸ºè¯—å’Œè¿œæ–¹ä»˜å‡ºä»£ä»·äº†.

> æœ‰æ—¶å€™ä¸è¢«å˜²ç¬‘çš„æ¢¦æƒ³ä¸å€¼å¾—å»å®ç°.


``` txt
"å°‘é¹": æ´²å“¥è¦åšæŒå†™åšå®¢å‘€ï¼  
"æˆ‘"ï¼šå—¯, æˆ‘ä¸€å®šä¼šåšæŒå†™å¥½!
```
æ„Ÿè°¢æˆ‘è¿˜æœ‰è¿™æ ·åŒäº‹.


## 2021å›é¡¾


*  å…³äºç”Ÿæ´»
*  å…³äºå·¥ä½œ
*  å…³äºå­¦ä¹ 
*  å…³äºæ¸¸æˆ
*  å…³äºä¿®è½¦

## å…³äºç”Ÿæ´»

è‡ªå»å¹´`é‡‘æ¯›ç‰¹æœ—æ™®`æ‰§æ”¿æœ€åæœŸé™ç¾å›½ç–«æƒ…ä¸€ç›´å¤±æ§,å¯¼è‡´è¿™ä¸ªä¸–ç•Œè·Ÿç€æ­¢æ­¥ä¸å‰,ä»–çš„ç»§ä»»è€…`æ‹œç™»`ä¸Šå°å,ç–«æƒ…ä¾ç„¶æ²¡æœ‰å¾—åˆ°æœ‰æ•ˆçš„æ§åˆ¶çš„åŒæ—¶å¼€å§‹è‚†æ„æ”¾æ°´ç‹‚å°é’ç¥¨è‡´ä½¿ç¾é‡‘é€šè´§è†¨èƒ€ä¸¥é‡. ä¸¥é‡å½±å“äº†ä¸–ç•Œå„å›½ç»æµ,è‡´ä½¿æœ€ç»ˆå½±å“åˆ°äº†æˆ‘çš„æ”¶å…¥(æ¯ä¸ªäººçš„æ”¶å…¥). 

åç–«æƒ…æ—¶ä»£çš„æŒ½æ­Œä¾ç„¶ä¸åœåœ°æŒç»­å‘é…µ,æˆ‘çš„ç”Ÿæ´»ä¹Ÿéšç€ç–«æƒ…çš„æ³¢åŠ¨èµ·èµ·ä¼ä¼ä»æœªç¨³å®š.å›å®¶åçš„æˆ‘å˜å¾—æ²‰é»˜å¯¡è¨€,å¯¹æŠ€æœ¯çš„çƒ­çˆ±ä»æœªå› ç¯å¢ƒçš„å˜åŒ–è€Œè¡°å‡.


![](/assets/images/20211231FinalSummary/2021F2.webp)

ä¸ºäº†åº”å¯¹ç–«æƒ…,å›½å®¶å…è´¹æ¥ç§ç–«è‹—,æˆªæ­¢æœ¬æ–‡æ’°å†™æ—¶é—´æˆªæ­¢,æˆ‘å·²ç»å…¨éƒ¨å®Œæˆäº†3é’ˆçš„ç–«è‹—æ¥ç§.ä¿æŠ¤äº†è‡ªèº«å’Œå®¶äººçš„å®‰å…¨.

#### æœ€å¼€å¿ƒçš„äº‹

ä»Šå¹´æœ€å¼€å¿ƒçš„äº‹è«è¿‡äºæ‹¿åˆ°æ–°æˆ¿çš„æˆ¿æœ¬

![](/assets/images/20211231FinalSummary/2021F3.webp)



ä¸‹ç­åè¡£æœä¸€æ‰”æ²™å‘å¼€å§‹åšæ™šé¥­, æˆ‘æ²¡æƒ³åˆ°å¨æˆ¿æ˜¯æˆ‘åº¦è¿‡æ—¶å…‰æœ€å¤šçš„åœ°æ–¹.

![](/assets/images/20211231FinalSummary/2021F5.webp)

æˆ‘æçš„è·Ÿç‚¼é‡‘æœ¯å¸ˆä¸€æ ·,æ·»æ²¹åŠ é†‹,æ²¹æ¸©,çƒ¹é¥ª.

![](/assets/images/20211231FinalSummary/2021F4.webp)

åƒå®Œæ™šé¥­æˆ‘ä¼šå»å®¶é—¨å£å“ˆè¥¿ç«™å¹¿åœºé›å¼¯,æ€è€ƒä¸€ä¸‹äººç”Ÿ.

![](/assets/images/20211231FinalSummary/2021F9.webp)

è‡³äºçƒ¹é¥ªçš„äº‹æƒ…è¿˜æ˜¯æŒºä½©æœå¤§å­¦ææœˆè¾‰è€å¸ˆ,æˆ‘å³ä¾¿å¦‚ä½•å°è¯•ä¹Ÿæœªæ›¾å­¦ä¼šæ‘†ç›˜å„¿,æ¯æ¬¡éƒ½çœ‹åˆ°è€å¸ˆé€¢å¹´è¿‡èŠ‚ä¸‹å¨,æœ€åæœ‹å‹åœˆshareä¸€ä¸‹,é«˜ç«¯æ“ä½œ.ä»¥åæœ‰æœºä¼šæˆ‘å½“é¢è¯·æ•™è¯·æ•™.

7æœˆçš„æ—¶å€™å»äº†ä¸€è¶Ÿé½é½å“ˆå°”æ‰é¾™è‡ªç„¶ä¿æŠ¤åŒº,çœ‹ä¸€çœ‹æˆ‘å¥³æœ‹å‹å®¶äº²æˆšçš„åˆ«å¢….

![](/assets/images/20211231FinalSummary/2021F6.webp)

åˆ«å¢…æ˜¯å¥½å‘€,èœå›­å­æˆäº†ç‚¹ç¼€åˆ«å¢…çš„ç‚¹ç›ä¹‹ç¬”.

é‡ç‚¹æ˜¯çœ‹ä»™é¹¤å“ˆ

![](/assets/images/20211231FinalSummary/2021F10.webp)

æˆ‘åˆ†äº«ä¸€ä¸‹å¤§æ¦‚ è·¯çº¿å’Œè·¯é€”æ–¹ä¾¿å…„å¼Ÿä»¬å»è‡ªé©¾

ä»å“ˆå°”æ»¨è¥¿ç«™å‡ºå‘åˆ°æ‰é¾™è‡ªç„¶ä¿æŠ¤åŒºå¦‚æœè‡ªé©¾è¯èµ°é«˜é€Ÿå¤§æ¦‚3ä¸ªå°æ—¶10åˆ†é’Ÿ.é—¨ç¥¨å‡ åå—é’±å¾ˆä¾¿å®œ.

éœ€è¦æ²¿ç€ç¯åŸé«˜é€Ÿç»è¿‡æ¾èŠ±æ±ŸæœåŠ¡åŒºåèµ°ç»¥æ»¡é«˜é€Ÿå¤§åº†æ–¹å‘,å¤§åº†å¥½å¤§,å‡ ä¹2ä¸ªåŠå°æ—¶çš„è·¯ç¨‹åœ¨å¤§åº†çš„ç–†åŸŸèŒƒå›´å†…,é€”å¾„è‚‡ä¸œã€å®‰è¾¾ã€å¤§åº†è®©èƒ¡è·¯åŒºçš„çº¢æ——æ°´åº“ï¼Œå¤§åº†æ—ç”¸å¿... æœ€ååˆ°è¾¾é½é½å“ˆå°”æ‰é¾™æœåŠ¡åŒº.

é«˜é€Ÿè·ç¦»å¤§æ¦‚300å…¬é‡Œå·¦å³.è´¹ç”¨å…¨ç¨‹æ¥å›+600å—é’±è¶³å¤Ÿäº†.

> é‡ç‚¹æé†’ä¸€ä¸‹èšŠå­å¤š,ä»¥åŠå¸¦é˜²æ™’è£…å¤‡å°±è¡Œäº†.

#### å›å®¶ä¸€å¹´çš„æ„Ÿå—

æˆ‘æƒ³æˆ‘æœ‰å¿…è¦åœ¨è¿™è·Ÿå„ä½èŠèŠå›å®¶è¿™ä¸€å¹´æœ‰ä»€ä¹ˆæ”¶è·æˆ–è€…æ„Ÿå—.

* æ„Ÿå—äº†å®¶ä¹¡çš„é£åœŸäººæƒ…
* å¾ˆå¤šäººéƒ½ç”Ÿæ´»åœ¨è§£å†³æ¸©é¥±çš„æ°´å¹³çº¿ä¹‹é—´
* å®¶é‡Œè½¦ç‰Œä¸é™å·å¯ä»¥è‡ªç”±çš„å¼€è½¦äº†
* ä¸ç”¨äº¤æˆ¿ç§Ÿäº†
* åœ¨è‡ªå·±çš„æˆ¿å­é‡Œä¹°ä¸œè¥¿å†ä¹Ÿä¸ç”¨æ‹…å¿ƒæ¬å®¶è¦ä¸è¦è€ƒè™‘æ¬èµ°äº†æ–¹ä¸æ–¹ä¾¿äº†
* å·¥ä½œç¯å¢ƒå·®ã€åŒ…å®¹æ€§è¾ƒå·®.
* å®¶ä¹¡çš„æ¶ˆè´¹ä¸æ¯”åŒ—äº¬ä½å¤šå°‘,ä½†æ˜¯æ”¶å…¥å¯æ˜¯å·®å¤ªå¤šäº†
* åŒ»ç–—æ°´å¹³ä¸é«˜,è·ŸåŒ—äº¬å®Œå…¨ä¸ä¸€æ ·
* å®¶é‡Œæ²¡æœ‰æœ«ä½æ·˜æ±°åˆ¶,æ•™å¸ˆã€å…¬åŠ¡å‘˜ã€ä½“åˆ¶å†…å·¥ä½œçš„äººæ›´å—æ¬¢è¿å’Œè¢«å¤§ä¼—æ‰€æ¥å—.
* å®¶é‡Œæ›´çœ‹é‡å­¦å†ä¸çœ‹é‡èƒ½åŠ›,åŒä¸€æµé™¢æ ¡æ¯•ä¸šçš„ç¡•å£«ä»¥ä¸Šæœ‰å¯èƒ½æœ‰å·¥ä½œæœºä¼š.å…¶å®ƒçš„å…è°ˆ.

å®¶ä¹¡åŸå¸‚å±äº3çº¿,æˆ¿åœ°äº§æ˜¯æ”¯æŸ±æ€§äº§ä¸š,æ›¾ä»Šçš„å“ˆé£ç­‰è€ç‰Œé‡å·¥ä¸šäº§ä¸šå¤„äºè¡°è½æœŸ,æ”¿åºœæ”¿ç­–è´¯å½»è½å®åˆ°æ‰§è¡Œç­‰äºç”»å¤§é¥¼.ç»™æˆ‘æœ€æ·±åˆ»çš„æ„Ÿå—æ˜¯åœ¨è€å®¶çš„å¹´è½»äººæˆ–è€…ä¸­å¹´äººå¤§éƒ¨åˆ†éƒ½å¤„äº`å¯¹æœªæ¥å¤±å»å¸Œæœ›`å‹‰å¼ºè¿‡æ´»çš„çŠ¶æ€. åªæœ‰å°‘éƒ¨åˆ†åšç”Ÿæ„ä¹°å–çš„äººèƒ½å‘å®¶è‡´å¯Œå¹¶å®‰ç¨³çš„ç”Ÿæ´»åœ¨è¿™åº§åŸå¸‚é‡Œ. å…¶ä½™çš„äººéƒ½æ˜¯è¿‡ç€è¿‡ä¸€å¤©ç®—ä¸€å¤©çš„èººå¹³çŠ¶æ€. è‡³äºèŒä¸šè§„åˆ’éƒ½æ˜¯ç©ºè°ˆ.æ›´ä¸ç”¨æå¦‚ä½•å»ºè®¾å’Œè°ç¤¾ä¼šå‘å±•ç»æµå’Œé«˜ç§‘æŠ€äº§ä¸šäº†. äººå£æ¯å¹´æµå‡ºç‡ 33%+. è¿™æ˜¯å›å®¶åçš„ä¸€äº›å¾®è§‚æ„Ÿå—.

ç”Ÿæ´»è¿˜æ˜¯éœ€è¦ç»§ç»­çš„,æ€è€ƒäº†å¾ˆä¹…,å¹¶è®¤æ¸…äº†ç°å®å’Œæ‰€å¤„çš„ç¯å¢ƒ,è¿˜æ˜¯è§‰å¾—ä¸€çº¿åŸå¸‚é€‚åˆè‡ªå·±çš„èŒä¸šå‘å±•.

å½“ç„¶çœ‹åˆ°è¿™é‡Œä½ å¯ä»¥å˜²ç¬‘æˆ‘çš„æ„šè ¢,æ²¡å…³ç³»,æˆ‘ä¹Ÿä¸€æ ·å˜²ç¬‘è‡ªå·±æ— çŸ¥çš„é²è½å’Œå¯¹åŸå¸‚å‘å±•çš„è¯¯åˆ¤.ä½†æˆ‘è®¤ä¸ºå¦‚ä¸Šçš„æ‰€æœ‰æ„Ÿå—æ˜¯ååœ¨åŠå…¬å®¤é‡Œæ— æ³•çœŸåˆ‡ä½“ä¼šå’Œäº²èº«å®è·µçš„.è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆåäº‹,æ˜¯æ•™è‚²è‡ªå·±æˆé•¿å’Œå¢é•¿è§è¯†çš„åŠ¡å®ä½“ç°.å¦‚æœç­‰è‡ªå·±ä¸­å¹´åå†æ¥æ„Ÿå—è¿™äº›æˆ‘ç›¸ä¿¡æ¯”æˆ‘çš„é­é‡æ„Ÿå—æ›´ç—›è‹¦å§!ä½†æˆ‘å¸Œæœ›å„ä½ä¸è¦é‡è¹ˆæˆ‘çš„è¦†è¾™.åšå‡ºæ˜æ™ºçš„æŠ‰æ‹©å’Œå¥½çš„èŒä¸šå‘å±•æ‰æ˜¯äººç”Ÿèµ¢å®¶.

å³ä¾¿ç”Ÿæ´»å¦‚æ­¤ä¸é¡ºåˆ©,ä½†èº«å¿ƒå¾—åˆ°äº†å‰æ‰€æœªæœ‰çš„èˆ’ç•…å’Œæ”¹å–„.æˆ‘å˜å¾—è¶Šæ¥è¶Šæ„¿æ„å’Œæ‰¿å—å„ç§ç—›è‹¦çš„ç»å†,å¿ƒæ€å˜å¾—è‰¯å¥½.è¿™æ˜¯åœ¨åŒ—äº¬7å¹´å¤šçš„å·¥ä½œç»å†ä¸­å‰æ‰€æœªæœ‰çš„. æ¶ˆè´¹è§‚å¿µã€ç”Ÿæ´»æ€åº¦ã€å¿ƒç†é¢„æœŸã€æ¥å—èƒ½åŠ›ã€æ‰¿è®¤å¹³åº¸çš„è‡ªå·±ç­‰ç­‰.

ä¸ºäº†æ„Ÿå—ä¸€ä¸‹å¤§å®¶ç»å¸¸è®¨è®ºçš„å…¬è€ƒæˆ‘åšäº†ä¸€æ¬¡å°è¯•ã€ç»“æœå¯æƒ³è€ŒçŸ¥è¿™ä¸œè¥¿éœ€è¦ç»å¸¸çš„é”»ç‚¼ã€ä¸æ˜¯ä¸€æœä¸€å¤•å°±èƒ½è¡Œçš„.ä½†æ˜¯æ”¶è·å¾ˆå¤š, ä¾‹å¦‚:ç”³è®ºä¸­é’ˆå¯¹ç¤¾ä¼šç°è±¡çš„æè¿°ä»¥åŠç»™å‡ºç›¸åº”åˆç†å¯è¢«å…¬ä¼—æ‰€æ¥å—ä¸”åŠ¡å®å¯è¡Œçš„æ–¹æ¡ˆ. è™½ç„¶æˆ‘ä»¬æœ‰æ—¶å€™ç«™åœ¨ä¸€ä¸ªè€ç™¾å§“çš„è§’åº¦è€ƒè™‘é—®é¢˜å¯ä»¥è‚†æ— å¿Œæƒ®,ä½†æ˜¯ç«™åœ¨ä¸€ä¸ªå…¬åŠ¡äººå‘˜çš„è§’åº¦è€ƒè™‘é—®é¢˜éœ€è¦éµå®ˆ`æ°¸è¿œä¸ºäººæ°‘æœåŠ¡`ä¸ºç¬¬ä¸€åŸåˆ™,é˜è¿°å’Œå†™å‡ºå¯è¡Œæ€§æªæ–½å’Œæœ€ä¼˜è§£.å¹¶ä¸”è¦æ±‚å…¬åŠ¡äººå‘˜çš„æ–‡å­—ä¹¦å†™èƒ½åŠ›,é€»è¾‘ç»„ç»‡èƒ½åŠ›éƒ½æ˜¯å¾ˆå¤§çš„æŒ‘æˆ˜.å‡ ä¹å¯ä»¥è¯´`åƒé‡ŒæŒ‘ä¸€`.æˆ‘ä»¬ç”Ÿæ´»ä¸­æ‰€çœ‹åˆ°çš„å®˜æ–¹é€šçŸ¥,æˆ–è€…å…¶å®ƒç±»ä¼¼çš„æ–‡æœ¬æ¶ˆæ¯.è¿™äº›éƒ½æ˜¯éœ€è¦ç»è¿‡ä¸“ä¸šçš„è®­ç»ƒå’Œè¯­è¨€ç»„ç»‡èƒ½åŠ›è®­ç»ƒæ–Ÿé…ŒNé.review Néå ç¬¬ä¸€æ—¶é—´å‘å‡ºçš„.æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ°çš„æ—¶å€™æ‰æŒ‘ä¸å‡ºä»»ä½•é—®é¢˜.é‚£å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡è°æ¥æ’°å†™è¿™äº›å†…å®¹å‘¢ï¼æ˜¯å…¬åŠ¡ç§‘å‘˜ç±»çš„äººå‘˜, å¤§å®¶è™½ç„¶è§‰å¾—æ˜¯åŠ¨åŠ¨å˜´å°±æå®šçš„äº‹,å…¶å®ä¸çŸ¥é“çš„æ˜¯ä¸ºäº†åŠ¨åŠ¨å˜´ä»˜å‡ºäº†å¤šå°‘åŠªåŠ›.å°±è®­ç»ƒå†™ä¸€ç¯‡å£°æ˜ç¨¿ä»¶ æˆ‘åå¤ç»ƒä¹ 10+æ¬¡,ä¹Ÿä¾ç„¶ä¸èƒ½å®Œç¾å†™å¥½!(å¯èƒ½æ˜¯æˆ‘ä¸æ“…é•¿å¹²æ–‡èŒç±»çš„å·¥ä½œ). è¯´çœŸçš„è‡ªä»é«˜ä¸­é«˜è€ƒæ¯•ä¸šåˆ°æˆ‘è€ƒè¯•ç­”ç”³è®ºä½œæ–‡,æˆ‘å·²ç»åå‡ å¹´æ²¡å†å†™è¿‡1200å­—ä»¥ä¸Šçš„ä½œæ–‡äº†.è‡³äºç« æ³•ã€æ–‡å­—åŠŸåº•ã€å†™ä½œæ‰‹æ³•æ—©å·²ç»éšç€äº’è”ç½‘çš„å‘å±•äº¤ç»™ç™¾åº¦å»å®Œæˆäº†. ä¸è¿‡è€ƒåæˆ‘å‘ç°æˆ‘å¯¹è‡ªå·±çš„ç”³è®ºæ€»ä½“æ¥è¯´è¿˜æ˜¯å¾ˆæ»¡æ„çš„è™½ç„¶3ç±»æ–‡,ä½†æ˜¯å¾—äº†57åˆ†å·²ç»è¶…å‡ºäº†æˆ‘å¯¹è‡ªå·±çš„é¢„æœŸäº†.

![](/assets/images/20211231FinalSummary/2021F7.webp)


## å…³äºå·¥ä½œ

#### ä¸“åˆ©

åœ¨å¿«æ‰‹å·¥ä½œçš„æ—¶å€™ç”³è¯·çš„ä¸“åˆ©ç»ˆäºåœ¨2021å¹´å…¬ç¤ºäº†

![](/assets/images/20211231FinalSummary/2021F8.webp)

#### å›åŒ—äº¬ç»§ç»­æ‰“æ‹¼

ä¸å…¶è¯´å›åŒ—äº¬æ‰“æ‹¼ä¸å¦‚è¯´æ˜¯é€ƒç¦»åŒ—æ¼‚å¤±è´¥, ä¸ç®¡æ€æ ·æˆ‘è¿˜æ˜¯èƒ½æ¥å—å¤§å®¶å¯¹æˆ‘çš„å„ç§è¯„è®ºçš„.è¿™è¯´æ˜æˆ‘çš„èŒä¸šé€‚åˆä¸€çº¿åŸå¸‚.è¿™æ˜¯å¤§éƒ¨åˆ†äººæ— æ³•é€ƒç¦»çš„.è¿˜æ˜¯ç†Ÿæ‚‰çš„åœ°é“,åŒ†å¿™çš„è·¯äºº.

ç”±äºäº’è”ç½‘çš„æµªæ½®ä¸‹ "åŒå‡"æ”¿ç­–å½±å“,å›½å®¶åå„æ–­çš„æ‰“å‹,èµ„æœ¬å¸‚åœºé¢„å†·,å¢é‡ç”¨æˆ·å¸‚åœºè½¬ä¸ºå­˜é‡å¸‚åœº.å¯¼è‡´ITè¡Œä¸šç°åœ¨æ­¥å±¥è‰°éš¾.è¿™æ˜¯å¥½äº‹ä¹Ÿæ˜¯åäº‹.å¥½äº‹æ˜¯è¿™ä¸ªè¡Œä¸šå°†ä¼šä¸æ–­è¢«æ‰“ç£¨æˆç§‘å­¦çš„å¯æŒç»­å‘å±•çš„è¡Œä¸šå¸¦åŠ¨ç»æµå‘å±•.åäº‹æ˜¯æ‰¾å·¥ä½œçš„éš¾åº¦å’Œæ ‡å‡†å˜å¾—è¶Šæ¥è¶Šå›°éš¾å’Œæ›´é«˜.

å¯¹äºä¸€ä¸ªiOSæ¥è¯´å…¶å®å·¥ä½œä¸­ç”¨åˆ°çš„ç®—æ³•æ¯”è¾ƒå°‘.ä½†æ˜¯è¿™ä¸ªè¡Œä¸šä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹å˜å¾—é¢è¯•å¿…é¡»é—®ç®—æ³•.

#### è¯´è¯´æˆ‘å¯¹ç®—æ³•çš„ç†è§£

* æ‡‚æ¯”ä¸æ‡‚å¥½
* ä»è€…è§ä»æ™ºè€…è§æ™º
* é¢è¯•ä¸ºå•¥é—®ç®—æ³•

##### ä¸ºä»€ä¹ˆæ‡‚æ¯”ä¸æ‡‚å¥½ï¼Ÿ

å› ä¸ºå³ä¾¿ä½ ä¹‹å‰å¤§å­¦å­¦è¿‡ã€Šç®—æ³•ä¸æ•°æ®ç»“æ„ã€‹ï¼Œä½†æ˜¯å¼€å‘ä¸­ä¹Ÿæˆ–å¤šæˆ–å°‘ä½¿ç”¨ä¸€äº›ç®—æ³•,æˆ‘è®¤ä¸ºæœ€éš¾å¾—ä¸æ˜¯ç®—æ³•,æ˜¯æ‡‚äº†ç®—æ³•ä¹‹åè¦å­¦ä»¥è‡´ç”¨,æŠŠå®ƒè½å®åˆ°å®é™…çš„å·¥ä½œä¸­æˆ–è€…å·¥ç¨‹ä¸­è§£å†³å®é™…é—®é¢˜,è¿™æ‰æ˜¯æˆ‘ä»¬å­¦å¥½å®ƒçš„ç›®çš„. å¦‚æœéƒ½ä¸äº†è§£å®ƒï¼Œé‚£å›¢é˜Ÿçš„åŒäº‹ä¸èƒ½å’Œä½ ä¿æŒåœ¨åŒä¸€æ®µä½ä¸Š,äººå®¶è¯´å•¥ä½ å¬ä¸æ‡‚ä½ è¯´è¿™æ ·å¥½å—ï¼Ÿ

##### ä»è€…è§ä»æ™ºè€…è§æ™º

ä¸¾ä¸ªä¾‹å­: å¦‚æœå¼€å‘ä¸­æˆ‘ä»¬è¦åšä¸ªç±»ä¼¼æ ¹æ®ä¸ªäººå–œå¥½æ¨èå†…å®¹çš„æ¨èç³»ç»Ÿ,å¦‚æœä½ ä¸æ‡‚ä¸€äº›æ•°å­¦ä¸Šçš„æ¦‚å¿µæˆ–è€…ç®—æ³•,ä½ æ ¹æœ¬ä¸çŸ¥é“ æœ‰ä¸€ä¸ªå«[æ¬§å‡ é‡Œå¾—è·ç¦»](https://zh.wikipedia.org/wiki/%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E8%B7%9D%E7%A6%BB)çš„æ¦‚å¿µèƒ½å¸®æˆ‘ä»¬å®ç°è¿™å¥—ç³»ç»Ÿ. å®ƒçš„å…¬å¼å¯ä»¥å¸®æˆ‘ä»¬è§£å†³ä¸€äº›å†…å®¹çš„è·ç¦»æ˜¯ä¸æ˜¯æˆ‘ä»¬å–œæ¬¢çš„å†…å®¹,è™½ç„¶æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€å †å…¬å¼æˆ–è€…æ˜¯ä¸€å †æä¸æ‡‚çš„ç®—æ³•è¡¨è¾¾å¼.æ€»ä¹‹è¿™æ˜¯ç®—æ³•çš„èŒƒç•´èƒ½å¸®æˆ‘ä»¬è§£å†³å®é™…é—®é¢˜çš„ç§‘å­¦ä¾æ®.

**å› ä¸ºæˆ‘ä»¬å¯¹ä¸€äº›æœªçŸ¥çš„çŸ¥è¯†ç¼ºä¹æ¢ç´¢çš„ç²¾ç¥å¯¼è‡´æˆ‘ä»¬æ€»ä¸ºè‡ªå·±ä¸å­¦ä¹ é«˜ç²¾å°–æŠ€æœ¯æ‰¾å€Ÿå£**.

æ‰€ä»¥æˆ‘è¯´å¯¹äºå­¦ä¹ ç®—æ³•ä¸åŒçš„äººæœ‰ä¸åŒçš„ç†è§£

##### é¢è¯•ä¸ºå•¥é—®ç®—æ³•ï¼Ÿ

é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½ä¸€ç‚¹æ˜¯ä¸ºä»€ä¹ˆæœ‰çš„å…¬å¸è¦é¢è¯•è¿‡ç¨‹ä¸­å¼•å…¥ç®—æ³•,`æ˜¯ä¸ºäº†é‡å¡‘è¿™ä¸ªæœ‰æŠ€æœ¯å«é‡çš„èŒä¸š`,`æ˜¯ä¸ºäº†æ•™è‚²ä»ä¸šè€…å­¦ä¹ ç®—æ³•æ‰èƒ½å˜å¾—æ›´æœ‰ä»·å€¼`,å› ä¸ºæˆ‘ä»¬çš„ä»ä¸šé—¨æ§›ä½ç«¯çš„è¯è–ªèµ„ä¹Ÿä¸ä¼šé«˜,é‚£ä¹ˆé«˜çš„è–ªèµ„ä½“ç³»ä¸‹å°±è¦æ±‚ä»ä¸šè€…æœ‰æ›´é«˜æ°´å¹³çš„å‘æŒ¥.ä¸ºäº†balanceæŠ€æœ¯å’ŒèŒä¸šæ°´å¹³çš„çŸ›ç›¾,åŠ å…¥ç®—æ³•è€ƒæ ¸æ˜¯ä¸€ä¸ªç§‘å­¦çš„ä¸¾æª.

ä¸‹é¢æˆ‘å†è¯´ä¸€ä¸‹é¢è¯•iOSå¼€å‘è€…è¿‡ç¨‹ä¸­é—®ç®—æ³•,è¿™ä¸ªäº‹æƒ…æ˜¯ä¸ªè¶‹åŠ¿,å¦‚æœé—®æ³•æ˜¯ä»é€šè¿‡ç®—æ³•è§£å†³å·¥ç¨‹ä¸­é‡åˆ°çš„å“ªäº›å®é™…é—®é¢˜,ä»åŠ¡å®çš„è§’åº¦è€ƒè™‘æˆ‘æ˜¯èµåŒçš„. å¦‚æœæ˜¯ä»åªä¸ºäº†æ£€éªŒé¢è¯•è€…æœ‰æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›è€ƒä¸€äº›ä¸åˆ‡å®é™…çš„ç®—æ³•çš„è§’åº¦è€ƒè™‘æˆ‘æ˜¯åå¯¹å¹¶æåŠ›æŠ¨å‡»çš„. è¿™ç§é¢è¯•ç­‰äºæµªè´¹æ—¶é—´.å¯¹äºä¸€ä¸ªiOSå¼€å‘è€…å®ƒæ¯å¤©éƒ½ä¸ç”¨ä½ é—®çš„å†…å®¹,ç›¸å½“äºä½ ä¿©è¯´è¯éƒ½ä¸åœ¨ä¸€ä¸ªé¢‘é“ä¸Š,èƒŒç¦»äº† ç®—æ³•çš„åˆè¡·.è¿™ç§é—®æ³•æˆ‘æ˜¯ä¸æ¨èçš„.

æ€»ä¹‹å­¦ä¹ ç®—æ³•æ˜¯ç¨‹åºå‘˜çš„å¿…å¤‡æŠ€èƒ½,ä¹¦åˆ°ç”¨æ—¶æ–¹æ¨å°‘,å­¦ä»¥è‡´ç”¨æ˜¯å­¦ä¹ å®ƒçš„æœ€é«˜å¢ƒç•Œ.

ç»§ç»­å›æ¥è¯´å·¥ä½œå“ˆ.

è¿™ä¸€å¹´å…¶å®æ€»çš„æ¥çœ‹åœ¨å·¥ä½œå†…å®¹å’Œæ–¹å‘ä¸Šè‡ªå·±éœ€è¦æœ‰æ‰€æ”¹å˜å’Œæå‡,æœ€é‡è¦çš„æ˜¯è¡Œèƒœäºè¨€,ä¸èƒ½æ¯å¹´éƒ½å¢¨è¿¹XXè¦æå‡ç»“æœç¬¬äºŒå¹´å¹´ç»ˆæ€»ç»“è¿˜æ˜¯å¾…æå‡,è¦åŠ¡å®å»åš,å®é™…è¡ŒåŠ¨èµ·æ¥æ‰è¡Œ.è¦`æ±‚çœŸåŠ¡å®,å®äº‹æ±‚æ˜¯`.ç¦æ­¢æ‘¸é±¼

![](/assets/images/20211231FinalSummary/BanTouchFish.webp)



## å…³äºå­¦ä¹ 

ä»Šå¹´å­¦äº†å‡ é—¨ä»˜è´¹è¯¾ç¨‹ä¹Ÿå¼ºçƒˆæ¨èç»™å„ä½,å¸Œæœ›åœ¨åç»­çš„æ—¶å…‰ä¸­èƒ½åšæŒæŒç»­å­¦ä¹ ,å­¦ä¹ ç§‘å­¦æŠ€æœ¯.

* iOSå¼€å‘é«˜æ‰‹è¯¾ å­¦ä¹ äº†3é
* æ•°æ®ç»“æ„ä¸ç®—æ³•ä¹‹ç¾
* Swiftæ ¸å¿ƒæŠ€æœ¯ä¸å®è·µ
* é¸¿è’™OS

![](/assets/images/20211231FinalSummary/2021F11iOS.webp)

è¿™é—¨è¯¾ç¨‹å‡ ä¹å…¨æ˜¯å¹²è´§,æ¯ä¸€ä¸ªiOSéƒ½åº”è¯¥ä½œä¸ºç§‘æ™®è¯¾ç¨‹å­¦ä¹ .

![](/assets/images/20211231FinalSummary/2021F11Algorithm.webp)

è¿™ä¸ªæ•°æ®ç»“æ„ä¸ç®—æ³•æˆ‘ä¹Ÿå¼ºçƒˆå»ºè®®å„ä½è®¤çœŸå­¦ä¹ ,æ•°æ®ç»“æ„ä»`è¡¨`åˆ°`æ ‘`å†åˆ°`å›¾`,æœ€åç®—æ³•ç”±æµ…å…¥æ·±.æƒ³æƒ³ç®—æ³•å¯¼è®ºä½ ä¹°äº†åç¿»çœ‹äº†å‡ é¡µ.

![](/assets/images/20211231FinalSummary/2021F11Swift.webp)

swiftè¿™æ˜¯æˆ‘å­¦ä¹ ç¬¬3éäº†,swift5.xä¹‹åå˜åŠ¨çš„ä¸œè¥¿å¤ªå¤šäº†,ä¸å¾—ä¸é‡æ–°å­¦ä¹ ä¸€é,ç›®å‰å­¦ä¹ è¿›åº¦60%ä»¥ä¸Šäº†.

![](/assets/images/20211231FinalSummary/2021F11HarmonyOS.webp)

è¿™é—¨è¯¾ç¨‹ä½œä¸ºå›½äº§æ“ä½œç³»ç»Ÿçš„æ ‡é…,è‡ªä»åä¸ºè¢«ç¾å›½æ‰“å‹å,å›½äººç—›å®šæ€ç—›,ä»åŸºç¡€ç§‘å­¦ç ”å‘æèµ·.ä¸“æ”»å¡è„–å­çš„æŠ€æœ¯,ä¸ºäº†å®Œæˆæˆ‘2019å¹´æè¿°çš„å¹´ç»ˆæ€»ç»“,2022å¹´è¿™é—¨è¯¾ç¨‹æˆ‘å¿…é¡»è®¤çœŸå­¦å®Œ.

#### å­¦ä¹ å°ç»“

å·²ç»è¿ç»­4å¹´å†™å¹´ç»ˆæ€»ç»“äº†,æˆ‘ä¹Ÿåœ¨æŒç»­ä¸æ–­çš„å®Œå–„è‡ªå·±çŸ¥è¯†çš„ç›²åŒºèŒƒå›´,æˆ‘åº”è¯¥æ•é”çš„æ¡ä½è¿™ä¸ªç¤¾ä¼šåœ¨å‘å±•è¿‡ç¨‹ä¸­çš„è¶‹åŠ¿,è¿™æ ·æˆ‘å°±å¯ä»¥æŠ¢å…ˆä¸€æ­¥å­¦ä¸€äº›åˆ«äººè¿˜ä¸æŒæ¡çš„æŠ€èƒ½,é‚£ä¹ˆåœ¨æœªæ¥å°±ä¸æ„æœ‰ç«‹è¶³ä¹‹åœ°.


## å…³äºæ¸¸æˆ

ä¹‹å‰åœ¨åŒ—äº¬çš„æ—¶å€™ä¹°äº†ä¸€ä¸ªNEOGEO miniçš„å°å‹æ¸¸æˆæœº,åœ¨åŒ—äº¬åŒ—æ¼‚ä¹…äº†é˜²æ­¢æŠ‘éƒä¹°ä¸€äº›å°ç©æ„æ‰“å‘ä¸€äº›å¿ƒæƒ….è‡ªä»å›å®¶åè¢«äºŒå§å®¶å¤–ç”¥å¥³`æ©æ…§`æŠ¢å»äº†,å…¨å½“é€ä½ äº†å”‰.

åˆä¸­æ—¶æˆ‘ç¬¬ä¸€æ¬¡æ¥è§¦åˆ°PS one(PlayStation ONE),é‚£æ—¶å€™æˆ‘å°±è§‰å¾—ç´¢å°¼åšæ¸¸æˆè¡Œä¸šå¾ˆNB,å¯æ˜¯å³ä¾¿æ˜¯å·¥ä½œäº†å¥½å¤šå¹´ä¾ç„¶èˆä¸å¾—ä¹°ä¸ªPSç©.

é”™è¿‡äº†

* PS2
* PS3
* PS4
* PS4 slim
* PS4 Pro

PS5æˆ‘ä¸èƒ½å†é”™è¿‡äº†,æœ‰èƒ½åŠ›å°±ä¸‹æ‰‹å§,åˆšå¥½å…¬ç§¯é‡‘æŒ‰æœˆæ”¯å–åˆ°è´¦åŠ ä¸ŠåŒ11,ä¹°äº†äººç”Ÿä¸­ç¬¬ä¸€ä¸ªåƒæ ·çš„æ¸¸æˆæœº.

![](/assets/images/20211231FinalSummary/2021F12PS5.webp)

å›½è¡Œç‰ˆæœ¬,æ¸¯ç‰ˆè´¦å·å¤‡ä»½å¯ç©æ¸¯æœæ¸¸æˆ

ä¹°å®Œåæˆ‘åªèƒ½è¯´è¢«æ•™è‚²äº†,æ¸¸æˆå¥½è´µå‘€ï¼è´µä¸æ˜¯é‡ç‚¹,é‡ç‚¹ä¸€ä¸ªæ¸¸æˆ100G+,å¯æ€œçš„åŸæœºæ¸¸æˆæœ€å¤šèƒ½ä¸‹2~3ä¸ª.æƒ³æ‰©å®¹å¯æ˜¯ä¸€ä¸ªPCIe4.0çš„SSD m.2æ ¼å¼çš„å›ºæ€ç¡¬ç›˜ 2000+RMB.

å¦‚æœä¹°é½äº†æ‰€æœ‰è£…å¤‡è¿™ç©æ„1w+,æœæ–­æ”¾å¼ƒ.å®åŠ›å·²ç»ä¸å…è®¸æˆ‘ç©PS5äº†.

è‡³äºæ¸¸æˆè¿˜æ˜¯å¾ˆå¥½ç©çš„

* ç¥ç§˜æµ·åŸŸ4
* æ¶é­”ä¹‹é­‚é‡åˆ¶ç‰ˆ
* åŸæœºå¸¦çš„æœºå™¨äººéå¸¸å¥½ç©
* åŒäººæˆè¡Œ

è¿™äº›éƒ½æ˜¯æˆ‘è§‰å¾—éå¸¸ç»å…¸çš„æ¸¸æˆ

## å…³äºä¿®è½¦

ä»å°é¢å¤§å®¶ä¹Ÿèƒ½çœ‹åˆ°æˆ‘çš„ç ´è½¦.

è¯´æ¥è¯é•¿,æˆ‘åªèƒ½å¥‰åŠå„ä½ä¹°è½¦ä¸ä¹°äºŒæ‰‹å°±è¡Œäº†.æˆ‘åˆ—äº†ä¸€ä¸‹è¿™è½¦ä»æˆ‘ä¹°åˆ°æ‰‹æ¢çš„é›¶ä»¶æ¸…å•

* åˆ¹è½¦ç›˜+åˆ¹è½¦ç‰‡ å‰é¢ä¸€å¥—
* é©¬ç‰ŒUC6 (215/55 R16)è½®èƒ4åª
* å‘åŠ¨æœºèŠ‚æ°”é—¨
* å‘ç”µæœºçš®å¸¦
* æ²¹æ°”åˆ†ç¦»å™¨
* ç¢³ç½ç”µç£é˜€
* æ­£æ—¶é“¾æ¡+é“¾æ¿ä¸€å¥—
* æ¶¡è½®å¢å‹ç®¡
* æ±½è½¦è“„ç”µç“¶
* æ°™æ°”å¤§ç¯+æµ·æ‹‰5é€é•œ+æµ·æ‹‰4å®‰å®šå™¨ä¸€å¥—
* 4ä¸ªç«èŠ±å¡æˆ‘æ¢2æ¬¡äº†
* ç©ºè°ƒæ»¤+ç©ºæ°”æ»¤+æœºæ²¹æ»¤
* Power Flex åä¸‹æ”¯è‡‚èšæ°¨é…¯å¼ºåŒ–è¡¬å¥— 
* åå¤‡ç®±è¡¬æ¿
* å¤©çª—å¼€å…³
* è‡ªåŠ¨æŒ¡æ¡£æŠŠå¼€å…³ä¸€å¥—
* MIB 682E è½¦æœº
* åç¿»è¡¨å€’è½¦ ç¿»æ ‡ä¸€å¥—
* æ±½è½¦è„šå«ä¸€å¥—
* å‰æ’å·¦å³è½¦çª—é“¶è‰²é•€é“¬å‹æ¡
* å‰æ”¯è‡‚é“åº§
* å‘åŠ¨æœºåº•éƒ¨æ ‘è„‚æŠ¤æ¿
* å˜é€Ÿç®±è¿æ¥å‘åŠ¨æœº æœºçˆªå«
* è½®èƒæŒ¡æ³¥æ¿ x 4
* è¿›æ°”é“æ¸…ç†ç§¯ç¢³
* ä¸»é©¾ä¾§åè§†é•œæ€»æˆå…¨å¥—
* å‰é£æŒ¡ç»ç’ƒ
* åå¤‡ç®±æ°”åŠ¨æ”¯æ’‘æ† x2
* å˜é€Ÿç®±æ²¹
* åˆ¹è½¦æ²¹
* é˜²å†»æ¶²
* å…¨è½¦å‡éœ‡å™¨ x 4
* å‰å‡éœ‡å¼¹ç°§ x 2

å¥½äº†æˆ‘åˆ—åˆ°è¿™é‡Œ,æˆ‘åŸºæœ¬å¯ä»¥ä¿®ç†EA888å‘åŠ¨æœºäº†.ä»ä¸€ä¸ªç å†œæˆä¸ºä¸ºåŠä¸ªå¤§ä¼—ä¿®ç†å·¥.

> ä¸‹ä¸€æ­¥æˆ‘æ‰“ç®—æ•´ä¸ªç ´ç¬”è®°æœ¬è£…ä¸Šwin elsaè½¯ä»¶,ä¸“ä¸šæ£€ä¿®å¤§ä¼—ã€å¥¥è¿ªã€ä¿æ—¶æ·ç­‰å¤§ä¼—ç³»åˆ—ä¸“ä¿®.

æˆ‘å¸¦å¤§å®¶è®¤è¯†ä¸‹è¿™äº›æœºæ¢°éƒ¨ä»¶,ä»¥ä¸‹å…¨éƒ¨æ˜¯æˆ‘çš„è½¦æ¢è¿‡çš„é…ä»¶.

![](/assets/images/20211231FinalSummary/2021F13BrakeDisc.webp)

å‰é©±åˆ¹è½¦ç›˜ x2

![](/assets/images/20211231FinalSummary/2021F13BrakeBlock.webp)

åˆ¹è½¦ç‰‡ x2

![](/assets/images/20211231FinalSummary/2021F13TireUC6.webp)

é©¬ç‰Œè½®èƒ x4


![](/assets/images/20211231FinalSummary/2021F13ThrottleValve.webp)

å‘åŠ¨æœºèŠ‚æ°”é—¨ 
> å†¬å¤©çš„æ—¶å€™ä»ªè¡¨ç›˜æŠ¥EPCç¯é—ªçƒç‚¹äº®,æ€ é€ŸæŠ–åŠ¨ä¸ç¨³,ç»è¿‡æ£€æµ‹å‘ç°èŠ‚æ°”é—¨ä¿¡å·ä¸å¯ä¿¡,å†¬å¤©èŠ‚æ°”é—¨é‡Œé¢æœ‰å†·ç©ºæ°”å½¢æˆçš„æ°´ç ,å†·çƒ­äº¤æ›¿å®¹æ˜“é€ æˆè¿›æ°”ç®¡é“æœ‰æ°´ç å‡ºç°,å‡‰è½¦çš„æ—¶å€™ä¸œåŒ—æ¸©åº¦ä½å®¹æ˜“ç»“å†°,é€ æˆèŠ‚æ°”é—¨å¼€åˆä¸ç•…,é•¿å¹´ç´¯æœˆé€ æˆèŠ‚æ°”é—¨èŠ‚æ°”é—¨ç”µæœºç–²åŠ³,å…¶å®è¿™ç©æ„æˆ‘éå¸¸æƒ³æŠŠå®ƒæ‹†ä¸‹æ¥è‡ªå·±ç»´ä¿®ä¸€ä¸‹,è¿™ä¸ªä¸œè¥¿1700+rmb.å¾ˆè´µæ¢ä¸€ä¸ªä¸å€¼å¾—.åæ¥è€ƒè™‘è¿™ä¸œè¥¿å…³é”®å¯åˆ«åœ¨è·¯ä¸Šåäº†æ¢ä¸ªæ–°çš„å§!

![](/assets/images/20211231FinalSummary/2021F13DynamoBelt.webp)

å‘ç”µæœºçš®å¸¦,æˆ‘çœ‹ç€è¿™ä¸ªä¸œè¥¿è¦å,å®é™…æ‹†ä¸‹æ¥æ²¡å•¥äº‹ä¹Ÿè®©æˆ‘æ¢æ–°çš„äº†,æ—§çš„ä¾ç„¶æ”¾åœ¨è½¦ä¸Šé˜²æ­¢è·¯ä¸Šå†å‡ºé—®é¢˜çš„æ—¶å€™æœ‰ä¸ªå¤‡ä»¶æ›´æ¢,ä¸œè¥¿æ²¡å¤šå°‘é’±ä½†å´ååˆ†é‡è¦.

![](/assets/images/20211231FinalSummary/2021F13Oil-waterSeparator.webp)

ä¸Šé¢è¿™ä¸ªéƒ¨ä»¶å«æ²¹æ°”åˆ†ç¦»å™¨æˆ–è€…å«æ²¹æ°´åˆ†ç¦»å™¨,å‘åŠ¨æœºä¼šäº§ç”Ÿé«˜æ¸©æ°”ä½“,å› ä¸ºå‘åŠ¨æœºå†…éƒ¨æœ‰æœºæ²¹,æœºæ²¹äº§ç”Ÿçš„è’¸æ±½ä¸­æœ‰æ°´åˆ†å­,ä¸ºäº†èƒ½è®©æœºæ²¹å’Œæ°´åˆ†ç¦»å¼€,è¿™ä¸ªéƒ¨ä»¶å°±æ˜¾å¾—ååˆ†é‡è¦,æˆ‘æ›´æ¢çš„æ—¶å€™å…¶å®æ²¡æœ‰å,åªæ˜¯ä¹‹å‰çš„éƒ¨ä»¶æ¼æ²¹,æ•´çš„å‘åŠ¨æœºå…¨æ˜¯æ²¹æ±¡,æˆ‘ä»¥ä¸ºå‘åŠ¨æœºæ¼æ²¹äº†å‘¢ç»“æœä¸€çœ‹è¿™ç©æ„ä¸Šè¾¹å…¨æ˜¯æ²¹.æ¢äº†æ”¹è¿›å‹çš„,å‡å°‘çƒ§æœºæ²¹çš„å¯èƒ½.


![](/assets/images/20211231FinalSummary/2021F13ValveEGR.webp)

è¿™ä¸ªä¸œè¥¿å«ç¢³ç½ç”µç£é˜€,åœ¨èŠ‚æ°”é—¨é™„è¿‘,ä¸»è¦æ˜¯è´Ÿè´£æŠŠæ±½æ²¹æ²¹ç®±äº§ç”Ÿçš„æŒ¥å‘è’¸æ±½é€å…¥åˆ°ç‡ƒçƒ§å®¤ç‡ƒçƒ§,å¦‚æœè¿™ä¸ªä¸œè¥¿åçš„è¯æœ€æ˜æ˜¾çš„è¡¨ç°å°±æ˜¯å¸¸é€šæ²¹è€—é«˜(å½“ç„¶æ±½æ²¹éƒ½æŒ¥å‘äº†æ‰äº†èƒ½ä¸è´¹æ²¹å—).è¿™ä¸ªéƒ¨ä»¶ä¹Ÿæ²¡å,åªæ˜¯æˆ‘å»4Såº—ä¹Ÿçœ‹ä¸å‡ºæ¥è¿™ä¸ªä¸œè¥¿æœ‰é—®é¢˜,åªæ˜¯æ¢æ–°çš„åæ±½æ²¹èŠ‚çœäº†30%.æ‰€ä»¥æ¢æ–°çš„é›¶éƒ¨ä»¶æ˜¯èµ·ä½œç”¨çš„.

![](/assets/images/20211231FinalSummary/2021F13TimingChain.webp)

æ­£æ—¶é“¾æ¡,æˆ‘çš„æ˜¯EA888 äºŒä»£,è¿™é‡Œåªæ˜¯å¼•ç”¨ä¸€ä¸‹å›¾, è¿™ä¸ªé“¾æ¡8~10wå…¬é‡Œå¿…é¡»æ¢,æˆ‘å¾ˆç§¯æçš„åœ¨84000å…¬é‡Œçš„æ—¶å€™ç›´æ¥æŠŠå®ƒæ¢äº†,å½“æ—¶æ­£æ—¶é“¾æ¡è¢«æ‹‰é•¿äº†å¾ˆå¤šå‡ ä¹åˆ°äº†æ›´æ¢å®ƒçš„é¢„è®¾é˜ˆå€¼èŒƒå›´,é˜²æ­¢æå‰åå°±æ¢äº†. è¿™ä¸ªä¸œè¥¿ç›¸å½“äºå‘åŠ¨æœºæ ¸å¿ƒçš„éƒ¨ä»¶äº†,è¿é“¾æ¿ç­‰ç›¸å…³éƒ¨ä»¶ä¸€èµ·æ¢æ‰2400å—.

![](/assets/images/20211231FinalSummary/2021F13PressureInlet.webp)

å‘åŠ¨æœºæœ€é‡Œé¢æœ‰ä¸ªè¿æ¥æ¶¡è½®å¢å‹çš„ç®¡é“,å› ä¸ºæ²¹æ°”åˆ†ç¦»å™¨æ¼æ²¹å¯¼è‡´è¿™ä¸ªç®¡é‡Œé¢å…¨æ˜¯æ²¹,é¡ºæ‰‹æŠŠå®ƒæ¢æ‰,å…¶å®è¿™ç©æ„æ¢ä¸æ¢æ²¡å•¥å¿…è¦,åªæ˜¯æˆ‘ä¸å¤ªåƒçœ‹åˆ°æˆ‘çš„å‘åŠ¨æœºå…¨æ˜¯è£¸éœ²åœ¨å¤–é¢æ²¹ä¹ä¹çš„æ ·å­.

![](/assets/images/20211231FinalSummary/2021F13LeadAcidBattery.webp)

é£å¸†é“…é…¸è“„ç”µæ± (å¥½é©¬é…å¥½é,å¥½è½¦é…é£å¸†.),è‡ªå†¬å¤©åœ¨è·¯ä¸ŠEPCç¯äº®èµ·æˆ‘æŠŠè½¦åœè·¯è¾¹,æœ€åå‘ç°èŠ‚æ°”é—¨ä¿¡å·ä¸å¯ä¿¡åä¸€èµ·æŠŠæ±½è½¦ç”µç“¶ä¹Ÿæ¢äº†,åŸæ¥çš„ç”µç“¶åº”è¯¥å¥½å¤šå¹´æ²¡æ¢äº†éƒ½é¼“åŒ…äº†,æˆ‘ç›´æ¥æ¢æ–°çš„äº†.

![](/assets/images/20211231FinalSummary/2021F13Lights.webp)

è¿™æ˜¯2020å¹´å‡çº§çš„æ•´å¥—æ°™æ°”å¤§ç¯.

![](/assets/images/20211231FinalSummary/2021F13SparkPlug.webp)

è¿™æ˜¯2.0Tçš„ç«èŠ±å¡,æ˜¯æˆ‘è‡ªå·±ä»æŸçŒ«ä¸Šä¹°çš„,åšä¸–çš„,é¡ºæ‰‹ä¹°äº†ä¸€å¥—æ£˜è½®æ‰³æ‰‹å·¥å…·ç®±,è‡ªå·±æ‰¾ä¸ªåœè½¦åœº è‡ªå·±æ¢çš„. æˆ‘éå¸¸è‡ªè±ªçš„è¯´è¿™ç©æ„å…¶å®è‡ªå·±åŠ¨æ‰‹å°±å¯ä»¥è§£å†³4ä¸ªç«èŠ±å¡æ‰200ä¸åˆ°,åŸæ¥çš„ç«èŠ±å¡2wå…¬é‡Œ4såº—å°±å»ºè®®æ›´æ¢,æˆ‘çš„è½¦2wå…¬é‡Œå è‡ªå·±æ¢çš„æ–°çš„,æ—§çš„æ‹†ä¸‹æ¥åé‡Œé¢æœ‰ç§¯ç¢³,æˆ‘ç”¨æ´å•çµæ³¡äº†1å¤©æŠŠç«èŠ±å¡æ¸…ç†çš„å¹²å¹²å‡€å‡€,åç»­è¿˜èƒ½å¯¹ä»˜ç”¨.


![](/assets/images/20211231FinalSummary/2021F13OilFilter.webp)

æœºæ²¹æ»¤æ¸…å™¨,è¿™ç©æ„ç½‘ä¸Šä¹°æ‰30å¤š(4såº—å–100+),èµ¶ä¸ŠæŸæ´»åŠ¨è‡ªå·±æœ‰è½¦çš„å…„å¼Ÿä»¬å¯ä»¥å¤šä¹°å‡ ä¸ªå›¤ç€,è¿™ä¸ªä¸œè¥¿æ˜¯ä¸ªæ¶ˆè€—å“,å¤§ä¼—è½¦æ¯5000å…¬é‡Œä¿å…»çš„æ—¶å€™å°±æ¢å®ƒ.è¿™ä¸ªæˆ‘ä¹°äº†3ä¸ªåœ¨æ›¼ç‰Œæ——èˆ°åº—ä¹°çš„.

> è¿™é‡Œæˆ‘å¼ºè°ƒä¸€ä»¶äº‹,æœ‰äº›é…ä»¶å¹¶ä¸ä¸€å®šåŸå‚çš„æ¯”å…¶å®ƒå“ç‰Œçš„å¥½,è¿™å¾—åˆ†æ˜¯ä»€ä¹ˆé›¶ä»¶.è¿™ä¸ªæœºæ»¤åªè¦ä½ ä¹°çš„å“ç‰Œæ­£è§„å•†åº—ä¹°çš„åº”è¯¥å·®ä¸äº†,è¿™å°±å’Œä¹°ç¬”è®°æœ¬çš„å†…å­˜æ¡ä½ è¯´ä¹°è”æƒ³çš„å†…å­˜æ¡å¥½è¿˜æ˜¯ä¹°é‡‘å£«é¡¿äº¦æˆ–æ˜¯ä¸‰æ˜Ÿã€é—ªè¿ªã€å¨åˆšçš„å¥½å‘¢ï¼Ÿè‚¯å®šéè”æƒ³çš„å‘€ï¼æ¯•ç«Ÿå®ƒä¸æ˜¯ä¸“ä¸šåšå†…å­˜æ¡çš„.

è¿˜æœ‰ç©ºè°ƒæ»¤èŠ¯å’Œç©ºæ°”æ»¤èŠ¯æˆ‘ä¹Ÿæ˜¯å›¤ç§¯äº†å¥½å‡ ä¸ª.

* ç©ºè°ƒæ»¤èŠ¯æ˜¯åœ¨è½¦å†…è´Ÿè´£è½¦å†…ç©ºè°ƒçš„ç©ºæ°”è¿‡æ»¤ ä¸€èˆ¬`é©¬å‹’`å“ç‰Œæ¯”è¾ƒå‡ºå
* ç©ºæ°”æ»¤èŠ¯æ˜¯åœ¨å‘åŠ¨æœºèˆ±é‡Œé¢è´Ÿè´£å‘åŠ¨æœºè¿›æ°”ç©ºæ°”è¿‡æ»¤

> ä¸æ‡‚è½¦çš„å°ä¼™ä¼´çœ‹å¥½äº†åˆ«ææ··,è¿™ä¿©ä¸œè¥¿ä¸ä¸€æ ·
> ä»¥ä¸Šä¿—ç§°3æ»¤èŠ¯éƒ½å¯ä»¥è‡ªå·±æ›´æ¢,æœºæ²¹æ»¤æ¸…å™¨å¾—æœ‰ä¸“é—¨çš„å·¥å…·å“ˆ.

![](/assets/images/20211231FinalSummary/2021F13PowerFlex.webp)

è¿™ä¸ªä¸œè¥¿å«èšæ°¨é…¯å¼ºåŒ–è¡¬å¥—,æˆ‘çš„è½¦å…¨è½¦å¦‚æœæ¢ä¸‹æ¥å¾—7000+.ä¸ºäº†å°è¯•è¿™ä¸œè¥¿åˆ°åº•è¡Œä¸è¡Œ2020å¹´å¤§å¹´åˆä¸€èµ¶ä¸ŠåŒå­¦çš„å•ä½(ä¸€æ±½å¤§ä¼—4såº—)ä¼‘ç­äººå°‘,æˆ‘è‡ªå·±æ‹¿ç€è¿™ä¸¤ä¸ªè¡¬å¥—å»4såº—è‡ªå·±æ¢çš„.
å¤§ä¼—ç°åœ¨çš„è½¦åº•ç›˜éƒ½æ˜¯é€šç”¨çš„é…ä»¶,å‡ ä¹æ‰€æœ‰çš„é›¶ä»¶å¤§éƒ¨åˆ†éƒ½å¯ä»¥é€šç”¨,ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ç©æ„åº•ç›˜å¯å¯¹åº”çš„é›¶ä»¶å·,ä»¥åŠä»·æ ¼

![](/assets/images/20211231FinalSummary/2021F13MQB1.webp)
![](/assets/images/20211231FinalSummary/2021F13MQB2.webp)

æˆ‘æ¢çš„æ˜¯åä¸‹æ”¯è‡‚`PFR85-510`è¡¬å¥—,å› ä¸ºåŸè½¦çš„å·²ç»è€åŒ–åˆ°ä¸è¡Œäº†,è½¦å¾ˆæ¾æ•£,å¼€èµ·æ¥æ„Ÿè§‰è½¦ä¸è‡ªç„¶.è¿™ç©æ„å¦‚æœæ¢çš„è¯å¿…é¡»è¿é‚£ä¸¤ä¸ªä¸‹æ”¯è‡‚ä¸€èµ·æ¢. è¿™ä¸€ç‚¹æˆ‘ä¸å¾—ä¸æ‰¹è¯„ä¸€ä¸‹å¤§ä¼—,è¿™ä¸ªåº•ç›˜è®¾è®¡çš„æ‰©å±•æ€§å’Œæ”¹è£…æ€§å¾ˆå·®.ä¸è¿‡æ¢å®Œåè½¦åº•ç›˜ç«‹é©¬å¼€èµ·æ¥ä¸ä¸€æ ·äº†.åº•ç›˜å¾ˆç´§å¾ˆç¡¬,å›åˆ°äº†æ–°è½¦çŠ¶æ€.

> æ³¨æ„è¿™ç©æ„å¿…é¡»å¾—ç”¨ä¸“ä¸šè®¾å¤‡æ›´æ¢,è€Œä¸”æ›´æ¢å®Œåå¿…é¡»åš4è½®å®šä½,å› ä¸ºè¦æ”¹åŠ¨çš„æ˜¯å®ƒçš„æ‚¬æŒ‚ç³»ç»Ÿä¸­çš„åå¿ƒèºä¸,è¿™ä¸ªèºä¸ä¸“ç”¨äºè°ƒæ•´è½¦è¾†ä¾§å€¾è§’çš„ä½ç½®.

æ›´æ¢è¿™ä¸ªè¡¬å¥—æœ€éš¾çš„æ˜¯éœ€è¦å‹å‡ºåŸæ¥çš„è¡¬å¥—,æœ€å¥½æœ‰ä¸“ä¸šè®¾å¤‡,å¦åˆ™ä¸å¤ªå¥½æ‹†å¸.æˆ‘åˆ©ç”¨ä¿®ç†å‚çš„å‹åŠ›æœºå’Œä¸€äº›å¥—ç­’å·¥å…·å‹‰å¼ºæŠŠè¿™ç©æ„æ‹†ä¸‹æ¥.

![](/assets/images/20211231FinalSummary/2021F13Lining.webp)

ä¸Šè¾¹è¿™å›¾çš„åå¤‡ç®±åº•éƒ¨æ˜¯ä¸€ä¸ªè½¦å¢å¯æ‹†å¸å†…è¡¬æ¿,ä¸ºå•¥è¦æ¢å®ƒå‘¢ï¼Ÿå¤å¤©çš„æ—¶å€™å¸®äº²æˆšå†œæ‘æ“åŠå–œäº‹æ‹‰äº†ä¸€è½¦å¢çš„èœ.å¯¼è‡´æŸäº›æ¶²ä½“æ¸—æ¼åˆ°äº†è½¦åå¤‡ç®±,ä¸€è‚¡éš¾é—»çš„å‘³é“,è¿™ä¸œè¥¿æ´—è¿˜æ²¡æ³•æ´—,æçš„æˆ‘åªèƒ½æ¢ä¸ªæ–°çš„äº†.

![](/assets/images/20211231FinalSummary/2021F13ClearstorySwitch.webp)

å¤©çª—å¼€å…³,è¿™ä¸ªä¸œè¥¿å¾ˆå°‘æœ‰åçš„,æˆ‘çš„è½¦æ˜¯è¡Œé©¶ä¸€æ®µæ—¶é—´å¤©çª—è‡ªå·±æ‰“å¼€ä¸€ä¼šå„¿å¹¶å…³é—­,ä¸€å¼€å§‹æˆ‘ä»¥ä¸ºè¿ˆè…¾æ˜¯ä¸æ˜¯æœ‰äºŒæ°§åŒ–ç¢³æµ“åº¦æ£€æµ‹,å½“æ£€æµ‹åˆ°è½¦å†…äºŒæ°§åŒ–ç¢³æ°”ä½“è¿‡é«˜ä¼šè‡ªåŠ¨è§¦å‘å¤©çª—å¼€å…³æŠŠè½¦å¤–ç©ºæ°”äº¤æ¢ä¸€ä¸‹é¿å…é©¾é©¶è€…æ˜è¿·å›°å€¦,ç»“æœæˆ‘æŠŠè¿™ä¸ªäº‹æƒ…è·Ÿæˆ‘åŒå­¦ä¸€èŠä»–è¯´å¤§ä¼—åº”è¯¥ç»™ä½ ç‚¹ä¸“åˆ©è´¹,è¿™ä¸ªæ˜¯ä¸ªé€šç—…,å¼€å…³æ—¶é—´é•¿äº†è§¦ç‚¹æ°§åŒ–æ¥è§¦ä¸è‰¯.äºæ˜¯æ›´æ¢äº†ä¸€ä¸ª. ä¸€æ±½å¤§ä¼—ä½ çœ‹å¥½äº†,æˆ‘ç”³è¯·ä¸ªä¸“åˆ©ä½ çœ‹çœ‹è¿™ä¸“åˆ©è´¹æ˜¯ä¸æ˜¯äº¤ä¸€äº¤.

![](/assets/images/20211231FinalSummary/2021F13ShiftGears.webp)

ä¼ è¯´ä¸­çš„DSG(å•èº«ç‹—,å¤§å‚»ç“œ)æ¡£æŠŠæ‰‹çƒ,åŸæ¥çš„å·²ç»ç£¨åŒ…æµ†äº†,æ¢ä¸ªæ–°çš„.

![](/assets/images/20211231FinalSummary/2021F13MIB682E.webp)

è¿™ä¸ªmibè½¦æœºç³»ç»Ÿ, æ˜¯æˆ‘è§‰å¾—æ˜¯è¿™ä¸ªè€è½¦ä¸Šæœ€åº”è¯¥å‡çº§çš„éƒ¨ä»¶,è¿™ç©æ„å¾ˆè´µ,è¿ç¿»æ ‡å€’è½¦å¹¶æ”¯æŒCarPlayåŠŸèƒ½ä¸€å…±5500+. è€è½¦æœ‰ä¸ªå¾ˆå·®åŠ²çš„åœ°æ–¹æ˜¯ è½¦æœºç³»ç»Ÿå¡é¡¿,åŠŸèƒ½å•ä¸€ç ´æ—§,å¯¹æ–°å…´æŠ€æœ¯è·Ÿè¿›æ…¢,è¿™ä¸ªä¹Ÿä¸èƒ½æ€ªè€è½¦æ¯•ç«Ÿå®ƒç”Ÿäº§çš„æ—¶å€™è¿˜æ²¡æœ‰iPhone 5s. ä½†æ˜¯æ‰©å±•æ€§è¿™ä¸€å—åšçš„å¾ˆå·®.å¦‚æœæœªæ¥æ±½è½¦è°èƒ½æ—¢äº§ç¡¬ä»¶åˆäº§è½¯ä»¶å¹¶ä¸”èƒ½æä¾›ä¸€å¥—å®Œæ•´çš„æ¥å…¥è½¦æœºæ–¹æ¡ˆçš„è¯é‚£ä¹ˆè¿™å°†æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„åˆ›ä¸šæ–¹å‘.æ­£å¸¸æƒ…å†µè¿™ä¸ªä¸œè¥¿æƒ³æ¥å…¥æ±½è½¦æ˜¯ä¸è¡Œçš„å› ä¸ºå†…éƒ¨æ˜¯æœ‰åŠ å¯†åè®®çš„,ä¸é€šç”¨,æˆ‘ä¹°çš„è¿™ä¸ªæ˜¯ç ´è§£å®Œçš„æ³¢å…°è¿›å£.ç ´è§£å®Œå°±ä¸éœ€è¦å¯†ç äº†,ç›´æ¥å³æ’å³ç”¨.åªæ˜¯æœ‰äº›åŠŸèƒ½è¿™è½¦åŠŸèƒ½ä¸æ”¯æŒæ²¡æ³•ç”¨.æˆ‘ä¹°å®ƒçš„ä¸»è¦ç›®çš„æ˜¯æœ‰ä¸€ä¸ªå¥½çš„å¬éŸ³ä¹çš„ç³»ç»Ÿå¹¶æ”¯æŒcarplay.

æƒ³å®ç°è¿™ä¸¤ç‚¹çš„å¯è¡Œæ€§æ–¹æ¡ˆæ˜¯:

* æ¢ä¸€å¥—å¥½çš„è½¦æœºç³»ç»Ÿ
* æ¢ä¸€å¥—å¥½çš„éŸ³å“

æœ€åé€‰æ‹©äº†è½¦æœº,å› ä¸ºæœ‰å¯¼èˆª.

![](/assets/images/20211231FinalSummary/2021F13VWlogo.webp)

å…‰æ¢è½¦æœºæ˜¯ä¸è¡Œçš„,å¿…é¡»ä¹Ÿè¿åŒç¿»æ ‡å€’è½¦çš„æ‘„åƒå¤´ä¸€èµ·æ¢æ‰,äºæ˜¯ä¹Ÿé¡ºæ‰‹æ¢æ‰äº†ç¿»æ ‡å€’è½¦.è¿™ä¸ªä¸œè¥¿å°±æ˜¯å°é¢ä¸Šé‚£ä¸ªlogoå®ƒæ˜¯å¤§ä¼—çš„ç‹¬ç‰¹è®¾è®¡ä¹‹ä¸€,å€’è½¦çš„æ—¶å€™logoä¼šå¼ å¼€ä¼¸å‡ºä¸€ä¸ªæ‘„åƒå¤´,å¹³å¸¸æˆ‘ä»¬æŒ‰åŠ¨å®ƒçš„æ—¶å€™æ˜¯å¼€å¯åå¤‡ç®±.ä¸ç”¨æ‹…å¿ƒå®ƒä¼šè¢«æŒ‰å,å®ƒéå¸¸ç»“å®.

![](/assets/images/20211231FinalSummary/2021F13PressBar.webp)

è¿™ä¸ªæ˜¯è½¦çª—é“¶è‰²é•€é“¬æ¡,ä¸“ä¸šåç§°åº”è¯¥å«è½¦çª—å‹æ¡,ä¸ºå•¥æ¢å‘¢,æˆ‘çš„è½¦åŸæ¥ä¸»é©¾ä½ç½®çš„æ©¡èƒ¶è€åŒ–äº†,å·²ç»æ— æ³•æŒ¡ä½é›¨æ°´äº†,è¿™ä¸ªæ˜¯å’Œç»ç’ƒçª—ç´§è´´åœ¨ä¸€èµ·çš„éƒ¨ä»¶,äºæ˜¯å°±æ¢äº†.

![](/assets/images/20211231FinalSummary/2021F13AluminumBase.webp)

ä¸‹æ”¯è‡‚é“åº§æ”¯æ¶,å‰ä¾§åº•éƒ¨ä¸‹æ”¯è‡‚å’Œè½¦èº«æ¥è§¦çš„åœ°æ–¹æ©¡èƒ¶è€åŒ–,ç„¶åè¿˜ä¸èƒ½å•ç‹¬æ›´æ¢èƒ¶å¥—,åªèƒ½ä¸€å¥—ä¸€èµ·æ›´æ¢,æ‰€ä»¥ç›´æ¥æ¢äº†.è¿™å°±æ˜¯æˆ‘è¯´å¤§ä¼—çš„è½¦æ‰©å±•æ€§ä¸å¼ºçš„ä¸»è¦åŸå› ,é‚£ä¸ªé“åº§èƒ¶å¥—å®Œå¥½å°±æ©¡èƒ¶è€åŒ–äº†å¯¼è‡´åº•ç›˜å¼€è½¦çš„æ—¶å€™æ–¹å‘ç›˜æ‘†åŠ¨å“åº”ç¨‹åº¦ä¸å¤Ÿ.å…¶å®è¿™ä¸ªæœ€å¥½å•ç‹¬æ›´æ¢èšæ°¨é…¯å¼ºåŒ–è¡¬å¥—ä¼šå¥½ä¸€äº›,è€ƒè™‘æˆæœ¬ è¿™ä¿©å•ç‹¬æ›´æ¢å…¶å®éƒ½æ²¡æœ‰ä¸€ä¸ªèšæ°¨é…¯å¼ºåŒ–è¡¬å¥—è´µ.

![](/assets/images/20211231FinalSummary/2021F13EngineShield.webp)

å‘åŠ¨æœºä¸‹æŠ¤æ¿,è¿™ä¸ªä¸œè¥¿æ˜¯ä¿æŠ¤å‘åŠ¨æœºæ²¹åº•å£³çš„æ ‘è„‚ææ–™,é˜²æ­¢ç£•ç¢°ç¡¬ç‰©å¯¼è‡´å‘åŠ¨æœºå—ä¼¤.æ ‘è„‚çš„æ²¡æœ‰å¼‚å“,å¦‚æœæ˜¯é’¢åˆ¶çš„å®¹æ˜“å˜å½¢åå½±å“åº•ç›˜ç¨³å®šæ€§.

![](/assets/images/20211231FinalSummary/2021F13EngineMounting.webp)

å‘åŠ¨æœºè¿æ¥å˜é€Ÿç®±çš„æœºè„šèƒ¶,è¿™ä¸ªä¸œè¥¿å‡ºç°äº†å¼‚å“,äºæ˜¯æˆ‘å°±æ›´æ¢äº†æ–°çš„. å·¦ä¸Šè§’çš„æ˜¯è¿æ¥å˜é€Ÿç®±å’Œå‘åŠ¨æœºçš„.

![](/assets/images/20211231FinalSummary/2021F13MudGuard.webp)

è½¦è½®æŒ¡æ³¥æ¿,ä¹°è½¦çš„æ—¶å€™å·²ç»ç ´çš„ä¸æˆæ ·å­äº†,ç›´æ¥æ¢äº†.

![](/assets/images/20211231FinalSummary/2021F13Studdle.webp)

åå¤‡ç®±æ°”åŠ¨æ”¯æ’‘æ†,è¿™ä¸ªä¸œè¥¿å†¬å¤©å®¹æ˜“å¤±å»å¼¹æ€§,æœ‰å¯èƒ½å’Œé‡Œé¢ä½¿ç”¨çš„æ²¹æ¶²æœ‰å…³ç³»,ä¸è¿‡æ¢äº†1å¹´åé—®é¢˜ä¾æ—§,åç»­ä¹Ÿä¸æ‰“ç®—æ¢äº†å°±è¿™æ ·äº†.

![](/assets/images/20211231FinalSummary/2021F13TransmissionOil.webp)

æˆ‘çš„è½¦æ˜¯è¦æ±‚8ä¸‡å…¬é‡Œæ›´æ¢å˜é€Ÿç®±æ²¹çš„å¦åˆ™å°†ä¼šå¤±å»è´¨ä¿,è´¨ä¿10å¹´16wå…¬é‡Œ,ç›®å‰è¿˜å‰©3å¹´è´¨ä¿.

![](/assets/images/20211231FinalSummary/2021F13BrakeOil.webp)

åˆ¹è½¦æ²¹,è¿™ä¸ªæ˜¯æˆ‘å†¬å¤©å‘ç°è‡ªå·±çš„è½¦åˆ¹è½¦åˆ¹ä¸ä½äº†æˆ‘å»åº—é‡Œæ£€æµ‹ä¸€ä¸‹åˆ¹è½¦æ²¹æ°´åˆ†å­è¿‡å¤šçº¢ç¯é¢„è­¦.å¿…é¡»æ›´æ¢å¦åˆ™å½±å“å®‰å…¨.

![](/assets/images/20211231FinalSummary/2021F13Antifreeze.webp)

é˜²å†»æ¶²,è¿™ä¸ªä¹°è½¦çš„æ—¶å€™æ²¡æœ‰æ›´æ¢,æ€•æ°´ç®±å¤ªè„æ—©æ—©æ›´æ¢äº†,ç°åœ¨è¿˜å‰©åŠç“¶æ”¾åœ¨è½¦é‡Œé¢å‘¢.

![](/assets/images/20211231FinalSummary/2021F13ShockAbsorbe.webp)

è¿™è½¦ä»Šå¹´å¤å¤©èµ°äº†ä¸€äº›çƒ‚è·¯,å‘ç°å‡éœ‡å™¨4ä¸ªå…¨éƒ¨æ¼æ²¹,å…¨éƒ¨æ›´æ¢,åŒæ—¶æ›´æ¢äº†å‡éœ‡å¼¹ç°§.

![](/assets/images/20211231FinalSummary/2021F13Spring.webp)

å‡éœ‡å¼¹ç°§å·²ç»è¢«åº”åŠ›å‹ä½äº†1cmå¤š,ä¸€èµ·æ¢æ‰äº†é¿å…è½¦ä¸å®‰å…¨.

#### ä¿®è½¦å°ç»“

ä»¥ä¸Šå°±æ˜¯æˆ‘ä¹°çš„äºŒæ‰‹è½¦åå…¨éƒ¨çš„é›¶ä»¶æ›´æ¢,çœ‹åˆ°è¿™ä¹ˆå¤šé›¶ä»¶å¤§å®¶ä¹Ÿç»ˆäºçŸ¥é“äºŒæ‰‹è½¦ä¸ºå•¥å–çš„ä¾¿å®œäº†å§!å› ä¸ºè¿™äº›é…ä»¶åˆ°äº†æ›´æ¢çš„æ—¶å€™äº†.è¿™ä¹ˆå¤šé…ä»¶åŠ åœ¨ä¸€èµ·å†åŠ ä¸Šä¹‹å‰çš„ä¹°è½¦é’±éƒ½è¶³å¤Ÿä¹°ä¸€è¾†æ–°é«˜å°”å¤«é¡¶é…äº†. æˆ‘ç°åœ¨çš„æ„Ÿå—æ˜¯è¿™è½¦å‡ ä¹è¢«æˆ‘ä¿®å¤åˆ°äº†å·…å³°çŠ¶æ€,è™½ç„¶èŠ±äº†ä¸å°‘é’±å’Œæ—¶é—´,ä¹Ÿè®©æˆ‘ä»ä¸€ä¸ªç¨‹åºå‘˜å˜æˆäº†å¤šé¢æ‰‹.æœ‰äº›æ—¶å€™ä¿®è½¦æ˜¯æœ‰ä¹è¶£çš„.å½“ä¸ªçˆ±å¥½åŸ¹å…»æŒºå¥½.

## æ€»ç»“

![](/assets/images/20211231FinalSummary/final.webp)

å¹´ç»ˆæ€»ç»“å¾ˆé›¶ç¢,ä¹Ÿæ²¡å•¥æŠ€æœ¯å«é‡,è¿™ä¸€å¹´è¿‡å¾—å¾ˆéº»æœ¨,å­¦ä¹ å†…å®¹è¾ƒå°‘,å…¶å®æˆ‘è¿˜ç§ä¸‹é‡Œå­¦ä¹ äº†ä¸€éjavaå‘ç°è¿˜æ˜¯ä¸èƒ½å½¢æˆå­¦ä¹ ä½“ç³»å¹¶åœ¨å·¥ä½œä¸­ä½¿ç”¨å®ƒ,äº‰å–åç»­å­¦ä¹ å®Œå…¶å®ƒæ¡†æ¶ååšç‚¹ä¸œè¥¿.å›å®¶çš„ç»å†æ”¹å˜äº†æˆ‘çš„çœ‹æ³•,ä¹Ÿæ•™è‚²äº†æˆ‘åº”è¯¥ç»§ç»­æ‰æ ¹åœ¨åŒ—äº¬ç»§ç»­æˆä¸ºä¸€å`æ–°ä¸€ä»£çš„å†œæ°‘å·¥`,ä»0~1çš„åŠªåŠ›å·¥ä½œæ‰èƒ½å¥½å¥½çš„ç”Ÿæ´».

2022å¹´è§.


URL: https://sunyazhou.com/2021/12/iOSLessonsStudyNotes1/index.html.md
Published At: 2021-12-23 01:30:00 +0000

# iOSå¼€å‘é«˜æ‰‹è¯¾01-å»ºç«‹ä½ è‡ªå·±çš„iOSå¼€å‘çŸ¥è¯†ä½“ç³»

![](/assets/images/20210722iOSLessonsStudyNotes1/studycover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

é¦–å…ˆè‡´æ•¬ä¸€ä¸‹iOSé¢†åŸŸå¼€å‘è€…-æˆ´é“­,æˆ‘ä¹Ÿéå¸¸æ¨èå¤§å®¶ä¹°å®ƒçš„[è¯¾ç¨‹](https://time.geekbang.org/column/intro/161),æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯å­¦ä¹ æ—¶è®°å½•çš„ç¬”è®°,è®°å½•å¤§ä½¬è®²è¿°çš„å†…å®¹.


## å­¦ä¹ èµ„æ–™

Awesome ç³»åˆ—ï¼Œå°±æ˜¯ä¸“é—¨ç”¨æ¥æœé›†å„ç±»èµ„æ–™çš„ï¼Œå…¶ä¸­ [iOS çš„ Awesome](https://github.com/vsouza/awesome-ios) é‡Œé¢ï¼Œå°±æ¶‰åŠäº† iOS å¼€å‘çš„å„ä¸ªæ–¹é¢ã€‚

## iOS çš„çŸ¥è¯†ä½“ç³»

* åŸºç¡€
* åŸç†
* åº”ç”¨å¼€å‘
* åŸç”Ÿä¸å‰ç«¯

### åŸºç¡€æ¨¡å—

iOS å¼€å‘è€…éœ€è¦æŒæ¡çš„æ•´ä¸ªåŸºç¡€çŸ¥è¯†ï¼ŒæŒ‰ç…§ App çš„å¼€å‘æµç¨‹ï¼ˆå¼€å‘ã€è°ƒè¯•æµ‹è¯•ã€å‘å¸ƒã€ä¸Šçº¿ï¼‰è¿›è¡Œäº†åˆ’åˆ†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:

![](/assets/images/20210722iOSLessonsStudyNotes1/basicmodule.webp)

### åº”ç”¨å¼€å‘

![](/assets/images/20210722iOSLessonsStudyNotes1/applicationdevelopmodule.webp)

### åŸç†æ¨¡å—

![](/assets/images/20210722iOSLessonsStudyNotes1/principlemodule.webp)

### åŸç”Ÿä¸å‰ç«¯

![](/assets/images/20210722iOSLessonsStudyNotes1/nativeandfemudule.webp)


### æ±‡æ€»

![](/assets/images/20210722iOSLessonsStudyNotes1/final.webp)

# æ€»ç»“

iOSå¼€å‘åŠ¡å¿…æ±‚ç²¾,ç†è§£åŸç†å’Œç»†èŠ‚ï¼ŒåŒæ—¶å¼€é˜”çœ¼ç•Œï¼Œç´§è·ŸæŠ€æœ¯å‰æ²¿.




URL: https://sunyazhou.com/2021/12/WordFrepuency/index.html.md
Published At: 2021-12-12 08:08:08 +0000

# å¦‚ä½•è®¡ç®—æ–‡æœ¬ä¸­æŸäº›å•è¯å‡ºç°çš„é¢‘ç‡

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ€è¿‘åœ¨å­¦ä¹ ä¸€äº›Swiftä¸­çš„è¯­æ³•,æœ‰äº›æ¯”è¾ƒæœ‰æ„æ€çš„å†…å®¹æˆ‘éƒ½è®°äº†ç¬”è®°

## å…ˆçœ‹é—®é¢˜

### å¦‚ä½•è¯»å…¥ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç¡®å®šæ‰€æœ‰å•è¯çš„ä½¿ç”¨é¢‘ç‡å¹¶ä»é«˜åˆ°ä½æ’åºï¼Œæ‰“å°å‡ºæ‰€æœ‰å•è¯åŠå…¶é¢‘ç‡çš„æ’åºåˆ—è¡¨ï¼Ÿ

> è¿™é“é¢˜ç›®å‡ºè‡ªè®¡ç®—æœºç§‘å­¦å²ä¸Šçš„è‘—åäº‹ä»¶ï¼Œæ˜¯å½“å¹´ Communications of the ACM æ‚ å¿—â€œProgramming Pearlsâ€ä¸“æ çš„ä½œè€… Jon Bentley å‘è®¡ç®—æœºç§‘å­¦å…ˆé©± Donald Knuth æå‡ºçš„æŒ‘æˆ˜

é—®é¢˜æŠ½è±¡

* æ–‡æœ¬å­—ç¬¦ä¸²
* åˆ‡åˆ†æˆå•ä¸ªå•è¯çš„å­—ç¬¦ä¸²æ•°ç»„
* éå†æ•°ç»„,è¿‡æ»¤ä¸éœ€è¦ç»Ÿè®¡çš„å•è¯
* ç»Ÿè®¡å•è¯ä½¿ç”¨é¢‘ç‡å¹¶æ‰“å°


#### ä¼ ç»Ÿç¼–ç¨‹èŒƒå¼è§£æ³•

``` swift 
import UIKit

let words = "Blogging is about going through a memory stack of searching and storing knowledge, references, keyword indexing, and so on. Because my brain started like a memory stack, from empty stack to stack overflow, later use heap to store knowledge, found that memory is also OOM. Then I used reference tags to store iOS developing-related articles, tutorials, tricks, tricks, practice code, etc., which made my browser tabs look like they were poisoned. Later, I only remembered a few keywords to Google related articles. Sometimes some people post articles and delete them, so I can't find them. In addition, I have accumulated some skills and shared some skills. So I decided to blog about it. My skills are way, way out of line with yours truly. So I should write more and record the bit by bit of my growth process. Even though my views are filled with too many narrow theories and immature arguments, I must know that today is not yesterday. Otherwise I would have been sorry for wasting my time and ashamed for doing nothing."
let NON_WORDS = ["a", "of", "and", "!"]
func wordFrep(word: String) -> [String: Int] {
    var wordDict:[String: Int] = [:]
    let wordList = words.split(separator: " ");
    for word in wordList {
        let lowercaseWord = word.lowercased()
        if !NON_WORDS.contains(lowercaseWord) {
            if let count = wordDict[lowercaseWord] {
                wordDict[lowercaseWord] = count + 1
            } else {
                wordDict[lowercaseWord] = 1
            }
        }
    }
    return wordDict
}
print(wordFrep(word: words))
```

ç»“æœ:

``` sh
["in": 1, "on.": 1, "must": 1, "store": 2, "it.": 1, "blogging": 1, "views": 1, "with": 2, "arguments,": 1, "later": 1, "write": 1, "developing-related": 1, "from": 1, "out": 1, "to": 5, "theories": 1, "my": 6, "keywords": 1, "though": 1, "today": 1, "practice": 1, "more": 1, "can\'t": 1, "been": 1, "oom.": 1, "nothing.": 1, "post": 1, "storing": 1, "i": 8, "look": 1, "yesterday.": 1, "too": 1, "also": 1, "find": 1, "line": 1, "bit": 2, "the": 1, "growth": 1, "browser": 1, "tags": 1, "remembered": 1, "stack,": 1, "skills": 2, "started": 1, "process.": 1, "wasting": 1, "knowledge,": 2, "which": 1, "by": 1, "would": 1, "going": 1, "articles,": 1, "searching": 1, "some": 3, "references,": 1, "google": 1, "tutorials,": 1, "truly.": 1, "sorry": 1, "were": 1, "used": 1, "for": 2, "found": 1, "even": 1, "empty": 1, "blog": 1, "many": 1, "delete": 1, "addition,": 1, "about": 2, "tricks,": 2, "know": 1, "narrow": 1, "filled": 1, "stack": 3, "heap": 1, "related": 1, "code,": 1, "indexing,": 1, "only": 1, "articles": 1, "way,": 1, "way": 1, "record": 1, "later,": 1, "keyword": 1, "ios": 1, "not": 1, "accumulated": 1, "tabs": 1, "have": 2, "skills.": 1, "memory": 3, "them,": 1, "shared": 1, "sometimes": 1, "then": 1, "so": 4, "through": 1, "reference": 1, "poisoned.": 1, "them.": 1, "brain": 1, "ashamed": 1, "immature": 1, "etc.,": 1, "articles.": 1, "overflow,": 1, "people": 1, "is": 3, "made": 1, "otherwise": 1, "time": 1, "they": 1, "are": 2, "few": 1, "doing": 1, "because": 1, "that": 2, "decided": 1, "should": 1, "yours": 1, "like": 2, "use": 1]
```

#### å‡½æ•°å¼ç¼–ç¨‹è§£æ³•

``` swift
import UIKit

let words = "Blogging is about going through a memory stack of searching and storing knowledge, references, keyword indexing, and so on. Because my brain started like a memory stack, from empty stack to stack overflow, later use heap to store knowledge, found that memory is also OOM. Then I used reference tags to store iOS developing-related articles, tutorials, tricks, tricks, practice code, etc., which made my browser tabs look like they were poisoned. Later, I only remembered a few keywords to Google related articles. Sometimes some people post articles and delete them, so I can't find them. In addition, I have accumulated some skills and shared some skills. So I decided to blog about it. My skills are way, way out of line with yours truly. So I should write more and record the bit by bit of my growth process. Even though my views are filled with too many narrow theories and immature arguments, I must know that today is not yesterday. Otherwise I would have been sorry for wasting my time and ashamed for doing nothing."
let NON_WORDS = ["a", "of", "and", "!"]
func wordFrep2(words: String) -> [String: Int] {
    var wordDict: [String: Int] = [:]
    let wordList = words.split(separator: " ")
    wordList.map { $0.lowercased()}
            .filter{ !NON_WORDS.contains($0)}
            .forEach { wordDict[$0] = (wordDict[$0] ?? 0) + 1 }
    return wordDict
}
print(wordFrep2(words: words))
```
ç»“æœ:

``` sh
["storing": 1, "were": 1, "also": 1, "many": 1, "like": 2, "filled": 1, "used": 1, "process.": 1, "skills.": 1, "more": 1, "find": 1, "record": 1, "tricks,": 2, "found": 1, "oom.": 1, "later": 1, "which": 1, "yours": 1, "ashamed": 1, "tabs": 1, "though": 1, "can\'t": 1, "blog": 1, "way,": 1, "reference": 1, "out": 1, "post": 1, "write": 1, "i": 8, "store": 2, "ios": 1, "is": 3, "they": 1, "brain": 1, "growth": 1, "with": 2, "overflow,": 1, "wasting": 1, "would": 1, "time": 1, "even": 1, "to": 5, "articles,": 1, "tags": 1, "developing-related": 1, "made": 1, "doing": 1, "browser": 1, "then": 1, "people": 1, "later,": 1, "accumulated": 1, "yesterday.": 1, "know": 1, "going": 1, "the": 1, "through": 1, "addition,": 1, "my": 6, "remembered": 1, "theories": 1, "look": 1, "them.": 1, "articles.": 1, "stack": 3, "narrow": 1, "should": 1, "so": 4, "google": 1, "too": 1, "bit": 2, "heap": 1, "articles": 1, "it.": 1, "keyword": 1, "today": 1, "way": 1, "some": 3, "code,": 1, "started": 1, "keywords": 1, "shared": 1, "indexing,": 1, "use": 1, "arguments,": 1, "few": 1, "stack,": 1, "blogging": 1, "nothing.": 1, "are": 2, "views": 1, "must": 1, "references,": 1, "poisoned.": 1, "empty": 1, "decided": 1, "sorry": 1, "searching": 1, "by": 1, "knowledge,": 2, "not": 1, "for": 2, "about": 2, "them,": 1, "been": 1, "delete": 1, "line": 1, "because": 1, "from": 1, "memory": 3, "related": 1, "that": 2, "on.": 1, "truly.": 1, "etc.,": 1, "tutorials,": 1, "in": 1, "have": 2, "practice": 1, "skills": 2, "only": 1, "immature": 1, "otherwise": 1, "sometimes": 1]

```

### é—®é¢˜å¼•ç”³

* æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢æŸä¸ªå­—ç¬¦æ•°ç»„é‡Œé¢ç¬¬ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦çš„ä½ç½®ã€‚æ¯”å¦‚â€œHelloï¼Œ Worldâ€ï¼Œ[â€œaâ€, â€œeâ€, â€œiâ€, â€œoâ€, â€œuâ€]ï¼Œé‚£ e æ˜¯åœ¨å­—ç¬¦ä¸²ç¬¬ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦ï¼Œä½ç½®æ˜¯ 1ï¼Œ è¿”å› 1
* æç¤º:zipå‡½æ•°

> è¿™ä¸ªé—®é¢˜é¢è¯•ä¸­é—®çš„æœ€å¤š!


``` swift
let source = "Hello world"
let target: [Character] = ["a","e","i","o","u"]
zip(0..<source.count, source).forEach { (index, char) in
   if target.contains(char) {
       print(index)
   }
}
```

å¾—å‡ºç»“æœ

``` sh
1
4
7
```

### å•¥æ˜¯zipå‡½æ•°ï¼Ÿ

swiftä¸­è¿™ä¸ª zip å‡½æ•°å¯ä¸æ˜¯ç”¨æ¥å‹ç¼©æ–‡ä»¶çš„ï¼Œå…¶ä½œç”¨æ˜¯å°†ä¸¤ä¸ªåºåˆ—çš„å…ƒç´ ï¼Œä¸€ä¸€å¯¹åº”åˆå¹¶ç”Ÿæˆä¸€ä¸ªæ–°åºåˆ—

eg:

``` swift
let a = [1, 2, 3, 4, 5]
let b = ["a", "b", "c", "d"]
let c = zip(a, b).map { $0 }
print(c)
//è¾“å‡º [(1, "a"), (2, "b"), (3, "c"), (4, "d")]
```

åˆæˆ–è€…

``` swift
let b = ["a", "b", "c", "d"]
let c = zip(1..., b).map { $0 }
print(c)
//è¾“å‡º [(1, "a"), (2, "b"), (3, "c"), (4, "d")]
```

> å‚è€ƒ[Swift - zipå‡½æ•°ä½¿ç”¨è¯¦è§£ï¼ˆé™„æ ·ä¾‹ï¼‰](https://www.hangge.com/blog/cache/detail_1829.html)


# æ€»ç»“

ç»è¿‡æœ¬ç¯‡æ–‡ç« å­¦ä¹ ä½ å­¦ä¼šäº†ï¼Ÿ

* å¦‚ä½•è§£å†³æ–‡æœ¬ä¸­è®¡ç®—å•è¯å‡ºç°çš„é¢‘ç‡
* å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢æŸä¸ªå­—ç¬¦æ•°ç»„é‡Œé¢ç¬¬ä¸€ä¸ªå‡ºç°çš„å­—ç¬¦çš„ä½ç½®
* swiftä¸­çš„zip()å‡½æ•°ä½¿ç”¨

æŠ€æœ¯è¦æ±‚æˆ‘ä»¬ä¸æ–­å­¦ä¹ ,å‘¨æœ«çš„æ—¶å…‰ä¸èƒ½æµªè´¹. å­¦ä¹ äº†ä¸€ä¸ªä¸‹åˆ,æŠŠé‡è¦çš„å†…å®¹éƒ½è®°å½•äº†ä¸‹æ¥,å¦‚æœä½ çœ‹çš„ä¸æ˜¯å¾ˆæ‡‚å»ºè®®è®¤çœŸå­¦ä¹ ä¸€éswiftå°±ä¼šäº†.


URL: https://sunyazhou.com/2021/10/SwiftSubSets/index.html.md
Published At: 2021-10-16 08:30:00 +0000

# swiftä¸­æ±‚ä¸€ä¸ªé›†åˆä¸­å­é›†

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ€è¿‘åœ¨å­¦ä¹ ä¸€äº›Swiftä¸­çš„è¯­æ³•,æœ‰äº›æ¯”è¾ƒæœ‰æ„æ€çš„å†…å®¹æˆ‘éƒ½è®°äº†ç¬”è®°

## é—®é¢˜ ç»™å®šä¸€ä¸ªé›†åˆ,æ±‚è¿™ä¸ªé›†åˆä¸­æœ‰å¤šå°‘çœŸå­é›†ï¼Ÿ

#### æ–¹æ³•ä¸€

``` swift
import UIKit

func getSubSets<T>(set: Set<T>) -> Array<Set<T>> {
    let count = 1 << set.count //set.count ä¸èƒ½è¶…è¿‡64 å¦åˆ™å°†è¶…è¿‡intæœ€å¤§æ•°é™åˆ¶
    let elements = Array(set)
    var subsets = [Set<T>]()
    for i in 0..<count {
        var subset = Set<T>()
        for j in 0..<elements.count {
            if ((i >> j) & 1) == 1 {
                subset.insert(elements[j])
            }
        }
        subsets.append(subset)
    }
    return subsets
}

let testSet: Set = ["S","Y","Z"]
for subSet in getSubSets(set: testSet) {
    print(subSet)
}

```

å¾—å‡ºç»“æœ

``` sh
[]
["Y"]
["Z"]
["Y", "Z"]
["S"]
["Y", "S"]
["S", "Z"]
["Z", "Y", "S"]
```

#### æ–¹æ³•äºŒ

``` swift 
func getSubSets<T>(_ set: Set<T>) -> Array<Set<T>> {
    let elements = Array(set)
    return getSubSetsDetail(elements, index: elements.count - 1, count: elements.count)
}

func getSubSetsDetail<T>(_ elements: Array<T>, index: Int, count: Int) -> Array<Set<T>> {
    var subSets = Array<Set<T>>()
    if index == 0 {
        subSets.append(Set<T>())
        var subset = Set<T>()
        subset.insert(elements[0])
        subSets.append(subset)
        return subSets
    }
    subSets = getSubSetsDetail(elements, index: index - 1, count: count)
    for subset in subSets {
        var currentSubset = Set(subset)
        currentSubset.insert(elements[index])
        subSets.append(currentSubset)
    }
    return subSets
}

let testSet: Set = ["S","Y","Z"]
for subSet in getSubSets(testSet) {
    print(subSet)
}

```
è¾“å‡º

``` sh
[]
["Y"]
["Z"]
["Y", "Z"]
["S"]
["S", "Y"]
["S", "Z"]
["S", "Y", "Z"]
```


# æ€»ç»“

è®°å½•ä¸€äº›å­¦ä¹ çŸ¥è¯†,é˜²æ­¢é—å¿˜.




URL: https://sunyazhou.com/2021/06/CheckNSStringIsPureInteger/index.html.md
Published At: 2021-06-23 00:30:00 +0000

# å¦‚ä½•åˆ¤æ–­NSStringæ˜¯çº¯æ•°å­—ç±»å‹

![](/assets/images/20210623CheckNSStringIsPureInteger/pureinteger.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



## é‡åˆ°çš„é—®é¢˜?

åœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­æ˜¯å¦æœ‰è¿™æ ·çš„éœ€æ±‚,å•çº¯åˆ¤æ–­NSStringä¸­æ˜¯å¦æ˜¯çº¯æ•°å­—,å¦‚ä¸‹é¢ä»£ç 

``` objc
NSString *str1 = @"10003600";
NSString *str2 = @"ffdec500063143bf91f509255cb87cda";
```
æˆ‘ç¬¬ä¸€æ—¶é—´æƒ³åˆ°ç”¨æ­£åˆ™åŒ¹é…æ•°å­—å¹¶è¿ç»­,ä½†æ˜¯è¿™æ ·è²Œä¼¼ä¸æ˜¯ä¾¿æ·æ–¹å¼.
ç»è¿‡çŸ¥è¯†ç´¢å¼•æœç´¢,æˆ‘æ‰¾åˆ°äº†å¦‚ä¸‹è§£å†³æ–¹å¼

``` objc
NSString *str = @"ffdec500063143bf91f509255cb87cda";//@"10003600";
NSScanner *scanner = [NSScanner scannerWithString:str1];
NSInteger intVal;
BOOL result = ([scanner scanInteger:&intVal] && [scanner isAtEnd]);
if (result) {
    NSLog(@"æ˜¯çº¯æ•´å½¢");
} else {
    NSLog(@"éçº¯æ•´å½¢");
}
```
ä½¿ç”¨`NSScanner `ç±»æ¥å¤„ç†, æˆ‘çŒœæµ‹å®ç°åŸç†æ˜¯é€ä¸ªå­—ç¬¦ä¸²`è¿­ä»£ä¾¿åˆ©`é€ä¸ªå­—ç¬¦æ¢æµ‹å¹¶åˆ°è¾¾æœ€åçš„é•¿åº¦æ—¶æ¥åˆ¤å®šå½“å‰å­—ç¬¦ä¸²æ˜¯çº¯æ•°å­—ç±»å‹.

ä¸ºäº†æ–¹ä¾¿èµ·è§æˆ‘å†™äº†ä¸€ä¸ªdemoå’Œ categoryæ–¹ä¾¿å¤§å®¶ä½¿ç”¨.

`.h`å’Œ`.m`æ–‡ä»¶

``` objc
#import "NSString+NumberTypeCheck.h"
#import <CoreGraphics/CoreGraphics.h>

@interface NSString (NumberTypeCheck)

/// å­—ç¬¦ä¸²æ˜¯å¦æ˜¯çº¯Intç±»å‹
- (BOOL)isPureInt;
/// å­—ç¬¦ä¸²æ˜¯å¦æ˜¯çº¯NSIntegerç±»å‹
- (BOOL)isPureInteger;
/// å­—ç¬¦ä¸²æ˜¯å¦æ˜¯çº¯CGFloat(Double)ç±»å‹
- (BOOL)isPureCGFloat;

@end

@implementation NSString (NumberTypeCheck)

- (BOOL)isPureInt {
    NSScanner *scanner = [NSScanner scannerWithString:self];
    int intVal;
    BOOL result = ([scanner scanInt:&intVal] && [scanner isAtEnd]);
    return result;
}

- (BOOL)isPureInteger {
    NSScanner *scanner = [NSScanner scannerWithString:self];
    NSInteger intVal;
    BOOL result = ([scanner scanInteger:&intVal] && [scanner isAtEnd]);
    return result;
}

- (BOOL)isPureCGFloat {
    NSScanner *scanner = [NSScanner scannerWithString:self];
    CGFloat floatVal;
    BOOL result = ([scanner scanDouble:&floatVal] && [scanner isAtEnd]);
    return result;
}

@end

```

# æ€»ç»“

é‡åˆ°é—®é¢˜éœ€è¦ä¸æ–­æ¢ç´¢,ä¿æŒæŒç»­å­¦ä¹ æ±‚çœŸåŠ¡å®çš„æ€åº¦.

[demoåœ°å€](https://github.com/sunyazhou13/NSScanner)


URL: https://sunyazhou.com/2021/04/WCDBPractice/index.html.md
Published At: 2021-04-06 10:58:36 +0000

# WCDBå®è·µè®°å½•

![](/assets/images/20210406WCDBPractice/wcdb.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


### æœ€è¿‘åœ¨å¿™å•¥ï¼Ÿ

æ´²å“¥æœ€è¿‘åœ¨è·Ÿ WCDB æ–—æ™ºæ–—å‹‡,å…¬å¸åš IM,ä¸€å¥—å¾ˆè€çš„ä»£ç éœ€è¦ç»´æŠ¤,ä¸ºäº†æ‰“å¥½åº•å±‚åŸºç¡€,è§£å†³ä¸Šå±‚ä¸šåŠ¡é—®é¢˜å†³å®šæŒ‰æ‰¹æ¬¡ä»åŸæ¥çš„ FMDB è¿ç§»åˆ° WCDB.

### é‡åˆ°çš„é—®é¢˜
 
åœ¨ä½¿ç”¨ WCDB çš„è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªå¾ˆä½çº§çš„é”™è¯¯,å°±æ˜¯ `where` è¯­å¥åé¢æ¥çš„åˆ¤æ–­æ¡ä»¶é—®é¢˜

å…ˆæ¥çœ‹ä¸‹ä»£ç å’Œ ä¸šåŠ¡é—®é¢˜çš„åœºæ™¯å¤ç°

``` objc
- (BOOL)updateMsgHeight:(SYMessage *)msg toTable:(NSString *)tableName {
    if (tableName.length == 0) { return NO; }
    if (msg.messageId.length == 0) { return NO; }
    BOOL result = [[self dataBase] updateRowsInTable:[self tablenameByID:tableName]
                                          onProperty:SYMessage.chatMsgHeight
                                           withValue:msg.chatMsgHeight
                                               where:{SYMessage.messageId == msg.messageId && 
                                               		  SYMessage.type = msg.type}];
    return result;
}
```

![](/assets/images/20210406WCDBPractice/chatlist.gif)

`cell`çš„é«˜åº¦ä¸å¯¹åŠ²

ç»è¿‡ [FLEXå·¥å…·](https://github.com/FLEXTool/FLEX) æŸ¥çœ‹æ•°æ®åº“æ–‡ä»¶,å‘ç°æ•°æ®åº“ä¸­çš„`chatMsgHeight`å€¼éƒ½æ˜¯ä¸€æ ·çš„.

![](/assets/images/20210406WCDBPractice/chatlist2.gif)

ç»è¿‡æˆ‘ä»”ç»†æ’æŸ¥äº†æ‰€æœ‰ SQL è¯­å¥å‘ç°æœ‰ä¸€å¤„è¿™æ ·çš„è°ƒç”¨ åœ¨æ§åˆ¶å°.

``` sh
UPDATE msg_10003600 SET chatMsgHeight=? WHERE 1.000000 

```

å®ƒæ­£ç¡®çš„å½¢å¼åº”è¯¥æ˜¯è¿™æ ·çš„

``` sh
SQL: UPDATE msg_10003600 SET chatMsgHeight=? WHERE ((messageId='936542df77de41778139a42b4f4be296') AND (type=2))
```

æƒ³éƒ½ä¸ç”¨æƒ³`SQL`è¯­å¥ `where` åçš„æ¡ä»¶ ä¸€ç›´ä¸º `true` ,æ‰ä¼šå‡ºç°è¿™ç§ä½çº§åˆ°ä¸èƒ½åœ¨ä½çº§çš„é”™è¯¯.

çº æ­£åŸæœ‰ä»£ç å¦‚ä¸‹:

``` objc
- (BOOL)updateMsgHeight:(SYMessage *)msg toTable:(NSString *)tableName {
    if (tableName.length == 0) { return NO; }
    if (msg.messageId.length == 0) { return NO; }
    BOOL result = [[self dataBase] updateRowsInTable:[self tablenameByID:tableName]
                                          onProperty:SYMessage.chatMsgHeight
                                           withValue:msg.chatMsgHeight
                                               where:{SYMessage.messageId == msg.messageId && 
                                               		  SYMessage.type == msg.type}];
    return result;
}
```
è¿™ä¸ªé—®é¢˜å‡ºåœ¨äº†`SYMessage.type == msg.type`è€Œä¸æ˜¯`SYMessage.type = msg.type`.

> `==` æ’ç­‰äº  
> `=` èµ‹å€¼  
> WCDB å¹¶æ²¡æœ‰æç¤ºé”™è¯¯å› ä¸ºè¿™ä¸å±äºé”™è¯¯,è¿™å±äºæ­£å¸¸çš„ä»£ç èµ‹å€¼,C++ç¼–è¯‘å™¨ä¹Ÿä¸ä¼šæŠ¥é”™.

æ‰€ä»¥è¿™ä¸ª`å‘` å°ä¼™ä¼´ä»¬è¿˜æ˜¯æ³¨æ„.è™½ç„¶æ˜æ˜æ˜¯æˆ‘å°‘å†™äº†ç­‰å·å¯¼è‡´çš„,æ¯•ç«Ÿ WCDB ä¸æ˜¯ç¼–è¯‘å™¨ä¸èƒ½ä¸ºæˆ‘ä»¬çº æ­£`è¯æ³•åˆ†æ`ä»¥åŠ`è¯­æ³•åˆ†æ`å’Œ`è¯­ä¹‰åˆ†æ`äº¦æˆ–æ˜¯`æ–‡æ³•åˆ†æ`ç­‰ ç¼–è¯‘åŸç†çš„çŸ¥è¯†é”™è¯¯.

### è¯´è¯´ä½¿ç”¨ WCDB åçš„çœŸå®ä½“éªŒ

å¿«ï¼ æ–¹ä¾¿ï¼ä»£ç ç®€æ´! 

æˆ‘æŠŠèŠå¤©åŠŸèƒ½æ¶‰åŠåˆ°çš„èŠå¤©ä¼šè¯åˆ—è¡¨ã€æ¶ˆæ¯åˆ—è¡¨ã€ç­‰æ ¸å¿ƒæ¨¡å—å…¨éƒ¨è¿ç§»åˆ° WCDB.

è¿˜æœ‰ä¸ªå‘éœ€è¦å°ä¼™ä¼´ä»¬æ³¨æ„ã€FMDB è¿ç§»åˆ° WCDB ä¸€å®šåˆ‡è®° `è¦åšå°±åšå½»åº•`ã€ä¸€æ¬¡å…¨éƒ¨æ›¿æ¢ã€å¦åˆ™å¾ˆå®¹æ˜“å‡ºç°é˜Ÿåˆ—çš„æ­»é”ç«äº‰.ä¸ä¿¡é‚ªçš„å¯ä»¥è¯•è¯•.


### å¼€å‘æ–‡æ¡£å½’ç±»

[WCDB - è…¾è®¯å¼€æºçš„ç§»åŠ¨æ•°æ®åº“æ¡†æ¶](https://www.bookstack.cn/read/tencent-wcdb/66f893c12ef91f78.md) è¿™ä¸ªè¿æ¥å›½å†…æ‰“å¼€æ¯”è¾ƒå¿«

[FLEXè°ƒè¯•å·¥å…·](https://github.com/FLEXTool/FLEX) å¯ä»¥å®æ—¶æŸ¥çœ‹ app ä¸­å„ç§ UIViewã€ç½‘ç»œã€å¯¹è±¡ã€å†…å­˜ã€æ²™ç›’æ–‡ä»¶ç­‰ç­‰.


# æ€»ç»“

ä¸‹ä¸€æ­¥å‡†å¤‡çœ‹çœ‹WCDBæºç å®ç°,å’Œåˆ†äº«ä¸€äº›ç»å¸¸ä½¿ç”¨çš„æŠ€å·§, WCDB è®©æˆ‘é‡æ–°å­¦ä¹ äº†ä¸€éæ•°æ®åº“çŸ¥è¯†.




URL: https://sunyazhou.com/2021/02/UTIsOfficalFileExtensionName/index.html.md
Published At: 2021-02-21 10:40:31 +0000

# UTIsè‹¹æœå®˜æ–¹çš„æ–‡ä»¶æ‰©å±•åå…¨é›†

![](/assets/images/20210221UTIsOfficalFileExtensionName/UTIs.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## æ–‡ä»¶æ‰©å±•å

æœ€è¿‘å¼€å‘è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ä¸ªå¾ˆä½çº§çš„é—®é¢˜,æœ‰ç‚¹ç±»ä¼¼ç½‘ç›˜appé‡Œé¢è¦åŒºåˆ†å„ç§æ–‡ä»¶ç±»å‹,ç„¶åæ‰¾å‡ºå¯¹åº”çš„æ–‡ä»¶å½’å±iconå¹¶æ˜¾ç¤º,åšä¸ºä¸€ä¸ªæå®¢ç²¾ç¥çš„iOSå¼€å‘è€…,æˆ‘æƒ³æ‰¾åˆ°ä¸€ç§æ–‡ä»¶æ‰©å±•åé›†åˆå¹¶ä¸éœ€è¦è‡ªå·±å‘½åæšä¸¾å€¼,è¿™æ—¶æˆ‘æƒ³èµ·2015å¹´å·¦å³å¼€å‘ç™¾åº¦ç½‘ç›˜æ—¶è°ƒç ”è¿‡çš„airdrop,å…¶ä¸­è‹¹æœè§„å®šäº†åˆ†äº«æ–‡ä»¶åˆ°å…¶å®ƒæ‰‹æœºéœ€è¦æä¾›çš„`æ–‡ä»¶å”¯ä¸€æ ‡è¯†(UTI)`,äºæ˜¯æˆ‘æ‰¾äº†ä¸€ä¸‹æ–‡æ¡£è®°å½•ä¸€ä¸‹å¦‚ä¸‹çš„æ–‡ä»¶ç±»å‹åˆ—è¡¨.

è‹¹æœçš„CoreServices.frameworkä¸­æœ‰ä¸€ä¸ª`UTCoreTypes.h`å¤´æ–‡ä»¶è®°å½•äº†æ‰€æœ‰çš„æ–‡ä»¶ç±»å‹.

ä¸‹é¢æ˜¯æˆ‘å»æ‰æ‰€æœ‰æ³¨é‡Šçš„ä»£ç .å½“ç„¶è¿™äº›ä»…é™äºè‹¹æœå†…éƒ¨å¯è¯†åˆ«çš„ç±»å‹,é‚£äº›ä¸å¤ªå¸¸ç”¨çš„ç±»å‹æ–‡ä»¶æˆ–è€…è‡ªå®šä¹‰æ‰©å±•åæ–‡ä»¶ç±»å‹åœ¨è¿™é‡Œå°±ä¸èµ˜è¿°äº†,å¦‚æœéœ€è¦æä¸ªé€šé…ç±»å‹å³å¯,æˆ–è€…å•ç‹¬å¤„ç†.

``` objc

#ifndef __UTCORETYPES__
#define __UTCORETYPES__

#ifndef __COREFOUNDATION__
#include <CoreFoundation/CoreFoundation.h>
#endif


#include <Availability.h>

#if PRAGMA_ONCE
#pragma once
#endif



#ifdef __cplusplus
extern "C" {
#endif



CF_ASSUME_NONNULL_BEGIN



#pragma mark - Abstract base types

extern const CFStringRef kUTTypeItem                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeItem", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeContent                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeContent", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCompositeContent                     API_DEPRECATED_WITH_REPLACEMENT("UTTypeCompositeContent", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMessage                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeMessage", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeContact                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeContact", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeArchive                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeArchive", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeDiskImage                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeDiskImage", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Concrete base types
extern const CFStringRef kUTTypeData                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeData", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeDirectory                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeDirectory", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeResolvable                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeResolvable", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeSymLink                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeSymLink", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeExecutable                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeExecutable", ios(8.0, API_TO_BE_DEPRECATED), macos(10.5, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMountPoint                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeMountPoint", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAliasFile                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeAliasFile", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAliasRecord                          API_DEPRECATED("The Alias Manager is obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeURLBookmarkData                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeURLBookmarkData", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - URL types
extern const CFStringRef kUTTypeURL                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeURL", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeFileURL                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeFileURL", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Text types
extern const CFStringRef kUTTypeText                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeText", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePlainText                            API_DEPRECATED_WITH_REPLACEMENT("UTTypePlainText", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeUTF8PlainText                        API_DEPRECATED_WITH_REPLACEMENT("UTTypeUTF8PlainText", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeUTF16ExternalPlainText               API_DEPRECATED_WITH_REPLACEMENT("UTTypeUTF16ExternalPlainText", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeUTF16PlainText                       API_DEPRECATED_WITH_REPLACEMENT("UTTypeUTF16PlainText", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeDelimitedText                        API_DEPRECATED_WITH_REPLACEMENT("UTTypeDelimitedText", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCommaSeparatedText                   API_DEPRECATED_WITH_REPLACEMENT("UTTypeCommaSeparatedText", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeTabSeparatedText                     API_DEPRECATED_WITH_REPLACEMENT("UTTypeTabSeparatedText", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeUTF8TabSeparatedText                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeUTF8TabSeparatedText", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeRTF                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeRTF", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Markup languages
extern const CFStringRef kUTTypeHTML                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeHTML", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeXML                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeXML", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Programming languages

extern const CFStringRef kUTTypeSourceCode                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeSourceCode", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAssemblyLanguageSource               API_DEPRECATED_WITH_REPLACEMENT("UTTypeAssemblyLanguageSource", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCSource                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeCSource", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeObjectiveCSource                     API_DEPRECATED_WITH_REPLACEMENT("UTTypeObjectiveCSource", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeSwiftSource                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeSwiftSource", ios(9.0, API_TO_BE_DEPRECATED), macos(10.11, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(2.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCPlusPlusSource                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeCPlusPlusSource", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeObjectiveCPlusPlusSource             API_DEPRECATED_WITH_REPLACEMENT("UTTypeObjectiveCPlusPlusSource", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCHeader                              API_DEPRECATED_WITH_REPLACEMENT("UTTypeCHeader", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCPlusPlusHeader                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeCPlusPlusHeader", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJavaSource                           API_DEPRECATED("Java support is no longer provided by this operating system. Install a JDK to use Java.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Scripting languages

extern const CFStringRef kUTTypeScript                               API_DEPRECATED_WITH_REPLACEMENT("UTTypeScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAppleScript                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeAppleScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeOSAScript                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeOSAScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeOSAScriptBundle                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeOSAScriptBundle", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJavaScript                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeJavaScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeShellScript                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeShellScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePerlScript                           API_DEPRECATED_WITH_REPLACEMENT("UTTypePerlScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePythonScript                         API_DEPRECATED_WITH_REPLACEMENT("UTTypePythonScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeRubyScript                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeRubyScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePHPScript                            API_DEPRECATED_WITH_REPLACEMENT("UTTypePHPScript", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Serialized data types

extern const CFStringRef kUTTypeJSON                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeJSON", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePropertyList                         API_DEPRECATED_WITH_REPLACEMENT("UTTypePropertyList", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeXMLPropertyList                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeXMLPropertyList", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeBinaryPropertyList                   API_DEPRECATED_WITH_REPLACEMENT("UTTypeBinaryPropertyList", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Composite content types

extern const CFStringRef kUTTypePDF                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypePDF", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeRTFD                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeRTFD", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeFlatRTFD                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeFlatRTFD", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeTXNTextAndMultimediaData             API_DEPRECATED("The Multilingual Text Engine is obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeWebArchive                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeWebArchive", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));


#pragma mark - Image content types

extern const CFStringRef kUTTypeImage                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeImage", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJPEG                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeJPEG", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJPEG2000                             API_DEPRECATED("JPEG2000 is no longer supported by this operating system.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeTIFF                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeTIFF", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePICT                                 API_DEPRECATED("QuickDraw is obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeGIF                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeGIF", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePNG                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypePNG", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeQuickTimeImage                       API_DEPRECATED("The QuickTime Image file format is obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAppleICNS                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeICNS", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeBMP                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeBMP", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeICO                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeICO", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeRawImage                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeRAWImage", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeScalableVectorGraphics               API_DEPRECATED_WITH_REPLACEMENT("UTTypeSVG", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeLivePhoto                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeLivePhoto", ios(9.1, API_TO_BE_DEPRECATED), macos(10.12, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(2.1, API_TO_BE_DEPRECATED));

#pragma mark - Audiovisual content types

extern const CFStringRef kUTTypeAudiovisualContent                   API_DEPRECATED_WITH_REPLACEMENT("UTTypeAudiovisualContent", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMovie                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeMovie", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeVideo                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeVideo", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAudio                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeAudio", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeQuickTimeMovie                       API_DEPRECATED_WITH_REPLACEMENT("UTTypeQuickTimeMovie", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMPEG                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeMPEG", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMPEG2Video                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeMPEG2Video", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMPEG2TransportStream                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeMPEG2TransportStream", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMP3                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeMP3", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMPEG4                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeMPEG4Video", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMPEG4Audio                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeMPEG4Audio", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAppleProtectedMPEG4Audio             API_DEPRECATED_WITH_REPLACEMENT("UTTypeAppleProtectedMPEG4Audio", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAppleProtectedMPEG4Video             API_DEPRECATED_WITH_REPLACEMENT("UTTypeAppleProtectedMPEG4Video", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAVIMovie                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeAVI", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeAudioInterchangeFileFormat           API_DEPRECATED_WITH_REPLACEMENT("UTTypeAIFF", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeWaveformAudio                        API_DEPRECATED_WITH_REPLACEMENT("UTTypeWAV", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeMIDIAudio                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeMIDI", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

extern const CFStringRef kUTTypePlaylist                             API_DEPRECATED_WITH_REPLACEMENT("UTTypePlaylist", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeM3UPlaylist                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeM3UPlaylist", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Directory types

extern const CFStringRef kUTTypeFolder                               API_DEPRECATED_WITH_REPLACEMENT("UTTypeFolder", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeVolume                               API_DEPRECATED_WITH_REPLACEMENT("UTTypeVolume", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePackage                              API_DEPRECATED_WITH_REPLACEMENT("UTTypePackage", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeBundle                               API_DEPRECATED_WITH_REPLACEMENT("UTTypeBundle", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePluginBundle                         API_DEPRECATED_WITH_REPLACEMENT("UTTypePluginBundle", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeSpotlightImporter                    API_DEPRECATED_WITH_REPLACEMENT("UTTypeSpotlightImporter", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeQuickLookGenerator                   API_DEPRECATED_WITH_REPLACEMENT("UTTypeQuickLookGenerator", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeXPCService                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeXPCService", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeFramework                            API_DEPRECATED_WITH_REPLACEMENT("UTTypeFramework", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));


#pragma mark - Application and executable types
// Abstract executable types
extern const CFStringRef kUTTypeApplication                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeApplication", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeApplicationBundle                    API_DEPRECATED_WITH_REPLACEMENT("UTTypeApplicationBundle", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeApplicationFile                      API_DEPRECATED_WITH_REPLACEMENT("Classic applications are obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeUnixExecutable                       API_DEPRECATED_WITH_REPLACEMENT("UTTypeUnixExecutable", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

// Other platform binaries
extern const CFStringRef kUTTypeWindowsExecutable                    API_DEPRECATED_WITH_REPLACEMENT("UTTypeEXE", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJavaClass                            API_DEPRECATED("Java support is no longer provided by this operating system. Install a JDK to use Java.", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeJavaArchive                          API_DEPRECATED("Java support is no longer provided by this operating system. Install a JDK to use Java.", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

// Misc. binaries
extern const CFStringRef kUTTypeSystemPreferencesPane                API_DEPRECATED_WITH_REPLACEMENT("UTTypeSystemPreferencesPane", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Archival and compression types

extern const CFStringRef kUTTypeGNUZipArchive                        API_DEPRECATED_WITH_REPLACEMENT("UTTypeGZIP", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeBzip2Archive                         API_DEPRECATED_WITH_REPLACEMENT("UTTypeBZ2", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeZipArchive                           API_DEPRECATED_WITH_REPLACEMENT("UTTypeZIP", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));


#pragma mark - Document types
extern const CFStringRef kUTTypeSpreadsheet                          API_DEPRECATED_WITH_REPLACEMENT("UTTypeSpreadsheet", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePresentation                         API_DEPRECATED_WITH_REPLACEMENT("UTTypePresentation", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeDatabase                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeDatabase", ios(8.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));


#pragma mark - Messages, contacts, and calendar types

extern const CFStringRef kUTTypeVCard                                API_DEPRECATED_WITH_REPLACEMENT("UTTypeVCard", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeToDoItem                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeToDoItem", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeCalendarEvent                        API_DEPRECATED_WITH_REPLACEMENT("UTTypeCalendarEvent", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeEmailMessage                         API_DEPRECATED_WITH_REPLACEMENT("UTTypeEmailMessage", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

#pragma mark - Internet locations
extern const CFStringRef kUTTypeInternetLocation                     API_DEPRECATED_WITH_REPLACEMENT("UTTypeInternetLocation", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));


#pragma mark - Miscellaneous types

extern const CFStringRef kUTTypeInkText                              API_DEPRECATED("The Ink framework is obsolete.", ios(3.0, API_TO_BE_DEPRECATED), macos(10.4, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeFont                                 API_DEPRECATED_WITH_REPLACEMENT("UTTypeFont", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeBookmark                             API_DEPRECATED_WITH_REPLACEMENT("UTTypeBookmark", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTType3DContent                            API_DEPRECATED_WITH_REPLACEMENT("UTType3DContent", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypePKCS12                               API_DEPRECATED_WITH_REPLACEMENT("UTTypePKCS12", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeX509Certificate                      API_DEPRECATED_WITH_REPLACEMENT("UTTypeX509Certificate", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeElectronicPublication                API_DEPRECATED_WITH_REPLACEMENT("UTTypeEPUB", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));
extern const CFStringRef kUTTypeLog                                  API_DEPRECATED_WITH_REPLACEMENT("UTTypeLog", ios(8.0, API_TO_BE_DEPRECATED), macos(10.10, API_TO_BE_DEPRECATED), tvos(9.0, API_TO_BE_DEPRECATED), watchos(1.0, API_TO_BE_DEPRECATED));

CF_ASSUME_NONNULL_END
#ifdef __cplusplus
}
#endif

#endif /* __UTCORETYPES__ */

```


| Identifier (Constant) æ–‡ä»¶ç±»å‹ | Conforms to | Tags | Comments|
|-----|-----|-----|-----|
| public.item (kUTTypeItem)                                               | -                                                            |                                                                                                                                                                          | Base type for the physical hierarchy.                                                                                |
| public.content (kUTTypeContent)                                         | -                                                            |                                                                                                                                                                          | Base type for all document content.                                                                                  |
| public.composite-content (kUTTypeCompositeContent)                      | public.content                                               |                                                                                                                                                                          | Base type for mixed content. For example, a PDF file contains both text and special formatting data.                 |
| public.data (kUTTypeData)                                               | public.item                                                  |                                                                                                                                                                          | Base physical type for byte streams (flat files, pasteboard data, and so on).                                        |
| public.database                                                         | -                                                            |                                                                                                                                                                          | Base functional type for databases.                                                                                  |
| public.calendar-event                                                   | -                                                            |                                                                                                                                                                          | Base functional type for scheduled events.                                                                           |
| public.message (kUTTypeMessage)                                         | -                                                            |                                                                                                                                                                          | Base type for messages (email, IM, and so on).                                                                       |
| public.presentation                                                     | public.composite-content                                     |                                                                                                                                                                          | Base type for presentations.                                                                                         |
| public.contact (kUTTypeContact)                                         | -                                                            |                                                                                                                                                                          | Base type for contact information.                                                                                   |
| public.archive (kUTTypeArchive)                                         | -                                                            |                                                                                                                                                                          | Base type for an archive of files and directories.                                                                   |
| public.disk-image (kUTTypeDiskImage)                                    | public.archive                                               |                                                                                                                                                                          | Base type for items mountable as a volume.                                                                           |
| public.text (kUTTypeText)                                               | public.content,  public.data                                 |                                                                                                                                                                          | Base type for all text, including text with markup information (HTML, RTF, and so on).                               |
| public.plain-text (kUTTypePlainText)                                    | public.text                                                  | .txt,  text/plain                                                                                                                                                        | Text of unspecified encoding, with no markup. Equivalent to the MIME type text/plain                                 |
| public.utf8-plain-text (kUTTypeUTF8PlainText)                           | public.plain-text                                            | 'utf8',  NSStringPBoardType                                                                                                                                              | Unicode-8                                                                                                            |
| public.utf16-external-plain-â€‹text (kUTTypeUTF16ExternalPlainâ€‹Text)      | public.plain-text                                            | 'ut16'                                                                                                                                                                   | Unicode-16 with byte-order mark (BOM), or if BOM is not present, an external representation byte order (big-endian). |
| public.utf16-plain-text (kUTTypeUTF16PlainText)                         | public.plain-text                                            | 'utxt'                                                                                                                                                                   | Unicode-16, native byte order, with an optional byte-order mark (BOM).                                               |
| com.apple.traditional-mac-â€‹plain-text                                   | public.plain-text                                            | 'TEXT'                                                                                                                                                                   | Classic Mac OS text.                                                                                                 |
| public.rtf (kUTTypeRTF)                                                 | public.text                                                  | 'RTF ',  .rtf,  text/rtf,  NeXT Rich Text Format 1.0 pasteboard type,  NSRTFPBoardType                                                                                   | Rich Text.                                                                                                           |
| com.apple.ink.inktext (kUTTypeInkText)                                  | public.data                                                  |                                                                                                                                                                          | Opaque InkText data.                                                                                                 |
| public.html (kUTTypeHTML)                                               | public.text                                                  | 'HTML',  .html,  .htm,  text/html,  Apple HTML pasteboard type                                                                                                           | HTML text.                                                                                                           |
| public.xml (kUTTypeXML)                                                 | public.text                                                  | .xml,  text/xml                                                                                                                                                          | XML text.                                                                                                            |
| public.source-code (kUTTypeSourceCode)                                  | public.plain-text                                            |                                                                                                                                                                          | Generic source code.                                                                                                 |
| public.c-source (kUTTypeCSource)                                        | public.source-code                                           | .c                                                                                                                                                                       | C source code.                                                                                                       |
| public.objective-c-source (kUTTypeObjectiveCSource)                     | public.source-code                                           | .m                                                                                                                                                                       | Objective-C source code.                                                                                             |
| public.c-plus-plus-source (kUTTypeCPlusPlusSource)                      | public.source-code                                           | .cp,  .cpp,  .c++,  .cc,  .cxx                                                                                                                                           | C++ source code.                                                                                                     |
| public.objective-c-plus-â€‹plus-source (kUTTypeObjectiveCâ€‹PlusPlusSource) | public.source-code                                           | .mm                                                                                                                                                                      | Objective-C++ source code.                                                                                           |
| public.c-header (kUTTypeCHeader)                                        | public.source-code                                           | .h                                                                                                                                                                       | C header file.                                                                                                       |
| public.c-plus-plus-header (kUTTypeCPlusPlusHeader)                      | public.source-code                                           | .hpp,  .h++ ,  .hxx                                                                                                                                                      | C++ header file.                                                                                                     |
| com.sun.java-source (kUTTypeJavaSource)                                 | public.source-code                                           | .java,  .jav                                                                                                                                                             | Java source code                                                                                                     |
| public.script                                                           | public.source-code                                           |                                                                                                                                                                          | Base type for scripting language source code.                                                                        |
| public.assembly-source                                                  | public.source-code                                           | .s                                                                                                                                                                       | Assembly language source code.                                                                                       |
| com.apple.rez-source                                                    | public.source-code                                           | .r                                                                                                                                                                       | Rez source code.                                                                                                     |
| public.mig-source                                                       | public.source-code                                           | .defs,  .mig                                                                                                                                                             | Mig definition source code.                                                                                          |
| com.apple.symbol-export                                                 | public.source-code                                           | .exp                                                                                                                                                                     | Symbol export list.                                                                                                  |
| com.netscape.javascript-â€‹source                                         | public.source-code,  public.executable                       | .js,  .jscript,  .javascript,  text/javascript                                                                                                                           | JavaScript.                                                                                                          |
| public.shell-script                                                     | public.script                                                | .sh,  .command                                                                                                                                                           | Shell script.                                                                                                        |
| public.csh-script                                                       | public.shell-script                                          | .csh                                                                                                                                                                     | C-shell script.                                                                                                      |
| public.perl-script                                                      | public.shell-script                                          | .pl,  .pm,  text/x-perl-script                                                                                                                                           | Perl script.                                                                                                         |
| public.python-script                                                    | public.shell-script                                          | .py,  text/x-python-script                                                                                                                                               | Python script.                                                                                                       |
| public.ruby-script                                                      | public.shell-script                                          | .rb,  .rbw,  text/ruby-script                                                                                                                                            | Ruby script.                                                                                                         |
| public.php-script                                                       | public.shell-script                                          | .php,  .php3,  .php4,  .ph3,  .ph4,  .phtml,  text/x-php-script,  text/php,  application/php                                                                             | PHP script.                                                                                                          |
| com.sun.java-web-start                                                  | public.xml                                                   | .jnlp,  application/x-java,  jnlp-file,  application/jnlp                                                                                                                | Java web start.                                                                                                      |
| com.apple.applescript.text                                              | public.script                                                | .applescript                                                                                                                                                             | AppleScript text.                                                                                                    |
| com.apple.applescript.â€‹script                                           | public.data                                                  | .scpt,  'osas'                                                                                                                                                           | AppleScript.                                                                                                         |
| public.object-code                                                      | public.data,  public.executable                              | .o                                                                                                                                                                       | Object code.                                                                                                         |
| com.apple.mach-o-binary                                                 | public.data,  public.executable                              |                                                                                                                                                                          | Mach-O binary.                                                                                                       |
| com.apple.pef-binary                                                    | public.data,  public.executable                              |                                                                                                                                                                          | PEF (CFM-based) binary                                                                                               |
| com.microsoft.windows-â€‹executable                                       | public.data,  public.executable                              | .exe,  application/x-msdownload                                                                                                                                          | Microsoft Windows application.                                                                                       |
| com.microsoft.windows-â€‹dynamic-link-library                             | public.data,  public.executable                              | .dll,  application/x-msdownload                                                                                                                                          | Microsoft dynamic link library.                                                                                      |
| com.sun.java-class                                                      | public.data,  public.executable                              | .class                                                                                                                                                                   | Java class.                                                                                                          |
| com.sun.java-archive                                                    | public.data,  public.executable,  public.archive             | .jar ,  application/java-archive                                                                                                                                         | Java archive.                                                                                                        |
| com.apple.quartz-â€‹composer-composition                                  | public.data,  public.executable                              | .qtz ,  application/x-quartzcomposer                                                                                                                                     | Quartz Composer composition.                                                                                         |
| org.gnu.gnu-tar-archive                                                 | public.data,  public.archive                                 | .gtar,  application/x-gtar                                                                                                                                               | GNU archive.                                                                                                         |
| public.tar-archive                                                      | org.gnu.gnu-tar-archive                                      | .tar,  application/x-tar,  application/tar                                                                                                                               | Tar archive.                                                                                                         |
| org.gnu.gnu-zip-archive                                                 | public.data,  public.archive                                 | .gz,  .gzip,  application/x-gzip,  application/gzip                                                                                                                      | Gzip archive.                                                                                                        |
| org.gnu.gnu-zip-tar-archive                                             | org.gnu.gnu-zip-archve                                       | .tgz                                                                                                                                                                     | Gzip tar archive.                                                                                                    |
| com.apple.binhex-archive                                                | public.data,  public.archive                                 | .hqx,  application/mac-binhex40,  application/mac-binhex,  application/binhex                                                                                            | BinHex archive.                                                                                                      |
| com.apple.macbinary-â€‹archive                                            | public.data,  public.archive                                 | .bin,  application/x-macbinary,  application/macbinary                                                                                                                   | MacBinary archive.                                                                                                   |
| public.url (kUTTypeURL)                                                 | public.data                                                  | 'url '                                                                                                                                                                   | Uniform Resource Locator.                                                                                            |
| public.file-url (kUTTypeFileURL)                                        | public.url                                                   | 'furl'                                                                                                                                                                   | File URL.                                                                                                            |
| public.url-name                                                         | -                                                            | 'urln'                                                                                                                                                                   | URL name.                                                                                                            |
| public.vcard (kUTTypeVCard)                                             | public.data,  public.content                                 | 'vCrd',  .vcf,  .vcard,  text/directory,  text/vcard,  text/x-vcard,  Apple Vcard, pasteboard type                                                                       | vCard (electronic business card).                                                                                    |
| public.image (kUTTypeImage)                                             | public.data,  public.content                                 |                                                                                                                                                                          | Base type for images.                                                                                                |
| public.fax                                                              | public.image                                                 |                                                                                                                                                                          | Base type for fax images.                                                                                            |
| public.jpeg (kUTTypeJPEG)                                               | public.image                                                 | 'JPEG',  .jpg,  .jpeg,  image/jpeg                                                                                                                                       | JPEG image.                                                                                                          |
| public.jpeg-2000 (kUTTypeJPEG2000)                                      | public.image                                                 | 'jp2 ',  .jp2,  image/jp2                                                                                                                                                | JPEG 2000 image.                                                                                                     |
| public.tiff (kUTTypeTIFF)                                               | public.image                                                 | 'TIFF',  .tif,  .tiff,  image/tiff,  NeXT TIFF v4.0 pasteboard type,  NSTIFFPBoardType                                                                                   | TIFF image.                                                                                                          |
| public.camera-raw-image                                                 | public.image                                                 |                                                                                                                                                                          | Base type for digital camera raw image formats.                                                                      |
| com.apple.pict (kUTTypePICT)                                            | public.image                                                 | 'PICT',  .pic,  .pct,  .pict,  image/pict,  image/x-pict,  image/x-macpict                                                                                               | PICT image                                                                                                           |
| com.apple.macpaint-image                                                | public.image                                                 | .pntg,  'PNTG'                                                                                                                                                           | MacPaint image.                                                                                                      |
| public.png (kUTTypePNG)                                                 | public.image                                                 | 'PNGf',  .png,  image/png                                                                                                                                                | PNG image                                                                                                            |
| public.xbitmap-image                                                    | public.image                                                 | .xbm,  image/x-quicktime                                                                                                                                                 | X bitmap image.                                                                                                      |
| com.apple.quicktime-image (kUTTypeQuickTimeImage)                       | public.image                                                 | 'qtif',  .qif,  .qtif,  image/x-quicktime                                                                                                                                | QuickTime image.                                                                                                     |
| com.apple.icns (kUTTypeAppleICNS)                                       | public.image                                                 | 'icns',  .icns                                                                                                                                                           | Mac OS icon image.                                                                                                   |
| com.apple.txn.text-â€‹multimedia-data (kUTTypeTXNTextAndâ€‹MultimediaData)  | public.data,  public.composite-â€‹content                      | 'txtn'                                                                                                                                                                   | MLTE (Textension) format for mixed text and multimedia data.                                                         |
| public.audiovisual-â€‹content (kUTTypeAudioVisualâ€‹Content)                | public.data,  public.content                                 |                                                                                                                                                                          | Base type for any audiovisual content.                                                                               |
| public.movie                                                            | public.audiovisual-â€‹content                                  |                                                                                                                                                                          | Base type for movies (video with optional audio or other tracks).                                                    |
| public.video (kUTTypeVideo)                                             | public.movie                                                 |                                                                                                                                                                          | Base type for video (no audio).                                                                                      |
| com.apple.quicktime-movie (kUTTypeQuickTimeMovie)                       | public.movie                                                 | 'MooV',  .mov,  .qt,  video/quicktime                                                                                                                                    | QuickTime movie.                                                                                                     |
| public.avi                                                              | public.movie                                                 | .avi,  .vfw,  'Vfw ',  video/avi,  video/msvideo,  video/x-msvideo                                                                                                       | AVI movie.                                                                                                           |
| public.mpeg (kUTTypeMPEG)                                               | public.movie                                                 | 'MPG ',  'MPEG',  .mpg,  .mpeg,  .m75,  .m15,  video/mpg,  video/mpeg,  video/x-mpg,  video/x-mpeg                                                                       | MPEG-1 or MPEG-2 content.                                                                                            |
| public.mpeg-4 (kUTTypeMPEG4)                                            | public.movie                                                 | 'mpg4',  .mp4,  video/mp4,  video/mp4v                                                                                                                                   | MPEG-4 content.                                                                                                      |
| public.3gpp                                                             | public.movie                                                 | .3gp,  .3gpp,  '3gpp',  video/3gpp,  audio/3gpp                                                                                                                          | 3GPP movie.                                                                                                          |
| public.3gpp2                                                            | public.movie                                                 | .3g2 ,  .3gp2 ,  '3gp2',  video/3gpp2,  audio/3gpp2                                                                                                                      | 3GPP2 movie.                                                                                                         |
| public.audio (kUTTypeAudio)                                             | public.audiovisual-â€‹content                                  |                                                                                                                                                                          | Base type for audio (no video).                                                                                      |
| public.mp3 (kUTTypeMP3)                                                 | public.audio                                                 | 'MPG3',  'mpg3',  'Mp3 ',  'MP3 ',  'mp3!',  'MP3!',  .mp3,  audio/mpeg,  audio/mpeg3,  audio/mpg,  audio/mp3,  audio/x-mpeg,  audio/x-mpeg3,  audio/x-mpg,  audio/x-mp3 | MPEG-3 audio.                                                                                                        |
| public.mpeg-4-audio (kUTTypeMPEG4Audio)                                 | public.audio,  public.mpeg4                                  | 'M4A ',  .m4a                                                                                                                                                            | MPEG-4 audio.                                                                                                        |
| com.apple.protected-â€‹mpeg-4-audio (kUTTypeAppleProtectedâ€‹MPEG4Audio)    | public.audio                                                 | 'M4P ',  'M4B ',  .m4p,  .m4b                                                                                                                                            | Protected MPEG-4 audio. (iTunes music store format)                                                                  |
| public.ulaw-audio                                                       | public.audio                                                 | .au,  .ulw,  .snd,  'ULAW',  audio/basic,  audio/au,  audio/snd                                                                                                          | Î¼Law audio.                                                                                                          |
| public.aifc-audio                                                       | public.audio                                                 | .aifc,  .aiff,  .aif,  'AIFC',  audio/aiff,  audio/x-aiff                                                                                                                | AIFF-C audio.                                                                                                        |
| public.aiff-audio                                                       | public.audio                                                 | .aiff,  .aif,  'AIFF',  audio/aiff,  audio/x-aiff                                                                                                                        | AIFF audio.                                                                                                          |
| com.apple.coreaudio-â€‹format                                             | public.audio                                                 | .caf,  'caff'                                                                                                                                                            | Core Audio format.                                                                                                   |
| public.directory (kUTTypeDirectory)                                     | public.item                                                  |                                                                                                                                                                          | Base type for directories.                                                                                           |
| public.folder (kUTTypeFolder)                                           | public.directory                                             |                                                                                                                                                                          | A plain folder (that is, not a package).                                                                             |
| public.volume (kUTTypeVolume)                                           | public.folder                                                |                                                                                                                                                                          | A volume.                                                                                                            |
| com.apple.package (kUTTypePackage)                                      | public.directory                                             |                                                                                                                                                                          | A package (that is, a directory presented to the user as a file).                                                    |
| com.apple.bundle (kUTTypeBundle)                                        | public.directory                                             | 'BNDL', .bundle                                                                                                                                                          | A directory with an internal structure specified by Core Foundation Bundle Services. .                               |
| public.executable                                                       | -                                                            |                                                                                                                                                                          | Base type for executable data.                                                                                       |
| com.apple.application (kUTTypeApplication)                              | public.executable                                            |                                                                                                                                                                          | Base type for applications and other launchable files.                                                               |
| com.apple.application-â€‹bundle (kUTTypeApplicationBundle)                | com.apple.package,  com.apple.bundle,  com.apple.application | 'APPL', .app                                                                                                                                                             | Application bundle.                                                                                                  |
| com.apple.application-file (kUTTypeApplicationFile)                     | com.apple.application  public.data                           | 'APPL'                                                                                                                                                                   | Application file.                                                                                                    |
| com.apple.deprecated-â€‹application-file                                  | com.apple.applicationâ€‹-file                                  | 'APPC', 'APPD',  'APPE',  'appe',  'CDEV',  'cdev',  'dfil'                                                                                                              | Deprecated application file.                                                                                         |
| com.apple.plugin                                                        | com.apple.bundle,  com.apple.package                         | .plugin                                                                                                                                                                  | Plugin.                                                                                                              |
| com.apple.metadata-â€‹importer                                            | com.apple.plugin                                             | .mdimporter                                                                                                                                                              | Spotlight importer plugin.                                                                                           |
| com.apple.dashboard-â€‹widget                                             | com.apple.bundle,  com.apple.package                         | .wdgt                                                                                                                                                                    | Dashboard widget.                                                                                                    |
| public.cpio-archive                                                     | public.data                                                  | .cpio                                                                                                                                                                    | CPIO archive.                                                                                                        |
| com.pkware.zip-archive                                                  | public.data, public.archive                                  | .zip,  application/zip                                                                                                                                                   | Zip archive.                                                                                                         |
| com.apple.webarchive (kUTTypeWebArchive)                                | public.data,  public.composite-â€‹content                      |                                                                                                                                                                          | Web Kit webarchive format.                                                                                           |
| com.apple.framework (kUTTypeFramework)                                  | com.apple.bundle                                             | 'FMWK',  .framework                                                                                                                                                      | Framework.                                                                                                           |
| com.apple.rtfd (kUTTypeRTFD)                                            | com.apple.package,  public.composite-â€‹content                | .rtfd                                                                                                                                                                    | Rich Text Format Directory. That is, Rich Text with content embedding, on-disk format.                               |
| com.apple.flat-rtfd (kUTTypeFlatRTFD)                                   | public.data,  public.composite-â€‹content                      | NeXT RTFD pasteboard type,  NSRTFDPBoardType                                                                                                                             | Rich Text with content embedding, pasteboard format.                                                                 |
| com.apple.resolvable (kUTTypeResolvable)                                | -                                                            |                                                                                                                                                                          | Items that the Alias Manager can resolve.                                                                            |
| public.symlink (kUTTypeSymLink)                                         | public.item,  com.apple.resolvable                           |                                                                                                                                                                          | UNIX-style symlink.                                                                                                  |
| com.apple.mount-point (kUTTypeMountPoint)                               | public.item,  com.apple.resolvable                           |                                                                                                                                                                          | A volume mount point                                                                                                 |
| com.apple.alias-record (kUTTypeAliasRecord)                             | public.data,  com.apple.resolvable                           | 'alis'                                                                                                                                                                   | Alias record.                                                                                                        |
| com.apple.alias-file (kUTTypeAliasFile)                                 | public.data,  com.apple.resolvable                           |                                                                                                                                                                          | Alias file.                                                                                                          |
| public.font                                                             | public.data                                                  |                                                                                                                                                                          | Base type for fonts.                                                                                                 |
| public.truetype-font                                                    | public.font                                                  |                                                                                                                                                                          | TrueType font.                                                                                                       |
| com.adobe.postscript-font                                               | public.font                                                  |                                                                                                                                                                          | PostScript font.                                                                                                     |
| com.apple.truetype-â€‹datafork-suitcase-font                              | public.truetype-font                                         | .dfont,  'dfon'                                                                                                                                                          | TrueType data fork font.                                                                                             |
| public.opentype-font                                                    | public.font                                                  | .otf,  'OTTO'                                                                                                                                                            | PostScript OpenType font.                                                                                            |
| public.truetype-ttf-font                                                | public.truetype-font                                         | .ttf                                                                                                                                                                     | TrueType OpenType font.                                                                                              |
| public.truetype-collection-â€‹font                                        | public.font                                                  | .ttc,  'ttcf'                                                                                                                                                            | TrueType collection font.                                                                                            |
| com.apple.font-suitcase                                                 | public.font                                                  | .suit,  'FFIL',  'ffil',  'sfnt',  'tfil'                                                                                                                                | Font suitcase.                                                                                                       |
| com.adobe.postscript-lwfnâ€‹-font                                         | com.adobe.postscript-â€‹font                                   | 'LWFN'                                                                                                                                                                   | PostScript Type 1 outline font.                                                                                      |
| com.adobe.postscript-pfb-â€‹font                                          | com.adobe.postscript-â€‹font                                   | .pfb                                                                                                                                                                     | PostScriptType1 outline font.                                                                                        |
| com.adobe.postscript.pfa-â€‹font                                          | com.adobe.postscript-â€‹font                                   | .pfa                                                                                                                                                                     | PostScriptType 1 outline font.                                                                                       |
| com.apple.colorsync-profile                                             | public.data                                                  | .icc,  .icm,  .pf ,  'prof'                                                                                                                                              | ColorSync profile.                                                                                                   |
| Identifier                                                              | Conforms to                                                  | Comments                                                                                                                                                                 |
| public.filename-extension                                               | public.case-insensitive-text                                 | Filename extension.                                                                                                                                                      |
| public.mime-type                                                        | public.case-insensitive-text                                 | MIME type.                                                                                                                                                               |
| com.apple.ostype                                                        | public.text                                                  | Four-character code (type OSType).                                                                                                                                       |
| com.apple.nspboard-type                                                 | public.text                                                  | NSPasteboard type.                                                                                                                                                       |
| Identifier (Constant)                                                   | Conforms to                                                  | Tags                                                                                                                                                                     | Comments                                                                                                             |
| com.adobe.pdf (kUTTypePDF)                                              | public.data,  public.composite-â€‹content                      | 'PDF ',  .pdf,  application/pdf,  Apple PDF pasteboard type                                                                                                              | PDF data.                                                                                                            |
| com.adobe.postscript                                                    | public.data                                                  | .ps,  application/postscript                                                                                                                                             | PostScript data.                                                                                                     |
| com.adobe.encapsulated-â€‹postscript                                      | com.adobe.postscript                                         | .eps, NeXT Encapsulated PostScript v1.2 pasteboard type                                                                                                                  | Encapsulated PostScript.                                                                                             |
| com.adobe.photoshop-â€‹image                                              | public.image                                                 | .psd,  '8BPS, '  image/x-photoshop,  image/photoshop,  image/psd,  application/photoshop                                                                                 | Adobe Photoshop document.                                                                                            |
| com.adobe.illustrator.ai-â€‹image                                         | public.image                                                 | .ai                                                                                                                                                                      | Adobe Illustrator document.                                                                                          |
| com.compuserve.gif (kUTTypeGIF)                                         | public.image                                                 | 'GIFf', .gif, image/gif                                                                                                                                                  | GIF image.                                                                                                           |
| com.microsoft.bmp (kUTTypeBMP)                                          | public.image                                                 | 'BMP ',  'BMPf',  .bmp                                                                                                                                                   | Windows bitmap image.                                                                                                |
| com.microsoft.ico (kUTTypeICO)                                          | public.image                                                 | .ico                                                                                                                                                                     | Windows icon image.                                                                                                  |
| com.microsoft.word.doc                                                  | public.data                                                  | 'W8BN',  .doc,  application/msword                                                                                                                                       | Microsoft Word data.                                                                                                 |
| com.microsoft.excel.xls                                                 | public.data                                                  | 'XLS8',  .xls,  application/vnd.ms-excel                                                                                                                                 | Microsoft Excel data.                                                                                                |
| com.microsoft.powerpoint.â€‹ppt                                           | public.data,  public.presentation                            | .ppt,  'SLD8',  application/mspowerpoint                                                                                                                                 | Microsoft PowerPoint presentation.                                                                                   |
| com.microsoft.waveform-â€‹audio                                           | public.audio                                                 | .wav,  .wave,  '.WAV',  'WAVE',  audio/wav,  audio/wave                                                                                                                  | Waveform audio.                                                                                                      |
| com.microsoft.advanced-â€‹systems-format                                  | public.audiovisual-â€‹content                                  | .asf ,  'ASF_',  video/x-ms-asf                                                                                                                                          | Microsoft Advanced Systems format.                                                                                   |
| com.microsoft.windows-â€‹media-wm                                         | public.movie,  com.microsoft.advanced-â€‹systems-format        | .wm,  video/x-ms-wm                                                                                                                                                      | Windows media.                                                                                                       |
| com.microsoft.windows-â€‹media-wmv                                        | public.movie,  com.microsoft.advanced-â€‹systems-format        | .wmv, video/x-ms-wmv                                                                                                                                                     | Windows media.                                                                                                       |
| com.microsoft.windows-â€‹media-wmp                                        | public.movie,  com.microsoft.advanced-â€‹systems-format        | .wmp,  video/x-ms-wmp                                                                                                                                                    | Windows media.                                                                                                       |
| com.microsoft.windows-â€‹media-wma                                        | public.audio,  com.microsoft.advanced-â€‹systems-format        | .wma,  video/x-ms-wma                                                                                                                                                    | Windows media audio.                                                                                                 |
| com.microsoft.advanced-â€‹stream-redirector                               | public.xml,  public.audiovisual-â€‹content                     | .asx,  'ASX_',  video/x-ms-asx                                                                                                                                           | Advanced Stream Redirector.                                                                                          |
| com.microsoft.windows-â€‹media-wmx                                        | public.audio,  com.microsoft.advanced-â€‹stream-redirector     | .wmx ,  video-x-ms-wmx                                                                                                                                                   | Windows media.                                                                                                       |
| com.microsoft.windows-â€‹media-wvx                                        | public.audio,  com.microsoft.advanced-â€‹stream-redirector     | .wvx,  video-x-ms-wvx                                                                                                                                                    | Windows media.                                                                                                       |
| com.microsoft.windows-â€‹media-wax                                        | public.audio,  com.microsoft.advanced-â€‹stream-redirector     | .wax,  video-x-ms-wax                                                                                                                                                    | Windows media audio.                                                                                                 |
| com.apple.keynote.key                                                   | com.apple.package,  public.presentation                      | .key                                                                                                                                                                     | Apple Keynote document.                                                                                              |
| com.apple.keynote.kth                                                   | com.apple.package,  public.composite-â€‹content                | .kth                                                                                                                                                                     | Apple Keynote theme.                                                                                                 |
| com.truevision.tga-image                                                | public.image                                                 | .tga,  'TPIC',  image/targa,  image/tga,  application/tga                                                                                                                | TGA image.                                                                                                           |
| com.sgi.sgi-image                                                       | public.image                                                 | .sgi,  '.SGI',  image/sgi                                                                                                                                                | Silicon Graphics image.                                                                                              |
| com.ilm.openexr-image                                                   | public.image                                                 | .exr                                                                                                                                                                     | OpenEXR image.                                                                                                       |
| com.kodak.flashpix.image                                                | public.image                                                 | .fpx,  image/fpx,  application/vnd.fpx                                                                                                                                   | FlashPix image.                                                                                                      |
| com.j2.jfx-fax                                                          | public.fax                                                   | .jfx                                                                                                                                                                     | J2 fax.                                                                                                              |
| com.js.efx-fax                                                          | public.fax                                                   | .efx,  image/efax                                                                                                                                                        | eFax fax.                                                                                                            |
| com.digidesign.sd2-audio                                                | public.audio                                                 | .sd2,  'Sd2f'                                                                                                                                                            | Digidesign Sound Designer II audio.                                                                                  |
| com.real.realmedia                                                      | public.movie                                                 | .rm,  'PNRM',  application/vnd.rn-realmedia                                                                                                                              | RealMedia.                                                                                                           |
| com.real.realaudio                                                      | public.audio                                                 | .ram,  .ra ,  'PNRA',  audio/vnd.rn-realaudio,  audio/x-pn-realaudio                                                                                                     | RealMedia audio.                                                                                                     |
| com.real.smil                                                           | public.xml                                                   | .smil,  application/smil                                                                                                                                                 | Real synchronized multimedia integration language.                                                                   |
| com.allume.stuffit-archive                                              | public.data,  public.archive                                 | .sit,  .sitx,  application/x-stuffit,  application/x-sit ,  application/stuffit                                                                                          | Stuffit archive.                                                                                                     |



# æ€»ç»“

å¸Œæœ›è¿™ç¯‡æ–‡ç« å¸®åŠ©å“ªäº›éœ€è¦åŒºåˆ†ç±»å‹çš„å…„å¼Ÿä»¬.

[å®˜æ–¹æ–‡æ¡£Uniform Type Identifiers Reference](file:///Users/sunyazhou/Downloads/System-Declared%20Uniform%20Type%20Identifiers.htm). 
[å¦‚ä½•åœ¨macOSä¸Šè®¾ç½®æ‰“å¼€æ–‡ä»¶ç±»å‹ ](https://www.file-extensions.org/article/set-default-app-for-opening-files-with-no-extension-on-mac)

[è½¯ä»¶åœ°å€]()


URL: https://sunyazhou.com/2021/01/TextGradient/index.html.md
Published At: 2021-01-21 20:00:29 +0000

# æ»šåŠ¨æ–‡æœ¬è®¾ç½®æ¸å˜é¢œè‰²

![](/assets/images/20210121TextGradient/gradientcover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


æœ€è¿‘çœ‹åˆ°æœç‹å‘è¡¨äº†ä¸€ç¯‡æ–‡ç« ,å…¶ä¸­æœ‰ä¸€æ®µæ˜¯æ–‡æœ¬å¦‚ä½•æ·»åŠ æ¸å˜é¢œè‰²,ä½¿ç”¨`émask`çš„æ–¹å¼.å› ä¸ºmaskçš„æ–¹å¼éå¸¸è€—è´¹æ€§èƒ½,å› ä¸ºmaskä¼šè§¦å‘ç¦»å±æ¸²æŸ“.ä»Šå¤©çš„demoä¸­æˆ‘ä½¿ç”¨äº†åŸæ¥çš„demoåšä¸ºä¾‹å­


## å®ç°æ»šåŠ¨å­—å¹•ä¸­å¢åŠ  æ¸å˜é¢œè‰²

æ ¸å¿ƒå®ç°å¾ˆç®€å•,[å¸¦ä½ å®ç°å®Œæ•´çš„ iOS è§†é¢‘å¼¹å¹•ç³»ç»Ÿ](https://mp.weixin.qq.com/s/4pWrwmZBEbrca2uxIt3o6w)ä¸­å¹¶æ²¡æœ‰ç»™å‡ºç›¸å…³demo.åªæ˜¯æŠŠç›¸å…³å¼¹å¹•çš„å®ç°æ€è·¯å¤§æ¦‚è¯´è¯´.æ‰€ä»¥åšä¸ºä¸€ä¸ªiOSå¼€å‘è¦å–„äºåŠ¨æ‰‹å†™ä»£ç å®ç°å’ŒéªŒè¯å®ƒçš„æ€è·¯. å…¶å®æˆ‘å†…å¿ƒæ˜¯å¾ˆè®¨åŒ æœç‹çš„è¿™ç¯‡æœ‰å¤´æ²¡å°¾çš„æŠ€æœ¯æ–‡ç« ,æ— éå°±æ˜¯å†™å†™æ€è·¯,ä»£ç å®ç°çš„demoä¸€ä¸ªä¹Ÿä¸æ”¾å‡ºæ¥æ˜¾ç„¶ä¸åšé“.

è¿™é‡Œé¢æˆ‘ä»¬å®ç°çš„æ¯”è¾ƒç®€å•.å°±æ˜¯ç®—å‡ºæ–‡æœ¬çš„sizeç„¶åç”¨ CoreGraphicContextç”»å‡ºä¸€å¼ å›¾ç‰‡.

æ ¸å¿ƒä»£ç å¦‚ä¸‹

``` objc
+ (UIImage *)gradientFromColor:(UIColor *)fromeColor toColor:(UIColor *)toColor andSize:(CGSize)imageSize {
    if (fromeColor == nil) { fromeColor = [UIColor clearColor]; }
    if (toColor == nil) { toColor = [UIColor clearColor]; }
    NSArray* gradientColors = [NSArray arrayWithObjects: (id)fromeColor.CGColor, (id)toColor.CGColor, nil];
    CGFloat scale = [UIScreen mainScreen].scale;
    UIGraphicsBeginImageContextWithOptions(imageSize, NO, scale);
    CGContextRef context = UIGraphicsGetCurrentContext();
    CGContextSaveGState(context);
    CGColorSpaceRef colorSpace = CGColorGetColorSpace([fromeColor CGColor]);
    CGGradientRef gradient = CGGradientCreateWithColors(colorSpace, (CFArrayRef)gradientColors, NULL);
    CGPoint start = CGPointMake(0.0, 0.0);
    CGPoint end = CGPointMake(imageSize.width, 0.0);
    CGContextDrawLinearGradient(context, gradient, start, end, kCGGradientDrawsBeforeStartLocation | kCGGradientDrawsAfterEndLocation);
    UIImage *image = UIGraphicsGetImageFromCurrentImageContext();
    CGGradientRelease(gradient);
    CGContextRestoreGState(context);
    UIGraphicsEndImageContext();
    return image;
}
```

è¿™é‡Œé¢éœ€è¦ç€é‡å¼ºè°ƒå°±æ˜¯ ä¸¤è¡Œä»£ç  

``` objc
//è·å–æ¸å˜é¢œè‰²çš„è‰²å½©ç©ºé—´
CGColorSpaceRef colorSpace = CGColorGetColorSpace([fromeColor CGColor]);
//ç„¶åæ ¹æ®æ¸å˜æ•°ç»„è°ƒç”¨ çº¿æ€§æ¸å˜,è‡³äºæ”¾å¿ƒå¯ä»¥åœ¨ä»£ç ä¸­æ‰¾åˆ° start å’Œendçš„CGPointå¤„è®¾ç½®
NSArray* gradientColors = [NSArray arrayWithObjects: (id)fromeColor.CGColor, (id)toColor.CGColor, nil];
CGGradientRef gradient = CGGradientCreateWithColors(colorSpace, (CFArrayRef)gradientColors, NULL);

```

ä¸‹é¢æ˜¯æˆ‘è¿™è¾¹å®ç°çš„é€»è¾‘å±•ç¤º demoæˆ‘ä¼šæ”¾åˆ°ä¸‹é¢å¤§å®¶è‡ªè¡Œä¸‹è½½.

![](/assets/images/20210121TextGradient/gradienttextscroll.gif)

# æ€»ç»“

2021å¹´ç¬¬äºŒç¯‡.æ—¶é—´ç´§å‡‘,æœ‰æ—¶é—´ä»”ç»†ç ”ç©¶ä¸€ä¸‹ æœç‹çš„å¼¹å¹•ç³»ç»Ÿ å†™ä¸ªdemo.

[æœ¬æ–‡demoä¸‹è½½](https://github.com/sunyazhou13/UIScrollTextNewDemo)

[å‚è€ƒ å¸¦ä½ å®ç°å®Œæ•´çš„ iOS è§†é¢‘å¼¹å¹•ç³»ç»Ÿ](https://mp.weixin.qq.com/s/4pWrwmZBEbrca2uxIt3o6w)


URL: https://sunyazhou.com/2021/01/SafeAreaEdges/index.html.md
Published At: 2021-01-18 13:43:41 +0000

# è·å–UIWindowçš„è¾¹ç•Œè·ç¦»

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


2021ç¬¬ä¸€ç¯‡å‘å¸ƒè®°å½•å¼€å‘ä¸­é‡åˆ°çš„è´¹æ—¶é—´é—®é¢˜

### æ–°å·¥ç¨‹ç»å¸¸é‡åˆ°è§£å†³åˆ˜æµ·å±çš„è·ç¦»é—®é¢˜

å†™äº†ä¸€ä¸ªå·¥å…·ç±»ç”¨äºè®°å½•è¾¹ç•Œ

``` objc

#import <Foundation/Foundation.h>

#define YZAreaInsets [YZUtilTool yz_safeAreaInsets]


@interface YZUtilTool : NSObject

+ (UIEdgeInsets)yz_safeAreaInsets;

@end


@implementation YZUtilTool

+ (UIEdgeInsets)yz_safeAreaInsets {
    UIWindow *window = [UIApplication sharedApplication].windows.firstObject;
    if (![window isKeyWindow]) {
        UIWindow *keyWindow = [UIApplication sharedApplication].keyWindow;
        if (CGRectEqualToRect(keyWindow.bounds, [UIScreen mainScreen].bounds)) {
            window = keyWindow;
        }
    }
    if (@available(iOS 11.0, *)) {
        UIEdgeInsets insets = [window safeAreaInsets];
        return insets;
    }
    return UIEdgeInsetsZero;
}


@end

```

è®°å½•è¿‡ç¨‹ä»£ç .




URL: https://sunyazhou.com/2020/12/FinalSummary/index.html.md
Published At: 2020-12-30 23:30:00 +0000

# 2020å¹´ç»ˆæ€»ç»“

![](/assets/images/20201231FinalSummary/ShulanServiceArea.webp)
2020å¹´8æœˆ èˆ’å…°æœåŠ¡åŒº.ç»“æŸåŒ—æ¼‚å›å®¶çš„è·¯ä¸Š.

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

> ä¸ƒå¹´è¾›è‹¦åŒ—æ¼‚ä¹‹èº«,ä¸€æ—¥è¿˜ä¹¡é‡å½’æ•…äºº.   
> å€˜è‹¥æœ‰å¤©è‹¥æœ‰äººé—®, å¾å°˜ä»†ä»†çƒŸå°˜æ»šæ»š.  
> å›é¦–æˆè´¥æš‚ä¸”ä¸è®º,æˆ‘ç»™è‡ªå·±æ‰“åå‡ åˆ†.  
> è¨€ä¸æ±‚å®è¯­ä¸æ±‚çœŸ, çºµä¸ºåˆ©åˆƒä¾é»˜æ— é—».  

2020å¹´äº† è¿™æ˜¯æ¬ç –çš„ç¬¬7ä¸ªå¹´å¤´,è®°å½•ç”Ÿæ´»äº¤å‡ºå¹´ç»ˆæ€»ç»“. æ¯å¹´çš„è¿™ä¸ªæ—¶å€™æˆ‘ä¼šæ²‰ä¸‹å¿ƒæ¥æƒ³æƒ³è¿™ä¸€å¹´åˆç»å†äº†ä»€ä¹ˆ.å†™å¹´ç»ˆæ€»ç»“æ˜¯æ¯ä¸€ä¸ªæŠ€æœ¯å·¥ç¨‹å¸ˆå¯¹ITæŠ€æœ¯æ±‚çœŸåŠ¡å®çš„æ‰§ç€å’Œçƒ­è¡·å­¦ä¹ çš„æ€åº¦,å®ƒè€ƒéªŒç€æˆ‘ä»¬å»ºé€ æŠ€æœ¯åšå®¢çš„åˆå¿ƒ,ç£¨ç ºæˆ‘ä»¬çš„çµé­‚çºµæƒ…å‘å‰.

æ‰“å·¥äººè¦å­¦ä¼šè‡ªå¨±è‡ªä¹,å†™æ€»ç»“è¿™ä¸ªä¸œè¥¿,æˆ‘æ˜¯å­¦ä¹ ç€iOSæŠ€æœ¯å¤§ä½¬ [å”å·§](https://blog.devtang.com/)å’Œ iOSé¢†åŸŸé¡¶çº§å¼€å‘è€…[å–µç¥](https://onevcat.com/), çœ‹ç€ä¸¤ä½å‡ºè‰²çš„iOS å¼€å‘è€… æ¯å¹´éƒ½ä¼šåœ¨è‡ªå·±çš„åšå®¢ä¸Šå‘å¸ƒå¹´æ€»ç»“,ä½œä¸ºä¸€ä¸ªåæ¥è€…æˆ‘åº”è¯¥å‘ä»–ä»¬å­¦ä¹ è®°å½•ä¸ªäººçš„æˆé•¿.

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="750" height="110" loading="lazy" sandbox="allow-popups allow-scripts allow-same-origin" src="https://www.xiami.com/webapp/embed-player?autoPlay=0&id=388407"></iframe>



## 2020å›é¡¾

ä»Šå¹´äº‹ä»¶å¦‚ä¸‹:

* ç–«æƒ…
* æ”¿æ²»
* å¤å·¥
* å¿«æ‰‹æé€Ÿç‰ˆ
* å–æ‘©æ‰˜è½¦
* ç¦»èŒç»“æŸåŒ—æ¼‚
* å›å®¶
* ç››æ­Œ
*  æˆ‘è®¤ä¸ºçš„ä¼Ÿå¤§
* å­™äºšæ´²ç¬¬äºŒç†è®º
*  å¥½ç‰©
* æ€»ç»“


### ç–«æƒ…

![](/assets/images/20201231FinalSummary/vaccine.webp)

ä»2019å¹´æˆ‘å†™å®Œå¹´ç»ˆæ€»ç»“ä¸ä¹…,ä¸€ç§ç–«æƒ…ç–¾ç—…å¼€å§‹æˆæ‰©æ•£çš„å½¢å¼åœ¨ä¸­åå¤§åœ°ä¸Šå¿«é€Ÿä¼ æ’­,æœ€åæ‰çŸ¥é“æ˜¯æ–°å† è‚ºç‚ç—…æ¯’,2020å¹´åˆæ„ˆåŠ ä¸¥é‡,è®°å¾—å½“æ—¶æˆ‘ä»¬X6å›¢é˜Ÿå»[å”‡è¾£å·é‡åº†è€ç«é”…(ä¸Šåœ°ä¸ƒè¡—åº—)]()èšé¤åƒç«é”…,å¤§å®¶è®¨è®ºçš„è¯é¢˜æ˜¯å¦‚ä½•ä¹°å£ç½©.è¿‡å¹´å›å®¶çš„æ—¶å€™å¼€è½¦å›å®¶è·¯è¿‡äº¬å“ˆé«˜é€Ÿæ²¿çº¿,å„ä¸ªæœåŠ¡åŒºäººå¿ƒæ…Œæ…Œ. ç›´åˆ°æ­£æœˆåˆå›› åŸå¸‚å°åŒºä»¥åŠä¹¡é•‡æ‘å±¯å¼€å§‹å°è·¯,å£ç½©,æ¶ˆæ¯’æ¶²,ä¸€æ¬¡æ€§æ‰‹å¥—,æŠ¤ç›®é•œç­‰åŒ»ç–—é˜²ç–«ç”¨å“ç´§ä¿è„±é”€.

![](/assets/images/20201231FinalSummary/epidemicpreventionmaterials.webp)

äº‹æ€å‘å±•è¾ƒä¸ºä¸¥é‡,åˆå…«å¼€å§‹å°åŒºå…¨é¢å°é”,å°±è¿™æ ·è¿™ä¸€å¹´å¼€å§‹äº†æ¼«é•¿é˜²ç–«æˆ˜äº‰æ‹‰å¼€äº†åºå¹•,ç›´è‡³æœ¬æ–‡ä¹¦å†™ä¹‹æ—¶,å…¨çƒé™¤ä¸­å›½å¤–,è¿˜æœ‰å¾ˆå¤šå›½å®¶ä¾ç„¶é™·å…¥ç–«æƒ…é˜²ç–«ä¸åˆ©ç”šè‡³å¤±æ§çš„å±€é¢,ç¾å›½è¾ƒä¸ºä¸¥é‡ã€è‹±å›½æ–°å† ç—…æ¯’å˜å¼‚ä¼ æ’­ã€å†·å†»é£Ÿå“é¢‘é¢‘æ£€è½¦å‡ºç—…æ¯’é™„ç€ã€ç¯å¢ƒä¼ æŸ“æˆä¸ºå¯èƒ½.é¢å¯¹ç€ç§ç§ä¸åˆ©çš„æ¶ˆæ¯ä½¿ç–«æƒ…ä¸¥é‡æ‹–ç´¯å¯¼è‡´å·¥ä¸šç”Ÿäº§è¿Ÿæ»,å½±å“æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„æ–¹æ–¹é¢é¢,å¯¹æˆ‘ä»¬ç›´æ¥çš„å½±å“æ˜¯ä¸€äº›ä¾èµ–è¿›å£ç‰©èµ„çŸ­ç¼º,ç”Ÿæ´»æˆæœ¬ä¸Šå‡,å°±ä¸šå‹åŠ›å¢åŠ ,ç»æµå‘å±•ä¸‹è¡Œ,äººå‡æ”¶å…¥å‡å°‘æ˜æ˜¾.

è¿™ä¸€å¹´ä¸­ 2~3æœˆä»½æ–°å† è‚ºç‚é¡¶å³°ã€4~5æœˆä»½äºŒçº¿åŸå¸‚å†åº¦çˆ†å‘ã€7~8æœˆä»½ ç›¸å¯¹å¹³é™å¸¸æ§,å¹´æœ«è‚²è‹—è¿›å…¥ç¬¬ä¸‰é˜¶æ®µä¸´åºŠè¯•éªŒ. 

ä¹Ÿè®¸è¿™æ¬¡ç–«æƒ… è®©æˆ‘ä»¬ç§‘æŠ€è¡Œä¸šç»ˆäºæ‰“ç ´å¸¸è§„,ä½¿å±…å®¶åŠå…¬æˆä¸ºä¸€ç§å¯èƒ½.ä»2æœˆä»½çˆ†å‘å¼€å§‹,æˆ‘å°±é€æ­¥åœ¨å®¶é‡Œæ‰“å¼€ç”µè„‘coding.ä½†æ˜¯äº‹å®è¯æ˜,è¿˜æ˜¯é›†ä¸­åŠå…¬æ•ˆç‡é«˜,åˆ†æ•£å¼åŠå…¬ç›¸å¯¹ä½æ•ˆ. 

è¿™ä¸€å¹´æˆ‘å›½çš„é˜²ç–«è¿åŠ¨ç€å®è®©å›½äººè‚¯å®šå’Œèµè®¸,ä¸–ç•Œä¸Šé™¤äº†ä¸­å›½ä»¥å¤–å…¶å®ƒå›½å®¶å‡ ä¹é˜²ç–«ç–«æƒ…å±¡å±¡çˆ†å‡ºä¸åˆ©çš„æ¶ˆæ¯.ç¾åˆ©åšçš„é‡‘æ¯›ç‰¹æœ—æ™®æ€»ç»Ÿ å·®ç‚¹æŠŠä¸–ç•Œææˆä¸€é”…ç²¥. æœ€å¯ç¬‘çš„æ˜¯ç¾å›½è¿™ä¸ªèµ„æœ¬ä¸»ä¹‰å›½å®¶æ¯å¤©æ–°å† è‚ºç‚æ£€æµ‹ç¡®è¯Šäººæ•°å–å†³äºæ¯å¤©ç”Ÿäº§+è¿›å£è¯•å‰‚ç›’çš„ç”Ÿäº§æ•°é‡.å› ä¸ºæ²¡æœ‰é‚£ä¹ˆå¤šè¯•å‰‚ç›’å¯ç”¨æ‰€ä»¥èƒ½ç¡®è¯Šçš„äººæ•°æ˜¯å›ºå®šçš„.

å¸Œæœ›ç–«æƒ…å°½å¿«è¿‡å».è®©æˆ‘ä»¬çš„ç”Ÿæ´»èƒ½ä¸€å¦‚æ—¢å¾€.æ¯•ç«Ÿæˆ‘ä»¬è¿˜æ˜¯å°è€ç™¾å§“æŒ‡ç€èº«ä¸Šè¿™ç‚¹æœ¬äº‹åƒé¥­, ä½†æˆ‘åšå®šä¸ç§»çš„ç›¸ä¿¡ç§‘å­¦å’Œä¹ å¤§å¤§çš„é¢†å¯¼ä¸‹è¿™ä¸ªå›½å®¶å°†æˆä¸ºå†å²ä¸æœ½çš„ä¸°ç¢‘. é‚£å¥"è¿˜è¦ä¸ºäººæ°‘çš„å¯¹ç¾å¥½çš„ç”Ÿæ´»çš„å‘å¾€,ç»§ç»­å¥‹æ–—"ä¾ç„¶å›è¡åœ¨æˆ‘è„‘æµ·é‡Œ.è¿™å¥è¯æ¥è‡ª--ã€Šä¹ è¿‘å¹³ä¸ƒå¹´çš„çŸ¥é’å²æœˆã€‹.


### æ”¿æ²»

![](/assets/images/20201231FinalSummary/cutetrump.webp)  

æ›¾å‡ ä½•æ—¶ä¸€ä¸ªçº¯ç²¹çš„ITäººå¼€å§‹å…³æ³¨å›½å®¶æ”¿æ²»,å…¶å®æœ¬è´¨ä¸Šä¸æ˜¯å…³å¿ƒå›½å®¶æ”¿æ²»,è€Œæ˜¯å›½é™…æ”¿æ²»å˜åŠ¨å½±å“ç€æˆ‘ä»¬çš„é’±è¢‹å­çš„æ”¶å…¥.æˆ‘ä¹Ÿä»ä¸å…³å¿ƒç¾å›½åˆ°åº•æ˜¯è°å½“æ€»ç»Ÿã€ä½†æ˜¯æ²¡æƒ³åˆ°æ— è®ºæ˜¯è°å½“æ€»ç»Ÿå¯¹ä¸­å›½éƒ½æ˜¯ä¸€ç§ä¸å¥½çš„å±€é¢ã€å°é”åä¸ºç§‘æŠ€ä¼ä¸š,å¡è„–å­æŠ€æœ¯å¯¼è‡´å›½å†…ä¼ä¸šå€’é—­ç ´äº§,ä¸­å…´ä¸å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªè¢«å¡è„–å­æ‰“å€’çš„ä¼ä¸šå—?é‚£äº›åœ¨ä¸­å…´å·¥ä½œçš„äººä¸€å®šå¤šå¤šå°‘å°‘æ˜¯ä½ çš„åŒå­¦æˆ–è€…å‰åŒäº‹äº¦æˆ–æ˜¯ä½ æ›¾è®¤è¯†çš„æŸä¸ªäºº.

æˆ‘èƒ½è®¤çŸ¥çš„ä¸–ç•Œåœ¨å˜å¤§ï¼Œä½†æˆ‘å®é™…ç”Ÿæ´»çš„åœˆå­å´åœ¨å˜å°ã€‚ä¸–ç•Œçš„å˜åŠ¨éå¸¸å‰§çƒˆï¼Œåœ¨ä¸­ç¾äº‰éœ¸èƒŒæ™¯ä¸‹ï¼Œè¢«æ—¶ä»£æ´ªæµçš„è£¹æŒŸå‘å‰çš„æˆ‘ä»¬ï¼Œå…¶å®å¾ˆéš¾å¯¹æŠ—å®è§‚å±‚é¢çš„è§„å¾‹ã€‚è€Œå¯¹è¿™ä¸ªä¸–ç•Œçš„è®¤çŸ¥èŒƒå›´ï¼Œå¾€å¾€å†³å®šäº†æˆ‘ä»¬åœ¨è¿™ä¸€å˜å±€ä¸‹ä¼šå»å¾€ä½•æ–¹ã€‚è€Œä¸æ­¤åŒæ—¶æˆ‘æ‰€ä»äº‹çš„iOSå¼€å‘é¢†åŸŸä¹Ÿå·®ç‚¹è¢«ç‰¹æœ—æ™®æå¾—ä¸¢äº†é¥­ç¢—,åä¸ºæ˜¯ä¸€å®¶androidæ‰‹æœºå‚å•†ä¹‹ä¸€, è€Œä¸ä¹‹å¯¹åº”ç§»åŠ¨é˜µè¥iOS è‹¹æœæ‰‹æœºå‚å•†ä»…æ­¤ä¸€å®¶. å¦‚æœç‰¹æœ—æ™®æ‹¿ä¸­å›½åä¸ºå¼€æ¶®,æˆ‘å›½ä¹Ÿæ‹¿è‹¹æœå¯¹æ€¼,é‚£å°†æ˜¯æ¯ä¸€ä¸ªiOSå¼€å‘è€…**é»‘æš—å‰çš„é»æ˜**.ä¸¤ä¸ªå¤§å›½éè¦åƒå°å­©åµæ¶ä¸€æ ·,ä½ æ‹¿æˆ‘ä¸€å—æ©¡çš®æˆ‘å°±æ‹¿ä½ ä¸€åªé“…ç¬”,æœ€åä¼¤å®³çš„æ˜¯æˆ‘ä»¬è¿™äº›åŠ³è‹¦å¤§ä¼—,ä¸è¿‡å¥½åœ¨è¿™ç§å±æœºå±€é¢å¹¶æ²¡æœ‰ä¸Šæ¼”ä½†ä¸ä¿è¯åç»­ä¸ä¼šå‡ºç°.åœ¨è¿™ç§çŸ›ç›¾çš„å±€é¢ä¸­æˆ‘åªèƒ½éšé‡è€Œå®‰ç›¸æœºè€ŒåŠ¨.

ä¸çŸ¥æ‹œç™»ä¸Šå°ä¼šä¸ä¼šæ”¹å–„å›½é™…æ”¿æ²»çš„å±€é¢.æˆ‘åªæƒ³å¥½å¥½çš„coding,æ±‚æ‹œç™»æ€»ç»Ÿç»™ä¸ªé¥­ç¢—.

ç»å¸¸æ‰“å¼€å¿«æ‰‹ä¼šå‡ºç°ä¸€äº›ç”Ÿæ´»åœ¨ç¾æ´²çš„åäºº,æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ä»–ä»¬å¯¹ç¾å›½æœ‰å¦‚ä¸‹è¯è¯­çš„å½¢å®¹:

* ç‰¹æœ—æ™®ä¸å«ç‰¹æœ—æ™®å«é‡‘æ¯›
* æ–°å† ç—…æ¯’ä¸å«æ–°å† è‚ºç‚ å«å°å† 
* æ„ŸæŸ“æ–°å† è‚ºç‚æ­»äº¡çš„äºº å« å˜å˜£è£…è¢‹

è™½ç„¶è¿™äº›è¯æ±‡éƒ½æ˜¯ä¸­æ–‡é­…åŠ›ä¸­çš„é»‘è‰²å¹½é»˜,ä¹Ÿå®¢è§‚çš„åæ˜ äº†åœ¨ç¾åäººå®¢è§‚çš„ç”Ÿæ´»çŠ¶æ€.åœ¨ç¾å›½çš„åŒèƒå…¶å®æ·±å—ç€é»‘è£”ä»¥åŠå°åº¦è£”æˆ–è€…ç¾æ´²è£”çš„æ­§è§†ä»¥åŠåŒºåˆ«å¯¹å¾….æˆ‘æƒ³è¯´çš„æ˜¯è¿™ç§æ­§è§†å¹¶ä¸é™äºåŒ—ç¾,åœ¨é¦–éƒ½åŒ—äº¬ä¹Ÿä¸€æ ·åŒºåˆ†åŒ—äº¬åœŸè‘—å’Œå¤–åŸ äººå£,è¿™ç§æ­§è§†ä¹Ÿè®¸ä»æœªæ¶ˆé™¤è¿˜ä¸æ—¥ä¿±å¢,æˆ‘æ‰€åœ¨çš„ä¸‰çº¿åŸå¸‚è¿˜åŒºåˆ†æœ¬åœ°å’Œå¤–å¿æ¥åˆ’è¯·ç•Œé™. æˆ‘ä¸€ç›´éƒ½æ€€ç–‘**äººç”Ÿè€Œå¹³ç­‰** å’Œ **äººåˆ†ä¸‰å…­ä¹ç­‰**æ˜¯ä¸æ˜¯æ‚–è®º.

è™½ç„¶æ‰¾ä¸åˆ°åˆé€‚çš„ç­”æ¡ˆ ,ä½†æ˜¯å¸Œæœ›æœªæ¥çš„è‡ªå·±ä¿æŒä¸€ä¸ªå…³å¿ƒå›½å®¶å‰é€”å‘½è¿å‘å±•çš„ç§¯æå¿ƒæ€.å°±åƒå–µç¥è¯´çš„**è¢«æ—¶ä»£æ´ªæµè£¹æŒŸå‘å‰çš„æˆ‘ä»¬**åˆ«æ— å…ˆæ‹©,å­¦ä¼šç›´é¢æƒ¨æ·¡çš„äººç”Ÿå§!

### å¤å·¥

ç”±äºç–«æƒ…çš„å‘å±•è¢«æœ‰æ•ˆæ§åˆ¶,æ ¹æ®[å­™äºšæ´²ç†è®º](https://www.sunyazhou.com/2020/02/SunyazhouTheory/)è¿™ä¸ªå›½å®¶å‘å±•éœ€è¦ç”Ÿäº§åŠ›åŸç†,æˆ‘ä»¬æŠ•èº«äºå›½å®¶ç§‘æŠ€é¢†åŸŸå»ºè®¾çš„ç§‘æŠ€ä¼ä¸šå¼€å§‹å“åº”å›½å®¶çš„å·å¬å›äº¬å¤å·¥.åœ¨å®¶åŠå…¬äº†1ä¸ªæœˆ,æˆ‘è°ˆè°ˆæˆ‘çš„æ„Ÿå—.æˆ‘å¾ˆæœºæ™ºçš„æœ‰2ä»¶äº‹,ç¬¬ä¸€ä»¶äº‹æ˜¯19å¹´ä¹°äº†ä¸€ä¸ªå°ç ´è½¦è¿‡å¹´å›å®¶çš„æ—¶å€™é©±è½¦1500å…¬é‡Œä»åŒ—äº¬å¼€å›è€å®¶å®Œç¾çš„é—ªé¿å¼€äº†äººç¾¤èšé›†çš„ç–«æƒ…åŒºåŸŸ,ç¬¬äºŒä»¶äº‹æƒ…æ˜¯æˆ‘å¸¦ç€å·¥ä½œç”¨çš„ç¬”è®°æœ¬ç”µè„‘æµ‹è¯•æœºç­‰å…¨å¥—è®¾å¤‡å¾—ä»¥åœ¨å®¶åŠå…¬æ²¡æœ‰éº»çƒ¦åŒäº‹å¸®å¿™é‚®å¯„è®¾å¤‡.

å›åˆ°åŒ—äº¬çš„æ—¶å€™å·²ç»æ˜¯ä¸‰æœˆä¸­æ—¬äº†,å›äº¬çš„è·¯ä¸Šæˆ‘å¾ˆç–²æƒ« å¼€è½¦å¼€äº†18ä¸ªå°æ—¶,ä¸­é€”è¿˜ä¸èƒ½å»äº²æˆšå®¶ä¼‘æ¯,æ€•éº»çƒ¦äº²æˆšæœ‹å‹è¢«éš”ç¦».ç„¶åå°±æ˜¯åˆ°ç§Ÿä½çš„åœ°æ–¹éš”ç¦»14å¤©.14å¤©åå¼€å§‹åˆ†æ‰¹æ¬¡ä¸Šç­.

åœ¨å®¶åŠå…¬æœŸé—´åˆç»å†äº†å›¢é˜Ÿè°ƒæ•´.å¿«æ‰‹è”åˆåˆ›å§‹äºº**ä¸€ç¬‘**å¼€è§†é¢‘ä¼šè®®è·Ÿæˆ‘ä»¬å…¨ä½“æé€Ÿç‰ˆåŒäº‹è¯´æ˜äº†æœªæ¥å…¬å¸å¦‚ä½•å‘å±•,æé€Ÿç‰ˆå¦‚ä½•å½’å±,äººå‘˜å¦‚ä½•å¦‚ä½•... è€å®è¯´æˆ‘æ˜¯æŠŠå·¥ä½œçš„ç¬”è®°æœ¬ç”µè„‘æ”¾åœ¨çª—å°ä¸Šçœ‹ç€ä¸€ä½æ–°é«˜å±‚leaderçš„åˆ°æ¥ä»‹ç»ä¸€ä¸‹è‡ªå·±ç„¶åå„ä½é»˜ä¸ä½œå£°,æˆ‘åªæ˜¯æ‚„æ‚„çš„é—®äº†ä¸€ä¸ªå¾ˆlowçš„é—®é¢˜ **Thomas**ä¸­æ–‡åå«å•¥. ä¼¼ä¹æˆ‘éƒ½ä¹ æƒ¯äº†è¿™ç§äº’è”ç½‘å…¬å¸å›¢é˜Ÿæµªæ½®èˆ¬çš„æ›´è¿­. ä¸æ–­æ›´æ¢ä¸Šå±‚leaderæ„å‘³ç€è¦é‡æ–°å’Œä¸Šå¸å»ºç«‹ä¿¡ä»»å…³ç³»,å¾€å¾€è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒæ¼«é•¿.

æˆ‘åœ¨å¿«æ‰‹å·¥ä½œ2å¹´åŠæ¢äº†3ä¸ªè€å¤§.æˆ‘åœ¨å¿«æ‰‹å·¥ä½œæ—¶é—´æœ€é•¿çš„å·¥ä½æ˜¯D601ä¼šè®®å®¤ä¸­çš„ä¸€ä¸ªååƒ»çš„è§’è½.æˆ‘åœ¨å¿«æ‰‹åšè¿‡ä»**0.5åˆ°1**çš„appæ˜¯å¿«æ‰‹æé€Ÿç‰ˆ.æˆ‘åœ¨å¿«æ‰‹ã€‚ã€‚ã€‚é¢ ã€‚è¿‡çš„è¿˜ç®—å¿«ä¹.

ä¸‹é¢è¿™å¼ å›¾ç‰‡æ˜¯æˆ‘åº¦è¿‡æ¼«é•¿çš„éš”ç¦»æœŸå¤å·¥çš„ç¬¬ä¸€å¤©æ‹æ‘„çš„å›¾ç‰‡

![](/assets/images/20201231FinalSummary/returntowork1.webp)

å…¬å¸ä¸Šç­çš„äººå¾ˆå°‘

![](/assets/images/20201231FinalSummary/returntowork2.webp)

ä»¥å¾€æˆ‘éƒ½æ˜¯å»å…¬å¸åƒæ—©é¤.ç–«æƒ… çš„æ—¶å€™å…¬å¸ç»™æ¯ä½åŒå­¦é…å‘äº†ä¸€ä¸ªéš”ç¦»ç½©,è¦æŠŠå·¥ä½œé¤æ‹¿åˆ°å·¥ä½åƒ.

å‰©ä¸‹çš„å°±æ˜¯å…¬å¸æ¯ä¸ªäºº æ¯å‘¨éƒ½èƒ½é¢†åˆ°ä¸€å‘¨çš„å£ç½©,ç›´åˆ°æˆ‘ç¦»èŒçš„æ—¶å€™ä¸ºæ­¢ä¾ç„¶æ²¡æœ‰åœæ­¢å‘æ”¾.è¿™ç¡®å®æ˜¯ä¸€ç§ç§‘æŠ€å…¬å¸çš„äººæ–‡ç²¾ç¥.

### å¿«æ‰‹æé€Ÿç‰ˆ

è¿™æ˜¯æˆ‘è§è¯è¿‡çš„DAUæ—¥æ´»ä»0~5000w çš„appæ²¡æœ‰ä¹‹ä¸€.ä»19å¹´å¼€å§‹åšæé€Ÿç‰ˆ åˆ°åæ¥å›¢é˜Ÿè¢«å½’å±ç»™X6.å†åˆ°åæ¥æ‹†åˆ†æˆå•åˆ—ä¸Šä¸‹æ»‘å›¢é˜Ÿ.æˆ‘äº²èº«ç»å†çš„å®ƒçš„æˆé•¿.2019å¹´æœ«å¿«æ‰‹ç‹¬å®¶å† åäº†æ˜¥æ™š,æˆ‘ä»¬è¢«å‘ŠçŸ¥è¦ç­¾ç½²ä¸€ä»½ç§˜å¯†åè®®,åè®®çš„å†…å®¹å¤§æ¦‚æ˜¯è¯´æ˜¥æ™šçš„é¡¹ç›®ä¸èƒ½æ³„éœ².æ˜¯å…¬å¸æœºå¯†,ç­¾ç½²åè®®çš„äººå‘˜å¿…é¡»å¯¹å®¶äººç”šè‡³çˆ±äººéƒ½è¦ä¿å¯†.è¿ååè®®å°†è¢«å…¬å¸ç½šæ¬¾300wå…ƒ. å½“æ—¶è´Ÿè´£çš„ç›´æ’­ä¸šåŠ¡å¯èƒ½æ¯”è¾ƒé‡è¦.å…ƒæ—¦çš„æ—¶å€™ç¬¬ä¸€æ¬¡é¢„æ¼”ä¹ æ‰¿æ¥å…ƒæ—¦ç›´æ’­æ•ˆæœä¸é”™.

å¼€å§‹æ‰¿æ¥æ˜¥æ™šé¡¹ç›®å‰å¤•çš„åŠ¨å‘˜å¤§ä¼šä¸Šæˆ‘æ˜¯è¿™æ ·çš„.

![](/assets/images/20201231FinalSummary/meeting.webp)

å¹²æ´»çš„æ—¶å€™æ˜¯è¿™æ ·çš„

![](/assets/images/20201231FinalSummary/NewYearsDay.gif)

æœ€åå…ƒæ—¦è¿˜ç®—æ¯”è¾ƒæˆåŠŸ

![](/assets/images/20201231FinalSummary/meetingresult.webp)

æˆ‘å¸Œæœ›è¿™äº›ç…§ç‰‡èƒ½ç»å¾—èµ·æ—¶å…‰çš„æ²‰æ·€.è™½ç„¶å•¥ç”¨æ²¡æœ‰,å…¨å½“åšå®¢é‡Œä¸å¯æˆ–ç¼ºçš„ææ–™å§.

### å–æ‘©æ‰˜è½¦

åœ¨åŒ—äº¬å·¥ä½œè¿™ä¹ˆå¤šå¹´æˆ‘æ˜¯ä¸€è·¯æ¢äº†Nè¾†ç”µåŠ¨è½¦,è¦ä¹ˆæ˜¯ç”µåŠ¨è½¦æ€»å,è¦ä¹ˆæ˜¯å……ç”µæ¯”è¾ƒè´¹äº‹.å¯¼è‡´æˆ‘æœ€åä¸‹å†³å¿ƒä¹°ä¸€è¾†å¥½çš„æ‘©æ‰˜è½¦ä»£æ­¥æ¥ç¼“è§£åŒ—æ¼‚ç”Ÿæ´»çš„å‹æŠ‘æ„Ÿ.  
![](/assets/images/20201231FinalSummary/motor1.webp)  
![](/assets/images/20201231FinalSummary/motor2.webp)  
è¿™è¾†æ‘©æ‰˜è½¦æ˜¯æˆ‘ä¹°è¿‡æœ€å¥½çš„ä¸€è¾†æ²¡æœ‰ä¹‹ä¸€,æ— å¥ˆåªéª‘äº†3000å¤šå…¬é‡Œåå–äº†.å› ä¸ºè€å®¶ä¸å…è®¸æ‘©æ‰˜è½¦ä¸Šè·¯.æ²¡åŠæ³•æŠŠå®ƒå¸¦å›å».ä¸è¿‡è¿˜å¥½æœ€åæˆäº¤ä»·æ²¡èµ”å¤šå°‘.è‡ªå·±ä¹Ÿç®—å¯¹å®ƒæœ‰ä¸ªäº¤ä»£.

### ç¦»èŒç»“æŸåŒ—æ¼‚

ä»å‚åŠ å·¥ä½œä»¥æ¥æˆ‘ä¸€ç›´éƒ½æœ‰ä¸€ä¸ªæ„¿æœ›,ä»€ä¹ˆæ—¶å€™èƒ½ä¸ç”¨è¿™ä¹ˆæ¼‚æ³Š,å›åˆ°è‡ªå·±çš„å®¶ä¹¡,æ‰¾ä¸€ä»½å·¥ä½œå®‰é™çš„ç”Ÿæ´».è‡³å°‘ä¸ç”¨åƒåŒ—æ¼‚ä¸€æ ·å¦‚æ­¤ç…ç†¬.å¯æ˜¯å¯¹äºä¸€ä¸ªæ¯•ä¸šç”Ÿæ¥è¯´é¦–è¦çš„ä»»åŠ¡æ˜¯å¢é•¿çŸ¥è¯†å’ŒæŠ€èƒ½å’Œç”Ÿæ´»çš„è‡ªç»™è‡ªè¶³,æ¸æ¸çš„è¿™ä¸ªæ„¿æœ›å˜æˆäº†æ¢¦å¯ä»¥æ±‚çš„æ¢¦æƒ³ä¼´éšæ¯ä¸€ä¸ªåŒ—æ¼‚äººå¦‚å½±éšå½¢.

2018å¹´æˆ‘å…¥èŒäº†å¿«æ‰‹.è´Ÿè´£ç›´æ’­iOSå¼€å‘.åœ¨å°±èŒæœŸé—´æˆ‘é‡åˆ°äº†å¾ˆå¤šä¸ä¸€æ ·çš„åŒäº‹,æ¯ä¸ªäººéƒ½æŠ€æœ¯å‡ºè‰².å‚åŠ å¿«æ‰‹åä¸‰æœŸå…¥èŒåŸ¹è®­(å¿«æ‰‹ä¸­å­¦),CEOå®¿å ç»™æˆ‘ä»¬è®²è¿°åˆ›ä¸šçš„è‰°è¾›,ä»¥åŠèƒŒåä¸å‡ºåå´åˆé»˜é»˜æ”¯æŒå¿«æ‰‹çš„æŠ•èµ„äºº.æˆ‘ä¹Ÿè®¸æ¸…æ¥šçš„è®°å¾—åå“¥è¯´:"å¿«æ‰‹è¦åšä¸€å®¶æœ‰æ¸©åº¦çš„å…¬å¸,è¦è®©æ¯ä¸ªäººåƒé˜³å…‰ä¸€æ ·å¾—åˆ°æ™®æƒ ."åå“¥çš„æœ´å®æ„Ÿæœ‰ä¸€ç§äººæ ¼é­…åŠ›,æˆ‘å¸Œæœ›èƒ½ä¼ æ‰¿ä¸€ä¸‹åå“¥çš„è¿™ç§æœ´å®æ— å,å³ä¾¿ä»–ä¾ç„¶æ˜¯ä¸­å›½2018å¹´èƒ¡æ¶¦å¯Œè±ªæ¦œæ’è¡Œ84ä½çš„å¯Œç¿,æˆ‘ä¹Ÿä¼šæœ‰æ—¶å€™åœ¨ç”µæ¢¯é‡Œçœ‹åˆ°è¿™ä½CEO,å³ä¾¿ä»–å¦‚ä½•æœ‰é’±å´ä¾ç„¶å¼€ç€ä¸€è¾†åˆ«å…‹GL6è€å®å•†åŠ¡è½¦åŠå…¬,æœ‰æ—¶å€™ä¸‹ç­ä¹Ÿç»å¸¸èƒ½åœ¨åå‚æ‘è·¯ä¸Šçœ‹åˆ°ä»–éª‘è½¦æ‘©æ‹œå•è½¦å›å®¶.è¿™ä¹Ÿå¯¼è‡´æˆ‘ç»å¸¸ç©¿ç€åç‘æ£‰æ—ç”¸é‹çš„ä¸»è¦åŸå› .ä¸æ˜¯å› ä¸ºä½è°ƒçš„å­¦ä¹ è¿™ä½CEO,è€Œæ˜¯å› ä¸ºæˆ‘ç©·.

ç°åœ¨æµ®èºçš„æˆ‘åªæœ‰ä¸€ä¸ª![](/assets/images/20201231FinalSummary/getrich.webp)æƒ³æ³•


å°è±¡ä¸­æœ€æ·±åˆ»çš„æ˜¯serverç«¯çš„leader æä¼Ÿåšå¤§ä½¬ç»™å¤§å®¶åˆ†äº« ä¸€ä¸ªè§†é¢‘ä»ç”¨æˆ·æ‰‹æœºåˆ°è§‚çœ‹è€…èƒ½çœ‹åˆ°çš„è§†é¢‘å†…å®¹ä¸­é—´éƒ½ç»å†äº†å“ªäº›å¤„ç†è¿‡ç¨‹. å› ä¸ºè¿™æ˜¯æ¯ä¸€ä¸ªå¿«æ‰‹å‘˜å·¥åº”è¯¥äº†è§£çš„è¿‡ç¨‹.ä»è§†é¢‘ç”Ÿäº§åˆ°åç«¯å¤„ç†,å†åˆ°æ¶ˆè´¹è§†é¢‘.è®©æˆ‘ä»¬æ¯ä¸ªäººéƒ½å‚¨å¤‡å¥½æœªæ¥åœ¨å¿«æ‰‹å·¥ä½œçš„åŸºç¡€çŸ¥è¯†.æˆ‘å—ç›ŠåŒªæµ…,æˆ‘è¿›å…¥ç™¾åº¦çš„å·¥ä½œ3å¹´çš„æ—¶é—´é‡Œé™¤äº†å¿—æ³¢å¤§æ¦‚ç»™æ–°äººè®²è§£ä¸€ä¸‹ç™¾åº¦ç½‘ç›˜çš„appç«¯è®¾è®¡å¤–,æ²¡æœ‰äººæ„¿æ„è®²è¿°ä¸€ä¸‹ä¸€ä¸ªå…³é”®å­—æœç´¢åˆ°è‡ªç„¶è¯­è¨€åˆ†æå†åˆ°åç«¯æœç´¢å¼•æ“å¤„ç†å†åˆ°è¿”å›ç»™ç”¨æˆ·èƒ½çœ‹åˆ°çš„ä¿¡æ¯å†…å®¹æ˜¯æ€ä¹ˆæ ·çš„å¤„ç†è¿‡ç¨‹.ä»è¿™ä¸€ç‚¹ä¸Šçœ‹ç™¾åº¦è¿˜æ˜¯éœ€è¦å‘åæ¥è€…å­¦ä¹ å€Ÿé‰´ä¸€ä¸‹ç»éªŒ.

ç”±äºå·¥ä½œå›¢é˜Ÿç»å¸¸å˜åŠ¨,è‡ªå·±æ€»è¢«å®‰æ’(æŠ€æœ¯ä¸å‡ºä¼—),æƒ³æƒ³è‡ªå·±çš„7å¹´åŒ—æ¼‚ç”Ÿæ¶¯,æ™šä¸Šç»å¸¸ç¡ä¸ç€è§‰.ç”±äºåŠ ç­æ²¡æœ‰å……è¶³çš„æ—¶é—´ç¡è§‰,å¤´å‘å¼€å§‹é€æ¸å˜ç™½.åŠ ä¹‹åŒ—äº¬æ”¿åºœä¸€ç›´å¯¹å¤–åŸ äººæ¥äº¬å°±ä¸šæŒé«˜å‹æ‰“å‡»æ€åº¦,äººæƒä¸å¹³ç­‰ã€è·¯æƒä¸å¹³ç­‰ã€ä½†æ˜¯çº³ç¨å¾ˆå¹³ç­‰ã€åæ­£å°±æ˜¯å„ç§å¥½äº‹å¤–åŸ äººå‘˜å‡ ä¹éƒ½æ²¡æœ‰åŒ—äº¬äººåŒç­‰æƒåˆ©,åŒºåˆ«å¯¹å¾….å¦‚æ­¤ç§ç§,æˆ¿ä»·æŒç»­é«˜ä½ä¸ä¸‹,æˆ·å£é—®é¢˜ä¸€ç›´å¾ˆéš¾è½å®,åœ¨åŒ—äº¬é™¤äº†æ¯ç‡¥996ä¸Šç­ä»¥å¤–ä»»ä½•è‡ªé©¾æ—…æ¸¸çš„æƒåˆ©å¯¹æˆ‘ä»¬éƒ½æ˜¯å¥¢ä¾ˆçš„.æ¯•ç«Ÿæ²¡æœ‰**å¯¹ä»·**æˆ‘æ‰¿è®¤,å¯æ˜¯ä¹Ÿä¸èƒ½è®©æˆ‘ä»¬è¿ä¸ªè½¦éƒ½æ²¡æœ‰å°±æœ‰ç‚¹è¿‡åˆ†äº†,ä¸Šç­æˆ‘ä»¬ç§Ÿæˆ¿ã€æ”¾å‡éƒ½æ²¡æœ‰å¿ƒæƒ…æ¶ˆè´¹ã€åŒ—æ¼‚è¢«å½“æˆ**äººè‚‰å¹²ç”µæ± **å¯¹å¾….æˆ‘æœ€æ‹…å¿ƒçš„å°±æ˜¯æ¯å¹´ç§Ÿæˆ¿æ¢åœ°å„¿,è¿ä¸ªè½¦éƒ½æ²¡æœ‰ç€å®ä¸æ–¹ä¾¿.è¿™ç§è¢«å‹è¿«çš„ç”Ÿæ´»çŠ¶æ€æŒç»­äº†å¤šå¹´.ç»ˆäºä»Šå¹´æˆ‘æ— æ³•æ‰¿å—åŒ—äº¬ä¸å…è®¸å¤–åœ°è½¦è¿›å…¥,æ¯å¹´åªå…è®¸åŠç†12æ¬¡è¿›äº¬è¯.è¿™è®©æˆ‘å¤‡å—ç…ç†¬,æˆ‘ä¾ç„¶æ¸…æ¥šçš„è®°å¾—ä¸‹ç­åæ‰“ç¾½æ¯›çƒæ‰“åˆ°å¾ˆæ™šæ‰“ä¸åˆ°è½¦å›å®¶çš„åœºé¢. æ¸æ¸åœ°å„ç§äº‹æƒ…ä¼šå¼•å‘æˆ‘å¯¹**åœ¨åŒ—äº¬å·¥ä½œçš„æ€è€ƒ**,æ€è€ƒè‡ªå·±åˆ°åº•æƒ³å¾—åˆ°ä»€ä¹ˆ.ä¸å°±æ˜¯ä¸ºäº†å¾—åˆ°è‡ªå·±æƒ³è¦çš„ç”Ÿæ´»å—?ç›®å‰è¿™ç§å½¢åŠ¿æŒç»­ä¸‹å»,é’±å¯èƒ½å¾ˆå¤šä½†æ˜¯ä¹Ÿæ˜¯ä¼šè¢«å›½å®¶çš„é«˜æˆ¿ä»·ä¸€ä¸¾æ”¶å‰²å›åˆ°è§£æ”¾å‰çš„çŠ¶æ€.è™½ç„¶åŒ—äº¬ç”Ÿæ´»çš„å¤§å®¶éƒ½è¿™æ ·,ä½†è¿™ä¸æ˜¯æˆ‘æƒ³è¦çš„ç”Ÿæ´».æƒè¡¡äº†å¾ˆä¹…åŠ ä¸Šå·¥ä½œä¸Šçš„å˜åŠ¨è®©æˆ‘å¤±æœ›,äºæ˜¯æäº†ç¦»èŒç”³è¯·å¼€å§‹ä¼‘å‡å›è€å®¶.

![](/assets/images/20201231FinalSummary/JinghaExpressway.webp)  
æˆ‘åŸæ¥ä»æœªåƒç¦»å¼€åŒ—äº¬è¿™æ ·çš„å¼€å¿ƒ,é‚£ç§å–œæ‚¦å‰æ‰€æœªæœ‰.

> å›é¦–åŒ—æ¼‚çš„æ¯ä¸€æ­¥,æˆ‘éƒ½èµ°çš„å¥½å­¤ç‹¬.

----

æ²¿ç€äº¬å“ˆé«˜é€Ÿ, å¼€ç€æˆ‘çš„æˆ˜è½¦,ä¸€è·¯å‘ç¥–å›½çš„ä¸œåŒ—æ–¹å‘.

![](/assets/images/20201231FinalSummary/route1.webp)

å›å®¶è¡Œç¨‹å‰æ®µç›®çš„åœ°æ˜¯è¾½å®çœæ²ˆé˜³å¸‚é“è¥¿åŒºåŒ—å¤§è¥é™„è¿‘çš„åŒå­¦å®¶,ç»è¿‡è¿™ä¸€å¹´çš„ç–«æƒ…é˜²æ§,å…¨å›½çš„å°åŒºæ§åˆ¶æ¯”è¾ƒä¸¥æ ¼,ä¸¥ç¦å¤–åœ°äººå‘˜æµåŠ¨,æˆ‘å‡ºå‘å‰è®¡åˆ’é—®å¥½äº†å°åŒºå¯ä»¥è¿›å‡º,æ‰åŠ¨èº«å‡ºå‘. è¾½å®çœçœŸçš„æ˜¯é£å…‰æ— é™.è·¯è¿‡ ç»¥ä¸­ã€å…´åŸã€å¡”å±±ç­‰æœåŠ¡åŒºçš„æ—¶å€™ æˆ‘è®°å½•ä¸‹äº†è¿™ä¸€è·¯çš„ç¾å¥½è®°å¿†,æœ€ååœ¨ç›˜é”¦æœåŠ¡åŒºä¼‘æ¯æ—¶æ‹ä¸‹äº†ä¸‹é¢è¿™å¼ ç…§ç‰‡. è·¯è¿‡å¡”å±±æœåŠ¡åŒº,é‚£åº§åŒå¡”é€ å‹çš„å»ºç­‘æ¨ªè·¨äº¬å“ˆé«˜é€Ÿä¹Ÿè®¸æ˜¯è¿™ä¸€è·¯å”¯ä¸€ä¸€åº§åœ°æ ‡å§!

![](/assets/images/20201231FinalSummary/panjinservicearea.webp)

å›å®¶è¡Œç¨‹åæ®µè·¯ç¨‹éœ€è¦ä»å‰æ—æ–¹å‘ç»•è¡Œ,èµ°å‰é»‘é«˜é€Ÿ,èˆ’å…°ã€äº”å¸¸ ç„¶åå›å†°åŸå“ˆå°”æ»¨. ä¸­é€”è·¯è¿‡ å¼€æºã€é“å²­æœåŠ¡åŒºå¾ˆå¥½ã€æœåŠ¡åŒºå»ºè®¾çš„å¾ˆç°ä»£åŒ–,å¦‚æœå¤§å®¶æœ‰è‡ªé©¾ç»è¿‡çš„è¯ä¸€å®šè¦åˆ°è¿™ä¸¤ä¸ªæœåŠ¡åŒºçœ‹ä¸€çœ‹.

![](/assets/images/20201231FinalSummary/route2.webp)

è¿™ä¸­é€”ä¼šè·¯è¿‡ç¾ä¸½çš„é•¿ç™½å±±è„šä¸‹**é›¾å‡‡å²›**,é£æ™¯å¾ˆå¥½.ä»¥åæœ‰æœºä¼šäº†ä¸€å®šè‡ªé©¾å»ä»”ç»†çœ‹çœ‹.

![](/assets/images/20201231FinalSummary/provincialtollstations.webp)

æœ€åé€”å¾„æ–°å‘çœç•Œæ”¶è´¹ç«™è¿›å…¥å“ˆå°”æ»¨å¸‚,è¿™ä¸€è·¯èµ°äº†2å¤©.è¡Œç¨‹å¤§æ¦‚1500å…¬é‡Œ.

### å›å®¶

![ç§‹å¤©çš„å“ˆå°”æ»¨æ¸…æ™¨](/assets/images/20201231FinalSummary/home1.webp)

å›å®¶åçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ•´ç†ä¸€ä¸‹å®¶é‡Œç‰©å“.æˆ¿å­å…¥æˆ·å¾ˆä¹…äº†æ²¡äººæ‰“ç†.ä¸‹ä¸€æ­¥çš„è®¡åˆ’æ˜¯å¤ä¹ åŸºç¡€çŸ¥è¯†å‡†å¤‡é¢è¯•æ‰¾å·¥ä½œ.åœ¨ç¦»èŒåçš„ä¸€æ®µæ—¶é—´å¾®ä¿¡ä¸Šç»å¸¸æ”¶åˆ°å‰åŒäº‹å’ŒåŒè¡Œçš„å¾®ä¿¡,å¤§å®¶é—®æˆ‘åŒä¸€ä¸ªé—®é¢˜,ä¸ºå•¥æ”¾å¼ƒåŒ—äº¬è¿™ä¹ˆå¥½çš„å·¥ä½œå’Œå¾…é‡å›è€å®¶ï¼Ÿæˆ‘å…¶å®æƒ³åœ¨è¿™é‡Œæ­£é¢å›å¤ä¸€ä¸‹,æ¯ä¸ªäººéƒ½è¦ç»å†æˆ–å¤šæˆ–å°‘çš„æ¢å·¥ä½œç»å†,ITè¿™ä¸€è¡Œä»æ¥éƒ½æ˜¯ä¸€ä¸ªé«˜é£é™©ã€é«˜æ”¶ç›Šã€é«˜å¤±ä¸šç‡çš„è¡Œä¸š,**æˆ‘ç‰ºç‰²äº†é«˜è–ªå’Œå¥½çš„å¾…é‡æ¢æ¥äº†è‡ªå·±æƒ³è¦çš„ç”Ÿæ´»**,æ‰€ä»¥ä»˜å‡ºè¿™äº›éƒ½æ˜¯å€¼å¾—çš„.å³ä¾¿å›å®¶åçš„å…¬å¸éƒ½å¾ˆlow,å¾…é‡å¾ˆå·®,ç”šè‡³æ›¾ç»åœ¨åŒ—äº¬ä¸éœ€è¦è€ƒè™‘çš„é—®é¢˜å›å®¶åéƒ½æ˜¯å¾ˆéš¾çš„äº‹æƒ…,ä½†æ˜¯ä¸‰çº¿åŸå¸‚å°±è¿™æ ·,çºµç„¶ä¸‹è¿™ä¸ªå†³å®šä¸æ˜¯å¾ˆæ˜æ™º,ä½†å’Œåœ¨åŒ—äº¬æ¯”èµ·æ¥å¥½å¤šäº†,å†ä¹Ÿä¸ç§Ÿæˆ¿å­äº†,å¹¸ç¦æ„ŸæŒ‡æ•°é«˜äº†,ä¸‹åˆ5ç‚¹å¤šå¯ä»¥ä¸‹ç­äº†,æŒ£çš„é’±ç”šè‡³ä¸å¦‚åŒ—äº¬çš„1/3ã€1/4,æˆ‘æœ‰æ›´å¤šçš„æ—¶é—´åœ¨è‡ªå·±çš„çˆ±å¥½ä¸Šäº†.å½“ç„¶ä¹Ÿå¤±å»äº†å’Œå¾ˆå¤šä¼˜ç§€çš„æ°å‡ºçš„åŒäº‹ä¸€èµ·å·¥ä½œçš„æœºä¼š, æ¯ä¸ªäººéƒ½æœ‰é€‰æ‹©è‡ªå·±ç”Ÿæ´»çš„æ–¹å¼,ä¹Ÿè®¸è¿™å°±æ˜¯æˆ‘æ„šè ¢çš„é€‰æ‹©æ–¹å¼å§! å¸Œæœ›è‡ªå·±æŠŠä¸šä½™æ—¶é—´æ”¾åœ¨å­¦ä¹ å’Œçˆ±å¥½ä¸Š,ä¿æŒæŒç»­å­¦ä¹ çš„çƒ­æƒ…å’Œä¸æ–­æ›´æ–°åšå®¢å†™å‡ºæ›´å¤šä¼˜ç§€çš„æ–‡ç« .

åªæœ‰æ¥å—ä¸‰çº¿åŸå¸‚çš„å„ç§ä¸å¥½æ‰èƒ½ç­‰æ¥å®ƒå¸¦ç»™æˆ‘ä»¬çš„å¥½å§! æˆ‘è®¤ä¸ºè¿™æ˜¯è‡ªå·±å¯¹ç”Ÿæ´»çš„æ€åº¦å’Œé¢å¯¹é‚£äº›å›°éš¾çš„æŒ‘æˆ˜,è¿™ç§æŒ‘æˆ˜å°±æ˜¯é¢å¯¹ä¸åˆ©çš„å·¥ä½œç¯å¢ƒã€ä¸ä¼˜åšçš„å¾…é‡ã€ä¸å¤šçš„è–ªèµ„æ”¶å…¥ã€ä¸ç†æƒ³çš„èŒä¸šå‘å±•... çœ‹åˆ°è¿™çš„å°ä¼™ä¼´ç”šè‡³ä¼šå˜²ç¬‘æˆ‘çš„è¿™ç§æ¯«æ— è¿›å–çš„ç”Ÿæ´»æ€åº¦.æ˜¯çš„æˆ‘æ›´æ„¿æ„åšä¸€ä¸ªç›´é¢æƒ¨æ·¡äººç”Ÿçš„äºº.å‚åŠ å·¥ä½œçš„è¿™ä¹ˆå¤šå¹´è‡ªå·±ä¹Ÿä»ä¸€ä¸ªæ— çŸ¥å°ç™½æˆä¸ºæ— çŸ¥å¤§ç™½.è‡ªå·±çš„å­¦ä¹ å†ç¨‹å’Œå·¥ä½œç»å†è®©æˆ‘æˆé•¿ä¸ºä¸€ä¸ªæ„¿æ„æ¥å—æŒ‘æˆ˜çš„äºº.

åœ¨åŒ—äº¬æŒ£å¿«é’±çš„æ—¥å­åˆ°å¤´äº†,å›åˆ°äºŒä¸‰çº¿åŸå¸‚è¦é€‚åº”æŒ£æ…¢é’±çš„èŠ‚å¥æ‰èƒ½èµ°çš„æ›´è¿œ.åœ¨æ²¡æœ‰æ‰¾åˆ°æ›´æœ‰å‘å±•å‰æ™¯çš„èŒä¸šä¹‹å‰è¿™å°±æ˜¯æˆ‘ç›®å‰çš„è®¤çŸ¥å’Œæƒ³æ³•.æ€»ä¹‹è‡ªå·±ä¸æ˜¯é‚£ç§ç¢Œç¢Œæ— ä¸ºè¿˜è®¤ä¸ºè‡ªå·±å¹³å‡¡å¯è´µçš„äºº.æˆ‘ä¼šæ„Ÿåˆ°æ²¡æœ‰æˆå°±è€Œç¾è€».

åœ¨å¿«æ‰‹å·¥ä½œçš„æ—¶å€™æ‰“ç¾½æ¯›çƒè®¤è¯†äº†ä¸€ä½çƒå‹åŒäº‹ç¨‹æ³¢æ³¢,è¿™ä½æ¥è‡ªæ±Ÿè¥¿æ™¯å¾·é•‡æ¯•ä¸šäºæ¸…åå¤§å­¦çš„è€å“¥è®©æˆ‘çœ‹åˆ°äº†ä¸å¯»å¸¸çš„ä¸€é¢.æ¯æ¬¡çœ‹ä»–çš„æœ‹å‹åœˆæˆ‘éƒ½ä¼šè¯„è®ºä¸€å¥é£æ™¯çœŸå¥½,å› ä¸ºä»–æ€»åˆ©ç”¨å‘¨æœ«çš„æ—¶é—´å»æ—…è¡Œ,è®©æˆ‘æœ€æ·±åˆ»çš„æ˜¯ä»–çš„å›å¤,ä»–å›å¤è¯´:"**æ‰“å·¥äººè¦å­¦ä¼šè‡ªå¨±è‡ªä¹**". **æ‰“å·¥äººä¹Ÿå¯ä»¥æœ‰ç‚¹ä¹è¶£**.æ‰“å·¥äºº,è¿™å¥è¯é¼“åŠ±äº†æˆ‘çš„çµé­‚.

ä¹Ÿè®¸æˆ‘çš„ç¦»å¼€æµæ¼å‡ºäº†åŒ—æ¼‚äººå¿ƒé‡Œé¢æœ€æ·±åˆ»çš„ç—›,åœ¨è¿™é‡Œæˆ‘æƒ³å‹‰åŠ±ä¸€ä¸‹åŒ—æ¼‚çš„å„ä½,æˆ‘ä»¬æ‰€ä»äº‹çš„è¡Œä¸šæ˜¯ä¸€ä¸ªä¼Ÿå¤§çš„è¡Œä¸š,åªæœ‰ä¼˜ç§€çš„äººã€æ°å‡ºçš„äººã€è‚¯åŠªåŠ›çš„äººæ‰èƒ½å¤Ÿå‡ºå¤´.è®©æˆ‘ä»¬äº’ç›¸å‹‰åŠ±è®©è®¡ç®—æœºç§‘å­¦ä¸æŠ€æœ¯é¢†åŸŸå˜å¾—æ›´å¥½.

### ç››æ­Œ

å¹´å°‘ä¸å¬æå®—ç››ï¼Œå¬æ‡‚å·²æ˜¯ä¸æƒ‘å¹´. ä»–çš„æ­Œå£°ç»å¾—èµ·æ—¶å…‰çš„æ²‰æ·€,å”±å‡ºäº†æˆ‘å¿ƒç›®ä¸­çš„ç—›.

![](/assets/images/20201231FinalSummary/JonathanLee.webp)

å…¶å®æœ‰äº›æ­Œçš„æ­Œè¯å†™å¾—å¤ªçœŸå®åˆæœ‰è¯—æ„,è®©æˆ‘è¿™ä¸ªä¼ªæ­Œè¿·å¬çš„æ·±å…¥äººå¿ƒ.

* å¯‚å¯çš„æ‹äººå•Š
*  ä½ ä»¬
*  ä¼¤å¿ƒåœ°é“
*  æˆ‘æ˜¯çœŸçš„çˆ±ä½ 
*  é—®
* è¿œè¡Œ
* ä¸å¿…åœ¨ä¹æˆ‘æ˜¯è°

æå®—ç››çš„å£°éŸ³ä½æ²‰æœ‰åŠ›,å¹²è„†åˆ©ç´¢.ç¦»å¼€åŒ—äº¬æœ€åçš„ä¸€ä¸ªæœˆå‡ ä¹æ¯å¤©ä¸Šä¸‹ç­è·¯ä¸Šè¢«ä»–çš„éŸ³ä¹é¼“åŠ±ç€çµé­‚.

### æˆ‘è®¤ä¸ºçš„ä¼Ÿå¤§

æ›¾å‡ ä½•æ—¶"æ±‚çœŸåŠ¡å®,å®äº‹æ±‚æ˜¯ "æˆäº†è‡ªå·±çš„äººç”Ÿä¿¡æ¡.å¯æ˜¯è‡ªå·±ä»æœªåšè¿‡ä»»ä½•ä¼Ÿå¤§æœ‰æˆå°±çš„äº‹æƒ….ç¡ä¸ç€è§‰çš„æ—¶å€™ç»å¸¸æƒ³å½“è‡ªå·±çœŸçš„æœ‰ä¸€å¤©æš´å¯Œäº†è¯¥å¹²å•¥.æ˜¯è‚†æ„çš„çºµæƒ…æŒ¥éœè´¢å¯Œè¿˜æ˜¯é€‰æ‹©è¸å®çš„ç»§ç»­å·¥ä½œ,æœ€åå‘ç°è¿˜æ˜¯è¸å®çš„ç»§ç»­å·¥ä½œ,å¦åˆ™ç”Ÿæ´»å°†å¤±å»äº†æ„ä¹‰.å¦‚æœçœŸçš„èµ°ç‹—å±è¿æš´å¯Œäº†æˆäº†ç™¾ä¸‡å¯Œç¿ä¹Ÿè¦å»å¸®åŠ©ä¸€ä¸‹èº«è¾¹é‚£äº›äº²æˆšæœ‹å‹æˆ–å…„å¼Ÿå§å¦¹.å› ä¸ºä¼¼ä¹æŸç§æ„ä¹‰çš„ä¸Šæš´å¯Œæˆ–è€…æœ‰é’±æ„å‘³ç€è‡ªå·±è¦æœ‰èƒ½åŠ›é©¾é©­é‚£äº›è´¢å¯Œ,å¦åˆ™ä¹Ÿä¼šå› ä¸ºé©¾é©­ä¸äº†è¿™ä¹ˆå¤šè´¢å¯Œè€Œè†¨èƒ€è¿‡åº¦çš„å˜æˆä¸€æ— æ‰€æœ‰.å¦‚æœæ˜¯æˆ‘,æˆ‘å½“ç„¶å¯ä»¥é€‰æ‹©ä¹°å‡ å¥—æˆ¿ä½œä¸ºæŠ•èµ„,ä½†æ˜¯èº«è¾¹çš„å…„å¼Ÿå§å¦¹è¿æˆ¿å­è¿™äº›åŸºæœ¬çš„ç”Ÿæ´»è®¾æ–½éƒ½æ²¡æœ‰,ä½œä¸ºæœ‰é’±çš„ä½ è¢–æ‰‹æ—è§‚æˆ‘è®¤ä¸ºè¿™æ˜¯ä¸€ç§å¤±è´¥çš„äººç”Ÿæ´»æ³•.è¿™ç§çºµç„¶æœ‰é’±å´å¯¹ç¤¾ä¼šæ²¡æœ‰è´¡çŒ®çš„å¯Œæœ‰è¿‡äºç‹­éš˜.æå˜‰è¯šå°±æ˜¯å…¶ä¸­ä¹‹ä¸€.è¿™ç§è®¤çŸ¥çš„ä¼Ÿå¤§**ä»è€…è§ä»,æ™ºè€…è§æ™º**.

##### ä¸ºä»€ä¹ˆè¦åœ¨è¿™é‡Œè°ˆè®ºä¼Ÿå¤§?

å› ä¸ºå‘ç”Ÿåœ¨èº«è¾¹è¿™æ ·çœŸå®çš„æ•…äº‹å¤ªå¤šè¢«åˆºæ¿€äº†ç¥ç»,å¾ˆå¤šäººç¡®å®é©¾é©­ä¸äº†é‚£äº›åˆ«äººç»™äºˆçš„è´¢å¯Œæˆä¸ºæ‚²å‰§.è¿™æ˜¯ä¿ƒä½¿æˆ‘æ—¶åˆ»æé†’è‡ªå·±.**äººç”Ÿæœ€å¤§çš„æ‚²å‰§æ˜¯è‡ªå·±çš„å®åŠ›è¿˜é…ä¸ä¸Šè‡ªå·±çš„æ¢¦æƒ³,è¿˜è¦å»æ”€æ¯”**.å¸Œæœ›æ´»å‡ºçœŸå®çš„è‡ªå·±.

### ã€Šå­™äºšæ´²ç¬¬äºŒç†è®ºã€‹

åœ¨æˆ‘å¤§å­¦æ¯•ä¸šæ—¶æˆ‘ç»™è‡ªå·±ç«‹ä¸‹äº†ä¸‰ä¸ªç›®æ ‡:

* 1.**ä¸å•ƒè€**
* 2.**å…ˆèƒ½è‡ªç»™è‡ªè¶³è§£å†³æ¸©é¥±**
* 3.**å¦‚æœå‰ä¸¤ä¸ªå®ç°äº†,å†å»ç ”ç©¶å®ç°å‘å®¶è‡´å¯Œ**

ç»è¿‡7å¹´å¤šçš„å·¥ä½œå®è·µæˆ‘åœ¨è¿™é‡Œæ­£å¼å®£å¸ƒè¿™ä¸‰æ¡ç›®æ ‡å°†ä½œä¸ºè¡¡é‡ä¸€ä¸ªä¼˜ç§€å¤§å­¦æ¯•ä¸šç”Ÿè„±è´«è‡´å¯Œçš„æ ‡å‡†è§„èŒƒ.æˆ‘æŠŠè¿™å¥—æ–¹æ³•è®ºç§°ä¸º**ã€Šå­™äºšæ´²ç¬¬äºŒç†è®ºã€‹**,**ã€ŠThe 2nd Theory Of SunYazhouã€‹**.

> å¬å®Œæˆ‘çæ‰¯çš„ç†è®º,ä½ å­¦åºŸäº†å—?

### å¥½ç‰©

##### ä¹¦æ³•æ¡Œ

ç–«æƒ…æœŸé—´ä¹°äº†ä¸€å¥—åŒ—ç¾é»‘æ¡ƒæœ¨çš„[ä¹¦æ³•æ¡Œ](https://detail.tmall.com/item.htm?id=592669199819&spm=a1z09.2.0.0.248d2e8dpNMOm5&_u=v2qkte5648b&sku_properties=10187648:21959)ç”¨äºå­¦ä¹ .æˆ‘æ¯”è¾ƒå–œæ¬¢é‚£æŠŠå¤ªå¸ˆæ¤….åèµ·æ¥å¹¶ä¸èˆ’æœæ˜¯ä¸ºäº†æé†’è‡ªå·±ç”Ÿæ´»æ€»æ˜¯è¿™æ ·è®©æˆ‘ä»¬ä¸èˆ’æœ.  
![](/assets/images/20201231FinalSummary/tablesandchairs.webp)

å®æœ¨çš„å®¶å…·ä¼šæœ‰ç‚¹ç¨è´µ,å¤ªå¸ˆæ¤…+ä¹¦æ³•æ¡Œ å¤§æ¦‚èŠ±è´¹ ï¿¥5000+ RMB.

##### å¤§ä¼—ç¯å…‰å‡çº§

ç”±äºå»å¹´ä¹°äº†ä¸€è¾†ç ´è½¦,å¼€é«˜é€Ÿçš„æ—¶å€™å¤œæ™šç¯å…‰å¾ˆå·®åŠ²,å·®ç‚¹å‹å€’è½®èƒ,æ¯”è¾ƒå±é™©,æ‰€ä»¥å»ºè®®å¼€å¤§ä¼—è½¦çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹å‡çº§ä¸€ä¸‹ç¯å…‰,è¿™ç§å‡çº§æ˜¯å®Œå…¨ç¬¦åˆéªŒè½¦æ³•è§„çš„æ”¾å¿ƒ.[å¤§ä¼—æ°™æ°”ç¯å…‰å‡çº§](https://detail.tmall.com/item.htm?id=562699335539&spm=a1z09.2.0.0.248d2e8dCkJmgu&_u=v2qkte5851d&sku_properties=3986737:6070426;122216751:20213),æˆ‘å‡çº§äº†è¿›å£æµ·æ‹‰5é€é•œ,è¿™ç©æ„éå¸¸è´µ.è¿˜æœ‰æ¬§å¸æœ—é¡¶çº§D1s  6000Kè‰²æ¸©çš„æ°™æ°”ç¯æ³¡,ä»¥åŠæµ·æ‹‰4å®‰å®šå™¨.

![](/assets/images/20201231FinalSummary/autobulb.webp)

![](/assets/images/20201231FinalSummary/magotan1990.webp)

å‡çº§ç¯å…‰ç»å¯¹æ˜¯å‡ºäºä¸å¾—å·²ä¸ºä¹‹çš„æ“ä½œ,è¿™è¾†æˆ˜è½¦è™½ç„¶è€æ—§ä¸€äº›,ä¹Ÿé™ªæˆ‘ä¸¤æ¬¡å¾€è¿”è€å®¶å’ŒåŒ—äº¬.åœ¨é•¿è¾¾6000+å…¬é‡Œé›¶äº‹æ•…çš„å®‰å…¨é©¾é©¶åŒºé—´ç¡®å®æ²¡æœ‰æŠŠæˆ‘æ‰”åˆ°è·¯ä¸Šæˆ‘å¯¹æ­¤æ„Ÿåˆ°å¾ˆæ¬£æ…°.ä»Šå¹´äº”ä¸€æ¢äº†4åªé©¬ç‰Œè½®èƒ,å’Œä¸€ä¸ªmib 682Eçš„è½¦æœº,å¸Œæœ›å®ƒæœªæ¥ç…§é¡¾å¥½è¿™è¾†æˆ˜è½¦çš„ä¸»äºº.

#### æ‰«åœ°æœºå™¨äºº

è§£æ”¾åŒæ‰‹æ‰«åœ°ç¥å™¨,æˆ‘æ¯”è¾ƒè¾£ä¸æ„¿æ„æ‰“æ‰«å±‹å­,ä½œä¸ºçƒ­çˆ±3Cçš„ ç¨‹åºå‘˜æ¥è¯´,ä¸€ä¸ªç”µåŠ¨çš„æ‰«åœ°æœºå™¨äººå±…å®¶å¿…ä¸å¯å°‘.æ–¹ä¾¿æ‰“æ‰«æˆ¿é—´.

![](/assets/images/20201231FinalSummary/floormoppingrobot.webp)

### æ€»ç»“

ä»Šå¹´çš„å¹´ç»ˆæ€»ç»“å¹¶æ²¡æœ‰åƒå»å¹´ä¸€æ ·è®°å½•æµæ°´è´¦ä¸€æ ·,ä¹Ÿæ²¡æœ‰æåŠç”Ÿæ´»å’Œå­¦ä¹ ç›¸å…³,ä¸»è¦æ˜¯æƒ³æ¢æ¢æƒ³æ³•æ€è€ƒä¸€ä¸‹è¿™æ–‡ç« çš„æ•…äº‹æƒ…èŠ‚.æ›´æ²¡æœ‰æåŠè‡ªå·±çš„ç¬¬äºŒä¸ªäº”å¹´è®¡åˆ’è¿›è¡Œçš„æƒ…å†µ,æˆ‘æƒ³ç¬¬äºŒä¸ªäº”å¹´è®¡åˆ’æˆ‘ä»¬çœ‹ç»“æœ.

2020æˆ‘æœ€å¤§çš„æ”¶è·æ˜¯ç»“æŸäº†åŒ—æ¼‚é€‰æ‹©äº†è‡ªå·±æƒ³è¦çš„ç”Ÿæ´»,2021è¦åŠªåŠ›è¿ˆè¿›,å¹¸ç¦æ˜¯å¥‹æ–—å‡ºæ¥çš„,äº‰å–æ—©æ—¥å®ç°ç¬¬äºŒä¸ªäº”å¹´è®¡åˆ’.


URL: https://sunyazhou.com/2020/12/iOSsynchronousTimeWithServer/index.html.md
Published At: 2020-12-05 21:12:31 +0000

# è§£å†³iOSç³»ç»Ÿæ—¶é—´è¢«ä¿®æ”¹çš„é—®é¢˜

![](/assets/images/20201206iOSsynchronousTimeWithServer/iOSsynchronousTimeWithServerCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ¬æ–‡å°†ç”¨åˆ°çš„ç§‘æ™®çŸ¥è¯†å¦‚ä¸‹:

* GMT:(Greenwich Mean Time)æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ã€‚è¿™æ˜¯ä»¥è‹±å›½æ ¼æ—å°¼æ²»å¤©æ–‡å°è§‚æµ‹ç»“æœå¾—å‡ºçš„æ—¶é—´ï¼Œè¿™æ˜¯è‹±å›½æ ¼æ—å°¼æ²»å½“åœ°æ—¶é—´ï¼Œè¿™ä¸ªåœ°æ–¹çš„å½“åœ°æ—¶é—´è¿‡å»è¢«å½“æˆä¸–ç•Œæ ‡å‡†çš„æ—¶é—´ã€‚  
* UT:(Universal Time)ä¸–ç•Œæ—¶ã€‚æ ¹æ®[åŸå­é’Ÿ](https://baike.baidu.com/item/%E5%8E%9F%E5%AD%90%E9%92%9F/765460)è®¡ç®—å‡ºæ¥çš„æ—¶é—´
* UTC:(Coordinated Universal Time)å¤ªé˜³æ‰€å¤„çš„ä½ç½®å˜åŒ–è·Ÿåœ°çƒçš„è‡ªè½¬ç›¸å…³ï¼Œè¿‡å»äººä»¬è®¤ä¸ºåœ°çƒè‡ªè½¬çš„é€Ÿç‡æ˜¯æ’å®šçš„ï¼Œä½†åœ¨1960å¹´è¿™ä¸€è®¤çŸ¥è¢«æ¨ç¿»äº†ï¼Œäººä»¬å‘ç°åœ°çƒè‡ªè½¬çš„é€Ÿç‡æ­£å˜å¾—è¶Šæ¥è¶Šæ…¢ï¼Œè€Œæ—¶é—´å‰è¿›çš„é€Ÿç‡è¿˜æ˜¯æ’å®šçš„ï¼Œæ‰€ä»¥UTCä¸å†è¢«è®¤ä¸ºå¯ä»¥ç”¨æ¥ç²¾å‡†çš„æè¿°æ—¶é—´äº†ã€‚æˆ‘ä»¬éœ€è¦ç»§ç»­å¯»æ‰¾ä¸€ä¸ªåŒ€é€Ÿå‰è¿›çš„å€¼ã€‚æŠ¬å¤´çœ‹å¤©æ˜¯æˆ‘ä»¬ä»å®è§‚æ–¹å‘å»å¯»æ‰¾ç­”æ¡ˆï¼Œç§‘æŠ€çš„å‘å±•è®©æˆ‘ä»¬åœ¨å¾®è§‚æ–¹é¢å–å¾—äº†æ›´æ·±çš„è®¤è¯†ï¼Œäºæ˜¯æœ‰èªæ˜äººæ ¹æ®å¾®è§‚ç²’å­åŸå­çš„ç‰©ç†å±æ€§ï¼Œå»ºç«‹äº†åŸå­é’Ÿï¼Œä»¥è¿™ç§åŸå­é’Ÿæ¥è¡¡é‡æ—¶é—´çš„å˜åŒ–ï¼ŒåŸå­é’Ÿ50äº¿å¹´æ‰ä¼šè¯¯å·®1ç§’ï¼Œè¿™ç§ç²¾è¯»å·²ç»è¿œèƒœäºGMTäº†ã€‚è¿™ä¸ªåŸå­é’Ÿæ‰€åæ˜ çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç°åœ¨æ‰€ä½¿ç”¨çš„UTCï¼ˆCoordinated Universal Time ï¼‰æ ‡å‡†æ—¶é—´ã€‚

ä¸Šè¿°æ‘˜è‡ª: [iOSå…³äºæ—¶é—´çš„å¤„ç†](https://mp.weixin.qq.com/s/cSZUNMuqk6DL3-nctyxzcw?)  


## åœºæ™¯æè¿°

æœ€è¿‘å¼€å‘è¿‡ç¨‹ä¸­QAåŒå­¦æäº†ä¸€ä¸ªbug, å½“æ‰‹æœºæ—¥æœŸæ—¶é—´ä¿®æ”¹å å‘ç°é¡µé¢æ—¶é—´æ˜¾ç¤ºå¼‚å¸¸, è¿™ç§é—®é¢˜éå¸¸ç»å…¸, ä¹Ÿå°±æ˜¯**iOSå…³äºæ—¶é—´çš„å¤„ç†**.

## æˆ‘ä»¬å¯¹æ—¶é—´çš„è®¤è¯†

**æ—¶é—´æ˜¯çº¿æ€§çš„**,å³ä»»æ„ä¸€ä¸ªæ—¶åˆ»ï¼Œè¿™ä¸ªåœ°çƒä¸Šåªæœ‰ä¸€ä¸ªç»å¯¹æ—¶é—´å€¼å­˜åœ¨ï¼Œåªä¸è¿‡å› ä¸ºæ—¶åŒºæˆ–è€…æ–‡åŒ–çš„å·®å¼‚ï¼Œå¤„äºåŒä¸€æ—¶ç©ºçš„æˆ‘ä»¬å¯¹åŒä¸€æ—¶é—´çš„è¡¨è¿°æˆ–è€…ç†è§£ä¸åŒã€‚æ¯”å¦‚ï¼ŒåŒ—äº¬çš„20ï¼š00å’Œä¸œäº¬çš„21ï¼š00å…¶å®æ˜¯åŒä¸€ä¸ªç»å¯¹çš„æ—¶é—´å€¼ã€‚ 

> å¯ä»¥ç†è§£ä¸º ä»¥ä¸€ä¸ªæ ‡å‡†ç‚¹ä½œä¸ºæ ‡å‡†ç‚¹.é€šè¿‡æ—¶åŒºå¾®è°ƒ æ¥å®ç°å…¨çƒå„ä¸ªå›½å®¶çš„æ—¥æœŸæ˜¾ç¤º.

## iOSå‡ ç§è·å–æ—¶é—´çš„æ–¹å¼

#### 1.NSDate   

ä»£ç å®ç°

``` objc
- (void)timeIntervalSinceReferenceDate {
    NSDate *date = [NSDate date];
    NSLog(@"date = %lf", date.timeIntervalSinceReferenceDate);
}

```

`NSDate`å¯¹è±¡å°è£…å•ä¸ªæ—¶é—´ç‚¹,ä¸ä»»ä½•ç‰¹å®šçš„æ—¥å†ç³»ç»Ÿæˆ–æ—¶åŒºæ— å…³.æ—¥æœŸå¯¹è±¡æ˜¯ä¸å¯å˜çš„,è¡¨ç¤ºç›¸å¯¹äºç»å¯¹å‚è€ƒæ—¥æœŸï¼ˆ`2001å¹´1æœˆ1æ—¥00:00:00 UTC`ï¼‰çš„ä¸å˜æ—¶é—´é—´éš”ï¼Œå®ƒæ˜¯ä»¥UTCä¸ºæ ‡å‡†çš„ã€‚

NSDateè¾“å‡ºç»“æœ:  

``` sh
2020-12-06 12:28:55.795929+0800 ZGTimeDemo[12177:134289] date = 628921735.795845
```

ä¸‹é¢è®¡ç®—ä¸€ä¸‹ï¼š628921735.795845/365/86400 = 19.942977ï¼Œä»Šå¹´æ˜¯2020å¹´ï¼Œè·ç¦»2001å¹´æ­£å¥½æ˜¯19å¹´.

å¦‚æœæˆ‘ä»¬ç›´æ¥æ‰“å°NSDate

``` objc
NSDate *date = [NSDate date];
NSLog(@"%@",date);
```

åˆ™ä¼šè¾“å‡º

``` sh
2020-12-06 06:51:04 +0000
```

å¯è§NSDateè¾“å‡ºçš„æ˜¯ç»å¯¹çš„UTCæ—¶é—´ï¼Œè€ŒåŒ—äº¬æ—¶é—´çš„æ—¶åŒºä¸ºUTC+8ï¼Œä¸Šé¢çš„è¾“å‡º+8ä¸ªå°æ—¶ï¼Œåˆšå¥½å°±æ˜¯æˆ‘å½“å‰çš„æ—¶é—´äº†ã€‚æ‰€ä»¥æ­£å¸¸`UTC + æ—¶åŒº`æ‰æ˜¯çœŸæ­£çš„æ—¶é—´æ—¥æœŸ. è‡³äºæ—¶åŒºåŠ å‡è¯·å‚è€ƒä¸‹å›¾. 

![](/assets/images/20201206iOSsynchronousTimeWithServer/iOSsynchronousTimeWithServerZone.webp)


 **æ³¨æ„: NSDateæ˜¯å—æ‰‹æœºç³»ç»Ÿæ—¶é—´æ§åˆ¶çš„,å½“ä½ ä¿®æ”¹äº†æ‰‹æœºä¸Šçš„æ—¶é—´æ˜¾ç¤ºï¼ŒNSDateè·å–å½“å‰æ—¶é—´çš„è¾“å‡ºä¹Ÿä¼šéšä¹‹æ”¹å˜ã€‚åœ¨æˆ‘ä»¬åšAppçš„æ—¶å€™ï¼Œæ˜ç™½è¿™ä¸€ç‚¹ï¼Œå°±çŸ¥é“NSDateå¹¶ä¸å¯é ï¼Œå› ä¸ºç”¨æˆ·å¯èƒ½ä¼šä¿®æ”¹å®ƒçš„å€¼**.
 
#### 2.å‡½æ•°CFAbsoluteTimeGetCurrent()
 
 > å®˜æ–¹æ–‡æ¡£: ç»å¯¹æ—¶é—´æ˜¯ç›¸å¯¹äºç»å¯¹å‚è€ƒæ—¥æœŸ(æ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´2001å¹´1æœˆ1æ—¥00æ—¶00åˆ†)ä»¥ç§’è®¡ç®—çš„ã€‚æ­£å€¼è¡¨ç¤ºå¼•ç”¨æ—¥æœŸä¹‹åçš„æ—¥æœŸï¼Œè´Ÿå€¼è¡¨ç¤ºå¼•ç”¨æ—¥æœŸä¹‹å‰çš„æ—¥æœŸã€‚ä¾‹å¦‚ï¼Œç»å¯¹æ—¶é—´-32940326ç›¸å½“äº1999å¹´12æœˆ16æ—¥17:54:34ã€‚é‡å¤è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¸èƒ½ä¿è¯å•è°ƒé€’å¢çš„ç»“æœã€‚ç³»ç»Ÿæ—¶é—´å¯èƒ½ç”±äºä¸å¤–éƒ¨æ—¶é—´å¼•ç”¨åŒæ­¥æˆ–ç”±äºæ˜¾å¼çš„ç”¨æˆ·æ›´æ”¹æ—¶é’Ÿè€Œå‡å°‘ã€‚
 
`CFAbsoluteTimeGetCurrent()`çš„æ¦‚å¿µå’ŒNSDateéå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡å‚è€ƒç‚¹æ˜¯ï¼šä»¥GMTä¸ºæ ‡å‡†çš„ï¼Œ2001å¹´ä¸€æœˆä¸€æ—¥00ï¼š00ï¼š00è¿™ä¸€åˆ»çš„æ—¶é—´ç»å¯¹å€¼ã€‚

**æ³¨æ„:CFAbsoluteTimeGetCurrent()ä¹Ÿä¼šè·Ÿç€å½“å‰è®¾å¤‡çš„ç³»ç»Ÿæ—¶é—´ä¸€èµ·å˜åŒ–,ä¹Ÿå¯èƒ½ä¼šè¢«ç”¨æˆ·ä¿®æ”¹.**


#### 3.`gettimeofday()`

``` objc
int gettimeofday(struct timeval * __restrict, void * __restrict);
```
è¿™ä¸ªå‡½æ•°è·å–çš„æ˜¯UNIX time.

``` objc
struct timeval now;
struct timezone tz;
gettimeofday(&now, &tz);
NSLog(@"gettimeofday: %ld", now.tv_sec);
```

``` sh
gettimeofday: 1607238723
```

##### UNIX timeåˆæ˜¯ä»€ä¹ˆå‘¢?

Unix timeæ˜¯ä»¥UTC 1970å¹´1æœˆ1å· 00ï¼š00ï¼š00ä¸ºåŸºå‡†æ—¶é—´ï¼Œå½“å‰æ—¶é—´è·ç¦»åŸºå‡†ç‚¹åç§»çš„ç§’æ•°ã€‚ä¸Šè¿°APIè¿”å›çš„å€¼æ˜¯1607238723ï¼Œè¡¨ç¤ºå½“å‰æ—¶é—´è·ç¦»UTC 1970å¹´1æœˆ1å· 00ï¼š00ï¼š00ä¸€å…±è¿‡äº†1607238723ç§’ã€‚

`Unix time`ä¹Ÿæ˜¯å¹³æ—¶æˆ‘ä»¬ä½¿ç”¨è¾ƒå¤šçš„ä¸€ä¸ªæ—¶é—´æ ‡å‡†ï¼Œåœ¨Macçš„ç»ˆç«¯å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è½¬æ¢æˆå¯é˜…è¯»çš„æ—¶é—´ï¼š

``` sh
date -r 1607238723
```

è¾“å‡º

``` sh
2020å¹´12æœˆ 6æ—¥ æ˜ŸæœŸæ—¥ 15æ—¶12åˆ†03ç§’ CST
```

**æ³¨æ„:`gettimeofday()`,`NSDate`,`CFAbsoluteTimeGetCurrent`è¿™ä¸‰ä¸ªéƒ½æ˜¯å—å½“å‰è®¾å¤‡çš„ç³»ç»Ÿæ—¶é—´å½±å“.åªä¸è¿‡æ˜¯å‚è€ƒçš„æ—¶é—´åŸºå‡†ç‚¹ä¸ä¸€æ ·è€Œå·²ã€‚æˆ‘ä»¬å’ŒæœåŠ¡å™¨é€šè®¯çš„æ—¶å€™ä¸€èˆ¬ä½¿ç”¨NIX time.**


#### 5.`mach_absolute_time()`

åœ¨æˆ‘ä»¬çš„iPhoneä¸Šåˆšå¥½æœ‰ä¸€ä¸ªè¿™æ ·çš„å€¼å­˜åœ¨,å®ƒå°±æ˜¯CPUçš„æ—¶é’Ÿå‘¨æœŸæ•°(ticks),è¿™ä¸ª`tick`çš„æ•°å€¼å¯ä»¥ç”¨æ¥æè¿°æ—¶é—´,è€Œ`mach_absolute_time()`è¿”å›çš„å°±æ˜¯CPUå·²ç»è¿è¡Œçš„`tick`çš„æ•°é‡ã€‚å°†è¿™ä¸ª`tick`æ•°ç»è¿‡ä¸€å®šçš„è½¬æ¢å°±å¯ä»¥å˜æˆç§’æ•°,æˆ–è€…çº³ç§’æ•°.è¿™æ ·å°±å’Œæ—¶é—´ç›´æ¥å…³è”äº†.ä¸è¿‡è¿™ä¸ª`tick`æ•°,åœ¨æ¯æ¬¡æ‰‹æœºé‡å¯ä¹‹å,ä¼šé‡æ–°å¼€å§‹è®¡æ•°,è€Œä¸”iPhoneé”å±è¿›å…¥ä¼‘çœ ä¹‹å`tick`ä¹Ÿä¼šæš‚åœè®¡æ•°.

**æ³¨æ„: `mach_absolute_time()`ä¸ä¼šå—ç³»ç»Ÿæ—¶é—´å½±å“,åªå—è®¾å¤‡é‡å¯å’Œä¼‘çœ è¡Œä¸ºå½±å“**

#### 6.`CACurrentMediaTime()`

`CACurrentMediaTime()`å°±æ˜¯å°†ä¸Šé¢`mach_absolute_time()`çš„CPU`tick`æ•°è½¬åŒ–æˆç§’æ•°çš„ç»“æœã€‚ä»¥ä¸‹ä»£ç ï¼š

``` objc
double mediaTime = CACurrentMediaTime();
NSLog(@"CACurrentMediaTime: %f", mediaTime);
```

``` sh
2020-12-06 15:34:59.808799+0800 ZGTimeDemo[19731:281283] CACurrentMediaTime: 17789.582767
```
è¿”å›çš„å°±æ˜¯å¼€æœºåè®¾å¤‡ä¸€å…±è¿è¡Œäº†(è®¾å¤‡ä¼‘çœ ä¸ç»Ÿè®¡åœ¨å†…)å¤šå°‘ç§’.

è¿™ä¸ªAPIç­‰åŒäºä¸‹é¢ä»£ç :

``` objc
NSTimeInterval systemUptime = [[NSProcessInfo processInfo] systemUptime];
```

**æ³¨æ„:`CACurrentMediaTime()`ä¹Ÿä¸ä¼šå—ç³»ç»Ÿæ—¶é—´å½±å“,åªå—è®¾å¤‡é‡å¯å’Œä¼‘çœ è¡Œä¸ºå½±å“.**

#### 7.sysctl()

iOSç³»ç»Ÿè¿˜è®°å½•äº†ä¸Šæ¬¡è®¾å¤‡é‡å¯çš„æ—¶é—´ã€‚å¯ä»¥é€šè¿‡å¦‚ä¸‹APIè°ƒç”¨è·å–:

``` objc
#include <sys/sysctl.h>
- (long)bootTime
{
#define MIB_SIZE 2
    int mib[MIB_SIZE];
    size_t size;    
    struct timeval  boottime;

    mib[0] = CTL_KERN;
    mib[1] = KERN_BOOTTIME;
    size = sizeof(boottime);    
    if (sysctl(mib, MIB_SIZE, &boottime, &size, NULL, 0) != -1)
    {        
        return boottime.tv_sec;
    }    
    return 0;
}
```
è¿”å›çš„å€¼æ˜¯ä¸Šæ¬¡è®¾å¤‡é‡å¯çš„Unix timeã€‚

**æ³¨æ„:è¿™ä¸ªAPIè¿”å›çš„å€¼ä¹Ÿä¼šå—ç³»ç»Ÿæ—¶é—´å½±å“ï¼Œç”¨æˆ·å¦‚æœä¿®æ”¹æ—¶é—´ï¼Œå€¼ä¹Ÿä¼šéšç€å˜åŒ–.**

## å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ—¶é—´åŒæ­¥

ä¸€èˆ¬æˆ‘ä»¬å‘èµ·è¯·æ±‚çš„æ—¶å€™éƒ½æ˜¯åœ¨å…¬å‚ä¸­å¸¦ä¸Šæœ¬åœ°æ—¶é—´,å¦‚æœæœ‰ä¸€äº›æ¯”è¾ƒæ•æ„Ÿçš„æ¥å£ä¼šé‡åˆ°ç”¨æˆ·æ›´æ”¹ç³»ç»Ÿæ—¶é—´çš„å¼‚å¸¸caseå¯¼è‡´å¼‚å¸¸.ä¸ºäº†é˜²æ­¢ç”¨æˆ·é€šè¿‡æ–­ç½‘ä¿®æ”¹ç³»ç»Ÿæ—¶é—´,æ¥å½±å“å®¢æˆ·ç«¯çš„é€»è¾‘æˆ‘ä»¬é€šå¸¸éƒ½è¿™æ ·åš.

* è·å–æœåŠ¡å™¨æŸä¸€æ—¶åˆ»`A`çš„æ—¶é—´;
* è®°å½•è·å–åˆ°æ—¶åˆ»`A`æ—¶çš„æœ¬åœ°æ—¶é—´`B`;
* éœ€è¦ç”¨åˆ°æ—¶é—´æ—¶,è·å–å½“å‰æœ¬åœ°æ—¶é—´`C`,å½“`C`-`B`ä½œä¸ºæ—¶é—´é—´éš”`D`,åˆ™`A` + `D` åˆ™æ˜¯å½“å‰æœåŠ¡å™¨çš„æ—¶é—´.


è¿™é‡Œè¦å‡†ç¡®åšåˆ°å®¢æˆ·ç«¯æ—¶é—´å’ŒæœåŠ¡å™¨æ—¶é—´ä¸€è‡´,å¾ˆå…³é”®çš„é—®é¢˜å°±æ˜¯`B`å’Œ`C`ä¸èƒ½å—ç³»ç»Ÿæ—¶é—´çš„å½±å“,è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¦ä¾é iOSçš„æ¥å£--**ç³»ç»Ÿè¿è¡Œæ—¶é—´**

é¦–å…ˆ: æˆ‘ä»¬è¦ä¾é æœåŠ¡ç«¯ç»™ä¸€ä¸ªå‡†ç¡®çš„æ—¶é—´æˆ³.æ¯æ¬¡åŒæ­¥è®°å½•ä¸€ä¸ªå¾—åˆ°æœåŠ¡ç«¯æ—¶é—´æˆ³B.æˆ‘ä»¬å°±æ˜¯è¦ç”¨è¿è¡Œçš„æ—¶é—´å·®æ¥è§£å†³æ—¶é—´æ ¡æ—¶é—®é¢˜.

è·å–ç³»ç»Ÿå½“å‰è¿è¡Œäº†å¤šé•¿æ—¶é—´æ–¹æ³•:

``` objc
//get system uptime since last boot
- (NSTimeInterval)uptime
{    
    struct timeval boottime;    
    int mib[2] = {CTL_KERN, KERN_BOOTTIME};
    size_t size = sizeof(boottime);    
    struct timeval now;   
    struct timezone tz;
    gettimeofday(&now, &tz);   
    double uptime = -1;   
    if (sysctl(mib, 2, &boottime, &size, NULL, 0) != -1 && boottime.tv_sec != 0)
    {
        uptime = now.tv_sec - boottime.tv_sec;
        uptime += (double)(now.tv_usec - boottime.tv_usec) / 1000000.0;
    }   
    return uptime;
}
```

**æ³¨æ„:è¿™ä¸ªå‡½æ•°è¿”å›çš„æ˜¯ç§’.å’Œserverè¿”å›çš„unix timeå¯èƒ½è¦ä¹˜ä»¥1000**.(1s = 1000ms)

`gettimeofday()`å’Œ`sysctl()`éƒ½ä¼šå—ç³»ç»Ÿæ—¶é—´å½±å“,ä½†ä»–ä»¬äºŒè€…åšä¸€ä¸ªå‡æ³•æ‰€å¾—çš„å€¼,å°±å’Œç³»ç»Ÿæ—¶é—´æ— å…³äº†.è¿™æ ·å°±å¯ä»¥é¿å…ç”¨æˆ·ä¿®æ”¹æ—¶é—´äº†ã€‚å½“ç„¶ç”¨æˆ·å¦‚æœå…³æœº,è¿‡æ®µæ—¶é—´å†å¼€æœº,ä¼šå¯¼è‡´æˆ‘ä»¬è·å–åˆ°çš„æ—¶é—´æ…¢ä¸æœåŠ¡å™¨æ—¶é—´,çœŸå®åœºæ™¯ä¸­,æ…¢äºæœåŠ¡å™¨æ—¶é—´å¾€å¾€å½±å“è¾ƒå°,æˆ‘ä»¬ä¸€èˆ¬æ‹…å¿ƒçš„æ˜¯å®¢æˆ·ç«¯æ—¶é—´å¿«äºæœåŠ¡å™¨æ—¶é—´.

ä»¥ä¸‹è¿™æ®µä»£ç ä¹Ÿå¯ä»¥åšåˆ°ä¸è¢«ä¿®æ”¹`local_absolute_n_clock ()`è¿”å›ç§’

``` c++
namespace
{
    mach_timebase_info_data_t init_mach_timebase_info()
    {
        mach_timebase_info_data_t info;
        mach_timebase_info(&info);
        return info;
    }
}

int64_t CTimestamp::local_absolute_n_clock()
{
    static mach_timebase_info_data_t sTimebaseInfo = init_mach_timebase_info();
    int64_t t = mach_absolute_time();
    return t * sTimebaseInfo.numer / sTimebaseInfo.denom;
}
CTimestamp::CTimestamp()
{
    m_base_tm = time(0)*(1000*1000*1000);
    m_base_clock = local_absolute_n_clock();
}

```

# æ€»ç»“

æœ¬ç¯‡é—®é¢˜çš„è§£å†³éš¾ç‚¹çš„å…³é”®åœ¨äºå¦‚æœè·å–æœ¬åœ°çš„æ—¶é—´,æˆ‘ä»¬è¿™é‡Œå–çš„æ˜¯`ç³»ç»Ÿè¿è¡Œæ—¶é—´è¿›è¡Œçš„å·®å€¼è®¡ç®—æ³•`.æˆ‘æ²¡æœ‰å°è¯•è¿‡ ä¼‘çœ  é€€åå°ç­‰é€»è¾‘æ¶ˆè€—çš„æ—¶é•¿.ä½†æ˜¯æˆ‘è®¤ä¸ºå¦‚æœè¦åšå¥½å·¥å…·ç±»,è¦å°è¯•è®¡ç®—åå°æ¶ˆè€—çš„æ—¶é—´è®¡æ—¶æ—¶é•¿,å¯ä»¥ä¹Ÿå¯ä»¥é€šè¿‡ç³»ç»Ÿè¿è¡Œæ—¶é—´çš„å·®å€¼è¿ç®—å¾—åˆ°å‡†ç¡®çš„æ—¶é—´.


æœ¬ç¯‡é‡ç‚¹:  ABCDåŒæ­¥æ—¶é—´ç®—æ³• ä¸»è¦ä¾èµ–äºæœåŠ¡ç«¯ç»™çš„æ—¶é—´ä½œä¸ºåŸºå‡†ç‚¹. å¦ä¸€ä¸ªéš¾ç‚¹æ€ä¹ˆè·å–ç³»ç»Ÿè¿è¡Œæ—¶é—´åšå·®å€¼è®¡ç®— æ¥è§£å†³ç³»ç»Ÿæ—¶é—´è¢«ç”¨æˆ·ä¿®æ”¹åæ—¶é—´ä¸å‡†çš„é—®é¢˜. ç¡¬æ ¸ä»£ç  å¹¶æ²¡æœ‰å†™æˆç›¸å…³å·¥å…·ç±»,å°ä¼™ä¼´ä»¬å¯ä»¥è‡ªè¡Œå®ç°æ¯”è¾ƒç®€å•æˆ‘å°±ä¸å†™demoäº†.æœ¬ç¯‡æ–‡ç« ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡åˆ‡æ¢åˆ°jekyll ç¬¬ä¸€æ¬¡å‘å¸ƒæ–‡ç« ,å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©å¯ä»¥æ”¶è—


å‚è€ƒ:

[iOSå…³äºæ—¶é—´çš„å¤„ç†](https://mp.weixin.qq.com/s/cSZUNMuqk6DL3-nctyxzcw?)  
[å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„æ—¶é—´åŒæ­¥é—®é¢˜è§£å†³](https://www.jianshu.com/p/61e6385f8cf6)



URL: https://sunyazhou.com/2020/10/WebviewSystemLanguage/index.html.md
Published At: 2020-10-27 13:57:30 +0000

# è§£å†³iOSè°ƒç”¨ç³»ç»Ÿç›¸å†Œä¸æ˜¾ç¤ºä¸­æ–‡é—®é¢˜

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ€è¿‘å¼€å‘é‡åˆ°ä¸€ä¸ªbug,åœ¨h5ä¸­ç‚¹å‡»é€‰æ‹©iOSç³»ç»Ÿç›¸å†Œ,æ˜¾ç¤ºçš„æ˜¯è‹±æ–‡çš„

![](/assets/images/2020107WebviewSystemLanguage/WebviewSystemLanguage1.webp)


## è§£å†³æ–¹å¼ 

åœ¨Xcodeçš„plistä¸­åŠ å…¥å¦‚ä¸‹ä»£ç 

``` xml
<key>CFBundleAllowMixedLocalizations</key>
<true/>
```

ä¹Ÿå¯ä»¥ åœ¨ info.plisté‡Œé¢æ·»åŠ `Localized resources can be mixed` `YES`è¡¨ç¤ºæ˜¯å¦å…è®¸åº”ç”¨ç¨‹åºè·å–æ¡†æ¶åº“å†…è¯­è¨€ã€‚

![](/assets/images/2020107WebviewSystemLanguage/WebviewSystemLanguage2.webp)


ç„¶åè¿è¡Œæ•ˆæœ:

![](/assets/images/2020107WebviewSystemLanguage/WebviewSystemLanguage3.webp)

# æ€»ç»“

æ„Ÿè°¢å¤§å®¶è§‚çœ‹ åˆ°ä½æŒ æŒ äº†


URL: https://sunyazhou.com/2020/10/XcodeSourceEditorNotWork/index.html.md
Published At: 2020-10-16 16:05:42 +0000

# ä¿®å¤Xcode Source Editoråœ¨masOSçš„æ‰©å±•ä¸­ä¸æ˜¾ç¤º

![](/assets/images/20201016XcodeSourceEditorNotWork/XcodeSourceEditorCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## é—®é¢˜æè¿°

è¿™å‡ å¤©è¦å¯¹ä»£ç è¿›è¡Œå¯¹é½å‘ç°ç»å¸¸ç”¨çš„ XAlignæ’ä»¶ä¸èµ·ä½œç”¨äº†,ä¸€çœ‹è®¾ç½®ä¸­å‘ç° æ‰©å±•ä¸­æ²¡æœ‰äº†Xcode Source Editor
![](/assets/images/20201016XcodeSourceEditorNotWork/XcodeSourceEditor.webp)

é€šè¿‡ç½‘ç»œä¸ŠæŸ¥è¯¢æ‰¾åˆ°ä¸€ç¯‡é è°±çš„æ–¹å¼ ç‰¹è®°å½•ä¸‹æ¥

ç»ˆç«¯è¾“å…¥å¦‚ä¸‹ å³å¯å‡ºæ¥

``` sh
$ PATH=/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support:"$PATH"
$ lsregister -f /Applications/Xcode.app
```

å¼•èµ·çš„åŸå› 

å½“Xcodeçš„å¤šä¸ªå‰¯æœ¬åœ¨åŒä¸€å°æœºå™¨ä¸Šæ—¶ï¼Œæ‰©å±•å¯èƒ½ä¼šå®Œå…¨åœæ­¢å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒApple Developer Relationså»ºè®®é‡æ–°æ³¨å†Œä½ çš„Xcodeä¸»æ‹·è´åˆ°Launch Services(æœ€ç®€å•çš„æ–¹æ³•æ˜¯æš‚æ—¶å°†lsregisterçš„ä½ç½®å…ˆæ·»åŠ åˆ°PATHä¸­):

å‚è€ƒ [https://nshipster.com/xcode-source-extensions/](https://nshipster.com/xcode-source-extensions/)


# æ€»ç»“

è®°å½•ç»å¸¸é‡åˆ°çš„é—®é¢˜.


URL: https://sunyazhou.com/2020/10/PodSpec/index.html.md
Published At: 2020-10-10 07:52:18 +0000

# Pod specé›†æˆç¬¬ä¸‰frameworkå’Œ.aå·¥ä½œè®°å½•

![](/assets/images/20201010PodSpec/cocoapods.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


æœ€è¿‘å¼€å‘è¿‡ç¨‹ç»å¸¸é‡åˆ°å·¥ç¨‹ä¸­é›†æˆç¬¬ä¸‰æ–¹å·¥ç¨‹ä¸­çš„æ—¶å€™ ä½¿ç”¨podçš„æ–¹å¼é›†æˆ.æ€»å¿˜è®°é“¾æ¥ ç¬¬ä¸‰æ–¹åº“çš„æ–¹å¼å’Œpodspecçš„å†™æ³•.æ‰€ä»¥è®°å½•ä¸‹æ¥å®¹æ˜“å¿˜è®°çš„å†…å®¹


## podspec åˆ›å»º

æˆ‘ä»¬åœ¨æµ‹è¯•å·¥ç¨‹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½• èµ·åå« demoframeworks ç„¶ååœ¨è¿™ä¸ªç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹:

``` sh
pod spec create specåç§°
```
> `specåç§°` è‡ªå·±èµ·ä¸ªåå­—å“ˆ

æœ¬åœ°ä¼šç”Ÿæˆä¸€ä¸ªspecæ¨¡æ¿
ç„¶åç”¨æ–‡æœ¬ç¼–è¾‘å™¨ç¼–è¯‘ä¸€ä¸‹specæ–‡ä»¶,è¿™é‡Œæˆ‘ä»¬æ‹¿å£°ç½‘çš„sdkä¸¾ä¾‹.

``` ruby
Pod::Spec.new do |spec|
  spec.name         = "specdemo"
  spec.version      = "0.0.1"
  spec.summary      = "test pod spec"
  spec.description  = "demo testæµ‹è¯•"

  spec.homepage     = "https://www.sunyazhou.com/"
  spec.license      = "MIT"
  spec.author             = { "æ±å¼•ç”Œè¶Š" => "https://www.sunyazhou.com/" }
  spec.source       = { :git => "git@gitee.com:sunyazhou/sunyazhou13.github.io-images.git"}
  #åŠ è½½ç¬¬ä¸‰æ–¹frameworkå†™æ³•
  spec.vendored_frameworks = 'AgoraRtcCryptoLoader.framework','AgoraRtcEngineKit.framework','AgoraRtmKit.framework','AgoraSigKit.framework'
  #åŠ è½½ç¬¬ä¸‰æ–¹.a
  #spec.vendored_libraries = 'libProj4.a', 'libJavaScriptCore.a'
  #ç³»ç»Ÿå†…ç½®åŠ¨æ€åº“çš„ä¾èµ–
  spec.frameworks = 'Photos','PhotosUI','CoreMedia','Foundation','CoreGraphics','CoreMotion','QuartzCore','MobileCoreServices','Security','CoreText','VideoToolbox','CoreTelephony','AudioToolbox','SystemConfiguration','AVFoundation', 'CoreLocation','AdSupport','OpenGLES','CoreML'
  #å†…ç½®é™æ€åº“çš„ä¾èµ–
  spec.libraries = "iconv", "c++", "z.1.1.3" ,"z","resolv" ,"sqlite3","icucore","z.1.2.5"  
end

```
ç„¶ååœ¨Podfileå†…å®¹é‡Œé¢æ·»åŠ 

``` sh
target 'PodSpecDemo' do
  # Comment the next line if you don't want to use dynamic frameworks
  use_frameworks!

  # æ·»åŠ è¿™è¡Œ
  pod 'specdemo', :path=>'./demoframeworks'
end
```

æ³¨æ„è¿™é‡Œçš„`specdemo`æ˜¯æˆ‘ä»¬ç»™é›†æˆæœ¬åœ°podèµ·çš„åå­— æœ€å¥½å’Œåˆ›å»ºçš„specåå­—ä¿æŒä¸€è‡´.

ç„¶å pod install

æœ€åå·¥ç¨‹å°±å˜æˆäº†æˆ‘ä»¬æƒ³è¦çš„æ ·å­

![](/assets/images/20201010PodSpec/cocoapods1.webp)


# æ€»ç»“

è®°å½•ç»å¸¸å¿˜è®°çš„çŸ¥è¯†ç‚¹ é˜²æ­¢ç€æ€¥ç”¨çš„æ—¶å€™å„ç§æ‰¾,æ›´å¤šspecçš„å†™æ³• [å‚è€ƒå®˜æ–¹çš„api](https://guides.cocoapods.org/syntax/podspec.html#vendored_libraries)


[Demoå·¥ç¨‹ç‚¹å‡»è¿™é‡Œä¸‹è½½](https://github.com/sunyazhou13/PodSpecDemo) 

å·¥ç¨‹ä¸­ç§»é™¤äº†framework å› ä¸ºgithubä¸å…è®¸ä¸Šä¼ è¶…è¿‡100mä»¥ä¸Šçš„æ–‡ä»¶.å¾ˆå‘ å¤§å®¶ä¸‹è½½åçœ‹ä¸‹å†™æ³•å°±å¥½äº†.


URL: https://sunyazhou.com/2020/10/XcodeBuildXcconfigFile/index.html.md
Published At: 2020-10-04 11:58:03 +0000

# ä½¿ç”¨Xcodeé…ç½®æ–‡ä»¶æ¥ç®¡ç†ä¸åŒçš„ç¯å¢ƒè®¾ç½®

![](/assets/images/20201004XcodeBuildXcconfigFile/XcodeBuildConfigrationFile1.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## èƒŒæ™¯

æœ€è¿‘å·¥ç¨‹é‡åˆ°äº†ä¸€ä¸ªç¯å¢ƒåˆ‡æ¢çš„é—®é¢˜,æƒ³åˆ°äº† *.xcconfig æ–‡ä»¶çš„ç”¨å¤„. æŸ¥äº†ä¸€åœˆæœç´¢å¼•æ“å¤§å®¶çš„ææ³•çœŸæ˜¯å„ç§æŠ„è¢­.é‡åˆ°çš„é—®é¢˜æ²¡æœ‰ä¸€ä¸ªèƒ½æ­£å¼è§£å†³çš„

ä¸‹é¢æ˜¯æˆ‘é‡åˆ°çš„é—®é¢˜,æˆ‘å°è¯•è§£å†³ä¸€ä¸‹.

* åˆ›å»ºxcconfigå cocoapodsæœ‰è­¦å‘Š
* xcconfigç»§æ‰¿ éœ€è¦æ³¨æ„çš„ç‚¹
* è§£å†³å®Œè­¦å‘Š ç¼–è¯‘æ‰“å°é—®é¢˜

### åˆ›å»º

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig1.webp)

ä¸‹é¢è¿™é‡Œé»˜è®¤å‹¾é€‰tagget (Xcode ä¸ä¼šé»˜è®¤å‹¾é€‰)
![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig2.webp)

åˆ›å»ºå®Œäº† é€‰æ‹©æˆ‘ä»¬è‡ªå·±çš„é…ç½®
![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig3.webp)

#### å…ˆè¯´ç¬¬ä¸€ä¸ªè­¦å‘Šé—®é¢˜

æå®Œåæˆ‘ä»¬æ¥çœ‹ä¸‹pod installåå‡ºç°çš„è­¦å‘Š

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig4.webp)

``` sh
[!] CocoaPods did not set the base configuration of your project because your project already has a custom config set. In order for CocoaPods integration to work at all, please either set the base configurations of the target `XcodeConfigDemo` to `Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.debug.xcconfig` or include the `Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.debug.xcconfig` in your build configuration (`XcodeConfigDemo/DemoDebug.xcconfig`).

[!] CocoaPods did not set the base configuration of your project because your project already has a custom config set. In order for CocoaPods integration to work at all, please either set the base configurations of the target `XcodeConfigDemo` to `Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.release.xcconfig` or include the `Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.release.xcconfig` in your build configuration (`XcodeConfigDemo/DemoRelease.xcconfig`).
```

å…ˆè¯´å¦‚ä½•è§£å†³ å½“æˆ‘ä»¬ç”Ÿæˆäº†è‡ªå·±çš„.xcconfigæ–‡ä»¶åé»˜è®¤æ˜¯cocoapodsçš„é…ç½®,è®©æˆ‘ä»¬æ”¹æˆäº†è‡ªå·±çš„å¹¶æ²¡æœ‰ç®¡ç†cocoapod.æ‰€ä»¥cocoapodså¯¹å·¥ç¨‹çš„build settingæœ‰å¯èƒ½å› ä¸ºæˆ‘ä»¬çš„æ”¹åŠ¨è€Œä¸ç”Ÿæ•ˆ,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„xcconfigä¸­å¯¼å…¥cocoapodsçš„ xcconfig


![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig5.webp)

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig6.webp)


è¿™é‡Œæˆ‘é¡ºä¾¿å£°æ˜äº†2ä¸ªå˜é‡ åœ¨ debugå’Œreleaseé…ç½®é‡Œ,ä¸ºäº†ä¸‹é¢æµ‹è¯•å˜é‡åœ¨å·¥ç¨‹ä¸­ä½¿ç”¨.

``` sh
// debug
SUNYAZHOU_COM = @"https://www.sunyazhou.com/"
SYZ_TEST = @"https://xxxxx.com/"
#include "../Pods/Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.release.xcconfig"
#include "DemoCommon.xcconfig"

//release
SUNYAZHOU_COM = @"https://www.sunyazhou.com/"
SYZ_TEST = @"https://xxxxx.com/"
#include "../Pods/Target Support Files/Pods-XcodeConfigDemo/Pods-XcodeConfigDemo.debug.xcconfig"
#include "DemoCommon.xcconfig"
```

ok ä¸‹é¢ pod installå è­¦å‘Šå°±æ²¡äº†. 

#### xcconfigç»§æ‰¿ éœ€è¦æ³¨æ„çš„ç‚¹

è¿™é‡Œæˆ‘åŠ äº†ä¸€ä¸ªé€šç”¨çš„ DemoCommon.xcconfig é…ç½®,ä¸ºäº†å‘å¤–è¾“å‡ºå…¬å…±çš„å®å˜é‡.

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig7.webp)

`GCC_PREPROCESSOR_DEFINITIONS ` . è¡¨ç¤ºç»§æ‰¿é€šç”¨ç¯å¢ƒå˜é‡ è¦åŠ å…¥é¢„å¤„ç†ï¼Œå³åŠ ä¸Šè¿™å¥ï¼Œä»£ç ä¸­æ‰å¯ä»¥è°ƒåˆ°ç›¸å…³çš„å®å®šä¹‰

``` sh
GCC_PREPROCESSOR_DEFINITIONS = $(inherited) SUNYAZHOU_COM='$(SUNYAZHOU_COM)' SYZ_TEST='$(SYZ_TEST)' 
```

è¿™é‡Œéœ€è¦æ³¨æ„å¤šä¸ªå˜é‡çš„æ ¼å¼:

``` sh
 GCC_PREPROCESSOR_DEFINITIONS = $(inherited)ç©ºæ ¼(ä¸èƒ½åŠ æ¢è¡Œ)+SUNYAZHOU_COM='$(SUNYAZHOU_COM)'+ç©ºæ ¼(ä¸èƒ½åŠ æ¢è¡Œ)SYZ_TEST='$(SYZ_TEST)' 
```
æˆ‘è¿™é‡Œé‡åˆ°çš„å‘æ˜¯åŠ äº†20å¤šä¸ªå˜é‡, å†™äº†ä¸€å †.æœ€åå‘ç°ä¸åƒä¸Šè¾¹çš„æ ¼å¼é‚£æ ·å°±ç¼–è¯‘ä¸è¿‡æ‰¾ä¸åˆ°å˜é‡.

#### è§£å†³å®Œè­¦å‘Š ç¼–è¯‘æ‰“å°é—®é¢˜

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig8.webp)

``` sh
Unexpected '@' in program
```

å‡ºç°è¿™ä¸ªé—®é¢˜æ˜¯å› ä¸ºå®å˜é‡æ²¡æœ‰è½¬ä¹‰

å¿…é¡»å°†ä¸‹é¢çš„å˜é‡ 

``` sh
//è½¬æ¢å‰
SUNYAZHOU_COM = @"https://www.sunyazhou.com/"
SYZ_TEST = @"https://xxxxx.com/"

//è½¬æ¢å
SUNYAZHOU_COM = @"https:\/\/www.sunyazhou.com/"
SYZ_TEST = @"https:\/\/xxxxx.com/"

```

![](/assets/images/20201004XcodeBuildXcconfigFile/xcconfig9.webp)

è½¬æ¢å®Œèƒ½ç¼–è¯‘è¿‡äº† ä½†æ˜¯è¿˜æ˜¯æœ‰è­¦å‘Š,åº”è¯¥æ˜¯æ²¡è½¬ä¹‰å¯¹ ä¸è¿‡ èƒ½æ­£å¸¸è¾“å‡ºäº†. å“ªä½é«˜æ‰‹å¦‚æœçŸ¥é“å¯ä»¥ç•™è¨€ç»™æˆ‘ å¤šè°¢ï¼

# æ€»ç»“

æœ‰äº›çŸ¥è¯†ä¸ç»å¸¸ä½¿ç”¨å®¹æ˜“å¿˜è®°, xcconfigå°±æ˜¯è¿™æ ·.å·¥ç¨‹ demoæˆ‘å·²ç»é™„åœ¨äº†ä¸‹æ–¹ æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ä¸‹è½½.

[æœ¬æ–‡demo](https://github.com/sunyazhou13/XcodeConfigDemo) 



[å‚è€ƒMattt å¤§ä½¬çš„ Xcode Build Configuration Files](https://nshipster.com/xcconfig/)    
[Using Xcode Configuration (.xcconfig) to Manage Different Build Settings](https://www.appcoda.com/xcconfig-guide/)  



URL: https://sunyazhou.com/2020/09/iOSinterviewPerformanceOptimization/index.html.md
Published At: 2020-09-22 09:42:48 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹æ€§èƒ½ä¼˜åŒ–

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ¬ç¯‡æˆ‘ä»¬æ¥è®²ä¸€ä¸‹ [é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜](https://mp.weixin.qq.com/s/bDnsaD__ZpdHIk3_So382w) ä¸­çš„æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„é—®é¢˜.

## æ€§èƒ½ä¼˜åŒ–

ä¸»è¦çš„ä¼˜åŒ–å¦‚ä¸‹:

1. å¦‚ä½•åšå¯åŠ¨ä¼˜åŒ–ï¼Œå¦‚ä½•ç›‘æ§
2. å¦‚ä½•åšå¡é¡¿ä¼˜åŒ–ï¼Œå¦‚ä½•ç›‘æ§
3. å¦‚ä½•åšè€—ç”µä¼˜åŒ–ï¼Œå¦‚ä½•ç›‘æ§
4. å¦‚ä½•åšç½‘ç»œä¼˜åŒ–ï¼Œå¦‚ä½•ç›‘æ§

é¦–å…ˆä¼˜åŒ–è¦ä»å¤šç»´åº¦è¿›è¡Œæ‰æœ‰è¾ƒå¤§çš„æ”¶ç›Š 

è¿™é‡Œæ¨èå¤§å®¶è®¤çœŸåˆ†æä¸€ä¸‹è‡ªå·±çš„å·¥ç¨‹å¹¶ç ”è¯»ä¸€ä¸‹æˆ´é“­è€å¸ˆçš„[å¦‚ä½•å¯¹ iOS å¯åŠ¨é˜¶æ®µè€—æ—¶è¿›è¡Œåˆ†æ](https://ming1016.github.io/2019/12/07/how-to-analyze-startup-time-cost-in-ios/) æ–‡ç« 

å¿…é¡»è¦ä»å¤šç»´åº¦åˆ†æå¹¶å…¥æ‰‹.

è¿è¡Œæ—¶åˆå§‹åŒ–è¿‡ç¨‹ åˆ†ä¸ºï¼š

* åŠ è½½ç±»æ‰©å±•
* åŠ è½½ C++é™æ€å¯¹è±¡
* è°ƒç”¨+load å‡½æ•°
* æ‰§è¡Œ main å‡½æ•°
* Application åˆå§‹åŒ–ï¼Œåˆ° applicationDidFinishLaunchingWithOptions æ‰§è¡Œå®Œ
åˆå§‹åŒ–å¸§æ¸²æŸ“ï¼Œåˆ° viewDidAppear æ‰§è¡Œå®Œï¼Œç”¨æˆ·å¯è§å¯æ“ä½œã€‚


# æ€»ç»“

æ€§èƒ½ä¼˜åŒ–éƒ¨åˆ† å¹¶æ²¡æœ‰æ ‡å‡†çš„ç­”æ¡ˆ,æ‰€ä»¥åˆ†äº«ç»™å¤§å®¶ä¸€ç¯‡é‡è¦çš„æ–‡ç« ä½œä¸ºæŠ“æ‰‹å’Œå‚è€ƒ,åªè¦è¾¾åˆ°é¢„æœŸçš„ä¼˜åŒ–ç›®çš„å¹¶ä¿è¯ç¨‹åºç¨³å®šå³å¯.






URL: https://sunyazhou.com/2020/09/UIViewGraphic/index.html.md
Published At: 2020-09-20 11:40:47 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹è§†å›¾&å›¾å½¢

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ¬ç¯‡æˆ‘ä»¬æ¥è®²ä¸€ä¸‹ [é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜](https://mp.weixin.qq.com/s/bDnsaD__ZpdHIk3_So382w) ä¸­çš„è§†å›¾&å›¾å½¢ç›¸å…³çš„é—®é¢˜.

## è§†å›¾&å›¾åƒç›¸å…³

ä¸»è¦é—®é¢˜åˆ—è¡¨å¦‚ä¸‹:

1. AutoLayoutçš„åŸç†ï¼Œæ€§èƒ½å¦‚ä½•
2. UIView &amp; CALayerçš„åŒºåˆ«
3. äº‹ä»¶å“åº”é“¾
4. drawrect &amp; layoutsubviewsè°ƒç”¨æ—¶æœº
5. UIçš„åˆ·æ–°åŸç†
6. éšå¼åŠ¨ç”» & æ˜¾ç¤ºåŠ¨ç”»åŒºåˆ«
7. ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“
8. imageName&imageWithContentsOfFileåŒºåˆ«
9. å¤šä¸ªç›¸åŒçš„å›¾ç‰‡ï¼Œä¼šé‡å¤åŠ è½½å—
10. å›¾ç‰‡æ˜¯ä»€ä¹ˆæ—¶å€™è§£ç çš„ï¼Œå¦‚ä½•ä¼˜åŒ–
11. å›¾ç‰‡æ¸²æŸ“æ€ä¹ˆä¼˜åŒ–
12. å¦‚æœGPUçš„åˆ·æ–°ç‡è¶…è¿‡äº†iOSå±å¹•60Hzåˆ·æ–°ç‡æ˜¯ä»€ä¹ˆç°è±¡ï¼Œæ€ä¹ˆè§£å†³

### 1.AutoLayoutçš„åŸç†ï¼Œæ€§èƒ½å¦‚ä½•?

#### AutoLayoutçš„åŸç†

> æ¥å†
ä¸€èˆ¬å¤§å®¶éƒ½ä¼šè®¤ä¸ºAuto Layoutè¿™ä¸ªä¸œè¥¿æ˜¯è‹¹æœè‡ªå·±æå‡ºæ¥çš„ï¼Œå…¶å®ä¸ç„¶ï¼Œæ—©åœ¨1997å¹´Alan Borning, Kim Marriott, Peter Stuckeyç­‰äººå°±å‘å¸ƒäº†ã€ŠSolving Linear Arithmetic Constraints for User Interface Applicationsã€‹è®ºæ–‡ï¼ˆ[è®ºæ–‡åœ°å€:http://constraints.cs.washington.edu/solvers/uist97.html](http://constraints.cs.washington.edu/solvers/uist97.html)ï¼‰æå‡ºäº†åœ¨è§£å†³å¸ƒå±€é—®é¢˜çš„Cassowary constraint-solvingç®—æ³•å®ç°ï¼Œå¹¶ä¸”å°†ä»£ç å‘å¸ƒåœ¨ä»–ä»¬æ­å»ºçš„[Cassowaryç½‘ç«™ä¸Šhttp://constraints.cs.washington.edu/cassowary/](http://constraints.cs.washington.edu/cassowary/)ã€‚åæ¥æ›´å¤šå¼€å‘è€…ç”¨å„ç§è¯­è¨€æ¥å†™Cassowaryï¼Œæ¯”å¦‚è¯´pybeeç”¨pythonå†™çš„https://github.com/pybee/cassowaryã€‚è‡ªä»å®ƒå‘å¸ƒä»¥æ¥JavaScriptï¼Œ.NETï¼ŒJAVAï¼ŒSmalltallå’ŒC++éƒ½æœ‰ç›¸åº”çš„åº“ã€‚2011å¹´è‹¹æœå°†è¿™ä¸ªç®—æ³•è¿ç”¨åˆ°äº†è‡ªå®¶çš„å¸ƒå±€å¼•æ“ä¸­ï¼Œç¾å…¶åæ›°Auto Layoutã€‚

è®ºæ–‡ä¸‹è½½é“¾æ¥æ¯”è¾ƒæ…¢,æˆ‘ä¸‹è½½äº†ä¸€ä»½[CassowaryåŸæ–‡æ”¾åˆ°äº†æˆ‘çš„åšå®¢ å¤§å®¶å¯ä»¥è‡ªç”±ä¸‹è½½](/assets/images/20200920UIViewGraphic/Cassowary.pdf).

**AutoLayoutçš„åŸç†å°±æ˜¯ç”¨Cassowaryç®—æ³•æ¥å°†å¸ƒå±€é—®é¢˜æŠ½è±¡æˆçº¿æ€§ä¸ç­‰å¼ï¼Œå¹¶åˆ†è§£æˆå¤šä¸ªä½ç½®é—´çš„çº¦æŸ**  
å› ä¸ºå¤šäº†è®¡ç®—è§†å›¾å¤§å°frameçš„è¿‡ç¨‹,æ‰€ä»¥æ€§èƒ½è‚¯å®šæ²¡æœ‰æŒ‡å®šFrameåæ ‡è¦å¿«.

è¯¦ç»†çš„åŸç†ä»¥åŠé«˜é˜¶åŸç†è¯·å‚è€ƒæˆ´é“­è€å¸ˆçš„æ–‡ç« 
[æˆ´é“­è€å¸ˆå†™çš„ æ·±å…¥å‰–æAuto Layoutï¼Œåˆ†æiOSå„ç‰ˆæœ¬æ–°å¢ç‰¹æ€§](http://www.starming.com/2015/11/03/deeply-analyse-autolayout/)

#### æ€§èƒ½å¦‚ä½•?

ä¸‹é¢æ˜¯[WWDC2018 High Performance Auto Layout](https://developer.apple.com/videos/play/wwdc2018/220/)ä¸­å¯¹æ¯”çš„iOS12å’ŒiOS11ä¸‹åˆ†åˆ«ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€çš„æ€§èƒ½å¯¹æ¯”ç°åœº.

![](/assets/images/20200920UIViewGraphic/HighPerformanceAutoLayoutiOS11iOS12Compare.gif)

ç»è¿‡å®éªŒå¾—å‡ºå¦‚ä¸‹å›¾æ ‡ç»“è®º:

![](/assets/images/20200920UIViewGraphic/HighPerformanceAutoLayoutResult.webp)

iOS12ä¹‹å‰ï¼Œè§†å›¾åµŒå¥—çš„æ•°é‡å¯¹æ€§èƒ½çš„å½±å“æ˜¯å‘ˆæŒ‡æ•°çº§å¢é•¿çš„ï¼Œè€ŒiOS12ä¼˜åŒ–ä¹‹åå¯¹æ€§èƒ½çš„å½±å“æ˜¯çº¿æ€§å¢é•¿ï¼Œå¯¹æ€§èƒ½æ¶ˆè€—ä¸å¤§ã€‚

æ— è®ºå¦‚ä½•ä¼˜åŒ–ä¹Ÿè‚¯å®šä¸å¦‚CGRectFrameé‚£æ ·çš„è®¾ç½®æ›´åŠ ç›´æ¥,æ€§èƒ½æ›´å¥½.

### 2.UIView & CALayerçš„åŒºåˆ«

| åŒºåˆ« | UIView | CALayer |
| :------| :------: | :------: |
| ç»§æ‰¿çˆ¶ç±» | UIView:UIResponder:NSObject | CALayer:NSObject |
| ç”¨é€” | å¯ä»¥å¤„ç†è§¦æ‘¸äº‹ä»¶ | ä¸å¤„ç†ç”¨æˆ·çš„äº¤äº’,ä¸å‚ä¸å“åº”äº‹ä»¶ä¼ é€’ |
| ä¸¤è€…å…³ç³» | æœ‰ä¸€ä¸ªCALayeræˆå‘˜å˜é‡ eg: view.layer | æ˜¯UIViewçš„æˆå‘˜å˜é‡ |
| åˆ†å·¥ | å¤„ç†äº¤äº’å±‚äº‹ä»¶å¹¶åŒ…è£…å„ç§å›¾å½¢çš„ç®€å•è®¾ç½® | åº•å±‚æ¸²æŸ“å›¾å½¢,æ”¯æŒåŠ¨ç”» |

### 3.äº‹ä»¶å“åº”é“¾

ä¸‹é¢è¿™ç¯‡æ–‡ç« æˆ‘å·²ç»åœ¨å‰å‡ ç¯‡å°†runloopçš„æ—¶å€™æäº†ä¸æ­¢ä¸€æ¬¡,å‰åˆ—å»ºè®®é˜…è¯»,å¿«æ‰‹çš„åŒäº‹å¤§éƒ¨åˆ†éƒ½ä»¥è¿™ä¸ªç†è§£ä¸ºæ ‡å‡†

[iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶](https://mp.weixin.qq.com/s/9rvSRt4kfpy7e87EJoaJOQ)


### 4. drawrect & layoutsubviewsè°ƒç”¨æ—¶æœº

`layoutSubviews:`(ç›¸å½“äºlayoutSubviews()å‡½æ•°)åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šè¢«è°ƒç”¨ï¼š
 
1. initåˆå§‹åŒ–ä¸ä¼šè§¦å‘layoutSubviewsã€‚
2. addSubviewä¼šè§¦å‘layoutSubviewsã€‚
3. è®¾ç½®viewçš„Frameä¼šè§¦å‘layoutSubviews (frameå‘ç”Ÿå˜åŒ–è§¦å‘)ã€‚
4. æ»šåŠ¨ä¸€ä¸ªUIScrollViewä¼šè§¦å‘layoutSubviewsã€‚
5. æ—‹è½¬Screenä¼šè§¦å‘çˆ¶UIViewä¸Šçš„layoutSubviewsäº‹ä»¶ã€‚
6. æ”¹å˜ä¸€ä¸ªUIViewå¤§å°çš„æ—¶å€™ä¹Ÿä¼šè§¦å‘çˆ¶UIViewä¸Šçš„layoutSubviewsäº‹ä»¶ã€‚
7. ç›´æ¥è°ƒç”¨setLayoutSubviewsã€‚

`drawrect:`(drawrect()å‡½æ•°)åœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä¼šè¢«è°ƒç”¨ï¼š

1. `drawrect:`æ˜¯åœ¨UIViewControllerçš„`loadView:`å’Œ`ViewDidLoad:`æ–¹æ³•ä¹‹åè°ƒç”¨.
2. å½“æˆ‘ä»¬è°ƒç”¨`[UIFontçš„ sizeToFit]`å,ä¼šè§¦å‘ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨`drawRect:`
3. å½“è®¾ç½®UIViewçš„contentModeæˆ–è€…Frameåä¼šç«‹å³è§¦å‘è§¦å‘ç³»ç»Ÿè°ƒç”¨`drawRect:`
4. ç›´æ¥è°ƒç”¨`setNeedsDisplay`è®¾ç½®æ ‡è®° æˆ–`setNeedsDisplayInRect:`çš„æ—¶å€™ä¼šè§¦å‘`drawRect:`

> çŸ¥è¯†ç‚¹æ‰©å……: å½“æˆ‘ä»¬æ“ä½œdrawRectæ–¹æ³•çš„æ—¶å€™å®é™…æ˜¯åœ¨æ“ä½œå†…å­˜ä¸­å­˜æ”¾è§†å›¾çš„backingStoreåŒºåŸŸ,ç”¨äºåç»­å›¾å½¢çš„æ¸²æŸ“æ“ä½œ,å¦‚æœä¸ç†è§£å¯ä»¥çœ‹ä¸‹[UIViewçš„æ¸²æŸ“è¿‡ç¨‹](https://www.sunyazhou.com/2017/10/16/20171016UIViewRendering/).

### 5.UIçš„åˆ·æ–°åŸç†

è¿™ä¸ªé—®é¢˜æˆ‘ä¸çŸ¥é“é—®çš„æ˜¯ä¸æ˜¯iOSç¦»å±æ¸²æŸ“è¿‡ç¨‹,æˆ‘æ¥ç®€å•çš„å›åˆ°ä¸€ä¸‹è¿™ä¸ªå§

iOS çš„`MainRunloop` æ˜¯ä¸€ä¸ª60fps çš„å›è°ƒ,ä¹Ÿå°±æ˜¯è¯´16.7ms(æ¯«ç§’)ä¼šç»˜åˆ¶ä¸€æ¬¡å±å¹•åœ¨è¿™è¿‡ç¨‹ä¸­è¦å®Œæˆä»¥ä¸‹çš„å·¥ä½œ:

* viewçš„ç¼“å†²åŒºåˆ›å»º
* viewå†…å®¹çš„ç»˜åˆ¶(å¦‚æœé‡å†™äº† drawRect)
* æ¥æ”¶å’Œå¤„ç†ç³»ç»Ÿçš„è§¦æ‘¸äº‹ä»¶

æˆ‘ä»¬çœ‹åˆ°çš„UIå›¾å½¢å®é™…ä¸Šæ˜¯CPUå’ŒGPUä¸æ–­é…åˆå·¥ä½œçš„ç»“æœ.ç»è¿‡[UIViewçš„æ¸²æŸ“è¿‡ç¨‹](https://www.sunyazhou.com/2017/10/16/20171016UIViewRendering/) åæˆ‘ä»¬çš„UIä¼šä¸é—´æ–­çš„æ¥æ”¶ç³»ç»Ÿå›¾ç»™æˆ‘ä»¬çš„äº‹ä»¶.

ç”±äºä¸»çº¿ç¨‹çš„runloop ä¸€ç›´åœ¨å›è°ƒ,æˆ‘ä»¬çš„UIå°±å¾—åˆ°äº†åˆ·æ–°çš„çª—å£,æ˜¯æ¸²æŸ“è¿˜æ˜¯å¤„ç†äº‹ä»¶éƒ½æ˜¯å› ä¸ºrunloopä¸æ–­å·¥ä½œçš„ç»“æœ.å‰å‡ ç¯‡æˆ‘ä»¬å­¦è¿‡ mainçº¿ç¨‹çš„runloopé»˜è®¤æ˜¯å¯åŠ¨çš„.å› ä¸ºæˆ‘ä»¬å“åº”äº¤äº’.

ä¸çŸ¥é“æˆ‘è¿™æ ·å›ç­”æ˜¯å¦æ»¡è¶³è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆ.å¦‚æœå›ç­”çš„ä¸å¯¹çƒ¦è¯·ä¸‹æ–¹è¯„è®ºåŒºç•™è¨€ å‘ŠçŸ¥æˆ‘å°†æŒç»­æ”¹è¿›.

### 6.éšå¼åŠ¨ç”» & æ˜¾ç¤ºåŠ¨ç”»åŒºåˆ«

éšå¼åŠ¨ç”»ä¸€ç›´å­˜åœ¨ å¦‚éœ€å…³é—­éœ€è®¾ç½®  
æ˜¾å¼åŠ¨ç”»æ˜¯ä¸å­˜åœ¨ï¼Œå¦‚éœ€æ˜¾å¼ è¦å¼€å¯  

åªéœ€è¦è§‚å¯ŸåŠ¨ç”»æ‰§è¡Œå®Œæˆçš„ç»“æœ
æ¯”å¦‚: ä¸€ä¸ªç®€å•UIViewçš„frameç§»åŠ¨ å¦‚æœä»Aç‚¹ç§»åŠ¨åˆ°Bç‚¹ ç§»åŠ¨å®Œæˆ å›åˆ°åŸå§‹ä½ç½®å°±æ˜¯éšå¼åŠ¨ç”»

Core Animation æ˜¯æ˜¾å¼åŠ¨ç”».å› ä¸ºå®ƒæ—¢å¯ä»¥ç›´æ¥å¯¹å…¶layerå±æ€§åšåŠ¨ç”»ï¼Œä¹Ÿå¯ä»¥è¦†ç›–é»˜è®¤çš„å›¾å±‚è¡Œä¸º.

### 7.imageName&imageWithContentsOfFileåŒºåˆ«

| åŒºåˆ« | UIView | imageWithContentsOfFile |
| :------| :------: | :------: |
| ä¸åŒç‚¹ | ä¼šå›¾ç‰‡ç¼“å­˜åˆ°å†…å­˜ä¸­ | æ— ç¼“å­˜ |

### 8.ä»€ä¹ˆæ˜¯ç¦»å±æ¸²æŸ“

![](/assets/images/20200920UIViewGraphic/CoreAnimationPipeline.webp)

[iOSç¦»å±æ¸²æŸ“çš„æ·±å…¥ç ”ç©¶](https://zhuanlan.zhihu.com/p/72653360)

### 9.å¤šä¸ªç›¸åŒçš„å›¾ç‰‡ï¼Œä¼šé‡å¤åŠ è½½å—

ä¸ä¼š,GPUæœ‰ åƒç´ ç‚¹ç¼“å­˜çš„mask.

### 10.å›¾ç‰‡æ˜¯ä»€ä¹ˆæ—¶å€™è§£ç çš„ï¼Œå¦‚ä½•ä¼˜åŒ–

æ˜¯åŠ è½½åˆ°å†…å­˜ä¸­,ä»UIImge->CGImage->CGImageSourceCreateWithData(data) åˆ›å»ºImageSourceå˜æˆbitmapä½å›¾,è¿™äº›å·¥ä½œéƒ½æ˜¯CoreAnimationåœ¨å›¾ç‰‡è¢«åŠ è½½åˆ°å†…å­˜ä¸­å­˜åœ¨åœ¨backingStoreé‡Œ,é€ç»™GPUæµæ°´çº¿å¤„ç†ä¹‹å‰è¢«è§£ç .

#### å¦‚ä½•ä¼˜åŒ–

è‡ªå·±æ‰‹åŠ¨æ“ä½œå›¾ç‰‡çš„ç¼–ç API

CGImageSourceå¼€å¤´çš„å“ªäº›,æ ¹æ®åˆç†åˆ©ç”¨æ—¶æœºå’Œæ“ä½œç³»ç»Ÿèµ„æºè°ƒæ•´å‡ºä¸€å¥—ç¼“å­˜å°åŠ è½½å¿«çš„åº“.

å‚è€ƒ[PINRemoteImage](https://github.com/pinterest/PINRemoteImage)æˆ–è€…[YYWebImage](https://github.com/ibireme/YYWebImage)å¼€æº

### 11.å›¾ç‰‡æ¸²æŸ“æ€ä¹ˆä¼˜åŒ–

å¯ä»¥ä»é˜´å½±,åœ†è§’å…¥æ‰‹.å¸§ç‡,ç”µé‡,å›¾ç‰‡çš„é”¯é½¿ç­‰ç­‰.


[iOSå¼€å‘-è§†å›¾æ¸²æŸ“ä¸æ€§èƒ½ä¼˜åŒ–](https://www.jianshu.com/p/748f9abafff8)

### 12.å¦‚æœGPUçš„åˆ·æ–°ç‡è¶…è¿‡äº†iOSå±å¹•60Hzåˆ·æ–°ç‡æ˜¯ä»€ä¹ˆç°è±¡ï¼Œæ€ä¹ˆè§£å†³

ç°è±¡æ˜¯ å›¾å½¢æ¸…æ™°,åœºæ™¯é€¼çœŸ,ä½†æ˜¯ä¸€èˆ¬armèŠ¯ç‰‡çš„GPU åˆ·æ–°è¶…è¿‡60Hzä¸€å®šä¼šè¶…çº§è´¹ç”µ,æ‰‹æœºå‘çƒ­å¯¼è‡´é™é¢‘.FPSé™ä½,å› ä¸ºä½èƒ½è€—ç”µé‡ä¸è¶³,æ— æ³•æ”¯æŒGPUé«˜åˆ·æ–°ç‡

è§£å†³åŠæ³•åªèƒ½ç”¨xcodeè‡ªå¸¦å·¥å…·æ£€æµ‹,çœ‹æ¸²æŸ“è¿‡ç¨‹å“ªé‡Œå¯ä»¥ä¼˜åŒ–.


# æ€»ç»“

ç®€å•å›ç­”äº†ä¸€äº›å›¾å½¢ç›¸å…³çš„é—®é¢˜,å¤§éƒ¨åˆ†éƒ½æ˜¯iOSç¦»å±æ¸²æŸ“,è¿™ä¸ªåœ°æ–¹å¤§å®¶è¦è®¤çœŸå­¦ä¹ .å¾ˆå¤šèµ„æ–™çœ‹èµ·æ¥æ¯”è¾ƒè€—æ—¶.


URL: https://sunyazhou.com/2020/09/GCD/index.html.md
Published At: 2020-09-19 11:09:28 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹å¤šçº¿ç¨‹

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

æœ¬ç¯‡æˆ‘ä»¬æ¥è®²ä¸€ä¸‹ [é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜](https://mp.weixin.qq.com/s/bDnsaD__ZpdHIk3_So382w) ä¸­çš„å¤šçº¿ç¨‹ç›¸å…³çš„é—®é¢˜.


## å¤šçº¿ç¨‹

è¿™ä¸€ç¯‡æˆ‘ä»¬æ¥è§£ç­”ä¸‹å¤šçº¿ç¨‹é—®é¢˜,ä¸»è¦ä»¥GCDä¸ºä¸»:

* iOSå¼€å‘ä¸­æœ‰å¤šå°‘ç±»å‹çš„çº¿ç¨‹ï¼Ÿåˆ†åˆ«å¯¹æ¯”
* GCDæœ‰å“ªäº›é˜Ÿåˆ—ï¼Œé»˜è®¤æä¾›å“ªäº›é˜Ÿåˆ—
* GCDæœ‰å“ªäº›æ–¹æ³•api
* GCDä¸»çº¿ç¨‹ & ä¸»é˜Ÿåˆ—çš„å…³ç³»
* å¦‚ä½•å®ç°åŒæ­¥ï¼Œæœ‰å¤šå°‘æ–¹å¼å°±è¯´å¤šå°‘
* `dispatch_once`å®ç°åŸç†
* ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ­»é”
* æœ‰å“ªäº›ç±»å‹çš„çº¿ç¨‹é”ï¼Œåˆ†åˆ«ä»‹ç»ä¸‹ä½œç”¨å’Œä½¿ç”¨åœºæ™¯
* NSOperationQueueä¸­çš„`maxConcurrentOperationCount`é»˜è®¤å€¼
* NSTimerã€CADisplayLinkã€`dispatch_source_t` çš„ä¼˜åŠ£

###  1.iOSå¼€å‘ä¸­æœ‰å¤šå°‘ç±»å‹çš„çº¿ç¨‹?åˆ†åˆ«å¯¹æ¯”

| çº¿ç¨‹ç±»å‹ | å¯¹æ¯” | å¤‡æ³¨ |
| :------| :------: | :------: |
| `pthread_t` | è·¨å¹³å°Cè¯­è¨€æ ‡å‡†åº“ä¸­çš„å¤šçº¿ç¨‹æ¡†æ¶ | è¿‡äºåº•å±‚ä½¿ç”¨å¾ˆéº»çƒ¦,éœ€è¦å°è£…ä½¿ç”¨. |
| GCD(Grand Central Dispatch) | iOS5åè‹¹æœæ¨å‡ºçš„åŒæ ¸CPUä¼˜åŒ–çš„å¤šçº¿ç¨‹æ¡†æ¶,å¯¹A5ä»¥åçš„CPUæœ‰å¾ˆå¤šåº•å±‚ä¼˜åŒ–,Cå‡½æ•°çš„å½¢å¼è°ƒç”¨ æœ‰ç‚¹é¢å‘è¿‡ç¨‹,ä¸èƒ½ç›´æ¥è®¾ç½®å¹¶å‘æ•°,éœ€è¦å†™ä¸€äº›ä»£ç æ›²çº¿æ–¹å¼å®ç°å¹¶å‘ |   æ¨èä½¿ç”¨  |
| NSOperation & NSOperationQueue | æ›´åŠ é¢å‘å¯¹è±¡ å¯ä»¥è®¾ç½®å¹¶å‘æ•°é‡ | GCD çš„å°è£… |

> è‹¹æœåº•å±‚åº“ç»è¿‡è‡ªå·±å¤šå¹´å®è·µæ²¡æœ‰é—®é¢˜æ‰ä¼šæ¨èç»™ä¸Šå±‚ä½¿ç”¨, eg:siri. æ‰€ä»¥NSOperationå®é™…ä¸Šæ˜¯è‹¹æœçš„ver1.0çš„å¤šçº¿ç¨‹SDK,å¯¹GCDå°è£…å’Œ`pthread_t`çš„å°è£….

### 2.GCDæœ‰å“ªäº›é˜Ÿåˆ—ï¼Œé»˜è®¤æä¾›å“ªäº›é˜Ÿåˆ—

* 1.ä¸»çº¿ç¨‹ä¸²è¡Œé˜Ÿåˆ—
* 2.å…¨å±€å¹¶è¡Œé˜Ÿåˆ—
* 3.è‡ªå®šä¹‰é˜Ÿåˆ—(å¯è‡ªè¡Œè®¾ç½®`ä¸²/å¹¶`çš„å‚æ•°`DISPATCH_QUEUE_SERIAL`å’Œ`DISPATCH_QUEUE_CONCURRENT`)

ä¸‹é¢æˆ‘æ•´ç†äº†ä¸€ä¸ªè¡¨æ ¼:

| é˜Ÿåˆ—ç±»å‹ | å¯¹åº”å‡½æ•° | ç³»ç»Ÿé»˜è®¤æä¾›/è‡ªå®šä¹‰ | ä¼˜å…ˆçº§ |
| :------| :------: | :------: | :------: |
| ä¸»çº¿ç¨‹ä¸²è¡Œé˜Ÿåˆ—(mian)| `dispatch_get_main_queue()` | ç³»ç»Ÿ |  |
| å…¨å±€å¹¶è¡Œé˜Ÿåˆ—(global)| `dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0)` | ç³»ç»Ÿ | ç³»ç»Ÿæä¾›å‚æ•°è®¾ç½® |
| è‡ªå®šä¹‰å¹¶è¡Œé˜Ÿåˆ—(Concurrent)| `dispatch_queue_create("com.sunyazhou.self.queue.concurrent", DISPATCH_QUEUE_CONCURRENT)` | è‡ªå®šä¹‰ | |
| è‡ªå®šä¹‰ä¸²è¡Œé˜Ÿåˆ—(Serial)| `dispatch_queue_create("com.sunyazhou.self.queue.serial", DISPATCH_QUEUE_SERIAL)` | è‡ªå®šä¹‰ |  |

`dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0)` å…¶ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯é˜Ÿåˆ—çš„ä¼˜å…ˆçº§,å…·ä½“å¯¹äºä¼˜å…ˆçº§QOSå¦‚ä¸‹:

| GCDå…¨å±€é˜Ÿåˆ—ä¼˜å…ˆçº§å®å®šä¹‰ |  å¯¹åº”æšä¸¾æ•°å€¼ | å¯¹åº”Qos |
| :------| :------: | :------ | 
| `DISPATCH_QUEUE_PRIORITY_HIGH` | 2 | `QOS_CLASS_USER_INITIATED` |
| `DISPATCH_QUEUE_PRIORITY_DEFAULT` | 0 | `QOS_CLASS_DEFAULT` |
| `DISPATCH_QUEUE_PRIORITY_LOW` | -2 | `QOS_CLASS_UTILITY` |
| `DISPATCH_QUEUE_PRIORITY_BACKGROUND` | `INT16_MIN` | `QOS_CLASS_BACKGROUND` |

> å…¶ä¸­`dispatch_get_global_queue `çš„ç¬¬äºŒä¸ªå‚æ•°flagåªæ˜¯ä¸€ä¸ªè‹¹æœäºˆä¿ç•™å­—æ®µï¼Œé€šå¸¸æˆ‘ä»¬ä¼ 0ï¼ˆä½ å¯ä»¥è¯•è¯•ä¼ 1åº”è¯¥é˜Ÿåˆ—åˆ›å»ºå¤±è´¥ï¼‰

### 3.GCDæœ‰å“ªäº›æ–¹æ³•api

* é˜Ÿåˆ—ç›¸å…³API  

	``` objc
	dispatch_get_main_queue(void) //è·å–ä¸»çº¿ç¨‹é˜Ÿåˆ—
	dispatch_get_global_queue(intptr_t identifier, uintptr_t flags) //è·å–å…¨å±€é˜Ÿåˆ—
	dispatch_queue_create(const char *_Nullable label,dispatch_queue_attr_t _Nullable attr) //åˆ›å»ºè‡ªå®šä¹‰é˜Ÿåˆ— (ä¸€èˆ¬å¤§å®¶éƒ½ç”¨åŸŸåå€’ç½®æ¥åŒºåˆ†é˜Ÿåˆ—çš„å”¯ä¸€æ ‡è¯†,è‹¹æœå¯¹æ ‡è¯†ç¬¦æ˜¯å¦ä¸€è‡´åœ¨iOS10åæœ‰ä¼˜åŒ–è¯·æ³¨æ„.)
	```
* æ‰§è¡ŒAPI

	``` objc
	dispatch_async(dispatch_queue_t queue, dispatch_block_t block) //åœ¨æŸé˜Ÿåˆ—å¼€å¯å¼‚æ­¥çº¿ç¨‹ block{}èŠ±æ‹¬å·å†…çš„ä»£ç å°†åœ¨æŸé˜Ÿåˆ—å¼‚æ­¥è¿è¡Œ
	dispatch_sync(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block) //åœ¨æŸé˜Ÿåˆ—å¼€å¯åŒæ­¥çº¿ç¨‹ block{}èŠ±æ‹¬å·å†…çš„ä»£ç å°†åœ¨æŸé˜Ÿåˆ—åŒæ­¥è¿è¡Œ
	dispatch_after(dispatch_time_t when, dispatch_queue_t queue, dispatch_block_t block) //GCDå®šæ—¶å™¨ å¤šä¹…åæ‰§è¡Œ block
	dispatch_once(dispatch_once_t *predicate, DISPATCH_NOESCAPE dispatch_block_t block) //å•æ¬¡æ“ä½œ (å•ä½æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ“ä½œç³»ç»Ÿçš„ä¸´ç•ŒåŒº,ä¸€èˆ¬åˆ›å»ºå•åˆ©æ—¶ä½¿ç”¨)è¿™ä¸ªå˜é‡å¯ä»¥åŒºåˆ†å†·çƒ­å¯åŠ¨.
	dispatch_apply(size_t iterations, dispatch_queue_t DISPATCH_APPLY_QUEUE_ARG_NULLABILITY queue, DISPATCH_NOESCAPE void (^block)(size_t)) //å‘é˜Ÿåˆ—ä¸­è¿½åŠ ä»»åŠ¡æ“ä½œå¹¶ç­‰å¾…å¤„ç†æ‰§è¡Œç»“æŸ.
	dispatch_barrier_async()  //å°†è‡ªå·±çš„ä»»åŠ¡æ’å…¥åˆ°é˜Ÿåˆ—ä¹‹åï¼Œä¸ä¼šç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸï¼Œå®ƒä¼šç»§ç»­æŠŠåé¢çš„ä»»åŠ¡æ’å…¥åˆ°é˜Ÿåˆ—ï¼Œç„¶åç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸåæ‰æ‰§è¡Œåé¢ä»»åŠ¡
	dispatch_barrier_sync()  //å°†è‡ªå·±çš„ä»»åŠ¡æ’å…¥åˆ°é˜Ÿåˆ—çš„æ—¶å€™ï¼Œéœ€è¦ç­‰å¾…è‡ªå·±çš„ä»»åŠ¡ç»“æŸä¹‹åæ‰ä¼šç»§ç»­æ’å…¥è¢«å†™åœ¨å®ƒåé¢çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œå®ƒä»¬
	```
* è°ƒåº¦ç»„API
	
	``` objc
	dispatch_group_create(void) //åˆ›å»ºGCD è°ƒåº¦ç»„
	dispatch_group_async(dispatch_group_t group, dispatch_queue_t queue,dispatch_block_t block) //è°ƒåº¦ç»„å¼€å¯å¼‚æ­¥çº¿ç¨‹
	dispatch_group_enter() //è°ƒåº¦ç»„ä¿¡å·é‡ éœ€è¦å’Œleaveæˆå¯¹å‡ºç°.
	dispatch_group_leave() //è°ƒåº¦ç»„ä¿¡å·é‡ éœ€è¦å’Œenteræˆå¯¹å‡ºç°.
	dispatch_group_notify() //è°ƒåº¦ç»„ä»»åŠ¡å®Œæˆé€šçŸ¥è°ƒç”¨æ–¹ æ“ä½œ(ä¸€èˆ¬éƒ½å›åˆ°ä¸»çº¿ç¨‹)
	dispatch_group_wait() //æ•´ä¸ªè°ƒåº¦ç»„ é˜»å¡æ“ä½œ.åªç­‰å¾…ä¸åšç»“æŸå¤„ç†
	```
* ä¿¡å·é‡API
	
	``` objc
	dispatch_semaphore_create(intptr_t value) //åˆ›å»ºä¿¡å·é‡ (å¯ä»¥ç†è§£ä¸ºæ˜¯çº¿ç¨‹é”)
	dispatch_semaphore_wait(dispatch_semaphore_t dsema, dispatch_time_t timeout) //ä¿¡å·-1
	dispatch_semaphore_signal(dispatch_semaphore_t dsema) //ä¿¡å·+1
	```
* è°ƒåº¦èµ„æºAPI
	
	``` objc
	dispatch_source_create() 
	dispatch_source_set_timer()
	dispatch_source_set_event_handler()
	dispatch_activate()
	dispatch_resume()
	dispatch_suspend()
	dispatch_source_cancel()
	dispatch_source_testcancel()
	dispatch_source_set_cancel_handler()
	dispatch_notify()
	dispatch_get_context()
	dispatch_set_contex()
	dispatch_queue_set_specific() ç»™é˜Ÿåˆ—è®¾ç½®æ ‡è¯†
	dispatch_queue_get_specific() å–å‡ºé˜Ÿåˆ—æ ‡è¯†
	dispatch_get_specific() æŸ¥è¯¢çº¿ç¨‹æ ‡è¯†
	...
	```

### 4.GCDä¸»çº¿ç¨‹ & ä¸»é˜Ÿåˆ—çš„å…³ç³»

æäº¤åˆ°ä¸»é˜Ÿåˆ—çš„ä»»åŠ¡åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ.

### 5.å¦‚ä½•å®ç°åŒæ­¥ï¼Œæœ‰å¤šå°‘æ–¹å¼å°±è¯´å¤šå°‘

* `dispatch_sync(dispatch_queue_t queue, DISPATCH_NOESCAPE dispatch_block_t block)` åœ¨æŸé˜Ÿåˆ—å¼€å¯åŒæ­¥çº¿ç¨‹
* dispatch_barrier_sync() éšœç¢é”çš„æ–¹å¼åŒæ­¥
* dispatch_group_create() + dispatch_group_wait()
* dispatch_apply() æ’é˜Ÿè¿½åŠ  æ“ä½œåŒæ­¥
* dispatch_semaphore_create() + dispatch_semaphore_wait() ä¿¡å·é‡é”
* ä¸²è¡ŒNSOperationQueueé˜Ÿåˆ—å¹¶å‘æ•°ä¸º1çš„æ—¶å€™ [NSOpertaion start] å¯åŠ¨ä»»åŠ¡å³ä½¿åŒæ­¥æ“ä½œ (NSOperationQueue.maxConcurrentOperationCount = 1)
* `pthread_mutex`åº•å±‚é”å‡½æ•°
* ä¸Šå±‚åº”ç”¨å±‚å°è£…çš„NSLock
* NSRecursiveLock é€’å½’é”ï¼Œè¿™ä¸ªé”å¯ä»¥è¢«åŒä¸€çº¿ç¨‹å¤šæ¬¡è¯·æ±‚ï¼Œè€Œä¸ä¼šå¼•èµ·æ­»é”ã€‚è¿™ä¸»è¦æ˜¯ç”¨åœ¨å¾ªç¯æˆ–é€’å½’æ“ä½œä¸­
* NSConditionLock & NSCondition æ¡ä»¶é”
* @synchronized åŒæ­¥æ“ä½œ  å•ä½æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒº
* dispatch_once() å•ä½æ—¶é—´å†…åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒº
...

### 6.`dispatch_once`å®ç°åŸç†

è¿™ä¸ªé—®é¢˜é—®çš„å¾ˆå‚»åŠä¹Ÿå¾ˆé«˜è¶….å› ä¸ºè¦è§£é‡Šæ¸…æ¥šæ‰€æœ‰æ­¥éª¤éœ€è¦è®°ä½é‡Œé¢æ‰€æœ‰ä»£ç 

æˆ‘è®¤ä¸ºè¿™ä¸ªé—®é¢˜åº”è¯¥ä»æ“ä½œç³»ç»Ÿå±‚é¢å›ç­”, è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯æ“ä½œç³»ç»Ÿè¿”å›çŠ¶æ€å†³å®šçš„,**å•ä½æ—¶é—´å†…æ“ä½œç³»ç»Ÿåªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ä¸´ç•ŒåŒº,è¿›å…¥ä¸´ç•ŒåŒºçš„çº¿ç¨‹ä¼šè¢«æ ‡è®°**

å›å½’åˆ°ä»£ç å°±æ˜¯

``` sh
dispatch_once(dispatch_once_t *val, dispatch_block_t block)  
	|_____dispatch_once_f(val, block, _dispatch_Block_invoke(block))  
		|_______&l->dgo_once  // &l->dgo_once åœ°å€ä¸­å­˜å‚¨çš„å€¼ã€‚æ˜¾ç„¶è‹¥è¯¥å€¼ä¸ºDLOCK_ONCE_DONEï¼Œå³ä¸ºonceå·²ç»æ‰§è¡Œè¿‡
```

`dgo_once`æ˜¯`dispatch_once_gate_s`çš„æˆå‘˜å˜é‡

``` objc
typedef struct dispatch_once_gate_s {
	union {
		dispatch_gate_s dgo_gate;
		uintptr_t dgo_once;
	};
} dispatch_once_gate_s, *dispatch_once_gate_t;
```
æœ‰ä¸ªå†…è”å‡½æ•°`static inline bool
_dispatch_once_gate_tryenter(dispatch_once_gate_t l)`

è¿™ä¸ªå†…è”å‡½æ•°è¿”å›ä¸€ä¸ª åŸå­æ€§æ“ä½œçš„ç»“æœ 

``` 
return os_atomic_cmpxchg(&l->dgo_once, DLOCK_ONCE_UNLOCKED,(uintptr_t)_dispatch_lock_value_for_self(), relaxed)
```
æ¯”è¾ƒ+äº¤æ¢ çš„åŸå­æ“ä½œã€‚æ¯”è¾ƒ `&l->dgo_once` çš„å€¼æ˜¯å¦ç­‰äº `DLOCK_ONCE_UNLOCKED`

è¿™æ ·å°±å®ç°äº†æˆ‘ä»¬çš„æ‰§è¡Œ1æ¬¡çš„GCD API.

[dispatch_onceçš„åº•å±‚å®ç°](https://juejin.im/post/6844904143753052174)

### 7.ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ­»é”

é€ æˆæ­»é”çš„ä¸»è¦æ˜¯ çº¿ç¨‹ä¿¡æ¯ä¸å¯¹ç§°,å‡ºç°Aç­‰Bçš„åŒæ—¶ Bä¹Ÿåœ¨ç­‰Açš„æƒ…å†µ.

``` objc
/// åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œè¿™å¥ä»£ç 
dispatch_sync(dispatch_get_main_queue(), ^{
    NSLog(@"è¿™é‡Œæ­»é”äº†");
});
```

ä¸»çº¿ç¨‹ä¸€ç›´ä¸ä¼šæ‰§è¡Œå®Œ,è¿½åŠ åˆ°ä¸»çº¿ç¨‹åŒæ­¥æ‰§è¡Œçš„ä»»åŠ¡æ˜¾ç„¶æƒ¨æ­».å¡ä½ä¸»çº¿ç¨‹æ— æ³•è‡ªæ‹”.

å…¶å®ƒçš„æƒ…å†µ éƒ½æ˜¯èµ„æºäº§ç”Ÿç«äº‰æˆ–è€…è°ƒç”¨lockçš„å‡½æ•°æ²¡æœ‰è°ƒç”¨unlockå¯¼è‡´,å¼‚æ­¥çº¿ç¨‹ å…ˆåè°ƒç”¨ç­‰äº§ç”Ÿçš„è¾ƒå¤š.


### 8.æœ‰å“ªäº›ç±»å‹çš„çº¿ç¨‹é”ï¼Œåˆ†åˆ«ä»‹ç»ä¸‹ä½œç”¨å’Œä½¿ç”¨åœºæ™¯

| é”ç±»å‹ |  ä½¿ç”¨åœºæ™¯ |  å¤‡æ³¨ |
| :------| :------: | :------ | 
| `pthread_mutex` | äº’æ–¥é” | `PTHREAD_MUTEX_NORMAL`,`#import <pthread.h>`|
| OSSpinLock | è‡ªæ—‹é” | ä¸å®‰å…¨ï¼ŒiOS 10 å·²å¯ç”¨ |
| `os_unfair_lock ` | äº’æ–¥é” | æ›¿ä»£ OSSpinLock |
| `pthread_mutex`(recursive)  | é€’å½’é” | `PTHREAD_MUTEX_RECURSIVE`,`#import <pthread.h>`|
| `pthread_cond_t` | æ¡ä»¶å˜é‡ | `#import <pthread.h>`|
| `pthread_rwlock ` | è¯»å†™é” | è¯»æ“ä½œé‡å…¥ï¼Œå†™æ“ä½œäº’æ–¥ |
| @synchronized | äº’æ–¥é” | æ€§èƒ½å·®ï¼Œä¸”æ— æ³•é”ä½å†…å­˜åœ°å€æ›´æ”¹çš„å¯¹è±¡ |
| NSLock | äº’æ–¥é” | å°è£… `pthread_mutex` |
| NSRecursiveLock | é€’å½’é” | å°è£…`pthread_mutex`(recursive)|
| NSCondition | æ¡ä»¶é”| å°è£… `pthread_cond_t ` | 
| NSConditionLock | æ¡ä»¶é” | å¯ä»¥æŒ‡å®šå…·ä½“æ¡ä»¶å€¼  å°è£… `pthread_cond_t `| 

### 9.NSOperationQueueä¸­çš„maxConcurrentOperationCounté»˜è®¤å€¼

é»˜è®¤å€¼ -1. è¿™ä¸ªå€¼æ“ä½œç³»ç»Ÿä¼šæ ¹æ®èµ„æºä½¿ç”¨çš„ç»¼åˆå¼€é”€æƒ…å†µè®¾ç½®.

### 10.`NSTimerã€CADisplayLinkã€`dispatch_source_t` çš„ä¼˜åŠ£

| å®šæ—¶å™¨ç±»å‹ |  ä¼˜åŠ¿ |  åŠ£åŠ¿ |
| :------| :------: | :------ | 
| NSTimer  |ä½¿ç”¨ç®€å•  | ä¾èµ– Runloopï¼Œå…·ä½“è¡¨ç°åœ¨ æ—  Runloop æ— æ³•ä½¿ç”¨ã€NSRunLoopCommonModesã€ä¸ç²¾ç¡® |
| CADisplayLink  | ä¾èµ–å±å¹•åˆ·æ–°é¢‘ç‡å‡ºå‘äº‹ä»¶,æœ€ç²¾.æœ€åˆé€‚åšUIåˆ·æ–° | è‹¥å±å¹•åˆ·æ–°è¢«å½±å“ï¼Œäº‹ä»¶ä¹Ÿè¢«å½±å“ã€äº‹ä»¶è§¦å‘çš„æ—¶é—´é—´éš”åªèƒ½æ˜¯å±å¹•åˆ·æ–° duration çš„å€æ•°ã€è‹¥äº‹ä»¶æ‰€éœ€æ—¶é—´å¤§äºè§¦å‘äº‹ä»¶ï¼Œè·³è¿‡æ•°æ¬¡ã€ä¸èƒ½è¢«ç»§æ‰¿ |
| `dispatch_source_t` |ä¸ä¾èµ– Runloop | ä¾èµ–çº¿ç¨‹é˜Ÿåˆ—,ä½¿ç”¨éº»çƒ¦ ä½¿ç”¨ä¸å½“å®¹æ˜“Crash |


# æ€»ç»“

ä»Šå¤©è¿™ç¯‡å¤šçº¿ç¨‹ ä¹Ÿç®—æ˜¯ä¸€ä¸ªobjcå¼€å‘è€…çš„çŸ¥è¯†æ€»ç»“,è¿™é‡Œé¢é—®åˆ°çš„çŸ¥è¯†å¤§éƒ¨åˆ†å’Œé˜Ÿåˆ—çº¿ç¨‹å…³ç³»æ¯”è¾ƒå¤š. é«˜é˜¶ä¸€äº›çš„ææ³•å¹¶æ²¡æœ‰. æ¯”å¦‚:å¦‚ä½•åœæ‰`dispatch_source_t `çš„å®šæ—¶å™¨.å†æ¯”å¦‚ ä¸ºä»€ä¹ˆè¦å­˜åœ¨`dispatch_source`. ä¸‹ä¸€ç¯‡æˆ‘ä»¬è®²è§£ä¸€ä¸‹ è§†å›¾&å›¾åƒç›¸å…³æ–‡ç« .




URL: https://sunyazhou.com/2020/09/Block/index.html.md
Published At: 2020-09-17 14:34:10 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹Block

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## block

è¿™ä¸€ç¯‡æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹objcçš„blockå¹¶å›ç­”ä¸€ä¸‹é¢è¯•ä¸­çš„ä¸‹åˆ—é—®é¢˜:
 
1.blockçš„å†…éƒ¨å®ç°ï¼Œç»“æ„ä½“æ˜¯ä»€ä¹ˆæ ·çš„  
2.blockæ˜¯ç±»å—ï¼Œæœ‰å“ªäº›ç±»å‹  
3.ä¸€ä¸ªintå˜é‡è¢« `__block` ä¿®é¥°ä¸å¦çš„åŒºåˆ«ï¼Ÿblockçš„å˜é‡æˆªè·  
4.blockåœ¨ä¿®æ”¹NSMutableArrayï¼Œéœ€ä¸éœ€è¦æ·»åŠ `__block`  
5.æ€ä¹ˆè¿›è¡Œå†…å­˜ç®¡ç†çš„  
6.blockå¯ä»¥ç”¨strongä¿®é¥°å—  
7.è§£å†³å¾ªç¯å¼•ç”¨æ—¶ä¸ºä»€ä¹ˆè¦ç”¨`__strong`ã€`__weak`ä¿®é¥°  
8.`block`å‘ç”Ÿ`copy`æ—¶æœº  
9.`Block`è®¿é—®å¯¹è±¡ç±»å‹çš„`auto`å˜é‡æ—¶ï¼Œåœ¨`ARC`å’Œ`MRC`ä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«

åœ¨å›ç­”æ‰€æœ‰é—®é¢˜ä¹‹å‰æˆ‘ä»¬éœ€è¦äº†è§£ä¸€äº›blockèƒŒæ™¯ç›¸å…³çš„çŸ¥è¯†. å¦‚ä¸‹:

\- å¦‚ä½•æŸ¥çœ‹Blockçš„å†…éƒ¨å®ç°,ä¹Ÿå°±æ˜¯è¯´è½¬æ¢æˆèƒŒåçœŸæ­£çš„c/c++ä»£ç çš„blockæ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿä»¥åŠè½¬æ¢æ ¼å¼æˆ–è€…åŸç†ç­‰.  
\-å…³äºå˜é‡çš„ä½œç”¨åŸŸ

#### Objective-C è½¬ C++çš„æ–¹æ³•

ä¸‹é¢æˆ‘å†™äº†ä¸ªç¤ºä¾‹`TestClass.m`ç±»å…¶ä¸­blockä»£ç å¦‚ä¸‹

OCä»£ç :

``` objc
@interface TestClass ()
@end

@implementation TestClass
- (void)testMethods {
    void (^blockA)(int a) = ^(int a) {
        NSLog(@"%d",a);
    };
    if (blockA) {
        blockA(1990);
    }
}
@end
```

ç»è¿‡ä¸Šè¿°è½¬æ¢æ“ä½œæˆ‘ä»¬åœ¨TestClass.cppä¸­æœ€ä¸‹é¢å‘ç°å¦‚ä¸‹ä»£ç 

C++ä»£ç 

``` objc
// @interface TestClass ()
/* @end */


// @implementation TestClass


struct __TestClass__testMethods_block_impl_0 {
  struct __block_impl impl;
  struct __TestClass__testMethods_block_desc_0* Desc;
  __TestClass__testMethods_block_impl_0(void *fp, struct __TestClass__testMethods_block_desc_0 *desc, int flags=0) {
    impl.isa = &_NSConcreteStackBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
  }
};

static void __TestClass__testMethods_block_func_0(struct __TestClass__testMethods_block_impl_0 *__cself, int a) {

        NSLog((NSString *)&__NSConstantStringImpl__var_folders_wx_b8tcry0j24dbhr7zlzjq3v340000gn_T_TestClass_ee18d3_mi_0,a);
    }

static struct __TestClass__testMethods_block_desc_0 {
  size_t reserved;
  size_t Block_size;
} __TestClass__testMethods_block_desc_0_DATA = { 0, sizeof(struct __TestClass__testMethods_block_impl_0)};

static void _I_TestClass_testMethods(TestClass * self, SEL _cmd) {
    void (*blockA)(int a) = ((void (*)(int))&__TestClass__testMethods_block_impl_0((void *)__TestClass__testMethods_block_func_0, &__TestClass__testMethods_block_desc_0_DATA));
    if (blockA) {
        ((void (*)(__block_impl *, int))((__block_impl *)blockA)->FuncPtr)((__block_impl *)blockA, 1990);
    }
}
```

ä¸Šé¢çš„ä»£ç ç”Ÿæˆæ˜¯é€šè¿‡å¦‚ä¸‹æ“ä½œ:

æ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°TestClass.mæ‰€åœ¨æ–‡ä»¶å¤¹,ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤

``` c++
clang -rewrite-objc TestClass.m
```
å°±ä¼šåœ¨å½“å‰æ–‡ä»¶å¤¹å†…è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„TestClass.cppæ–‡ä»¶

> æ³¨æ„: å¦‚æœæç¤ºclangæ²¡æœ‰çš„è¯ éœ€è¦å®‰è£…, è¾“å…¥å¦‚ä¸‹
   
   ``` sh
   brew install clang-format
   æˆ–è€…
   brew link clang-forma
   ç„¶åè¾“å…¥ ä¸‹é¢å‘½ä»¤æµ‹è¯•æ˜¯å¦å¥½ä½¿
   clang-format --help
   ```

é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å‘ç°Blockçš„å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ç±»å‹

åº•å±‚å®ç° ä¼šæ ¹æ® `__`**ç±»å**`__`**æ–¹æ³•å**`_`block`_`impl`_`**ä¸‹æ ‡** (0ä»£è¡¨è¿™ä¸ªæ–¹æ³•æˆ–è€…è¿™ä¸ªç±»ä¸­ç¬¬0ä¸ªblock ä¸‹é¢å¦‚æœè¿˜æœ‰å°†ä¼š ç¬¬1ä¸ªblock ç¬¬2ä¸ª...)

``` objc
struct __ç±»å__æ–¹æ³•å_block_impl_ä¸‹æ ‡
```

#### å…³äºå˜é‡çš„ä½œç”¨åŸŸ

cè¯­è¨€çš„å‡½æ•°ä¸­å¯èƒ½ä½¿ç”¨çš„å‚æ•°å˜é‡ç§ç±»

* å‚æ•°ç±»å‹
* è‡ªåŠ¨å˜é‡(å±€éƒ¨å˜é‡)
* é™æ€å˜é‡(é™æ€å±€éƒ¨å˜é‡)
* é™æ€å…¨å±€å˜é‡
* å…¨å±€å˜é‡

ç”±äºå­˜å‚¨åŒºåŸŸç‰¹æ®Š,è¿™å…¶ä¸­æœ‰ä¸‰ç§å˜é‡æ˜¯å¯ä»¥åœ¨ä»»ä½•æ—¶å€™ä»¥ä»»ä½•çŠ¶æ€è°ƒç”¨çš„.

* é™æ€å˜é‡
* é™æ€å…¨å±€å˜é‡
* å…¨å±€å˜é‡

è€Œå…¶ä»–ä¸¤ç§,åˆ™æ˜¯æœ‰å„è‡ªç›¸åº”çš„ä½œç”¨åŸŸ,è¶…è¿‡ä½œç”¨åŸŸå,ä¼šè¢«é”€æ¯.  

---


### 1.blockçš„å†…éƒ¨å®ç°ï¼Œç»“æ„ä½“æ˜¯ä»€ä¹ˆæ ·çš„  

çœ‹äº†ä¸Šé¢çš„èƒŒæ™¯çŸ¥è¯†æˆ‘ä»¬æ¥å›åˆ°ä¸€ä¸‹è¿™ä¸ªé—®é¢˜

blockçš„å†…éƒ¨å®ç°å¦‚ä¸‹:

``` objc
struct __TestClass__testMethods_block_impl_0 {
  struct __block_impl impl; //æˆå‘˜å˜é‡
  struct __TestClass__testMethods_block_desc_0* Desc; //desc ç»“æ„ä½“å£°æ˜
  // æ„é€ å‡½æ•°
  // fp å‡½æ•°æŒ‡é’ˆ
  // desc é™æ€å…¨å±€å˜é‡åˆå§‹åŒ–çš„ __main_block_desc_ ç»“æ„ä½“å®ä¾‹æŒ‡é’ˆ
  // flags block çš„è´Ÿè½½ä¿¡æ¯(å¼•ç”¨è®¡æ•°å’Œç±»å‹ä¿¡æ¯),æŒ‰ä½å­˜å‚¨.
  __TestClass__testMethods_block_impl_0(void *fp, struct __TestClass__testMethods_block_desc_0 *desc, int flags=0) {
    impl.isa = &_NSConcreteStackBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
  }
};
//å°†æ¥è¢«è°ƒç”¨çš„blockå†…éƒ¨çš„ä»£ç ï¼šblockå€¼è¢«è½¬æ¢ä¸ºCçš„å‡½æ•°ä»£ç 
//è¿™é‡Œï¼Œ*__cself æ˜¯æŒ‡å‘Blockçš„å€¼çš„æŒ‡é’ˆï¼Œä¹Ÿå°±ç›¸å½“äºæ˜¯Blockçš„å€¼å®ƒè‡ªå·±(ç›¸å½“äºC++é‡Œçš„thisï¼Œ
OCé‡Œçš„self)
//__cself æ˜¯æŒ‡å‘__TestClass__testMethods_block_impl_0ç»“æ„ä½“å®ç°çš„æŒ‡é’ˆ
//Blockç»“æ„ä½“å°±æ˜¯__TestClass__testMethods_block_impl_0ç»“æ„ä½“.Blockçš„å€¼å°±æ˜¯é€šè¿‡__TestClass__testMethods_block_impl_0æ„é€ å‡ºæ¥çš„
static void __TestClass__testMethods_block_func_0(struct __TestClass__testMethods_block_impl_0 *__cself, int a) {
	NSLog((NSString *)&__NSConstantStringImpl__var_folders_wx_b8tcry0j24dbhr7zlzjq3v340000gn_T_TestClass_9f58f7_mi_0,a);
}

static struct __TestClass__testMethods_block_desc_0 {
  size_t reserved;
  size_t Block_size;
} __TestClass__testMethods_block_desc_0_DATA = { 0, sizeof(struct __TestClass__testMethods_block_impl_0)};

static void _I_TestClass_testMethods(TestClass * self, SEL _cmd) {
    void (*blockA)(int a) = ((void (*)(int))&__TestClass__testMethods_block_impl_0((void *)__TestClass__testMethods_block_func_0, &__TestClass__testMethods_block_desc_0_DATA));
    if (blockA) {
        ((void (*)(__block_impl *, int))((__block_impl *)blockA)->FuncPtr)((__block_impl *)blockA, 1990);
    }
}
```

å¯ä»¥çœ‹å¾—å‡ºæ¥`__TestClass__testMethods_block_impl_0`æœ‰3ä¸ªéƒ¨åˆ†ç»„æˆ

* impl å‡½æ•°æŒ‡é’ˆæŒ‡å‘`__TestClass__testMethods_block_impl_0`  

	``` objc
	struct __block_impl {
	  void *isa;
	  int Flags;
	  int Reserved;  //ä»Šåç‰ˆæœ¬å‡çº§æ‰€éœ€çš„åŒºåŸŸ
	  void *FuncPtr; //å‡½æ•°æŒ‡é’ˆ
	};
	```
	
* Desc æŒ‡å‘`__TestClass__testMethods_block_impl_0`çš„DescæŒ‡é’ˆ,ç”¨äºæè¿°å½“å‰è¿™ä¸ªblockçš„é™„åŠ ä¿¡æ¯çš„ï¼ŒåŒ…æ‹¬ç»“æ„ä½“çš„å¤§å°ç­‰ç­‰ä¿¡æ¯.
	
	``` objc
	static struct __TestClass__testMethods_block_desc_0 {
	  size_t reserved; //ä»Šåå‡çº§ç‰ˆæœ¬æ‰€éœ€åŒºåŸŸ
	  size_t Block_size; //blockçš„å¤§å°
	} __TestClass__testMethods_block_desc_0_DATA = { 0, sizeof(struct __TestClass__testMethods_block_impl_0)};
	```
* `__TestClass__testMethods_block_impl_0()`æ„é€ å‡½æ•°,ä¹Ÿå°±æ˜¯è¯¥blockçš„å…·ä½“å®ç°

	``` objc
	__TestClass__testMethods_block_impl_0(void *fp, struct __TestClass__testMethods_block_desc_0 *desc, int flags=0) {
    impl.isa = &_NSConcreteStackBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
	}
	```
	æ­¤ç»“æ„ä½“ä¸­
	* isaæŒ‡é’ˆä¿æŒè¿™æ‰€å±ç±»çš„ç»“æ„ä½“çš„å®ä¾‹çš„æŒ‡é’ˆ.
	* `struct __TestClass__testMethods_block_impl_0`ç›¸å½“äºObjective-Cç±»å¯¹è±¡çš„ç»“æ„ä½“
	* `_NSConcreteStackBlock`ç›¸å½“äºBlockçš„ç»“æ„ä½“å®ä¾‹,ä¹Ÿå°±æ˜¯è¯´**blockå…¶å®å°±æ˜¯Objective-Cå¯¹äºé—­åŒ…çš„å¯¹è±¡å®ç°**

è®²åˆ°è¿™é‡Œblockçš„å†…éƒ¨å®ç°ä½ çœ‹æ‡‚äº†å—?ç»“æ„ä½“æ˜¯ä»€ä¹ˆæ ·çš„ä½ è®°ä½äº†å—? å…¶å®çœ‹ç€ç¹ç ç»†å¿ƒè§‚å¯Ÿä»£ç ä¼šå‘ç°è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„.

### 2.blockæ˜¯ç±»å—ï¼Œæœ‰å“ªäº›ç±»å‹?

blockä¹Ÿç®—æ˜¯ä¸ªç±»,å› ä¸ºå®ƒæœ‰isaæŒ‡é’ˆ,block.isaçš„ç±»å‹åŒ…æ‹¬

* _NSConcreteGlobalBlock è·Ÿå…¨å±€å˜é‡ä¸€æ ·,è®¾ç½®åœ¨ç¨‹åºçš„æ•°æ®åŒºåŸŸ(.data)ä¸­
* _NSConcreteStackBlockæ ˆä¸Š(å‰é¢è®²çš„éƒ½æ˜¯æ ˆä¸Šçš„ block)
* _NSConcreteMallocBlock å †ä¸Š

> è¿™ä¸ªisaå¯ä»¥æŒ‰ä½è¿ç®—

### 3.ä¸€ä¸ªintå˜é‡è¢« `__block` ä¿®é¥°ä¸å¦çš„åŒºåˆ«ï¼Ÿblockçš„å˜é‡æˆªè·

#### è¢«`__block` ä¿®é¥°ä¸å¦çš„åŒºåˆ«
ç”¨ä¸€æ®µç¤ºä¾‹ä»£ç æ¥è§£ç­”è¿™ä¸ªé—®é¢˜å§:

``` objc
__block int a = 10;
int b = 20;
    
PrintTwoIntBlock block = ^(){
    a -= 10;
    printf("%d, %d\n",a,b);
};
    
block();//0 20
    
a += 20;
b += 30;
    
printf("%d, %d\n",a,b);//20 50
    
block();/10 20
 
```
é€šè¿‡`__block`ä¿®é¥°`int` `a`,blockä½“ä¸­å¯¹è¿™ä¸ªå˜é‡çš„å¼•ç”¨æ˜¯æŒ‡é’ˆæ‹·è´,å®ƒä¼šä½œä¸ºblockç»“æ„ä½“æ„é€ å‚æ•°ä¼ å…¥åˆ°ç»“æ„ä½“ä¸­ä¸”å¤åˆ¶è¿™ä¸ªå˜é‡çš„æŒ‡é’ˆå¼•ç”¨ï¼Œä»è€Œè¾¾åˆ°å¯ä»¥ä¿®æ”¹å˜é‡çš„ä½œç”¨.


`int` `b`æ²¡æœ‰è¢«`__block`ä¿®é¥°,blockå†…éƒ¨å¯¹`b`æ˜¯å€¼copy.æ‰€ä»¥åœ¨blockå†…éƒ¨ä¿®æ”¹`b`ä¸å½±å“å¤–éƒ¨bçš„å˜åŒ–.

#### blockçš„å˜é‡æˆªè·

é€šè¿‡å¦‚ä¸‹ä»£ç æˆ‘ä»¬æ¥è§‚å¯Ÿè¦ä¸€ä¸‹å˜é‡çš„æ•è·

``` objc
blk_t blk;
{
    id array = [NSMutableArray new];
    blk = [^(id object){
        [array addObject:object];
        NSLog(@"array count = %ld",[array count]);
    } copy];
}
blk([NSObject new]);
blk([NSObject new]);
blk([NSObject new]);
```
è¾“å‡ºæ‰“å°

``` sh
block_demo[28963:1629127] array count = 1
block_demo[28963:1629127] array count = 2
block_demo[28963:1629127] array count = 3
```
æˆ‘ä»¬æŠŠä¸Šé¢çš„ä»£ç ç¿»è¯‘æˆC++çœ‹ä¸‹

``` c++
struct __main_block_impl_0 {
  struct __block_impl impl;
  struct __main_block_desc_0* Desc;
  id array;//æˆªè·çš„å¯¹è±¡
  __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, id _array, int flags=0) : array(_array) {
    impl.isa = &_NSConcreteStackBlock;
    impl.Flags = flags;
    impl.FuncPtr = fp;
    Desc = desc;
  }
};
```

åœ¨Objcä¸­ï¼ŒCç»“æ„ä½“é‡Œä¸èƒ½å«æœ‰è¢«`__strong`ä¿®é¥°çš„å˜é‡ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“åº”è¯¥ä½•æ—¶åˆå§‹åŒ–å’ŒåºŸå¼ƒCç»“æ„ä½“ã€‚ä½†æ˜¯Objcçš„è¿è¡Œæ—¶åº“èƒ½å¤Ÿå‡†ç¡®æŠŠæ¡`Block`ä»æ ˆå¤åˆ¶åˆ°å †ï¼Œä»¥åŠå †ä¸Šçš„blockè¢«åºŸå¼ƒçš„æ—¶æœºï¼Œåœ¨å®ç°ä¸Šæ˜¯é€šè¿‡`__TestClass__testMethods_block_copy_0`å‡½æ•°å’Œ`__TestClass__testMethods_block_dispose_0`å‡½æ•°è¿›è¡Œçš„

``` objc
static void __TestClass__testMethods_block_copy_0(struct __TestClass__testMethods_block_impl_0*dst, struct __TestClass__testMethods_block_impl_0*src) {
    _Block_object_assign((void*)&dst->array, (void*)src->array, 3/*BLOCK_FIELD_IS_OBJECT*/);
}  
static void __TestClass__testMethods_block_dispose_0(struct __TestClass__testMethods_block_impl_0*src) {
    _Block_object_dispose((void*)src->array, 3/*BLOCK_FIELD_IS_OBJECT*/);
}
```

* `_Block_object_assign`ç›¸å½“äºretainæ“ä½œ,å°†å¯¹è±¡èµ‹å€¼åœ¨å¯¹è±¡ç±»å‹çš„ç»“æ„ä½“æˆå‘˜å˜é‡ä¸­.  
* `_Block_object_dispose`ç›¸å½“äºreleaseæ“ä½œ.  

è¿™ä¸¤ä¸ªå‡½æ•°è°ƒç”¨çš„æ—¶æœºæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘¢ï¼Ÿ

| å‡½æ•° | è¢«è°ƒç”¨æ—¶æœº |
| ------ | ------ |
| `__TestClass__testMethods_block_copy_0 ` | ä»æ ˆå¤åˆ¶åˆ°å †æ—¶ | 
| `__TestClass__testMethods_block_dispose_0 ` | å †ä¸Šçš„Blockè¢«åºŸå¼ƒæ—¶ | 

##### ä»€ä¹ˆæ—¶å€™æ ˆä¸Šçš„Blockä¼šè¢«å¤åˆ¶åˆ°å †å‘¢ï¼Ÿ

* è°ƒç”¨blockçš„copyå‡½æ•°æ—¶ã€‚  
* Blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›æ—¶ã€‚  
* å°†Blockèµ‹å€¼ç»™é™„æœ‰`__strong`ä¿®é¥°ç¬¦idç±»å‹çš„ç±»æˆ–è€…Blockç±»å‹æˆå‘˜å˜é‡æ—¶ã€‚  
* æ–¹æ³•ä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•æˆ–è€…GCDçš„APIä¸­ä¼ é€’Blockæ—¶ã€‚  

##### ä»€ä¹ˆæ—¶å€™Blockè¢«åºŸå¼ƒå‘¢ï¼Ÿ

* å †ä¸Šçš„Blockè¢«é‡Šæ”¾å,è°éƒ½ä¸å†æŒæœ‰Blockæ—¶è°ƒç”¨disposeå‡½æ•°ã€‚

ä»¥ä¸Šå°±æ˜¯å˜é‡è¢«blockæ•è·çš„å†…å®¹

---

### 4.`block`åœ¨ä¿®æ”¹`NSMutableArray`ï¼Œéœ€ä¸éœ€è¦æ·»åŠ `__block`

* å¦‚ä¿®æ”¹`NSMutableArray`çš„å­˜å‚¨å†…å®¹çš„è¯,æ˜¯ä¸éœ€è¦æ·»åŠ `__block`ä¿®é¥°çš„ã€‚
* å¦‚ä¿®æ”¹`NSMutableArray`å¯¹è±¡çš„æœ¬èº«,é‚£å¿…é¡»æ·»åŠ `__block`ä¿®é¥°ã€‚

### 5.æ€ä¹ˆè¿›è¡Œå†…å­˜ç®¡ç†çš„?

åœ¨ä¸Šé¢Blockçš„æ„é€ å‡½æ•°`__TestClass__testMethods_block_impl_0`ä¸­çš„isaæŒ‡é’ˆæŒ‡å‘çš„æ˜¯&_NSConcreteStackBlockï¼Œå®ƒè¡¨ç¤ºå½“å‰çš„Blockä½äºæ ˆåŒºä¸­.

| blockå†…å­˜æ“ä½œ | å­˜å‚¨åŸŸ/å­˜å‚¨ä½ç½® |  copyæ“ä½œçš„å½±å“ |
| :------: | :------: |  :------: |
| _NSConcreteGlobalBlock |ç¨‹åºçš„æ•°æ®åŒºåŸŸ  |  ä»€ä¹ˆä¹Ÿä¸åš |   
| _NSConcreteStackBlock | æ ˆ | ä»æ ˆæ‹·è´åˆ°å † | 
| _NSConcreteMallocBlock| å † | å¼•ç”¨è®¡æ•°å¢åŠ  | 

* å…¨å±€Block:`_NSConcreteGlobalBlock`çš„ç»“æ„ä½“å®ä¾‹è®¾ç½®åœ¨ç¨‹åºçš„æ•°æ®å­˜å‚¨åŒºï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç¨‹åºçš„ä»»æ„ä½ç½®é€šè¿‡æŒ‡é’ˆæ¥è®¿é—®ï¼Œå®ƒçš„äº§ç”Ÿæ¡ä»¶:
	* è®°è¿°å…¨å±€å˜é‡çš„åœ°æ–¹æœ‰blockè¯­æ³•æ—¶.
	* blockä¸æˆªè·çš„è‡ªåŠ¨å˜é‡.  
	
	> ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶åªè¦æ»¡è¶³ä¸€ä¸ªå°±å¯ä»¥äº§ç”Ÿå…¨å±€Block.  [å‚è€ƒ](https://juejin.im/post/6844903474312773646#heading-13)
* æ ˆBlock:`_NSConcreteStackBlock`åœ¨ç”ŸæˆBlockä»¥åï¼Œå¦‚æœè¿™ä¸ªBlockä¸æ˜¯å…¨å±€Block,é‚£å®ƒå°±æ˜¯æ ˆBlock,ç”Ÿå‘½å‘¨æœŸåœ¨å…¶æ‰€å±çš„å˜é‡ä½œç”¨åŸŸå†….(ä¹Ÿå°±æ˜¯è¯´å¦‚æœé”€æ¯å–å†³äºæ‰€å±çš„å˜é‡ä½œç”¨åŸŸ).å¦‚æœBlockå˜é‡å’Œ`__block`å˜é‡å¤åˆ¶åˆ°äº†å †ä¸Šä»¥åï¼Œåˆ™ä¸å†ä¼šå—åˆ°å˜é‡ä½œç”¨åŸŸç»“æŸçš„å½±å“äº†ï¼Œå› ä¸ºå®ƒå˜æˆäº†å †Block.  
* å †Block:`_NSConcreteMallocBlock`å°†æ ˆblockå¤åˆ¶åˆ°å †ä»¥åï¼Œblockç»“æ„ä½“çš„isaæˆå‘˜å˜é‡å˜æˆäº†`_NSConcreteMallocBlock`ã€‚

### 6.blockå¯ä»¥ç”¨strongä¿®é¥°å—?

åœ¨ARCä¸­å¯ä»¥ï¼Œå› ä¸ºåœ¨ARCç¯å¢ƒä¸­çš„blockåªèƒ½åœ¨å †å†…å­˜æˆ–å…¨å±€å†…å­˜ä¸­ï¼Œå› æ­¤ä¸æ¶‰åŠåˆ°ä»æ ˆæ‹·è´åˆ°å †ä¸­çš„æ“ä½œ.

åœ¨MRCä¸­ä¸è¡Œ,å› ä¸ºè¦æœ‰æ‹·è´è¿‡ç¨‹.å¦‚æœæ‰§è¡Œcopyç”¨strongçš„è¯ä¼šcrash, `strong`æ˜¯ARCä¸­å¼•å…¥çš„å…³é”®å­—.å¦‚æœä½¿ç”¨retainç›¸å½“äºå¿½è§†äº†blockçš„copyè¿‡ç¨‹.

### 7.è§£å†³å¾ªç¯å¼•ç”¨æ—¶ä¸ºä»€ä¹ˆè¦ç”¨`__strong`ã€`__weak`ä¿®é¥°?

é¦–å…ˆå› ä¸ºblockæ•è·å˜é‡çš„æ—¶å€™ ç»“æ„ä½“æ„é€ æ—¶ä¼ å…¥äº†self,é€ æˆäº†é»˜è®¤çš„å¼•ç”¨å…³ç³»,æ‰€ä»¥ä¸€èˆ¬åœ¨blockå¤–éƒ¨å¯¹æ“ä½œå¯¹è±¡ä¼šåŠ ä¸Š`__weak`,åœ¨Blockå†…éƒ¨ä½¿ç”¨`__strong`ä¿®é¥°ç¬¦çš„å¯¹è±¡ç±»å‹çš„è‡ªåŠ¨å˜é‡ï¼Œé‚£ä¹ˆå½“Blockä»æ ˆå¤åˆ¶åˆ°å †çš„æ—¶å€™ï¼Œè¯¥å¯¹è±¡å°±ä¼šè¢«Blockæ‰€æŒæœ‰,ä½†æ˜¯æŒæœ‰çš„æ˜¯æˆ‘ä»¬ä¸Šé¢åŠ äº†`__weak`æ‰€ä»¥è¡Œç¨‹äº†æ¯”æ¶ˆæ­¤é•¿çš„é“¾æ¡,åˆšå¥½èƒ½è§£å†³blockå»¶è¿Ÿé”€æ¯çš„æ—¶å€™å¯¹å¤–éƒ¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé€ æˆçš„å½±å“.å¦‚æœä¸è¿™æ ·åšå¾ˆå®¹æ˜“é€ æˆå¾ªç¯å¼•ç”¨.


### 8.blockå‘ç”Ÿcopyæ—¶æœº?

åœ¨ARCä¸­,ç¼–è¯‘å™¨å°†åˆ›å»ºåœ¨æ ˆä¸­çš„blockä¼šè‡ªåŠ¨æ‹·è´åˆ°å †å†…å­˜ä¸­,è€Œblockä½œä¸ºæ–¹æ³•æˆ–å‡½æ•°çš„å‚æ•°ä¼ é€’æ—¶,ç¼–è¯‘å™¨ä¸ä¼šåšcopyæ“ä½œ.

* è°ƒç”¨blockçš„copyå‡½æ•°æ—¶ã€‚  
* Blockä½œä¸ºå‡½æ•°è¿”å›å€¼è¿”å›æ—¶ã€‚  
* å°†Blockèµ‹å€¼ç»™é™„æœ‰`__strong`ä¿®é¥°ç¬¦idç±»å‹çš„ç±»æˆ–è€…Blockç±»å‹æˆå‘˜å˜é‡æ—¶ã€‚  
* æ–¹æ³•ä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•æˆ–è€…GCDçš„APIä¸­ä¼ é€’Blockæ—¶ã€‚

### 9.Blockè®¿é—®å¯¹è±¡ç±»å‹çš„autoå˜é‡æ—¶ï¼Œåœ¨ARCå’ŒMRCä¸‹æœ‰ä»€ä¹ˆåŒºåˆ«?

ARCä¸‹ä¼šå¯¹è¿™ä¸ªå¯¹è±¡å¼ºå¼•ç”¨ï¼ŒMRCä¸‹ä¸ä¼š

[è¯¦ç»†è¯·å‚è€ƒ](https://juejin.im/post/6844903474312773646)



URL: https://sunyazhou.com/2020/09/iOSinterviewAnswers5/index.html.md
Published At: 2020-09-02 11:23:24 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹Runloop&KVO

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

[å‰å‡ ç¯‡](https://www.sunyazhou.com/tags/iOS%E9%9D%A2%E8%AF%95%E9%A2%98/)æˆ‘ä»¬ä¸€è·¯è®²äº†å†…å­˜,å…³è”å¯¹è±¡ã€ARCã€AutoreleasePoolã€weakå¯¹è±¡, NSNotifacionCenterç­‰, ä»Šå¤©è¿™ä¸€ç¯‡æˆ‘ä»¬æ¥è®²ä¸€ä¸‹ Runloopå’ŒKVO


æœ¬ç« çš„ä¸»è¦å›ç­”çš„é—®é¢˜å¦‚ä¸‹:

#### Runloop

* appå¦‚ä½•æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶çš„
* ä¸ºä»€ä¹ˆåªæœ‰ä¸»çº¿ç¨‹çš„runloopæ˜¯å¼€å¯çš„
* ä¸ºä»€ä¹ˆåªåœ¨ä¸»çº¿ç¨‹åˆ·æ–°UI
* PerformSelectorå’Œrunloopçš„å…³ç³»
* å¦‚ä½•ä½¿çº¿ç¨‹ä¿æ´»

#### KVO

* å®ç°åŸç†
* å¦‚ä½•æ‰‹åŠ¨å…³é—­kvo
* é€šè¿‡KVCä¿®æ”¹å±æ€§ä¼šè§¦å‘KVOä¹ˆ
* å“ªäº›æƒ…å†µä¸‹ä½¿ç”¨kvoä¼šå´©æºƒï¼Œæ€ä¹ˆé˜²æŠ¤å´©æºƒ
* kvoçš„ä¼˜ç¼ºç‚¹

## Runloop

ä½œä¸ºä¸€ä¸ªåˆæ ¼çš„iOSå¼€å‘è€…å¿…é¡»å¯¹runloopæœ‰ä¸€ä¸ªæ›´æ·±å…¥çš„äº†è§£,ä¸‹é¢æˆ‘ä»¬æ¥å›ç­”ä¸€ä¸‹ ç›¸å…³é—®é¢˜

### 1.appå¦‚ä½•æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶çš„

å›ç­”è¿™ä¸ªé—®é¢˜å‰è¯·è®¤çœŸé˜…è¯»ä¸€ä¸‹ [iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶](https://mp.weixin.qq.com/s/9rvSRt4kfpy7e87EJoaJOQ)

![](/assets/images/20200902iOSinterviewAnswers/runloop_event_receive.webp)

é€šè¿‡ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ•´ä¸ªæµç¨‹å°±æ˜¯ æˆ‘ä»¬appå¯åŠ¨é»˜è®¤ä¼šé€šè¿‡machPortç›‘å¬ç«¯å£çš„æ–¹å¼ æ¥æ¥å—IOHIDEvent æ¥æ¥æ”¶å’Œå¤„ç†è§¦æ‘¸äº‹ä»¶.

### 2.ä¸ºä»€ä¹ˆåªæœ‰ä¸»çº¿ç¨‹çš„runloopæ˜¯å¼€å¯çš„

mian()å‡½æ•°ä¸­è°ƒç”¨UIApplicationMainï¼Œè¿™é‡Œä¼šåˆ›å»ºä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œç”¨äºUIå¤„ç†ï¼Œä¸ºäº†è®©ç¨‹åºå¯ä»¥ä¸€ç›´è¿è¡Œå¹¶æ¥æ”¶äº‹ä»¶ï¼Œæ‰€ä»¥åœ¨ä¸»çº¿ç¨‹ä¸­å¼€å¯ä¸€ä¸ªrunloopï¼Œè®©ä¸»çº¿ç¨‹å¸¸é©».

### 3.ä¸ºä»€ä¹ˆåªåœ¨ä¸»çº¿ç¨‹åˆ·æ–°UI

æˆ‘ä»¬æ‰€æœ‰ç”¨åˆ°çš„UIéƒ½æ˜¯æ¥è‡ªäºUIKitè¿™ä¸ªåŸºç¡€åº“.å› ä¸ºobjcä¸æ˜¯ä¸€é—¨çº¿ç¨‹å®‰å…¨çš„è¯­è¨€æ‰€ä»¥å­˜åœ¨å¤šçº¿ç¨‹è¯»å†™ä¸åŒæ­¥çš„é—®é¢˜,å¦‚æœä½¿ç”¨åŠ é”çš„æ–¹å¼æ“ä½œç³»ç»Ÿå¼€é”€å¾ˆå¤§,ä¼šè€—è´¹å¤§é‡çš„ç³»ç»Ÿèµ„æº(å†…å­˜ã€æ—¶é—´ç‰‡è½®è½¬ã€cpuå¤„ç†é€Ÿåº¦...)ï¼ŒåŠ ä¸Šä¸Šé¢è®²åˆ°çš„ç³»ç»Ÿäº‹ä»¶çš„æ¥æ”¶å¤„ç†éƒ½åœ¨ä¸»çº¿ç¨‹,å¦‚æœUIå¼‚æ­¥çº¿ç¨‹çš„è¯ è¿˜ä¼šå­˜åœ¨ åŒæ­¥å¤„ç†äº‹ä»¶çš„é—®é¢˜,æ‰€ä»¥å¤šç‚¹è§¦æ‘¸æ‰‹åŠ¿ç­‰ä¸€äº›äº‹ä»¶è¦ä¿æŒå’ŒUIåœ¨åŒä¸€ä¸ªçº¿ç¨‹ç›¸å¯¹æ˜¯æœ€ä¼˜è§£.

å¦ä¸€æ–¹é¢æ˜¯ å±å¹•çš„æ¸²æŸ“æ˜¯ 60å¸§(60Hz/ç§’), ä¹Ÿå°±æ˜¯1ç§’é’Ÿå›è°ƒ60æ¬¡çš„é¢‘ç‡,(iPad Pro æ˜¯120Hz/ç§’),æˆ‘ä»¬çš„runloop ç†æƒ³çŠ¶æ€ä¸‹ä¹Ÿä¼šæŒ‰ç…§æ—¶é’Ÿå‘¨æœŸ å›è°ƒ60æ¬¡(iPad Pro 120æ¬¡), è¿™ä¹ˆé«˜é¢‘ç‡çš„è°ƒç”¨æ˜¯ä¸ºäº† å±å¹•å›¾åƒæ˜¾ç¤ºèƒ½å¤Ÿå‚ç›´åŒæ­¥ ä¸å¡é¡¿.åœ¨å¼‚æ­¥çº¿ç¨‹çš„è¯æ˜¯å¾ˆéš¾ä¿è¯è¿™ä¸ªå¤„ç†è¿‡ç¨‹çš„åŒæ­¥æ›´æ–°. å³ä¾¿èƒ½ä¿è¯çš„è¯ ç›¸å¯¹ä¸»çº¿ç¨‹è€Œè¨€ ç³»ç»Ÿèµ„æºå¼€é”€ çº¿ç¨‹è°ƒåº¦ç­‰ç­‰å°†ä¼šå æ®å¤§éƒ¨åˆ†èµ„æºå’Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹åªä¸“é—¨å¹²ä¸€ä»¶äº‹æœ‰ç‚¹å¾—ä¸å¿å¤±.

### 4.PerformSelectorå’Œrunloopçš„å…³ç³»

å½“è°ƒç”¨NSObectçš„ performSelector:ç›¸å…³çš„æ—¶å€™,å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ªtimerå®šæ—¶å™¨æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„runloopä¸­,å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰å¯åŠ¨runloop,åˆ™è¯¥æ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨.  

å¼€å‘ä¸­é‡åˆ°æœ€å¤šçš„é—®é¢˜å°±æ˜¯è¿™ä¸ªperformSelector: å¯¼è‡´å¯¹è±¡çš„å»¶è¿Ÿé‡Šæ”¾,è¿™é‡Œå¼€å‘è¿‡ç¨‹ä¸­æ³¨æ„ä¸€ä¸‹,å¯ä»¥ç”¨å•æ¬¡çš„NSTimeræ›¿ä»£.

è¯¦ç»†å¯ä»¥å‚è€ƒ[Runloopä¸performSelector](https://juejin.im/post/6844903781755256840)

### 5.å¦‚ä½•ä½¿çº¿ç¨‹ä¿æ´»ï¼Ÿ

æƒ³è¦çº¿ç¨‹ä¿æ´»çš„è¯å°±å¼€å¯è¯¥çº¿ç¨‹çš„runloopå³å¯,æ³¨æ„:åœ¨NSThreadæ‰§è¡Œçš„æ–¹æ³•ä¸­æ·»åŠ while(true){}ï¼Œè¿™æ ·æ˜¯æ¨¡æ‹Ÿrunloopçš„è¿è¡ŒåŸç†ï¼Œç»“åˆGCDçš„ä¿¡å·é‡ï¼Œåœ¨{}ä»£ç å—ä¸­å¤„ç†ä»»åŠ¡.

ä½†æ˜¯æ³¨æ„ å¼€å¯runloopçš„æ–¹æ³•è¦æ­£ç¡®

å¦‚ä¸‹ä»£ç 

``` objc
//æµ‹è¯•å¼€å¯çº¿ç¨‹
- (void)memoryTest {
    for (int i = 0; i < 100000; ++i) {
        NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(run) object:nil];
        [thread start];
        [self performSelector:@selector(stopThread) onThread:thread withObject:nil waitUntilDone:YES];
    }
}
//çº¿ç¨‹åœæ­¢
- (void)stopThread {
    CFRunLoopStop(CFRunLoopGetCurrent());
    NSThread *thread = [NSThread currentThread];
    [thread cancel];
}
//è¿è¡Œçº¿ç¨‹çš„runloop æ³¨æ„ æ„æ·»åŠ çš„é‚£ä¸ªç©ºport,å¦åˆ™ä¼šå‡ºç°å†…å­˜æ³„éœ²
- (void)run {
    @autoreleasepool {
        NSLog(@"current thread = %@", [NSThread currentThread]);
        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
        if (!self.emptyPort) {
            self.emptyPort = [NSMachPort port];
        }
        [runLoop addPort:self.emptyPort forMode:NSDefaultRunLoopMode];
        [runLoop runMode:NSRunLoopCommonModes beforeDate:[NSDate distantFuture]];
    }
}
//ä¸‹åˆ—ä»£ç ç”¨äºæ¨¡æ‹Ÿçº¿ç¨‹å†…éƒ¨åšçš„ä¸€äº›è€—æ—¶ä»»åŠ¡
- (void)printSomething {
    NSLog(@"current thread = %@", [NSThread currentThread]);
    [self performSelector:@selector(printSomething) withObject:nil afterDelay:1];
}
//æ¨¡æ‹Ÿæ‰‹åŠ¨ç‚¹å‡»æŒ‰é’® è®© runloopåœæ‰
- (void)stopButtonDidClicked:(id)sender {
    [self performSelector:@selector(stopRunloop) onThread:self.thread withObject:nil waitUntilDone:YES];
}

- (void)stopRunloop {
    CFRunLoopStop(CFRunLoopGetCurrent());
}
```
è¯¦ç»†è¯·å‚è€ƒ:[iOSå¼€å‘æ·±å…¥ç ”ç©¶Runloopä¸çº¿ç¨‹ä¿æ´»](https://allluckly.cn/%E6%8A%95%E7%A8%BF/tuogao55)

## KVO

åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ç»å¸¸ä½¿ç”¨KVO,ä¸‹é¢è§£ç­”ä¸€ä¸‹KVOç›¸å…³çš„é—®é¢˜.

### KVOçš„å®ç°åŸç†

é€šè¿‡`runtime`æ´¾ç”Ÿå­ç±»çš„æ–¹å¼ å¤å†™ç›¸å…³éœ€è¦KVOç›‘å¬çš„å±æ€§,åœ¨è¯¥å±æ€§setterä¹‹å‰å’Œä¹‹åè°ƒç”¨NSObjectçš„ç›‘å¬æ–¹æ³•,è¿™æ ·KVOå°±å®ç°äº†å±æ€§å˜æ¢å‰åçš„å›è°ƒ.

KVOæ´¾ç”Ÿçš„å­ç±»å…·ä½“æ ¼å¼åº”è¯¥æ˜¯:`NSKVONotifying_+ç±»å`çš„ç±» eg: NSKVONotifying_Person

ä¸‹é¢ç¤ºä¾‹ä»£ç ä¸ºPersonç±»çš„nameæ·»åŠ KVOçš„æ¨¡æ‹Ÿå®éªŒ

``` objc
- (void)setName:(NSString *)name{
    _NSSetObjectValueAndNotify();
}

void _NSSetObjectValueAndNotify {
    [self willChangeValueForKey:@"name"];
    [super setName:name];
    [self didChangeValueForKey:@"name"];
}

- (void)didChangeValueForKey:(NSString *)key{
    [observe observeValueForKeyPath:key ofObject:self change:nil context:nil];
}
```

é—®é¢˜æ¥äº†å¦‚ä½•åŠ¨æ€åˆ›å»ºç±»å‘¢?

``` objc
//åŠ¨æ€åˆ›å»ºXXCustomClass
Class customClass = objc_allocateClassPair([NSObject class], "XXCustomClass", 0);
// æ·»åŠ å®ä¾‹å˜é‡
class_addIvar(customClass, "age", sizeof(int), 0, "i");
// åŠ¨æ€æ·»åŠ æ–¹æ³•
class_addMethod(customClass, @selector(hahahha), (IMP)hahahha, "V@:");

//éœ€è¦å®ç°çš„æ–¹æ³•
void hahahha(id self, SEL _cmd)
{
    NSLog(@"hahahha====");
}

- (void)hahahha{

}

//æœ€åæ³¨å†Œåˆ°è¿è¡Œæ—¶ç¯å¢ƒ
objc_registerClassPair(customClass);

```

> [V@:è¡¨ç¤ºæ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1)

å…·ä½“åŸç†ä»¥åŠè‡ªå®šä¹‰å®ç°KVOå¯ä»¥å‚è€ƒ[KVOè¯¦è§£åŠåº•å±‚å®ç°](https://cloud.tencent.com/developer/article/1136759)


### å¦‚ä½•æ‰‹åŠ¨å…³é—­KVO?

è¢«è§‚å¯Ÿçš„å¯¹è±¡å¤å†™å¦‚ä¸‹æ–¹æ³• è¿”å›`NO`å³å¯å…³é—­KVO
``` objc
+ (BOOL)automaticallyNotifiesObserversForKey:(NSString *)key {
	return NO;
}
```

å¦‚æœå…³é—­åè¿˜æƒ³è§¦å‘ KVOçš„è¯ ä¿®æ”¹éœ€è¦æ‰‹åŠ¨è°ƒç”¨åœ¨å˜é‡setterçš„å‰å ä¸»åŠ¨è°ƒç”¨ `willChangeValueForKey:`å’Œ`didChangeValueForKey:`

### é€šè¿‡KVCä¿®æ”¹å±æ€§ä¼šè§¦å‘KVOä¹ˆ?

ä¼šçš„ 

### å“ªäº›æƒ…å†µä¸‹ä½¿ç”¨kvoä¼šå´©æºƒï¼Œæ€ä¹ˆé˜²æŠ¤å´©æºƒï¼Ÿ

ä½¿ç”¨ä¸å½“ ä¼šcrash,æ¯”å¦‚:

\- æ·»åŠ å’Œç§»å‡ºä¸æ˜¯æˆå¯¹å‡ºç°ä¸”å­˜åœ¨å¤šçº¿ç¨‹æ·»åŠ KVOçš„æƒ…å†µ,ç»å¸¸é‡åˆ°çš„crashæ˜¯ç§»å‡º
\- å†…å­˜deallocçš„æ—¶å€™ æˆ–è€…å¯¹è±¡é”€æ¯å‰æ²¡æœ‰æ­£ç¡®ç§»å‡ºObserver

å¦‚ä½•é˜²æŠ¤ï¼Ÿ

1.æ³¨æ„ç§»å‡ºå¯¹è±¡ åŒ¹é…  
2.å†…å­˜é‡æŒ‡é’ˆé—®é¢˜,ä¸€å®šè¦åœ¨å¯¹è±¡é”€æ¯å‰ç§»å‡ºè§‚å¯Ÿè€…
3.å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“BlockKitæ·»åŠ KVO,blockkitå†…éƒ¨ä¼šè‡ªåŠ¨ç§»é™¤Observeré¿å…crash.

### KVOçš„ä¼˜ç¼ºç‚¹

ä¼˜ç‚¹:

\- æ–¹ä¾¿ä¸¤ä¸ªå¯¹è±¡é—´åŒæ­¥çŠ¶æ€(keypath)æ›´åŠ æ–¹ä¾¿,ä¸€èˆ¬éƒ½æ˜¯åœ¨Aç±»è¦è§‚å¯ŸBç±»çš„å±æ€§çš„å˜åŒ–.  
\- éä¾µå…¥å¼çš„å¾—åˆ°æŸå†…éƒ¨å¯¹è±¡çš„çŠ¶æ€æ”¹å˜å¹¶ä½œå‡ºå“åº”.(å°±æ˜¯åœ¨ä¸æ”¹å˜åŸæ¥å¯¹è±¡ç±»çš„ä»£ç æƒ…å†µä¸‹å³å¯åšå‡ºå¯¹è¯¥å¯¹è±¡çš„çŠ¶æ€å˜åŒ–è¿›è¡Œç›‘å¬)  
\- å¯ä»¥åµŒå…¥æ›´æ”¹å‰åçš„ä¸¤ä¸ªæ—¶æœºçš„çŠ¶æ€.
\- å¯ä»¥é€šè¿‡Keypathså¯¹åµŒå¥—å¯¹è±¡çš„ç›‘å¬.

ç¼ºç‚¹:

\- éœ€è¦æ‰‹åŠ¨ç§»é™¤è§‚å¯Ÿè€…,ä¸ç§»é™¤å®¹æ˜“é€ æˆcrash.  
\- æ³¨å†Œå’Œç§»å‡ºæˆå¯¹åŒ¹é…å‡ºç°.  
\- keypathå‚æ•°çš„ç±»å‹String, å¦‚æœå¯¹è±¡çš„æˆå‘˜å˜é‡è¢«é‡æ„è€Œå˜åŒ–å­—ç¬¦ä¸²ä¸ä¼šè¢«ç¼–è¯‘å™¨è¯†åˆ«è€ŒæŠ¥é”™.  
\- å®ç°è§‚å¯Ÿçš„æ–¹å¼æ˜¯å¤å†™NSObjecçš„ç›¸å…³KVOçš„æ–¹æ³•,åº”è¯¥æ›´åŠ é¢å‘protocolçš„æ–¹å¼ä¼šæ›´å¥½.  


## æ€»ç»“

è¿™ä¸€ç¯‡æˆ‘ä»¬è®²äº† runloopå’ŒKVOç›¸å…³çš„å†…å®¹,è¿™é‡Œé¢æœ€è´Ÿè´£çš„å½“å±runloopå¦‚ä½•å¤„ç†è§¦æ‘¸æ‰‹åŠ¿äº‹ä»¶.å»ºè®®è®¤çœŸç ”è¯»ç›¸å…³é“¾æ¥æ–‡ç« .è¿™æ ·æ‰æœ‰ä¸€ä¸ªå¯¹runloopæ›´æ·±åˆ»çš„ç†è§£, ä¸‹ä¸€ç¯‡æˆ‘ä»¬è®²ä¸€ä¸‹Block,æ•¬è¯·æœŸå¾….



URL: https://sunyazhou.com/2020/09/iOSinterviewAnswers4/index.html.md
Published At: 2020-09-01 10:15:27 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹NSNotificationç›¸å…³

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


å‰3ç¯‡ä¸­å·²ç»è®²å®Œäº†å†…å­˜ç®¡ç†,ä»Šå¤©æˆ‘ä»¬ç»§ç»­å®Œæˆ[é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜](https://juejin.im/post/6844904064937902094)çš„é€šçŸ¥éƒ¨åˆ†. ä¸»è¦å†…å®¹åŒ…å«å¦‚ä¸‹:

* å®ç°åŸç†ï¼ˆç»“æ„è®¾è®¡ã€é€šçŸ¥å¦‚ä½•å­˜å‚¨çš„ã€name&observer&SELä¹‹é—´çš„å…³ç³»ç­‰ï¼‰
* é€šçŸ¥çš„å‘é€æ—¶åŒæ­¥çš„ï¼Œè¿˜æ˜¯å¼‚æ­¥çš„
* NSNotificationCenteræ¥å—æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œå—ï¼Ÿå¦‚ä½•å¼‚æ­¥å‘é€æ¶ˆæ¯
* NSNotificationQueueæ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥å‘é€ï¼Ÿåœ¨å“ªä¸ªçº¿ç¨‹å“åº”
* NSNotificationQueueå’Œrunloopçš„å…³ç³»
* å¦‚ä½•ä¿è¯é€šçŸ¥æ¥æ”¶çš„çº¿ç¨‹åœ¨ä¸»çº¿ç¨‹
* é¡µé¢é”€æ¯æ—¶ä¸ç§»é™¤é€šçŸ¥ä¼šå´©æºƒå—
* å¤šæ¬¡æ·»åŠ åŒä¸€ä¸ªé€šçŸ¥ä¼šæ˜¯ä»€ä¹ˆç»“æœï¼Ÿå¤šæ¬¡ç§»é™¤é€šçŸ¥å‘¢
* ä¸‹é¢çš„æ–¹å¼èƒ½æ¥æ”¶åˆ°é€šçŸ¥å—ï¼Ÿä¸ºä»€ä¹ˆ  
	``` objc
	// å‘é€é€šçŸ¥
	[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleNotification:) name:@"TestNotification" object:@1];
	// æ¥æ”¶é€šçŸ¥
	[NSNotificationCenter.defaultCenter postNotificationName:@"TestNotification" object:nil];
	```
	
	

åœ¨è§£é‡Šè¿™äº›å†…å®¹ä¹‹å‰ å¼ºçƒˆå»ºè®®è®¤çœŸç ”è¯»ä¸€ä¸‹è¿™ç¯‡ [ä¸€æ–‡å…¨è§£iOSé€šçŸ¥æœºåˆ¶(ç»å…¸æ”¶è—)](https://juejin.im/post/6844904082516213768)æ–‡ç«  äº†è§£ä¸€ä¸‹å¤§æ¦‚ æ‰€æœ‰çš„é—®é¢˜å°±è¿åˆƒè€Œè§£äº†.


## å®ç°åŸç†ï¼ˆç»“æ„è®¾è®¡ã€é€šçŸ¥å¦‚ä½•å­˜å‚¨çš„ã€name&observer&SELä¹‹é—´çš„å…³ç³»ç­‰

é¦–å…ˆé€šçŸ¥ä¸­å¿ƒç»“æ„å¤§æ¦‚åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªç±»

* `NSNotification` é€šçŸ¥çš„æ¨¡å‹ nameã€objectã€userinfo.
* `NSNotificationCenter`é€šçŸ¥ä¸­å¿ƒ è´Ÿè´£å‘é€`NSNotification`
* `NSNotificationQueue`é€šçŸ¥é˜Ÿåˆ— è´Ÿè´£åœ¨æŸäº›æ—¶æœºè§¦å‘ è°ƒç”¨`NSNotificationCenter`é€šçŸ¥ä¸­å¿ƒ `post`é€šçŸ¥

é€šçŸ¥æ˜¯ç»“æ„ä½“é€šè¿‡åŒå‘é“¾è¡¨è¿›è¡Œæ•°æ®å­˜å‚¨

``` objc
// æ ¹å®¹å™¨ï¼ŒNSNotificationCenteræŒæœ‰
typedef struct NCTbl {
  Observation		*wildcard;	/* é“¾è¡¨ç»“æ„ï¼Œä¿å­˜æ—¢æ²¡æœ‰nameä¹Ÿæ²¡æœ‰objectçš„é€šçŸ¥ */
  GSIMapTable		nameless;	/* å­˜å‚¨æ²¡æœ‰nameä½†æ˜¯æœ‰objectçš„é€šçŸ¥	*/
  GSIMapTable		named;		/* å­˜å‚¨å¸¦æœ‰nameçš„é€šçŸ¥ï¼Œä¸ç®¡æœ‰æ²¡æœ‰object	*/
    ...
} NCTable;

// Observation å­˜å‚¨è§‚å¯Ÿè€…å’Œå“åº”ç»“æ„ä½“ï¼ŒåŸºæœ¬çš„å­˜å‚¨å•å…ƒ
typedef	struct	Obs {
  id		observer;	/* è§‚å¯Ÿè€…ï¼Œæ¥æ”¶é€šçŸ¥çš„å¯¹è±¡	*/
  SEL		selector;	/* å“åº”æ–¹æ³•		*/
  struct Obs	*next;		/* Next item in linked list.	*/
  ...
} Observation;

```
ä¸»è¦æ˜¯ä»¥`key` `value`çš„å½¢å¼å­˜å‚¨,è¿™é‡Œéœ€è¦é‡ç‚¹å¼ºè°ƒä¸€ä¸‹ é€šçŸ¥ä»¥ `name`å’Œ`object`ä¸¤ä¸ªçº¬åº¦æ¥å­˜å‚¨ç›¸å…³é€šçŸ¥å†…å®¹,ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ·»åŠ é€šçŸ¥çš„æ—¶å€™ä¼ å…¥çš„ä¸¤ä¸ªä¸åŒçš„æ–¹æ³•.

![](/assets/images/20200901iOSinterviewAnswers/NCTable.webp)  
![](/assets/images/20200901iOSinterviewAnswers/NCTable2.webp)  

ç®€å•ç†è§£`name`&`observer`&`SEL`ä¹‹é—´çš„å…³ç³»å°±æ˜¯`name`ä½œä¸º`key`, `observer`ä½œä¸ºè§‚å¯Ÿè€…å¯¹è±¡,å½“åˆé€‚æ—¶æœºè§¦å‘å°±ä¼šè°ƒç”¨`observer`çš„`SEL`.è¿™åŸºæœ¬å¾ˆç®€å•,å¦‚æœè§‰å¾—æˆ‘è¯´çš„ä¸å‡†ç¡®å¯ä»¥çœ‹ä¸‹æ–‡ç« å¼€å¤´çš„æ–‡ç« .

## é€šçŸ¥çš„å‘é€æ—¶åŒæ­¥çš„ï¼Œè¿˜æ˜¯å¼‚æ­¥çš„

åŒæ­¥å‘é€.å› ä¸ºè¦è°ƒç”¨æ¶ˆæ¯è½¬å‘.æ‰€è°“å¼‚æ­¥ï¼ŒæŒ‡çš„æ˜¯**éå®æ—¶å‘é€**è€Œæ˜¯**åœ¨åˆé€‚çš„æ—¶æœºå‘é€**ï¼Œå¹¶æ²¡æœ‰å¼€å¯å¼‚æ­¥çº¿ç¨‹.

## NSNotificationCenteræ¥å—æ¶ˆæ¯å’Œå‘é€æ¶ˆæ¯æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹é‡Œå—ï¼Ÿå¦‚ä½•å¼‚æ­¥å‘é€æ¶ˆæ¯

æ˜¯çš„, å¼‚æ­¥çº¿ç¨‹å‘é€é€šçŸ¥åˆ™å“åº”å‡½æ•°ä¹Ÿæ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹.

å¼‚æ­¥å‘é€é€šçŸ¥å¯ä»¥å¼€å¯å¼‚æ­¥çº¿ç¨‹å‘é€å³å¯.

## NSNotificationQueueæ˜¯å¼‚æ­¥è¿˜æ˜¯åŒæ­¥å‘é€ï¼Ÿåœ¨å“ªä¸ªçº¿ç¨‹å“åº”

``` objc
// è¡¨ç¤ºé€šçŸ¥çš„å‘é€æ—¶æœº
typedef NS_ENUM(NSUInteger, NSPostingStyle) {
    NSPostWhenIdle = 1, // runloopç©ºé—²æ—¶å‘é€é€šçŸ¥
    NSPostASAP = 2, // å°½å¿«å‘é€ï¼Œè¿™ç§æ—¶æœºæ˜¯ç©¿æ’åœ¨æ¯æ¬¡äº‹ä»¶å®ŒæˆæœŸé—´æ¥åšçš„
    NSPostNow = 3 // ç«‹åˆ»å‘é€æˆ–è€…åˆå¹¶é€šçŸ¥å®Œæˆä¹‹åå‘é€
};
```

|  | NSPostWhenIdle |  NSPostASAP  | NSPostNow |
| ------| ------ |  ------ |  ------ |
| NSPostingStyle | å¼‚æ­¥å‘é€ | å¼‚æ­¥å‘é€ | åŒæ­¥å‘é€ |

`NSNotificationCenter`éƒ½æ˜¯åŒæ­¥å‘é€çš„ï¼Œè€Œè¿™é‡Œä»‹ç»å…³äº`NSNotificationQueue`çš„å¼‚æ­¥å‘é€ï¼Œä»çº¿ç¨‹çš„è§’åº¦çœ‹å¹¶ä¸æ˜¯çœŸæ­£çš„å¼‚æ­¥å‘é€ï¼Œæˆ–å¯ç§°ä¸º**å»¶æ—¶å‘é€**ï¼Œå®ƒæ˜¯åˆ©ç”¨äº†`runloop`çš„æ—¶æœºæ¥è§¦å‘çš„.

å¼‚æ­¥çº¿ç¨‹å‘é€é€šçŸ¥åˆ™å“åº”å‡½æ•°ä¹Ÿæ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹,ä¸»çº¿ç¨‹å‘é€åˆ™åœ¨ä¸»çº¿ç¨‹.

## NSNotificationQueueå’Œrunloopçš„å…³ç³»

`NSNotificationQueue`ä¾èµ–`runloop`. å› ä¸ºé€šçŸ¥é˜Ÿåˆ—è¦åœ¨runloopå›è°ƒçš„æŸä¸ªæ—¶æœºè°ƒç”¨é€šçŸ¥ä¸­å¿ƒå‘é€é€šçŸ¥.ä»ä¸‹é¢çš„æšä¸¾å€¼å°±èƒ½çœ‹å‡ºæ¥

``` objc
// è¡¨ç¤ºé€šçŸ¥çš„å‘é€æ—¶æœº
typedef NS_ENUM(NSUInteger, NSPostingStyle) {
    NSPostWhenIdle = 1, // runloopç©ºé—²æ—¶å‘é€é€šçŸ¥
    NSPostASAP = 2, // å°½å¿«å‘é€ï¼Œè¿™ç§æ—¶æœºæ˜¯ç©¿æ’åœ¨æ¯æ¬¡äº‹ä»¶å®ŒæˆæœŸé—´æ¥åšçš„
    NSPostNow = 3 // ç«‹åˆ»å‘é€æˆ–è€…åˆå¹¶é€šçŸ¥å®Œæˆä¹‹åå‘é€
};
```

## å¦‚ä½•ä¿è¯é€šçŸ¥æ¥æ”¶çš„çº¿ç¨‹åœ¨ä¸»çº¿ç¨‹

å¦‚æœæƒ³åœ¨ä¸»çº¿ç¨‹å“åº”å¼‚æ­¥é€šçŸ¥çš„è¯å¯ä»¥ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹å¼

1.ç³»ç»Ÿæ¥å—é€šçŸ¥çš„APIæŒ‡å®šé˜Ÿåˆ—

``` objc
- (id <NSObject>)addObserverForName:(nullable NSNotificationName)name object:(nullable id)obj queue:(nullable NSOperationQueue *)queue usingBlock:(void (^)(NSNotification *note))block
```
2.`NSMachPort`çš„æ–¹å¼ é€šè¿‡åœ¨ä¸»çº¿ç¨‹çš„runloopä¸­æ·»åŠ machPortï¼Œè®¾ç½®è¿™ä¸ªportçš„delegateï¼Œé€šè¿‡è¿™ä¸ªPortå…¶ä»–çº¿ç¨‹å¯ä»¥è·Ÿä¸»çº¿ç¨‹é€šä¿¡ï¼Œåœ¨è¿™ä¸ªportçš„ä»£ç†å›è°ƒä¸­æ‰§è¡Œçš„ä»£ç è‚¯å®šåœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™é‡Œè°ƒç”¨NSNotificationCenterå‘é€é€šçŸ¥å³å¯

## é¡µé¢é”€æ¯æ—¶ä¸ç§»é™¤é€šçŸ¥ä¼šå´©æºƒå—?

iOS9.0ä¹‹å‰ï¼Œä¼šcrashï¼ŒåŸå› ï¼šé€šçŸ¥ä¸­å¿ƒå¯¹è§‚å¯Ÿè€…çš„å¼•ç”¨æ˜¯unsafe_unretainedï¼Œå¯¼è‡´å½“è§‚å¯Ÿè€…é‡Šæ”¾çš„æ—¶å€™ï¼Œè§‚å¯Ÿè€…çš„æŒ‡é’ˆå€¼å¹¶ä¸ä¸ºnilï¼Œå‡ºç°é‡æŒ‡é’ˆ.  

iOS9.0ä¹‹åï¼Œä¸ä¼šcrashï¼ŒåŸå› ï¼šé€šçŸ¥ä¸­å¿ƒå¯¹è§‚å¯Ÿè€…çš„å¼•ç”¨æ˜¯weakã€‚


## å¤šæ¬¡æ·»åŠ åŒä¸€ä¸ªé€šçŸ¥ä¼šæ˜¯ä»€ä¹ˆç»“æœï¼Ÿå¤šæ¬¡ç§»é™¤é€šçŸ¥å‘¢

å¤šæ¬¡æ·»åŠ åŒä¸€ä¸ªé€šçŸ¥ï¼Œä¼šå¯¼è‡´å‘é€ä¸€æ¬¡è¿™ä¸ªé€šçŸ¥çš„æ—¶å€™ï¼Œå“åº”å¤šæ¬¡é€šçŸ¥å›è°ƒã€‚
å¤šæ¬¡ç§»é™¤é€šçŸ¥ä¸ä¼šäº§ç”Ÿcrashã€‚

## ä¸‹é¢çš„æ–¹å¼èƒ½æ¥æ”¶åˆ°é€šçŸ¥å—ï¼Ÿä¸ºä»€ä¹ˆ
	
``` objc
// å‘é€é€šçŸ¥
[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(handleNotification:) name:@"TestNotification" object:@1];
// æ¥æ”¶é€šçŸ¥
[NSNotificationCenter.defaultCenter postNotificationName:@"TestNotification" object:nil];
```

ä¸èƒ½

é¦–å…ˆæˆ‘ä»¬çœ‹ä¸‹é€šçŸ¥ä¸­å¿ƒå­˜å‚¨é€šçŸ¥è§‚å¯Ÿè€…çš„ç»“æ„

``` objc
// æ ¹å®¹å™¨ï¼ŒNSNotificationCenteræŒæœ‰
typedef struct NCTbl {
  Observation  *wildcard;    /* é“¾è¡¨ç»“æ„ï¼Œä¿å­˜æ—¢æ²¡æœ‰nameä¹Ÿæ²¡æœ‰objectçš„é€šçŸ¥ */
  GSIMapTable nameless;    /* å­˜å‚¨æ²¡æœ‰nameä½†æ˜¯æœ‰objectçš„é€šçŸ¥    */
  GSIMapTable named;        /* å­˜å‚¨å¸¦æœ‰nameçš„é€šçŸ¥ï¼Œä¸ç®¡æœ‰æ²¡æœ‰object    */
    ...
} NCTable;

// Observation å­˜å‚¨è§‚å¯Ÿè€…å’Œå“åº”ç»“æ„ä½“ï¼ŒåŸºæœ¬çš„å­˜å‚¨å•å…ƒ
typedef	struct Obs {
  id observer;    /* è§‚å¯Ÿè€…ï¼Œæ¥æ”¶é€šçŸ¥çš„å¯¹è±¡    */
  SEL selector;    /* å“åº”æ–¹æ³•        */
  struct Obs *next;        /* Next item in linked list.    */
  ...
} Observation;
```
`nameless`ä¸`named`çš„å…·ä½“æ•°æ®ç»“æ„å¦‚ä¸‹:

![](/assets/images/20200901iOSinterviewAnswers/NCTable.webp)  
![](/assets/images/20200901iOSinterviewAnswers/NCTable2.webp)  

å½“æ·»åŠ é€šçŸ¥ç›‘å¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ å…¥äº†`name`å’Œ`object`ï¼Œæ‰€ä»¥ï¼Œè§‚å¯Ÿè€…çš„å­˜å‚¨é“¾è¡¨æ˜¯è¿™æ ·çš„ï¼š

`named`è¡¨ï¼š`key(name)` : `value`->`key(object)` : `value(Observation)`

å› æ­¤åœ¨å‘é€é€šçŸ¥çš„æ—¶å€™ï¼Œå¦‚æœåªä¼ å…¥`name`è€Œå¹¶æ²¡æœ‰ä¼ å…¥`object`ï¼Œæ˜¯æ‰¾ä¸åˆ°`Observation`çš„ï¼Œä¹Ÿå°±ä¸èƒ½æ‰§è¡Œè§‚å¯Ÿè€…å›è°ƒ.


# æ€»ç»“

ç»è¿‡ä»Šå¤©çš„ å¤ä¹ åˆé‡æ–°è®¤è¯†äº†iOSä¸­çš„é€šçŸ¥ä¸­å¿ƒ,å¸Œæœ›å¤§å®¶ç»å¸¸æ¸©æ•…è€ŒçŸ¥æ–°. ä¸‹ä¸€ç¯‡æˆ‘ä»¬å¼€å§‹è®²è§£ `Runloop`& `KVO`




URL: https://sunyazhou.com/2020/08/iOSinterviewAnswers3/index.html.md
Published At: 2020-08-31 16:52:25 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹runtimeç›¸å…³é—®é¢˜3

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

# runtimeç›¸å…³é—®é¢˜ä¹‹å†…å­˜éƒ¨åˆ†çš„å…³è”å±æ€§æˆ–è€…hookç›¸å…³çš„Method Swizzle

ç»è¿‡å‰ä¸¤æœŸå†…å®¹  æˆ‘ä»¬è¿™æœŸæ¥è®²ä¸€ä¸‹ å†…å­˜éƒ¨åˆ†çš„å‰©ä½™é—®é¢˜ ä¸»è¦åŒ…å«å¦‚ä¸‹:

1. `Method Swizzle`æ³¨æ„äº‹é¡¹
2. å±æ€§ä¿®é¥°ç¬¦atomicçš„å†…éƒ¨å®ç°æ˜¯æ€ä¹ˆæ ·çš„?èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨å—
3. iOS ä¸­å†…çœçš„å‡ ä¸ªæ–¹æ³•æœ‰å“ªäº›ï¼Ÿå†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆ
4. `class`ã€`objc_getClass`ã€`object_getclass` æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«?


## `Method Swizzle`æ³¨æ„äº‹é¡¹

1. **éœ€è¦æ³¨æ„çš„æ˜¯äº¤æ¢æ–¹æ³•å®ç°åçš„å‰¯ä½œç”¨**, `method_exchangeImplementations()`.äº¤æ¢æ–¹æ³•å‡½æ•°æœ€ç»ˆä¼šä»¥`objc_msgSend()`æ–¹å¼è°ƒç”¨,å‰¯ä½œç”¨ä¸»è¦é›†ä¸­åœ¨ç¬¬ä¸€ä¸ªå‚æ•°  å¦‚ä¸‹ç¤ºä¾‹

	``` objc
	objc_msgSend(payment, @selector(quantity))
	```
	æ–¹æ³•äº¤æ¢åå†å»è°ƒç”¨quantityæ–¹æ³•å°†æœ‰å¯èƒ½ä¼šcrash.è§£å†³è¿™ç§å‰¯ä½œç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨`method_setImplementation()`æ¥æ›¿æ¢åŸæ¥çš„äº¤æ¢æ–¹å¼,è¿™æ ·æ‰æœ€ä¸ºåˆç†, å…·ä½“åŸç†è¯·å‚ç…§ [Objc é»‘ç§‘æŠ€ - Method Swizzle çš„ä¸€äº›æ³¨æ„äº‹é¡¹](https://www.ctolib.com/topics-103098.html)  

2. **é¿å…äº¤æ¢çˆ¶ç±»æ–¹æ³•** 

	å¦‚æœå½“å‰ç±»æ²¡æœ‰å®ç°è¢«äº¤æ¢çš„æ–¹æ³•ä¸”çˆ¶ç±»å®ç°äº†,æ­¤æ—¶çˆ¶ç±»çš„å®ç°ä¼šè¢«äº¤æ¢,è‹¥æ­¤çˆ¶ç±»çš„å¤šä¸ªç»§æ‰¿è€…éƒ½åœ¨äº¤æ¢æ—¶ä¼šå¼•èµ·å¤šæ¬¡äº¤æ¢å¯¼è‡´æ··ä¹±,åŒæ—¶è°ƒç”¨çˆ¶ç±»æ–¹æ³•æœ‰å¯èƒ½å› ä¸ºæ‰¾ä¸åˆ°æ–¹æ³•ç­¾åè€Œcrash.  
	æ‰€ä»¥äº¤æ¢å‰éƒ½åº”è¯¥checkèƒ½å¦ä¸ºå½“å‰ç±»æ·»åŠ è¢«äº¤æ¢çš„å‡½æ•°çš„æ–°çš„å®ç°IMP,è¿™ä¸ªè¿‡ç¨‹å¤§æ¦‚åˆ†ä¸º3æ­¥éª¤
	
	* `class_addMethod` checkèƒ½å¦æ·»åŠ æ–¹æ³•
		``` objc
		BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types)
		```
		
		> ç»™ç±»clsçš„SELæ·»åŠ ä¸€ä¸ªå®ç°IMP, è¿”å›YESåˆ™è¡¨æ˜ç±»clså¹¶æœªå®ç°æ­¤æ–¹æ³•ï¼Œè¿”å›NOåˆ™è¡¨æ˜ç±»å·²å®ç°äº†æ­¤æ–¹æ³•ã€‚æ³¨æ„ï¼šæ·»åŠ æˆåŠŸä¸å¦ï¼Œå®Œå…¨ç”±è¯¥ç±»æœ¬èº«æ¥å†³å®šï¼Œä¸çˆ¶ç±»æœ‰æ— è¯¥æ–¹æ³•æ— å…³ã€‚
	*  `class_replaceMethod` æ›¿æ¢ç±»clsçš„SELçš„å‡½æ•°å®ç°ä¸ºimp
		``` objc
			class_replaceMethod(Class _Nullable cls, SEL _Nonnull name, IMP _Nonnull imp, 
                    const char * _Nullable types)	
		```
		
	*  `method_exchangeImplementations` æœ€ç»ˆæ–¹æ³•äº¤æ¢
		``` objc
		method_exchangeImplementations(Method _Nonnull m1, Method _Nonnull m2) 
		```
3. äº¤æ¢æ–¹æ³•åº”åœ¨+loadæ–¹æ³•  
	
	è¿™ä¸ªå‰é¢è®²æ¶ˆæ¯è½¬å‘çš„æ—¶å€™è®²è¿‡,+loadä¸æ˜¯æ¶ˆæ¯è½¬å‘çš„æ–¹å¼å®ç°çš„ä¸”åœ¨è¿è¡Œæ—¶åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç±»è¢«åŠ è½½çš„æ—¶å€™è°ƒç”¨,è€Œä¸”çˆ¶ç±»,å½“å‰ç±»,category,å­ç±»ç­‰ éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡.æ‰€ä»¥è¿™é‡Œæœ€é€‚åˆå†™æ–¹æ³•äº¤æ¢çš„hook(Method Swizzle).

4. äº¤æ¢çš„åˆ†ç±»æ–¹æ³•åº”è¯¥æ·»åŠ è‡ªå®šä¹‰å‰ç¼€,é¿å…å†²çª
	
	è¿™ä¸ªæ¯«æ— ç–‘é—®,æ–¹æ³•åç§°ä¸€æ ·çš„æ—¶å€™ä¼šå‡ºç°,åˆ†ç±»çš„æ–¹æ³•ä¼šè¦†ç›–ç±»ä¸­åŒåçš„æ–¹æ³•.

[method swizzlingä½ åº”è¯¥æ³¨æ„çš„ç‚¹](https://blog.csdn.net/weixin_34168700/article/details/88762738)
	
	
## å±æ€§ä¿®é¥°ç¬¦atomicçš„å†…éƒ¨å®ç°æ˜¯æ€ä¹ˆæ ·çš„?èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨å—?

### atomicå†…éƒ¨å®ç°

``` objc
id objc_getProperty(id self, SEL _cmd, ptrdiff_t offset, BOOL atomic) {
    ...
    id *slot = (id*) ((char*)self + offset);
    if (!atomic) return *slot;  
    // Atomic retain release world
    spinlock_t& slotlock = PropertyLocks[slot];
    slotlock.lock();
    id value = objc_retain(*slot);
    slotlock.unlock();
    return objc_autoreleaseReturnValue(value);
}
```
``` objc
static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy)
{
    ...
    if (!atomic) {
        oldValue = *slot;
        *slot = newValue;
    } else {
        spinlock_t& slotlock = PropertyLocks[slot];
        slotlock.lock();
        oldValue = *slot;
        *slot = newValue;        
        slotlock.unlock();
    }
    objc_release(oldValue);
}
```

`property` çš„ `atomic` æ˜¯é‡‡ç”¨ `spinlock_t`è‡ªæ—‹é”å®ç°çš„.

### èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨å—?
 
`atomic`é€šè¿‡è¿™ç§æ–¹æ³•.åœ¨è¿è¡Œæ—¶ä»…ä»…æ˜¯ä¿è¯äº†`set`,`get`æ–¹æ³•çš„åŸå­æ€§.æ‰€ä»¥ä½¿ç”¨atomicå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚

## iOS ä¸­å†…çœçš„å‡ ä¸ªæ–¹æ³•æœ‰å“ªäº›ï¼Ÿå†…éƒ¨å®ç°åŸç†æ˜¯ä»€ä¹ˆ?

é¦–å…ˆè¦æ˜ç™½ä¸€ä¸ªåè¯ `introspection` åçœ,å†…çœçš„æ„æ€,åœ¨iOSå¼€å‘ä¸­æˆ‘ä»¬ä¼šç§°å®ƒä¸ºåå°„.

å†…çœæ–¹æ³• ä¾‹å¦‚å¸¸ç”¨çš„`NSObject`ä¸­çš„`isKindOfClass:` é€šè¿‡å®ä¾‹å¯¹è±¡åˆ¤æ–­`class`è¿™å°±æ˜¯ä¸€ç§å†…çœæ–¹æ³•æˆ–è€…å«åå°„æ–¹æ³•,ä½†æˆ‘è®¤ä¸º`NSClassFromString()`è¿™ä¸ªåº”è¯¥ä¹Ÿç®—ä¸€ç§åå°„æ–¹æ³•.

### iOS ä¸­å†…çœçš„å‡ ä¸ªæ–¹æ³•

æˆ‘ä»¬ä»NSObject.hä¸­çœ‹ä¸‹å§ 

``` objc
- (BOOL)isKindOfClass:(Class)aClass; //åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ä¸ªç±»æˆ–è€…è¿™ä¸ªç±»çš„å­ç±»çš„å®ä¾‹
- (BOOL)isMemberOfClass:(Class)aClass; //åˆ¤æ–­æ˜¯å¦æ˜¯è¿™ä¸ªç±»çš„å®ä¾‹
- (BOOL)conformsToProtocol:(Protocol *)aProtocol;  //åˆ¤æ–­æ˜¯å¦éµå®ˆæŸä¸ªåè®®
+ (BOOL)conformsToProtocol:(Protocol *)protocol; //åˆ¤æ–­æŸä¸ªç±»æ˜¯å¦éµå®ˆæŸä¸ªåè®®
- (BOOL)respondsToSelector:(SEL)aSelector;  //åˆ¤è¯»å®ä¾‹æ˜¯å¦æœ‰è¿™æ ·æ–¹æ³•
+ (BOOL)instancesRespondToSelector:(SEL)aSelector; //åˆ¤æ–­ç±»æ˜¯å¦æœ‰è¿™ä¸ªæ–¹æ³•
...
```
### å†…éƒ¨å®ç°åŸç†

1.`isKindOfClass:`  

``` objc
+ (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = self->ISA(); tcls; tcls = tcls->superclass) {
        if (tcls == cls) return YES;
    }
    return NO;
}
	
- (BOOL)isKindOfClass:(Class)cls {
    for (Class tcls = [self class]; tcls; tcls = tcls->superclass) {
        if (tcls == cls) return YES;
    }
    return NO;
}
```
ç±»æ–¹æ³•æ˜¯é€šè¿‡ISA()å‡½æ•°æ‹¿åˆ°æŒ‡å‘å…ƒç±»çš„å­˜å‚¨isaæŒ‡é’ˆæ•°æ®çš„åœ°å€bitä½æŒ‰ä½ä¸ä¸Šç›¸å…³æ©ç çš„æ–¹å¼åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯æŸä¸ªç±»çš„å­ç±».  
å®ä¾‹æ–¹æ³•æ˜¯é€šè¿‡`objc_object::getIsa()`å‡½æ•°é€šè¿‡å­˜å‚¨çš„`tag_ext`è¡¨å½¢å¼æ‹¿åˆ°isaå¯¹äºçš„classæ¥å–å‡ºclasså¹³checkæ¥å®ç°çš„.

2.`isMemberOfClass:`

``` objc
+ (BOOL)isMemberOfClass:(Class)cls {
    return self->ISA() == cls;
}

- (BOOL)isMemberOfClass:(Class)cls {
    return [self class] == cls;
}
```

è¿™ä¿©æ–¹æ³•éå¸¸ç®€å•ç›´æ¥ æ‹¿åˆ°isaæŒ‡é’ˆå¯¹æ¯”

3.`conformsToProtocol:`

``` objc
+ (BOOL)conformsToProtocol:(Protocol *)protocol {
    if (!protocol) return NO;
    for (Class tcls = self; tcls; tcls = tcls->superclass) {
        if (class_conformsToProtocol(tcls, protocol)) return YES;
    }
    return NO;
}

- (BOOL)conformsToProtocol:(Protocol *)protocol {
    if (!protocol) return NO;
    for (Class tcls = [self class]; tcls; tcls = tcls->superclass) {
        if (class_conformsToProtocol(tcls, protocol)) return YES;
    }
    return NO;
}
```

ä¸¤ä¸ªæ–¹æ³•æœ€ç»ˆè¿˜æ˜¯å»isa->data()->protocols æ‹¿åˆ°ç›¸å…³åè®®ç„¶ååˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸å…³åè®®
å¦‚ä¸‹ä»£ç ï¼š

``` objc
BOOL class_conformsToProtocol(Class cls, Protocol *proto_gen)
{
    protocol_t *proto = newprotocol(proto_gen);  
    if (!cls) return NO;
    if (!proto_gen) return NO;
    mutex_locker_t lock(runtimeLock);
    checkIsKnownClass(cls);
    ASSERT(cls->isRealized())
    for (const auto& proto_ref : cls->data()->protocols) {
        protocol_t *p = remapProtocol(proto_ref);
        if (p == proto || protocol_conformsToProtocol_nolock(p, proto)) {
            return YES;
        }
    }
    return NO;
}
```
> è¿™é‡Œå¯ä»¥æ¸…æ™°çš„çœ‹åˆ°forå¾ªç¯ å–å‡ºç›¸å…³protocolæŒ‡é’ˆ ç„¶åé€šè¿‡æŒ‡é’ˆå’Œä¼ å…¥çš„å‚æ•°ç”Ÿæˆçš„`proto`å¯¹æ¯”

4.`respondsToSelector:`

``` objc
+ (BOOL)respondsToSelector:(SEL)sel {
    return class_respondsToSelector_inst(self, sel, self->ISA());
}

- (BOOL)respondsToSelector:(SEL)sel {
    return class_respondsToSelector_inst(self, sel, [self class]);
}
```

è¿™ä¸ªæºç æ¯”è¾ƒéº»çƒ¦ æˆ‘ç®€å•å™è¿°ä¸€ä¸‹å§ å®é™…ä¸Šè°ƒç”¨æ ˆæ¯”è¾ƒæ·±å°±æ˜¯ä¸€ç›´å¯»æ‰¾åˆ°å½“å‰å®ä¾‹èƒ½å“åº”å“ªäº›æ–¹æ³•,å½“å‰ç±»æ²¡æœ‰å°±å»çˆ¶ç±»,çˆ¶ç±»æ²¡æœ‰åˆ™ç›´åˆ°å…ƒç±».

``` sh
respondsToSelector:
	|__ class_respondsToSelector_inst()
		|__ lookUpImpOrNil()
			|__ lookUpImpOrForward()
				è¿”å›IMPç»“æœ
```

è¿™å°±æ˜¯æ•´ä¸ªæ¶ˆæ¯è½¬å‘çš„è¿‡ç¨‹ å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†.æ„Ÿå…´è¶£å›çœ‹ä¸€ä¸‹[ç¬¬äºŒç« ](https://www.sunyazhou.com/2020/08/08/20200808iOSinterviewAnswers/) æ¶ˆæ¯è½¬å‘éƒ¨åˆ†

æˆ‘ä¸Šè¿°åˆ—ä¸¾äº†ä¸€äº›å¸¸ç”¨çš„å†…çœæ–¹æ³•,å…¶å®ƒçš„éƒ½æ–¹æ³•åŸºæœ¬æ²¡ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„éƒ½æ˜¯æ‹¿åˆ°isaå„ç§æ“ä½œå†…éƒ¨çš„è·å–ç›¸å…³å±æ€§çš„å‡½æ•°è¿”å›ç»“.

## `class`ã€`objc_getClass`ã€`object_getclass` æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«?

æˆ‘ç”¨xcodeéšä¾¿å»ºäº†ä¸€ä¸ªdemo æ‰“å°ä¸€ä¸‹viewcontroollerçš„å†…å®¹

``` objc
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];

    Class cls1 = [self class];
    Class cls2 = object_getClass(cls1);
    Class cls3 = objc_getClass(object_getClassName([self class]));
    NSLog(@"%p",cls1);
    NSLog(@"%p",cls2);
    NSLog(@"%p",cls3);
}
@end
```
è¾“å‡º

``` sh
2020-08-31 16:15:48.150285+0800 ClassDemo[5582:55836] 0x10205b3b0
2020-08-31 16:15:48.150456+0800 ClassDemo[5582:55836] 0x10205b3d8
2020-08-31 16:15:48.150575+0800 ClassDemo[5582:55836] 0x10205b3b0
```

æˆ‘ç®€å•åˆ—ä¸¾äº†ä¸€å¼ è¡¨æ ¼

|  | `class` | `object_getclass()`  | `objc_getClass()` |
| :-----: | :-----: | :-----: | :-----: |
| ä¼ å…¥å‚æ•° | N/a | idç±»å‹  | ç±»åçš„å­—ç¬¦ä¸² |
| æ“ä½œå¯¹è±¡ | obj | è¿™ä¸ªidçš„isaæŒ‡é’ˆæ‰€æŒ‡å‘çš„Class |è¿™ä¸ªç±»çš„ç±»å¯¹è±¡ |
| å®ä¾‹å¯¹è±¡æ—¶ | å’Œ`object_getclass()`ä¸€è‡´ |å’Œ`class`ä¸€è‡´ | N/a |
| ç±»å¯¹è±¡/å…ƒç±»å¯¹è±¡æ—¶ | è¿”å›çš„æ¶ˆæ¯å¯¹è±¡æœ¬èº« | è¿”å›çš„æ˜¯ä¸‹ä¸€ä¸ªå¯¹è±¡  | N/a |

> åŸå› ï¼šå› ä¸ºclassè¿”å›çš„æ˜¯selfï¼Œè€Œobject_getClassè¿”å›çš„æ˜¯isaæŒ‡å‘çš„å¯¹è±¡

# æ€»ç»“

ä»¥ä¸Šå°±æ˜¯"ä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹æˆ‘æ•´ç†çš„ç­”æ¡ˆä¹‹runtimeç›¸å…³é—®é¢˜3"ä¸­çš„å†…å­˜å‰©ä½™éƒ¨åˆ†,é—®é¢˜ç­”æ¡ˆè™½ç„¶ç®€çŸ­ ä½†æ˜¯æ¯é“é¢˜éƒ½é—®çš„éå¸¸åˆ°ä½,ä¸‹ä¸€æœŸæˆ‘ä»¬è®²ä¸€ä¸‹ é€šçŸ¥éƒ¨åˆ† äº‰å–ç”¨æœ€å¿«æ—¶é—´å†…æŠŠæ‰€æœ‰é—®é¢˜éƒ½æ•´ç†å‡ºæ¥ç­”æ¡ˆ.

[å‚è€ƒ](https://www.codenong.com/cs106358283/)



URL: https://sunyazhou.com/2020/08/iOSinterviewAnswers2/index.html.md
Published At: 2020-08-08 14:54:07 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹runtimeç›¸å…³é—®é¢˜2

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)


# å‰è¨€

> æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


æœ¬ç¯‡æˆ‘ä»¬æ¥è®²ä¸€ä¸‹ [é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜](https://mp.weixin.qq.com/s/bDnsaD__ZpdHIk3_So382w) ä¸­çš„runtimeç›¸å…³é—®é¢˜éƒ¨åˆ†çš„å†…å­˜ç®¡ç†ç›¸å…³çš„å†…å®¹.

# runtimeç›¸å…³é—®é¢˜ä¹‹ å†…å­˜ç®¡ç†

åŸºæœ¬å†…å®¹åŒ…æ‹¬:

* weakçš„å®ç°åŸç†ï¼ŸSideTableçš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„
* å…³è”å¯¹è±¡çš„åº”ç”¨ï¼Ÿç³»ç»Ÿå¦‚ä½•å®ç°å…³è”å¯¹è±¡çš„
* å…³è”å¯¹è±¡çš„å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Ÿå…³è”å¯¹è±¡å¦‚ä½•å®ç°weakå±æ€§
* Autoreleasepoolçš„åŸç†ï¼Ÿæ‰€ä½¿ç”¨çš„çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆ
* ARCçš„å®ç°åŸç†ï¼ŸARCä¸‹å¯¹retain, releaseåšäº†å“ªäº›ä¼˜åŒ–
* ARCä¸‹å“ªäº›æƒ…å†µä¼šé€ æˆå†…å­˜æ³„æ¼


## weakçš„å®ç°åŸç†ï¼ŸSideTableçš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„

å…ˆè¯´ç»“è®º:

* `weakè¡¨`å…¶å®æ˜¯ä¸€ä¸ªhash(å“ˆè¥¿)è¡¨.`Key`æ˜¯æ‰€æŒ‡å¯¹è±¡çš„åœ°å€ï¼Œ`Value`æ˜¯`weak`æŒ‡é’ˆçš„åœ°å€æ•°ç»„.å®ç°åŸç†æ˜¯é€šè¿‡æ–°æ—§è¡¨çš„æ›´æ–°æŒ‡é’ˆæ–¹å¼,å¯¹weakå¯¹è±¡å•ç‹¬å­˜å‚¨äº`SideTable`ä¸­çš„`weak_table_t`(ç±»å‹)  `weak_table`è¡¨ä¸­,é€šè¿‡å‡½æ•°`objc_initWeak()`->`storeWeak()`å‡½æ•°ä¸­çš„æ–°æ—§`SideTable`(ç»“æ„ä½“)è¡¨æ¥å®ç°
* `SideTable`æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…éƒ¨ä¸»è¦æœ‰å¼•ç”¨è®¡æ•°è¡¨å’Œå¼±å¼•ç”¨è¡¨ä¸¤ä¸ªæˆå‘˜ï¼Œå†…å­˜å­˜å‚¨çš„å…¶å®éƒ½æ˜¯å¯¹è±¡çš„åœ°å€å’Œå¼•ç”¨è®¡æ•°å’Œweakå˜é‡çš„åœ°å€ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«çš„æ•°æ®,å®ƒçš„ç»“æ„å¦‚ä¸‹

``` objc
struct SideTable {
    spinlock_t slock;
    RefcountMap refcnts;
    weak_table_t weak_table;
    SideTable() {
        memset(&weak_table, 0, sizeof(weak_table));
    }
    ~SideTable() {
        _objc_fatal("Do not delete SideTable.");
    }
    void lock() { slock.lock(); }
    void unlock() { slock.unlock(); }
    void forceReset() { slock.forceReset(); }
    // Address-ordered lock discipline for a pair of side tables.
    template<HaveOld, HaveNew>
    static void lockTwo(SideTable *lock1, SideTable *lock2);
    template<HaveOld, HaveNew>
    static void unlockTwo(SideTable *lock1, SideTable *lock2);
};
```

###  weakå®ç°åŸç†

å®ç°åŸç†æ¦‚æ‹¬åˆ†ä¸º3ä¸ªæ—¶æœº

* 1.åˆå§‹åŒ–
* 2.æ·»åŠ å¼•ç”¨
* 3.é‡Šæ”¾

#### 1.åˆå§‹åŒ–æ—¶å€™

`runtime`ä¼šè°ƒç”¨`objc_initWeak`å‡½æ•°ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„`weak`æŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„åœ°å€.

æˆ‘ä»¬å¼•å…¥ä¸€æ®µæµ‹è¯•ä»£ç 

``` objc
NSObject *obj = [[NSObject alloc] init];
id __weak obj1 = obj;
```

å½“æˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªweakå˜é‡æ—¶ï¼Œ`runtime`ä¼šè°ƒç”¨`NSObject.mm`ä¸­çš„`objc_initWeak()`å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åœ¨Clangä¸­çš„å£°æ˜å¦‚ä¸‹ï¼š

``` objc
id objc_initWeak(id *location, id newObj) {
    if (!newObj) { // æŸ¥çœ‹å¯¹è±¡å®ä¾‹æ˜¯å¦æœ‰æ•ˆ æ— æ•ˆå¯¹è±¡ç›´æ¥å¯¼è‡´æŒ‡é’ˆé‡Šæ”¾
        *location = nil;
        return nil;
    }
    // è¿™é‡Œä¼ é€’äº†ä¸‰ä¸ª bool æ•°å€¼ old, new, crash.ä½¿ç”¨ template è¿›è¡Œå¸¸é‡å‚æ•°ä¼ é€’æ˜¯ä¸ºäº†ä¼˜åŒ–æ€§èƒ½
    return storeWeak<DontHaveOld, DoHaveNew, DontCrashIfDeallocating>
        (location, (objc_object*)newObj);
}
```

å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°ä»…ä»…æ˜¯ä¸€ä¸ªæ·±å±‚å‡½æ•°çš„è°ƒç”¨å…¥å£ï¼Œè€Œä¸€èˆ¬çš„å…¥å£å‡½æ•°ä¸­ï¼Œéƒ½ä¼šåšä¸€äº›ç®€å•çš„åˆ¤æ–­ï¼ˆä¾‹å¦‚ `objc_msgSend` ä¸­çš„ç¼“å­˜åˆ¤æ–­ï¼‰ï¼Œè¿™é‡Œåˆ¤æ–­äº†å…¶æŒ‡é’ˆæŒ‡å‘çš„ç±»å¯¹è±¡æ˜¯å¦æœ‰æ•ˆï¼Œæ— æ•ˆç›´æ¥é‡Šæ”¾ï¼Œä¸å†å¾€æ·±å±‚è°ƒç”¨å‡½æ•°ã€‚å¦åˆ™ï¼Œobjectå°†è¢«æ³¨å†Œä¸ºä¸€ä¸ªæŒ‡å‘valueçš„`__weak`å¯¹è±¡ã€‚è€Œè¿™äº‹åº”è¯¥æ˜¯`objc_storeWeak`å‡½æ•°å¹²çš„.  

> æ³¨æ„ï¼š	`objc_initWeak`å‡½æ•°æœ‰ä¸€ä¸ªå‰ææ¡ä»¶ï¼šå°±æ˜¯objectå¿…é¡»æ˜¯ä¸€ä¸ªæ²¡æœ‰è¢«æ³¨å†Œä¸º`__weak`å¯¹è±¡çš„æœ‰æ•ˆæŒ‡é’ˆã€‚è€Œvalueåˆ™å¯ä»¥æ˜¯nullï¼Œæˆ–è€…æŒ‡å‘ä¸€ä¸ªæœ‰æ•ˆçš„å¯¹è±¡.

#### 2.æ·»åŠ å¼•ç”¨æ—¶

`objc_initWeak`å‡½æ•°ä¼šè°ƒç”¨ `objc_storeWeak() `å‡½æ•°,`objc_storeWeak() `åˆ™ä¼šè°ƒç”¨`storeWeak()`å‡½æ•°ï¼Œ `storeWeak()`çš„ä½œç”¨æ˜¯æ›´æ–°æŒ‡é’ˆæŒ‡å‘ï¼Œåˆ›å»ºå¯¹åº”çš„å¼±å¼•ç”¨è¡¨

æ¨¡æ¿

``` c
// HaveOld:  true - å˜é‡æœ‰å€¼ ,false - éœ€è¦è¢«åŠæ—¶æ¸…ç†ï¼Œå½“å‰å€¼å¯èƒ½ä¸º nil
// HaveNew:  true - éœ€è¦è¢«åˆ†é…çš„æ–°å€¼ï¼Œå½“å‰å€¼å¯èƒ½ä¸ºnil, false - ä¸éœ€è¦åˆ†é…æ–°å€¼
// CrashIfDeallocating: true - è¯´æ˜ newObj å·²ç»é‡Šæ”¾æˆ–è€… newObj ä¸æ”¯æŒå¼±å¼•ç”¨ï¼Œè¯¥è¿‡ç¨‹éœ€è¦æš‚åœ,false - ç”¨ nil æ›¿ä»£å­˜å‚¨
template <HaveOld haveOld, HaveNew haveNew,CrashIfDeallocating crashIfDeallocating>
```
weakå®ç°å‡½æ•° **è¯¥è¿‡ç¨‹ç”¨æ¥æ›´æ–°å¼±å¼•ç”¨æŒ‡é’ˆçš„æŒ‡å‘**.

``` objc
static id 
storeWeak(id *location, objc_object *newObj)
{
    ASSERT(haveOld  ||  haveNew);
    if (!haveNew) ASSERT(newObj == nil);  
    // åˆå§‹åŒ– previouslyInitializedClass æŒ‡é’ˆ.
    Class previouslyInitializedClass = nil;
    id oldObj;
    // å£°æ˜ä¸¤ä¸ª SideTable,â‘  æ–°æ—§æ•£åˆ—åˆ›å»º
    SideTable *oldTable;
    SideTable *newTable;
    //è·å¾—æ–°å€¼å’Œæ—§å€¼çš„é”å­˜ä½ç½®(ç”¨åœ°å€ä½œä¸ºå”¯ä¸€æ ‡ç¤º),é€šè¿‡åœ°å€æ¥å»ºç«‹ç´¢å¼•æ ‡å¿—,é˜²æ­¢æ¡¶é‡å¤,ä¸‹é¢æŒ‡å‘çš„æ“ä½œä¼šæ”¹å˜æ—§å€¼.
    if (haveOld) {
        oldObj = *location;// æ›´æ”¹æŒ‡é’ˆï¼Œè·å¾—ä»¥ oldObj ä¸ºç´¢å¼•æ‰€å­˜å‚¨çš„å€¼åœ°å€
        oldTable = &SideTables()[oldObj];
    } else {
        oldTable = nil;
    }
    if (haveNew) {
        newTable = &SideTables()[newObj];// æ›´æ”¹æ–°å€¼æŒ‡é’ˆï¼Œè·å¾—ä»¥ newObj ä¸ºç´¢å¼•æ‰€å­˜å‚¨çš„å€¼åœ°å€
    } else {
        newTable = nil;
    }
    // åŠ é”æ“ä½œï¼Œé˜²æ­¢å¤šçº¿ç¨‹ä¸­ç«äº‰å†²çª
    SideTable::lockTwo<haveOld, haveNew>(oldTable, newTable);
	// é¿å…çº¿ç¨‹å†²çªé‡å¤„ç†,location åº”è¯¥ä¸ oldObj ä¿æŒä¸€è‡´ï¼Œå¦‚æœä¸åŒï¼Œè¯´æ˜å½“å‰çš„ location å·²ç»å¤„ç†è¿‡ oldObj å¯æ˜¯åˆè¢«å…¶ä»–çº¿ç¨‹æ‰€ä¿®æ”¹
    if (haveOld  &&  *location != oldObj) {
        SideTable::unlockTwo<haveOld, haveNew>(oldTable, newTable);
        goto retry;
    }
    // é˜²æ­¢å¼±å¼•ç”¨é—´æ­»é”,å¹¶ä¸”é€šè¿‡ +initialize åˆå§‹åŒ–æ„é€ å™¨ä¿è¯æ‰€æœ‰å¼±å¼•ç”¨çš„ isa éç©ºæŒ‡å‘
    if (haveNew  &&  newObj) {
        Class cls = newObj->getIsa();// è·å¾—æ–°å¯¹è±¡çš„ isa æŒ‡é’ˆ
        // åˆ¤æ–­ isa éç©ºä¸”å·²ç»åˆå§‹åŒ–
        if (cls != previouslyInitializedClass  &&  
            !((objc_class *)cls)->isInitialized()) 
        { 
            SideTable::unlockTwo<haveOld, haveNew>(oldTable, newTable);/ è§£é”
            class_initialize(cls, (id)newObj); //å¦‚æœè¯¥ç±»å·²ç»å®Œæˆæ‰§è¡Œ +initialize æ–¹æ³•æ˜¯æœ€ç†æƒ³æƒ…å†µ,å¦‚æœè¯¥ç±» +initialize åœ¨çº¿ç¨‹ä¸­,ä¾‹å¦‚ +initialize æ­£åœ¨è°ƒç”¨ storeWeak æ–¹æ³•,éœ€è¦æ‰‹åŠ¨å¯¹å…¶å¢åŠ ä¿æŠ¤ç­–ç•¥ï¼Œå¹¶è®¾ç½® previouslyInitializedClass æŒ‡é’ˆè¿›è¡Œæ ‡è®°
            previouslyInitializedClass = cls;
            goto retry; //é‡è¯•
        }
    }
    // â‘¡ æ¸…é™¤æ—§å€¼
    if (haveOld) {
        weak_unregister_no_lock(&oldTable->weak_table, oldObj, location);
    }
	 // â‘¢ åˆ†é…æ–°å€¼
    if (haveNew) {
        newObj = (objc_object *)
            weak_register_no_lock(&newTable->weak_table, (id)newObj, location, 
                                  crashIfDeallocating);
        //å¦‚æœå¼±å¼•ç”¨è¢«é‡Šæ”¾ weak_register_no_lock æ–¹æ³•è¿”å› nil,åœ¨å¼•ç”¨è®¡æ•°è¡¨ä¸­è®¾ç½®è‹¥å¼•ç”¨æ ‡è®°ä½
        if (newObj  &&  !newObj->isTaggedPointer()) {
	        //å¼±å¼•ç”¨ä½åˆå§‹åŒ–æ“ä½œ,å¼•ç”¨è®¡æ•°é‚£å¼ æ•£åˆ—è¡¨çš„weakå¼•ç”¨å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸­æ ‡è¯†ä¸ºweakå¼•ç”¨
            newObj->setWeaklyReferenced_nolock();
        }
        //ä¹‹å‰ä¸è¦è®¾ç½® location å¯¹è±¡ï¼Œè¿™é‡Œéœ€è¦æ›´æ”¹æŒ‡é’ˆæŒ‡å‘
        *location = (id)newObj;
    }
    else {
        // æ²¡æœ‰æ–°å€¼ï¼Œåˆ™æ— éœ€æ›´æ”¹
    }
    
    SideTable::unlockTwo<haveOld, haveNew>(oldTable, newTable);

    return (id)newObj;
}
```

##### SideTable

SideTableå°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå†…éƒ¨ä¸»è¦æœ‰å¼•ç”¨è®¡æ•°è¡¨å’Œå¼±å¼•ç”¨è¡¨ä¸¤ä¸ªæˆå‘˜ï¼Œå†…å­˜å­˜å‚¨çš„å…¶å®éƒ½æ˜¯å¯¹è±¡çš„åœ°å€å’Œå¼•ç”¨è®¡æ•°å’Œweakå˜é‡çš„åœ°å€ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«çš„æ•°æ®.
> ä¸»è¦ç”¨äºç®¡ç†å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å’Œ weak è¡¨.

æˆ‘ä»¬æ¥çœ‹å›¾

![](/assets/images/20200808iOSinterviewAnswers/SideTableStructure.webp)

> æ“ä½œç³»ç»Ÿç»´æŠ¤64ä¸ªSideTableï¼Œé€šè¿‡å¯¹è±¡çš„åœ°å€ä½ç½®hashä¹‹åæ¨¡64(å°±æ˜¯%64æ±‚ä½™æ•°)æ‰¾åˆ°æŒ‡å®šçš„SideTable
æ¯ä¸ªSideTableç»´æŠ¤äº†ä¸€ä¸ªRefcountMapçš„å¼•ç”¨è®¡æ•°è¡¨ï¼Œkeyå°±æ˜¯å¯¹è±¡åœ°å€ï¼Œvalueå°±æ˜¯æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°


``` objc
struct SideTable {
    spinlock_t slock; //ä¿è¯åŸå­æ“ä½œçš„è‡ªæ—‹é”
    RefcountMap refcnts; //å¼•ç”¨è®¡æ•°çš„ hash è¡¨
    weak_table_t weak_table; //weak å¼•ç”¨å…¨å±€ hash è¡¨
    ...
};

```

* slock é˜²æ­¢ç«äº‰çš„è‡ªæ—‹é”
* refcnts ååŠ©å¯¹è±¡çš„ isa æŒ‡é’ˆçš„`extra_rc`å…±åŒå¼•ç”¨è®¡æ•°çš„å˜é‡

##### weakè¡¨

å¼±å¼•ç”¨hashè¡¨,`weak_table_t`ç±»å‹çš„ç»“æ„ä½“,å­˜å‚¨æŸä¸ªå®ä¾‹å¯¹è±¡ç›¸å…³çš„æ‰€æœ‰å¼±å¼•ç”¨ä¿¡æ¯. å®šä¹‰å¦‚ä¸‹:

``` objc
struct weak_table_t {
    weak_entry_t *weak_entries; // ä¿å­˜äº†æ‰€æœ‰æŒ‡å‘æŒ‡å®šå¯¹è±¡çš„ weak æŒ‡é’ˆ
    size_t    num_entries;		 // å­˜å‚¨ç©ºé—´
    uintptr_t mask;     			// å‚ä¸åˆ¤æ–­å¼•ç”¨è®¡æ•°è¾…åŠ©é‡
    uintptr_t max_hash_displacement;     // hash key æœ€å¤§åç§»å€¼
};
```
è¿™æ˜¯ä¸€ä¸ªå…¨å±€å¼±å¼•ç”¨hashè¡¨ã€‚ä½¿ç”¨ä¸å®šç±»å‹å¯¹è±¡çš„åœ°å€ä½œä¸º`key`ï¼Œç”¨`weak_entry_t`ç±»å‹ç»“æ„ä½“å¯¹è±¡ä½œä¸º`value`,å…¶ä¸­çš„`weak_entries` æˆå‘˜,å³ä¸ºå¼±å¼•ç”¨è¡¨å…¥å£.

å…¶ä¸­`weak_entry_t`æ˜¯å­˜å‚¨åœ¨å¼±å¼•ç”¨è¡¨ä¸­çš„ä¸€ä¸ªå†…éƒ¨ç»“æ„ä½“ï¼Œå®ƒè´Ÿè´£ç»´æŠ¤å’Œå­˜å‚¨æŒ‡å‘ä¸€ä¸ªå¯¹è±¡çš„æ‰€æœ‰å¼±å¼•ç”¨hashè¡¨ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š

``` objc
typedef DisguisedPtr<objc_object *> weak_referrer_t;
struct weak_entry_t {
    DisguisedPtr<objc_object> referent;
    union {
        struct {
            weak_referrer_t *referrers;
            uintptr_t        out_of_line_ness : 2;
            uintptr_t        num_refs : PTR_MINUS_2;
            uintptr_t        mask;
            uintptr_t        max_hash_displacement;
        };
        struct {
            // out_of_line_ness field is low bits of inline_referrers[1]
            weak_referrer_t  inline_referrers[WEAK_INLINE_COUNT];
        };
    };
    ...
};
```
å…¶ä¸­`DisguisedPtr`ç±»å‹çš„`referent`å˜é‡æ˜¯**å¯¹æ³›å‹å¯¹è±¡çš„æŒ‡é’ˆçš„å°è£…**,é€šè¿‡è¿™ä¸ª`æ³›å‹ç±»`æ¥è§£å†³å†…å­˜æ³„éœ²çš„é—®é¢˜.  

æ³¨é‡Šä¸­æœ‰ä¸ªå¾ˆé‡è¦çš„`out_of_line`æˆå‘˜,å®ƒä»£è¡¨æœ€ä½çš„æœ‰æ•ˆä½,å½“å®ƒä¸º0çš„æ—¶å€™,`weak_referrer_t `æˆå‘˜å°†æ‰©å±•ä¸ºå¤šè¡Œé™æ€çš„`hask table`.

å…¶ä¸­`weak_referrer_t ` æ˜¯ä¸€ä¸ªäºŒç»´`objc_object`çš„åˆ«å(typedef),é€šè¿‡ä¸€ä¸ªäºŒç»´æŒ‡é’ˆåœ°å€åç§»,ç”¨ä¸‹æ ‡ä½œhashçš„`key`,åšæˆäº†ä¸€ä¸ªå¼±å¼•ç”¨çš„æ•£åˆ—ã€‚

é‚£ä¹ˆ`weak_entry_t`ä¸­çš„å„æˆå‘˜`out_of_line`ã€`num_refs`ã€`mask` ã€`max_hash_displacement` åœ¨æœ‰æ•ˆä½æœªç”Ÿæ•ˆçš„æ—¶å€™æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

* `out_of_line`:æœ€ä½æœ‰æ•ˆä½ï¼Œä¹Ÿæ˜¯æ ‡å¿—ä½ã€‚å½“æ ‡å¿—ä½ 0 æ—¶ï¼Œå¢åŠ å¼•ç”¨è¡¨æŒ‡é’ˆçº¬åº¦ã€‚
* `num_refs`: å¼•ç”¨æ•°å€¼ã€‚è¿™é‡Œè®°å½•å¼±å¼•ç”¨è¡¨ä¸­å¼•ç”¨æœ‰æ•ˆæ•°å­—ï¼Œå› ä¸ºå¼±å¼•ç”¨è¡¨ä½¿ç”¨çš„æ˜¯é™æ€ hash ç»“æ„ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å˜é‡æ¥è®°å½•æ•°ç›®ã€‚
* `mask`:è®¡æ•°è¾…åŠ©é‡ã€‚
* `max_hash_displacement`:`hash`å…ƒç´ ä¸Šé™é˜€å€¼ã€‚  

> å…¶å® `out_of_line` çš„å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯ç­‰äºé›¶çš„ï¼Œæ‰€ä»¥å¼±å¼•ç”¨è¡¨æ€»æ˜¯ä¸€ä¸ª`objc_objective`æŒ‡é’ˆäºŒç»´æ•°ç»„ã€‚ä¸€ç»´ `objc_objective`æŒ‡é’ˆå¯æ„æˆä¸€å¼ å¼±å¼•ç”¨æ•£åˆ—è¡¨ï¼Œé€šè¿‡ç¬¬ä¸‰çº¬åº¦å®ç°äº†å¤šå¼ æ•£åˆ—è¡¨ï¼Œå¹¶ä¸”è¡¨æ•°é‡ä¸º `WEAK_INLINE_COUNT`.

ä»¥ä¸Šæ˜¯weakè¡¨çš„å®ç°åŸç†.

#### 3.é‡Šæ”¾

é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨`clearDeallocating`å‡½æ•°ã€‚`clearDeallocating`å‡½æ•°é¦–å…ˆæ ¹æ®å¯¹è±¡åœ°å€è·å–æ‰€æœ‰`weak`æŒ‡é’ˆåœ°å€çš„æ•°ç»„ï¼Œç„¶åéå†è¿™ä¸ªæ•°ç»„æŠŠå…¶ä¸­çš„æ•°æ®è®¾ä¸º`nil`ï¼Œæœ€åæŠŠè¿™ä¸ª`entry`ä»`weak`è¡¨ä¸­åˆ é™¤ï¼Œæœ€åæ¸…ç†å¯¹è±¡çš„è®°å½•.

##### å½“weakå¼•ç”¨æŒ‡å‘çš„å¯¹è±¡è¢«é‡Šæ”¾æ—¶ï¼Œåˆæ˜¯å¦‚ä½•å»å¤„ç†weakæŒ‡é’ˆçš„å‘¢ï¼Ÿå½“é‡Šæ”¾å¯¹è±¡æ—¶ï¼Œå…¶åŸºæœ¬æµç¨‹å¦‚ä¸‹:

* 1.è°ƒç”¨`objc_release`
* 2.å› ä¸ºå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0ï¼Œæ‰€ä»¥æ‰§è¡Œ`dealloc`
* 3.åœ¨deallocä¸­ï¼Œè°ƒç”¨äº†`_objc_rootDealloc`å‡½æ•°
* 4.åœ¨`_objc_rootDealloc`ä¸­ï¼Œè°ƒç”¨äº†`object_dispose`å‡½æ•°
* 5.è°ƒç”¨`objc_destructInstance`
* 6.æœ€åè°ƒç”¨`objc_clear_deallocating`

é‡ç‚¹çœ‹å¯¹è±¡è¢«é‡Šæ”¾æ—¶è°ƒç”¨çš„`objc_clear_deallocating`å‡½æ•°ã€‚è¯¥å‡½æ•°å®ç°å¦‚ä¸‹:

``` objc
void objc_clear_deallocating(id obj)  
{
    ASSERT(obj);
    if (obj->isTaggedPointer()) return;
    obj->clearDeallocating();
}
```
è°ƒç”¨äº†`clearDeallocating()`,ç‚¹å‡»æºç è¿›å»è¿½è¸ªå‘ç°,å®ƒæœ€ç»ˆæ˜¯ä½¿ç”¨äº†è¿­ä»£å™¨æ¥å–`weak`è¡¨çš„`value`,ç„¶åè°ƒç”¨`weak_clear_no_lock()`æŸ¥æ‰¾å¯¹åº”`value`,å°†è¯¥`weak`æŒ‡é’ˆç½®ç©º.

`weak_clear_no_lock()`å‡½æ•°çš„å®ç°å¦‚ä¸‹:

``` objc
void weak_clear_no_lock(weak_table_t *weak_table, id referent_id) 
{
    objc_object *referent = (objc_object *)referent_id;
    weak_entry_t *entry = weak_entry_for_referent(weak_table, referent);
    if (entry == nil) {
        /// XXX shouldn't happen, but does with mismatched CF/objc
        //printf("XXX no entry for clear deallocating %p\n", referent);
        return;
    }
    // zero out references
    weak_referrer_t *referrers;
    size_t count;
    if (entry->out_of_line()) {
        referrers = entry->referrers;
        count = TABLE_SIZE(entry);
    } 
    else {
        referrers = entry->inline_referrers;
        count = WEAK_INLINE_COUNT;
    }
    for (size_t i = 0; i < count; ++i) {
        objc_object **referrer = referrers[i];
        if (referrer) {
            if (*referrer == referent) {
                *referrer = nil;
            }
            else if (*referrer) {
                _objc_inform("__weak variable at %p holds %p instead of %p. "
                             "This is probably incorrect use of "
                             "objc_storeWeak() and objc_loadWeak(). "
                             "Break on objc_weak_error to debug.\n", 
                             referrer, (void*)*referrer, (void*)referent);
                objc_weak_error();
            }
        }
    }
    weak_entry_remove(weak_table, entry);
}
```

`objc_clear_deallocating()`è¯¥å‡½æ•°çš„åŠ¨ä½œå¦‚ä¸‹ï¼š

* 1.ä»weakè¡¨ä¸­è·å–åºŸå¼ƒå¯¹è±¡çš„åœ°å€ä¸ºé”®å€¼çš„è®°å½•
* 2.å°†åŒ…å«åœ¨è®°å½•ä¸­çš„æ‰€æœ‰é™„æœ‰ weakä¿®é¥°ç¬¦å˜é‡çš„åœ°å€ï¼Œèµ‹å€¼ä¸ºnil
* 3.å°†weakè¡¨ä¸­è¯¥è®°å½•åˆ é™¤
* 4.ä»å¼•ç”¨è®¡æ•°è¡¨ä¸­åˆ é™¤åºŸå¼ƒå¯¹è±¡çš„åœ°å€ä¸ºé”®å€¼çš„è®°å½•

[å‚è€ƒ](https://www.jianshu.com/p/13c4fb1cedea)

## å…³è”å¯¹è±¡çš„åº”ç”¨ï¼Ÿç³»ç»Ÿå¦‚ä½•å®ç°å…³è”å¯¹è±¡çš„

### å…³è”å¯¹è±¡çš„åº”ç”¨ï¼Ÿ

ä¸€èˆ¬åº”ç”¨åœ¨`category`(åˆ†ç±»)ä¸­ä¸º å½“å‰ç±» æ·»åŠ å…³è”å±æ€§,å› ä¸ºä¸èƒ½ç›´æ¥æ·»åŠ æˆå‘˜å˜é‡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡runtimeçš„æ–¹å¼é—´æ¥å®ç°æ·»åŠ æˆå‘˜å˜é‡çš„æ•ˆæœã€‚

å½“æˆ‘ä»¬åœ¨`category`ä¸­å£°æ˜å¦‚ä¸‹ä»£ç :

``` objc
@interface ClassA : NSObject (Category)
@property (nonatomic, strong) NSString *property;
@end
```

å®é™…ä¸Š`@property`è¿™ä¸ªobjcæ ‡å‡†åº“çš„å†…å»ºå…³é”®å­—å¸®æˆ‘ä»¬å®ç°äº†  setterå’Œ getter,ä½†æ˜¯åœ¨categoryä¸­å¹¶ä¸èƒ½å¸®æˆ‘ä»¬å£°æ˜æˆå‘˜å˜é‡ `property` æˆ‘ä»¬éœ€è¦é€šè¿‡runtimeæä¾›çš„ä¸¤ä¸ªCå‡½æ•°çš„apié—´æ¥å®ç° åŠ¨æ€æ·»åŠ  æˆå‘˜å˜é‡`property`.

* `objc_setAssociatedObject()`
* `objc_getAssociatedObject()`

``` objc
#import "ClassA+Category.h"
#import <objc/runtime.h>

@implementation ClassA (Category)

- (NSString *) property {
    return objc_getAssociatedObject(self, _cmd);
}

- (void)setProperty:(NSString *)categoryProperty {
    objc_setAssociatedObject(self, @selector(property), categoryProperty, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}

@end
```

çœ‹åˆ°ä¸Šé¢çš„å…³è”æ–¹æ³•,æˆ‘ä»¬æ¥ä»”ç»†ç ”ç©¶ä¸€ä¸‹ä¸‹é¢ç»å¸¸ä½¿ç”¨çš„å…³è”å±æ€§ç›¸å…³çš„API

``` c
void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy);
id objc_getAssociatedObject(id object, const void *key);
void objc_removeAssociatedObjects(id object);
```

1. `objc_setAssociatedObject()`ä»¥é”®å€¼å¯¹å½¢å¼æ·»åŠ å…³è”å¯¹è±¡
2. `objc_getAssociatedObject()`æ ¹æ® key è·å–å…³è”å¯¹è±¡
3. `objc_removeAssociatedObjects()`ç§»é™¤æ‰€æœ‰å…³è”å¯¹è±¡

`objc_setAssociatedObject()`çš„è°ƒç”¨æ ˆ

``` objc
void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)
â””â”€â”€ SetAssocHook.get()(object, key, value, policy)
    â””â”€â”€ void _object_set_associative_reference(id object, void *key, id value, uintptr_t policy)
```

ä¸Šè¿°è°ƒç”¨æ ˆä¸­çš„`_object_set_associative_reference()`å‡½æ•°å®é™…å®Œæˆäº†è®¾ç½®å…³è”å¯¹è±¡çš„ä»»åŠ¡ï¼š

``` c++
void
_object_set_associative_reference(id object, const void *key, id value, uintptr_t policy)
{
     if (!object && !value) return;
    if (object->getIsa()->forbidsAssociatedObjects())
        _objc_fatal("objc_setAssociatedObject called on instance (%p) of class %s which does not allow associated objects", object, object_getClassName(object));
    DisguisedPtr<objc_object> disguised{(objc_object *)object};
    ObjcAssociation association{policy, value};
    association.acquireValue();
    {
        AssociationsManager manager;
        AssociationsHashMap &associations(manager.get());
        if (value) {
            auto refs_result = associations.try_emplace(disguised, ObjectAssociationMap{});
            if (refs_result.second) {
                object->setHasAssociatedObjects();
            }
            auto &refs = refs_result.first->second;
            auto result = refs.try_emplace(key, std::move(association));
            if (!result.second) {
                association.swap(result.first->second);
            }
        } else {
            ...
        }
    }
    association.releaseHeldValue();
}
```

çœç•¥çš„å¾ˆå¤šä»£ç ,ä¸Šè¿°ä»£ç ä¸­å°±æ˜¯åº”ç”¨åœºæ™¯,ä¸Šé¢è°ƒç”¨çš„ç±»`AssociationsManager`å°±æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è®²çš„ç³»ç»Ÿå¦‚ä½•å®ç°å…³è”å¯¹è±¡çš„åŸç†.


### ç³»ç»Ÿå¦‚ä½•å®ç°å…³è”å¯¹è±¡çš„(å…³è”å¯¹è±¡å®ç°åŸç†)

å®ç°å…³è”å¯¹è±¡æŠ€æœ¯çš„æ ¸å¿ƒå¯¹è±¡ æœ‰å¦‚ä¸‹è¿™ä¹ˆå‡ ä¸ª:

1. AssociationsManager
2. AssociationsHashMap  
3. ObjectAssociationMap
4. ObjcAssociation  

> å…¶ä¸­MapåŒæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„å­—å…¸ç±»ä¼¼ã€‚é€šè¿‡`key`-`value`çš„å½¢å¼å¯¹åº”å­˜å€¼.

ä¸‹é¢æˆ‘ä»¬é€šè¿‡æºç æ¥ä¸€æ¢ç©¶ç«Ÿ

#### `objc_setAssociatedObject()`å‡½æ•°

runtimeæºç 

``` sh
void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)
{
    _object_set_associative_reference(object, key, value, policy);
}
```
> æºç è°ƒç”¨è¿‡ç¨‹æœ‰hookå‡½æ•°,æœ‰ç‚¹é•¿,è¿™é‡Œæˆ‘ç®€åŒ–ä¸€ä¸‹,ç›´æ¥è°ƒç”¨æ ¸å¿ƒçš„å‡½æ•°

ä¸‹é¢çœ‹ä¸‹`_object_set_associative_reference()`å‡½æ•°çš„ä»£ç å®ç°

``` objc
void _object_set_associative_reference(id object, const void *key, id value, uintptr_t policy)
{
    if (object->getIsa()->forbidsAssociatedObjects())
        _objc_fatal("objc_setAssociatedObject called on instance (%p) of class %s which does not allow associated objects", object, object_getClassName(object));
    DisguisedPtr<objc_object> disguised{(objc_object *)object};
    ObjcAssociation association{policy, value}; //4. æˆ‘ä»¬ç”¨åˆ°çš„ObjcAssociation
    association.acquireValue();
    {
        AssociationsManager manager; //1. æˆ‘ä»¬ç”¨åˆ°çš„AssociationsManager
        AssociationsHashMap &associations(manager.get()); //2.æˆ‘ä»¬ä¸Šé¢åˆ—ä¸¾çš„AssociationsHashMap
        if (value) {
            auto refs_result = associations.try_emplace(disguised, ObjectAssociationMap{}); //3.æˆ‘ä»¬ç”¨åˆ°çš„ObjectAssociationMap
            if (refs_result.second) {
                object->setHasAssociatedObjects();
            }
            auto &refs = refs_result.first->second;
            auto result = refs.try_emplace(key, std::move(association));
            if (!result.second) {
                association.swap(result.first->second);
            }
        } else {
            auto refs_it = associations.find(disguised);
            if (refs_it != associations.end()) {
                auto &refs = refs_it->second;
                auto it = refs.find(key);
                if (it != refs.end()) {
                    association.swap(it->second);
                    refs.erase(it);
                    if (refs.size() == 0) {
                        associations.erase(refs_it);
                    }
                }
            }
        }
    }
    association.releaseHeldValue();
}
```
ä¸Šè¿°ä»£ç å¯ä»¥æ‰¾åˆ°æˆ‘ä»¬å®ç°å…³è”å¯¹è±¡æŠ€æœ¯çš„æ ¸å¿ƒå¯¹è±¡. ä¸‹é¢æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ä¸€ä¸‹å‡ ä¸ªæ ¸å¿ƒå¯¹è±¡çš„å†…éƒ¨å®ç°.

#####  AssociationsManager

``` objc
typedef DenseMap<const void *, ObjcAssociation> ObjectAssociationMap;
typedef DenseMap<DisguisedPtr<objc_object>, ObjectAssociationMap> AssociationsHashMap;
class AssociationsManager {
    using Storage = ExplicitInitDenseMap<DisguisedPtr<objc_object>, ObjectAssociationMap>;
    static Storage _mapStorage;

public:
    AssociationsManager()   { AssociationsManagerLock.lock(); }
    ~AssociationsManager()  { AssociationsManagerLock.unlock(); }

    AssociationsHashMap &get() {
        return _mapStorage.get();
    }
    static void init() {
        _mapStorage.init();
    }
};
```

`AssociationsManager`å†…éƒ¨æœ‰ä¸€ä¸ª`get()`å‡½æ•°è¿”å›ä¸€ä¸ª`AssociationsHashMap`å¯¹è±¡

##### AssociationsHashMap

`AssociationsHashMap` æ˜¯`DenseMap`çš„typedef(å¯ä»¥ç†è§£ä¸ºåˆ«å) åªä¸è¿‡å®ƒè¢«å®šä¹‰æˆç¬¦åˆæŸäº›`å…ƒç»„`çš„æ¡ä»¶çš„`DenseMap`ç±»å‹

å®é™…ä¸Š `AssociationsHashMap` ç”¨ä¸ä¿å­˜ä»å¯¹è±¡çš„ `disguised_ptr_t `åˆ° `ObjectAssociationMap`çš„æ˜ å°„,è¿™ä¸ªæ•°æ®ç»“æ„ä¿å­˜äº†å½“å‰å¯¹è±¡å¯¹åº”çš„æ‰€æœ‰å…³è”å¯¹è±¡


``` objc
typedef DenseMap<const void *, ObjcAssociation> ObjectAssociationMap;
typedef DenseMap<DisguisedPtr<objc_object>, ObjectAssociationMap> AssociationsHashMap;
```

è¿™é‡Œçš„`ObjectAssociationMap `æ˜¯å¦ä¸€ç±»å‹çš„typedef,é‡Œé¢å­˜ç€`ObjcAssociation`ç±»å‹çš„å¯¹è±¡æŒ‡é’ˆçš„key,valueå½¢å¼.

ä¸‹é¢å†çœ‹ä¸‹ `ObjcAssociation` ,è¿™æ˜¯ä¸€ä¸ªC++çš„ç±»å¯¹è±¡,æœ€å…³é”®çš„`ObjcAssociation`åŒ…å«äº†`policy`ä»¥åŠ`value`.

``` c++
class ObjcAssociation {
    uintptr_t _policy;
    id _value;
public:
    ObjcAssociation(uintptr_t policy, id value) : _policy(policy), _value(value) {}
    ObjcAssociation() : _policy(0), _value(nil) {}
    ObjcAssociation(const ObjcAssociation &other) = default;
    ObjcAssociation &operator=(const ObjcAssociation &other) = default;
    ObjcAssociation(ObjcAssociation &&other) : ObjcAssociation() {
        swap(other);
    }
    inline void swap(ObjcAssociation &other) {
        std::swap(_policy, other._policy);
        std::swap(_value, other._value);
    }
    inline uintptr_t policy() const { return _policy; }
    inline id value() const { return _value; }
    ...
};
```

##### å…³è”å¯¹è±¡åœ¨å†…å­˜ä¸­ä»¥ä»€ä¹ˆå½¢å¼å­˜å‚¨çš„ï¼Ÿ

ç¤ºä¾‹ä»£ç 

``` objc
int main(int argc, const char * argv[]) {
    @autoreleasepool {
        NSObject *obj = [NSObject new];
        objc_setAssociatedObject(obj, @selector(hello), @"Hello", OBJC_ASSOCIATION_RETAIN_NONATOMIC);
    }
    return 0;
}
```

è¿™ä¸ªè°ƒç”¨å‡½æ•°`objc_setAssociatedObject(OBJC_ASSOCIATION_RETAIN_NONATOMIC, @"Hello")`åœ¨å†…å­˜ä¸­æ˜¯è¿™æ ·çš„å­˜å‚¨ç»“æ„

![](/assets/images/20200808iOSinterviewAnswers/AssociationOrder.webp)


##### `objc_setAssociatedObject()`

æˆ‘ä»¬å›å¤´æ¥è¯¦ç»†åˆ†è§£ä¸€ä¸‹`objc_setAssociatedObject()`å‡½æ•°ä¸­çš„çœŸå®å®ç°éƒ¨åˆ†,`_object_set_associative_reference()`

è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥`(id object, const void *key, id value, uintptr_t policy)`,è¿™ä¹ˆå‡ ä¸ªå‚æ•°,æˆ‘ä»¬æ‹¿ç¬¬3ä¸ª`value`å‚æ•°æ¥åˆ†è§£.

æˆ‘ä»¬åˆ†è§£ä¸º2æ­¥

1. `value != nil` è®¾ç½®æˆ–è€…æ›´æ–°å…³è”å¯¹è±¡çš„å€¼
2. `value == nil` åˆ é™¤ä¸€ä¸ªå…³è”å¯¹è±¡.

ä¸‹é¢æ˜¯å…·ä½“æ˜¯ä»£ç è§£é‡Š **æ³¨æ„çœ‹ä»£ç æ³¨é‡Š!!!**

``` objc
void
_object_set_associative_reference(id object, const void *key, id value, uintptr_t policy)
{
    // åˆ¤ç©º
    if (!object && !value) return;

	// åˆ¤æ–­æœ¬ç±»å¯¹è±¡æ˜¯å¦å…è®¸å…³è”å…¶ä»–å¯¹è±¡.å¦‚æœå…è®¸åˆ™è¿›å…¥ä»£ç å—
    if (object->getIsa()->forbidsAssociatedObjects())
        _objc_fatal("objc_setAssociatedObject called on instance (%p) of class %s which does not allow associated objects", object, object_getClassName(object));

	// å°†è¢«å…³è”çš„å¯¹è±¡å°è£…æˆDisguisedPtræ–¹ä¾¿åœ¨åè¾¹hashè¡¨ä¸­çš„ç®¡ç†,å®ƒçš„ä½œç”¨å°±åƒæ˜¯ä¸€ä¸ªæŒ‡é’ˆ
    DisguisedPtr<objc_object> disguised{(objc_object *)object};
    // å°†éœ€è¦å…³è”çš„å¯¹è±¡,å°è£…æˆObjcAssociation,æ–¹ä¾¿ç®¡ç†
    ObjcAssociation association{policy, value};

    // å¤„ç†policyä¸ºretainå’Œcopyçš„ä¿®é¥°æƒ…å†µ,
    association.acquireValue();

    {
    	// è·å–å…³è”å¯¹è±¡ç®¡ç†è€…å¯¹è±¡
        AssociationsManager manager;
        // æ ¹æ®ç®¡ç†è€…å¯¹è±¡è·å–å¯¹åº”å…³è”è¡¨(HashMap)
        AssociationsHashMap &associations(manager.get());

        if (value) {
        	// å¦‚æœè¿™ä¸ªdisguisedå­˜åœ¨äºObjectAssociationMap()ä¸­,åˆ™æ›¿æ¢,å¦‚æœä¸å­˜åœ¨åˆ™åˆå§‹åŒ–ååœ¨æ’å…¥
        	// è¿™é‡Œè¯´æ˜ä¸€ä¸‹,æˆ‘ä»¬å…³è”çš„å¯¹è±¡å…³ç³»å­˜åœ¨äºObjectAssociationMapä¸­,è€Œ
        	//	ObjectAssociationMapæœ‰å¤šä¸ª,æ‰€ä»¥,è¿™ä¸€æ­¥æ˜¯å¯¹ObjectAssociationMapçš„ä¸€ä¸ªç®¡ç†,ä¸‹è¾¹æ‰æ˜¯å¯¹æˆ‘ä»¬è¦å…³è”çš„å¯¹è±¡çš„æ“ä½œ
            auto refs_result = associations.try_emplace(disguised, ObjectAssociationMap{});
            // å¦‚æœè¿™æ˜¯æ­¤å¯¹è±¡ç¬¬ä¸€æ¬¡è¢«å…³è”
            if (refs_result.second) {
               // ä¿®æ”¹isa_tä¸­çš„has_assocå­—æ®µ,æ ‡è®°å…¶è¢«å…³è”çŠ¶æ€
                object->setHasAssociatedObjects();
            }

            // è¿™é‡Œæ‰æ˜¯å¯¹æˆ‘ä»¬è¦å…³è”çš„å¯¹è±¡æ“ä½œ
            auto &refs = refs_result.first->second;
            // æƒ³mapä¸­æ’å…¥key valueå¯¹
            auto result = refs.try_emplace(key, std::move(association));
            // è¿™é‡Œæ²¡æœ‰çœ‹æ‡‚,ä¸ºä»€ä¹ˆæ²¡æœ‰ç¬¬äºŒä¸ªå°±è¦äº¤æ¢ä¸€ä¸‹..
            if (!result.second) {
                association.swap(result.first->second);
            }
        } else {
        	// valueä¸ºç©º, å¹¶ä¸”åœ¨associationsä¸­æœ‰è®°å½•,åˆ™è¿›è¡Œæ“¦é™¤æ“ä½œ 
            auto refs_it = associations.find(disguised);
            if (refs_it != associations.end()) {
                auto &refs = refs_it->second;
                auto it = refs.find(key);
                if (it != refs.end()) {
                    association.swap(it->second);
                    refs.erase(it);
                    if (refs.size() == 0) {
                        associations.erase(refs_it);
                    }
                }
            }
        }
    }

    // release the old value (outside of the lock).
    association.releaseHeldValue();
}
```

##### `objc_setAssociatedObject()`å‡½æ•°çš„ä½œç”¨æ˜¯ä»€ä¹ˆ?

``` c++
inline void
objc_object::setHasAssociatedObjects()
{
    if (isTaggedPointer()) return;

 retry:
    isa_t oldisa = LoadExclusive(&isa.bits);
    isa_t newisa = oldisa;
    if (!newisa.nonpointer  ||  newisa.has_assoc) {
        ClearExclusive(&isa.bits);
        return;
    }
    newisa.has_assoc = true;
    if (!StoreExclusive(&isa.bits, oldisa.bits, newisa.bits)) goto retry;
}
```

å®ƒä¼šå°†`isa`ç»“æ„ä½“ä¸­çš„æ ‡è®°ä½`has_assoc`æ ‡è®°ä¸º`true`ï¼Œä¹Ÿå°±æ˜¯è¡¨ç¤ºå½“å‰å¯¹è±¡æœ‰å…³è”å¯¹è±¡ï¼Œå¦‚ä¸‹å›¾`isa`ä¸­çš„å„ä¸ªæ ‡è®°ä½éƒ½æ˜¯å¹²ä»€ä¹ˆçš„.

![](/assets/images/20200808iOSinterviewAnswers/isa.webp)

##### `objc_getAssociatedObject()`

è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨æ ˆå¦‚ä¸‹

``` sh
id objc_getAssociatedObject(id object, const void *key)
â””â”€â”€ id _object_get_associative_reference(id object, const void *key);
```
é€šè¿‡ä¸Šé¢æˆ‘ä»¬ä»‹ç»ï¼Œç†è§£è¿™ä¸ªå‡½æ•°ç›¸å½“ç®€å•äº† 

``` objc
id
_object_get_associative_reference(id object, const void *key)
{
    ObjcAssociation association{};
    {
        AssociationsManager manager; //1
        AssociationsHashMap &associations(manager.get()); //1
        AssociationsHashMap::iterator i = associations.find((objc_object *)object); //2
        if (i != associations.end()) {
            ObjectAssociationMap &refs = i->second;
            ObjectAssociationMap::iterator j = refs.find(key);
            if (j != refs.end()) {
                association = j->second;
                association.retainReturnedValue();
            }
        }
    }
    return association.autoreleaseReturnedValue();
}
```
1. é€šè¿‡`AssociationsManager`æ‹¿åˆ°`AssociationsHashMap`å“ˆè¥¿è¡¨
2. é€šè¿‡å“ˆè¥¿è¡¨å¯»æ‰¾å…³è”å¯¹è±¡
3. å‰©ä¸‹çš„å°±æ˜¯æ›´æ–°å¯¹è±¡æ˜¯å¦åˆæ¬¡åˆ›å»ºç­‰æ ‡è®° ç„¶åè¿”å›å¯¹è±¡ 

##### `objc_removeAssociatedObjects()`

è°ƒç”¨æ ˆå¦‚ä¸‹:

``` sh
void objc_removeAssociatedObjects(id object)
â””â”€â”€ void _object_remove_assocations(id object)
```

ä»£ç å…·ä½“å®ç°

``` objc
void objc_removeAssociatedObjects(id object) 
{
    if (object && object->hasAssociatedObjects()) { 
        _object_remove_assocations(object);
    }
}
```
> checkå¯¹è±¡æ˜¯å¦ä¸ºnil ä¸” å…³è”å¯¹è±¡æ˜¯å¦å­˜åœ¨ 

ç„¶åè°ƒç”¨å®ç°è·Ÿä¸Šè¾¹çš„getå·®ä¸å¤š

``` objc
void
_object_remove_assocations(id object)
{
    ObjectAssociationMap refs{};
    {
        AssociationsManager manager;
        AssociationsHashMap &associations(manager.get());
        AssociationsHashMap::iterator i = associations.find((objc_object *)object);
        if (i != associations.end()) {
            refs.swap(i->second);
            associations.erase(i);
        }
    }
    // release everything (outside of the lock).
    for (auto &i: refs) {
        i.second.releaseHeldValue();
    }
}
```
é€šè¿‡`AssociationsManager` -> `AssociationsHashMap` -> object æ˜¯å¦å­˜åœ¨,å¦‚æœå­˜åœ¨å°±**æ“¦é™¤**.- >  releaseHeldValue()æ˜¯å¦å¯¹è±¡ 
 
#### å°ç»“

å…³è”å¯¹è±¡çš„åº”ç”¨å’Œç³»ç»Ÿå¦‚ä½•å®ç°å…³è”å¯¹è±¡çš„å¤§æ¦‚é¡ºåºå¦‚ä¸‹:  
`AssociationsManager`å…³è”å¯¹è±¡ç®¡ç†å™¨->`AssociationsHashMap`å“ˆå¸Œæ˜ å°„è¡¨->`ObjectAssociationMap`å…³è”å¯¹è±¡æŒ‡é’ˆ->`ObjcAssociation`å…³è”å¯¹è±¡

## å…³è”å¯¹è±¡çš„å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Ÿå…³è”å¯¹è±¡å¦‚ä½•å®ç°weakå±æ€§?

### å…³è”å¯¹è±¡çš„å¦‚ä½•è¿›è¡Œå†…å­˜ç®¡ç†çš„ï¼Ÿ

å½“æˆ‘è°ƒç”¨å…³è”å¯¹è±¡å‡½æ•°`objc_setAssociatedObject()`çš„æ—¶å€™ä¼šè°ƒç”¨å¦‚ä¸‹å‡½æ•°ï¼š

`_object_set_associative_reference(id object, const void *key, id value, uintptr_t policy)`,è¿™é‡Œé¢æœ‰ä¸ªæ–¹æ³•

``` objc
ObjcAssociation association{policy, value};
// retain the new value (if any) outside the lock.
association.acquireValue();
```

è¿™é‡Œçš„ `policy`å°±æ˜¯å…·ä½“ç»å¯¹å†…å­˜ä½¿ç”¨retainè¿˜æ˜¯å…¶å®ƒç›¸å…³çš„å†…å­˜æšä¸¾.

``` objc
enum {
    OBJC_ASSOCIATION_SETTER_ASSIGN      = 0,
    OBJC_ASSOCIATION_SETTER_RETAIN      = 1,
    OBJC_ASSOCIATION_SETTER_COPY        = 3,            // NOTE:  both bits are set, so we can simply test 1 bit in releaseValue below.
    OBJC_ASSOCIATION_GETTER_READ        = (0 << 8),
    OBJC_ASSOCIATION_GETTER_RETAIN      = (1 << 8),
    OBJC_ASSOCIATION_GETTER_AUTORELEASE = (2 << 8)
};
```
é€šè¿‡ acquireValue()å‡½æ•°åˆ¤æ–­ä½¿ç”¨é‚£ç§å†…å­˜å…³é”®å­—.  

``` objc
inline void acquireValue() {
    if (_value) {
        switch (_policy & 0xFF) {
        case OBJC_ASSOCIATION_SETTER_RETAIN:
            _value = objc_retain(_value);
            break;
        case OBJC_ASSOCIATION_SETTER_COPY:
            _value = ((id(*)(id, SEL))objc_msgSend)(_value, @selector(copy));
            break;
        }
    }
}
```

### å…³è”å¯¹è±¡å¦‚ä½•å®ç°weakå±æ€§ï¼Ÿ

é¦–å…ˆè¯´ä¸€ä¸‹ è¿™ä¸ªé—®é¢˜é—®çš„éå¸¸æœ‰æŠ€æœ¯å«é‡,å®Œå…¨è€ƒéªŒiOSå¼€å‘è€…å¯¹åº•å±‚äº†è§£çš„ç¨‹åº¦.

åœ¨ä¸ºNSObjectå¯¹è±¡ç»‘å®š associated object æ—¶å¯ä»¥æŒ‡å®šå¦‚ä¸‹ä¾èµ–å…³ç³»ï¼š

``` objc
typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) {
    OBJC_ASSOCIATION_ASSIGN = 0, //å¼±å¼•ç”¨
    OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, //å¼ºå¼•ç”¨ï¼ŒéåŸå­æ“ä½œ
    OBJC_ASSOCIATION_COPY_NONATOMIC = 3,  //å…ˆ copyï¼Œç„¶åå¼ºå¼•ç”¨
    OBJC_ASSOCIATION_RETAIN = 01401, //å¼ºå¼•ç”¨ï¼ŒåŸå­æ“ä½œ
    OBJC_ASSOCIATION_COPY = 01403 //å…ˆ copyï¼Œç„¶åå¼ºå¼•ç”¨ï¼ŒåŸå­æ“ä½œ
};
```
æ ¹æ®ä¸Šè¿°çš„æšä¸¾æˆ‘ä»¬å‘ç°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜,è¿™é‡Œçš„æšä¸¾ä¸­å¹¶æ²¡æœ‰`OBJC_ASSOCIATION_WEAK`è¿™æ ·çš„é€‰é¡¹.

åŸºäºä¸Šè¿°çš„ä»£ç ä»‹ç»æˆ‘ä»¬çŸ¥é“`Objective-C`åœ¨åº•å±‚ä½¿ç”¨`AssociationsManager`ç»Ÿä¸€ç®¡ç†å„ä¸ªå¯¹è±¡çš„ `associated objects`å…³è”å¯¹è±¡.ç„¶åé€šè¿‡`static key`(ä¸€èˆ¬æ˜¯ä¸€ä¸ªå›ºå®šå€¼)å»è®¿é—®å¯¹åº”çš„`associated object`å…³è”å¯¹è±¡.ç„¶ååœ¨`dealloc`çš„æ—¶å€™è°ƒç”¨`æ“¦é™¤å‡½æ•°`(`associations.erase() `)æ¥è§£é™¤å¯¹è¿™äº›å…³è”å¯¹è±¡çš„å¼•ç”¨:

``` sh
dealloc
    object_dispose
        objc_destructInstance
            _object_remove_assocations  // ç§»é™¤å¿…è¦çš„associated objects
```
ä¹Ÿå°±æ˜¯è¯´,åœ¨`NSObject`å¯¹è±¡çš„å†…å­˜ç©ºé—´é‡Œï¼Œå¹¶æ²¡æœ‰ä¸º `associated objects`(å…³è”å¯¹è±¡) åˆ†é…ä»»ä½•å˜é‡.

æˆ‘ä»¬çŸ¥é“weakå˜é‡å’Œ assignå˜é‡çš„åŒºåˆ«æ˜¯:weakæŒ‡å‘çš„å¯¹è±¡é”€æ¯çš„æ—¶å€™,`Objective-C`ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è®¾ç½®`nil`,è€Œ`assign`å´ä¸èƒ½.

è¿™ä¸ªé€»è¾‘æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ

`Runtime`åœ¨åº•å±‚ç»´æŠ¤ä¸€ä¸ª`weak`è¡¨(ä¹Ÿå°±æ˜¯æœ¬æ–‡å¼€å¤´è®²çš„`SlideTable`ä¸­çš„`weak_table_t` `weak_tabl`)ï¼Œæ¯æ¯åˆ†é…ä¸€ä¸ª`weak`æŒ‡é’ˆå¹¶èµ‹å€¼æœ‰æ•ˆå¯¹è±¡çš„åœ°å€æ—¶ï¼Œä¼šå°†å¯¹è±¡åœ°å€å’Œ`weak`æŒ‡é’ˆåœ°å€æ³¨å†Œåˆ°`weak`è¡¨ä¸­ï¼Œå…¶ä¸­å¯¹è±¡åœ°å€ä½œä¸º`key`;å½“å¯¹è±¡è¢«åºŸå¼ƒæ—¶,å¯æ ¹æ®å¯¹è±¡åœ°å€å¿«é€Ÿå¯»æ‰¾åˆ°æŒ‡å‘å®ƒçš„æ‰€æœ‰`weak` æŒ‡é’ˆ,è¿™äº›`weak`æŒ‡é’ˆä¼šè¢«èµ‹å€¼`0`(å³`nil`ï¼‰å¹¶ç§»å‡º`weakè¡¨ã€‚

æ‰€ä»¥,å®ç°`weak`å¼•ç”¨(è€Œé`assign`å¼•ç”¨)çš„å‰ææ˜¯å­˜åœ¨ä¸€ä¸ª`__weak`æŒ‡é’ˆæŒ‡å‘åˆ°è¢«å¼•ç”¨å¯¹è±¡çš„åœ°å€,åªæœ‰è¿™æ ·,å½“å¯¹è±¡è¢«é”€æ¯æ—¶ï¼ŒæŒ‡é’ˆæ‰èƒ½è¢«`runtime`æ‰¾åˆ°ç„¶åè¢«è®¾ç½®ä¸º`nil`ï¼›`NSObject`å¯¹è±¡å’Œå…¶`associated object`å…³è”å¯¹è±¡çš„å…³ç³»ï¼Œå¹¶ä¸å­˜åœ¨æŒ‡é’ˆè¿™æ ·çš„**ä¸­é—´åª’ä»‹**ï¼Œå› æ­¤åªå­˜åœ¨`OBJC_ASSOCIATION_ASSIGN`é€‰é¡¹ï¼Œè€Œä¸å­˜åœ¨`OBJC_ASSOCIATION_WEAK`é€‰é¡¹.

#### é‚£æˆ‘ä»¬æ€ä¹ˆè§£å†³ä¸ºå…³è”å¯¹è±¡å®ç°weakå±æ€§å‘¢ï¼Ÿ

å¯ä»¥é€šè¿‡æ›²çº¿æ•‘å›½çš„æ–¹å¼å£°æ˜ä¸€ä¸ª`class`ç±» æŒæœ‰ä¸€ä¸ªweakçš„æˆå‘˜å˜é‡,ç„¶åé€šè¿‡ å®ä¾‹åŒ– æˆ‘ä»¬è‡ªå®šä¹‰çš„classçš„å®ä¾‹,ç„¶åæŠŠè¿™ä¸ªå®ä¾‹ä½œä¸ºå…³è”å¯¹è±¡å³å¯.

å£°æ˜å°è£…weakå¯¹è±¡çš„ç±»

```  objc
@interface WeakAssociatedObjectWrapper : NSObject
@property (nonatomic, weak) id object;
@end

@implementation WeakAssociatedObjectWrapper
@end
```

è°ƒç”¨

``` objc
@interface UIView (ViewController)
@property (nonatomic, weak) UIViewController *vc;
@end

@implementation UIView (ViewController)
- (void)setVc:(UIViewController *)vc {
    WeakAssociatedObjectWrapper *wrapper = [WeakAssociatedObjectWrapper new];
    wrapper.object = vc;
    objc_setAssociatedObject(self, @selector(vc), wrapper, OBJC_ASSOCIATION_RETAIN_NONATOMIC);
}
- (UIViewController *)vc {
    WeakAssociatedObjectWrapper *wrapper = objc_getAssociatedObject(self, _cmd);
    return wrapper.object;
}
@end
```
> çœ‹æ˜ç™½æ²¡æœ‰,æ›²çº¿æ•‘å›½.ä»£ç å¼•å…¥è‡ª[Weak Associated Object](https://zhangbuhuai.com/post/weak-associated-object.html)  

[å…³è”å¯¹è±¡å‚è€ƒ](https://draveness.me/ao/)

##  Autoreleasepoolçš„åŸç†ï¼Ÿæ‰€ä½¿ç”¨çš„çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ


åœ¨ARCä¸‹æˆ‘ä»¬ä½¿ç”¨`@autoreleasepool{}` å…³é”®å­— æŠŠéœ€è¦è‡ªåŠ¨ç®¡ç†çš„ä»£ç å—åœˆèµ·æ¥ ,è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åœ¨ä½¿ç”¨ä¸€ä¸ª`AutoReleasePool`

``` objc
@autoreleasepool {
	 <#statements#> //ä»£ç å—
}
```
ä»¥ä¸Šä»£ç ç¼–è¯‘å™¨ æœ€ç»ˆä¼šæŠŠå®ƒæ”¹å†™æˆä¸‹é¢çš„æ ·å­

``` c
void *context = objc_autoreleasePoolPush();
```

æ—¢ç„¶æœ‰å‹æ ˆä¸€å®šå°±æœ‰ å‡ºæ ˆæ“ä½œ`objc_autoreleasePoolPop(context)`;

* `objc_autoreleasePoolPush()`
* `objc_autoreleasePoolPop()`

è¿™ä¿©å‡½æ•°éƒ½æ˜¯å¯¹`AutoreleasePoolPage`çš„å°è£…,è‡ªåŠ¨é‡Šæ”¾æœºåˆ¶çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªç±»

###  `AutoreleasePoolPage`

`AutoreleasePoolPage`æ˜¯ä¸ªC++çš„ç±»

![](/assets/images/20200808iOSinterviewAnswers/autoreleasepoolpage.webp)

* **AutoreleasePool**å¹¶æ²¡æœ‰å•ç‹¬çš„ç»“æ„,è€Œæ˜¯ç”±è‹¥å¹²ä¸ª`AutoreleasePoolPage`ä»¥`åŒå‘é“¾è¡¨`çš„å½¢å¼ç»„åˆæˆçš„,æ ¹æ®ä¸Šå›¾å¯ä»¥çœ‹å‡º,è¿™ä¸ªåŒå‘é“¾è¡¨æœ‰`å‰é©±parent `å’Œ`åç»§child `.
*  **AutoreleasePool**æ˜¯æŒ‰`çº¿ç¨‹`ä¸€ä¸€å¯¹åº”çš„(thread æˆå‘˜å˜é‡)
*  **AutoreleasePoolPage**å°±æ˜¯è‡ªåŠ¨é‡Šæ”¾æ± å­˜å‚¨å¯¹è±¡çš„æ•°æ®ç»“æ„æ¯ä¸ªPageå ç”¨`4KB`å†…å­˜ï¼Œæœ¬èº«çš„æˆå‘˜å˜é‡å ç”¨`56`å­—èŠ‚ï¼Œå‰©ä¸‹çš„ç©ºé—´ç”¨æ¥å­˜æ”¾è°ƒç”¨äº†`autorelease`æ–¹æ³•çš„å¯¹è±¡åœ°å€,åŒæ—¶å°†ä¸€ä¸ªå“¨å…µæ’å…¥åˆ°Pageä¸­ï¼Œè¿™ä¸ªå“¨å…µå…¶å®å°±æ˜¯ä¸€ä¸ªç©ºåœ°å€
*  å½“ä¸€ä¸ªpageè¢«å æ»¡ä»¥åä¼šæ–°å»ºä¸€ä¸ªæ–°çš„`AutoreleasePoolPage`å¯¹è±¡,å¹¶æ’å…¥å“¨å…µæ ‡è®°.â€¨
å…·ä½“ä»£ç å¦‚ä¸‹:

``` objc
class AutoreleasePoolPage {
#   define EMPTY_POOL_PLACEHOLDER ((id*)1)
#   define POOL_BOUNDARY nil
    static pthread_key_t const key = AUTORELEASE_POOL_KEY;
    static uint8_t const SCRIBBLE = 0xA3;  // 0xA3A3A3A3 after releasing
    static size_t const SIZE = 
#if PROTECT_AUTORELEASEPOOL
        PAGE_MAX_SIZE;  // must be multiple of vm page size
#else
        PAGE_MAX_SIZE;  // size and alignment, power of 2
#endif
    static size_t const COUNT = SIZE / sizeof(id);
    magic_t const magic;
    id *next;
    pthread_t const thread;
    AutoreleasePoolPage * const parent;
    AutoreleasePoolPage *child;
    uint32_t const depth;
    uint32_t hiwat;
};

```

* `magic` æ£€æŸ¥æ ¡éªŒå®Œæ•´æ€§çš„å˜é‡
* `next` æŒ‡å‘æ–°åŠ å…¥çš„autoreleaseå¯¹è±¡
* `thread` pageå½“å‰æ‰€åœ¨çš„çº¿ç¨‹ï¼ŒAutoreleasePoolæ˜¯æŒ‰çº¿ç¨‹ä¸€ä¸€å¯¹åº”çš„ï¼ˆç»“æ„ä¸­çš„threadæŒ‡é’ˆæŒ‡å‘å½“å‰çº¿ç¨‹ï¼‰
* `parent` çˆ¶èŠ‚ç‚¹ æŒ‡å‘å‰ä¸€ä¸ªpage
* `child` å­èŠ‚ç‚¹ æŒ‡å‘ä¸‹ä¸€ä¸ªpage
* `depth` é“¾è¡¨çš„æ·±åº¦ï¼ŒèŠ‚ç‚¹ä¸ªæ•°
* `hiwat` high water mark æ•°æ®å®¹çº³çš„ä¸€ä¸ªä¸Šé™
* `EMPTY_POOL_PLACEHOLDER` ç©ºæ± å ä½
* `POOL_BOUNDARY` æ˜¯ä¸€ä¸ªè¾¹ç•Œå¯¹è±¡ nil,ä¹‹å‰çš„æºä»£ç å˜é‡åæ˜¯ `POOL_SENTINEL`å“¨å…µå¯¹è±¡,ç”¨æ¥åŒºåˆ«æ¯ä¸ªpageå³æ¯ä¸ª AutoreleasePoolPage è¾¹ç•Œ
* `PAGE_MAX_SIZE` = 4096, ä¸ºä»€ä¹ˆæ˜¯4096å‘¢ï¼Ÿå…¶å®å°±æ˜¯è™šæ‹Ÿå†…å­˜æ¯ä¸ªæ‰‡åŒº4096ä¸ªå­—èŠ‚,4Kå¯¹é½çš„è¯´æ³•ã€‚
* `COUNT` ä¸€ä¸ªpageé‡Œå¯¹è±¡æ•°


ä¸‹é¢çœ‹ä¸‹å·¥ä½œæœºåˆ¶å›¾

![](/assets/images/20200808iOSinterviewAnswers/autoreleasepoolworkflow.gif)

> è¿™å¼ å›¾æ¥è‡ªå¿«æ‰‹åŒäº‹ å‘¨å­¦è¿,å¦‚æœå¤§ä½¬çœ‹åˆ°è¿™å¼ å›¾çš„è¯å¸Œæœ›èƒ½å…è®¸æˆæƒç»™æˆ‘ä½¿ç”¨å“ˆ.

æ ¹æ®ä¸Šé¢çš„ç¤ºæ„å›¾æˆ‘ä»¬å¤§æ¦‚æ˜ç™½, `AutoreleasePoolPage`æ˜¯ä»¥æ ˆçš„å½¢å¼å­˜åœ¨,å¹¶ä¸”å†…éƒ¨å¯¹è±¡é€šè¿‡è¿›æ ˆå‡ºæ ˆæ¥å¯¹åº”ç€`objc_autoreleasePoolPush`å’Œ`objc_autoreleasePoolPop`

å¦‚æœåµŒå¥—AutoreleasePool å°±æ˜¯é€šè¿‡`å“¨å…µå¯¹è±¡`æ¥æ ‡è¯†,æ¯æ¬¡æ›´æ–°é“¾è¡¨çš„nextå’Œ`å‰é©±``åç»§`æ¥å®Œæˆè¡¨çš„åˆ›å»ºé”€æ¯.

![](/assets/images/20200808iOSinterviewAnswers/autoreleasepoolpage1.webp)

å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡`autorelease`æ¶ˆæ¯çš„æ—¶å€™å®é™…ä¸Šå°±æ˜¯å°†è¿™ä¸ªå¯¹è±¡åŠ å…¥åˆ°å½“å‰`AutoreleasePoolPage`çš„æ ˆé¡¶`next`æŒ‡é’ˆæŒ‡å‘çš„ä½ç½®

> è¿™é‡Œåªæ‹¿äº†ä¸€å¼ pageä¸¾ä¾‹.

#### å°ç»“

* è‡ªåŠ¨é‡Šæ”¾æ± æ˜¯æœ‰Nå¼ `AutoreleasePoolPage`ç»„æˆ,æ¯å¼ page  4Kå¤§å°, AutoreleasePoolPageæ˜¯c++çš„ç±», AutoreleasePoolPageä»¥åŒå‘é“¾è¡¨è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± 
* å½“å¯¹è±¡è°ƒç”¨ autorelease æ–¹æ³•æ—¶ï¼Œä¼šå°†å¯¹è±¡åŠ å…¥ AutoreleasePoolPage çš„æ ˆä¸­
* pop æ—¶æ˜¯ä¼ å…¥è¾¹ç•Œå¯¹è±¡(å“¨å…µå¯¹è±¡),ç„¶åå¯¹page ä¸­çš„å¯¹è±¡å‘é€release çš„æ¶ˆæ¯

[è‡ªåŠ¨é‡Šæ”¾æ± åŸç†](https://www.jianshu.com/p/0afda1f23782)
[AutoreleasePoolåº•å±‚å®ç°åŸç†](https://juejin.im/post/6844903609428115470)


## ARCçš„å®ç°åŸç†ï¼ŸARCä¸‹å¯¹retain, releaseåšäº†å“ªäº›ä¼˜åŒ–

ARCè‡ªåŠ¨å¼•ç”¨è®¡æ•°,æ˜¯è‹¹æœobjc4å¼•å…¥çš„ç¼–è¯‘å™¨è‡ªåŠ¨åœ¨é€‚å½“ä½ç½® å¸®åŠ©å®ä¾‹å¯¹è±¡è¿›è¡Œ è‡ªåŠ¨retainåè€…releaseçš„ä¸€å¥—æœºåˆ¶.

å®ƒçš„å®ç°åŸç†å°±æ˜¯åœ¨ç¼–è¯‘å±‚é¢æ’å…¥ç›¸å…³ä»£ç ,å¸®åŠ©è¡¥å…¨MRCæ—¶ä»£éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å¡«å†™çš„å’Œç®¡ç†çš„å¯¹è±¡çš„ç›¸å…³å†…å­˜æ“ä½œçš„æ–¹æ³•.

ä¸ºäº†è§£é‡Šæ¸…æ¥šå…·ä½“å®ç°åŸç† ,æˆ‘æ‰¾åˆ°ä¸€ç¯‡æœ‰ä»£ç ç¤ºä¾‹çš„æ–‡ç« ,ä»ä»£ç ç¼–è¯‘æˆæ±‡ç¼–è¿‡ç¨‹ä¸­ ç¼–è¯‘å™¨åšäº†å¾ˆå¤šä¼˜åŒ–å·¥ä½œ. æ›´æ–°`isaæŒ‡é’ˆ`çš„ä¿¡æ¯.

[ç†è§£ ARC å®ç°åŸç†](https://juejin.im/post/6844903847622606861#heading-4)

è¿™é‡Œæœ‰ä¸ªç‚¹éœ€è¦è·Ÿå¤§å®¶è¯´ä¸€ä¸‹, ä¸Šæ–‡ ä¸­æˆ‘ä»¬è®²äº†SlideTable,ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸æ‡‚å¾—åœ°æ–¹ä¸‹é¢æˆ‘ä»¬æ¥é€šè¿‡isaä¸²è”èµ·æ¥

isaçš„ç»„æˆ

``` c
union isa_t 
{
    Class cls;
    uintptr_t bits;
    struct {
         uintptr_t nonpointer        : 1;//->è¡¨ç¤ºä½¿ç”¨ä¼˜åŒ–çš„isaæŒ‡é’ˆ
         uintptr_t has_assoc         : 1;//->æ˜¯å¦åŒ…å«å…³è”å¯¹è±¡
         uintptr_t has_cxx_dtor      : 1;//->æ˜¯å¦è®¾ç½®äº†ææ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾å¯¹è±¡æ›´å¿«
         uintptr_t shiftcls          : 33; // MACH_VM_MAX_ADDRESS 0x1000000000 ->ç±»çš„æŒ‡é’ˆ
         uintptr_t magic             : 6;//->å›ºå®šå€¼,ç”¨äºåˆ¤æ–­æ˜¯å¦å®Œæˆåˆå§‹åŒ–
         uintptr_t weakly_referenced : 1;//->å¯¹è±¡æ˜¯å¦è¢«å¼±å¼•ç”¨
         uintptr_t deallocating      : 1;//->å¯¹è±¡æ˜¯å¦æ­£åœ¨é”€æ¯
         uintptr_t has_sidetable_rc  : 1;//1->åœ¨extra_rcå­˜å‚¨å¼•ç”¨è®¡æ•°å°†è¦æº¢å‡ºçš„æ—¶å€™,å€ŸåŠ©Sidetable(æ•£åˆ—è¡¨)å­˜å‚¨å¼•ç”¨è®¡æ•°,has_sidetable_rcè®¾ç½®æˆ1
        uintptr_t extra_rc          : 19;  //->å­˜å‚¨å¼•ç”¨è®¡æ•°
    };
};

```

å…¶ä¸­`nonpointer`ã€`weakly_referenced`ã€`has_sidetable_rc`å’Œ`extra_rc`éƒ½æ˜¯ `ARC`æœ‰ç›´æ¥å…³ç³»çš„æˆå‘˜å˜é‡ï¼Œå…¶ä»–çš„å¤§å¤šä¹Ÿæœ‰æ¶‰åŠåˆ°ã€‚

### retain,releaseåšäº†å“ªäº›ä¼˜åŒ–

å¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹

* TaggedPointer  æŒ‡é’ˆä¼˜åŒ–
* !newisa.nonpointerï¼šæœªä¼˜åŒ–çš„ isa çš„æƒ…å†µä¸‹retainæˆ–è€…release
* newisa.nonpointerï¼šå·²ä¼˜åŒ–çš„ isa ï¼Œ è¿™å…¶ä¸­åˆåˆ† extra_rc æº¢å‡ºåŒºåˆ« æˆ‘æŠŠç›¸å…³ä»£ç ç«™åœ¨ä¸‹é¢å¹¶ä¸”æŠŠç»“è®ºè¾“å‡ºå‡ºæ¥.

| å†…å­˜æ“ä½œ | objc_retain | objc_release |
| :------:| :------: | :------: |
| TaggedPointer | å€¼å­˜åœ¨æŒ‡é’ˆå†…ï¼Œç›´æ¥è¿”å› | ç›´æ¥è¿”å› falseã€‚ |
| !nonpointer | æœªä¼˜åŒ–çš„`isa`,ä½¿ç”¨`sidetable_retain()` | æœªä¼˜åŒ–çš„`isa`æ‰§è¡Œ`sidetable_release` |
| nonpointer| å·²ä¼˜åŒ–çš„`isa`,è¿™å…¶ä¸­åˆåˆ†`extra_rc`æº¢å‡ºå’Œæœªæº¢å‡ºçš„ä¸¤ç§æƒ…å†µ | å·²ä¼˜åŒ–çš„`isa`,åˆ†ä¸‹æº¢å’Œæœªä¸‹æº¢ä¸¤ç§æƒ…å†µ |


|nonpointerå·²ä¼˜åŒ–isaçš„extra_rc | objc_retain | objc_release |
| ------| ------ | ------ |
| æœªæº¢å‡ºæ—¶ |`isa.extra_rc`+1 | NA |
|æº¢å‡ºæ—¶|å°†`isa.extra_rc`ä¸­ä¸€åŠå€¼è½¬ç§»è‡³`sidetable`ä¸­,ç„¶åå°†`isa.has_sidetable_rc`è®¾ç½®ä¸º`true`,è¡¨ç¤ºä½¿ç”¨äº†`sidetable`æ¥è®¡ç®—å¼•ç”¨æ¬¡æ•°|NA|
|æœªä¸‹æº¢|NA|extra_rc--|
|ä¸‹æº¢|NA|ä»`sidetable`ä¸­å€Ÿä½ç»™`extra_rc`è¾¾åˆ°åŠæ»¡,å¦‚æœæ— æ³•å€Ÿä½åˆ™è¯´æ˜å¼•ç”¨è®¡æ•°å½’é›¶éœ€è¦è¿›è¡Œé‡Šæ”¾,å…¶ä¸­å€Ÿä½æ—¶å¯èƒ½ä¿å­˜å¤±è´¥ä¼šä¸æ–­é‡è¯•|  
> NA -> non available ä¸å¯è·å¾— 

ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹retainæºç 

``` objc
ALWAYS_INLINE id objc_object::rootRetain(bool tryRetain, bool handleOverflow) {
    if (isTaggedPointer()) return (id)this;     // å¦‚æœæ˜¯ TaggedPointer ç›´æ¥è¿”å›
    bool sideTableLocked = false;
    bool transcribeToSideTable = false;
    isa_t oldisa;
    isa_t newisa;
    do {
        transcribeToSideTable = false;
        oldisa = LoadExclusive(&isa.bits);  // è·å– isa
        newisa = oldisa;
        if (slowpath(!newisa.nonpointer)) {
            ClearExclusive(&isa.bits);// æœªä¼˜åŒ–çš„ isa éƒ¨åˆ†
            if (!tryRetain && sideTableLocked) sidetable_unlock();
            if (tryRetain) return sidetable_tryRetain() ? (id)this : nil;
            else return sidetable_retain();
        }
        if (slowpath(tryRetain && newisa.deallocating)) { // æ­£åœ¨è¢«é‡Šæ”¾çš„å¤„ç†
            ClearExclusive(&isa.bits);
            if (!tryRetain && sideTableLocked) sidetable_unlock();
            return nil;
        }
        // extra_rc æœªæº¢å‡ºæ—¶å¼•ç”¨è®¡æ•°++
        uintptr_t carry;
        newisa.bits = addc(newisa.bits, RC_ONE, 0, &carry);  // extra_rc++
        // extra_rc æº¢å‡º
        if (slowpath(carry)) {
            // newisa.extra_rc++ overflowed
            if (!handleOverflow) {
                ClearExclusive(&isa.bits);
                return rootRetain_overflow(tryRetain);   // é‡æ–°è°ƒç”¨è¯¥å‡½æ•° å…¥å‚ handleOverflow ä¸º true
            } 
            // ä¿ç•™ä¸€åŠå¼•ç”¨è®¡æ•°,å‡†å¤‡å°†å¦ä¸€åŠå¤åˆ¶åˆ° side table.
            if (!tryRetain && !sideTableLocked) sidetable_lock();
            sideTableLocked = true;
            transcribeToSideTable = true;
            newisa.extra_rc = RC_HALF;
            newisa.has_sidetable_rc = true;
        }
        //  æ›´æ–° isa å€¼
    } while (slowpath(!StoreExclusive(&isa.bits, oldisa.bits, newisa.bits)));
    if (slowpath(transcribeToSideTable)) {
        sidetable_addExtraRC_nolock(RC_HALF); // å°†å¦ä¸€åŠå¤åˆ¶åˆ° side table side table.
    }
    if (slowpath(!tryRetain && sideTableLocked)) sidetable_unlock();
    return (id)this;
}
```

`release`æºç  

``` objc
ALWAYS_INLINE bool objc_object::rootRelease(bool performDealloc, bool handleUnderflow)
{
    if (isTaggedPointer()) return false;
    bool sideTableLocked = false;
    isa_t oldisa;
    isa_t newisa;
 retry:
    do {
        oldisa = LoadExclusive(&isa.bits);
        newisa = oldisa;
        if (slowpath(!newisa.nonpointer)) {
            ClearExclusive(&isa.bits);// æœªä¼˜åŒ– isa
            if (sideTableLocked) sidetable_unlock();
            return sidetable_release(performDealloc);// å…¥å‚æ˜¯å¦è¦æ‰§è¡Œ Dealloc å‡½æ•°ï¼Œå¦‚æœä¸º true åˆ™æ‰§è¡Œ SEL_dealloc
        }
        newisa.bits = subc(newisa.bits, RC_ONE, 0, &carry);  // extra_rc--
        if (slowpath(carry)) {
            // donot ClearExclusive()
            goto underflow;
        }
        // æ›´æ–° isa å€¼
    } while (slowpath(!StoreReleaseExclusive(&isa.bits, 
                                             oldisa.bits, newisa.bits)));
    if (slowpath(sideTableLocked)) sidetable_unlock();
    return false;
 underflow:
 	// å¤„ç†ä¸‹æº¢ï¼Œä» side table ä¸­å€Ÿä½æˆ–è€…é‡Šæ”¾
    newisa = oldisa;
    if (slowpath(newisa.has_sidetable_rc)) { // å¦‚æœä½¿ç”¨äº† sidetable_rc
        if (!handleUnderflow) {
        	ClearExclusive(&isa.bits);// è°ƒç”¨æœ¬å‡½æ•°å¤„ç†ä¸‹æº¢
            return rootRelease_underflow(performDealloc);
        }
        size_t borrowed = sidetable_subExtraRC_nolock(RC_HALF); // ä» sidetable ä¸­å€Ÿä½å¼•ç”¨è®¡æ•°ç»™ extra_rc

        if (borrowed > 0) {
		// extra_rc æ˜¯è®¡ç®—é¢å¤–çš„å¼•ç”¨è®¡æ•°ï¼Œ0 å³è¡¨ç¤ºè¢«å¼•ç”¨ä¸€æ¬¡
            newisa.extra_rc = borrowed - 1;  // redo the original decrement too
            bool stored = StoreReleaseExclusive(&isa.bits, 
                                                oldisa.bits, newisa.bits);                                    
            // ä¿å­˜å¤±è´¥ï¼Œæ¢å¤ç°åœºï¼Œé‡è¯•                                    
            if (!stored) {
                isa_t oldisa2 = LoadExclusive(&isa.bits);
                isa_t newisa2 = oldisa2;
                if (newisa2.nonpointer) {
                    uintptr_t overflow;
                    newisa2.bits = 
                        addc(newisa2.bits, RC_ONE * (borrowed-1), 0, &overflow);
                    if (!overflow) {
                        stored = StoreReleaseExclusive(&isa.bits, oldisa2.bits, 
                                                       newisa2.bits);
                    }
                }
            }
		// å¦‚æœè¿˜æ˜¯ä¿å­˜å¤±è´¥ï¼Œåˆ™è¿˜å› side table
            if (!stored) {
                sidetable_addExtraRC_nolock(borrowed);
                goto retry;
            }
            sidetable_unlock();
            return false;
        }
        else {
            // Side table is empty after all. Fall-through to the dealloc path.
        }
    }
    // æ²¡æœ‰ä½¿ç”¨ sidetable_rc ï¼Œæˆ–è€… sidetable_rc è®¡æ•° == 0 çš„å°±ç›´æ¥é‡Šæ”¾
    // å¦‚æœå·²ç»æ˜¯é‡Šæ”¾ä¸­ï¼ŒæŠ›ä¸ªè¿‡åº¦é‡Šæ”¾é”™è¯¯
    if (slowpath(newisa.deallocating)) {
        ClearExclusive(&isa.bits);
        if (sideTableLocked) sidetable_unlock();
        return overrelease_error();
    }
    // æ›´æ–° isa çŠ¶æ€
    newisa.deallocating = true;
    if (!StoreExclusive(&isa.bits, oldisa.bits, newisa.bits)) goto retry;
    if (slowpath(sideTableLocked)) sidetable_unlock();
	// æ‰§è¡Œ SEL_dealloc äº‹ä»¶
    __sync_synchronize();
    if (performDealloc) {
        ((void(*)(objc_object *, SEL))objc_msgSend)(this, SEL_dealloc);
    }
    return true;
}
```

### å°ç»“

åˆ°è¿™é‡Œå¯ä»¥çŸ¥é“ å¼•ç”¨è®¡æ•°åˆ†åˆ«ä¿å­˜åœ¨`isa.extra_rc`å’Œ`sidetable`ä¸­ï¼Œå½“`isa.extra_rc`æº¢å‡ºæ—¶ï¼Œå°†ä¸€åŠè®¡æ•°è½¬ç§»è‡³`sidetable`ä¸­ï¼Œè€Œå½“å…¶ä¸‹æº¢æ—¶ï¼Œåˆä¼šå°†è®¡æ•°è½¬å›ã€‚å½“äºŒè€…éƒ½ä¸ºç©ºæ—¶ï¼Œä¼šæ‰§è¡Œé‡Šæ”¾æµç¨‹ 

## ARCä¸‹å“ªäº›æƒ…å†µä¼šé€ æˆå†…å­˜æ³„æ¼

* blockä¸­çš„å¾ªç¯å¼•ç”¨
* NSTimerçš„å¾ªç¯å¼•ç”¨
* addObserverçš„å¾ªç¯å¼•ç”¨
* delegateçš„å¼ºå¼•ç”¨
* å¤§æ¬¡æ•°å¾ªç¯å†…å­˜çˆ†æ¶¨
* éOCå¯¹è±¡çš„å†…å­˜å¤„ç†ï¼ˆéœ€æ‰‹åŠ¨é‡Šæ”¾ï¼‰


# æ€»ç»“

ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬è®¨è®ºä¸Šè¿°ä¸€å¥—é¢è¯•é¢˜çš„ runtimeç›¸å…³é—®é¢˜ä¹‹ å†…å­˜ç®¡ç†éƒ¨åˆ†,ä¸‹ä¸€ç¯‡è®²æŠŠå‰©ä½™çš„é—®é¢˜æ”¶ä¸€ä¸‹å°¾ æ„Ÿè°¢å„ä½æ”¯æŒ 




URL: https://sunyazhou.com/2020/07/iOSinterviewAnswers1/index.html.md
Published At: 2020-07-06 09:52:47 +0000

# é˜¿é‡Œã€å­—èŠ‚ï¼šä¸€å¥—é«˜æ•ˆçš„iOSé¢è¯•é¢˜ä¹‹runtimeç›¸å…³é—®é¢˜1

![](/assets/images/20200721iOSinterviewAnswers/iOSInterviewQuestionsAlbumCover.webp)

# å‰è¨€

> æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


è®°å¾—è¿‡å¹´æ—¶å€™ [æœ‰ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·](https://mp.weixin.qq.com/s/bDnsaD__ZpdHIk3_So382w) çš„é¢è¯•é¢˜å¼•èµ·äº†æˆ‘çš„å…³æ³¨,ä½†æ˜¯åªæœ‰é—®é¢˜æ²¡æœ‰ç­”æ¡ˆ,ç”±äºæœ€è¿‘åŠå¹´æ—¶é—´å¤ªå¿™äº†,åšå®¢å‡ ä¹åœæ›´äº†ä¸€ä¸ªå­£åº¦,æ‰€ä»¥ä»Šå¤©æˆ‘æ‰“ç®—æŠŠè¿™ä¸ªé¢è¯•é¢˜çš„ç­”æ¡ˆ æ•´ç†ä¸€ä¸‹,æ–¹ä¾¿åç»­iOSå¼€å‘è€…éœ€è¦æ—¶å¯æ—¶é•¿å…³æ³¨.æœŸé—´å¦‚æœæœ‰è§£ç­”ä¸æ¸…æ¥šæˆ–è€…ä¸å¯¹ä¹‹å¤„è¿˜è¯·å„ä½æŒ‡æ­£.


# é¢è¯•é¢˜çš„ç»“æ„åˆ†ç±»å’Œç»†åŒ–

* runtimeç›¸å…³é—®é¢˜
	1. runtimeç»“æ„æ¨¡å‹
	2. å†…å­˜ç®¡ç†
	3. å…³è”å±æ€§æˆ–è€…hookç›¸å…³çš„Method Swizzle
* NSNotificationç›¸å…³
	1. å‚è€ƒGNUStepæºç 
	2. NSNotificationå®ç°åŸç† ç›¸å…³
* Runloop & KVO
	1. runloop
	2. KVO
* Block
	1. Blockå®ç°åŸç†å’Œæ³¨æ„äº‹é¡¹ç›¸å…³
* å¤šçº¿ç¨‹
	1. GCDç›¸å…³å’Œä¸€äº›å¤šçº¿ç¨‹æ¦‚å¿µ
* è§†å›¾&å›¾åƒç›¸å…³
	1.  è§†å›¾UIå¸ƒå±€æ–¹æ¡ˆ
	2. è§†å›¾æ¸²æŸ“ç›¸å…³
* æ€§èƒ½ä¼˜åŒ–
* å¼€å‘è¯ä¹¦
* æ¶æ„è®¾è®¡
	1. å„ç§è®¾è®¡æ¨¡å¼
	2. è‡ªå·±çš„è®¾è®¡
* å…¶ä»–é—®é¢˜
	1. æ–¹æ³•è°ƒç”¨å’Œåˆ‡é¢ç¼–ç¨‹ç­‰
* ç³»ç»ŸåŸºç¡€çŸ¥è¯†
* æ•°æ®ç»“æ„ä¸ç®—æ³•


## runtimeç›¸å…³é—®é¢˜

[objc-runtimeæºç åœ°å€](https://github.com/RetVal/objc-runtime)   
[objc4å®˜æ–¹æºç åœ°å€](https://opensource.apple.com/tarballs/objc4/)

### ç»“æ„æ¨¡å‹

#### ä»‹ç»ä¸‹runtimeçš„å†…å­˜æ¨¡å‹ï¼ˆisaã€å¯¹è±¡ã€ç±»ã€metaclassã€ç»“æ„ä½“çš„å­˜å‚¨ä¿¡æ¯ç­‰ï¼‰

##### å¯¹è±¡

OCä¸­çš„å¯¹è±¡æŒ‡å‘çš„æ˜¯ä¸€ä¸ª`objc_object`æŒ‡é’ˆç±»å‹ï¼Œ`typedef struct objc_object *id;`ä»å®ƒçš„ç»“æ„ä½“ä¸­å¯ä»¥çœ‹å‡ºï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒæŒ‡å‘çš„æ˜¯è¿™ä¸ªå¯¹è±¡çš„ç±»å¯¹è±¡,ä¸€ä¸ªå¯¹è±¡å®ä¾‹å°±æ˜¯é€šè¿‡è¿™ä¸ªisaæ‰¾åˆ°å®ƒè‡ªå·±çš„Classï¼Œè€Œè¿™ä¸ªClassä¸­å­˜å‚¨çš„å°±æ˜¯è¿™ä¸ªå®ä¾‹çš„æ–¹æ³•åˆ—è¡¨ã€å±æ€§åˆ—è¡¨ã€æˆå‘˜å˜é‡åˆ—è¡¨ç­‰ç›¸å…³ä¿¡æ¯çš„ã€‚

``` objc
/// Represents an instance of a class.
struct objc_object {
    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;
};

/// A pointer to an instance of a class.
typedef struct objc_object *id;
```
è¿™ä¸ªobjc_object çš„å®ç°æ¯”è¾ƒé•¿ åœ¨è¿™é‡Œ[æŸ¥çœ‹](https://github.com/RetVal/objc-runtime/blob/master/runtime/objc-private.h)

#### ç±»

åœ¨OCä¸­çš„ç±»æ˜¯ç”¨Classæ¥è¡¨ç¤ºçš„ï¼Œå®é™…ä¸Šå®ƒæŒ‡å‘çš„æ˜¯ä¸€ä¸ª`objc_class`çš„æŒ‡é’ˆç±»å‹ï¼Œ`typedef struct objc_class *Class;`  
å¯¹åº”çš„ç»“æ„ä½“å¦‚ä¸‹ï¼š

``` objc
struct objc_class {
    Class _Nonnull isa  OBJC_ISA_AVAILABILITY;

#if !__OBJC2__
    Class _Nullable super_class                              OBJC2_UNAVAILABLE;
    const char * _Nonnull name                               OBJC2_UNAVAILABLE;
    long version                                             OBJC2_UNAVAILABLE;
    long info                                                OBJC2_UNAVAILABLE;
    long instance_size                                       OBJC2_UNAVAILABLE;
    struct objc_ivar_list * _Nullable ivars                  OBJC2_UNAVAILABLE;
    struct objc_method_list * _Nullable * _Nullable methodLists                    OBJC2_UNAVAILABLE;
    struct objc_cache * _Nonnull cache                       OBJC2_UNAVAILABLE;
    struct objc_protocol_list * _Nullable protocols          OBJC2_UNAVAILABLE;
#endif

}
```

##### classå’Œ object  å°ç»“

ä»ç»“æ„ä½“ä¸­å®šä¹‰çš„å˜é‡å¯çŸ¥ï¼ŒOCçš„`Class`ç±»å‹åŒ…æ‹¬å¦‚ä¸‹

æ•°æ®ï¼ˆå³ï¼šå…ƒæ•°æ®`metadata`ï¼‰ï¼š`super_class`ï¼ˆçˆ¶ç±»ç±»å¯¹è±¡ï¼‰;  
nameï¼ˆç±»å¯¹è±¡çš„åç§°ï¼‰;   
versionã€infoï¼ˆç‰ˆæœ¬å’Œç›¸å…³ä¿¡æ¯ï¼‰;  
instance_sizeï¼ˆå®ä¾‹å†…å­˜å¤§å°ï¼‰;  
ivarsï¼ˆå®ä¾‹å˜é‡åˆ—è¡¨ï¼‰ï¼›  
methodListsï¼ˆæ–¹æ³•åˆ—è¡¨ï¼‰ï¼›  
cacheï¼ˆç¼“å­˜ï¼‰ï¼›  
protocolsï¼ˆå®ç°çš„åè®®åˆ—è¡¨ï¼‰;  
å½“ç„¶ä¹ŸåŒ…æ‹¬ä¸€ä¸ªisaæŒ‡é’ˆï¼Œè¿™è¯´æ˜Classä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å¯¹è±¡ï¼Œ
è¿™é‡Œçš„isaæŒ‡å‘çš„æ˜¯å…ƒç±»å¯¹è±¡ï¼ˆmetaclassï¼‰ï¼Œå…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ï¼ˆClassï¼‰çš„ç±»æ–¹æ³•çš„å…¨éƒ¨ä¿¡æ¯ã€‚

![Objective-Cçš„å¯¹è±¡åŸå‹ç»§æ‰¿é“¾](/assets/images/20200721iOSinterviewAnswers/class_inherit.webp)  [Objective-Cçš„å¯¹è±¡åŸå‹ç»§æ‰¿é“¾]()


ä»å›¾ä¸­å¯çŸ¥ï¼Œæœ€ç»ˆçš„åŸºç±»`NSObject`çš„å…ƒç±»å¯¹è±¡`isa`æŒ‡å‘çš„æ˜¯è‡ªå·±æœ¬èº«ï¼Œä»è€Œå½¢æˆä¸€ä¸ªé—­ç¯ã€‚  
å…ƒç±»ï¼ˆ`Meta Class`ï¼‰ï¼šæ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ï¼Œå³ï¼šClassçš„ç±»ï¼Œè¿™é‡Œä¿å­˜äº†ç±»æ–¹æ³•ç­‰ç›¸å…³ä¿¡æ¯ã€‚  
æˆ‘ä»¬å†çœ‹ä¸€ä¸‹ç±»å¯¹è±¡ä¸­å­˜å‚¨çš„æ–¹æ³•ã€å±æ€§ã€æˆå‘˜å˜é‡ç­‰ä¿¡æ¯çš„ç»“æ„ä½“  
`objc_ivar_list`ï¼šå­˜å‚¨äº†ç±»çš„æˆå‘˜å˜é‡ï¼Œ  
å¯ä»¥é€šè¿‡`object_getIvar`æˆ–`class_copyIvarList`è·å–ï¼›  
å¦å¤–è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ç”¨æ¥è·å–ç±»çš„å±æ€§åˆ—è¡¨çš„`class_getProperty`å’Œ`class_copyPropertyList`ï¼Œå±æ€§å’Œæˆå‘˜å˜é‡æ˜¯æœ‰åŒºåˆ«çš„ã€‚

``` objc
struct objc_ivar {
    char * _Nullable ivar_name                               OBJC2_UNAVAILABLE;
    char * _Nullable ivar_type                               OBJC2_UNAVAILABLE;
    int ivar_offset                                          OBJC2_UNAVAILABLE;
#ifdef __LP64__
    int space                                                OBJC2_UNAVAILABLE;
#endif
}                                                            OBJC2_UNAVAILABLE;

struct objc_ivar_list {
    int ivar_count                                           OBJC2_UNAVAILABLE;
#ifdef __LP64__
    int space                                                OBJC2_UNAVAILABLE;
#endif
    /* variable length structure */
    struct objc_ivar ivar_list[1]                            OBJC2_UNAVAILABLE;
} 
```

`objc_method_list`ï¼šå­˜å‚¨äº†ç±»çš„æ–¹æ³•åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡`class_copyMethodList`è·å–ã€‚

ç»“æ„ä½“å¦‚ä¸‹:

``` objc
struct objc_method {
    SEL _Nonnull method_name                                 OBJC2_UNAVAILABLE;
    char * _Nullable method_types                            OBJC2_UNAVAILABLE;
    IMP _Nonnull method_imp                                  OBJC2_UNAVAILABLE;
}                                                            OBJC2_UNAVAILABLE;

struct objc_method_list {
    struct objc_method_list * _Nullable obsolete             OBJC2_UNAVAILABLE;

    int method_count                                         OBJC2_UNAVAILABLE;
#ifdef __LP64__
    int space                                                OBJC2_UNAVAILABLE;
#endif
    /* variable length structure */
    struct objc_method method_list[1]                        OBJC2_UNAVAILABLE;
} 
```

`objc_protocol_list`ï¼šå‚¨å­˜äº†ç±»çš„åè®®åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡`class_copyProtocolList`è·å–ã€‚

ç»“æ„ä½“å¦‚ä¸‹ï¼š

``` objc
struct objc_protocol_list {
    struct objc_protocol_list * _Nullable next;
    long count;
    __unsafe_unretained Protocol * _Nullable list[1];
};
```

æ­¤é—®é¢˜å‚è€ƒ[ä»‹ç»ä¸‹runtimeçš„å†…å­˜æ¨¡å‹ï¼ˆisaã€å¯¹è±¡ã€ç±»ã€metaclassã€ç»“æ„ä½“çš„å­˜å‚¨ä¿¡æ¯ç­‰ï¼‰](https://developer.aliyun.com/ask/282811)

#### ä¸ºä»€ä¹ˆè¦è®¾è®¡metaclass?

å…ˆè¯´ç»“è®º: ä¸ºäº†æ›´å¥½çš„**å¤ç”¨ä¼ é€’æ¶ˆæ¯**.metaclassåªæ˜¯éœ€è¦**å®ç°å¤ç”¨æ¶ˆæ¯ä¼ é€’**ä¸ºç›®çš„å·¥å…·.è€ŒObjective-Cæ‰€æœ‰çš„ç±»é»˜è®¤éƒ½æ˜¯åŒä¸€ä¸ªMetaClass(é€šè¿‡isaæŒ‡é’ˆæœ€ç»ˆæŒ‡å‘metaclass). å› ä¸ºObjective-Cçš„ç‰¹æ€§åŸºæœ¬ä¸Šæ˜¯ç…§æ¬çš„Smalltalk,Smalltalkä¸­çš„MetaClassçš„è®¾è®¡æ˜¯Smalltalk-80åŠ å…¥çš„.æ‰€ä»¥Objective-Cä¹Ÿå°±æœ‰äº†metaclassçš„è®¾è®¡.

> æœ¬è´¨ä¸Šå› ä¸ºSmalltalkçš„é¢å‘å¯¹è±¡çš„äº®ç‚¹æ˜¯å®ƒçš„**æ¶ˆæ¯å‘é€æœºåˆ¶**.


å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰æˆ‘ä»¬å…ˆå›çœ‹ä¸€ä¸‹ä¸Šè¾¹çš„Objective-Cçš„å¯¹è±¡åŸå‹ç»§æ‰¿é“¾![Objective-Cçš„å¯¹è±¡åŸå‹ç»§æ‰¿é“¾](/assets/images/20200721iOSinterviewAnswers/class_inherit2.webp)

é€šè¿‡ä¸Šå›¾æˆ‘ä»¬æ˜ç™½å¦‚ä¸‹ é‡ç‚¹å†…å®¹:

* **å®ä¾‹çš„å®ä¾‹æ–¹æ³•å‡½æ•°å­˜åœ¨ç±»ç»“æ„ä½“ä¸­**
* **ç±»æ–¹æ³•å‡½æ•°å­˜åœ¨metaclassç»“æ„ä½“ä¸­**

è€ŒObjective-Cçš„æ–¹æ³•è°ƒç”¨ï¼ˆæ¶ˆæ¯ï¼‰å°±ä¼šæ ¹æ®å¯¹è±¡å»æ‰¾isaæŒ‡é’ˆæŒ‡å‘çš„Classå¯¹è±¡ä¸­çš„æ–¹æ³•åˆ—è¡¨æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚
> isa æŒ‡å‘çš„ç±»å°±æ˜¯æˆ‘ä»¬åˆ›å»ºå®ä¾‹çš„ç±»å‹.

é€šè¿‡[Why is MetaClass in Objective-Cï¼Ÿ](https://www.jianshu.com/p/ea7c42e16da8)æ–‡ç« æˆ‘ä»¬äº†è§£åˆ°ä¸€ä¸ªååˆ†é‡è¦çš„æ¦‚å¿µ,pythonå’Œ**Objective-Cä¸å¤ªä¸€æ ·çš„æ˜¯,å¹¶ä¸æ˜¯æ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªMetaClass,è€Œæ˜¯Objective-Cæ‰€æœ‰çš„ç±»é»˜è®¤éƒ½æ˜¯åŒä¸€ä¸ªMetaClass.**

##### Smalltalkä¸­çš„metaclass

Smalltalkï¼Œè¢«å…¬è®¤ä¸ºå†å²ä¸Šç¬¬äºŒä¸ªé¢å‘å¯¹è±¡çš„è¯­è¨€ï¼Œå…¶äº®ç‚¹æ˜¯å®ƒçš„**æ¶ˆæ¯å‘é€æœºåˆ¶**ã€‚  
Smalltalkä¸­çš„MetaClassçš„è®¾è®¡æ˜¯Smalltalk-80åŠ å…¥çš„ã€‚è€Œä¹‹å‰çš„Smalltalk-76ï¼Œå¹¶ä¸æ˜¯æ¯ä¸ªç±»æœ‰ä¸€ä¸ªMetaClassï¼Œè€Œæ˜¯æ‰€æœ‰ç±»çš„isaæŒ‡é’ˆéƒ½æŒ‡å‘ä¸€ä¸ªç‰¹æ®Šçš„ç±»ï¼Œå«åšClass(è¿™ç§è®¾è®¡ä¹‹åä¹Ÿè¢«Javaå€Ÿé‰´äº†ï¼‰ã€‚  
è€Œæ¯ä¸ªç±»éƒ½æœ‰è‡ªå·±MetaClassçš„è®¾è®¡ï¼ŒåŠ å…¥çš„åŸå› æ˜¯ï¼Œå› ä¸ºSmalltalké‡Œé¢ï¼Œç±»æ˜¯å¯¹è±¡ï¼Œè€Œå¯¹è±¡å°±å¯ä»¥å“åº”æ¶ˆæ¯ï¼Œé‚£ä¹ˆç±»çš„æ¶ˆæ¯çš„å“åº”çš„æ–¹æ³•å°±åº”è¯¥ç”±ç±»çš„ç±»å»å­˜å‚¨ï¼Œè€Œæ¯ä¸ªMetaClasså°±æŒæœ‰æ¯ä¸ªç±»çš„ç±»æ–¹æ³•ã€‚

######  æ¯ä¸ªMetaClassçš„isaæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆï¼Ÿ

å¦‚æœMetaClasså†æœ‰MetaClassï¼Œé‚£ä¹ˆè¿™ä¸ªå…³ç³»å°†æ— ç©·æ— å°½ã€‚Smalltalké‡Œçš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼ŒæŒ‡å‘åŒä¸€ä¸ªå«MetaClassçš„ç±»ã€‚

###### MetaClassçš„isaæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆï¼Ÿ

æŒ‡å‘ä»–çš„å®ä¾‹ï¼Œä¹Ÿå°±æ˜¯å®ä¾‹çš„isaæŒ‡å‘MetaClassï¼ŒåŒæ—¶MetaClassisaæŒ‡å‘å®ä¾‹ï¼Œç›¸äº’æŒ‡ç€ã€‚

é‚£ä¹ˆSmalltalkçš„ç»§æ‰¿å…³ç³»ï¼Œå…¶å®å’ŒObjective-Cçš„å¾ˆåƒäº†ï¼ˆåé¢æœ‰classçš„æ˜¯å‰è€…çš„MetaClassï¼‰ã€‚

![](/assets/images/20200721iOSinterviewAnswers/class_inherit2_smaltalk.webp)

###### è¿™æ—¶å€™äº§ç”Ÿäº†ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼Œå‡å¦‚å»æ‰MetaClassï¼ŒæŠŠç±»æ–¹æ³•æ”¾åˆ°ä¹Ÿç±»é‡Œé¢æ˜¯å¦å¯è¡Œï¼Ÿ

è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ€ç´¢è®¸ä¹…ï¼Œå‘ç°å…¶å®æ˜¯ä¸€ä¸ªå¯¹é¢å‘å¯¹è±¡çš„å“²å­¦æ€æƒ³é—®é¢˜ï¼Œè¦å¯¹è¿™ä¸ªé—®é¢˜ä¸‹ç»“è®ºï¼Œä¸å¾—ä¸é‡æ–°è®²è®²é¢å‘å¯¹è±¡

##### ä»Smalltalké‡æ–°è®¤è¯†é¢å‘å¯¹è±¡

ä»¥å‰è°ˆåˆ°é¢å‘å¯¹è±¡ï¼Œæ€»ä¼šæåˆ°ï¼Œé¢å‘å¯¹è±¡ä¸‰ç‰¹å¾ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚ä½†å…¶å®ï¼Œé¢å‘å¯¹è±¡ä¸­ä¹Ÿåˆ†æµæ´¾ï¼Œå¦‚C++è¿™ç§æ¥è‡ªSimulaçš„è®¾è®¡æ€æƒ³çš„ï¼Œæ›´æ³¨é‡çš„æ˜¯ç±»çš„åˆ’åˆ†ï¼Œå› ä¸ºæ–¹æ³•è°ƒç”¨æ˜¯é™æ€çš„ã€‚è€Œå¦‚Objective-Cè¿™ç§å€Ÿé‰´Smalltalkçš„ï¼Œæ›´æ³¨é‡çš„æ˜¯æ¶ˆæ¯ä¼ é€’ï¼Œæ˜¯åŠ¨æ€å“åº”æ¶ˆæ¯ã€‚

è€Œé¢å‘å¯¹è±¡ä¸‰ç§ç‰¹å¾ï¼Œæ›´åŸºäºçš„æ˜¯ç±»çš„åˆ’åˆ†è€Œæå‡ºçš„ã€‚

è¿™ä¸¤ç§æ€æƒ³æœ€å¤§çš„ä¸åŒï¼Œæˆ‘è®¤ä¸ºæ˜¯è‡ªä¸Šè€Œä¸‹å’Œè‡ªä¸‹è€Œä¸Šçš„æ€è€ƒæ–¹å¼ã€‚

* ç±»çš„åˆ’åˆ†ï¼Œè¦æ±‚ç±»çš„è®¾è®¡è€…æ˜¯ä»¥ä¸€ä¸ªå¾ˆé«˜çš„å±‚æ¬¡å»è®¾è®¡è¿™ä¸ªç±»ï¼Œæå–å‡ºç±»çš„ç‰¹æ€§å’Œæœ¬è´¨ï¼Œè¿›è¡Œç±»çš„æ„å»ºã€‚çŸ¥é“ç±»å‹æ‰å¯ä»¥å»å‘é€æ¶ˆæ¯ç»™å¯¹è±¡ã€‚
* æ¶ˆæ¯ä¼ é€’ï¼Œè¦æ±‚çš„æ˜¯ç±»çš„è®¾è®¡è€…ä»¥æ¶ˆæ¯ä¸ºèµ·ç‚¹å»æ„å»ºç±»ï¼Œä¹Ÿå°±æ˜¯å¯¹å¤–ç•Œçš„å˜åŒ–è¿›è¡Œå“åº”ï¼Œè€Œä¸å…³å¿ƒè‡ªèº«çš„ç±»å‹ï¼Œè®¾è®¡æ¥å£ã€‚å°è¯•ç†è§£æ¶ˆæ¯ï¼Œæ— æ³•å¤„ç†åˆ™è¿›è¡Œç‰¹æ®Šå¤„ç†ã€‚
åœ¨æ­¤ä¸è®¨è®ºä¸¤ç§æ–¹å¼çš„ä¼˜åŠ£ä¹‹åˆ†ï¼Œè€Œç€é‡è®²è®²Smalltalkè¿™ç§è®¾è®¡ã€‚

æ¶ˆæ¯ä¼ é€’å¯¹äºé¢å‘å¯¹è±¡çš„è®¾è®¡ï¼Œå…¶å®åœ¨äºç»™å‡ºä¸€ç§å¯¹æ¶ˆæ¯çš„è§£å†³æ–¹æ¡ˆã€‚è€Œé¢å‘å¯¹è±¡ä¼˜ç‚¹ä¹‹ä¸€çš„å¤ç”¨ï¼Œåœ¨è¿™ç§è®¾è®¡é‡Œï¼Œæ›´å¤šåœ¨äºå¤ç”¨è§£å†³æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯å•çº¯çš„ç±»æœ¬èº«ã€‚è¿™ç§æ€æƒ³å°±å¦‚è®¾è®¡ç»„ä»¶ä¸€èˆ¬ï¼Œå…³å¿ƒæ¥å£ï¼Œå…³å¿ƒç»„åˆè€Œéç±»æœ¬èº«ã€‚å…¶å®ä¹‹æ‰€ä»¥æœ‰MetaClassè¿™ç§è®¾è®¡ï¼Œæˆ‘çš„ç†è§£å¹¶ä¸æ˜¯å…ˆæœ‰MetaClassï¼Œè€Œæ˜¯åœ¨ä¸‡ç‰©éƒ½æ˜¯å¯¹è±¡çš„Smalltalké‡Œï¼Œå‘å¯¹è±¡å‘é€æ¶ˆæ¯çš„åŸºæœ¬è§£å†³æ–¹æ¡ˆæ˜¯ç»Ÿä¸€çš„ï¼Œå¸Œæœ›å¤ç”¨çš„ã€‚è€Œå®ä¾‹å’Œç±»ä¹‹é—´ç”¨çš„è¿™ä¸€å¥—é€šè¿‡isaæŒ‡é’ˆæŒ‡å‘çš„Classå•ä¾‹ä¸­å­˜å‚¨æ–¹æ³•åˆ—è¡¨å’ŒæŸ¥è¯¢æ–¹æ³•çš„è§£å†³æ–¹æ¡ˆçš„æµç¨‹ï¼Œæ˜¯åº”è¯¥åœ¨ç±»ä¸Šå¤ç”¨çš„ï¼Œè€ŒMetaClasså°±é¡ºç†æˆç« å‡ºç°ç½¢äº†ã€‚

##### ä¸ºä»€ä¹ˆè¦è®¾è®¡metaclasså°ç»“ 

###### å›åˆ°ä¸€å¼€å§‹é‚£ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆè¦è®¾è®¡MetaClassï¼Œå»æ‰æŠŠç±»æ–¹æ³•æ”¾åˆ°ç±»é‡Œé¢è¡Œä¸è¡Œï¼Ÿ

æˆ‘çš„ç†è§£æ˜¯ï¼Œå¯ä»¥ï¼Œä½†ä¸Smalltalkã€‚è¿™æ ·çš„è®¾è®¡æ˜¯C++é‚£ç§è‡ªä¸Šè€Œä¸‹çš„è®¾è®¡æ–¹å¼ï¼Œç±»æ–¹æ³•ä¹Ÿæ˜¯ç±»çš„ä¸€ç§ç‰¹å¾æè¿°ã€‚è€ŒSmalltalkçš„ç²¾é«“æ­£åœ¨äºæ¶ˆæ¯ä¼ é€’ï¼Œå¤ç”¨æ¶ˆæ¯ä¼ é€’æ‰æ˜¯æ ¹æœ¬ç›®çš„ï¼Œè€ŒMetaClassåªä¸è¿‡æ˜¯å› æ­¤éœ€è¦çš„ä¸€ä¸ªå·¥å…·ç½¢äº†ã€‚

å‚è€ƒ[Why is MetaClass in Objective-Cï¼Ÿ](https://www.jianshu.com/p/ea7c42e16da8)

#### **class_copyIvarList()** & **class_copyPropertyList()**åŒºåˆ«

å…ˆè¯´ç»“è®º:

* **class_copyIvarList()** èƒ½è·å–åˆ°æ‰€æœ‰çš„æˆå‘˜å˜é‡,åŒ…æ‹¬ èŠ±æ‹¬å·å†…çš„å˜é‡(`.h`å’Œ`.m`éƒ½åŒ…æ‹¬).
* **class_copyPropertyList()** åªèƒ½è·å–åˆ° ä»¥`@property`å…³é”®å­— å£°æ˜çš„ä¸­å±æ€§(`.h`å’Œ`.m`éƒ½åŒ…æ‹¬)

åŒºåˆ«:

* `class_copyIvarList()`è·å–é»˜è®¤æ˜¯å¸¦ä¸‹åˆ’çº¿çš„å˜é‡
* `class_copyPropertyList()`è·å–é»˜è®¤æ˜¯ä¸å¸¦ä¸‹åˆ’çº¿çš„å˜é‡åç§°.

> ä½†æ˜¯ä»¥ä¸Šä¸¤ä¸ªæ–¹æ³•éƒ½åªèƒ½è·å–åˆ°å½“å‰ç±»çš„å±æ€§å’Œå˜é‡ï¼ˆä¹Ÿå°±æ˜¯è¯´è·å–ä¸åˆ°çˆ¶ç±»çš„å±æ€§å’Œå˜é‡ï¼‰  

___

ä¸¾ä¾‹è¯´æ˜:

æˆ‘ä»¬å£°æ˜ä¸€ä¸ª`ClassA` é€šè¿‡ è°ƒè¯•ä»£ç å®ç°

``` objc
#import <Foundation/Foundation.h>
#import <objc/runtime.h>

@interface ClassA : NSObject {
    int _a;
    int _b;
    int _c;
    CGFloat d; //ä¸æ¨èè¿™æ ·å†™
}

@property (nonatomic, strong) NSArray          *arrayA;
@property (nonatomic, copy  ) NSString         *stringA;
@property (nonatomic, assign) dispatch_queue_t testQueue;

@end

@implementation ClassA
@end
```
å¦‚æœæ˜¯é€šè¿‡`class_copyIvarList()`å‡½æ•°è·å–åˆ™æ‰“å°å¦‚ä¸‹ç»“æœ.

``` sh
 --- class_copyIvarList â†“â†“â†“---
 _a
 _b
 _c
 d
 _arrayA
 _stringA
 _testQueue
 --------------END----------------
```

å¦‚æœæ˜¯é€šè¿‡`class_copyPropertyList()`å‡½æ•°è·å–åˆ™æ‰“å°å¦‚ä¸‹ç»“æœ.

``` sh
 --- class_copyPropertyList â†“â†“â†“---
 arrayA
 stringA
 testQueue
 --------------END----------------
```

debugä»£ç å¦‚ä¸‹:

``` objc
- (void)printIvarOrProperty {
    NSLog(@"--- class_copyPropertyList â†“â†“â†“---");
    ClassA *classA = [[ClassA alloc] init];
    unsigned int propertyCount;
    objc_property_t *result = class_copyPropertyList(object_getClass(classA), &propertyCount);
    for (unsigned int i = 0; i < propertyCount; i++) {
        objc_property_t objc_property_name = result[i];
        NSLog(@"%@",[NSString stringWithFormat:@"%s", property_getName(objc_property_name)]);
    }
    free(result);
    NSLog(@"--------------END----------------");
    NSLog(@"--- class_copyIvarList â†“â†“â†“---");
    Ivar *iv = class_copyIvarList(object_getClass(classA), &propertyCount);
    for (unsigned int i = 0; i < propertyCount; i++) {
        Ivar ivar = iv[i];
        NSLog(@"%@",[NSString stringWithFormat:@"%s", ivar_getName(ivar)]);
    }
    free(iv);
    NSLog(@"--------------END----------------");
}
```

ä»¥ä¸Š[demoç‚¹å‡»è¿™é‡Œä¸‹è½½](https://github.com/sunyazhou13/IvarAndPropertyDemo)

___

ä¸‹é¢æˆ‘ä»¬çœ‹ä¸‹[objcçš„æºç ](https://github.com/sunyazhou13/objc-runtime)

ä»¥ä¸‹ä»£ç ä½äº`objc-runtime-new.mm`ä¸­

``` c++
/***********************************************************************
* class_copyPropertyList. Returns a heap block containing the 
* properties declared in the class, or nil if the class 
* declares no properties. Caller must free the block.
* Does not copy any superclass's properties.
* Locking: read-locks runtimeLock
**********************************************************************/
objc_property_t *
class_copyPropertyList(Class cls, unsigned int *outCount)
{
    if (!cls) {
        if (outCount) *outCount = 0;
        return nil;
    }

    mutex_locker_t lock(runtimeLock);

    checkIsKnownClass(cls);
    ASSERT(cls->isRealized());
    
    auto rw = cls->data();

    property_t **result = nil;
    unsigned int count = rw->properties.count();
    if (count > 0) {
        result = (property_t **)malloc((count + 1) * sizeof(property_t *));

        count = 0;
        for (auto& prop : rw->properties) {
            result[count++] = &prop;
        }
        result[count] = nil;
    }

    if (outCount) *outCount = count;
    return (objc_property_t *)result;
}
```
é€šè¿‡æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ° 

``` c
auto rw = cls->data();
rw->properties; //é€šè¿‡rwç›´æ¥æ‹¿åˆ°properties
```
é€šè¿‡rwç›´æ¥æ‹¿åˆ°properties,ç„¶åä¾¿åˆ©æ‹¿å‡ºæƒ³è¦çš„ ä»¥`@property`å…³é”®å­— å£°æ˜å˜é‡åç§°.

`properties `è¯¦ç»†å†…å®¹ è¿˜è¯·å¼‚æ­¥è¿è¡Œæ—¶æºç çœ‹ä¸‹è¿™é‡Œç¯‡å¹…é™åˆ¶å°±ä¸å•°å—¦äº†.

--- 

``` c++
/***********************************************************************
* class_copyIvarList
* fixme
* Locking: read-locks runtimeLock
**********************************************************************/
Ivar *
class_copyIvarList(Class cls, unsigned int *outCount)
{
    const ivar_list_t *ivars;
    Ivar *result = nil;
    unsigned int count = 0;

    if (!cls) {
        if (outCount) *outCount = 0;
        return nil;
    }

    mutex_locker_t lock(runtimeLock);

    ASSERT(cls->isRealized());
    
    if ((ivars = cls->data()->ro->ivars)  &&  ivars->count) {
        result = (Ivar *)malloc((ivars->count+1) * sizeof(Ivar));
        
        for (auto& ivar : *ivars) {
            if (!ivar.offset) continue;  // anonymous bitfield
            result[count++] = &ivar;
        }
        result[count] = nil;
    }
    
    if (outCount) *outCount = count;
    return result;
}
```
è¿™é‡Œå°±ä¸€ä¸ªå…³é”®ç‚¹

``` c
ivars = cls->data()->ro->ivars
```
æ‹¿åˆ°ivars.

ç”±äºè¿™ä¸¤è€…æ‹¿åˆ°çš„æˆå‘˜ä¸ä¸€æ ·æ‰€ä»¥ä¸¤ä¸ªAPIå°±ä¼šæœ‰åŒºåˆ«.

#### `class_rw_t` å’Œ `class_ro_t` çš„åŒºåˆ«

å…ˆè¯´ç»“è®º: 

* ä¸¤ä¸ªç»“æ„ä½“éƒ½å­˜æ”¾ç€å½“å‰ç±»çš„å±æ€§ã€å®ä¾‹å˜é‡ã€æ–¹æ³•ã€åè®®ç­‰.
* `class_ro_t`å­˜æ”¾çš„æ˜¯ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„.
* è€Œ`class_rw_t`æ˜¯åœ¨runtimeæ—¶æ‰ç¡®å®šï¼Œå®ƒä¼šå…ˆå°†`class_ro_t`çš„å†…å®¹æ‹·è´è¿‡å»ï¼Œç„¶åå†å°†å½“å‰ç±»çš„åˆ†ç±»çš„è¿™äº›å±æ€§ã€æ–¹æ³•ç­‰æ‹·è´åˆ°å…¶ä¸­ã€‚æ‰€ä»¥å¯ä»¥è¯´`class_rw_t`æ˜¯`class_ro_t`çš„è¶…é›†ï¼Œå½“ç„¶å®é™…è®¿é—®ç±»çš„æ–¹æ³•ã€å±æ€§ç­‰ä¹Ÿéƒ½æ˜¯è®¿é—®çš„`class_rw_t`ä¸­çš„å†…å®¹.

___

##### ä¸‹é¢æˆ‘æ¥æ·±å…¥äº†è§£ä¸¤è€…å…·ä½“æ˜¯ä»€ä¹ˆ

é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£å®ƒä¿©çš„ç”±æ¥,åœ¨`objc_class`æˆ‘ä»¬çŸ¥é“æœ‰ä¸€ä¸ªæˆå‘˜å˜é‡å«`isa`,æˆ‘ä»¬è¿™é‡Œè¦ä»‹ç»çš„æ˜¯`objc_class`çš„å¦ä¸€æˆå‘˜å˜é‡`bits`.

`objc_class`çš„ç»“æ„å¦‚ä¸‹:

![objc_classçš„ç»“æ„](/assets/images/20200721iOSinterviewAnswers/objc_class_struct.webp)


`bits` ç”¨æ¥å­˜å‚¨ç±»çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ç­‰ä¿¡æ¯ã€‚å®ƒæ˜¯ä¸€ä¸ª`class_data_bits_t`ç±»å‹

`class_data_bits_t` å¦‚ä¸‹:

``` objc
struct class_data_bits_t {
    uintptr_t bits;
    // method here
}
```
è¿™ä¸ªç»“æ„ä½“åªæœ‰ä¸€ä¸ª`64bit`çš„æˆå‘˜å˜é‡`bits`ï¼Œå…ˆæ¥çœ‹çœ‹è¿™`64bit`åˆ†åˆ«å­˜æ”¾çš„ä»€ä¹ˆä¿¡æ¯ï¼š

![](/assets/images/20200721iOSinterviewAnswers/objc_class_bits.webp)

* `is_swift` : ç¬¬ä¸€ä¸ªbitï¼Œåˆ¤æ–­ç±»æ˜¯å¦æ˜¯Swiftç±»
* `has_default_rr` ï¼šç¬¬äºŒä¸ªbitï¼Œåˆ¤æ–­å½“å‰ç±»æˆ–è€…çˆ¶ç±»å«æœ‰é»˜è®¤çš„`retain/release/autorelease/retainCount/_tryRetain/_isDeallocating/retainWeakReference/allowsWeakReference` æ–¹æ³•
* `require_raw_isa` ï¼šç¬¬ä¸‰ä¸ªbitï¼Œ åˆ¤æ–­å½“å‰ç±»çš„å®ä¾‹æ˜¯å¦éœ€è¦`raw_isa`
* `data` : ç¬¬4-48ä½ï¼Œå­˜æ”¾ä¸€ä¸ªæŒ‡å‘class_rw_tç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†è¯¥ç±»çš„å±æ€§ï¼Œæ–¹æ³•ï¼Œåè®®ç­‰ä¿¡æ¯ã€‚è‡³äºä¸ºä½•åªç”¨44bitæ¥å­˜æ”¾åœ°å€

##### `class_rw_t` å’Œ` class_ro_t`

å…ˆæ¥çœ‹çœ‹ä¸¤ä¸ªç»“æ„ä½“çš„å†…éƒ¨æˆå‘˜å˜é‡

``` objc
struct class_rw_t {
    uint32_t flags;
    uint32_t version;

    const class_ro_t *ro;

    method_array_t methods;
    property_array_t properties;
    protocol_array_t protocols;

    Class firstSubclass;
    Class nextSiblingClass;
};
```

``` objc
struct class_ro_t {
    uint32_t flags;
    uint32_t instanceStart;
    uint32_t instanceSize;
    uint32_t reserved;

    const uint8_t * ivarLayout;

    const char * name;
    method_list_t * baseMethodList;
    protocol_list_t * baseProtocols;
    const ivar_list_t * ivars;

    const uint8_t * weakIvarLayout;
    property_list_t *baseProperties;
};
```

`class_rw_t`ç»“æ„ä½“å†…æœ‰ä¸€ä¸ªæŒ‡å‘`class_ro_t`ç»“æ„ä½“çš„æŒ‡é’ˆ.

æ¯ä¸ªç±»éƒ½å¯¹åº”æœ‰ä¸€ä¸ª`class_ro_t`ç»“æ„ä½“å’Œä¸€ä¸ª`class_rw_t`ç»“æ„ä½“ã€‚åœ¨ç¼–è¯‘æœŸé—´ï¼Œ`class_ro_t`ç»“æ„ä½“å°±å·²ç»ç¡®å®šï¼Œ`objc_class`ä¸­çš„`bits`çš„`data`éƒ¨åˆ†å­˜æ”¾ç€è¯¥ç»“æ„ä½“çš„åœ°å€ã€‚åœ¨`runtime`è¿è¡Œä¹‹åï¼Œå…·ä½“è¯´æ¥æ˜¯åœ¨è¿è¡Œ`runtime`çš„`realizeClass` æ–¹æ³•æ—¶ï¼Œä¼šç”Ÿæˆ`class_rw_t`ç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†`class_ro_t`ï¼Œå¹¶ä¸”æ›´æ–°`data`éƒ¨åˆ†ï¼Œæ¢æˆ`class_rw_t`ç»“æ„ä½“çš„åœ°å€ã€‚

ç”¨ä¸¤å¼ å›¾æ¥è¯´æ˜è¿™ä¸ªè¿‡ç¨‹ï¼š

ç±»çš„`realizeClass`è¿è¡Œä¹‹å‰ï¼š  
![](/assets/images/20200721iOSinterviewAnswers/before_bits.webp)

ç±»çš„`realizeClass`è¿è¡Œä¹‹åï¼š

![](/assets/images/20200721iOSinterviewAnswers/after_bits.webp)

ç»†çœ‹ä¸¤ä¸ªç»“æ„ä½“çš„æˆå‘˜å˜é‡ä¼šå‘ç°å¾ˆå¤šç›¸åŒçš„åœ°æ–¹ï¼Œä»–ä»¬éƒ½å­˜æ”¾ç€å½“å‰ç±»çš„å±æ€§ã€å®ä¾‹å˜é‡ã€æ–¹æ³•ã€åè®®ç­‰ç­‰ã€‚åŒºåˆ«åœ¨äºï¼š`class_ro_t`å­˜æ”¾çš„æ˜¯ç¼–è¯‘æœŸé—´å°±ç¡®å®šçš„ï¼›è€Œ`class_rw_t`æ˜¯åœ¨`runtime`æ—¶æ‰ç¡®å®šï¼Œå®ƒä¼šå…ˆå°†`class_ro_t`çš„å†…å®¹æ‹·è´è¿‡å»ï¼Œç„¶åå†å°†å½“å‰ç±»çš„åˆ†ç±»çš„è¿™äº›å±æ€§ã€æ–¹æ³•ç­‰æ‹·è´åˆ°å…¶ä¸­ã€‚æ‰€ä»¥å¯ä»¥è¯´`class_rw_t`æ˜¯`class_ro_t`çš„è¶…é›†ï¼Œå½“ç„¶å®é™…è®¿é—®ç±»çš„æ–¹æ³•ã€å±æ€§ç­‰ä¹Ÿéƒ½æ˜¯è®¿é—®çš„`class_rw_t`ä¸­çš„å†…å®¹

å±æ€§(property)å­˜æ”¾åœ¨`class_rw_t`ä¸­ï¼Œå®ä¾‹å˜é‡(ivar)å­˜æ”¾åœ¨`class_ro_t`ä¸­ã€‚

è¯¦ç»†å†…å®¹è¯· å‚è€ƒèµ„æ–™[Objective-C runtime - å±æ€§ä¸æ–¹æ³•](http://vanney9.com/2017/06/05/objective-c-runtime-property-method/)


#### categoryå¦‚ä½•è¢«åŠ è½½çš„,ä¸¤ä¸ªcategoryçš„loadæ–¹æ³•çš„åŠ è½½é¡ºåºï¼Œä¸¤ä¸ªcategoryçš„åŒåæ–¹æ³•çš„åŠ è½½é¡ºåº

ç»“è®º: 

1. category æ˜¯ è¿™æ · `realizeClass ` -> `methodizeClass()` -> `attachCategories()` ä¸€æ­¥æ­¥è¢«åŠ è½½çš„.
2. ä¸»ç±»ä¸åˆ†ç±»çš„åŠ è½½é¡ºåºæ˜¯:**ä¸»ç±»ä¼˜å…ˆäºåˆ†ç±»åŠ è½½,æ— å…³ç¼–è¯‘é¡ºåº**.
3. åˆ†ç±»é—´çš„åŠ è½½é¡ºåºå–å†³äºç¼–è¯‘çš„é¡ºåº:**ç¼–è¯‘åœ¨å‰åˆ™å…ˆåŠ è½½,ç¼–è¯‘åœ¨ååˆ™ååŠ è½½**.

---

##### categoryå¦‚ä½•è¢«åŠ è½½çš„

æˆ‘åœ¨è¿è¡Œæ—¶çš„æºç  `objc-runtime-new.mm`ä¸­æ‰¾åˆ°å¦‚ä¸‹:

```  objc
static Class realizeClassWithoutSwift(Class cls, Class previously)
{
	...
	// Attach categories  è¢«åŠ è½½
	methodizeClass(cls, previously);
	return cls;
}
```
`realizeClass ` -> `methodizeClass()` -> `attachCategories()`

æ ¸å¿ƒæ˜¯åœ¨methodizeClass()å‡½æ•°ä¸­å®ç°çš„.

``` c
static void methodizeClass(Class cls)
{
    runtimeLock.assertLocked();
    bool isMeta = cls->isMetaClass();
    auto rw = cls->data();
    auto ro = rw->ro;
    ...
    property_list_t *proplist = ro->baseProperties;
    if (proplist) {
        rw->properties.attachLists(&proplist, 1);
    }
    ...
    // Attach categories.
    category_list *cats = unattachedCategoriesForClass(cls, true /*realizing*/);
    attachCategories(cls, cats, false /*don't flush caches*/);
    ...    
    if (cats) free(cats);

}
```
é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å‘ç°`ro->baseProperties;` ,  baseProperties åœ¨å‰ï¼Œcategory åœ¨å,

``` objc
property_list_t *proplist = ro->baseProperties;
if (proplist) {
  rw->properties.attachLists(&proplist, 1);
}
```
ä½†å†³å®šé¡ºåºçš„æ˜¯ rw->`properties.attachLists ()`è¿™ä¸ªæ–¹æ³•.

``` c
/// category è¢«é™„åŠ è¿›å»
void attachLists(List* const * addedLists, uint32_t addedCount) {
    if (addedCount == 0) return;
    if (hasArray()) {
        // many lists -> many lists
        uint32_t oldCount = array()->count;
        uint32_t newCount = oldCount + addedCount;
        setArray((array_t *)realloc(array(), array_t::byteSize(newCount)));
        array()->count = newCount;
        // å°†æ—§å†…å®¹ç§»åŠ¨åç§»é‡ addedCount ç„¶åå°† addedLists copy åˆ°èµ·å§‹ä½ç½®
        /*
            struct array_t {
                    uint32_t count;
                    List* lists[0];
                    };
        */
        memmove(array()->lists + addedCount, array()->lists, 
                oldCount * sizeof(array()->lists[0]));
        memcpy(array()->lists, addedLists, 
               addedCount * sizeof(array()->lists[0]));
    }
    else if (!list  &&  addedCount == 1) {
        // 0 lists -> 1 list
        list = addedLists[0];
    } 
    else {
        // 1 list -> many lists
        List* oldList = list;
        uint32_t oldCount = oldList ? 1 : 0;
        uint32_t newCount = oldCount + addedCount;
        setArray((array_t *)malloc(array_t::byteSize(newCount)));
        array()->count = newCount;
        if (oldList) array()->lists[addedCount] = oldList;
        memcpy(array()->lists, addedLists, 
        addedCount * sizeof(array()->lists[0]));
    }
}
```
æ‰€ä»¥ category çš„å±æ€§æ€»æ˜¯åœ¨å‰é¢çš„ï¼ŒbaseClassçš„å±æ€§è¢«å¾€ååç§»äº†ã€‚

##### ä¸¤ä¸ªcategoryçš„loadæ–¹æ³•çš„åŠ è½½é¡ºåº

``` txt
A classâ€™s +load method is called after all of its superclassesâ€™ +load methods.
ä¸€ä¸ªç±»çš„+loadæ–¹æ³•åœ¨å…¶çˆ¶ç±»çš„+loadæ–¹æ³•åè°ƒç”¨

A category +load method is called after the classâ€™s own +load method.
ä¸€ä¸ªCategoryçš„+loadæ–¹æ³•åœ¨è¢«å…¶æ‰©å±•çš„ç±»çš„è‡ªæœ‰+loadæ–¹æ³•åè°ƒç”¨
```
ç»“è®º: ä¸»ç±»ä¸åˆ†ç±»çš„åŠ è½½é¡ºåºæ˜¯:**ä¸»ç±»ä¼˜å…ˆäºåˆ†ç±»åŠ è½½,æ— å…³ç¼–è¯‘é¡ºåº**.

#####  ä¸¤ä¸ªcategoryçš„åŒåæ–¹æ³•çš„åŠ è½½é¡ºåº

åº”ç”¨ç¨‹åº image é•œåƒåŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œ `Category` è§£æçš„è¿‡ç¨‹ï¼Œæ³¨æ„ä¸‹é¢çš„ `while(i--)` å¾ªç¯ è¿™é‡Œå€’åºå°† `category` ä¸­çš„åè®® æ–¹æ³• å±æ€§æ·»åŠ åˆ°äº†` rw = cls->data() `ä¸­çš„ `methods/properties/protocols`ä¸­ã€‚

``` objc
static void 
attachCategories(Class cls, category_list *cats, bool flush_caches)
{
    if (!cats) return;
    if (PrintReplacedMethods) printReplacements(cls, cats);

    bool isMeta = cls->isMetaClass();

    // fixme rearrange to remove these intermediate allocations
    method_list_t **mlists = (method_list_t **)
        malloc(cats->count * sizeof(*mlists));
    property_list_t **proplists = (property_list_t **)
        malloc(cats->count * sizeof(*proplists));
    protocol_list_t **protolists = (protocol_list_t **)
        malloc(cats->count * sizeof(*protolists));

    // Count backwards through cats to get newest categories first
    int mcount = 0;
    int propcount = 0;
    int protocount = 0;
    int i = cats->count;
    bool fromBundle = NO;
    while (i--) {
        auto& entry = cats->list[i];

        method_list_t *mlist = entry.cat->methodsForMeta(isMeta);
        if (mlist) {
            mlists[mcount++] = mlist;
            fromBundle |= entry.hi->isBundle();
        }

        property_list_t *proplist = 
            entry.cat->propertiesForMeta(isMeta, entry.hi);
        if (proplist) {
            proplists[propcount++] = proplist;
        }

        protocol_list_t *protolist = entry.cat->protocols;
        if (protolist) {
            protolists[protocount++] = protolist;
        }
    }
    auto rw = cls->data();
        
    // æ³¨æ„ä¸‹é¢çš„ä»£ç ï¼Œä¸Šé¢é‡‡ç”¨å€’å™éå†æ–¹å¼ï¼Œæ‰€ä»¥åç¼–è¯‘çš„ category ä¼šå…ˆaddåˆ°æ•°ç»„çš„å‰éƒ¨
    prepareMethodLists(cls, mlists, mcount, NO, fromBundle);
    rw->methods.attachLists(mlists, mcount);
    free(mlists);
    if (flush_caches  &&  mcount > 0) flushCaches(cls);

    rw->properties.attachLists(proplists, propcount);
    free(proplists);

    rw->protocols.attachLists(protolists, protocount);
    free(protolists);
}
```

æ‰€ä»¥ç»“è®ºæ˜¯:åˆ†ç±»é—´çš„åŠ è½½é¡ºåºå–å†³äºç¼–è¯‘çš„é¡ºåº:ç¼–è¯‘åœ¨å‰åˆ™å…ˆåŠ è½½,ç¼–è¯‘åœ¨ååˆ™ååŠ è½½

è¿™ä¸ªé—®é¢˜ç½‘ä¸Šæœ‰å¾ˆå¤šä¾‹å­ å°±ä¸å¤šåœ¨è¿™ä¸¾ä¾‹äº†.


#### `category` & `extension`åŒºåˆ«ï¼Œèƒ½ç»™NSObjectæ·»åŠ Extensionå—ï¼Œç»“æœå¦‚ä½•

#####  `category`

* è¿è¡Œæ—¶æ·»åŠ åˆ†ç±»å±æ€§/åè®®/æ–¹æ³•
* åˆ†ç±»æ·»åŠ çš„æ–¹æ³•ä¼šâ€œè¦†ç›–â€åŸç±»æ–¹æ³•ï¼Œå› ä¸ºæ–¹æ³•æŸ¥æ‰¾çš„è¯æ˜¯ä»å¤´è‡³å°¾ï¼Œä¸€æ—¦æŸ¥æ‰¾åˆ°äº†å°±åœæ­¢äº†
* åŒååˆ†ç±»æ–¹æ³•è°ç”Ÿæ•ˆå–å†³äºç¼–è¯‘é¡ºåºï¼Œimage è¯»å–çš„ä¿¡æ¯æ˜¯å€’å™çš„ï¼Œæ‰€ä»¥ç¼–è¯‘è¶Šé åçš„è¶Šå…ˆè¯»å…¥
* åå­—ç›¸åŒçš„åˆ†ç±»ä¼šå¼•èµ·ç¼–è¯‘æŠ¥é”™ï¼›

##### `extension`

* ç¼–è¯‘æ—¶å†³è®®
* åªä»¥å£°æ˜çš„å½¢å¼å­˜åœ¨ï¼Œå¤šæ•°æƒ…å†µä¸‹å°±å­˜åœ¨äº .m æ–‡ä»¶ä¸­ï¼›
* ä¸èƒ½ä¸ºç³»ç»Ÿç±»æ·»åŠ æ‰©å±•

å¯ä»¥ç»™ç±»æ·»åŠ æˆå‘˜å˜é‡ï¼Œä½†æ˜¯æ˜¯ç§æœ‰çš„ å¯ä»¥çµ¦ç±»æ·»åŠ æ–¹æ³•ï¼Œä½†æ˜¯æ˜¯ç§æœ‰çš„ æ·»åŠ çš„å±æ€§å’Œæ–¹æ³•æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨ç¼–è¯‘æœŸå°±å†³å®šçš„ã€‚åœ¨ç¼–è¯‘å™¨å’Œå¤´æ–‡ä»¶çš„@interfaceå’Œå®ç°æ–‡ä»¶é‡Œçš„@implementä¸€èµ·å½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„ç±»ã€‚ ä¼´éšç€ç±»çš„äº§ç”Ÿè€Œäº§ç”Ÿï¼Œä¹Ÿéšç€ç±»çš„æ¶ˆå¤±è€Œæ¶ˆå¤±

> **å¿…é¡»æœ‰ç±»çš„æºç æ‰å¯ä»¥ç»™ç±»æ·»åŠ extension**!!!

##### `category` & `extension`åŒºåˆ«

* Categoryçš„å°æ‹¬å·ä¸­æœ‰åå­—,è€ŒExtensionæ²¡æœ‰;
* Categoryåªèƒ½æ‰©å……æ–¹æ³•,ä¸èƒ½æ‰©å……æˆå‘˜å˜é‡å’Œå±æ€§;
* å¦‚æœCategoryå£°æ˜äº†å£°æ˜äº†ä¸€ä¸ªå±æ€§,é‚£ä¹ˆCategoryåªä¼šç”Ÿæˆè¿™ä¸ªå±æ€§çš„set,getæ–¹æ³•çš„å£°æ˜,ä¹Ÿå°±ä¸æ˜¯ä¼šå®ç°.æ‰€ä»¥å¯¹äºç³»ç»Ÿä¸€äº›ç±»ï¼Œå¦‚nsstringï¼Œå°±æ— æ³•æ·»åŠ ç±»æ‰©å±• ä¸èƒ½ç»™NSObjectæ·»åŠ Extensionï¼Œå› ä¸ºåœ¨extensionä¸­æ·»åŠ çš„æ–¹æ³•æˆ–å±æ€§å¿…é¡»åœ¨æºç±»çš„æ–‡ä»¶çš„.mæ–‡ä»¶ä¸­å®ç°æ‰å¯ä»¥ï¼Œå³ï¼šä½ å¿…é¡»æœ‰ä¸€ä¸ªç±»çš„æºç æ‰èƒ½æ·»åŠ ä¸€ä¸ªç±»çš„`extension`

##### èƒ½ç»™NSObjectæ·»åŠ Extensionå—ï¼Œç»“æœå¦‚ä½•?

ä¸èƒ½ å› ä¸ºæ²¡æœ‰NSObjectçš„.mæºç æ–‡ä»¶.

> å¦‚æœèƒ½çš„è¯é‚£åº”è¯¥ä¸å«Extension.æˆ–è€…æˆ‘ä»¬è‡ªå·±é€šè¿‡è¿è¡Œæ—¶çš„apiè‡ªå·±é€ ä¸€å¥—ExtensionDIY.ç»“æœå°±æ˜¯ä½ ç”¨çš„æ ¹æœ¬ä¸èƒ½ç§°ä¸º`Extension`,è€Œæ˜¯apiè°ƒç”¨è€Œå·². 

#### æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œæ¶ˆæ¯è½¬å‘æœºåˆ¶å’Œå…¶ä»–è¯­è¨€çš„æ¶ˆæ¯æœºåˆ¶ä¼˜åŠ£å¯¹æ¯”

 > å‰è¨€: äº†è§£æ¶ˆæ¯è½¬å‘ä¹‹å‰æˆ‘ä»¬æœ‰å¿…è¦äº†è§£ä¸€äº›Objectivce-Cä¸­çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶

##### æ¶ˆæ¯ä¼ é€’æœºåˆ¶

åœ¨Objectivce-Cä¸­,æˆ‘ä»¬é€šè¿‡`å®ä¾‹å˜é‡(å¯¹è±¡)`æˆ–è€…`ç±»æ–¹æ³•å`è°ƒç”¨ä¸€ä¸ªæ–¹æ³•,é‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨å‘é€ä¸€æ¡æ¶ˆæ¯

``` objc
id returnValue = [someObject messageName:parameter];  //å®ä¾‹è°ƒç”¨æ–¹å¼
id returnValue = [ClassA messageName:parameter];  //ç±»è°ƒç”¨æ–¹å¼
```
ä¸Šè¿°`someObject`å’Œ`ClassA`æ˜¯æ¥å—è€…(receiver)ï¼Œ`messageName:`æ˜¯é€‰æ‹©å™¨(`selector`),é€‰æ‹©å™¨å’Œå‚æ•°åˆèµ·æ¥ç§°ä¸ºæ¶ˆæ¯(`message`)ã€‚ç¼–è¯‘å™¨çœ‹åˆ°æ­¤æ¶ˆæ¯åï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€æ¡æ ‡å‡†çš„cè¯­è¨€å‡½æ•°è°ƒç”¨ï¼Œæ‰€è°ƒç”¨çš„å‡½æ•°ä¹ƒæ˜¯æ¶ˆæ¯ä¼ é€’æœºåˆ¶ä¸­çš„æ ¸å¿ƒå‡½æ•°ï¼š`objc_msgSend()`ã€‚

``` c
void objc_msgSend(id self, SEL cmd, ...)
```
ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨æ¥å—è€…ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨é€‰æ‹©å­ï¼Œåç»­å‚æ•°å°±æ˜¯æ¶ˆæ¯ä¸­çš„é‚£äº›å‚æ•°
ç¼–è¯‘å™¨ä¼šæŠŠåˆšæ‰çš„é‚£ä¸ªä¾‹å­ä¸­çš„æ¶ˆæ¯è½¬æ¢ä¸ºå¦‚ä¸‹å‡½æ•°ï¼š

``` objc
id returnValue = objc_msgSend(someObject, @selector(messageName:),parameter);
id returnValue = objc_msgSend(ClassA, @selector(messageName:),parameter);
```
`objc_msgSend()`å‡½æ•°ä¼šä¾æ®æ¥å—è€…ä¸é€‰æ‹©å™¨çš„ç±»å‹æ¥è°ƒç”¨é€‚å½“çš„æ–¹æ³•.ä¸ºæ¥å®Œæˆæ­¤æ“ä½œï¼Œè¯¥æ–¹æ³•éœ€è¦åœ¨æ¥å—è€…æ‰€å±çš„ç±»ä¸­æœå¯»å…¶â€œæ–¹æ³•åˆ—è¡¨â€(ä¹Ÿå°±æ˜¯ä¸Šæ–‡æˆ‘ä»¬è¯´çš„`class_ro_t`ä¸­çš„method_list)ã€‚æ‰¾åˆ°åˆ™è·³åˆ°ç°å®ä»£ç ï¼Œå¦åˆ™ï¼Œå°±æ²¿ç€ç»§æ‰¿ä½“ç³»ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœè¿˜æ²¡æœ‰åˆ™æ‰§è¡Œæ¶ˆæ¯è½¬å‘æ“ä½œã€‚å¯¹äºå…¶ä»–çš„â€œè¾¹ç•Œæƒ…å†µâ€ï¼Œåˆ™éœ€è¦äº¤ç”±Objective-cè¿è¡Œç¯å¢ƒçš„å¦ä¸€äº›å‡½æ•°æ¥å¤„ç†ï¼š

``` c
objc_msgSend_stret  //å¾…å‘é€çš„æ¶ˆæ¯è¿”å›ç»“æ„ä½“æ—¶
objc_msgSend_fpret  //æ¶ˆæ¯è¿”å›çš„æ˜¯æµ®ç‚¹å‹
objc_msgSendSuper   //å¦‚æœè¦ç»™è¶…ç±»å‘é€æ¶ˆæ¯
```

##### æ¶ˆæ¯è½¬å‘æœºåˆ¶

ç»“åˆä¸Šè¾¹çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶,åœ¨Objective-Cä¸­å¦‚æœç»™ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡å®ƒæ— æ³•å¤„ç†çš„æ¶ˆæ¯ï¼Œå°±ä¼šè¿›å…¥ä¸‹å›¾æè¿°çš„æ¶ˆæ¯è½¬å‘(Message Forwarding)æµç¨‹

![](/assets/images/20200721iOSinterviewAnswers/methodforward.webp)

åœ¨objcä¸­æ¶ˆæ¯è½¬å‘éœ€è¦ç»å†3ä¸ªé˜¶æ®µ  `resolveInstanceMethod` -> `forwardingTargetForSelectoer` -> `forwardInvocation` ->`æ¶ˆæ¯æœªèƒ½å¤„ç†`ã€‚  

* ç¬¬ä¸€é˜¶æ®µ:**åŠ¨æ€æ–¹æ³•è§£æ(Dynamic Method Resolution)**ä¹Ÿå°±æ˜¯åœ¨æ‰€å±çš„ç±»ä¸­å…ˆå¾è¯¢æ¥å—è€…,çœ‹å…¶æ˜¯å¦èƒ½åŠ¨æ€åŠ æ–¹æ³•ï¼Œæ¥å¤„ç†å½“å‰è¿™ä¸ª**æœªçŸ¥é€‰æ‹©å™¨**
* ç¬¬äºŒé˜¶æ®µ:**æ›¿æ¢æ¶ˆæ¯æ¥æ”¶è€…å¿«é€Ÿè½¬å‘**
* ç¬¬ä¸‰é˜¶æ®µ:**å®Œå…¨æ¶ˆæ¯è½¬å‘æœºåˆ¶**


##### ç¬¬ä¸€é˜¶æ®µ:**åŠ¨æ€æ–¹æ³•è§£æ(Dynamic Method Resolution)**

å¯¹è±¡åœ¨å—åˆ°æ— æ³•è§£è¯»çš„æ¶ˆæ¯åï¼Œé¦–å…ˆå°†è°ƒç”¨å…¶æ‰€å±ç±»çš„ä¸‹åˆ—ç±»æ–¹æ³•:  

``` objc
+ (BOOL)resolveClassMethod:(SEL)sel OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);
+ (BOOL)resolveInstanceMethod:(SEL)sel OBJC_AVAILABLE(10.5, 2.0, 9.0, 1.0, 2.0);
```
> è¿™ä¿©æ–¹æ³•åœ¨NSObject.hä¸­    

è¿”å›ä¸€ä¸ª`Boolean`ç±»å‹ï¼Œè¡¨ç¤ºè¿™ä¸ªç±»æ˜¯å¦èƒ½æ–°å¢ä¸€ä¸ªå®ä¾‹æ–¹æ³•ä»¥å¤„ç†é€‰æ‹©å™¨.

åœ¨ æ¶ˆæ¯è½¬å‘è¿‡ç¨‹ä¸­,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`resolveInstanceMethod:`åŠ¨æ€çš„å°†ä¸€ä¸ªæ–¹æ³•æ·»åŠ åˆ°ä¸€ä¸ªç±»ä¸­.

ä¾‹ä¸‹é¢ç¤ºä¾‹ä»£ç :

``` objc
@implementation MyClass
+ (BOOL)resolveInstanceMethod:(SEL)aSEL
{
    if (aSEL == @selector(resolveThisMethodDynamically)) {
          class_addMethod([self class], aSEL, (IMP) dynamicMethodIMP, "v@:");
          return YES;
    }
    return [super resolveInstanceMethod:aSEL];
}
@end
```

è¿™é‡Œæˆ‘ä»¬ç”¨åˆ°ä¸€ä¸ªè¿è¡Œæ—¶å‡½æ•°`class_addMethod()`.

``` c
BOOL 
class_addMethod(Class cls, SEL name, IMP imp, const char *types)
{
    if (!cls) return NO;

    mutex_locker_t lock(runtimeLock);
    return ! addMethod(cls, name, imp, types ?: "", NO);
}
```

*  `class_addMethod()`æœ€åä¸€ä¸ªå‚æ•°å«åš`types`ï¼Œæ˜¯ä¸€ä¸ªæè¿°æ–¹æ³•çš„å‚æ•°ç±»å‹çš„å­—ç¬¦ä¸².
* `v`ä»£è¡¨`void`
* `@`ä»£è¡¨å¯¹è±¡æˆ–è€…è¯´`idç±»å‹`
* `:`(è¿™ä¸ªå†’å·)ä»£è¡¨æ–¹æ³•é€‰æ‹©å™¨SEL

å…·ä½“ä»£è¡¨ä»€ä¹ˆä¸æ˜¯æˆ‘ä»¬çå†™çš„,å¾—æŒ‰ç…§è‹¹æœçš„è¿™ä¸ªæ ‡å‡† [Objective-C Runtime Programming Guide->Type Encodings](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1)

ä¸Šé¢çš„`dynamicMethodIMP`ï¼Œè¿”å›å€¼æ˜¯`void`ï¼Œä¸¤ä¸ªå…¥å‚åˆ†åˆ«æ˜¯`id`å’Œ`SEL`ï¼Œæ‰€ä»¥æè¿°è¿™ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹çš„å­—ç¬¦ä¸²å°±æ˜¯`v@:`

è¿™ä¸ªé˜¶æ®µçš„æ„ä¹‰æ˜¯ä¸ºä¸€ä¸ªç±»åŠ¨æ€æä¾›æ–¹æ³•å®ç°,ä¸¥æ ¼æ¥è¯´ï¼Œè¿˜æ²¡è¿›å…¥æ¶ˆæ¯è½¬å‘æµç¨‹ã€‚

`resolveInstanceMethod:` æ§åˆ¶è¿™ä¸‹é¢ä¸¤ä¸ªæ–¹æ³•æ˜¯å¦ä¼šè¢«è°ƒç”¨

* `respondsToSelector:`  
* `instancesRespondToSelector:`  

> ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ`resolveInstanceMethod:`è¿”å›äº†`YES`ï¼Œé‚£ä¹ˆ`respondsToSelector:`å’Œ`instancesRespondToSelector:`éƒ½ä¼šè¿”å›`YES`.

##### ç¬¬äºŒé˜¶æ®µï¼šæ›¿æ¢æ¶ˆæ¯æ¥æ”¶è€…(å¿«é€Ÿè½¬å‘)

å¦‚æœç¬¬ä¸€é˜¶æ®µä¸­`resolveInstanceMethod:`è¿”å›NO,å°±ä¼šè°ƒç”¨`forwardingTargetForSelector:`è¯¢é—®æ˜¯å¦æŠŠæ¶ˆæ¯è½¬å‘ç»™å¦ä¸€ä¸ªå¯¹è±¡.æ¶ˆæ¯çš„æ¥æ”¶è€…å°±æ”¹å˜äº†ã€‚

``` objc
- (id)forwardingTargetForSelector:(SEL)aSelector {
    return someOtherObject;
}
```

##### ç¬¬ä¸‰é˜¶æ®µï¼šå®Œå…¨æ¶ˆæ¯è½¬å‘æœºåˆ¶

å¦‚æœç¬¬äºŒé˜¶æ®µçš„`forwardingTargetForSelector:`è¿”å›äº†`nil`ï¼Œè¿™å°±è¿›å…¥äº†æ‰€è°“å®Œå…¨æ¶ˆæ¯è½¬å‘çš„æœºåˆ¶ã€‚

é¦–å…ˆè°ƒç”¨`methodSignatureForSelector:`ä¸ºè¦è½¬å‘çš„æ¶ˆæ¯è¿”å›æ­£ç¡®çš„ç­¾åï¼š

``` objc
- (void)forwardInvocation:(NSInvocation *)anInvocation {
    NSLog(@"forwardInvocation");
    SomeOtherObject *someOtherObject = [SomeOtherObject new];
    if ([someOtherObject respondsToSelector:[anInvocation selector]]) {
        [anInvocation invokeWithTarget:someOtherObject];
    } else {
        [super forwardInvocation:anInvocation];
    }
}
```

ä¸Šé¢ä»£ç æ˜¯å°†æ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡ï¼Œå…¶å®è¿™ä¸ç¬¬äºŒé˜¶æ®µä¸­ç¤ºä¾‹ä»£ç åšçš„äº‹æƒ…æ˜¯ä¸€æ ·çš„ã€‚åŒºåˆ«å°±åœ¨äºè¿™ä¸ªé˜¶æ®µä¼šæœ‰ä¸€ä¸ª`NSInvocation`å¯¹è±¡ã€‚[`NSInvocation`](https://developer.apple.com/documentation/foundation/nsinvocation?language=objc)æ˜¯ä¸€ä¸ªç”¨æ¥å­˜å‚¨å’Œè½¬å‘æ¶ˆæ¯çš„å¯¹è±¡ã€‚å®ƒåŒ…å«äº†ä¸€ä¸ªObjective-Cæ¶ˆæ¯çš„æ‰€æœ‰å…ƒç´ ï¼šä¸€ä¸ªtargetï¼Œä¸€ä¸ªselectorï¼Œå‚æ•°å’Œè¿”å›å€¼ã€‚æ¯ä¸ªå…ƒç´ éƒ½å¯ä»¥è¢«ç›´æ¥è®¾ç½®ã€‚

> `NSInvocation`å¯ä»¥ç®€å•ç†è§£ä¸ºä¸€ä¸ªå¯¹è±¡æŠŠæˆ‘ä»¬ç”¨åˆ° selectoræ–¹æ³•å’Œå¯¹è±¡éƒ½å­˜å‚¨äº†ä¸€ä¸‹,ç„¶åå“ªä¸ªæ˜¯æŒ‡å‘æˆ‘ä»¬éœ€è¦è°ƒç”¨çš„æŒ‡é’ˆå¯¹è±¡.

æ‰€ä»¥ä¸åŒä¸ç¬¬äºŒé˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä½ å¯ä»¥ï¼š

* æŠŠæ¶ˆæ¯å­˜å‚¨ï¼Œåœ¨ä½ è§‰å¾—åˆé€‚çš„æ—¶æœºè½¬å‘å‡ºå»ï¼Œæˆ–è€…ä¸å¤„ç†è¿™ä¸ªæ¶ˆæ¯ã€‚
* ä¿®æ”¹æ¶ˆæ¯çš„targetï¼Œselectorï¼Œå‚æ•°ç­‰
* å¤šæ¬¡è½¬å‘è¿™ä¸ªæ¶ˆæ¯ï¼Œè½¬å‘ç»™å¤šä¸ªå¯¹è±¡

æ˜¾ç„¶åœ¨è¿™ä¸ªé˜¶æ®µï¼Œä½ å¯ä»¥å¯¹ä¸€ä¸ªOCæ¶ˆæ¯åšæ›´å¤šçš„äº‹æƒ…

---

##### æ¶ˆæ¯è½¬å‘æœºåˆ¶å’Œå…¶ä»–è¯­è¨€çš„æ¶ˆæ¯æœºåˆ¶ä¼˜åŠ£å¯¹æ¯”

è¿™ä¸ªç›®å‰æ²¡æœ‰æ·±å…¥å…¶å®ƒç¼–ç¨‹è¯­è¨€çš„è¿è¡Œæ—¶å±‚é¢,æ¯”å¦‚Cçš„åº•å±‚æˆ–è€…C++çš„åº•å±‚æˆ–è€…Javaçš„åº•å±‚æ¶ˆæ¯ä¼ é€’è¿™é‡Œæä¾› [ä¸€ä¸ªandroidçš„ç±»ä¼¼æ¶ˆæ¯è½¬å‘çš„æ–‡ç« ](æ¢ç´¢ Android App Bundle)


#### åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œæ–¹æ³•æŸ¥è¯¢-> åŠ¨æ€è§£æ-> æ¶ˆæ¯è½¬å‘ ä¹‹å‰åšäº†ä»€ä¹ˆ

Objective-C å®ä¾‹å¯¹è±¡æ‰§è¡Œæ–¹æ³•æ­¥éª¤

1. è·å– receiver å¯¹åº”çš„ç±» Class
2. åœ¨ Class ç¼“å­˜åˆ—è¡¨ä¸­(å°±æ˜¯`objc_class`é‡Œçš„`cache_t`åˆ°`class_ro_t`çš„æ–¹æ³•list)æ ¹æ®é€‰æ‹©å­`selector`æŸ¥æ‰¾`IMP`
3. è‹¥ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™åœ¨æ–¹æ³•åˆ—è¡¨ä¸­ç»§ç»­æŸ¥æ‰¾.
4. è‹¥æ–¹æ³•åˆ—è¡¨æ²¡æœ‰ï¼Œåˆ™ä»çˆ¶ç±»æŸ¥æ‰¾ï¼Œé‡å¤ä»¥ä¸Šæ­¥éª¤.
5. è‹¥æœ€ç»ˆæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿›è¡Œæ¶ˆæ¯è½¬å‘æ“ä½œ.

* æ–¹æ³•æŸ¥è¯¢ä¹‹å‰ è¦çŸ¥é“  receiverå’Œ selector.ä¸»è¦æ˜¯è¦æ˜ç¡®æˆ‘ä»¬æ˜¯å“ªä¸ªå®ä¾‹è°ƒç”¨äº†å“ªä¸ªæ–¹æ³•.  
* åŠ¨æ€è§£æè§£æä¹‹å‰è¦ åœ¨æ‰€å±çš„ç±»ä¸­å…ˆå¾è¯¢æ¥å—è€…,çœ‹å…¶æ˜¯å¦èƒ½åŠ¨æ€åŠ æ–¹æ³•ï¼Œæ¥å¤„ç†å½“å‰è¿™ä¸ªæœªçŸ¥é€‰æ‹©å™¨.
* æ¶ˆæ¯è½¬å‘ ä¹‹å‰ è¦è¯¢é—®æ˜¯å¦æŠŠæ¶ˆæ¯è½¬å‘ç»™å¦ä¸€ä¸ªå¯¹è±¡. 

> å¦‚æœæ›´æ·±å…¥çš„è€Œç†è§£ é‚£åº”è¯¥æ˜¯ objc_msgSend() ä¸ºå•¥æ˜¯æ±‡ç¼–å®ç°çš„,ä¸Šé¢çš„é‚£äº›æ–¹æ³• è°ƒç”¨ä¹‹å‰ æ±‡ç¼–çš„å“ªäº›æŒ‡ä»¤è¢«æ‰§è¡Œ

è¿™é‡Œæ‰¾åˆ°ä¸¤ç¯‡æ–‡ç« å¯ä»¥å‚è€ƒä¸€ä¸‹  
[æ·±å…¥äº†è§£Objective-Cæ¶ˆæ¯å‘é€ä¸è½¬å‘è¿‡ç¨‹](https://chipengliu.github.io/2019/06/02/objc-msgSend-forward/)   
[æ±‡ç¼–è¯­è¨€ç¼–å†™çš„ï¼Œå…¶ä¸­å…·ä½“è¿‡ç¨‹ç»†èŠ‚](https://chipengliu.github.io/2019/04/07/objc-msg-armd64/)

#### `IMP`ã€`SEL`ã€`Method`çš„åŒºåˆ«å’Œä½¿ç”¨åœºæ™¯

* `IMP` : æ˜¯æ–¹æ³•çš„å…·ä½“å®ç°(æŒ‡é’ˆ)
* `SEL` :æ–¹æ³•åç§°
* `Method `:æ˜¯objc_methodç±»å‹æŒ‡é’ˆï¼Œå®ƒæ˜¯ä¸€ä¸ªç»“æ„ä½“ ,å¦‚ä¸‹:

	``` objc
	struct objc_method {
	    SEL _Nonnull method_name                                 OBJC2_UNAVAILABLE;
	    char * _Nullable method_types                            OBJC2_UNAVAILABLE;
	    IMP _Nonnull method_imp                                  OBJC2_UNAVAILABLE;
	}
	```  

ä½¿ç”¨åœºæ™¯

* ä¾‹å¦‚ Buttonæ·»åŠ Targetå’ŒSelectorçš„æ—¶å€™.æˆ–è€… å®ç°ç±»çš„`swizzle`çš„æ—¶å€™ä¼šç”¨åˆ°ï¼Œé€šè¿‡`class_getInstanceMethod(class, SEL)`æ¥è·å–ç±»çš„æ–¹æ³•`Method`ï¼Œå…¶ä¸­ç”¨åˆ°äº†SELä½œä¸ºæ–¹æ³•å

* ä¾‹å¦‚ ç»™ç±»åŠ¨æ€æ·»åŠ æ–¹æ³•ï¼Œæ­¤æ—¶æˆ‘ä»¬éœ€è¦è°ƒç”¨class_addMethod(Class, SEL, IMP, types)ï¼Œè¯¥æ–¹æ³•éœ€è¦æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªæ–¹æ³•çš„å®ç°å‡½æ•°IMPï¼Œä¾‹å¦‚:

``` objc
static void funcName(id receiver, SEL cmd, æ–¹æ³•å‚æ•°...) {
   // æ–¹æ³•å…·ä½“çš„å®ç°   
}
```

> SELç›¸å½“äº æ–¹æ³•çš„ç±»å‹ å…³é”®å­—.

#### `load`ã€`initialize`æ–¹æ³•çš„åŒºåˆ«ä»€ä¹ˆï¼Ÿåœ¨ç»§æ‰¿å…³ç³»ä¸­ä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«

åœ¨Objective-Cçš„ç±»è¢«åŠ è½½å’Œåˆå§‹åŒ–çš„æ—¶å€™, ç±» æ˜¯ å¯ä»¥æ”¶åˆ° æ–¹æ³•å›è°ƒçš„.

``` objc
- (void)load;
- (void)initialize;
```

#####  `+load`

`+ load`æ–¹æ³•æ˜¯åœ¨è¿™ä¸ªæ–‡ä»¶(å°±æ˜¯ä½ å¤å†™çš„å­ç±»åŒ–çš„class)è¢«ç¨‹åºè£…è½½æ—¶è°ƒç”¨,åªè¦æ˜¯åœ¨Xcode `Compile Sources`ä¸­å‡ºç°çš„æ–‡ä»¶æ€»æ˜¯ä¼šè¢«è£…è½½ï¼Œè¿™ä¸è¿™ä¸ªç±»æ˜¯å¦è¢«ç”¨åˆ°æ— å…³ï¼Œå› æ­¤+loadæ–¹æ³•æ€»æ˜¯åœ¨`main()`å‡½æ•°ä¹‹å‰è°ƒç”¨.

è°ƒç”¨æ—¶æœºæ¯”è¾ƒæ—©ï¼Œè¿è¡Œç¯å¢ƒæœ‰ä¸ç¡®å®šå› ç´ ã€‚å…·ä½“è¯´æ¥ï¼Œåœ¨iOSä¸Šé€šå¸¸å°±æ˜¯Appå¯åŠ¨æ—¶è¿›è¡ŒåŠ è½½ï¼Œä½†å½“loadè°ƒç”¨çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½ä¿è¯æ‰€æœ‰ç±»éƒ½åŠ è½½å®Œæˆä¸”å¯ç”¨ï¼Œå¿…è¦æ—¶è¿˜è¦è‡ªå·±è´Ÿè´£åšauto releaseå¤„ç†ã€‚

> è¡¥å……ä¸Šé¢ä¸€ç‚¹ï¼Œå¯¹äºæœ‰ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªåº“ä¸­ï¼Œè¢«ä¾èµ–çš„ç±»çš„+loadä¼šä¼˜å…ˆè°ƒç”¨ã€‚ä½†åœ¨ä¸€ä¸ªåº“ä¹‹å†…ï¼Œçˆ¶ã€å­ç±»ã€ç±»åˆ«ä¹‹é—´è°ƒç”¨æœ‰é¡ºåºï¼Œä¸åŒç±»ä¹‹é—´è°ƒç”¨é¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚

* å…³äºç»§æ‰¿ï¼šå¯¹äºä¸€ä¸ªç±»è€Œè¨€ï¼Œæ²¡æœ‰+loadæ–¹æ³•å®ç°å°±ä¸ä¼šè°ƒç”¨ï¼Œä¸ä¼šè€ƒè™‘å¯¹NSObjectçš„ç»§æ‰¿ï¼Œå°±æ˜¯ä¸ä¼šæ²¿ç”¨çˆ¶ç±»çš„+loadã€‚
* çˆ¶ç±»å’Œæœ¬ç±»çš„è°ƒç”¨ï¼šçˆ¶ç±»çš„æ–¹æ³•ä¼˜å…ˆäºå­ç±»çš„æ–¹æ³•ã€‚ä¸€ä¸ªç±»çš„+loadæ–¹æ³•ä¸ç”¨å†™æ˜`[super load]`ï¼Œçˆ¶ç±»å°±ä¼šæ”¶åˆ°è°ƒç”¨ã€‚
* æœ¬ç±»å’ŒCategoryçš„è°ƒç”¨ï¼šæœ¬ç±»çš„æ–¹æ³•ä¼˜å…ˆäºç±»åˆ«(Category)ä¸­çš„æ–¹æ³•ã€‚Categoryçš„+loadä¹Ÿä¼šæ”¶åˆ°è°ƒç”¨ï¼Œä½†é¡ºåºä¸Šåœ¨æœ¬ç±»çš„+loadè°ƒç”¨ä¹‹åã€‚
* ä¸ä¼šç›´æ¥è§¦å‘initializeçš„è°ƒç”¨ã€‚

#### `+initialize`

`+initialize`æ–¹æ³•æ˜¯åœ¨ç±»æˆ–å®ƒçš„å­ç±»æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹å‰è¢«è°ƒç”¨çš„ï¼Œè¿™é‡Œæ‰€æŒ‡çš„æ¶ˆæ¯åŒ…æ‹¬å®ä¾‹æ–¹æ³•å’Œç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶ä¸”åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚`initialize`æ–¹æ³•å®é™…ä¸Šæ˜¯ä¸€ç§æƒ°æ€§(lazy load)è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ä¸ªç±»ä¸€ç›´æ²¡è¢«ç”¨åˆ°ï¼Œé‚£å®ƒçš„initializeæ–¹æ³•ä¹Ÿä¸ä¼šè¢«è°ƒç”¨ï¼Œè¿™ä¸€ç‚¹æœ‰åˆ©äºèŠ‚çº¦èµ„æº.

runtime ä½¿ç”¨äº†å‘é€æ¶ˆæ¯ `objc_msgSend` çš„æ–¹å¼å¯¹ `+initialize` æ–¹æ³•è¿›è¡Œè°ƒç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ `+initialize` æ–¹æ³•çš„è°ƒç”¨ä¸æ™®é€šæ–¹æ³•çš„è°ƒç”¨æ˜¯ä¸€æ ·çš„ï¼Œèµ°çš„éƒ½æ˜¯`å‘é€æ¶ˆæ¯çš„æµç¨‹`ã€‚æ¢è¨€ä¹‹ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç° +initialize æ–¹æ³•ï¼Œé‚£ä¹ˆç»§æ‰¿è‡ªçˆ¶ç±»çš„å®ç°ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœä¸€ä¸ªç±»çš„åˆ†ç±»å®ç°äº† `+initialize` æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹è¿™ä¸ªç±»ä¸­çš„å®ç°é€ æˆè¦†ç›–(override)ã€‚

* initializeçš„è‡ªç„¶è°ƒç”¨æ˜¯åœ¨ç¬¬ä¸€æ¬¡ä¸»åŠ¨ä½¿ç”¨å½“å‰ç±»çš„æ—¶å€™ã€‚
* åœ¨initializeæ–¹æ³•æ”¶åˆ°è°ƒç”¨æ—¶ï¼Œè¿è¡Œç¯å¢ƒåŸºæœ¬å¥å…¨ã€‚
* å…³äºç»§æ‰¿ï¼šå’Œloadä¸åŒï¼Œå³ä½¿å­ç±»ä¸å®ç°initializeæ–¹æ³•ï¼Œä¼šæŠŠçˆ¶ç±»çš„å®ç°ç»§æ‰¿è¿‡æ¥è°ƒç”¨ä¸€éï¼Œå°±æ˜¯ä¼šæ²¿ç”¨çˆ¶ç±»çš„+initializeã€‚ï¼ˆæ²¿ç”¨çˆ¶ç±»çš„æ–¹æ³•ä¸­ï¼Œselfè¿˜æ˜¯æŒ‡å­ç±»ï¼‰
* çˆ¶ç±»å’Œæœ¬ç±»çš„è°ƒç”¨ï¼šå­ç±»çš„+initializeå°†è¦è°ƒç”¨æ—¶ä¼šæ¿€å‘çˆ¶ç±»è°ƒç”¨çš„+initializeæ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦åœ¨å­ç±»å†™æ˜[super initialize]ã€‚(æœ¬ç€é™¤ä¸»åŠ¨è°ƒç”¨å¤–ï¼Œåªä¼šè°ƒç”¨ä¸€æ¬¡çš„åŸåˆ™ï¼Œå¦‚æœçˆ¶ç±»çš„+initializeæ–¹æ³•è°ƒç”¨è¿‡äº†ï¼Œåˆ™ä¸ä¼šå†è°ƒç”¨)
* æœ¬ç±»å’ŒCategoryçš„è°ƒç”¨ï¼šCategoryä¸­çš„+initializeæ–¹æ³•ä¼šè¦†ç›–æœ¬ç±»çš„æ–¹æ³•ï¼Œåªæ‰§è¡Œä¸€ä¸ªCategoryçš„+initializeæ–¹æ³•ã€‚

ä¸‹é¢æ˜¯æˆ‘æ•´ç†çš„ä¸€ä¸ªè¡¨æ ¼å¸Œæœ›å¯¹è§£é‡Šè¿™ä¿©æ–¹æ³•æœ‰å¸®åŠ©:

| | + load |  + initialize | 
| ------| ------ | ------ |
| è°ƒç”¨æ–¹å¼ | ç›´æ¥ä½¿ç”¨å‡½æ•°å†…å­˜åœ°å€  | objc_msgSend()æ–¹å¼  |
| è°ƒç”¨æ—¶æœº | è¢«ç¨‹åºè£…è½½æ—¶è°ƒç”¨main()å‡½æ•°ä¹‹å‰,å°±æ˜¯è¢«æ·»åŠ åˆ°runtimeæ—¶ | åœ¨æœ¬ç±»æˆ–å®ƒçš„å­ç±»æ”¶åˆ°ç¬¬ä¸€æ¡æ¶ˆæ¯ä¹‹å‰è¢«è°ƒç”¨ |
| æ˜¯å¦è¢«ç³»ç»Ÿå•æ¬¡è°ƒç”¨(é™¤ä¸»åŠ¨è°ƒç”¨å¤–) | æ˜¯ | æ˜¯ |
| è¿è¡Œæ—¶ç¯å¢ƒæ˜¯å¦ç¨³å®š| ä¸ç¡®å®š | ç¨³å®š |
| çº¿ç¨‹æ˜¯å¦å®‰å…¨ | é»˜è®¤æ˜¯å®‰å…¨çš„(å·²åŠ é”) | å®‰å…¨(å·²åŠ é” ) |
| ç‰¹æ€§ | ç”±äºé`objc_msgSend()`æ–¹å¼è°ƒç”¨å°±ä½¿å¾— +load æ–¹æ³•æ‹¥æœ‰äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç‰¹æ€§ï¼Œé‚£å°±æ˜¯å­ç±»ã€çˆ¶ç±»å’Œåˆ†ç±»ä¸­çš„ +load æ–¹æ³•çš„å®ç°æ˜¯è¢«åŒºåˆ«å¯¹å¾…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœå­ç±»æ²¡æœ‰å®ç° +load æ–¹æ³•ï¼Œé‚£ä¹ˆå½“å®ƒè¢«åŠ è½½æ—¶ runtime æ˜¯ä¸ä¼šå»è°ƒç”¨çˆ¶ç±»çš„ +load æ–¹æ³•çš„ã€‚åŒç†ï¼Œå½“ä¸€ä¸ªç±»å’Œå®ƒçš„åˆ†ç±»éƒ½å®ç°äº† +load æ–¹æ³•æ—¶ï¼Œä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¢«è°ƒç”¨ | +initialize æ–¹æ³•çš„è°ƒç”¨ä¸æ™®é€šæ–¹æ³•çš„è°ƒç”¨æ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå­ç±»æ²¡æœ‰å®ç° +initialize æ–¹æ³•ï¼Œé‚£ä¹ˆç»§æ‰¿è‡ªçˆ¶ç±»çš„å®ç°ä¼šè¢«è°ƒç”¨ï¼›å¦‚æœä¸€ä¸ªç±»çš„åˆ†ç±»å®ç°äº† +initialize æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šå¯¹è¿™ä¸ªç±»ä¸­çš„å®ç°é€ æˆè¦†ç›– |

å‚è€ƒ[ç±»æ–¹æ³•loadå’Œinitializeçš„åŒºåˆ«](https://cloud.tencent.com/developer/article/1355957)

##### åœ¨ç»§æ‰¿å…³ç³»ä¸­ä»–ä»¬æœ‰ä»€ä¹ˆåŒºåˆ«

superçš„æ–¹æ³•ä¼šæˆåŠŸè°ƒç”¨ï¼Œä½†æ˜¯è¿™æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºruntimeä¼šè‡ªåŠ¨å¯¹çˆ¶ç±»çš„+loadæ–¹æ³•è¿›è¡Œè°ƒç”¨ï¼Œè€Œ+initializeåˆ™ä¼šéšå­ç±»è‡ªåŠ¨æ¿€å‘çˆ¶ç±»çš„æ–¹æ³•ï¼ˆå¦‚Appleæ–‡æ¡£ä¸­æ‰€è¨€ï¼‰ä¸éœ€è¦æ˜¾ç¤ºè°ƒç”¨ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœçˆ¶ç±»ä¸­çš„æ–¹æ³•ç”¨åˆ°çš„selfï¼ˆåƒç¤ºä¾‹ä¸­çš„æ–¹æ³•ï¼‰ï¼Œå…¶æŒ‡ä»£çš„ä¾ç„¶æ˜¯ç±»è‡ªèº«ï¼Œè€Œä¸æ˜¯çˆ¶ç±»

####  è¯´è¯´æ¶ˆæ¯è½¬å‘æœºåˆ¶çš„ä¼˜åŠ£

ä¼˜ç‚¹: 
  
* åˆ©ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶å¯ä»¥æ— ä»£ç ä¾µå…¥çš„å®ç°å¤šé‡ä»£ç†ï¼Œè®©ä¸åŒå¯¹è±¡å¯ä»¥åŒæ—¶ä»£ç†åŒä¸ªå›è°ƒï¼Œç„¶ååœ¨å„è‡ªè´Ÿè´£çš„åŒºåŸŸè¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œé™ä½äº†ä»£ç çš„è€¦åˆç¨‹åº¦ã€‚  
* ä½¿ç”¨ @synthesize å¯ä»¥ä¸º @property è‡ªåŠ¨ç”Ÿæˆ getter å’Œ setter æ–¹æ³•ï¼ˆç° Xcode ç‰ˆæœ¬ä¸­ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰ï¼Œè€Œ @dynamic åˆ™æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œä¸ç”¨ç”Ÿæˆ getter å’Œ setter æ–¹æ³•ã€‚å½“ä½¿ç”¨ @dynamic æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶ï¼Œæ¥åŠ¨æ€æ·»åŠ  getter å’Œ setter æ–¹æ³•ã€‚å½“ç„¶ä½ ä¹Ÿç”¨å…¶ä»–çš„æ–¹æ³•æ¥å®ç°ã€‚


ç¼ºç‚¹:

* Objective-Cæœ¬èº«ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œè¿™æ˜¯å› ä¸ºæ¶ˆæ¯æœºåˆ¶åç§°æŸ¥æ‰¾å‘ç”Ÿåœ¨è¿è¡Œæ—¶è€Œéç¼–è¯‘æ—¶ï¼Œå¾ˆéš¾è§£å†³å¤šä¸ªåŸºç±»å¯èƒ½å¯¼è‡´çš„äºŒä¹‰æ€§é—®é¢˜ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡æ¶ˆæ¯è½¬å‘æœºåˆ¶åœ¨å†…éƒ¨åˆ›å»ºå¤šä¸ªåŠŸèƒ½çš„å¯¹è±¡ï¼ŒæŠŠä¸èƒ½å®ç°çš„åŠŸèƒ½ç»™è½¬å‘åˆ°å…¶ä»–å¯¹è±¡ä¸Šå»ï¼Œè¿™æ ·å°±åšå‡ºæ¥ä¸€ç§å¤šç»§æ‰¿çš„å‡è±¡ã€‚è½¬å‘å’Œç»§æ‰¿ç›¸ä¼¼ï¼Œå¯ç”¨äºä¸ºOCç¼–ç¨‹æ·»åŠ ä¸€äº›å¤šç»§æ‰¿çš„æ•ˆæœï¼Œä¸€ä¸ªå¯¹è±¡æŠŠæ¶ˆæ¯è½¬å‘å‡ºå»ï¼Œå°±å¥½åƒä»–æŠŠå¦ä¸€ä¸ªå¯¹è±¡ä¸­æ”¾æ³•æ¥è¿‡æ¥æˆ–è€…â€œç»§æ‰¿â€ä¸€æ ·ã€‚æ¶ˆæ¯è½¬å‘å¼¥è¡¥äº†objcä¸æ”¯æŒå¤šç»§æ‰¿çš„æ€§è´¨ï¼Œä¹Ÿé¿å…äº†å› ä¸ºå¤šç»§æ‰¿å¯¼è‡´å•ä¸ªç±»å˜å¾—è‡ƒè‚¿å¤æ‚ã€‚


# æ€»ç»“

æœ¬ç¯‡è®²è¿°çš„é¢è¯•é¢˜ä¸­çš„**runtimeç›¸å…³é—®é¢˜**ä¹‹**ç»“æ„æ¨¡å‹**éƒ¨åˆ†ã€‚ä¸‹ä¸€ç« æ‰“ç®—ç»§ç»­è®²ä¸€ä¸‹ **runtimeç›¸å…³é—®é¢˜**ä¹‹**å†…å­˜ç®¡ç†**,è¿™æ ·å¾ªåºæ¸è¿›æŠŠç›¸å…³é¢è¯•çš„æ–‡ç« éƒ½è®²å®Œ. 

è¿™é‡Œä¸å¾—ä¸è¯´ è¿™æ ·çš„é¢è¯•ç¡®å®å¾ˆæœ‰æŒ‘æˆ˜,é¡ºä¾¿ æˆ‘ä¹Ÿå–·ä¸€ä¸‹é˜¿é‡Œ å¤´æ¡å¸Œæœ›åšé“ä¸€ç‚¹,æœ‰é—®é¢˜å¯ä»¥ä½†æ˜¯ä¹Ÿè¦æœ‰ç­”æ¡ˆ.è¿™ä»¶äº‹ è®©æˆ‘è§‚å¯Ÿå‡º è¿™ä¸¤å®¶å…¬å¸å¹²äº‹ æœ‰å¤´æ²¡å°¾,èƒ½å–„å§‹æœªèƒ½å–„ç»ˆ.




URL: https://sunyazhou.com/2020/04/CocoapodsProblems/index.html.md
Published At: 2020-04-10 07:13:59 +0000

# Cocoapodsæ¸…åé•œåƒ

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

## Cocoapodç–‘éš¾æ‚ç—‡

è¿™å‡ å¤©å¼€å‘ æ€»é‡åˆ°ç–‘éš¾æ‚ç—‡ æ˜¯å› ä¸ºæˆ‘çš„cocoapodså‡çº§åˆ°äº†1.9.1,å¯¼è‡´å„ç§é—®é¢˜ ç„¶åè¿˜è¢«å’Œè°,æ— å¥ˆæ‰¾åˆ°å¦‚ä¸‹è§£å†³cocoapodså„ç§é—®é¢˜çš„è§£å†³æ–¹å¼


å¯¹äºæ—§ç‰ˆçš„ CocoaPods å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ä½¿ç”¨ tuna çš„é•œåƒï¼š

``` sh
$ pod repo remove master
$ pod repo add master https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git
$ pod repo update
```

æ–°ç‰ˆçš„ CocoaPods ä¸å…è®¸ç”¨`pod repo add`ç›´æ¥æ·»åŠ masteråº“äº†ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥ï¼š

``` sh
$ cd ~/.cocoapods/repos 
$ pod repo remove master
$ git clone https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git master
```

æœ€åè¿›å…¥è‡ªå·±çš„å·¥ç¨‹ï¼Œåœ¨è‡ªå·±å·¥ç¨‹çš„`PodFile`ç¬¬ä¸€è¡ŒåŠ ä¸Šï¼š

``` ruby
source 'https://mirrors.tuna.tsinghua.edu.cn/git/CocoaPods/Specs.git'
```


# æ€»ç»“


æŠ˜è…¾äº†å¾ˆä¹…ä¸å¦‚æ‰¾å¯¹åœ°æ–¹ 

[å‚è€ƒCocoaPods é•œåƒä½¿ç”¨å¸®åŠ©](https://mirrors.tuna.tsinghua.edu.cn/help/CocoaPods/)


URL: https://sunyazhou.com/2020/04/MasonryTricks/index.html.md
Published At: 2020-04-07 11:54:39 +0000

# ä½¿ç”¨Masonryå¤„ç†UIViewçš„safeAreaè¾¹ç•Œå¸ƒå±€é—®é¢˜

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## èƒŒæ™¯

iOS11ä¹‹åæ¨å‡ºçš„safeArea ç”¨äºå¤„ç†åˆ˜æµ·å±å¹•çš„é—®é¢˜.å¦‚æœè‡ªå·±å¤„ç†èµ·æ¥å¯èƒ½æ¯”è¾ƒ éº»çƒ¦  åˆéœ€è¦åˆ¤æ–­ ç‰ˆæœ¬åˆéœ€è¦åˆ¤æ–­  APIçš„å¯ç”¨æ€§. æ¸…æ˜å‡æœŸ åœ¨å®¶æ²¡äº‹å†™ä¸ªdemo  è§£å†³å¦‚ä½•æ›´å¿«æ·å¤„ç†å±å¹•çš„è¾¹ç•Œé—®é¢˜,æ¯”å¦‚ è§†å›¾è¦å¸ƒå±€åœ¨iOSå¯¼èˆªæ åº•éƒ¨ å’Œ `Home Indicator`. å…ˆçœ‹ä¸‹å›¾:

![](/assets/images/20200407MasonryTricks/SafeArea1.gif)

å¦‚æœä½¿ç”¨æ›´å°‘çš„ä»£ç å®ç°åœ¨å®‰å…¨åŒºåŸŸå†…éƒ¨ å±•ç¤ºæŸä¸ªView.


## ä»£ç å®ç°

è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©Masonryæœ€æ–°åº“æä¾›çš„æ”¯æŒAPI

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    
    [self.subViewA mas_makeConstraints:^(MASConstraintMaker *make) {
        if (@available(iOS 11.0, *)) {
            make.top.equalTo(self.view.mas_safeAreaLayoutGuideTop);
            make.left.equalTo(self.view.mas_safeAreaLayoutGuideLeft);
            make.bottom.equalTo(self.view.mas_safeAreaLayoutGuideBottom);
            make.right.equalTo(self.view.mas_safeAreaLayoutGuideRight);
        } else {
            make.top.equalTo(self.mas_topLayoutGuideBottom);
            make.left.right.equalTo(self.view);
            make.bottom.equalTo(self.mas_bottomLayoutGuideTop);
        }        
    }];
}

```

> è¿™é‡Œçœ‹åˆ°safeAreaä»…ä»…æ”¯æŒ iOS11ä»¥ä¸Š é‚£ä¹ˆ iOS11ä¸€ä¸‹ æˆ‘ä»¬å¯ä»¥å€Ÿå‡ºå¦‚ä¸Šè¿°ä»£ç 
> `self.mas_topLayoutGuideBottom`å’Œ`self.mas_bottomLayoutGuideTop` è¿™ä¸ªæ˜¯`self`æŒ‡çš„æ˜¯`UIViewController`

ä¸‹é¢æˆ‘ä»¬ä¸ç”¨SafeAreaæ¥ä½¿ç”¨ä¸€ä¸‹ å¦‚ä¸‹api

1. é¡¶éƒ¨åŒºåŸŸ

	* `mas_topLayoutGuide`å’Œ`mas_topLayoutGuideBottom`éƒ½æ˜¯ é¡¶åˆ°å±å¹• åˆ˜æµ·å±åº•éƒ¨ ä¹Ÿå°±æ˜¯è¯´å’Œ safeAreaTopä¸€æ ·,å¦‚ä¸‹å›¾:    
	![](/assets/images/20200407MasonryTricks/mas_topLayoutGuide&mas_topLayoutGuideBottom.webp)
	
	* `mas_topLayoutGuideTop` é¡¶åˆ°å±å¹•é¡¶éƒ¨(å¿½ç•¥åˆ˜æµ·å±,ä¹Ÿå°±æ˜¯è¯´è¢«åˆ˜æµ·ç›–ä½),å¦‚ä¸‹å›¾ç¤º:
	![](/assets/images/20200407MasonryTricks/mas_topLayoutGuideTop.webp)

2. åº•éƒ¨åŒºåŸŸ

	* `mas_bottomLayoutGuide`å’Œ`mas_bottomLayoutGuideTop` éƒ½æ˜¯åœ¨`Homeæ¡`çš„ä¸Šé¢ ,å¦‚ä¸‹å›¾:  
	![](/assets/images/20200407MasonryTricks/mas_bottomLayoutGuide&mas_bottomLayoutGuideTop.webp)
	
	* `mas_bottomLayoutGuideBottom` ç›´æ¥æ¨åº•,æ’‘åˆ°å±å¹•è¾¹ç¼˜,å¦‚ä¸‹å›¾:  
	![](/assets/images/20200407MasonryTricks/mas_bottomLayoutGuideBottom.webp)
	

#### å¦‚æœæƒ³å®ç°å’ŒsafeAreaä¸€æ ·çš„ææ³• å¯ä»¥è¿™æ ·å†™


``` objc
[self.subViewA mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.mas_topLayoutGuide);
        make.left.right.equalTo(self.view);
        make.bottom.equalTo(self.mas_bottomLayoutGuide);
}];
```

> !!!æ³¨æ„ LayoutGuide ç´§ç´§é€‚ç”¨äº` ios(7.0,11.0)`,ä¹Ÿå°±æ˜¯è¯´11ä¹‹å å¿…é¡»ä½¿ç”¨safeAreaæ‰ç²¾å‡†.

é™„ä¸Šä¸€å¼ æå®Œçš„æ•ˆæœå›¾

![](/assets/images/20200407MasonryTricks/LayoutGuideFullsceen.webp)



# æ€»ç»“

å€Ÿå…¥Masory å¯ä»¥æ›´åŠ æ–¹ä¾¿å¿«æ·çš„å®ç°æˆ‘ä»¬æƒ³è¦çš„å¸ƒå±€æ•ˆæœå¹¶ä¸”ä¸ç”¨å†™å®åŒºåˆ†æ˜¯å¦æ˜¯åˆ˜æµ·å±æˆ–è€…å…¶ä»–å±å¹•,å› ä¸ºæˆ‘ä»¬æ“æ§çš„å®é™…ä¸Šå°±æ˜¯ å®‰å…¨åŒºå†…éƒ¨çš„èŒƒå›´. æ²¡äº‹å¾—å¤šå…³æ³¨å¼€æºä»£ç æ—¶é•¿å†™ä¸ªdemoå®éªŒä¸€ä¸‹.

æ‰€ä»¥æƒ³å®ç°ä¸Šæ–‡ä¸­æœ€ä½³å®è·µçš„ä»£ç åº”è¯¥æ˜¯

``` objc
[self.subViewA mas_makeConstraints:^(MASConstraintMaker *make) {
    if (@available(iOS 11.0, *)) {
        make.top.equalTo(self.view.mas_safeAreaLayoutGuideTop);
        make.left.equalTo(self.view.mas_safeAreaLayoutGuideLeft);
        make.bottom.equalTo(self.view.mas_safeAreaLayoutGuideBottom);
        make.right.equalTo(self.view.mas_safeAreaLayoutGuideRight);
    } else {
        make.top.equalTo(self.mas_topLayoutGuideBottom);
        make.left.right.equalTo(self.view);
        make.bottom.equalTo(self.mas_bottomLayoutGuideTop);
    }        
}];

```



[æœ¬æ–‡Demo](https://github.com/sunyazhou13/MasonryTrickDemo)


URL: https://sunyazhou.com/2020/03/NSURLProtocol/index.html.md
Published At: 2020-03-20 11:34:22 +0000

# (è½¬)æ·±åº¦ç†è§£ NSURLProtocol

![](/assets/images/20200320NSURLProtocol/NSURLProtocol.webp)

# å‰è¨€

æœ¬æ–‡ç»ç”±å¾®ä¿¡`çŸ¥è¯†å°é›† `å…¬ä¼—å·æˆæƒå¹¶è½¬è½½è‡ª[FiTeenåšå®¢](https://blog.fiteen.top/2020/hijacking-webview-request-with-nsprotocol),å¦‚æœç‰ˆæƒé—®é¢˜è¯·ä¸æˆ‘è”ç³»sunyazhou13@163.com.è½¬è½½æ­¤æ–‡ç›®çš„æ˜¯ä¸ºäº†è®°å½•iOSå¼€å‘ä¸­çš„é‡è¦çŸ¥è¯†ç‚¹,é˜²æ­¢åŸæ–‡åšå®¢å¯»æ‰¾èµ·æ¥éº»çƒ¦.

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## NSURLProtocol æ˜¯ä»€ä¹ˆ

NSURLProtocol æ˜¯ Foundation æ¡†æ¶ä¸­[URL Loading System](https://developer.apple.com/documentation/foundation/url_loading_system?language=objc)çš„ä¸€éƒ¨åˆ†ã€‚å®ƒå¯ä»¥è®©å¼€å‘è€…å¯ä»¥åœ¨ä¸ä¿®æ”¹åº”ç”¨å†…åŸå§‹è¯·æ±‚ä»£ç çš„æƒ…å†µä¸‹ï¼Œå»æ”¹å˜ URL åŠ è½½çš„å…¨éƒ¨ç»†èŠ‚ã€‚æ¢å¥è¯è¯´ï¼ŒNSURLProtocol æ˜¯ä¸€ä¸ªè¢« Apple é»˜è®¸çš„ä¸­é—´äººæ”»å‡»ã€‚

è™½ç„¶ NSURLProtocol å«`Protocol`ï¼Œå´ä¸æ˜¯åè®®ï¼Œè€Œæ˜¯ä¸€ä¸ª**æŠ½è±¡ç±»**ã€‚

æ—¢ç„¶ NSURLProtocol æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¯´æ˜å®ƒæ— æ³•è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯å¦‚ä½•å®ç°ç½‘ç»œè¯·æ±‚æ‹¦æˆªçš„ï¼Ÿ

ç­”æ¡ˆå°±æ˜¯é€šè¿‡**å­ç±»åŒ–**æ¥å®šä¹‰æ–°çš„æˆ–æ˜¯å·²ç»å­˜åœ¨çš„ URL åŠ è½½è¡Œä¸ºã€‚å¦‚æœå½“å‰çš„ç½‘ç»œè¯·æ±‚æ˜¯å¯ä»¥è¢«æ‹¦æˆªçš„ï¼Œé‚£ä¹ˆå¼€å‘è€…åªéœ€è¦å°†ä¸€ä¸ªè‡ªå®šä¹‰çš„ NSURLProtocol å­ç±»æ³¨å†Œåˆ° App ä¸­ï¼Œåœ¨è¿™ä¸ªå­ç±»ä¸­å°±å¯ä»¥æ‹¦æˆªåˆ°æ‰€æœ‰è¯·æ±‚å¹¶è¿›è¡Œä¿®æ”¹ã€‚

é‚£ä¹ˆåˆ°åº•å“ªäº›ç½‘ç»œè¯·æ±‚å¯ä»¥è¢«æ‹¦æˆªï¼Ÿ

## NSURLProtocol ä½¿ç”¨åœºæ™¯

å‰é¢å·²ç»è¯´äº†ï¼ŒNSURLProtocol æ˜¯ URL Loading System çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ‹¦æˆªæ‰€æœ‰åŸºäº URL Loading System çš„ç½‘ç»œè¯·æ±‚ï¼š

* NSURLSession  
* NSURLConnection  
* NSURLDownload    
* NSURLResponse    
	* NSHTTPURLResponse  
* NSURLRequest  
	* NSMutableURLRequest  


ç›¸åº”çš„ï¼ŒåŸºäºå®ƒä»¬å®ç°çš„ç¬¬ä¸‰æ–¹ç½‘ç»œæ¡†æ¶[AFNetworking](https://github.com/AFNetworking/AFNetworking)å’Œ[Alamofire](https://github.com/Alamofire/Alamofire)çš„ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥è¢« NSURLProtocol æ‹¦æˆªåˆ°ã€‚

ä½†æ—©äº›å¹´åŸºäº CFNetwork å®ç°çš„ï¼Œæ¯”å¦‚[ASIHTTPRequest](https://github.com/pokeb/asi-http-request)ï¼Œå…¶ç½‘ç»œè¯·æ±‚å°±æ— æ³•è¢«æ‹¦æˆªã€‚

å¦å¤–ï¼Œ**UIWebViewä¹Ÿæ˜¯å¯ä»¥è¢«NSURLProtocolæ‹¦æˆªçš„,ä½†WKWebViewä¸å¯ä»¥**ã€‚ï¼ˆå› ä¸º WKWebView æ˜¯åŸºäº WebKitï¼Œå¹¶ä¸èµ° C socketã€‚ï¼‰

å› æ­¤ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œå®ƒçš„åŠŸèƒ½ååˆ†å¼ºå¤§ï¼Œæ¯”å¦‚ï¼š

* é‡å®šå‘ç½‘ç»œè¯·æ±‚ï¼Œè§£å†³ DNS åŸŸååŠ«æŒçš„é—®é¢˜
* è¿›è¡Œå…¨å±€æˆ–å±€éƒ¨çš„ç½‘ç»œè¯·æ±‚è®¾ç½®ï¼Œæ¯”å¦‚ä¿®æ”¹è¯·æ±‚åœ°å€ã€header ç­‰
* å¿½ç•¥ç½‘ç»œè¯·æ±‚ï¼Œä½¿ç”¨ H5 ç¦»çº¿åŒ…æˆ–æ˜¯ç¼“å­˜æ•°æ®ç­‰
* è‡ªå®šä¹‰ç½‘ç»œè¯·æ±‚çš„è¿”å›ç»“æœï¼Œæ¯”å¦‚è¿‡æ»¤æ•æ„Ÿä¿¡æ¯

ä¸‹é¢æ¥çœ‹ä¸€ä¸‹ NSURLProtocol çš„ç›¸å…³æ–¹æ³•ã€‚

## NSURLProtocol çš„ç›¸å…³æ–¹æ³•

### åˆ›å»ºåè®®å¯¹è±¡

``` objc
// åˆ›å»ºä¸€ä¸ª URL åè®®å®ä¾‹æ¥å¤„ç† request è¯·æ±‚
- (instancetype)initWithRequest:(NSURLRequest *)request cachedResponse:(NSCachedURLResponse *)cachedResponse client:(id<NSURLProtocolClient>)client;
// åˆ›å»ºä¸€ä¸ª URL åè®®å®ä¾‹æ¥å¤„ç† session task è¯·æ±‚
- (instancetype)initWithTask:(NSURLSessionTask *)task cachedResponse:(NSCachedURLResponse *)cachedResponse client:(id<NSURLProtocolClient>)client;

```

### æ³¨å†Œå’Œæ³¨é”€åè®®ç±»

``` objc
// å°è¯•æ³¨å†Œ NSURLProtocol çš„å­ç±»ï¼Œä½¿ä¹‹åœ¨ URL åŠ è½½ç³»ç»Ÿä¸­å¯è§
+ (BOOL)registerClass:(Class)protocolClass;
// æ³¨é”€ NSURLProtocol çš„æŒ‡å®šå­ç±»
+ (void)unregisterClass:(Class)protocolClass;

```

### ç¡®å®šå­ç±»æ˜¯å¦å¯ä»¥å¤„ç†è¯·æ±‚  

å­ç±»åŒ– NSProtocol çš„é¦–è¦ä»»åŠ¡å°±æ˜¯å‘ŠçŸ¥å®ƒï¼Œéœ€è¦æ§åˆ¶ä»€ä¹ˆç±»å‹çš„ç½‘ç»œè¯·æ±‚ã€‚

``` objc
// ç¡®å®šåè®®å­ç±»æ˜¯å¦å¯ä»¥å¤„ç†æŒ‡å®šçš„ request è¯·æ±‚ï¼Œå¦‚æœè¿”å› YESï¼Œè¯·æ±‚ä¼šè¢«å…¶æ§åˆ¶ï¼Œè¿”å› NO åˆ™ç›´æ¥è·³å…¥ä¸‹ä¸€ä¸ª protocol
+ (BOOL)canInitWithRequest:(NSURLRequest *)request;
// ç¡®å®šåè®®å­ç±»æ˜¯å¦å¯ä»¥å¤„ç†æŒ‡å®šçš„ task è¯·æ±‚
+ (BOOL)canInitWithTask:(NSURLSessionTask *)task;
```

### è·å–å’Œè®¾ç½®è¯·æ±‚å±æ€§

NSURLProtocol å…è®¸å¼€å‘è€…å»è·å–ã€æ·»åŠ ã€åˆ é™¤ request å¯¹è±¡çš„ä»»æ„å…ƒæ•°æ®ã€‚è¿™å‡ ä¸ªæ–¹æ³•å¸¸ç”¨æ¥å¤„ç†è¯·æ±‚æ— é™å¾ªç¯çš„é—®é¢˜ã€‚

``` objc
// åœ¨æŒ‡å®šçš„è¯·æ±‚ä¸­è·å–ä¸æŒ‡å®šé”®å…³è”çš„å±æ€§
+ (id)propertyForKey:(NSString *)key inRequest:(NSURLRequest *)request;
// è®¾ç½®ä¸æŒ‡å®šè¯·æ±‚ä¸­çš„æŒ‡å®šé”®å…³è”çš„å±æ€§
+ (void)setProperty:(id)value forKey:(NSString *)key inRequest:(NSMutableURLRequest *)request;
// åˆ é™¤ä¸æŒ‡å®šè¯·æ±‚ä¸­çš„æŒ‡å®šé”®å…³è”çš„å±æ€§
+ (void)removePropertyForKey:(NSString *)key inRequest:(NSMutableURLRequest *)request;
```


### æä¾›è¯·æ±‚çš„è§„èŒƒç‰ˆæœ¬

å¦‚æœä½ æƒ³è¦ç”¨ç‰¹å®šçš„æŸä¸ªæ–¹å¼æ¥ä¿®æ”¹è¯·æ±‚ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªæ–¹æ³•ã€‚

``` objc
// è¿”å›æŒ‡å®šè¯·æ±‚çš„è§„èŒƒç‰ˆæœ¬
+ (NSURLRequest *)canonicalRequestForRequest:(NSURLRequest *)request;
```

### ç¡®å®šè¯·æ±‚æ˜¯å¦ç›¸åŒ

``` objc
// åˆ¤æ–­ä¸¤ä¸ªè¯·æ±‚æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒå¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œé€šå¸¸åªéœ€è¦è°ƒç”¨çˆ¶ç±»çš„å®ç°
+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b;

```

### å¯åŠ¨å’Œåœæ­¢åŠ è½½

è¿™æ˜¯å­ç±»ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸åŒçš„è‡ªå®šä¹‰å­ç±»åœ¨è°ƒç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ—¶ä¼šä¼ å…¥ä¸åŒçš„å†…å®¹ï¼Œä½†å…±åŒç‚¹éƒ½æ˜¯å›´ç»• `protocol` å®¢æˆ·ç«¯è¿›è¡Œæ“ä½œ.

``` objc
// å¼€å§‹åŠ è½½
- (void)startLoading;  
// åœæ­¢åŠ è½½  
- (void)stopLoading; 
```

### è·å–åè®®å±æ€§

``` objc
// è·å–åè®®æ¥æ”¶è€…çš„ç¼“å­˜
- (NSCachedURLResponse *)cachedResponse;
// æ¥å—è€…ç”¨æ¥ä¸ URL åŠ è½½ç³»ç»Ÿé€šä¿¡çš„å¯¹è±¡ï¼Œæ¯ä¸ª NSProtocol çš„å­ç±»å®ä¾‹éƒ½æ‹¥æœ‰å®ƒ
- (id<NSURLProtocolClient>)client;
// æ¥æ”¶æ–¹çš„è¯·æ±‚
- (NSURLRequest *)request;
// æ¥æ”¶æ–¹çš„ä»»åŠ¡
- (NSURLSessionTask *)task;
```

NSURLProtocol åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¸»è¦æ˜¯å®Œæˆä¸¤æ­¥ï¼šæ‹¦æˆª URL å’Œ URL è½¬å‘ã€‚å…ˆæ¥çœ‹å¦‚ä½•æ‹¦æˆªç½‘ç»œè¯·æ±‚ã€‚

## å¦‚ä½•åˆ©ç”¨ NSProtocol æ‹¦æˆªç½‘ç»œè¯·æ±‚

### åˆ›å»º NSURLProtocol å­ç±»

è¿™é‡Œåˆ›å»ºä¸€ä¸ªåä¸º`HTCustomURLProtocol`çš„å­ç±»ã€‚

``` objc
@interface HTCustomURLProtocol : NSURLProtocol
@end
```

### æ³¨å†Œ NSURLProtocol çš„å­ç±»

åœ¨åˆé€‚çš„ä½ç½®æ³¨å†Œè¿™ä¸ªå­ç±»ã€‚å¯¹åŸºäº NSURLConnection æˆ–è€…ä½¿ç”¨`[NSURLSession sharedSession]`åˆå§‹åŒ–å¯¹è±¡åˆ›å»ºçš„ç½‘ç»œè¯·æ±‚ï¼Œè°ƒç”¨ `registerClass` æ–¹æ³•å³å¯ã€‚

``` objc
[NSURLProtocol registerClass:[NSClassFromString(@"HTCustomURLProtocol") class]];
// æˆ–è€…
// [NSURLProtocol registerClass:[HTCustomURLProtocol class]];
```

å¦‚æœéœ€è¦å…¨å±€ç›‘å¬ï¼Œå¯ä»¥è®¾ç½®åœ¨ `AppDelegate.m` çš„ `didFinishLaunchingWithOptions:` æ–¹æ³•ä¸­ã€‚å¦‚æœåªéœ€è¦åœ¨å•ä¸ª UIViewController ä¸­ä½¿ç”¨ï¼Œè®°å¾—åœ¨åˆé€‚çš„æ—¶æœºæ³¨é”€ç›‘å¬ï¼š

``` objc
[NSURLProtocol unregisterClass:[NSClassFromString(@"HTCustomURLProtocol") class]];
```

å¦‚æœæ˜¯åŸºäº NSURLSession çš„ç½‘ç»œè¯·æ±‚ï¼Œä¸”ä¸æ˜¯é€šè¿‡`[NSURLSession sharedSession]`æ–¹å¼åˆ›å»ºçš„ï¼Œå°±å¾—é…ç½® NSURLSessionConfiguration å¯¹è±¡çš„ `protocolClasses` å±æ€§ã€‚

``` objc
NSURLSessionConfiguration *sessionConfiguration = [NSURLSessionConfiguration defaultSessionConfiguration];
sessionConfiguration.protocolClasses = @[[NSClassFromString(@"HTCustomURLProtocol") class]];
```

### å®ç° NSURLProtocol å­ç±»

å®ç°å­ç±»åˆ†ä¸ºäº”ä¸ªæ­¥éª¤ï¼š  

> æ³¨å†Œ â†’ æ‹¦æˆª â†’ è½¬å‘ â†’ å›è°ƒ â†’ ç»“æŸ

ä»¥æ‹¦æˆª UIWebView ä¸ºä¾‹ï¼Œè¿™é‡Œéœ€è¦é‡å†™çˆ¶ç±»çš„è¿™äº”ä¸ªæ ¸å¿ƒæ–¹æ³•ã€‚

``` objc
// å®šä¹‰ä¸€ä¸ªåè®® key
static NSString * const HTCustomURLProtocolHandledKey = @"HTCustomURLProtocolHandledKey";

// åœ¨æ‹“å±•ä¸­å®šä¹‰ä¸€ä¸ª NSURLConnection å±æ€§ã€‚é€šè¿‡ NSURLSession ä¹Ÿå¯ä»¥æ‹¦æˆªï¼Œè¿™é‡Œåªæ˜¯ä»¥ NSURLConnection ä¸ºä¾‹ã€‚
@property (nonatomic, strong) NSURLConnection *connection;
// å®šä¹‰ä¸€ä¸ªå¯å˜çš„è¯·æ±‚è¿”å›å€¼ï¼Œ
@property (nonatomic, strong) NSMutableData *responseData;

// æ–¹æ³• 1ï¼šåœ¨æ‹¦æˆªåˆ°ç½‘ç»œè¯·æ±‚åä¼šè°ƒç”¨è¿™ä¸€æ–¹æ³•ï¼Œå¯ä»¥å†æ¬¡å¤„ç†æ‹¦æˆªçš„é€»è¾‘ï¼Œæ¯”å¦‚è®¾ç½®åªé’ˆå¯¹ http å’Œ https çš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚
+ (BOOL)canInitWithRequest:(NSURLRequest *)request {
    // åªå¤„ç† http å’Œ https è¯·æ±‚
    NSString *scheme = [[request URL] scheme];
    if ( ([scheme caseInsensitiveCompare:@"http"] == NSOrderedSame ||
          [scheme caseInsensitiveCompare:@"https"] == NSOrderedSame)) {
        // çœ‹çœ‹æ˜¯å¦å·²ç»å¤„ç†è¿‡äº†ï¼Œé˜²æ­¢æ— é™å¾ªç¯
        if ([NSURLProtocol propertyForKey:HTCustomURLProtocolHandledKey inRequest:request]) {
            return NO;
        }
        // å¦‚æœè¿˜éœ€è¦æˆªå– DNS è§£æè¯·æ±‚ä¸­çš„é“¾æ¥ï¼Œå¯ä»¥ç»§ç»­åŠ åˆ¤æ–­ï¼Œæ˜¯å¦ä¸ºæ‹¦æˆªåŸŸåè¯·æ±‚çš„é“¾æ¥ï¼Œå¦‚æœæ˜¯è¿”å› NO
        return YES;
    }
    return NO;
}

// æ–¹æ³• 2ï¼šã€å…³é”®æ–¹æ³•ã€‘å¯ä»¥åœ¨æ­¤å¯¹ request è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚ä¿®æ”¹åœ°å€ã€æå–è¯·æ±‚ä¿¡æ¯ã€è®¾ç½®è¯·æ±‚å¤´ç­‰ã€‚
+ (NSURLRequest *) canonicalRequestForRequest:(NSURLRequest *)request {
    // å¯ä»¥æ‰“å°å‡ºæ‰€æœ‰çš„è¯·æ±‚é“¾æ¥åŒ…æ‹¬ CSS å’Œ Ajax è¯·æ±‚ç­‰
    NSLog(@"request.URL.absoluteString = %@",request.URL.absoluteString);
    NSMutableURLRequest *mutableRequest = [request mutableCopy];
    return mutableRequest;
}

// æ–¹æ³• 3ï¼šã€å…³é”®æ–¹æ³•ã€‘åœ¨è¿™é‡Œè®¾ç½®ç½‘ç»œä»£ç†ï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°†å¤„ç†è¿‡çš„ request è½¬å‘å‡ºå»ã€‚è¿™é‡Œå¯¹åº”çš„å›è°ƒæ–¹æ³•å¯¹åº” <NSURLProtocolClient> åè®®æ–¹æ³•
- (void)startLoading {
    // å¯ä»¥ä¿®æ”¹ request è¯·æ±‚
    NSMutableURLRequest *mutableRequest = [[self request] mutableCopy];
    // æ‰“ tagï¼Œé˜²æ­¢é€’å½’è°ƒç”¨
    [NSURLProtocol setProperty:@YES forKey:HTCustomURLProtocolHandledKey inRequest:mutableRequest];
    // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œæ£€æŸ¥ç¼“å­˜
    // å°† request è½¬å‘ï¼Œå¯¹äº NSURLConnection æ¥è¯´ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª NSURLConnection å¯¹è±¡ï¼›å¯¹äº NSURLSession æ¥è¯´ï¼Œå°±æ˜¯å‘èµ·ä¸€ä¸ª NSURLSessionTaskã€‚
    self.connection = [NSURLConnection connectionWithRequest:mutableRequest delegate:self];
}

// æ–¹æ³• 4ï¼šä¸»è¦åˆ¤æ–­ä¸¤ä¸ª request æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒçš„è¯å¯ä»¥ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼Œé€šå¸¸åªéœ€è¦è°ƒç”¨çˆ¶ç±»çš„å®ç°ã€‚
+ (BOOL)requestIsCacheEquivalent:(NSURLRequest *)a toRequest:(NSURLRequest *)b {
    return [super requestIsCacheEquivalent:a toRequest:b];
}

// æ–¹æ³• 5ï¼šå¤„ç†ç»“æŸååœæ­¢ç›¸åº”è¯·æ±‚ï¼Œæ¸…ç©º connection æˆ– session
- (void)stopLoading {
    if (self.connection != nil) {
        [self.connection cancel];
        self.connection = nil;
    }
}

// æŒ‰ç…§åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­åšçš„è‡ªå®šä¹‰éœ€æ±‚ï¼Œçœ‹æƒ…å†µå¯¹è½¬å‘å‡ºæ¥çš„è¯·æ±‚åœ¨æ°å½“çš„æ—¶æœºè¿›è¡Œå›è°ƒå¤„ç†ã€‚
#pragma mark- NSURLConnectionDelegate

- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error {
    [self.client URLProtocol:self didFailWithError:error];
}

#pragma mark - NSURLConnectionDataDelegate

// å½“æ¥æ”¶åˆ°æœåŠ¡å™¨çš„å“åº”ï¼ˆè¿é€šäº†æœåŠ¡å™¨ï¼‰æ—¶ä¼šè°ƒç”¨
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response {
    self.responseData = [[NSMutableData alloc] init];
    // å¯ä»¥å¤„ç†ä¸åŒçš„ statusCode åœºæ™¯
    // NSInteger statusCode = [(NSHTTPURLResponse *)response statusCode];
    // å¯ä»¥è®¾ç½® Cookie
    [self.client URLProtocol:self didReceiveResponse:response cacheStoragePolicy:NSURLCacheStorageNotAllowed];
}

// æ¥æ”¶åˆ°æœåŠ¡å™¨çš„æ•°æ®æ—¶ä¼šè°ƒç”¨ï¼Œå¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œæ¯æ¬¡åªä¼ é€’éƒ¨åˆ†æ•°æ®
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    [self.responseData appendData:data];
    [self.client URLProtocol:self didLoadData:data];
}

// æœåŠ¡å™¨çš„æ•°æ®åŠ è½½å®Œæ¯•åè°ƒç”¨
- (void)connectionDidFinishLoading:(NSURLConnection *)connection {
    [self.client URLProtocolDidFinishLoading:self];
}

// è¯·æ±‚é”™è¯¯ï¼ˆå¤±è´¥ï¼‰çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯”å¦‚å‡ºç°è¯·æ±‚è¶…æ—¶ã€æ–­ç½‘ï¼Œä¸€èˆ¬æŒ‡å®¢æˆ·ç«¯é”™è¯¯
- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error {
    [self.client URLProtocol:self didFailWithError:error];
}
```

ä¸Šé¢ç”¨åˆ°çš„ä¸€äº› NSURLProtocolClient æ–¹æ³•ï¼š

``` objc
@protocol NSURLProtocolClient <NSObject>
// è¯·æ±‚é‡å®šå‘
- (void)URLProtocol:(NSURLProtocol *)protocol wasRedirectedToRequest:(NSURLRequest *)request redirectResponse:(NSURLResponse *)redirectResponse;
// å“åº”ç¼“å­˜æ˜¯å¦åˆæ³•
- (void)URLProtocol:(NSURLProtocol *)protocol cachedResponseIsValid:(NSCachedURLResponse *)cachedResponse;
// åˆšæ¥æ”¶åˆ° response ä¿¡æ¯
- (void)URLProtocol:(NSURLProtocol *)protocol didReceiveResponse:(NSURLResponse *)response cacheStoragePolicy:(NSURLCacheStoragePolicy)policy;
// æ•°æ®åŠ è½½æˆåŠŸ
- (void)URLProtocol:(NSURLProtocol *)protocol didLoadData:(NSData *)data;
// æ•°æ®å®ŒæˆåŠ è½½
- (void)URLProtocolDidFinishLoading:(NSURLProtocol *)protocol;
// æ•°æ®åŠ è½½å¤±è´¥
- (void)URLProtocol:(NSURLProtocol *)protocol didFailWithError:(NSError *)error;
// ä¸ºæŒ‡å®šçš„è¯·æ±‚å¯åŠ¨éªŒè¯
- (void)URLProtocol:(NSURLProtocol *)protocol didReceiveAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge;
// ä¸ºæŒ‡å®šçš„è¯·æ±‚å–æ¶ˆéªŒè¯
- (void)URLProtocol:(NSURLProtocol *)protocol didCancelAuthenticationChallenge:(NSURLAuthenticationChallenge *)challenge;
@end
```

## è¡¥å……å†…å®¹

### ä½¿ç”¨ NSURLSession æ—¶çš„æ³¨æ„äº‹é¡¹

å¦‚æœåœ¨ NSURLProtocol ä¸­ä½¿ç”¨ NSURLSessionï¼Œéœ€è¦æ³¨æ„ï¼š

* æ‹¦æˆªåˆ°çš„ request è¯·æ±‚çš„ HTTPBody ä¸º nilï¼Œä½†å¯ä»¥å€ŸåŠ© HTTPBodyStream æ¥è·å– bodyï¼›

* å¦‚æœè¦ç”¨ `registerClass` æ³¨å†Œï¼Œåªèƒ½é€šè¿‡ `[NSURLSession sharedSession]` çš„æ–¹å¼åˆ›å»ºç½‘ç»œè¯·æ±‚ã€‚

### æ³¨å†Œå¤šä¸ª NSURLProtocol å­ç±»

å½“æœ‰å¤šä¸ªè‡ªå®šä¹‰ NSURLProtocol å­ç±»æ³¨å†Œåˆ°ç³»ç»Ÿä¸­çš„è¯ï¼Œä¼šæŒ‰ç…§ä»–ä»¬æ³¨å†Œçš„åå‘é¡ºåºä¾æ¬¡è°ƒç”¨ URL åŠ è½½æµç¨‹ï¼Œä¹Ÿå°±æ˜¯æœ€åæ³¨å†Œçš„ NSURLProtocol ä¼šè¢«ä¼˜å…ˆåˆ¤æ–­ã€‚

å¯¹äºé€šè¿‡é…ç½® NSURLSessionConfiguration å¯¹è±¡çš„ `protocolClasses` å±æ€§æ¥æ³¨å†Œçš„æƒ…å†µï¼Œ`protocolClasses` æ•°ç»„ä¸­åªæœ‰ç¬¬ä¸€ä¸ª NSURLProtocol ä¼šèµ·ä½œç”¨ï¼Œåç»­çš„ NSURLProtocol å°±æ— æ³•æ‹¦æˆªåˆ°äº†ã€‚

æ‰€ä»¥ [OHHTTPStubs](https://github.com/AliSoftware/OHHTTPStubs) åœ¨æ³¨å†Œ NSURLProtocol å­ç±»çš„æ—¶å€™æ˜¯è¿™æ ·å¤„ç†çš„ï¼š

``` objc
+ (void)setEnabled:(BOOL)enable forSessionConfiguration:(NSURLSessionConfiguration*)sessionConfig
{
    // Runtime check to make sure the API is available on this version
    if ([sessionConfig respondsToSelector:@selector(protocolClasses)]
        && [sessionConfig respondsToSelector:@selector(setProtocolClasses:)])
    {
        NSMutableArray * urlProtocolClasses = [NSMutableArray arrayWithArray:sessionConfig.protocolClasses];
        Class protoCls = HTTPStubsProtocol.class;
        if (enable && ![urlProtocolClasses containsObject:protoCls])
        {
            // å°†è‡ªå·±çš„ NSURLProtocol æ’å…¥åˆ° protocolClasses çš„ç¬¬ä¸€ä¸ªï¼Œè¿›è¡Œæ‹¦æˆª
            [urlProtocolClasses insertObject:protoCls atIndex:0];
        }
        else if (!enable && [urlProtocolClasses containsObject:protoCls])
        {
            // æ‹¦æˆªå®Œæˆåç§»é™¤
            [urlProtocolClasses removeObject:protoCls];
        }
        sessionConfig.protocolClasses = urlProtocolClasses;
    }
    else
    {
        NSLog(@"[OHHTTPStubs] %@ is only available when running on iOS7+/OSX9+. "
              @"Use conditions like 'if ([NSURLSessionConfiguration class])' to only call "
              @"this method if the user is running iOS7+/OSX9+.", NSStringFromSelector(_cmd));
    }
}
```

## å¦‚ä½•æ‹¦æˆª WKWebView

è™½ç„¶ NSURLProtocol æ— æ³•ç›´æ¥æ‹¦æˆª WKWebViewï¼Œä½†å…¶å®è¿˜æ˜¯æœ‰è§£å†³æ–¹æ¡ˆçš„ã€‚å°±æ˜¯ä½¿ç”¨ `WKBrowsingContextController` å’Œ `registerSchemeForCustomProtocol`ã€‚

``` objc
// æ³¨å†Œ scheme
Class cls = NSClassFromString(@"WKBrowsingContextController");
SEL sel = NSSelectorFromString(@"registerSchemeForCustomProtocol:");
if ([cls respondsToSelector:sel]) {
    // é€šè¿‡ http å’Œ https çš„è¯·æ±‚ï¼ŒåŒç†å¯é€šè¿‡å…¶ä»–çš„ Scheme ä½†æ˜¯è¦æ»¡è¶³ URL Loading System
    [cls performSelector:sel withObject:@"http"];
    [cls performSelector:sel withObject:@"https"];
}
```
ä½†ç”±äºè¿™æ¶‰åŠåˆ°äº†ç§æœ‰æ–¹æ³•ï¼Œç›´æ¥å¼•ç”¨æ— æ³•è¿‡è‹¹æœçš„æœºå®¡ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦å¯¹å­—ç¬¦ä¸²åšä¸‹å¤„ç†ï¼Œæ¯”å¦‚å¯¹æ–¹æ³•åè¿›è¡Œç®—æ³•åŠ å¯†å¤„ç†ç­‰ï¼Œå®æµ‹ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡å®¡æ ¸çš„ã€‚

æ€»ä¹‹ï¼ŒNSURLProtocol éå¸¸å¼ºå¤§ï¼Œæ— è®ºæ˜¯ä¼˜åŒ– App çš„æ€§èƒ½ï¼Œè¿˜æ˜¯æ‹“å±•åŠŸèƒ½ï¼Œéƒ½å…·æœ‰å¾ˆå¼ºçš„å¯å¡‘ç©ºé—´ï¼Œä½†åœ¨ä½¿ç”¨çš„åŒæ—¶ï¼Œåˆè¦å¤šå…³æ³¨å®ƒå¸¦æ¥çš„é—®é¢˜ã€‚å°½ç®¡å®ƒåœ¨å¾ˆå¤šæ¡†æ¶æˆ–è€…çŸ¥åé¡¹ç›®ä¸­éƒ½å·²ç»å¾—ä»¥åº”ç”¨ï¼Œå…¶å¥¥ä¹‰ä¾ç„¶å€¼å¾—å¼€å‘è€…ä»¬å»æ·±å…¥ç ”ç©¶ã€‚


# æ€»ç»“

æˆ‘è®¤çœŸçœ‹äº†ä½œè€…çš„æ–‡ç«  å¼ºçƒˆæ¨èiOSå¼€å‘å°ä¼™ä¼´å­¦ä¹ ä¸€ä¸‹.




URL: https://sunyazhou.com/2020/02/SunyazhouTheory/index.html.md
Published At: 2020-02-07 04:59:11 +0000

# ã€Šå­™äºšæ´²ç†è®ºã€‹çš„è¯ç”Ÿ

![](/assets/images/20200207SunyazhouTheory/thesunyazhoutheory.webp)

# å‰è¨€

ç”±äºåŸºç¡€çŸ¥è¯†è–„å¼±ï¼Œæˆ‘æ‰€åšåˆ°çš„å†…å®¹ä»…é™äºå­¦ä¹ å’Œè§‚å¯Ÿåˆ°çš„ä¸€äº›äº‹å®ï¼Œæœªèƒ½ä¸Šå‡ä¸ºç†è®ºå­¦è¯´.

## éè‘—åçš„ã€ŠThe Sunyazhou Theoryã€‹

å›½å®¶è¦æƒ³å‘å±•å¿…é¡»ä»æé«˜ç”Ÿäº§åŠ›ä¸Šå…¥æ‰‹ï¼ŒæŠ€æœ¯æ˜¯ç›®å‰ä¸ºæ­¢äººç±»å‘ç°å”¯ä¸€è§£å†³ç”Ÿäº§åŠ›é—®é¢˜çš„æœ‰åŠ›å·¥å…·ã€‚
æ‰€ä»¥æˆ‘æŠŠç”Ÿäº§åŠ›åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µ:

1. è§£æ”¾ç”Ÿäº§åŠ›  
2.  æé«˜ç”Ÿäº§åŠ›  
3.  çªç ´ç”Ÿäº§åŠ›  

æˆ‘æŠŠå®ƒç§°ä¸º**`ã€Šå­™äºšæ´²ç†è®ºã€‹`**è‹±æ–‡**`ã€ŠThe Sunyazhou Theoryã€‹`**ï¼Œç›®å‰æ²¡æœ‰ä»»ä½•æƒå¨æ‚å¿—å‘è¡¨ã€‚

## éªŒè¯ç†è®º

è¿™ç§ç†è®ºè¯æ˜çš„å®¢è§‚äº‹å®æ˜¯ï¼Œå‘å±•ä¸­å›½å®¶ï¼Œå‘å±•é˜¶æ®µä¸€å®šæ˜¯:

1. å°è§„æ¨¡åˆ¶é€ å¯ç”¨å•†å“  
2. ä¼˜åŒ–å¹¶æå‡å·¥è‰ºæ°´å¹³æµæ°´çº¿ä½œä¸š  
3. å†åˆ°è¢«æ–°çš„äº§å“å–ç¼”æ·˜æ±°çš„è¿‡ç¨‹  

æ‰€ä»¥æ´»åœ¨å½“ä¸‹ï¼Œæ— è®ºä¸Šå­¦è¿˜æ˜¯å·¥ä½œï¼Œ__æŠ€æœ¯äººå‘˜è¿œæ¯”æ™®é€šäººå‘˜æœ‰ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒéªŒè¯äº†æˆ‘çš„ç†è®ºå­¦è¯´ï¼Œä»äº‹æé«˜ç”Ÿäº§åŠ›çš„èŒä¸šã€‚__

æˆ‘å¸Œæœ›å¤šå¹´åå¤§å®¶æèµ·è¿™ä¸ªé“ç†çš„æ—¶å€™èƒ½æƒ³åˆ°ï¼Œå•Šè¿™å°±æ˜¯éè‘—åçš„ã€Šå­™äºšæ´²ç†è®ºã€‹.

# æ€»ç»“

è¿‡å¹´å›å®¶æ€»æœ‰äººé—®åœ¨åŒ—äº¬å·¥ä½œå·¥èµ„é«˜å¦‚ä½•å¦‚ä½•,æˆ‘å°±ç®€å•å‘è¡¨ä¸€ä¸‹æˆ‘çš„çœ‹æ³•å¹¶æ‰¯æ·¡çš„å½¢æˆäº†è‡ªå·±çš„ç†è®ºå­¦è¯´.



URL: https://sunyazhou.com/2019/12/FinalSummary/index.html.md
Published At: 2019-12-30 23:30:00 +0000

# 2019å¹´ç»ˆæ€»ç»“

![](/assets/images/20191231FinalSummary/AlanTuring.webp)

2019å¹´ [é˜¿å…°å›¾çµ](https://baike.baidu.com/item/%E8%89%BE%E4%BC%A6%C2%B7%E9%BA%A6%E5%B8%AD%E6%A3%AE%C2%B7%E5%9B%BE%E7%81%B5/3940576?fromtitle=%E9%98%BF%E5%85%B0%C2%B7%E5%9B%BE%E7%81%B5&fromid=10961384)(è®¡ç®—æœºçš„å…ˆé©±ç¼”é€ è€…)å°†å‡ºç°åœ¨æœªæ¥çš„50è‹±é•‘çº¸å¸çš„å°é¢,è¿™å°†æ˜¯è®¡ç®—æœºå‘å±•å²ä¸Šçš„é‡Œç¨‹ç¢‘,æ˜¯ä»–ç ´è§£äº†å¾·å›½çš„è‘—åå¯†ç ç³»ç»ŸEnigmaï¼Œå¸®åŠ©ç›Ÿå†›å–å¾—äº†äºŒæˆ˜çš„èƒœåˆ©.æ²¡æœ‰ä»–å°±æ²¡æœ‰ä»Šå¤©çš„è®¡ç®—æœº.

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!

> æœ›æå¤©æ¶¯åšæ¸å‘,è€Œç«‹ä¸‰åæˆ‘æ˜¯è°.  
> å‹å¹´æŠ‘å²åŒ†åŒ†è¿‡,å›å¤´ç¢Œç¢Œå˜æ— ä¸º.  
> äººè¨€åŒ—æ¼‚è–ªèµ„é«˜,åŠ›å›¾è¿ˆè¿›çš†ç…ç†¬.  
> æ˜Ÿè¾°å¤§æµ·å°½åœ¨æ­¤,è¯—ä¸è¿œæ–¹è·¯è¿¢è¿¢.

å¹´ç»ˆäº†,å¢¨å®ˆæˆè§„äº¤å‡º2019çš„å¹´ç»ˆæ€»ç»“


## 2019å›é¡¾

ä»Šå¹´äº‹ä»¶å¦‚ä¸‹:


* å·¥ä½œ
* è£…ä¿®
* æ—¥æœ¬ä¹‹æ—…
* ç”Ÿæ´»
* è¯»ä¹¦
* ä¹°æ‘©æ‰˜è½¦
* ä¹°æ±½è½¦
* å¥åº·
*  äº”å¹´è®¡åˆ’
* æ€»ç»“


### å·¥ä½œ

ä»Šå¹´å·¥ä½œå¾ˆç¨³å®š,ä¸€ç›´åœ¨å¿«æ‰‹å¹²æ´»,åªæ˜¯ä»6æœˆä»½å¼€å§‹è¢«è°ƒæ•´å»åšä¸€ä¸ªæ–°çš„app`å¿«æ‰‹æé€Ÿç‰ˆ`,ç›®å‰æ¥çœ‹è¿˜ä¸é”™,ç”±äºå»å¹´æˆ‘æ‰€åœ¨çš„ç›´æ’­å›¢é˜Ÿè·å¾—äº†`ä¸šåŠ¡çªç ´å¥–`.å…¬å¸å‘äº†`500w`çš„å¥–é‡‘,æ˜¾ç„¶è¿™æ²¡æˆ‘ä»¬ä»€ä¹ˆäº‹,åªæ˜¯å‡ºå»å›¢å»ºçš„æ¡£æ¬¡æˆ–è®¸èƒ½æé«˜ä¸€ä¸‹.

ä»Šå¹´æœ‰ä¸€ä»¶æ„‰å¿«çš„äº‹æƒ…æ˜¯æˆ‘åˆ†äº«çš„ä¸€ä¸‹AVAudioSesionç›¸å…³æ–‡ç« ,ç»™ä¸ªå¥–åŠ±,æ¿€åŠ±æˆ‘ä¸æ–­å­¦ä¹ ä¸“ç ”æŠ€æœ¯.

![](/assets/images/20191231FinalSummary/share1.webp)
![](/assets/images/20191231FinalSummary/share2.webp)

> æ„Ÿè°¢æˆ‘æ‰‹å®˜æ–¹,å¦‚æ­¤å…³æ€€å¤‡è‡³.

å…¬å¸åœ¨é€æ¸å£®å¤§,ä¸çŸ¥ä¸è§‰ä¸­å¥½åƒæˆ‘ä¹Ÿæˆäº†ä¸€åè€å‘˜å·¥,æ¯•ç«Ÿæˆ‘æ¥çš„æ—¶å€™å·¥å·1807å·,ç°åœ¨ç›®æµ‹å¾—åˆ°10000+äº†.ä¸ºäº†æ”¯æ’‘å…¬å¸ä¸šåŠ¡,æˆ‘ä¸å¾—ä¸å¬ä»å…¬å¸å®‰æ’åˆ°å…¶å®ƒä¸šåŠ¡çº¿å»åšäº‹æƒ….å¿ƒä¸­æœ‰ä¸€ç§è½å·®æ˜¯ä»ä¸€ä¸ª500wçš„å›¢é˜Ÿå»ä¸€ä¸ªä¸æ˜¯å¾ˆå¥½çš„å›¢é˜Ÿ,å½“æ—¶è¿˜å……æ»¡äº†å„ç§Xæ•°.å³ä¾¿å„ç§å§”å±ˆä¹Ÿåªèƒ½ä½œä¸ºä¸€å—ç –å“ªé‡Œç”¨å“ªé‡Œæ¬,å½“æ—¶å°±è§‰å¾—ä¹Ÿè®¸å¹²ä¸¤ä¸ªæœˆå°±å¾—å‡‰å‡‰,æ²¡æƒ³åˆ°ä¸ä½†æ²¡å‡‰æçš„è¿˜ä¸é”™. åˆšå»å¼€æçš„æ—¶å€™é‚£ç§è¿ç»­å‡ å¤©å·¥ç¨‹ç¼–è¯‘ä¸è¿‡çš„ç—›è‹¦è¿˜æµ®ç°åœ¨è„‘æµ·ä¸­,é‚£ç§ç—›è‹¦å°±æ˜¯è¿™ä¸ªä¸œè¥¿è¦æ˜¯æä¸å®šæ˜å¤©å°±å¾—ç¦»èŒ.

æ·±å¤„è¿™ä¸ªé«˜é£é™©é«˜æ”¶ç›Šé«˜å¤±ä¸šç‡çš„è¡Œä¸šä¸Š,è¿ç»­2å¹´ä»¥ä¸Šä¸æ¢å·¥ä½œå·²ç»å¤ªéš¾äº†.è¿™ä¸ªè¡Œä¸šå‡ ä¹æ¯å¤©æ™šä¸Š12ç‚¹ç¡è§‰æ—©æ™¨9ç‚¹åˆ°å…¬å¸. è¿™çš„ç¡®æ˜¯æ‹¿ç”Ÿå‘½æ¥æ¢é’±,æ¯æ¬¡å»ç†å‘åº—æˆ‘éƒ½è¦æ±‚ç†å‘å°å“¥å…ˆå¸®æˆ‘å‰ªä¸€ä¸‹ç™½å¤´å‘.å¦‚æœä½ æ²¡åšå¥½å¿ƒé‡Œå‡†å¤‡çš„æ—¶å€™æˆ‘ä¸å»ºè®®ä½ é€‰æ‹©ITè¡Œä¸š,å¼€å‘ä¸æ˜¯ä¸€ä»¶å°äº‹æƒ…,å¹²åˆ°ä¸­å¹´ä½ å°±çŸ¥é“å•¥å«å¤±ä¸š.


ä»ç™¾åº¦,é‡‘å±±å†åˆ°å¿«æ‰‹,è¿™å‡ å¹´çš„å˜åŒ–è®©æˆ‘ä¸æ–­äº§ç”Ÿæ–°çš„æƒ³æ³•.
__å¿«æ‰‹æ˜¯æˆ‘åœ¨åŒ—äº¬çš„æœ€åä¸€å®¶å…¬å¸,æ²¡æœ‰å“ªå®¶èƒ½åƒå®ƒä¸€æ ·æ¥åœ°æ°”.__

å°±åœ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™,æˆ‘å‚ä¸å¼€å‘çš„`å¿«æ‰‹æé€Ÿç‰ˆ`å·²ç»ç™»ä¸Šäº†App Store top1.

![](/assets/images/20191231FinalSummary/nebula.webp)

æˆ‘2019å¹´çš„å¹´ç»ˆOKRå°±æ˜¯è¦æŠŠå¿«æ‰‹æé€Ÿç‰ˆé€ä¸ŠApp Store top1çš„å®åº§,ä»Šå¤©å®ç°äº†.

### è£…ä¿®

2019å¹´åˆ å¼€å‘å•†äº¤æˆ¿ä¹‹ååŠç†äº†å…¥æˆ·æ‰‹ç»­,ç„¶åå°±å¼€å§‹å‡†å¤‡ç€æ‰‹è£…ä¿®.å…¥æˆ·çš„æ—¶å€™å¿ƒæƒ…å¾ˆæ¿€åŠ¨æ¯•ç«ŸèŠ±äº†100w+ çš„æˆ¿å­å¼€å‘å•†æ²¡è·‘è·¯,ä¹Ÿæ²¡çƒ‚å°¾. å…¥æˆ·çš„æ—¶å€™éœ€è¦ç¼´çº³å„ç§è´¹ç”¨ 2w+å¤šç‚¹å§.å¼€å‘å•†è¢«æˆ‘ä»¬ä¸šä¸»ç»´æƒç»´çš„è¿˜ç®—è‰¯å¿ƒ,å…é™¤ä¾›çƒ­è´¹å’Œå…¶å®ƒé›¶ç¢çš„è´¹ç”¨å°å‡ åƒå—é’±. ä½†æ˜¯ å…¥æˆ·ä¾èµ–å„ç§é—®é¢˜ æˆ‘å°±ä¸è¯´äº† ä¹°æˆ¿å¦‚æœä½ æœ‰é’± å°±ä¹°åˆ«å¢…,æ²¡é’±å°±ä¹°äºŒæ‰‹æˆ¿,ä¹°æ–°æˆ¿é™¤éä½ è´¢å¯Œè‡ªç”±å’Œæ—¶é—´ç»å†éƒ½å¤š,å¦åˆ™ä½ ä¼šæ…¢æ…¢ä½“ä¼šåˆ°ä»€ä¹ˆå«`ç£¨ç»ƒçµé­‚`.

è£…ä¿®æ˜¯æˆ‘å¥³æœ‹å‹çˆ¶æ¯å¸®å¿™å…¨æƒæçš„,å…¨éƒ¨éƒ½æ˜¯è‡ªå·±å®¶äººåšçš„,ä¸èƒ½è¯´å¤šå¥½,æ¯•ç«Ÿä¸ä¸“ä¸š,ä½†æ˜¯èƒ½ç”¨å°±è¡Œäº† æˆ‘å°±è¿™æ ‡å‡†. å…¨éƒ½ä¸‹æ¥ 17wå¤šå§


ä¸‹å›¾æ˜¯è£…å®Œæœ€åä¸Šç†çŸ³åŒ…å£çš„åœºæ™¯.   
![](/assets/images/20191231FinalSummary/decoration1.gif)  
![](/assets/images/20191231FinalSummary/decoration2.gif)

ä¸‹é¢æ˜¯è£…ä¿®å®Œæœ€åçš„ä¸€å¼ å›¾  
![](/assets/images/20191231FinalSummary/decoration3.gif)

å…·ä½“çš„è£…ä¿®å¥—è·¯æˆ‘å¤§æ¦‚äº†è§£ä¸€äºŒä¾›åç»­è£…ä¿®çš„å„ä½å‚è€ƒ:

1. è§„åˆ’è®¾è®¡
2. æ”¹æ°´æ”¹ç”µ
3. åˆ·å¢™å›ºåœ°å›º(è¿™æ˜¯ä¸€ç§èƒ¶é˜²æ­¢å¢™é¢è…èš€é˜²æ½®é˜²ç¢±çš„ä¸œè¥¿)
4. åŒ…å¥½ä¸‹æ°´ç®¡é“,é™éŸ³æ£‰æ†æ‰
5. åœ°é¢é“ºç –åŒ…å£å¨æˆ¿æ´—æ‰‹é—´ ç“·ç –ä¸Šå¢™
6. é›†æˆåŠé¡¶
7. åˆ·å¤§ç™½å¢™é¢
8. ä¹°å®¶ç”µ å¨æˆ¿ é›†æˆç¶è¿˜æ˜¯å¸æ²¹çƒŸæœºç¶å°.
9. å¨æˆ¿æ©±æŸœ,å§å®¤æœ¨æŸœç­‰ç­‰ æœ¨å·¥çš„æ´»
10.æœ¨é—¨å®šåˆ¶
11.ç†çŸ³åŒ…å£ã€åŒ…æ‹¬å¨æˆ¿ç¶å°æ¿ã€è¿‡é—¨çŸ³ã€åœ°è„šçº¿ç­‰ 
12. æ”¶å·¥å‡†å¤‡å¼€å§‹ä¹°å„ç§å®¶ç”µæ²™å‘æ´—è¡£æœº å†°ç®±ç”µè§†ç­‰ç­‰.

åŸºæœ¬å°±æ˜¯ä¸Šè¿°å¥—è·¯ ä¸å®Œå–„å“ˆ.

##### è£…ä¿®éœ€è¦æ³¨æ„çš„åœ°æ–¹

> æœ€é‡è¦çš„æ˜¯ç†çŸ³åŒ…å£,æˆ‘å®¶ç”¨çš„æ¯”è¾ƒè´µ,å®¶é‡Œäº²æˆšå¹²çš„ å¾—10000+å·¦å³æ•´ä½“,å› ä¸ºæˆ‘åœ°è„šçº¿éƒ½ç”¨çš„å¤©ç„¶çŸ³,è¿™ç©æ„å¤ªè´µäº† 260+/m,ä¸è¿‡ç¡®å®å¥½çœ‹,æˆ‘å»ºè®®å¤§å®¶æŠŠçª—å£ç”¨è¿™ç§é«˜æ¡£çš„ç†çŸ³åŒ…è£¹ä¸Š,è¸¢è„šçº¿ç”¨ä¸€äº›ä¾¿å®œçš„å‡ åå—é’±çš„æ¸¯çŸ³å°±è¡Œäº†,è¿™æ ·çœ‹èµ·æ¥é«˜æ¡£è¿˜ä¸è´µ.

#### é¢†æˆ‘æ„ŸåŠ¨çš„ä¸€ä»¶äº‹

æˆ‘åœ¨å¿«æ‰‹ä¸Šå…³æ³¨ä¸€ä¸ªå«`åå›¾èŠè£…ä¿®`çš„å¤§é¾™å“¥,è¿™ä¸ªç”¨æˆ·æˆ‘ä»¬ç»å¸¸èŠå¤©,èŠå¿«æ‰‹,ä½œä¸ºä¸€ä¸ªiOSç ”å‘æˆ‘èƒ½åšçš„å°±æ˜¯æŠŠappåšå¥½,ä¿è¯ä¸»æ’­å’Œè§‚ä¼—èƒ½é¡ºç•…çš„ä½¿ç”¨å¿«æ‰‹å¼€æ’­æˆ–è€…çœ‹ç›´æ’­ä¸šåŠ¡,è¿™æ˜¯æˆ‘çš„å·¥ä½œ,è¿™ä¸ªä¸»æ’­è·Ÿæˆ‘è¯´ å¦‚æœæ²¡æœ‰å¿«æ‰‹ æˆ‘çš„è£…ä¿®å…¬å¸æœ‰å¯èƒ½ä»Šå¹´å°±å¹²é»„äº†,æ„Ÿè°¢å¿«æ‰‹å®˜æ–¹æ¯ä¸ªæœˆèƒ½è®¤è¯†å‡ ä¸ªè€é“æ¥æ‰¾ä»–è£…ä¿®. æˆ‘çªç„¶æ„Ÿè§‰æˆ‘åœ¨çš„è¿™å®¶å…¬å¸æ˜¯æœ‰æ¸©åº¦çš„,ä»–æ‹¯æ•‘äº†è‡³å°‘æˆ‘çœ‹åˆ° è¿™æ ·ä¸€å®¶å°çš„ä¼ä¸š.

è¿™é‡Œä¸æ˜¯æ‰“å¹¿å‘Š æ˜¯æˆ‘è§‰å¾—ä»–å¹²è£…ä¿®æ¯”æˆ‘ä¸Šé¢è¯´çš„è¦ä¸“ä¸š,å¤§å®¶æ‰¾ä¸æ‰¾ä»–æ— æ‰€è°“,æˆ‘è§‰å¾—åªè¦å¤§å®¶æƒ³è£…ä¿®çš„æ—¶å€™ä¸è¢«å‘å¤šå­¦ä¹ å­¦ä¹ è¿™äº›æ–¹é¢çš„çŸ¥è¯†å¾ˆé‡è¦, ä»–çš„å¿«æ‰‹å·å¤§å®¶æ‰“å¼€å¿«æ‰‹æœç´¢å³å¯.



### æ—¥æœ¬ä¹‹æ—…

ä»Šå¹´äº”ä¸€ä»¥å,ç›´æ’­å›¢é˜Ÿè¿æ¥äº†ç¬¬ä¸€æ¬¡å›¢å»º,ç»è¿‡å¤§å®¶æŠ•ç¥¨å†³å®šå»æ—¥æœ¬,ä½†æ˜¯æ¯ä¸ªäººéœ€è¦è‡ªå·±è¡¥è´´è´¹ç”¨è‡³å°‘5000+ä»¥ä¸Š,ç”±äºä»¥å‰ä¹Ÿç»å†è¿‡è¿™æ ·çš„äº‹æƒ…,æ²¡æœ‰ä¹°æˆ¿,æ‰€ä»¥å½“æ—¶ä¹Ÿæ²¡æ•¢æŠ¥å,ç°åœ¨æ‰“ç®—å‡ºå»çœ‹çœ‹,é•¿é•¿è§è¯†.çœ‹çœ‹èµ„æœ¬ä¸»ä¹‰.

åŒ—äº¬é¦–éƒ½å›½é™…æœºåœºç›´é£æ—¥æœ¬ä¸œäº¬ç¾½ç”°æœºåœº

![](/assets/images/20191231FinalSummary/japen_travel1.webp)

> å‡ºä¹æˆ‘æ„æ–™çš„æ˜¯è¿™é£æœºæ˜¯æ²¿ç€æœé²œå’ŒéŸ©å›½çš„38çº¿é£è¿‡å»çš„.

åˆ°è¾¾ä¸œäº¬åå¤§å·´,æ—¥æœ¬çš„è½¦ç‰Œè®©æˆ‘éœ‡æƒŠäº†

![](/assets/images/20191231FinalSummary/japen_travel2.webp)

ç®€å•å‡ ä¸ªæ•°å­—å°±èƒ½ä»£è¡¨ä¸€ä¸ªè½¦ç‰Œ.

ä¸Šè½¦å æˆ‘å‘ç°ä¸€ä¸‹éå¸¸å®ç”¨çš„è®¾è®¡ å¤§å·´çš„æ¯æ¶

![](/assets/images/20191231FinalSummary/japen_travel4.gif)

ä¸è¯´å’±å´‡æ´‹åªšå¤–,å°±è¯´è¿™ç©æ„ä¸ºå•¥å›½å†…å…¬äº¤è½¦æ²¡æœ‰å§!è¿™ç©æ„åˆæ²¡æŠ€æœ¯å«é‡,è¿™ä¹ˆäººæ€§åŒ–è®¾è®¡ç®€ç›´å¤ªéš¾å¾—äº†.


ä¸œäº¬æ¹¾çš„æ¸¯å£ä»¥åŠå·¥å‚åŸºæœ¬è¯´æ˜äº†,æ—¥æœ¬ä¹‹æ‰€ä»¥å‘è¾¾çš„åŸå› 

![](/assets/images/20191231FinalSummary/japen_travel5.gif)

æ—¥æœ¬å±äºè‹±è”é‚¦å›½å®¶,é“è·¯å·¦ä¾§é€šè¡Œ,ä¸€è¾†è¾†å¡è½¦æ“¦çš„é”ƒäº®.


![](/assets/images/20191231FinalSummary/japen_travel6.webp)

å³èˆµçš„å¸æœºä½ç½®, æˆ‘åªå¬è¿‡ æ—¥æœ¬å¸æœºæˆ´ç™½æ‰‹å¥—,è¿™å›è§åˆ°äº†. æˆ‘è¿˜è§åˆ°äº† è¿™å¸æœºæŠŠç›¸åŒé¢œè‰²çš„è¡Œæç®±åˆ†ç»„æ‘†æ”¾,è¿™ç‚¹çœŸæ˜¯ä¸ä¸€æ ·,æ–¹ä¾¿è‰²ç›²çš„æ¸¸å®¢å¿«é€Ÿæ‰¾åˆ°è‡ªå·±çš„è¡Œæç®±.


å»çš„ç¬¬ä¸€ä¸ªæ™¯ç‚¹æ˜¯`å¹³å’Œå…¬å›­`,æ²¡æœ‰æ‹ç…§å¯æƒœäº†,ç©ºæ°”æ¹¿åº¦å¾ˆå¥½. ä»éšå¤„å¯è§çš„è´è¶å°±èƒ½çœ‹å‡ºæ¥,ç¯å¢ƒä¸é”™.

![](/assets/images/20191231FinalSummary/japen_travel7.gif)

åˆ°è¾¾`å±±æ¢¨å¿`æ¸©æ³‰é…’åº— 

![](/assets/images/20191231FinalSummary/japen_travel9.webp)

è¿™ä¸ªå°å¿é‡Œçš„è¯å¦†åº—

![](/assets/images/20191231FinalSummary/japen_travel10.webp)

è®©æˆ‘æ„Ÿåˆ°èµ„æœ¬ä¸»ä¹‰è½åç¤¾ä¼šä¸»ä¹‰å…´ç››çš„å”¯ä¸€å®¢è§‚ç‰¹å¾æ˜¯`ç”µçº¿æ†å­`åœ¨æ—¥æœ¬éšå¤„å¯è§.

æ—¥æœ¬å±±æ¢¨å¿äº¤è­¦é˜Ÿ

![](/assets/images/20191231FinalSummary/japen_travel8.webp)


æ—¥æœ¬çš„é€é¤æ‘©æ‰˜è½¦

![](/assets/images/20191231FinalSummary/japen_travel11.webp)

çœ‹è¿™æ•´é½çš„è½¦é˜Ÿ,æ¯”èµ·å›½å†…çš„é€é¤è½¦é™¤äº†ä¸ç¯ä¿ä»¥å¤–,å…¶å®è¿˜æ˜¯å¾ˆæ¿æ­£çš„. å•¥æ—¶å€™å›½å†…èƒ½è¿™æ ·æ•´é½çš„é…å¤‡é€é¤å·¥å…·è½¦é‚£æˆ‘çš„ç¥–å›½åŸºæœ¬å·²ç»è¿›å…¥äº†å‘è¾¾å›½å®¶çš„è¡Œåˆ—.è¿™ç§è½¦åœ¨æ—¥æœ¬è¢«æˆä¸º`å¤§è„šæ‘©æ‰˜`.å‰é¢è¿˜æ˜¯åˆ†ä½“å¼ç‹¬ç«‹æ‚¬æŒ‚è®¾è®¡.å¤‡ç®±è‡³å°‘èƒ½é€è¶…è¿‡20äººçš„é¤é£Ÿå§,ä¸€ç®±æ²¹200å…¬é‡Œ.  ç®€ç›´å°±æ˜¯å‘è¾¾å›½å®¶çš„æ ‡é….

æ—¥å¼æ¸©æ³‰é…’åº—

![](/assets/images/20191231FinalSummary/japen_travel12.webp)

è¢«å­å èµ·æ¥å°±æ¡Œå­ä¸€æ”¾å°±èƒ½åƒé¥­ ï¼Œçœç©ºé—´ çœåœ°æ–¹,æ˜¯æŒºæ–¹ä¾¿.

ç¬¬äºŒå¤©å»å¯Œå£«å±±,å¯Œå£«å±±æ å½±

![](/assets/images/20191231FinalSummary/japen_travel13.webp)

å›æ¥çš„è·¯ä¸Š,çœ‹åˆ°æ¯å®¶æˆ¿å‰å±‹åéƒ½æœ‰å‡ ç½ç‡ƒæ°”.

![](/assets/images/20191231FinalSummary/japen_travel14.webp)

æ—¥æœ¬çš„å±…æ°‘ç”¨è½¦`K-CAR` å®ƒä¸èƒ½è¶…è¿‡660ccæ’é‡.å°åˆ°éå¸¸å®ç”¨.

![](/assets/images/20191231FinalSummary/japen_travel15.webp)

å¿é‡å…«æµ· æ¸…æ¾ˆçš„æ± å¡˜,è®©æˆ‘ä¸ç¦æƒ³èµ· æ¯›çˆ·çˆ·çš„é‚£å¥**é¹°å‡»é•¿ç©ºé±¼ç¿”æµ…åº•**

![](/assets/images/20191231FinalSummary/japen_travel20.webp)

ä¸‹åˆæˆ‘ä»¬æŠµè¾¾ä¸œäº¬  å» å¤©çš‡çš‡å±…å¤–é¢å‚è§‚

![](/assets/images/20191231FinalSummary/japen_travel16.webp)

> ä»–å«[æ¥ æœ¨æ­£æˆ](https://baike.baidu.com/item/%E6%A5%A0%E6%9C%A8%E6%AD%A3%E6%88%90),ç›¸å½“äºæ—¥æœ¬çš„è¯¸è‘›äº®. æ—¥æœ¬ä¹Ÿæœ‰ç±»ä¼¼æˆ‘ä»¬çš„ä¸‰å›½æ—¶æœŸè¢«ç§°ä¸º[æˆ˜å›½æ—¶ä»£](https://baike.baidu.com/item/%E6%A5%A0%E6%9C%A8%E6%AD%A3%E6%88%90)1467â€”1585å¹´æˆ–1615å¹´,ä¹Ÿå°±æ˜¯ ä¸°è‡£ç§€å‰ã€ç»‡ç”°ä¿¡é•¿ã€å¾·å·å®¶åº· ,æœ€åä»¥å¾·å·å¹•åºœå–å¾—æœ€ç»ˆçš„èƒœåˆ©å»ºç«‹ä»Šå¤©çš„æ—¥æœ¬å¤©çš‡æ—¶ä»£.


è¡Œç¨‹çš„ç¬¬ä¸‰å¤©æˆ‘ä»¬è‡ªç”±è¡Œ æ¥åˆ°çš„  æ—¥æœ¬ä¸œäº¬ç¹åçš„æ¥å¤´`æ–°å®¿`

![](/assets/images/20191231FinalSummary/japen_travel19.webp)

æ—¥æœ¬çš„è¡—å¤´  äººè¡Œæ¨ªé“åŸæ¥æ˜¯ æ¨ªå‘ ç«–å‘ å¯¹è§’éƒ½å¯ä»¥.

ç¬¬ä¸‰å¤©æˆ‘ä»¬è‡ªç”±è¡Œ æ™šä¸Šå»äº†`å…­æœ¬ç›®ä¹‹ä¸˜`,ä¿¯ç°ä¸œäº¬å¡”å’Œç¹åçš„ä¸œäº¬å¤œæ™¯

![](/assets/images/20191231FinalSummary/japen_travel18.webp)

æœ€åä¸€å¤© å»ä¸œäº¬æ¸¯ çœ‹ä¸€çœ‹ æ›¾ç»æ—¥æœ¬åœ¨ç¾å›½å†›èˆ°å¯†è‹é‡Œå·ä¸Šç­¾å­—å®£å¸ƒæ— æ¡ä»¶æŠ•é™çš„ä¸œäº¬æ¹¾.

![](/assets/images/20191231FinalSummary/japen_travel17.webp)

ç”±äºç¯‡å¹…è¾ƒé•¿ è¿™é‡Œç®€çŸ­çš„ä»‹ç»åˆ°è¿™é‡Œ.

#### æ€»ç»“æ—¥æœ¬ä¹‹æ—…-å»ºè®¾å¥½æˆ‘çš„ç¥–å›½

å»äº†ä¸€è¶Ÿé¡¿æ„Ÿæ·±æ·±çš„è¢«èµ„æœ¬ä¸»ä¹‰æ•™è‚²äº†, æ—¥æœ¬çš„è¡—å¤´é³æ¬¡æ ‰æ¯”çš„æˆ¿èˆ,æ•´é½çš„é€é¤æ‘©æ‰˜,å¹²å‡€ç›´é¥®çš„è¡—å¤´æ°´é¾™å¤´,æ±¡æ°´æ²Ÿçš„æ°´æ¸…æ¾ˆè§åº•,æˆ¿å‰å±‹åçš„æ¸…æ´ç‡ƒæ°”,æ’é‡ä¸è¶…è¿‡ 660ccçš„å®¶ç”¨è½¦,åƒåœ¾åˆ†ç±»æ¡¶,ä¸œäº¬æ¹¾æ°´é™†ä¸¤æ –çš„å…¬äº¤è½¦,æ–°å®¿è¡—å¤´æ¨ªå‘å¯¹è§’çš„äººè¡Œæ¨ªé“. æ— è®ºå“ªé‡Œéƒ½é€æ¼å‡ºæ—¥æœ¬äººç¯ä¿å’Œä»¥å®ç”¨ä¸ºåŸåˆ™çš„ç”Ÿæ´»åŸåˆ™. éå¾å´‡æ´‹åªšå¤–,ç¡®å®å¾—å¸ˆå¤·é•¿æŠ€,å°æƒ³æ­¤å¤„çš†å—çµé­‚ä¹‹è€ƒé—®,æˆ‘å›½å°šå¤„ç¤¾ä¼šä¸»ä¹‰åˆçº§é˜¶æ®µ,æ—¥æœ¬çš„ç§»åŠ¨ç½‘ç»œå»ºè®¾ä¸æ€ä¹ˆå¥½,äº’è”ç½‘å‘å±•ä¸å¦‚æˆ‘ä»¬,ç§»åŠ¨æ”¯ä»˜ä¸å¦‚æˆ‘ä»¬,ç”µåŠ¨æ±½è½¦ä¸å¦‚æˆ‘ä»¬,è¿™äº›éƒ½æ˜¯ä»Šå¤©çš„æ—¥æœ¬éœ€è¦åƒæˆ‘ä»¬å­¦ä¹ çš„.æ—¥æœ¬å¤§å¤šæ•°äººéƒ½è®¤ä¸ºä¸­å›½çš„é‚“å°å¹³çš„æ”¹é©å¼€æ”¾æ²¡æœ‰é”™,è¿™æ˜¯ä¸€ä¸ªã€é‡‘é’±è‡³ä¸Šã€çš„ç¤¾ä¼š,æ—¥æœ¬ä¹Ÿä¸€æ ·.æˆ‘ç›¸ä¿¡åœ¨æœªæ¥10~20å¹´ä¸­å›½çš„ä¸€å®šèƒ½è¶…è¿‡æ—¥æœ¬

ç»è¿‡äº†è¿™æ¬¡æ—¥æœ¬ä¹‹æ—…æ·±æ·±åœ°æ•™è‚²äº†æˆ‘,ä¸€å®šè¦å»ºè®¾å¥½æˆ‘çš„ç¥–å›½,è¦ä»è‡ªå·±æ“…é•¿çš„ä¸“ä¸šæŠ“æ‰‹åšèµ·,åšåˆ°æè‡´è¿™å°±æ˜¯å¯¹å›½å®¶å’Œäººæ°‘çš„è´¡çŒ®.æˆ‘çš„æ—…è¡Œä¸æ˜¯èµ°é©¬è§‚èŠ±,æˆ‘çš„ç…§ç‰‡å°±æ˜¯è®°å½•å†å².

### ç”Ÿæ´»

ä»Šå¹´åŒ—æ¼‚å·²ç»è¿‡äº†ç¬¬6ä¸ªå¹´å¤´äº†,åœ¨åŒ—äº¬çš„ç”Ÿæ´» è™½ç„¶å·¥èµ„é«˜å¾ˆå¤š,ä½†æ˜¯æˆ‘è¿‡çš„å¾ˆå‹æŠ‘,è¿™ç§å‹æŠ‘æ„Ÿå‰æ‰€æœªæœ‰,æˆ‘å¯ä»¥è¿™æ ·è¯´,æˆ‘æ¯å¤©é™¤äº†å·¥ä½œè¿æ”¾å‡éƒ½ä¸çŸ¥é“å»å“ªé‡Œ,æ²¡æœ‰ä¸€ç‚¹ä¹è¶£,è¿™ç§çŠ¶æ€æ¯å¤©éƒ½åœ¨æŒç»­.ä¸šä½™çˆ±å¥½ä¸æä¹Ÿç½¢,å¹´ç»ˆçš„æ—¶å€™å·¥ä½œå‡ ä¹å¿™åˆ°å›å®¶èµ°è·¯éƒ½èƒ½ç¡ç€.ç¡ä¸ç€è§‰çš„æ—¶å€™éƒ½åœ¨è€ƒè™‘è¿™æ˜¯ä¸æ˜¯æˆ‘åœ¨ åŒ—äº¬çš„æœ€åä¸€å‘¨.åŒ—æ¼‚ä¸å€¼å¾—,æ²¡åšå¥½å……åˆ†çš„å‡†å¤‡ä¸è¦æ¥,é™¤éä½ è¢«ç”Ÿæ´»é€¼çš„èµ°æŠ•æ— è·¯.

ä»ç°åœ¨30å²çœ‹6å¹´å‰çš„è‡ªå·±é‚£è‚¯å®šæ˜¯å¼ºå¤šäº†,ä½†è¦æ˜¯çœ‹5å¹´å‰ã€4å¹´å‰ã€3å¹´å‰çš„è‡ªå·±,æ²¡æœ‰æœ€å·®åªæœ‰æ›´å·®.æˆ‘ä¸æƒ³æˆä¸ºæˆ¿å¥´,å¸Œæœ›2020èƒ½å½»åº•æ‹œæ‰˜æˆ¿å¥´çš„èº«ä»½,è´·æ¬¾ç›®å‰è¿˜å‰©10wå°±å…¨éƒ¨è¿˜å®Œäº†.è¿˜å¾—æ’¸èµ·è¢–å­åŠ æ²¹å¹².

ä»Šå¹´æŠŠæˆ·å£è¿åˆ°äº†å“ˆå°”æ»¨.ä»æ­¤è„±ç¦»å†œæ‘æˆ·å£,è¿˜æ˜¯å‰å‡ å¹´æˆ‘çš„å¹´ç»ˆæ€»ç»“é‡Œè¯´çš„,æˆ·å£å¯¹äºæˆ‘ä»¬è¿™æ ·çš„å¹´è½»äººç®€ç›´å¤ªé‡è¦äº†,ä½ æ²¡å†œæ‘æˆ·å£ä½ æ°¸è¿œç†è§£ä¸äº†å•¥å«å°å†œç»æµçš„æ€æƒ³çš„æ€æƒ³æ ¹æ·±è’‚å›º,å¹¶ä¸”å½¢æˆä¸€å®šçš„æ€ç»´å®šåŠ¿ä»¥åä½ å°±ä¸æƒ³æŠŠæˆ·å£è¿ç§»åˆ°åŸå¸‚é‡Œ.åŸå¸‚æˆ·å£å¯¹å¹´è½»äººä¹°æˆ¿è´·æ¬¾ã€å­å¥³å…¥å­¦ã€ç¤¾ä¼šæœåŠ¡ä½“ç³»ç­‰å¤ªé‡è¦äº†.__å°æ—¶å€™åœ¨å†œæ‘ç”Ÿæ´»ï¼Œæ€»å¬åˆ°ä»€ä¹ˆåŠ³åŠ¨äººæ°‘å¾ˆå…‰è£ï¼Œå†œæ°‘å¾ˆå…‰è£ï¼Œå¯æ˜¯æˆ‘æ²¡è§å“ªä¸ªåŸé‡Œäººå›æ¥å½“å†œæ°‘ï¼Œå†œæ°‘ä¸æ˜¯å…‰è£å—ï¼Ÿä»–ä»¬æ€ä¹ˆä¸å›æ¥åšä¸€äº›å…‰è£çš„äº‹æƒ…å‘¢ï¼Ÿé•¿å¤§åæ˜ç™½äº†ä»–ä»¬ä¸å¯èƒ½ä¸å…‰è£ï¼Œå› ä¸ºä»–ä»¬ç”Ÿæ´»åœ¨ç¤¾ä¼šåº•å±‚ï¼Œä½ è¯´ä»–ä»¬ä¸å…‰è£é‚£æ˜¯é˜¶çº§æ­§è§†ï¼Œå¯æ˜¯å¤§å®¶å¹²çš„äº‹éƒ½æ˜¯åŸé‡Œäººçš„äº‹ï¼Œè°æ„¿æ„å›å»ç§åœ°.__

è¿ç§»æˆ·å£çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™æ ·çš„

1. æä¾›èº«ä»½è¯ åŸä»¶+å¤å°ä»¶
2. æä¾›æˆ·å£ æˆ·ä¸»é¡µå’Œæœ¬äººé¡µ+æˆ·ä¸»é¡µå¤å°ä»¶+æœ¬äººé¡µå¤å°ä»¶
3. æä¾›å­¦å†è¯ä¹¦ åŸä»¶+å¤å°ä»¶ å¹¶ä¸”æä¾›å­¦å†æŸ¥è¯¢äºŒç»´ç ä¹Ÿå°±æ˜¯å»å­¦ä¿¡ç½‘æŸ¥è¯¢çš„ç¡®è®¤å•
4. è´­æˆ¿åˆåŒåŸä»¶+å¤å°ä»¶
5. è´­æˆ¿å‘ç¥¨åŸä»¶
6. æˆ‘çš„å°åŒºæ˜¯çˆ±è¾¾88è¦å»å—å²—åŒºç‹å²—æ´¾å‡ºæ‰€
7. æ‰¾æˆ·ç±æ°‘è­¦ æ•´ç†ææ–™å‡ºå…·è¿ç§»æ„è§
8. æ‰¾æ´¾å‡ºæ‰€æ‰€é•¿ç­¾å­—
9. åˆ°æŸœå°åŠç†
10. æˆ‘é¡ºé“æŠŠèº«ä»½è¯ä¹Ÿä¸€èµ·æ¢äº†åœ°å€
>  å¦‚æœæ˜¯æœ¬çœåŸºæœ¬ä¸éœ€è¦å‡†è¿è¯ ç›´æ¥è¿ç§»ä¸ç”¨å›åŸç±,å¦‚æœæ˜¯å¤–çœåˆ™éœ€è¦åœ¨åŸç±æ´¾å‡ºæ‰€åŠç†ç”³è¯·è¿å‡ºæ‰‹ç»­,ç„¶ååˆ°æƒ³è¿å…¥åœ°çš„æ´¾å‡ºæ‰€åŠç†æ¥æ”¶æ‰‹ç»­.æ“ä½œå¾ˆè´¹äº‹è¿˜å¾—ä¸¤åœ°æŠ˜è…¾.

æ•´å¥—æˆ·å£åŠç†å®Œéœ€è¦2ä¸ªå°æ—¶å·¦å³,èº«ä»½è¯å¤§æ¦‚éœ€è¦åŠä¸ªæœˆä»¥ä¸Š

èº«ä»½è¯åŠç†å®Œåˆ°æˆ‘å›åˆ°åŒ—äº¬,æŠŠæ‰€æœ‰ç”¨åˆ°çš„å„ç§è¯ä»¶é“¶è¡Œå¡ã€æ”¯ä»˜å®å¾®ä¿¡ã€å·¥ä½œå±…ä½è¯ã€å±…ä½è¯ç­‰ç­‰å…¨éƒ¨åŠç†äº†æ›´æ–°èº«ä»½ä¿¡æ¯çš„æ“ä½œ.

å…¨å¥—åŠç†ä¸€åœˆå‘ç°æ¢ä¸ªæˆ·å£æ¢ä¸ªèº«ä»½è¯å¤ªéº»çƒ¦äº†.

### è¯»ä¹¦

ä»Šå¤©å‡ ä¹æ²¡æœ‰å¤ªå¤šæ—¶é—´è¯»ä¹¦äº†,çœ‹çš„æœ€å¤šçš„æ˜¯è¿ˆè…¾ç»´ä¿®è¯´æ˜ä¹¦

ä¹°äº†è°­æµ©å¼ºæœ€æ–°å‡ºçš„Cç¨‹åºè®¾è®¡

![](/assets/images/20191231FinalSummary/cprogram.webp)

ä¹°äº†é¸Ÿå“¥æœ€æ–°å‡ºçš„linux

![](/assets/images/20191231FinalSummary/LinuxNew.webp)

è¿™ä¸¤æœ¬ä¹¦åŸºæœ¬é™ªæˆ‘èµ°è¿‡äº†ä¸€åŠçš„èŒä¸šç”Ÿæ¶¯,å®¶é‡Œè£…ä¿®å®Œäº†,è¿™äº›ä¹¦éƒ½è¦æ”¾åˆ°ä¹¦æ¶ä¸Šçè—èµ·æ¥.
æ®è¯´æœ€æ–°ç‰ˆæœ¬çš„linuxä½¿ç”¨çš„å·²ç»ä¸æ˜¯centos6äº†,æ˜¯centos7æ“ä½œç³»ç»Ÿäº†.æœ‰æ—¶é—´æŠŠæ ‘è“æ´¾è£…ä¸Š,æ„Ÿè§‰å¾ˆæ£’.

### ä¹°æ‘©æ‰˜è½¦

2019å¹´åŒ—äº¬å‡ºäº†é™åˆ¶æ€§æ”¿ç­–,è¯´ä¸ç¬¦åˆæ ‡å‡†çš„ç”µåŠ¨è½¦2å¹´åç¦æ­¢ä¸Šè·¯,äºæ˜¯æˆ‘æŠŠæˆ‘çš„å°ç‰›N1så–äº†,æ¢äº†ä¸€è¾†æ‘©æ‰˜è½¦ä»£æ­¥,ä¸ºäº†æ‘©æ‰˜åˆç°å»æµ·æ·€é©¾æ ¡å¢é©¾çš„æ‘©æ‰˜è½¦.

![](/assets/images/20191231FinalSummary/motocycle1.webp)
![](/assets/images/20191231FinalSummary/motocycle2.webp)

ä¹°ä¸ªè¸æ¿å°±å¤Ÿç”¨äº†, è¿™æ‘©æ‰˜å« django 150(å§œæˆˆ) ,æ˜¯æµå—è½»éª‘åˆ¶é€ .ç›®å‰å®‰å…¨éª‘è¡Œ3000å…¬é‡Œ,æ²¡æœ‰ä»»ä½•é—®é¢˜,ä»·æ ¼2w+.ä¹°è½¦çš„æ—¶å€™æ­£å¥½èµ¶ä¸Šå›½å®¶æ‰§è¡Œ150ccä»¥ä¸‹æ’é‡çš„æ‘©æ‰˜è½¦å…ç¨.è¿™è¾†è½¦å¸Œæœ›èƒ½éª‘å›å“ˆå°”æ»¨.ç”¨ä»¥çºªå¿µåŒ—äº¬å·¥ä½œçš„è¿™å‡ å¹´.

å¦‚æœä½ å¯¹æ‘©æ‰˜è½¦ä¸äº†è§£å¯ä»¥ä¸‹è½½ä¸ªå«`å“ˆç½—æ‘©æ‰˜`çš„appçœ‹ä¸‹ å°±äº†è§£äº†.

ä¸ºäº†å¢é©¾æ‘©æ‰˜è½¦,åˆä»ç§‘ç›®ä¸€è€ƒåˆ°ç§‘ç›®å››,ä»æŠ¥è€ƒåˆ°ç»ƒè½¦å†åˆ°æ‹¿æœ¬ç”¨æ—¶11å¤©.éå¸¸åˆ°ä½,ä¸è¿‡å¤å¤©ç»ƒæ‘©æ‰˜è½¦æ˜¯çœŸçƒ­

æ‘©æ‰˜è½¦(2è½®)ç§‘ç›®äºŒ ç»ƒä¹   
![](/assets/images/20191231FinalSummary/drivin_license_exam1.gif)

æ‘©æ‰˜è½¦(3è½®)ç§‘ç›®äºŒ ç»ƒä¹   
![](/assets/images/20191231FinalSummary/drivin_license_exam2.gif)

##### æ‘©æ‰˜è½¦è€ƒè¯•æµç¨‹

* ç§‘ç›®ä¸€ç†è®º
	1. 100é“é¢˜
* ç§‘ç›®äºŒ
	1. èµ·æ­¥
	2. å®šç‚¹åœè½¦å¡é“èµ·æ­¥
	3. å•è¾¹æ¡¥
	4. ç»•æ¡©
* ç§‘ç›®ä¸‰ä¸Šè·¯å®æµ‹
	1. äººè¡Œæ¨ªé“å‡é€Ÿ
	2. è°ƒå¤´
	3. æ¢æ¡£åŠ é€Ÿ
	4. æ‰“å¼€å³è½¬å‘ç¯å‡é€Ÿåœè½¦
* ç§‘ç›®å››ç†è®º
	1. 100é“é¢˜


å¦‚æœæ˜¯æŠ¥è€ƒä¸‰è½®æ‘©æ‰˜çš„é©¾é©¶æœ¬åè¾¹æ˜¯D,ä¸¤è½®æ‘©æ‰˜è½¦æ˜¯E, Då‘ä¸‹å…¼å®¹,ä¹Ÿå°±æ˜¯è¯´ä½ è€ƒå®ŒDæœ¬ç›´æ¥å°±èƒ½å¼€2è½®æ‘©æ‰˜.

å¦‚æœä½ æ˜¯Cæœ¬ æ¯”å¦‚:C1 å½“ä½ è€ƒå®Œ2è½®æ‘©æ‰˜è½¦ä½ çš„é©¾é©¶æœ¬ä¼šå˜æˆ C1Eæˆ–è€…C2E,  (C1ä»£è¡¨æ‰‹åŠ¨æŒ¡,C2ä»£è¡¨è‡ªåŠ¨æŒ¡),åŸæ¥çš„é©¾é©¶æœ¬å›æ”¶é‡æ–°å°å‘æ–°çš„é©¾é©¶æœ¬å¹¶ä¸”åŒºåˆ†Eæˆ–è€…Dæ˜¯å®ä¹ æœŸåˆ°å¤šä¹….åŸºæœ¬é—®é¢˜éƒ½ä¸å¤§,å®ä¹ æœŸä¸èƒ½ä¸Šé«˜é€Ÿ.

å…¶å®ƒçš„Aæœ¬æˆ–è€…Bæœ¬ä¸çŸ¥é“,æ²¡æµ‹è¯•è¿‡å¤§å®¶å¯ä»¥ç½‘ä¸ŠæŸ¥æŸ¥.

å…³äºæ‰£åˆ†,å½“ä½ æ‹¥æœ‰ C1Eçš„æ—¶å€™ ä½ è¦å€åŠ å°å¿ƒ, å› ä¸ºä½ ä¸€å…±æ‹¥æœ‰12åˆ†ä¸åŒºåˆ† Cè¿˜æ˜¯Eè¿˜æ˜¯Dï¼Œåªè¦ä½ å¼€è½¦æ‰£åˆ†æ˜¯ä¸€æ ·çš„,æ‹¥æœ‰ä¸€è¾†è½¦å’Œä¸€è¾†æ‘©æ‰˜è½¦å’Œä½ æœ‰ä¸¤è¾†æ±½è½¦æ˜¯ä¸€æ ·çš„å°±æ˜¯12åˆ†å¤šä¸€åˆ†æ²¡æœ‰,å¦‚æœä½ éª‘æ‘©æ‰˜è½¦æ‰£äº†12åˆ†é‚£ä½ æ±½è½¦å°±åˆ«æƒ³å¼€äº†,èµ¶ç´§å‡†å¤‡è€ƒè¯•ç§‘ç›®ä¸€ç§‘ç›®å››.

æ‘©æ‰˜è½¦ç§‘ç›®äºŒä¹Ÿä¸é‚£ä¹ˆå®¹æ˜“è¿‡,ä¸­é€”æ¯”å¦‚ç»•æ¡©ã€å•è¾¹æ¡¥åªè¦è„šç‚¹åœ°å°±ç®—ä¸åˆæ ¼è€ƒè¯•å¤±è´¥, å¡é“èµ·æ­¥æœ€å¤šåœç•™30ç§’å¹¶ä¸”è„šåªå…è®¸ç‚¹ä¸€æ¬¡åœ°é¢.

### ä¹°æ±½è½¦

å¯¹äºä¸€ä¸ªæ‹¿é©¾ç…§2å¹´å¤šçš„æˆ‘è¿˜ä»æœªå°è¯•æ­£ç»å¼€è¿‡è½¦,æ²¡æœ‰è½¦ç»ƒä¹ æ€•ä»¥åç”¨åˆ°çš„æ—¶å€™æ‰‹è¶³æ— æª,ä»Šå¹´æ²¡æƒ³åˆ°ç»è¿‡åŒå­¦ä»‹ç»ç¢°åˆ°äº†ä¸€ä¸ªåˆé€‚çš„äºŒæ‰‹è½¦,è½¦å†µä¸é”™.äºæ˜¯åé£æœºå›å»å°±ä¹°äº†.

![](/assets/images/20191231FinalSummary/magotan1.webp)
![](/assets/images/20191231FinalSummary/magotan2.webp)
![](/assets/images/20191231FinalSummary/magotan3.webp)
![](/assets/images/20191231FinalSummary/magotan4.webp)

ä»–å«`è¿ˆè…¾`B7L,2013å¹´12æœˆå·¦å³å‡ºå‚çš„ç¬¬7ä»£è¿ˆè…¾(ç›®å‰æœ€æ–°å‡ºçš„æ˜¯è¿ˆè…¾B8.5åè¾¹å¸¦å­—æ¯)æˆ‘æ¥æ‰‹å‰ è¿™è½¦å®è¡¨è·‘äº†8wå·¦å³.å…¨è½¦4såº—ä¿å…»,æ²¡å‡ºè¿‡å¤§æ¯›ç—….è¿ˆè…¾2013è±ªåç‰ˆ2.0TSI,æˆ‘ä»¥10.5wä¹°ä¸‹. åŠç†ç‰Œç…§å’Œä¿é™©ä»¥åŠä¿å…»å…¨éƒ¨æå®Œ11wå·¦å³.

ä¹°åˆ°æ‰‹ç¬¬ä¸€ä»¶äº‹åŠ è£…å€’è½¦ç¿»æ ‡æ‘„åƒå¤´,ä¹Ÿå°±æ˜¯å¤§ä¼—è½¦æ ‡ç¿»ç›–ä¼¸å‡ºæ¥ä¸€ä¸ªæ‘„åƒå¤´ç”¨äºå€’è½¦å½±åƒ.

![](/assets/images/20191231FinalSummary/magotan5.webp)

å¼€åˆ°åŒ—äº¬å‘¨æœ«é—²æš‡çš„æ—¶å€™æ´—æ´—è½¦æ‰“æ‰“èœ¡è·Ÿæ–°çš„ä¸€æ ·.

![](/assets/images/20191231FinalSummary/magotan6.webp)

è¯´è¯´ä¹°è½¦çš„è¿‡ç¨‹å§, åŸè½¦ä¸»ä¸€å¼€å§‹ä»¥ä¸ºæˆ‘ä¸ä¼šä¹°ä»–çš„è½¦ä¹Ÿå°±æ²¡å½“å›äº‹,åæ¥å‘ç°æˆ‘è¿è½¦éƒ½ä¸çœ‹ç›´æ¥äº¤æ˜“è¿™ä¸ªè¿‡ç¨‹å°±æœ‰ç‚¹è®¤çœŸäº†å›å»ç›´æ¥æŠŠå…¨éƒ¨è¯ä»¶éƒ½æ‹¿æ¥äº†,ä¸‹åˆ4ç‚¹åŠç†å®Œå„ç§ä¿é™© ç¬¬äºŒå¤©æŠŠè½¦ä¸€é¡¿ä¿å…»,ä¸Š100wçš„å•†ä¿,å¼€è½¦å›åŒ—äº¬,æœŸé—´æ„Ÿè°¢åŒå­¦å§šå¿—å¼º,ä¸€è·¯åŠç‰Œç…§å‹ç‰Œç­‰ç­‰æ‰‹ç»­éƒ½æ¿æ­£çš„å¸®æˆ‘æ•´åˆ©ç´¢äº†,æˆ‘è¿™åˆä¸­åŒå­¦æ˜¯åœ¨å“ˆå°”æ»¨å¹³æˆ¿ä¸€ä¸ªå«è¯šæ°ä¸€æ±½å¤§ä¼—4såº—å·¥ä½œ,æ‰€ä»¥åœ¨æœ‰äººåŠäº‹çœŸå¿«çœŸæ–¹ä¾¿.ä»–åœ¨4såº—æˆ‘ä¹°è½¦æ²¡ç†ç”±ä¸é€‰æ‹©å¤§ä¼—.åŸæ¥çš„è½¦ä¸»å°ä¼™é€äº†æˆ‘ä¸€å¥—é›ªåœ°èƒå¾ˆæ£’.

è¿™è½¦ä¹°å›æ¥çš„ä¸€äº›å°æ¯›ç—…

1. å‰é£æŒ¡ç»ç’ƒè¢«çŸ³å­æ‰“è¿‡ æˆ‘è‡ªå·±åœ¨å¤©çŒ«ä¸Šä¹°äº†ç»ç’ƒä¿®å¤å·¥å…·,è‡ªå·±åŠ¨æ‰‹è§£å†³äº†
2. åæ’åº§æ¤…å¡‘æ–™æ’å£åäº†,æˆ‘åœ¨ç½‘ä¸Šè¯å‡ åå—é’±ä¹°ä¸ªæ–°çš„è£…ä¸Šäº†éå¸¸å¥½ä½¿.
3. æ±½è½¦è½®èƒ, ç”±äºåŸè½¦ä¸»é€äº†ä¸€å¥—é›ªåœ°èƒ,åŸè½¦çš„4æ¡é‚“ç¦„æ™®è¿˜èƒ½å¯¹ä»˜5000å…¬é‡Œæ²¡é—®é¢˜,æœ€è¿‘æŠŠé›ªåœ°èƒæ¢ä¸Šäº†ç„¶åæŠŠåŸè½¦çš„é‚“ç¦„æ™®å–äº†200å—é’±.
4. æ¢äº†æ–°çš„ç«èŠ±å¡,æœºæ²¹ã€ç©ºæ»¤ä»¥åŠåˆ¹è½¦æ²¹ã€ç»ç’ƒæ°´.
> å…¶å®ƒå•¥æ¯›ç—…æ²¡æœ‰,è¿™è½¦çš„å˜é€Ÿç®±DSGæ¹¿å¼åŒç¦»åˆè¿˜åœ¨è´¨ä¿æœŸå†…(10å¹´æˆ–è€…16wå…¬é‡Œ)

2020å¹´è¿‡å¹´å›å®¶æŠŠå‘å‘åŠ¨æœºæœºæ²¹å°ºå¤„æ¸—æ²¹çš„é—®é¢˜è§£å†³ä¸€ä¸‹,ç„¶ååˆ¹è½¦ç‰‡åˆ¹è½¦ç›˜éƒ½æ¢æ¢.è¿‡å®Œå¹´å›æ¥çœ‹çœ‹ä¹°ä¸€å¥—æ–°çš„é©¬ç‰Œè½®èƒæ¢ä¸Š.

ä¹°äº†è¿™ä¸ªè½¦è™½ç„¶åœ¨åŒ—äº¬ä¸æ€ä¹ˆå¼€,ä½†æ˜¯å®ƒå¸¦ç»™æˆ‘å¾ˆå¤šä¹è¶£,æœ‰æ—¶é—´çš„æ—¶å€™æˆ‘å»æ“¦æ“¦è½¦,ä¹°ä¸€äº›æ±½è½¦å…»æŠ¤ç”¨å“,è‡ªå·±èƒ½ä¿®ç†çš„åœ°æ–¹å°±è‡ªå·± DIYæå®šå¾ˆæœ‰æˆå°±æ„Ÿ.

### å¥åº·

2019å¹´å¯¹30å¹´çš„ç‰™é½¿è¿›è¡Œäº†ä¸€æ¬¡å¤§ä¿å…»,è¿ç»­è·‘äº†20å¤šè¶ŸåŒ—äº¬å£è…”åŒ»é™¢,ç»ˆäºæŠŠç‰™é½¿ä¿®ç†çš„éå¸¸æ¿æ­£.
æ¯å¹´ä½“æ£€,æœ‰é—®é¢˜åŠæ—¶å°±åŒ»æ²»ç–—,2019å¹´åŒ»ç–—ä¿é™©è‡³å°‘ä¸ºæˆ‘èŠ‚çœäº†5000å¤š,ä»Šå¹´çš„åŒ»ç–—èŠ±è´¹å¼€æ”¯2w+.

### äº”å¹´è®¡åˆ’

2019å¹´ç›¸å½“äºç¬¬ä¸€ä¸ª"äº”å¹´è®¡åˆ’"çš„æ”¶å°¾ï¼Œç”±äº2018å¹´çš„äº”å¹´è®¡åˆ’å®Œæˆ70%å·¦å³ï¼Œæ‰€ä»¥è¿™ä¸€å¹´è¿˜æ˜¯æ²‰æ·€æ²‰æ·€ï¼Œé™ä¸‹å¿ƒæ¥äº‰å–100%å®Œæˆå†å¼€å§‹æ–°è®¡åˆ’ã€‚

2020å¼€å§‹åˆ¶è®¢æ–°çš„"äº”å¹´è®¡åˆ’"ï¼Œäº‰å–2025å¹´åº•å®Œæˆå¦‚ä¸‹:

1.  åœ¨å“ˆå°”æ»¨æˆ–è€…å…¶å®ƒåŸå¸‚ä¹°ä¸€å¥—å°æˆ·å‹çš„æˆ¿äº§ä¸€å®¤ä¸€å…ä¸€å«ï¼Œå¸¦è½¦ä½ å…¨æ¬¾ç»“æ¸…
2. æŠ•èµ„å²³çˆ¶å²³æ¯å¼€ä¸ªæ´—è½¦åº—ï¼Œäº‰å–ä¸è®©ä»–ä»¬å‡ºå»æ‰“å·¥
3. ï¼ˆå¦‚æœå¯èƒ½)åˆ›å»ºä¸€æ‰€å¤§å­¦ï¼Œè®¾ç«‹30+ä¸ªä¸“ä¸šå¹¶è®¾ç«‹å®éªŒå®¤ï¼Œä¸“æ”»å¡ä¸­å›½è„–å­çš„35é¡¹å…³é”®æŠ€æœ¯ï¼å³ä¾¿ä¸èƒ½è§£å†³å¡è„–å­æŠ€æœ¯ä¹Ÿè¦ä¸ºè¿™äº›å°–ç«¯ç§‘æŠ€åŸ¹å…»äººæ‰åšå‡ºåŠªåŠ›ï¼Œä¸€å®šè¦å»ºè®¾å¥½æˆ‘çš„ç¥–å›½

[è¿™ç¯‡æ–‡ç« ](https://mp.weixin.qq.com/s/ms2TbtZyEHYqoQGHQrJY5A)ä»‹ç»äº†ç›®å‰å¡ä¸­å›½è„–å­çš„34é¡¹å°–ç«¯ç§‘æŠ€.

##### å…‰åˆ»æœº

åˆ¶é€ èŠ¯ç‰‡çš„å…‰åˆ»æœºï¼Œå…¶ç²¾åº¦å†³å®šäº†èŠ¯ç‰‡æ€§èƒ½çš„ä¸Šé™ã€‚åœ¨â€œåäºŒäº”â€ç§‘æŠ€æˆå°±å±•è§ˆä¸Šï¼Œä¸­å›½ç”Ÿäº§çš„æœ€å¥½çš„å…‰åˆ»æœºï¼ŒåŠ å·¥ç²¾åº¦æ˜¯90çº³ç±³ã€‚è¿™ç›¸å½“äº2004å¹´ä¸Šå¸‚çš„å¥”è…¾å››CPUçš„æ°´å‡†ã€‚è€Œå›½å¤–å·²ç»åšåˆ°äº†åå‡ çº³ç±³ã€‚

å…‰åˆ»æœºé‡Œæœ‰ä¸¤ä¸ªåŒæ­¥è¿åŠ¨çš„å·¥ä»¶å°ï¼Œä¸€ä¸ªè½½åº•ç‰‡ï¼Œä¸€ä¸ªè½½èƒ¶ç‰‡ã€‚ä¸¤è€…éœ€å§‹ç»ˆåŒæ­¥ï¼Œè¯¯å·®åœ¨2çº³ç±³ä»¥ä¸‹ã€‚ä¸¤ä¸ªå·¥ä½œå°ç”±é™åˆ°åŠ¨ï¼ŒåŠ é€Ÿåº¦è·Ÿå¯¼å¼¹å‘å°„å·®ä¸å¤šã€‚åœ¨å·¥ä½œæ—¶ï¼Œç›¸å½“äºä¸¤æ¶å¤§é£æœºä»èµ·é£åˆ°é™è½ï¼Œå§‹ç»ˆé½å¤´å¹¶è¿›ä¸€æ¶é£æœºä¸Šä¼¸å‡ºä¸€æŠŠåˆ€ï¼Œåœ¨å¦ä¸€æ¶é£æœºçš„ç±³ç²’ä¸Šåˆ»å­—ï¼Œä¸èƒ½åˆ»åäº†ã€‚

> æ¥æºï¼šã€Šè¿™äº›â€œç»†èŠ‚â€è®©ä¸­å›½éš¾æœ›é¡¶çº§å…‰åˆ»æœºé¡¹èƒŒã€‹
ï¼ˆç§‘æŠ€æ—¥æŠ¥4æœˆ19æ—¥ï¼‰

##### èŠ¯ç‰‡

ä½é€Ÿçš„å…‰èŠ¯ç‰‡å’Œç”µèŠ¯ç‰‡å·²å®ç°å›½äº§ï¼Œä½†é«˜é€Ÿçš„ä»å…¨éƒ¨ä¾èµ–è¿›å£ã€‚å›½å¤–æœ€å…ˆè¿›èŠ¯ç‰‡é‡äº§ç²¾åº¦ä¸º10çº³ç±³ï¼Œæˆ‘å›½åªæœ‰28çº³ç±³ï¼Œå·®è·ä¸¤ä»£ã€‚æ®æŠ¥é“ï¼Œåœ¨è®¡ç®—æœºç³»ç»Ÿã€é€šç”¨ç”µå­ç³»ç»Ÿã€é€šä¿¡è®¾å¤‡ã€å†…å­˜è®¾å¤‡å’Œæ˜¾ç¤ºåŠè§†é¢‘ç³»ç»Ÿä¸­çš„å¤šä¸ªé¢†åŸŸä¸­ï¼Œæˆ‘å›½å›½äº§èŠ¯ç‰‡å æœ‰ç‡ä¸º0ã€‚

> æ¥æºï¼šã€Šä¸­å…´çš„â€œèŠ¯â€ç—…ï¼Œä¸­å›½çš„å¿ƒç—…ã€‹

##### æ“ä½œç³»ç»Ÿ

æ™®é€šäººçœ‹åˆ°ä¸­å›½ITä¸šç¹è£ï¼Œè®¤ä¸ºæŠ€æœ¯å·®è·ä¸å¤§ï¼Œå®åˆ™ä¸ç„¶ã€‚3å®¶ç¾å›½å…¬å¸å„æ–­æ‰‹æœºå’Œä¸ªäººç”µè„‘çš„æ“ä½œç³»ç»Ÿã€‚æ•°æ®æ˜¾ç¤ºï¼Œ2017å¹´å®‰å“ç³»ç»Ÿå¸‚åœºå æœ‰ç‡è¾¾85.9%ï¼Œè‹¹æœIOSä¸º14%ã€‚å…¶ä»–ç³»ç»Ÿä»…æœ‰0.1%ã€‚è¿™0.1%ï¼ŒåŸºæœ¬ä¹Ÿæ˜¯ç¾å›½çš„å¾®è½¯çš„Windowså’Œé»‘è“ã€‚æ²¡æœ‰è°·æ­Œé“ºè·¯ï¼Œæ™ºèƒ½æ‰‹æœºä¸ä¼šå¦‚æ­¤æ™®åŠï¼Œè€Œä¸­å›½æ‰‹æœºå‚å•†å…è´¹åˆ©ç”¨å®‰å“çš„ä»£ä»·ï¼Œå°±æ˜¯éšæ—¶å¯èƒ½è¢«â€œæ–­ç²®â€ã€‚

> æ¥æºï¼šã€Šä¸§å¤±å…ˆæœºï¼Œæ²¡æœ‰è‡ªç ”æ“ä½œç³»ç»Ÿçš„å¤§å›½ä¹‹ç—›ã€‹ 
 
#### èˆªç©ºå‘åŠ¨æœºçŸ­èˆ±

é£æœºä¸Šå®‰æ”¾å‘åŠ¨æœºçš„èˆ±å®¤ï¼Œä¿—ç§°â€œæˆ¿å­â€ï¼Œæ˜¯èˆªç©ºæ¨è¿›ç³»ç»Ÿæœ€é‡è¦çš„æ ¸å¿ƒéƒ¨ä»¶ä¹‹ä¸€ï¼Œå…¶æˆæœ¬çº¦å å…¨éƒ¨å‘åŠ¨æœºçš„1/4å·¦å³ã€‚çŸ­èˆ±éœ€è¦å°†å‘åŠ¨æœºåŒ…è¦†ï¼Œå‡å°‘é£è¡Œé˜»åŠ›ï¼›å…¶è¿›æ°”é“è¿˜è¦å…·æœ‰é˜²ã€é™¤å†°çš„èƒ½åŠ›ï¼›é£è¡Œä¸­ï¼Œè¦ä¿æŠ¤å‘åŠ¨æœºä¸å—å¹²æ‰°æ­£å¸¸å·¥ä½œï¼›åœ¨åœ°é¢ï¼Œéœ€è¦åšåˆ°æ–¹ä¾¿å‘åŠ¨æœºçš„ç»´æŠ¤å’Œç»´ä¿®ï¼Œä¸€æ—¦çŸ­èˆ±æœ‰æŸï¼Œé£è¡Œä¸­å¯èƒ½ä¼šå¼•èµ·å‘åŠ¨æœºä¸¥é‡äº‹æ•…ã€‚çŸ­èˆ±è¶Šå¤§æŠ€æœ¯éš¾åº¦è¶Šé«˜ã€‚æˆ‘å›½åœ¨è¿™ä¸€é‡è¦é¢†åŸŸå°šå±ç©ºç™½ã€‚æŸ¥é˜…æ‰€æœ‰å…¬å¼€èµ„æ–™ï¼Œæˆ‘å›½å°šæ— è‡ªä¸»ç ”åˆ¶çŸ­èˆ±çš„ä¸“é—¨æœºæ„ï¼Œç›¸å…³é™¢æ ¡ä¼¼ä¹ä¹Ÿæ²¡æœ‰è®¾ç½®ç›¸å…³çš„å­¦ç§‘ã€‚

> æ¥æºï¼šã€Šå±…è€…æ— å…¶å±‹ï¼Œå›½äº§èˆªç©ºå‘åŠ¨æœºçš„çŸ­èˆ±ä¹‹å›°ã€‹

##### è§¦è§‰ä¼ æ„Ÿå™¨

è§¦è§‰ä¼ æ„Ÿå™¨æ˜¯å·¥ä¸šæœºå™¨äººæ ¸å¿ƒéƒ¨ä»¶ã€‚ç²¾ç¡®ã€ç¨³å®šçš„ä¸¥è‹›è¦æ±‚ï¼Œæ‹¦ä½äº†æˆ‘å›½å¤§éƒ¨åˆ†ä¼ä¸šå‘è§¦è§‰ä¼ æ„Ÿå™¨è¿ˆè¿›çš„æ­¥ä¼ï¼Œç›®å‰å›½å†…ä¼ æ„Ÿå™¨ä¼ä¸šå¤§å¤šä»äº‹æ°”ä½“ã€æ¸©åº¦ç­‰ç±»å‹ä¼ æ„Ÿå™¨çš„ç”Ÿäº§ã€‚åœ¨ä¸€ä¸ªæœ‰ç€100å¤šå®¶ä¼ä¸šçš„è¡Œä¸šä¸­ï¼Œå‡ ä¹æ²¡æœ‰ä¼ æ„Ÿå™¨åˆ¶é€ å•†è¿›è¡Œè§¦è§‰ä¼ æ„Ÿå™¨çš„ç”Ÿäº§ã€‚æ—¥æœ¬é˜µåˆ—å¼ä¼ æ„Ÿå™¨èƒ½åœ¨10å˜ç±³Ã—10å˜ç±³å¤§å°çš„åŸºè´¨ä¸­åˆ†å¸ƒ100ä¸ªæ•æ„Ÿå…ƒä»¶ï¼Œå”®ä»·10ä¸‡å…ƒï¼Œè€Œå›½å†…äº§å“å¤šä¸ºä¸€ç‚¹å¼ï¼Œä¸€èˆ¬100å…ƒä¸€ä¸ªã€‚

> æ¥æºï¼šã€Šä¼ æ„Ÿå™¨ç–å¯Ÿï¼Œè¢«æ„šé’çš„æœºå™¨äººâ€œå›½äº§è§¦è§‰â€ã€‹

##### çœŸç©ºè’¸é•€æœº

OLEDé¢æ¿åˆ¶ç¨‹çš„â€œå¿ƒè„â€ã€‚æ—¥æœ¬Canon Tokkiç‹¬å é«˜ç«¯å¸‚åœºï¼ŒæŒæ¡ç€è¯¥äº§ä¸šçš„å’½å–‰ã€‚ä¸šç•Œå¯¹å®ƒçš„å¹´äº§é‡é¢„æµ‹é€šå¸¸åœ¨å‡ å°åˆ°åå‡ å°ä¹‹é—´ã€‚æœ‰é’±ä¹Ÿä¹°ä¸åˆ°ï¼Œè¯´çš„å°±æ˜¯å®ƒã€‚Canon Tokkièƒ½æŠŠæœ‰æœºå‘å…‰ææ–™è’¸é•€åˆ°åŸºæ¿ä¸Šçš„è¯¯å·®æ§åˆ¶åœ¨5å¾®ç±³å†…ï¼ˆ1å¾®ç±³ç›¸å½“äºå¤´å‘ç›´å¾„çš„1ï¼…ï¼‰ï¼Œæ²¡æœ‰å…¶ä»–å…¬å¸çš„è’¸é•€æœºèƒ½è¾¾åˆ°è¿™ä¸ªç²¾å‡†åº¦ã€‚ç›®å‰æˆ‘å›½è¿˜æ²¡æœ‰ç”Ÿäº§è’¸é•€æœºçš„ä¼ä¸šï¼Œåœ¨è¿™ä¸ªé¢†åŸŸæˆ‘ä»¬æ²¡ä»€ä¹ˆå‘è¨€æƒã€‚

> æ¥æºï¼šã€ŠçœŸç©ºè’¸é•€æœºåŒ®ç¼ºï¼šé«˜ç«¯æ˜¾ç¤ºå±ä¸Šçš„é˜´å½±ã€‹

##### æ‰‹æœºå°„é¢‘å™¨ä»¶

ä¸€å—æ‰‹æœºçš„ä¸»æ¿ä¸Šï¼Œ1/3çš„ç©ºé—´æ˜¯å°„é¢‘ç”µè·¯ã€‚æ‰‹æœºå‘å±•è¶‹åŠ¿æ˜¯æ›´è½»è–„ï¼ŒåŠŸè€—æ›´å°ï¼Œé¢‘æ®µæ›´å¤šï¼Œå¸¦å®½æ›´å¤§ï¼Œè¿™å°±å‘å°„é¢‘èŠ¯ç‰‡æå‡ºäº†æŒ‘æˆ˜ã€‚å°„é¢‘èŠ¯ç‰‡å°†æ•°å­—ä¿¡å·è½¬åŒ–æˆç”µç£æ³¢ï¼Œ4Gæ‰‹æœºè¦æ”¯æŒåå‡ ä¸ªé¢‘æ®µï¼Œä¿¡æ¯å¸¦å®½å‡ åå…†ã€‚2018å¹´ï¼Œå°„é¢‘èŠ¯ç‰‡å¸‚åœº150äº¿ç¾å…ƒï¼›é«˜ç«¯å¸‚åœºåŸºæœ¬è¢«Skyworksã€Qorvoå’Œ åšé€š3å®¶å„æ–­ï¼Œé«˜é€šä¹Ÿå ä¸€å¸­ä¹‹åœ°ã€‚å°„é¢‘å™¨ä»¶çš„å¦ä¸€ä¸ªå…³é”®å…ƒä»¶â€”â€”æ»¤æ³¢å™¨ï¼Œå›½å†…å¤–å·®è·æ›´å¤§ã€‚æ‰‹æœºä½¿ç”¨çš„é«˜ç«¯æ»¤æ³¢å™¨ï¼Œå‡ åäº¿ç¾å…ƒçš„å¸‚åœºï¼Œå®Œå…¨å½’å±Qorvoç­‰å›½å¤–å°„é¢‘å™¨ä»¶å·¨å¤´ã€‚ä¸­å›½æ˜¯ä¸–ç•Œæœ€å¤§çš„æ‰‹æœºç”Ÿäº§å›½ï¼Œä½†é€ ä¸äº†é«˜ç«¯çš„æ‰‹æœºå°„é¢‘å™¨ä»¶ã€‚è¿™éœ€è¦ææ–™ã€å·¥è‰ºå’Œè®¾è®¡ç»éªŒçš„è¸å®ç§¯ç´¯ã€‚

> æ¥æºï¼šã€Šå°„é¢‘å™¨ä»¶ï¼šä»°ç»™äºäººçš„æ‰‹æœºå°´å°¬ã€‹

##### iCLIPæŠ€æœ¯ 

iCLIPæ˜¯ä¸€ç§æ–°å…´çš„å®éªŒæŠ€æœ¯ï¼Œæ˜¯ç ”å‘åˆ›æ–°è¯çš„æœ€å…³é”®çš„æŠ€æœ¯ä¹‹ä¸€ã€‚å®ƒçš„å‘æ˜ï¼Œè®©äººä»¬æŠ›å¼ƒç²¾å¯†çš„è§‚æµ‹ä»ªå™¨ï¼Œä¹Ÿèƒ½ç¡®å®šRNAï¼ˆæ ¸ç³–æ ¸é…¸ï¼‰å’Œè›‹ç™½è´¨åœ¨å“ªä¸ªä½ç½®â€œäº¤æ±‡â€ï¼Œç”šè‡³å¯ä»¥è¯»å‡ºä½ç‚¹â€œå¯†ç â€ã€‚iCLIPæŠ€æœ¯éš¾ï¼ŒçŠ¹å¦‚ä¸‡åƒäººæµ·ä¸­æ‰¾ä¸€ä¸ªäººï¼Œè¦ä»å‡ åäº¿ä¸ªç¢±åŸºå¯¹æ‰¾åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªç¡®å®šçš„ç»“åˆç‚¹ï¼Œç²¾ç¡®åº¦å¯æƒ³è€ŒçŸ¥ã€‚å›½å¤–ç ”ç©¶å›¢é˜Ÿå·²åœ¨æ­¤é¢†åŸŸå±•å¼€â€œæŠ€æœ¯ç«èµ›â€ï¼Œç ”ç©¶è®ºæ–‡ä»¥å‡ ä¸ªæœˆä¸ºå‘¨æœŸè½®ç•ªä¸Šæ¼”ã€‚å›½å†…å®éªŒå®¤å´æå°‘æœ‰æˆç†Ÿç»éªŒã€‚

> æ¥æºï¼šã€Šâ€œé¶ç‚¹â€éš¾å¯»ï¼Œå›½äº§åˆ›æ–°è¯å¾ˆè¿·æƒ˜ã€‹


##### é‡å‹ç‡ƒæ°”è½®æœº 

ç‡ƒæ°”è½®æœºå¹¿æ³›åº”ç”¨äºèˆ°èˆ¹ã€ç«è½¦å’Œå¤§å‹ç”µç«™ã€‚æˆ‘å›½å…·å¤‡è½»å‹ç‡ƒæœºè‡ªä¸»åŒ–èƒ½åŠ›ï¼›ä½†é‡ç‡ƒä»åŸºæœ¬ä¾èµ–å¼•è¿›ã€‚å›½é™…ä¸Šå¤§çš„é‡ç‡ƒå‚å®¶ï¼Œä¸»è¦æ˜¯ç¾å›½GEã€æ—¥æœ¬ä¸‰è±ã€å¾·å›½è¥¿é—¨å­ã€æ„å¤§åˆ©å®‰è¨å°”å¤š4å®¶ã€‚ä¸ä¸­å›½åˆä½œéƒ½é™„å¸¦è‹›åˆ»æ¡ä»¶ï¼šè®¾è®¡æŠ€æœ¯ä¸è½¬è®©ï¼Œæ ¸å¿ƒçš„çƒ­ç«¯éƒ¨ä»¶åˆ¶é€ æŠ€æœ¯ä¹Ÿä¸è½¬è®©ï¼Œä»…ä»¥è®¸å¯è¯æ–¹å¼è®¸å¯æœ¬åœŸåˆ¶é€ éæ ¸å¿ƒéƒ¨ä»¶ã€‚æ²¡æœ‰è‡ªä¸»åŒ–èƒ½åŠ›ï¼Œæ„å‘³ç€æˆ‘å›½èƒ½æºå®‰å…¨çš„é‡è¦ä¸€ç¯ï¼Œä»ç„¶å—åˆ¶äºäººï¼Œå­˜åœ¨è¢«â€œå¡è„–å­â€çš„é£é™©ã€‚

> æ¥æºï¼šã€Šâ€œå‘½é—¨ç«è¡°â€ï¼Œé‡å‹ç‡ƒæ°”è½®æœºçš„å¶ç‰‡ä¹‹æ®‡ã€‹

##### æ¿€å…‰é›·è¾¾ 

æ¿€å…‰é›·è¾¾æ˜¯ä¸ªä¼ æ„Ÿå™¨ï¼Œè‡ªå¸¦å…‰æºï¼Œä¸»åŠ¨å‘å‡ºæ¿€å…‰ï¼Œæ„ŸçŸ¥å‘¨å›´ç¯å¢ƒï¼Œåƒè™è é€šè¿‡è¶…å£°æ³¢å®šä½ä¸€æ ·ã€‚å®ƒæ˜¯è‡ªåŠ¨é©¾é©¶æ±½è½¦çš„å¿…å¤‡ç»„ä»¶ï¼Œå†³å®šç€è‡ªåŠ¨é©¾é©¶è¡Œä¸šçš„è¿›åŒ–æ°´å¹³ã€‚ä½†åœ¨è¯¥é¢†åŸŸï¼Œå›½è´§å‡ ä¹æ²¡æœ‰è¯è¯­æƒã€‚ç›®å‰èƒ½ä¸Šè·¯çš„è‡ªåŠ¨é©¾é©¶æ±½è½¦ä¸­ï¼Œå‡¡æ¶‰åŠæ¿€å…‰é›·è¾¾è€…ï¼Œä½¿ç”¨çš„å‡ ä¹éƒ½æ˜¯ç¾å›½Velodyneçš„äº§å“ï¼Œå…¶æ¿€å…‰é›·è¾¾äº§å“æ˜¯è¡Œä¸šæ ‡é…ï¼Œå å…«æˆä»¥ä¸Šå¸‚åœºä»½é¢ã€‚

> æ¥æºï¼šã€Šæ¿€å…‰é›·è¾¾æ˜è©ï¼Œè®©è‡ªåŠ¨é©¾é©¶å¾ˆçº ç»“ã€‹

#### é€‚èˆªæ ‡å‡† 

ä¸€æ¬¾èˆªç©ºå‘åŠ¨æœºè¦æƒ³è·å–ä¸€å¼ æ”¾é£è¯ï¼Œå¿…é¡»ç»è¿‡ä¸€å¥—éå¸¸ä¸¥æ ¼çš„â€œé€‚èˆªâ€æ ‡å‡†ä½“ç³»éªŒè¯ï¼Œæ¶µç›–è®¾è®¡ã€åˆ¶é€ ã€éªŒè¯å’Œç®¡ç†ã€‚ä½†ç›®å‰åœ¨å›½é™…ä¸Šï¼Œä»¥FAAå’Œæ¬§æ´²èˆªç©ºå®‰å…¨å±€ï¼ˆEASAï¼‰çš„é€‚èˆªå®¡å®šå½±å“åŠ›æœ€å¤§ï¼Œè®¤å¯åº¦æœ€é«˜ã€‚å°½ç®¡åœ¨è§„ç« è¦æ±‚å±‚é¢ï¼Œä¸­å›½ä¸FAAåŸºæœ¬ä¸€è‡´ï¼Œä½†ç”±äºå›½äº§èˆªç©ºå‘åŠ¨æœºå‹å·åŒ®ä¹ï¼Œç¼ºä¹å®é™…å·¥ç¨‹å®è·µç»éªŒï¼Œä½¿æˆ‘å›½é€‚èˆªè§„ç« ç¼ºå°‘ç›¸åº”çš„æŠ€æœ¯æ”¯æ’‘ã€‚å®é™…å‹å·çš„é€‚èˆªéªŒè¯å·¥ä½œï¼Œæˆä¸ºè¢«å¡åœ¨åˆ«å›½ç©ºåŸŸä¹‹å¤–çš„å…³éš˜ã€‚

> æ¥æºï¼šã€Šé€‚èˆªæ ‡å‡†ï¼šå›½äº§èˆªå‘åˆä¸€é“éš¾è¿ˆçš„åå„¿ã€‹

##### é«˜ç«¯ç”µå®¹ç”µé˜»

ç”µå®¹å’Œç”µé˜»æ˜¯ç”µå­å·¥ä¸šçš„é»„é‡‘é…è§’ã€‚ä¸­å›½æ˜¯æœ€å¤§çš„åŸºç¡€ç”µå­å…ƒä»¶å¸‚åœºï¼Œä¸€å¹´æ¶ˆè€—çš„ç”µé˜»å’Œç”µå®¹ï¼Œæ•°ä»¥ä¸‡äº¿è®¡ã€‚ä½†æœ€å¥½çš„æ¶ˆè´¹çº§ç”µå®¹å’Œç”µé˜»ï¼Œæ¥è‡ªæ—¥æœ¬ã€‚ç”µå®¹å¸‚åœºä¸€å¹´200å¤šäº¿ç¾å…ƒï¼Œç”µé˜»ä¹Ÿæœ‰ç™¾äº¿ç¾å…ƒé‡çº§ã€‚æ‰€è°“é«˜ç«¯çš„ç”µå®¹ç”µé˜»ï¼Œæœ€é‡è¦çš„æ˜¯åŒä¸€ä¸ªæ‰¹æ¬¡åº”è¯¥å°½é‡ä¸€è‡´ã€‚æ—¥æœ¬è¿™æ–¹é¢åšå¾—æœ€å¥½ï¼Œå›½å†…ä¼ä¸šå·®è·å¤§ã€‚å›½å†…ä¼ä¸šçš„äº§å“å¤šå±äºä¸­ä½ç«¯ï¼Œåœ¨å·¥è‰ºã€ææ–™ã€è´¨é‡ç®¡æ§ä¸Šï¼Œç›¸å¯¹è–„å¼±ã€‚

> æ¥æºï¼šã€Šæ²¡æœ‰è¿™äº›è¯€çªï¼Œæˆ‘ä»¬å¤Ÿä¸ç€é«˜ç«¯ç”µå®¹ç”µé˜»ã€‹

#### æ ¸å¿ƒå·¥ä¸šè½¯ä»¶ 

ä¸­å›½çš„æ ¸å¿ƒå·¥ä¸šè½¯ä»¶é¢†åŸŸï¼ŒåŸºæœ¬è¿˜æ˜¯â€œæ— äººåŒºâ€ã€‚å·¥ä¸šè½¯ä»¶ç¼ºä½ï¼Œä¸ºæ™ºèƒ½åˆ¶é€ å¸¦æ¥äº†éº»çƒ¦ã€‚å·¥ä¸šç³»ç»Ÿå¤æ‚åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±éœ€è¦ä»¥è®¡ç®—æœºè¾…åŠ©çš„å·¥ä¸šè½¯ä»¶æ¥æ›¿ä»£äººè„‘è®¡ç®—ã€‚è­¬å¦‚ï¼ŒèŠ¯ç‰‡è®¾è®¡ç”Ÿäº§â€œå¿…å¤‡ç¥å™¨â€EDAå·¥ä¸šè½¯ä»¶ï¼Œå›½äº§EDAä¸ç¾å›½ä¸»æµEDAå·¥å…·ç›¸è¾ƒï¼Œè®¾è®¡åŸç†ä¸Šå¹¶æ— å·®å¼‚ï¼Œä½†è½¯ä»¶æ€§èƒ½å´å­˜åœ¨ä¸å°å·®è·ï¼Œä¸»è¦è¡¨ç°åœ¨å¯¹å…ˆè¿›æŠ€æœ¯å’Œå·¥è‰ºæ”¯æŒä¸è¶³ï¼Œå’Œå›½å¤–å…ˆè¿›EDAå·¥å…·ä¹‹é—´å­˜åœ¨â€œä»£å·®â€ã€‚å›½å¤–EDAä¸‰å¤§å·¨å¤´å…¬å¸Cadenceã€SynopsysåŠMentorï¼Œå æ®äº†å…¨çƒè¯¥è¡Œä¸šæ¯å¹´æ€»æ”¶å…¥çš„70%ã€‚å‘å±•è‡ªä¸»å·¥ä¸šæ“ä½œç³»ç»Ÿ+è‡ªä¸»å·¥ä¸šè½¯ä»¶ä½“ç³»ï¼Œåˆ»ä¸å®¹ç¼“ã€‚

> æ¥æºï¼šã€Šæ ¸å¿ƒå·¥ä¸šè½¯ä»¶ï¼šæ™ºèƒ½åˆ¶é€ çš„ä¸­å›½â€œæ— äººåŒºâ€ã€‹

##### ITOé¶æ 

ITOé¶æä¸ä»…ç”¨äºåˆ¶ä½œæ¶²æ™¶æ˜¾ç¤ºå™¨ã€å¹³æ¿æ˜¾ç¤ºå™¨ã€ç­‰ç¦»å­æ˜¾ç¤ºå™¨ã€è§¦æ‘¸å±ã€ç”µå­çº¸ã€æœ‰æœºå‘å…‰äºŒæç®¡ï¼Œè¿˜ç”¨äºå¤ªé˜³èƒ½ç”µæ± å’ŒæŠ—é™ç”µé•€è†œã€EMIå±è”½çš„é€æ˜ä¼ å¯¼é•€è†œç­‰ï¼Œåœ¨å…¨çƒæ‹¥æœ‰å¹¿æ³›çš„å¸‚åœºã€‚ITOè†œçš„åšåº¦å› åŠŸèƒ½éœ€æ±‚è€Œæœ‰ä¸åŒï¼Œä¸€èˆ¬åœ¨30çº³ç±³è‡³200çº³ç±³ã€‚åœ¨å°ºå¯¸çš„é—®é¢˜ä¸Šï¼Œå›½å†…ITOé¶æä¼ä¸šä¸€ç›´é²œæœ‰çªç ´ï¼Œè€Œåç«¯çš„å¹³æ¿æ˜¾ç¤ºåˆ¶é€ ä¼ä¸šä¹Ÿè¦ä»°äººé¼»æ¯ã€‚çƒ§ç»“å¤§å°ºå¯¸ITOé¶æï¼Œéœ€è¦æœ‰å¤§å‹çš„çƒ§ç»“ç‚‰ã€‚å›½å¤–å¯ä»¥åšå®½1200æ¯«ç±³ã€é•¿è¿‘3000æ¯«ç±³çš„å•å—é¶æï¼Œå›½å†…åªèƒ½åˆ¶é€ ä¸è¶…è¿‡800æ¯«ç±³å®½çš„ã€‚äº§å‡ºæ•ˆç‡æ–¹é¢ï¼Œæ—¥å¼è£…å¤‡æœˆäº§é‡å¯è¾¾30å¨è‡³50å¨ï¼Œæˆ‘ä»¬å¹´äº§é‡åªæœ‰30å¨â€”â€”è€Œè¿›å£ä¸€å°è®¾å¤‡ä»·æ ¼è¦èŠ±ä¸€åƒä¸‡å…ƒï¼Œè¿™å¯¹å›½å†…å°ä¼ä¸šæ¥è¯´æ— å¼‚äºå¤©ä»·ã€‚

æ¯å¹´æˆ‘å›½ITOé¶ææ¶ˆè€—é‡è¶…è¿‡1åƒå¨ï¼Œä¸€åŠå·¦å³é è¿›å£ï¼Œç”¨äºç”Ÿäº§é«˜ç«¯äº§å“ã€‚

> æ¥æºï¼šã€Šçƒ§ä¸å‡ºå¤§å·é¶æï¼Œå¹³æ¿æ˜¾ç¤ºåˆ¶é€ ä»°äººé¼»æ¯ã€‹

#### æ ¸å¿ƒç®—æ³• 

ä¸­å›½å·²ç»è¿ç»­5å¹´æˆä¸ºä¸–ç•Œç¬¬ä¸€å¤§æœºå™¨äººåº”ç”¨å¸‚åœºï¼Œä½†é«˜ç«¯æœºå™¨äººä»ç„¶ä¾èµ–äºè¿›å£ã€‚ç”±äºæ²¡æœ‰æŒæ¡æ ¸å¿ƒç®—æ³•ï¼Œå›½äº§å·¥ä¸šæœºå™¨äººç¨³å®šæ€§ã€æ•…éšœç‡ã€æ˜“ç”¨æ€§ç­‰å…³é”®æŒ‡æ ‡è¿œä¸å¦‚å·¥ä¸šæœºå™¨äººâ€œå››å¤§å®¶æ—â€å‘é‚£ç§‘ï¼ˆæ—¥æœ¬ï¼‰ã€ABBï¼ˆç‘å£«ï¼‰ã€å®‰å·ï¼ˆæ—¥æœ¬ï¼‰ã€åº“å¡ï¼ˆå¾·å›½ï¼‰çš„äº§å“ã€‚æ ¸å¿ƒç®—æ³•å·®è·è¿‡å¤§ï¼Œå¯¼è‡´å›½äº§æœºå™¨äººç¨³å®šæ€§ä¸ä½³ï¼Œæ•…éšœç‡å±…é«˜ä¸ä¸‹ã€‚ç®—æ³•çš„å·®è·ä¸åªä½“ç°åœ¨æ ¸å¿ƒæ§åˆ¶å™¨ä¸Šï¼Œæ›´æ‹–æ…¢äº†ä¼ºæœç³»ç»Ÿå“åº”çš„é€Ÿåº¦ã€‚

æœºå™¨äººæ¯å®Œæˆä¸€ä¸ªåŠ¨ä½œï¼Œéœ€è¦æ ¸å¿ƒæ§åˆ¶å™¨ã€ä¼ºæœé©±åŠ¨å™¨å’Œä¼ºæœç”µæœºååŒä½œæˆ˜ã€‚å¯¹äºå•å°ä¼ºæœç³»ç»Ÿï¼Œå›½äº§æœºå™¨äººåŠ¨æ€ä¸é™æ€ç²¾åº¦éƒ½å¾ˆé«˜ï¼Œä½†é«˜ç«¯æœºå™¨äººä¸€èˆ¬åŒæ—¶æœ‰6å°ä»¥ä¸Šä¼ºæœç³»ç»Ÿï¼Œç”¨ä¼ ç»Ÿçš„æ§åˆ¶æ–¹æ³•éš¾ä»¥å–å¾—å¥½çš„æ§åˆ¶æ•ˆæœã€‚

> æ¥æºï¼šã€Šç®—æ³•ä¸ç²¾ï¼Œå›½äº§å·¥ä¸šæœºå™¨äººæœ‰ç‚¹â€œç¬¨â€ã€‹

##### èˆªç©ºé’¢æ 

æ— è®ºèµ·é£è¿˜æ˜¯é™è½ï¼Œèµ·è½æ¶éƒ½æ˜¯æ”¯æ’‘é£æœºçš„å”¯ä¸€éƒ¨ä»¶ï¼Œå°¤å…¶æ˜¯åœ¨é£æœºé™è½é˜¶æ®µï¼Œå…¶æ‰¿è½½çš„è½½è·ä¸ä»…ä»…æ¥è‡ªæœºèº«é‡é‡ï¼Œè¿˜æœ‰é£æœºå‚ç›´æ–¹å‘çš„å·¨å¤§å†²åŠ›ã€‚å› æ­¤ï¼Œèµ·è½æ¶çš„ææ–™å¼ºåº¦å¿…é¡»ååˆ†ä¼˜å¼‚ï¼Œåªèƒ½ä¾é ç‰¹ç§é’¢ææ‰è¡Œã€‚ç›®å‰ä½¿ç”¨èŒƒå›´æœ€å¹¿çš„æ˜¯ç¾å›½çš„300Mé’¢ï¼Œè¯¥ææ–™é‡‡ç”¨çœŸç©ºçƒ­å¤„ç†æŠ€æœ¯ï¼Œé¿å…äº†æ¸—æ°¢ï¼Œé›¶ä»¶è¡¨é¢å…‰äº®ï¼Œæ— æ°§åŒ–è„±ç¢³ã€å¢ç¢³å’Œæ™¶ç•Œæ°§åŒ–ç­‰ç¼ºé™·ï¼Œæé«˜äº†è¡¨é¢è´¨é‡ã€‚è€Œå›½å†…ç”¨äºåˆ¶ä½œèµ·è½æ¶çš„å›½äº§è¶…å¼ºåº¦é’¢ææœ‰æ—¶ä¼šå‡ºç°ç‚¹çŠ¶ç¼ºé™·ã€ç¡«åŒ–ç‰©å¤¹æ‚ã€ç²—æ™¶ã€å†…éƒ¨è£‚çº¹ã€çƒ­å¤„ç†æ¸—æ°¢ç­‰é—®é¢˜ï¼Œè¿™äº›é—®é¢˜éƒ½ä¸å†¶ç‚¼è¿‡ç¨‹ä¸­çº¯å‡€åº¦ä¸å¤Ÿæœ‰å…³ç³»ã€‚æ‰€ä»¥æˆ‘å›½åœ¨é«˜çº¯åº¦ç†”ç‚¼æŠ€æœ¯æ–¹é¢ä¸ç¾å›½è¿˜æœ‰è¾ƒå¤§å·®è·ï¼Œå­˜åœ¨å¾ˆå¤§æå‡ç©ºé—´ã€‚

> æ¥æºï¼šã€Šèˆªç©ºé’¢æä¸è¿‡ç¡¬ï¼Œå›½äº§å¤§é£æœºèµ·è½å¤±æ®ã€‹

##### é“£åˆ€ 

éšç€æˆ‘å›½è¿‘å¹´æ¥é«˜é“çš„è¿…çŒ›å»ºè®¾ï¼Œé’¢è½¨å…»æŠ¤é—®é¢˜ä¹Ÿæ„ˆåŠ è®©ä¸šå†…ä¸“å®¶å¿§å¿ƒã€‚è‹¥å…»æŠ¤ä¸åˆ°ä½ï¼Œä¸ä»…æŠ˜æŸç”Ÿå‘½å‘¨æœŸï¼Œè¿˜å­˜åœ¨é«˜é£é™©éšæ‚£ã€‚æˆ‘å›½è‡ªä¸»åˆ›æ–°ç ”å‘çš„åŒåŠ¨åŠ›ç”µé©±é“£ç£¨ç»´æŠ¤æœºå™¨äººè£…å¤‡â€”â€”è¢«ç§°ä¸ºé’¢è½¨â€˜æ€¥æ•‘è½¦â€™çš„é“£ç£¨è½¦å¯ä¸ºé’¢è½¨â€œä¿é©¾æŠ¤èˆªâ€ã€‚ä½†é“£ç£¨è½¦æœ€æ ¸å¿ƒéƒ¨ä»¶é“£åˆ€ä»éœ€ä»å›½å¤–è¿›å£ã€‚é“£åˆ€çš„ææ–™æ˜¯ä¸€ç§è¶…ç¡¬åˆé‡‘ææ–™ã€‚å¯¹å…¶ä¸­é‡‘å±æˆåˆ†æˆ‘ä»¬å·²ç„¶äº†è§£ï¼Œä½†å°±æ˜¯ä¸çŸ¥äººå®¶æ˜¯æ€ä¹ˆé…æ¯”ã€åˆæˆçš„ï¼Œå¦‚åŒç¢ç£¨æŸç§ä¸­è¯çš„ç¥–ä¼ ç§˜æ–¹ã€å„ç§è¯ææ¯”ä¾‹æ˜¯å¤šå°‘ï¼Œéƒ½ä¸ç”šæ˜äº†ã€‚

> æ¥æºï¼šã€Šä¸ºé«˜é“é’¢è½¨â€œæ•´å®¹â€ï¼Œå›½äº§é“£åˆ€éš¾å ªé‡ä»»ã€‹


##### é«˜ç«¯è½´æ‰¿é’¢ 

ä½œä¸ºæœºæ¢°è®¾å¤‡ä¸­ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒé›¶éƒ¨ä»¶ï¼Œè½´æ‰¿æ”¯æ’‘æœºæ¢°æ—‹è½¬ä½“ï¼Œé™ä½å…¶æ‘©æ“¦ç³»æ•°ï¼Œå¹¶ä¿è¯å…¶å›è½¬ç²¾åº¦ã€‚æ— è®ºé£æœºã€æ±½è½¦ã€é«˜é“ï¼Œè¿˜æ˜¯é«˜ç²¾å¯†æœºåºŠã€ä»ªå™¨ä»ªè¡¨ï¼Œéƒ½éœ€è¦è½´æ‰¿ã€‚è¿™å°±å¯¹å…¶ç²¾åº¦ã€æ€§èƒ½ã€å¯¿å‘½å’Œå¯é æ€§æå‡ºäº†é«˜è¦æ±‚ã€‚è€Œæˆ‘å›½çš„åˆ¶è½´å·¥è‰ºå·²ç»æ¥è¿‘ä¸–ç•Œé¡¶å°–æ°´å¹³ï¼Œä½†æè´¨â€”â€”ä¹Ÿå°±æ˜¯é«˜ç«¯è½´æ‰¿ç”¨é’¢å‡ ä¹å…¨éƒ¨ä¾èµ–è¿›å£ã€‚
é«˜ç«¯è½´æ‰¿ç”¨é’¢çš„ç ”å‘ã€åˆ¶é€ ä¸é”€å”®åŸºæœ¬ä¸Šè¢«ä¸–ç•Œè½´æ‰¿å·¨å¤´ç¾å›½é“å§†è‚¯ã€ç‘å…¸SKFæ‰€å„æ–­ã€‚å‰å‡ å¹´ï¼Œä»–ä»¬åˆ†åˆ«åœ¨å±±ä¸œçƒŸå°ã€æµå—å»ºç«‹åŸºåœ°ï¼Œé‡‡è´­ä¸­å›½çš„ä½ç«¯æè´¨ï¼Œè¿ç”¨ä»–ä»¬çš„æ ¸å¿ƒæŠ€æœ¯åšæˆé«˜ç«¯è½´æ‰¿ï¼Œä»¥åå€çš„ä»·æ ¼å–ç»™ä¸­å›½å¸‚åœºã€‚ç‚¼é’¢è¿‡ç¨‹ä¸­åŠ å…¥ç¨€åœŸï¼Œå°±èƒ½ä½¿åŸæœ¬ä¼˜è´¨çš„é’¢å˜å¾—æ›´åŠ â€œåšå¼ºâ€ã€‚ä½†æ€ä¹ˆåŠ ï¼Œè¿™æ˜¯ä¸–ç•Œè½´æ‰¿å·¨å¤´ä»¬çš„æ ¸å¿ƒç§˜å¯†ã€‚

> æ¥æºï¼šã€Šé«˜ç«¯è½´æ‰¿é’¢ï¼Œéš¾ä»¥è¡¥é½çš„ä¸­å›½åˆ¶é€ ä¸šçŸ­æ¿ã€‹


##### é«˜å‹æŸ±å¡æ³µ

æ¶²å‹ç³»ç»Ÿæ˜¯è£…å¤‡åˆ¶é€ ä¸šçš„å…³é”®éƒ¨ä»¶ä¹‹ä¸€ï¼Œä¸€åˆ‡å·¥ç¨‹é¢†åŸŸï¼Œå‡¡æ˜¯æœ‰æœºæ¢°è®¾å¤‡çš„åœºåˆï¼Œéƒ½ç¦»ä¸å¼€æ¶²å‹ç³»ç»Ÿã€‚é«˜å‹æŸ±å¡æ³µæ˜¯é«˜ç«¯æ¶²å‹è£…å¤‡çš„æ ¸å¿ƒå…ƒä»¶ï¼Œè¢«ç§°ä½œæ¶²å‹ç³»ç»Ÿçš„â€œå¿ƒè„â€ã€‚ä¸­å›½æ¶²å‹å·¥ä¸šçš„è§„æ¨¡åœ¨2017å¹´å·²ç»æˆä¸ºä¸–ç•Œç¬¬äºŒï¼Œä½†äº§ä¸šå¤§è€Œä¸å¼ºï¼Œå°¤å…¶æ˜¯é¢å®šå‹åŠ›35MPaä»¥ä¸Šé«˜å‹æŸ±å¡æ³µï¼Œ90%ä»¥ä¸Šä¾èµ–è¿›å£ã€‚å›½å†…ç”Ÿäº§çš„æ¶²å‹æŸ±å¡æ³µä¸å¤–å›½å“ç‰Œç›¸æ¯”ï¼Œåœ¨æŠ€æœ¯å…ˆè¿›æ€§ã€å·¥ä½œå¯é æ€§ã€ä½¿ç”¨å¯¿å‘½ã€å˜é‡æœºæ„æ§åˆ¶åŠŸèƒ½å’ŒåŠ¨é™æ€æ€§èƒ½æŒ‡æ ‡ä¸Šéƒ½æœ‰è¾ƒå¤§å·®è·ï¼ŒåŸºæœ¬ç›¸å½“äºå›½å¤–ä¸Šä¸–çºª90å¹´ä»£åˆæ°´å¹³ã€‚

> æ¥æºï¼šã€Šé«˜å‹æŸ±å¡æ³µï¼Œé² åœ¨ä¸­å›½è£…å¤‡åˆ¶é€ ä¸šå’½å–‰çš„ä¸€æ ¹åˆºã€‹


##### èˆªç©ºè®¾è®¡è½¯ä»¶ 

è‡ªä¸Šä¸–çºª80å¹´ä»£åï¼Œä¸–ç•Œèˆªç©ºä¸šå°±è¿ˆå…¥æ•°å­—åŒ–è®¾è®¡çš„æ–°é˜¶æ®µï¼Œç°åœ¨å·²ç»è¾¾åˆ°ç¦»å¼€è½¯ä»¶å°±æ— æ³•è®¾è®¡çš„é«˜åº¦ä¾èµ–ç¨‹åº¦ã€‚è®¾è®¡ä¸€æ¶é£æœºè‡³å°‘éœ€è¦åå‡ ç§ä¸“ä¸šè½¯ä»¶ï¼Œå…¨æ˜¯æ¬§ç¾å›½å®¶äº§å“ã€‚å›½å†…è®¾è®¡å•ä½ä¸ä»…è¦æŠ•å…¥å·¨èµ„è´­ä¹°è½¯ä»¶ï¼Œè€Œä¸”å¤´æˆ´é’¢åœˆï¼Œä¸€æ—¦è¢«å¿µâ€œç´§ç®å’’â€ï¼Œæ•´ä¸ªèˆªç©ºäº§ä¸šå°†é™·å…¥ç˜«ç—ªã€‚æ®åª’ä½“æŠ¥é“ï¼Œè®¾è®¡æ­¼-10é£æœºæ—¶ï¼Œä¸»èµ·è½æ¶ä¸»æ‰¿åŠ›ç»“æ„çš„æ•´ä¸ªé‡‘å±éƒ¨ä»¶æ˜¯å§”æ‰˜å›½å¤–åˆ¶é€ ã€‚ä½†é€ å®Œä¹‹åï¼Œèµ·è½æ¶çš„æ”¶æ”¾å‡ºç°é—®é¢˜ï¼Œæœ‰5æ¯«ç±³çš„è¯¯å·®ï¼Œåªå¥½é‡æ–°è®¢è´§åˆ¶é€ ã€‚ä»…ä»…æ˜¯è¿™ä¸€ç‚¹ç‚¹çš„è¯¯å·®ï¼Œå½±å“äº†æ­¼-10é¦–é£æ¨è¿Ÿäº†å…«ä¹ä¸ªæœˆã€‚æ²¡æœ‰å…¨æ•°å­—åŒ–çš„è½¯ä»¶æ”¯æ’‘ï¼Œä»»ä½•ä¸€ç‚¹ç»†å¾®çš„è¯¯å·®ï¼Œéƒ½å¯èƒ½æˆä¸ºåˆ¶é€ ä¸šçš„æ¢¦é­‡ã€‚

> æ¥æºï¼šã€Šèˆªç©ºè½¯ä»¶å›°çª˜ï¼Œå›½äº§é£æœºè®¾è®¡æˆ´ä¸Šâ€œç´§ç®å’’â€ã€‹

##### å…‰åˆ»èƒ¶

æˆ‘å›½è™½ç„¶å·²æˆä¸ºä¸–ç•ŒåŠå¯¼ä½“ç”Ÿäº§å¤§å›½ï¼Œä½†é¢æ¿äº§ä¸šæ•´ä½“äº§ä¸šé“¾ä»è¾ƒä¸ºè½åã€‚ç›®å‰ï¼ŒLCDç”¨å…‰åˆ»èƒ¶å‡ ä¹å…¨éƒ¨ä¾èµ–è¿›å£ï¼Œæ ¸å¿ƒæŠ€æœ¯è‡³ä»Šè¢«TOKã€JSRã€ä½å‹åŒ–å­¦ã€ä¿¡è¶ŠåŒ–å­¦ç­‰æ—¥æœ¬ä¼ä¸šæ‰€å„æ–­ã€‚å°±æ‹¿åœ¨å›½é™…ä¸Šå…·æœ‰ä¸€å®šç«äº‰å®åŠ›çš„äº¬ä¸œæ–¹æ¥è¯´ï¼Œç›®å‰å·²å»ºç«‹17ä¸ªé¢æ¿æ˜¾ç¤ºç”Ÿäº§åŸºåœ°ï¼Œå…¶ä¸­æœ‰16ä¸ªå·²ç»æŠ•äº§ã€‚ä½†äº¬ä¸œæ–¹ç”¨äºé«˜ç«¯é¢æ¿çš„å…‰åˆ»èƒ¶ï¼Œä»ç„¶ç”±å›½å¤–ä¼ä¸šæä¾›ã€‚å…‰åˆ»èƒ¶ä¸»è¦æˆåˆ†æœ‰é«˜åˆ†å­æ ‘è„‚ã€è‰²æµ†ã€å•ä½“ã€æ„Ÿå…‰å¼•å‘å‰‚ã€æº¶å‰‚ä»¥åŠæ·»åŠ å‰‚ï¼Œå¼€å‘æ‰€æ¶‰åŠçš„æŠ€æœ¯éš¾é¢˜ä¼—å¤šï¼Œéœ€ä»ä½èšç‰©ç»“æ„è®¾è®¡å’Œç­›é€‰ã€åˆæˆå·¥è‰ºçš„ç¡®å®šå’Œä¼˜åŒ–ã€æ´»æ€§å•ä½“çš„ç­›é€‰å’Œæ§åˆ¶ã€è‰²æµ†ç»†åº¦æ§åˆ¶å’Œç¨³å®šã€äº§å“é…æ–¹è®¾è®¡å’Œä¼˜åŒ–ã€äº§å“ç”Ÿäº§å·¥è‰ºä¼˜åŒ–å’Œç¨³å®šã€æœ€ç»ˆä½¿ç”¨æ¡ä»¶åŒ¹é…å’Œå®½å®¹åº¦è°ƒæ•´ç­‰æ–¹é¢è¿›è¡Œè°ƒæ•´ã€‚å› æ­¤ï¼Œè¦è‡ªä¸»ç ”å‘ç”Ÿäº§ï¼ŒæŠ€æœ¯éš¾åº¦éå¸¸ä¹‹é«˜ã€‚

æ¥æºï¼šã€Šä¸­å›½åŠå¯¼ä½“äº§ä¸šå› å…‰åˆ»èƒ¶å¤±è‰²ã€‹

##### é«˜å‹å…±è½¨ç³»ç»Ÿ 

ç”µæ§æŸ´æ²¹é«˜å‹å…±è½¨ç³»ç»Ÿç›¸å½“äºæŸ´æ²¹å‘åŠ¨æœºçš„â€œå¿ƒè„â€å’Œâ€œå¤§è„‘â€ï¼Œå…¶å“è´¨çš„å¥½åï¼Œä¸¥é‡å½±å“å‘åŠ¨æœºçš„ä½¿ç”¨ã€‚æŸ´æ²¹æœºäº§ä¸šæ˜¯æ¨åŠ¨ä¸€ä¸ªå›½å®¶ç»æµå¢é•¿ã€ç¤¾ä¼šè¿è¡Œçš„é‡è¦è£…å¤‡åŸºç¡€ã€‚ä¸­å›½æ˜¯å…¨çƒæŸ´æ²¹å‘åŠ¨æœºçš„ä¸»è¦å¸‚åœºå’Œç”Ÿäº§å›½å®¶ï¼Œè€Œåœ¨å›½å†…çš„ç”µæ§æŸ´æ²¹æœºé«˜å‹å…±è½¨ç³»ç»Ÿå¸‚åœºï¼Œå¾·å›½ã€ç¾å›½å’Œæ—¥æœ¬ç­‰ä¼ä¸šå æ®äº†ç»å¤§ä»½é¢ã€‚å’Œå›½å¤–å…ˆè¿›å…¬å¸çš„äº§å“ç›¸æ¯”ï¼Œå›½äº§é«˜å‹å…±è½¨ç³»ç»Ÿåœ¨æ€§èƒ½ã€åŠŸèƒ½ã€è´¨é‡åŠä¸€è‡´æ€§ä¸Šè¿˜å­˜åœ¨ä¸€å®šçš„å·®è·ï¼Œæˆæœ¬ä¸Šçš„ä¼˜åŠ¿ä¹Ÿä¸æ˜æ˜¾ã€‚

> æ¥æºï¼šã€Šé«˜å‹å…±è½¨ä¸ä¸­ç”¨ï¼Œå›½äº§æŸ´æ²¹æœºå¾ˆå—ä¼¤ã€‹

##### é€å°„å¼ç”µé•œ 

å†·å†»ç”µé•œå¯ä»¥æ‹æ‘„å¾®è§‚ç»“æ„é«˜æ¸…3dâ€œå½©ç…§â€ï¼Œæ˜¯ç”Ÿå‘½ç§‘å­¦ç ”ç©¶çš„åˆ©å™¨ï¼Œé€å°„å¼ç”µé•œçš„ç”Ÿäº§èƒ½åŠ›æ˜¯å†·å†»ç”µé•œåˆ¶é€ èƒ½åŠ›çš„åŸºç¡€ä¹‹ä¸€ã€‚ç›®å‰ä¸–ç•Œä¸Šç”Ÿäº§é€å°„ç”µé•œçš„å‚å•†åªæœ‰3å®¶ï¼Œåˆ†åˆ«æ˜¯æ—¥æœ¬ç”µå­ã€æ—¥ç«‹ã€FEIï¼Œå›½å†…æ²¡æœ‰ä¸€å®¶ä¼ä¸šç”Ÿäº§é€å°„å¼ç”µé•œã€‚åŒ¹é…å†·å†»ç”µé•œä½¿ç”¨çš„å·¥å…·éƒ½éœ€è¦åŸè£…ï¼Œé›¶ä»¶åäº†æ‰¾ä¸åˆ°äººä¿®ç†ï¼Œåªèƒ½ç­‰å¾…é›¶ä»¶é‚®å¯„åˆ°è´§åè¿›è¡Œæ›´æ¢ã€‚å¯¹äºä¸­å›½çš„å†·å†»ç”µé•œä½¿ç”¨è€…ä»¬æ¥è¯´ï¼Œè¿™æ ·çš„ä½“éªŒå¯èƒ½è¿˜è¦æŒç»­ä¸çŸ­çš„æ—¶é—´ã€‚

> æ¥æºï¼šã€Šæˆ‘ä»¬çš„è›‹ç™½è´¨3Dé«˜æ¸…ç…§ç‰‡ä»°èµ–èˆ¶æ¥çš„é€å°„å¼ç”µé•œã€‹

##### æ˜è¿›æœºä¸»è½´æ‰¿ 

ä¸»è½´æ‰¿ï¼Œæœ‰å…¨æ–­é¢éš§é“æ˜è¿›æœºçš„â€œå¿ƒè„â€ä¹‹ç§°ï¼Œæ‰¿æ‹…ç€æ˜è¿›æœºè¿è½¬è¿‡ç¨‹çš„ä¸»è¦è½½è·ï¼Œæ˜¯åˆ€ç›˜é©±åŠ¨ç³»ç»Ÿçš„å…³é”®éƒ¨ä»¶ï¼Œå·¥ä½œæ‰€å¤„çŠ¶å†µååˆ†æ¶åŠ£ã€‚ä¸ç›´å¾„ä»…æœ‰å‡ ç™¾æ¯«ç±³çš„ä¼ ç»Ÿæ»šåŠ¨è½´æ‰¿ç›¸æ¯”ï¼Œæ˜è¿›æœºä¸»è½´æ‰¿ç›´å¾„ä¸€èˆ¬ä¸ºå‡ ç±³ï¼Œæ˜¯ç»“æ„æœ€å¤æ‚çš„ä¸€ç§è½´æ‰¿ï¼Œåˆ¶é€ éœ€è¦ä¸Šç™¾é“å·¥åºã€‚å°±æ˜è¿›æœºæ•´æœºåˆ¶é€ èƒ½åŠ›è€Œè¨€ï¼Œå›½äº§æ˜è¿›æœºå·²æ¥è¿‘ä¸–ç•Œæœ€å…ˆè¿›æ°´å¹³ï¼Œä½†æœ€å…³é”®çš„ä¸»è½´æ‰¿å…¨éƒ¨ä¾èµ–è¿›å£ã€‚å¾·å›½çš„ç½—ç‰¹è‰¾å¾·ã€IMOã€FAGå’Œç‘å…¸çš„SKFå æ®å¸‚åœºã€‚

> æ¥æºï¼šã€Šè‡ªå®¶çš„æ˜è¿›æœºå´ä¸å¾—ä¸ç”¨åˆ«äººçš„ä¸»è½´æ‰¿ã€‹

##### å¾®çƒ

å¾®çƒï¼Œç›´å¾„æ˜¯å¤´å‘ç²—ç»†çš„ä¸‰ååˆ†ä¹‹ä¸€ã€‚æ‰‹æœºå±å¹•é‡Œï¼Œæ¯å¹³æ–¹æ¯«ç±³è¦ç”¨ä¸€ç™¾ä¸ªå¾®çƒï¼Œæ’‘èµ·äº†ä¸¤å—ç»ç’ƒé¢æ¿ï¼Œç›¸å½“äºéª¨æ¶ï¼Œåœ¨ä¸¤å—ç»ç’ƒé¢æ¿çš„ç¼éš™é‡Œï¼Œå†çŒè¿›æ¶²æ™¶ã€‚å°‘äº†å®ƒï¼Œä½ æ­£ç›¯ç€çš„æ¶²æ™¶å±å¹•å°†æ— æ³•ç”Ÿäº§ã€‚æ²¡æœ‰å¾®çƒï¼ŒèŠ¯ç‰‡ç”Ÿäº§ã€é£Ÿå“å®‰å…¨æ£€æµ‹ã€ç–¾ç—…è¯Šæ–­ã€ç”Ÿç‰©åˆ¶è¯ã€ç¯å¢ƒç›‘æµ‹â€¦â€¦è®¸å¤šè¡Œä¸šéƒ½ä¼šé™·å…¥çª˜å¢ƒã€‚ä»…å¾®ç”µå­é¢†åŸŸï¼Œä¸­å›½æ¯å¹´å°±è¦è¿›å£ä»·å€¼å‡ ç™¾äº¿å…ƒäººæ°‘å¸çš„å¾®çƒã€‚2017å¹´ä¸­å›½å¤§é™†çš„æ¶²æ™¶é¢æ¿å‡ºè´§é‡è¾¾åˆ°å…¨çƒçš„33%ï¼Œäº§ä¸šè§„æ¨¡çº¦åƒäº¿ç¾å…ƒï¼Œä½å±…å…¨çƒç¬¬ä¸€ã€‚ä½†è¿™é¢æ¿ä¸­çš„å…³é”®ææ–™â€”â€”é—´éš”ç‰©å¾®çƒï¼Œä»¥åŠå¯¼ç”µé‡‘çƒï¼Œå…¨ä¸–ç•Œåªæœ‰æ—¥æœ¬ä¸€ä¸¤å®¶å…¬å¸å¯ä»¥æä¾›ã€‚è¿™äº›ææ–™ä¹ŸåƒèŠ¯ç‰‡ä¸€æ ·ï¼Œç»™äººå¡ä½äº†è„–å­ã€‚

> æ¥æºï¼šã€Šå¾®çƒï¼šæ°‘æ—å·¥ä¸šä¸èƒ½æ‰¿å—ä¹‹è½»ã€‹

##### æ°´ä¸‹è¿æ¥å™¨

é™¤äº†èˆ¹èˆ¶ã€é¥æ„Ÿå«æ˜Ÿï¼Œæµ·åº•è§‚æµ‹ç½‘å·²æˆä¸ºç¬¬ä¸‰ç§æµ·æ´‹è§‚æµ‹å¹³å°â€”â€”é€šè¿‡å®ƒï¼Œäººç±»å¯ä»¥æ·±å…¥åˆ°æ°´ä¸‹è§‚æµ‹å’Œè®¤è¯†æµ·æ´‹ã€‚å¦‚æœå°†å„ç±»ç¼†ç³»è§‚æµ‹å¹³å°æ¯”ä½œèƒ³è†Šã€è…¿ï¼Œæ°´ä¸‹è¿æ¥å™¨å°±å¥½æ¯”å…³èŠ‚ï¼Œå¯¹æµ·åº•è§‚æµ‹ç½‘ç³»ç»Ÿçš„å»ºè®¾ã€è¿è¡Œå’Œç»´æŠ¤æœ‰ç€ä¸å¯æ›¿ä»£çš„ä½œç”¨ã€‚ç›®å‰æˆ‘å›½æ°´ä¸‹è¿æ¥å™¨å¸‚åœºåŸºæœ¬è¢«å¤–å›½å„æ–­ã€‚ä¸€æ—¦è¯¥è¿æ¥å™¨æˆä¸ºç¦è¿å“ï¼Œæ•´ä¸ªæµ·åº•è§‚æµ‹ç½‘çš„å»ºè®¾å’Œè¿è¡Œå°†è¢«è¿«ä¸­æ–­ã€‚

> æ¥æºï¼šã€Šæ°´ä¸‹è¿æ¥ç¼ºå›½äº§åˆ©å™¨ï¼Œæµ·åº•è§‚æµ‹ç½‘å‚äººç¯±å£ã€‹

##### ç‡ƒæ–™ç”µæ± å…³é”®ææ–™ 

å›½å¤–çš„ç‡ƒæ–™ç”µæ± è½¦å·²å®ç°é‡äº§ï¼Œä½†æˆ‘å›½è½¦ç”¨ç‡ƒæ–™ç”µæ± è¿˜å¤„åœ¨æŠ€æœ¯éªŒè¯é˜¶æ®µã€‚æˆ‘å›½è½¦ç”¨ç‡ƒæ–™ç”µæ± çš„ç°çŠ¶æ˜¯â€”â€”å‡ ä¹æ— éƒ¨ä»¶ç”Ÿäº§å•†ï¼Œæ— è½¦ç”¨ç”µå †ç”Ÿäº§å…¬å¸ï¼Œåªæœ‰æå°‘é‡å•†ä¸šè¿è¡Œç‡ƒæ–™ç”µæ± è½¦ã€‚å¤šé¡¹å…³é”®ææ–™ï¼Œå†³å®šç€ç‡ƒæ–™ç”µæ± çš„å¯¿å‘½å’Œæ€§èƒ½ã€‚è¿™äº›ææ–™æˆ‘å›½å¹¶éå®Œå…¨æ²¡æœ‰ï¼Œæœ‰äº›å®éªŒå®¤æˆæœç”šè‡³å·²è¾¾åˆ°å›½é™…æ°´å¹³ã€‚ä½†æ˜¯ï¼Œæ²¡æœ‰æ‰¹é‡ç”Ÿäº§çº¿ï¼Œç‡ƒæ–™ç”µæ± äº§ä¸šé“¾ä¾ç„¶æ¢—é˜»ã€‚å…³é”®ææ–™é•¿æœŸä¾èµ–å›½å¤–ï¼Œä¸€æ—¦é­é‡ç¦å”®ï¼Œæˆ‘å›½çš„ç‡ƒæ–™ç”µæ± äº§ä¸šä¾¿æ²¡æœ‰äº†åŸºç¡€æ”¯æ’‘ã€‚

> æ¥æºï¼šã€Šå°‘äº†ä¸‰ç§å…³é”®ææ–™ï¼Œç‡ƒæ–™ç”µæ± å•†ä¸šåŒ–éš¾æˆæ–‡ç« ã€‹

##### é«˜ç«¯ç„Šæ¥ç”µæº 

æˆ‘å›½æ˜¯æµ·æ´‹å¤§å›½ï¼Œæ‹¥æœ‰300å¤šä¸‡å¹³æ–¹å…¬é‡Œæµ·åŸŸï¼Œæ­£åœ¨å¤§åŠ›å‘å±•é«˜ç«¯æµ·æ´‹èµ„æºå¼€å‘å’Œæµ·æ´‹ç»´æƒè£…å¤‡ã€‚æµ·é‡Œçš„è®¾å¤‡ä¸€æ—¦å‡ºç°å¼€è£‚ç­‰æ•…éšœï¼Œéœ€è¦ç”¨æœ‰å·¥ä¸šåˆ¶é€ â€œç¼çº«æœºâ€ä¹‹ç§°çš„ç„Šæ¥è£…å¤‡ä¿®è¡¥ã€‚æ·±æµ·ç„Šæ¥çš„å®ç°é æ°´ä¸‹æœºå™¨äººã€‚è™½ç„¶æˆ‘å›½æ˜¯å…¨çƒæœ€å¤§ç„Šæ¥ç”µæºåˆ¶é€ åŸºåœ°ï¼Œå¹´äº§èƒ½å·²è¶…1000ä¸‡å°å¥—ï¼Œä½†é«˜ç«¯ç„Šæ¥ç”µæºåŸºæœ¬ä¸Šä»è¢«å›½å¤–å„æ–­ã€‚æˆ‘å›½æ°´ä¸‹æœºå™¨äººç„Šæ¥æŠ€æœ¯ä¸€ç›´éš¾ä»¥æå‡ï¼ŒåŸå› æ˜¯é«˜ç«¯ç„Šæ¥ç”µæºæŠ€æœ¯å—åˆ¶äºäººã€‚å›½å¤–ç„Šæ¥ç”µæºå…¨æ•°å­—åŒ–æ§åˆ¶æŠ€æœ¯å·²ç›¸å¯¹æˆç†Ÿï¼Œ å›½å†…çš„ä»ä»¥æ¨¡æ‹Ÿæ§åˆ¶æŠ€æœ¯ä¸ºä¸»ã€‚

> æ¥æºï¼šã€Šå›½äº§ç„Šæ¥ç”µæºâ€œå“‘ç«â€ï¼Œæœºå™¨äººæ°´ä¸‹ä½œä¸šæœ‰å¿ƒæ— åŠ›ã€‹

#### é”‚ç”µæ± éš”è†œ 

ä½œä¸ºæ–°èƒ½æºè½¦çš„â€œå¿ƒè„â€ï¼Œå›½äº§é”‚ç¦»å­ç”µæ± ï¼ˆä»¥ä¸‹ç®€ç§°é”‚ç”µæ± ï¼‰ç›®å‰â€œè·³â€å¾—è¿˜ä¸å¤Ÿç¨³ã€‚ç”µæ± å››å¤§æ ¸å¿ƒææ–™ä¸­ï¼Œæ­£è´Ÿæææ–™ã€ç”µè§£æ¶²éƒ½å·²å®ç°äº†å›½äº§åŒ–ï¼Œå”¯ç‹¬éš”è†œä»æ˜¯çŸ­æ¿ã€‚é«˜ç«¯éš”è†œæŠ€æœ¯å…·æœ‰ç›¸å½“é«˜çš„é—¨æ§›ï¼Œä¸ä»…è¦æŠ•å…¥å·¨é¢çš„èµ„é‡‘ï¼Œè¿˜éœ€è¦æœ‰å¼ºå¤§çš„ç ”å‘å’Œç”Ÿäº§å›¢é˜Ÿã€çº¯ç†Ÿçš„å·¥è‰ºæŠ€æœ¯å’Œé«˜æ°´å¹³çš„ç”Ÿäº§çº¿ã€‚é«˜ç«¯éš”è†œç›®å‰ä¾ç„¶å¤§é‡ä¾èµ–è¿›å£ã€‚

> æ¥æºï¼šã€Šä¸€å±‚éš”è†œä¸¤é‡å¤©ï¼šå›½äº§é”‚ç”µæ± å°šéœ€æ‹¨äº‘è§æ—¥ã€‹

##### åŒ»å­¦å½±åƒè®¾å¤‡å…ƒå™¨ä»¶ 

ç›®å‰å›½äº§åŒ»å­¦å½±åƒè®¾å¤‡çš„å¤§éƒ¨åˆ†å…ƒå™¨ä»¶ä¾èµ–è¿›å£ï¼Œè‡³å°‘è¦èŠ±10å¹´ã€20å¹´æ‰èƒ½è¾¾åˆ°åˆ«äººçš„ç°æœ‰æ°´å¹³ã€‚åœ¨ä¼ ç»ŸåŒ»å­¦æˆåƒï¼ˆCTã€ç£å…±æŒ¯ç­‰ï¼‰ä¸Šï¼Œä¸­å›½æœ€æ—©çš„ä¸“åˆ©æ¯”ç¾å›½å¹³å‡æ™š20å¹´ã€‚åœ¨ä¸“åˆ©æ•°é‡ä¸Šï¼Œç¾å›½æ˜¯æˆ‘å›½çš„10å€ã€‚è¿™æ„å‘³ç€æ•´ä¸ªäº§ä¸šå·²ç»å®Œå…¨æŒæ¡åœ¨å›½å¤–ä¼ä¸šçš„æ‰‹é‡Œäº†ï¼Œæ‰€æœ‰çš„çŸ¥è¯†äº§æƒï¼Œæ‰€æœ‰çš„åŸåˆ›æˆæœï¼Œæ‰€æœ‰çš„ç§‘ç ”ç§¯ç´¯éƒ½åœ¨å›½å¤–ï¼Œä¸­å›½åªå å¾ˆå°‘çš„ä¸€éƒ¨åˆ†ã€‚

> æ¥æºï¼šã€Šæ‹™é’çš„æ¢æµ‹å™¨æ¨¡ç³Šäº†åŒ»å­¦å½±åƒã€‹

##### è¶…ç²¾å¯†æŠ›å…‰å·¥è‰º

è¶…ç²¾å¯†æŠ›å…‰å·¥è‰ºåœ¨ç°ä»£åˆ¶é€ ä¸šä¸­æœ‰å¤šé‡è¦ï¼Œå…¶åº”ç”¨çš„é¢†åŸŸèƒ½å¤Ÿç›´æ¥è¯´æ˜é—®é¢˜ï¼šé›†æˆç”µè·¯åˆ¶é€ ã€åŒ»ç–—å™¨æ¢°ã€æ±½è½¦é…ä»¶ã€æ•°ç é…ä»¶ã€ç²¾å¯†æ¨¡å…·ã€èˆªç©ºèˆªå¤©ã€‚â€œå®ƒæ˜¯æŠ€æœ¯çµé­‚â€ã€‚ç¾æ—¥ç‰¢ç‰¢æŠŠæ¡äº†å…¨çƒå¸‚åœºçš„ä¸»åŠ¨æƒï¼Œå…¶ææ–™æ„æˆå’Œåˆ¶ä½œå·¥è‰ºä¸€ç›´æ˜¯ä¸ªè°œã€‚æ¢è¨€ä¹‹ï¼Œè´­ä¹°å’Œä½¿ç”¨ä»–ä»¬çš„äº§å“ï¼Œå¹¶ä¸ä»£è¡¨å¯ä»¥ä»¿åˆ¶ç”šè‡³å¤åˆ¶ä»–ä»¬çš„äº§å“ã€‚

> æ¥æºï¼šã€Šé€šå¾€è¶…ç²¾å¯†æŠ›å…‰å·¥è‰ºä¹‹å·…ï¼Œè·¯é˜»ä¸”é•¿ã€‹

##### ç¯æ°§æ ‘è„‚ 

ç¢³çº¤ç»´è´¨é‡èƒ½æ¯”é‡‘å±é“è½»ï¼Œä½†å¼ºåº¦å´é«˜äºé’¢é“ï¼Œè¿˜å…·æœ‰è€é«˜æ¸©ã€è€è…èš€ã€è€ç–²åŠ³ã€æŠ—è •å˜ç­‰ç‰¹æ€§ï¼Œå…¶ä¸­ä¸€ä¸ªå…³é”®çš„å¤åˆè¾…æå°±æ˜¯ç¯æ°§æ ‘è„‚ã€‚ä½†ç›®å‰å›½å†…ç”Ÿäº§çš„é«˜ç«¯ç¢³çº¤ç»´ï¼Œæ‰€ä½¿ç”¨çš„ç¯æ°§æ ‘è„‚å…¨éƒ¨éƒ½æ˜¯è¿›å£çš„ã€‚ç›®å‰ï¼Œæˆ‘å›½å·²èƒ½ç”Ÿäº§T800ç­‰è¾ƒé«˜ç«¯çš„ç¢³çº¤ç»´ï¼Œä½†æ—¥æœ¬ä¸œä¸½æŒæ¡è¿™ä¸€æŠ€æœ¯çš„æ—¶é—´æ˜¯ä¸Šä¸–çºª90å¹´ä»£ã€‚ç›¸æ¯”äºç¢³çº¤ç»´ï¼Œæˆ‘å›½é«˜ç«¯ç¯æ°§æ ‘è„‚äº§ä¸šè½åäºå›½é™…çš„æƒ…å†µæ›´ä¸ºä¸¥é‡ã€‚

> æ¥æºï¼šã€Šç¯æ°§æ ‘è„‚éŸ§æ€§ä¸è¶³ï¼Œå›½äº§ç¢³çº¤ç»´ç¼ºè‚¡åŠ²å„¿ã€‹

##### é«˜å¼ºåº¦ä¸é”ˆé’¢ 

ç”¨äºç«ç®­å‘åŠ¨æœºçš„é’¢æéœ€å…·å¤‡å¤šç§ç‰¹æ€§ï¼Œå…¶ä¸­é«˜å¼ºåº¦æ˜¯å¿…é¡»æ»¡è¶³çš„é‡è¦æŒ‡æ ‡ã€‚ç„¶è€Œï¼Œä¸é”ˆé’¢çš„å¼ºåº¦å’Œé˜²é”ˆæ€§èƒ½ï¼Œå´æ˜¯é±¼å’Œç†ŠæŒèˆ¬éš¾ä»¥å…¼å¾—çš„çŸ›ç›¾ä½“ã€‚ç«ç®­å‘åŠ¨æœºææ–™å¦‚æœå¦‚æœä¸¥é‡ç”Ÿé”ˆï¼Œå°†å¸¦æ¥å¾ˆå¤§å½±å“ã€‚å®Œå…¨ä¾é ææ–™è‡ªèº«å®ç°é«˜å¼ºåº¦å’Œé˜²é”ˆæ€§èƒ½å…¼å¤‡ï¼Œè¿™æ˜¯ä¸–ç•Œæ€§éš¾é¢˜ã€‚ç°åœ¨ï¼Œæˆ‘å›½èˆªå¤©ææ–™å¤§å¤šç”¨çš„æ˜¯å›½å¤–ä¸Šä¸–çºªå…­ä¸ƒåå¹´ä»£ç”¨çš„ææ–™ï¼Œå‘è¾¾å›½å®¶åœ¨ç”Ÿäº§è¿‡ç¨‹ä¸­ä¼šä¸¥æ ¼æ§åˆ¶æ‚è´¨å«é‡ï¼Œå¦‚æœçº¯åº¦ä¸è¾¾æ ‡ï¼Œä¾¿é‡æ–°å›ç‚‰ï¼Œä½†å›½å†…å‚å®¶å¾€å¾€ç¼ºä¹è¿™ç§ä¸¥è°¨çš„æ€åº¦ã€‚

> æ¥æºï¼šã€Šå»ä¸æ‰çš„ç«ç®­å‘åŠ¨æœºâ€œé”ˆç–¾â€ã€‹


##### æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ

ç›®å‰å…¨ä¸–ç•Œæœ€æµè¡Œçš„ä¸¤ç§æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ˜¯Oracleå’ŒMySQLï¼Œéƒ½æ˜¯ç”²éª¨æ–‡å…¬å¸æ——ä¸‹çš„äº§å“ã€‚ç«äº‰è€…è¿˜æœ‰IBMå…¬å¸ä»¥åŠå¾®è½¯å…¬å¸çš„äº§å“ç­‰ã€‚ç”²éª¨æ–‡ã€IBMã€å¾®è½¯å’ŒTeradataå‡ å®¶ç¾å›½å…¬å¸ï¼Œå äº†å¤§éƒ¨åˆ†å¸‚åœºä»½é¢ã€‚æ•°æ®åº“ç®¡ç†ç³»ç»Ÿå›½è´§ä¹Ÿæœ‰å¸‚åœºä»½é¢ï¼Œä½†åªæ˜¯ä¸ªé›¶å¤´ï¼Œå…¶ç¨³å®šæ€§ã€æ€§èƒ½éƒ½æ— æ³•è®©å¸‚åœºä¿¡æœï¼Œé“¶è¡Œã€ç”µä¿¡ã€ç”µåŠ›ç­‰è¦æ±‚æç«¯ç¨³å¦¥çš„ä¼ä¸šï¼Œä¸ä¼šè€ƒè™‘å›½è´§ã€‚

> æ¥æºï¼šã€Šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼šä¸­å›½è¿˜åœ¨å¯»æ‰¾â€œæ­£ç¡®æ‰“å¼€æ–¹å¼â€ã€‹

##### æ‰«æç”µé•œ 

æ‰«æç”µå­æ˜¾å¾®é•œï¼Œä¸€ç§é«˜ç«¯çš„ç”µå­å…‰å­¦ä»ªå™¨ï¼Œå®ƒè¢«å¹¿æ³›åœ°åº”ç”¨äºææ–™ã€ç”Ÿç‰©ã€åŒ»å­¦ã€å†¶é‡‘ã€åŒ–å­¦å’ŒåŠå¯¼ä½“ç­‰å„ä¸ªç ”ç©¶é¢†åŸŸå’Œå·¥ä¸šéƒ¨é—¨ï¼Œè¢«ç§°ä¸ºâ€œå¾®è§‚ç›¸æœºâ€ç›®å‰æˆ‘å›½ç§‘ç ”ä¸å·¥ä¸šéƒ¨é—¨æ‰€ç”¨çš„æ‰«æç”µé•œä¸¥é‡ä¾èµ–è¿›å£ï¼Œæ¯å¹´æˆ‘å›½èŠ±è´¹è¶…è¿‡1äº¿ç¾å…ƒé‡‡è´­çš„å‡ ç™¾å°æ‰«æç”µé•œä¸­ï¼Œä¸»è¦äº§è‡ªç¾ã€æ—¥ã€å¾·å’Œæ·å…‹ç­‰å›½ã€‚å›½äº§æ‰«æç”µé•œåªå çº¦5%â€”10%ã€‚

> æ¥æºï¼šã€Šæ‰«æç”µé•œâ€œå¼±è§†â€ï¼Œå·¥ä¸šåˆ¶é€ éš¾ä»¥æ˜å¯Ÿç§‹æ¯«ã€‹


__ä¹Ÿè®¸ä¹ å¤§å¤§çœ‹å®Œæˆ‘çš„ç¬¬äºŒä¸ªäº”å¹´è®¡åˆ’ä¹Ÿä¼šæ½¸ç„¶æ³ªä¸‹.__

æˆ‘è§‰å¾—ç›¸æ¯”è®¸å®¶å°å¯Œè±ªé€ è½¦ï¼Œä¸å¦‚ä»–æŠ•èµ„ä¸€ä¸‹æˆ‘å¼€ä¸ªå¤§å­¦å¹²æˆ‘è¿™ä¸ªæƒ³æ³•ï¼Œæ¯”ä»–é€ è½¦æ›´æœ‰æ„ä¹‰ï¼Œè¿™å…³ä¹äºå›½å®¶å‰é€”çš„å‘½è¿ã€‚ç„¶è€Œæˆ‘è¿˜æ˜¯ä¸ªä¸èƒ½è§£å†³æ¸©é¥±çš„å·¥äººé˜¶çº§è°ˆè¿™ä¸ªæœ‰ç‚¹çº¸ä¸Šè°ˆå…µäººå¾®è¨€è½»ã€‚

å…¶å®æˆ‘æ¸…æ¥šçš„çŸ¥é“ç¬¬3ä¸ªè®¡åˆ’æœ‰ç‚¹æ‰¯æ·¡,ä½†æˆ‘ä¸èƒ½æ²¡æœ‰æ¢¦æƒ³.ä¸‡ä¸€å®ç°äº†å‘¢.

æˆ‘è®¤ä¸ºæˆ‘ä»¬æ€»å¬åˆ°èº«è¾¹äººè¯´ä¸­å›½è¿™ä¸å¦‚å¤–å›½é‚£ä¸å¦‚å¤–å›½,ä½†å…·ä½“å“ªé‡Œä¸å¦‚å¤–å›½æˆ‘ä»¬ä¸€æ—¶åŠä¼šè¿˜è¯´ä¸æ¸…æ¥š.çœ‹äº†è¿™34+é¡¹å¡è„–å­æŠ€æœ¯å°±çŸ¥é“äº†æˆ‘ä»¬å›½å®¶çš„çŸ­æ¿åœ¨å“ª,æˆ‘ä»¬è¿™ä¸€ä»£äººæ‰€éœ€è¦åŠªåŠ›çš„åœ°æ–¹åœ¨å“ªé‡Œ.æˆ‘ä»¬æœ€å¤§çš„æ‚²å‰§æ˜¯ä¸çŸ¥è‡ªå·±å’Œå…¶å®ƒå¼ºå›½çš„å…·ä½“å·®è·åˆ°åº•åœ¨å“ªé‡Œ,æˆ‘ç›¸ä¿¡çœ‹å®Œ[è¿™ç¯‡æ–‡ç« ](https://mp.weixin.qq.com/s/ms2TbtZyEHYqoQGHQrJY5A)ä½ å°†æœ‰æ‰€æ”¶è·.

###  æ€»ç»“

æ¯å½“å†™å¹´ç»ˆæ€»ç»“çš„æ—¶å€™åˆ«äººéƒ½ä¼šç»™äºˆæˆ‘ç¾¡æ…•çš„ç›®å…‰,æˆ‘æƒ³è¯´æˆ‘åªæ˜¯æŒ£æ‰åœ¨æ¸©é¥±çº¿ä¸Šå‹‰å¼ºåº¦æ—¥.åœ¨æ²¡æœ‰`å¯¹ä»·`çš„æ¡ä»¶ä¸‹åªèƒ½ç›´é¢æƒ¨æ·¡çš„äººç”Ÿ.2020å¹´å¾—ç»§ç»­å¥‹æ–—.ä¸ä½†è¦ä¸ºäº†å›½å®¶å’Œäººæ°‘å¯¹ç¾å¥½ç”Ÿæ´»çš„å‘å¾€,è¿˜è¦ä¸ºäº†è‡ªå·±è¯—å’Œè¿œæ–¹.

å¹´åå°šåœ¨,å²æœˆå°šå¥½.





URL: https://sunyazhou.com/2019/12/Chisel/index.html.md
Published At: 2019-12-06 11:09:25 +0000

# ç®€å•äº†è§£LLDBè°ƒè¯•å·¥å…·chisel

![](/assets/images/20191206Chisel/lldb1.webp)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


æœ€è¿‘æ¯”è¾ƒæ‡’ Xcdeoæ¯æ¬¡å¯åŠ¨çš„æ—¶å€™éƒ½ä¼šæŠ¥ä¸€ä¸ªæ‰¾ä¸åˆ°æŸæŸpythonæ–‡ä»¶çš„logåœ¨lldbä¸­,ä¸ºäº†ä¸€æ¢ç©¶ç«Ÿ,èŠ±äº†ç‚¹æ—¶é—´ç®€å•ä¿®å¤äº†


# chiselæ˜¯å•¥ï¼Ÿ

è¿™ä¸ªé—®é¢˜æˆ‘è¦æ˜¯å›ç­”å®Œéƒ½ä¼šè¢«iOSå¼€å‘è€…ç¬‘è¯æ­»,è¿™ä¸ªå·¥å…·facebookéƒ½å¼€æºå¾ˆä¹…äº†,åªæ˜¯è‡ªå·±ä»¥å‰ç ”ç©¶è¿‡,æ¢ä¸ªç”µè„‘æ‡’å¾—å¸ƒç½®ç¯å¢ƒ.ä¸€ç›´æ²¡å½“å›äº‹,è¿™å‡ å¤©å¼€å‘é‡åˆ°äº†æ§åˆ¶å°é—®é¢˜é¡ºæ‰‹çœ‹åˆ°äº†,æƒ³æ¥æ•´ç†ä¸€ä¸‹.


é¦–å…ˆè¿™ä¸ªå·¥å…·çš„çš„åœ°å€åœ¨[https://github.com/facebook/chisel](https://github.com/facebook/chisel)


è¿™é‡Œé¢æä¾›çš„å®‰è£…æ–¹æ³•å¦‚ä¸‹:

``` sh
brew update
brew install chisel
```

> é€šè¿‡ brew å®‰è£…å®Œå°±è¡Œäº†

ç„¶åå®ƒä¼šå‘Šè¯‰ä½ çœ‹ä¸‹ç”¨æˆ·homeç›®å½•æœ‰ä¸ªéšè—æ–‡ä»¶ `.lldbinit`å¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸‹

``` sh
touch .lldbinit 
open .lldbinit   

```

![](/assets/images/20191206Chisel/lldbinit.webp)

åˆ›å»ºå®Œ æŠŠè„šæœ¬å‘½ä»¤æè¿›å»  è¿™é‡Œæˆ‘å°±ä¸è¯´å®˜æ–¹çš„å†™æ³•äº† è·Ÿå±ä¸€æ ·ä¸€ç‚¹ä¸å¥½ä½¿


æˆ‘è´´ä¸€ä¸‹æˆ‘çš„æ·»åŠ æ–¹æ³•.

![](/assets/images/20191206Chisel/lldb2.webp)

è¿™æ˜¯æˆ‘ç”¨æœ¬åœ°ç”µè„‘å®‰è£…å®Œæˆä¹‹åçš„è·¯å¾„å›¾

``` sh
### Chisel LLDB add by sunyazhou
command script import /usr/local/Cellar/chisel/1.8.1/libexec/fblldb.py

```

æœ¬åœ°çš„ .lldbinit æ–‡ä»¶ä¸­åŠ å…¥ä¸Šä»£ç  è®°å¾—å¿…é¡»å¯¹åº”ä¸Šè·¯å¾„.ç„¶åé‡å¯Xcodeè¿è¡Œå³å¯åœ¨æ§åˆ¶å°ä½¿ç”¨æ— é—®é¢˜

ç”±äºè¿™ä¸ªæ–‡ä»¶ä¼šè¢«Revealæ”¹åŠ¨ æ‰€ä»¥ç»å¸¸ä¼šæœ‰å„ç§lldbå·¥å…·ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶

``` sh
### Chisel LLDB add by sunyazhou
command script import /usr/local/Cellar/chisel/1.8.1/libexec/fblldb.py
###

### LLDB https://github.com/DerekSelander/LLDB
command script import /Users/sunyazhou/LLDB-master/lldb_commands/dslldb.py
###

### Reveal LLDB commands support - DO NOT MODIFY
command script import /Users/sunyazhou/Library/Application\ Support/Reveal/RevealServerCommands.py
### 

```



## chiselç”¨æ³•


* `pvc`ï¼šæŸ¥çœ‹å½“å‰æ§åˆ¶å™¨çŠ¶æ€   
* `pviews`ï¼šæŸ¥çœ‹UIWindowåŠå…¶å­è§†å›¾å±‚çº§å…³ç³»  
* `presponder`ï¼šæ‰“å°ä¸€ä¸ªå¯¹è±¡çš„å“åº”é“¾å…³ç³»  
* `pclass`:æ ¹æ®å†…å­˜åœ°å€æ‰“å°ç›¸å…³ä¿¡æ¯  
* `visualize`ï¼šä½¿ç”¨macç³»ç»Ÿpreviewç¨‹åºæŸ¥çœ‹UIImageã€CGImageã€UIViewã€CALayerã€NSData(of an UIImage)ã€UIColorã€CIColorã€‚  
* `show`/`hide`ï¼šæ˜¾ç¤ºoréšè—ä¸€ä¸ªUIView  
* `mask`/`umask`ï¼šç»™ä¸€ä¸ªUIViewæˆ–CALayeræ·»åŠ ä¸€ä¸ªåŠé€æ˜è’™ç‰ˆ  
* `border`/`unborder`ï¼šç»™æŒ‡å®šçš„UIViewæˆ–CALayeræ·»åŠ è¾¹æ¡†æˆ–ç§»é™¤è¾¹æ¡†ç”¨äºè°ƒè¯•ï¼Œè®°å¾—æ‰§è¡Œåç´§æ¥ç€æ‰§è¡Œcaflush   
* `caflush`ï¼šåˆ·æ–°ç•Œé¢UIï¼Œç±»ä¼¼äºå‰é¢ä»‹ç»çš„flush  
* `bmessage`ï¼šæ·»åŠ ä¸€ä¸ªæ–­ç‚¹ï¼Œå³ä½¿è¿™ä¸ªå‡½æ•°åœ¨å­ç±»æ²¡æœ‰å®ç°ï¼ˆæ¯”å¦‚è¯´åœ¨UIViewControllerä¸­æƒ³åœ¨viewWillAppearä¸­æ‰“æ–­ç‚¹ï¼Œä½†æ˜¯å¾ˆå¯èƒ½æ²¡æœ‰å®ç°çˆ¶ç±»æ–¹æ³•ï¼Œå°±å¯ä»¥é€šè¿‡bmessage [UIViewController viewWillAppear:]æ·»åŠ ï¼‰  
* `wivar`ï¼šç›¸å½“äºkvoï¼Œç›‘å¬ä¸€ä¸ªå˜é‡ï¼Œä¾‹å¦‚wivar self _subviews  
* `taplog`ï¼šå¼€å¯ç‚¹å‡»logåŠŸèƒ½ï¼Œå½“ç‚¹å‡»æŸä¸ªæ§ä»¶æ—¶ä¼šæ‰“å°ç›¸å…³æ§ä»¶çš„ä¿¡æ¯  
* `paltrace`ï¼š æ‰“å°æŒ‡å®šviewçš„è‡ªåŠ¨å¸ƒå±€ä¿¡æ¯,æ¯”å¦‚:paltrace self.view  
* `ptv`ï¼šæ‰“å°å½“å‰ç•Œé¢ä¸­çš„UITableViewï¼Œç›¸å¯¹åº”çš„è¿˜æœ‰pcellsæ‰“å°å½“å‰ç•Œé¢ä¸­çš„UITableViewCell
* `pdata`ï¼šDataçš„stringè§£ç 
* `vs`ï¼šæœç´¢æŒ‡å®šçš„viewå¹¶åŠ ä¸ŠåŠé€æ˜è’™ç‰ˆï¼ˆåŒ…å«å­å‘½ä»¤ï¼‰ï¼Œä¾‹å¦‚ï¼švs 0x13a9efe00 å°±å¯ä»¥æ ‡æ³¨å‡ºå¯¹åº”çš„æ§ä»¶
* `slowanim`/`unslowanim`ï¼šé™ä½(æˆ–å–æ¶ˆ)åŠ¨ç”»é€Ÿåº¦,é»˜è®¤0.1 ï¼Œå¯ä»¥åœ¨ä»»æ„æ–­ç‚¹æˆ–Xcodeæš‚å®šæ‰§è¡Œslowanimå³å¯ï¼Œæ–¹ä¾¿åŠ¨ç”»è°ƒè¯•  



æ¼”ç¤ºæ•ˆæœ

![](/assets/images/20191206Chisel/lldb3_chisel.webp)

##  å…¶å®ƒè°ƒè¯•lldbæœ‰å“ªäº›ï¼Ÿ

[lldb_commands](https://github.com/DerekSelander/LLDB) æ˜¯å¦ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„lldbæ‰©å±•åº“ï¼Œå…¶ä¸­æä¾›äº†å¾ˆå¤šå®ç”¨çš„æ–‡ä»¶æ“ä½œ

`ls`ï¼šæ˜¾ç¤ºæŒ‡å®šè·¯å¾„çš„ç›®å½•æˆ–æ–‡ä»¶åˆ—è¡¨
`pexecutable`ï¼šæ‰“å°å½“å‰å¯æ‰§è¡Œæ–‡ä»¶æ‰€åœ¨ä½ç½®
`dumpenv`ï¼šæŸ¥çœ‹ç¯å¢ƒä¿¡æ¯ï¼Œæ¯”å¦‚è¯´æ²™ç›’åœ°å€
`yoink`ï¼šæ‹·è´æŒ‡å®šç›®å½•çš„æ–‡ä»¶åˆ°macçš„ä¸´æ—¶ç›®å½•
`keychain`ï¼šæŸ¥çœ‹keychainä¿¡æ¯


# æ€»ç»“

å·¥æ¬²å–„å…¶äº‹ å¿…å…ˆåˆ©å…¶å™¨,ä½œä¸ºä¸€ä¸ªiOSå¼€å‘å¦‚æœæƒ³åšåˆ°æè‡´å°±éœ€è¦æˆ‘ä»¬å¥½çš„å·¥å…·éƒ½éœ€è¦è¯•è¯•,è¿™æ ·èƒ½ä¸æ–­æé«˜ç”Ÿäº§æ•ˆç‡


[å‚è€ƒ iOSå¼€å‘è°ƒè¯•æ¦‚è§ˆ](https://www.cnblogs.com/kenshincui/p/11953536.html)


URL: https://sunyazhou.com/2019/12/MathGraphicTool/index.html.md
Published At: 2019-12-04 18:12:58 +0000

# å›¾å½¢ç¤ºæ„ç»˜åˆ¶å·¥å…·

![](/assets/images/20191204MathGraphicTool/MathGraphic.webp)

# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



ä»¥å‰ç»å¸¸å†™ä¸€äº›åŠ¨ç”»éœ€è¦æè¿°ç¤ºæ„å›¾å½¢çš„è¿åŠ¨å›¾.è¿™æ ·èƒ½ç”ŸåŠ¨å½¢è±¡çš„è¡¨è¿°æˆ‘æ‰€è®²è¿°çš„å†…å®¹åˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„
 

æœ€è¿‘å‘ç°äº†ä¸€ä¸ªç½‘ç«™,ä¸“é—¨åšæ•°å­¦å›¾å½¢ç»˜åˆ¶

# [https://www.geogebra.org/](https://www.geogebra.org/)



è¿™é‡Œæ•°å­¦ä¸Šç”¨çš„ä¸œè¥¿éƒ½æ˜¯å¯ä»¥ç›´æ¥æ‹¿æ¥ä½¿ç”¨çš„,æ¯”å¦‚ç”»ä¸ªåæ ‡ç³» è¡¨è¿°ä¸€ä¸‹ åŠ¨ç”»è¿åŠ¨è½¨è¿¹ç­‰

![](/assets/images/20191204MathGraphicTool/MathGraphicOverView.gif)




URL: https://sunyazhou.com/2019/09/MasonryPanViewDemo/index.html.md
Published At: 2019-09-26 20:05:20 +0000

# ä½¿ç”¨Masonryçº¦æŸå®ç°ç®€å•çš„é«˜çº§æ‹–æ‹½è§†å›¾

![](/assets/images/20190926MasonryPanViewDemo/panviewdemo.gif)


# å‰è¨€

æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!



## èƒŒæ™¯

æœ€è¿‘å¼€å‘é‡åˆ°ä¸€ä¸ªä¸Šå›¾çš„éœ€æ±‚,åšä¸€ä¸ªæŒ‚ä»¶èƒ½å››å¤„æ‹–åŠ¨å¹¶ä¸”ä¸Šè¾¹è¿˜æ—¶ä¸æ—¶çš„å±•ç¤ºä¸€ä¸ªtipsæ°”æ³¡çš„`Label`,åœ¨å°½é‡ä½¿ç”¨å°‘çš„ä»£ç æ¥å®ç°è¿™ä¸ªåŠŸèƒ½,ä½œä¸ºæˆ‘æ‰‹ä¸€åiOSå¼€å‘äººå‘˜å¿…é¡»ä¸¥æ ¼è€ƒç©¶è¿™ä¸ªéœ€æ±‚,æ˜¾ç„¶è¿™æœ‰ç‚¹éº»çƒ¦,ä¸€è´¯æ‡’æƒ°æˆ‘çš„å®åœ¨ä¸æƒ³è®¡ç®—å“ªä¸ªè¾¹å“ªä¸ªè§’ç”šè‡³æ»‘åŠ¨åˆ°å“ªé‡Œçš„`frame`,è®¡ç®—frameè¿™æ—¢å¬èµ·æ¥å¯ç¬‘åˆè§‰çš„æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡. ä¸ºäº†è®©ä»£ç é‡å°‘å¹¶ä¸”èƒ½æ»¡è¶³éœ€æ±‚,æˆ‘é€‰æ‹©ä½¿ç”¨Masonryæ¥å®ç°è¿™ä¸ªåŠŸèƒ½


## å¼€æ

é¦–å…ˆæˆ‘æèµ·ä¹‹å‰æˆ‘å»ºè®®å¤§å®¶çœ‹ä¸‹[åœŸåœŸå“¥](http://tutuge.me/)çš„[æœ‰è¶£çš„Autolayoutç¤ºä¾‹1~5Masonryå®ç°æ–‡ç« ](http://tutuge.me/tags/Masonry/),æœ¬æ–‡ä¹Ÿæ˜¯å‚è€ƒåœŸåœŸå“¥çš„æ–‡ç« å­¦ä¹ å†™å‡ºçš„,è§ç¬‘äº†å„ä½,ä¸ªäººè®¤ä¸ºåœŸåœŸå“¥çš„æ–‡ç« ç®€ç›´å°±æ˜¯Masonryè‡ªåŠ¨å¸ƒå±€çš„æ ·æ¿æ•™ç¨‹,å¼ºçƒˆå»ºè®®å…¥é—¨çš„å°ä¼™ä¼´æˆ–è€…é«˜æ‰‹ç»å¸¸å¤å†™.


ä¸‹é¢çš„å›¾æ˜¯åœŸåœŸå“¥å®ç°çš„demo  
![](/assets/images/20190926MasonryPanViewDemo/tutugeMasonry1.gif)

![](/assets/images/20190926MasonryPanViewDemo/tutugeMasonry2.gif)


ä½†æˆ‘çš„é—®é¢˜æ˜¯æ€ä¹ˆä¿è¯é‚£ä¸ªtipçš„æ°”æ³¡labelå·¦å³æ‹–æ‹½èƒ½è¾—è½¬è…¾æŒªçš„å…è®¸logoå›¾åƒä¹‹é—´æœ‰`æ—·é‡ç§»åŠ¨`

## ä»£ç å®ç°æ—·é‡ç§»åŠ¨


é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªdemo,å¾ˆç®€å•VCçš„demoå°±è¡Œ åˆ›å»ºç›¸å…³ç»¿è‰²èƒŒæ™¯è§†å›¾å’Œå›¾åƒimageViewä»¥åŠtipLabelçš„æ°”æ³¡è§†å›¾,å…·ä½“ä»£ç æˆ‘è´´äº†å‡ºæ¥,æˆ‘å°±ä¸å•°å—¦å¦‚ä½•åˆ›å»ºå…¶å®ƒè§†å›¾äº†xibæ‹–æ‹½ä¸€ä¸‹å°±è¡Œäº†.

``` objc
#import "ViewController.h"
#import <Masonry/Masonry.h>

@interface ViewController ()
@property (weak, nonatomic  ) IBOutlet UIView        *greenView;
@property (weak, nonatomic  ) IBOutlet UIImageView   *widgetView;
@property (weak, nonatomic  ) IBOutlet UILabel       *bubbleTitleLabel;

@property (nonatomic, strong) MASConstraint *leftConstraint; //å·¦ä¾§çº¦æŸå˜é‡
@property (nonatomic, strong) MASConstraint *topConstraint;  //é¡¶éƒ¨çº¦æŸå˜é‡

@end


```

è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ª`leftConstraint `å’Œ`topConstraint `çš„çº¦æŸå…¨å±€å˜é‡,è¿™ä¸¤ä¸ªå°±æ˜¯å®ç°æ‹–æ‹½çš„æ—¶å€™æ”¹å˜çº¦æŸçš„åç§»é‡æ¥å®ç°çš„.å…·ä½“ä»£ç å¦‚ä¸‹


``` objc
CGFloat screenWidth = [UIScreen mainScreen].bounds.size.width;
CGFloat screenHeight = [UIScreen mainScreen].bounds.size.height;
[self.widgetView mas_makeConstraints:^(MASConstraintMaker *make) {
    // è®¾ç½®è¾¹ç•Œæ¡ä»¶çº¦æŸï¼Œä¿è¯å†…å®¹å¯è§ï¼Œä¼˜å…ˆçº§1000
    make.left.greaterThanOrEqualTo(self.greenView.mas_left);
    make.right.lessThanOrEqualTo(self.greenView.mas_right);
    make.top.greaterThanOrEqualTo(self.greenView.mas_top);
    make.bottom.lessThanOrEqualTo(self.greenView.mas_bottom);
    
    self.leftConstraint = make.centerX.equalTo(self.greenView.mas_left).with.offset(screenWidth - 20).priorityHigh(); // ä¼˜å…ˆçº§è¦æ¯”è¾¹ç•Œæ¡ä»¶ä½
    self.topConstraint = make.centerY.equalTo(self.greenView.mas_top).with.offset(screenHeight - 100).priorityHigh(); // ä¼˜å…ˆçº§è¦æ¯”è¾¹ç•Œæ¡ä»¶ä½
    make.width.height.mas_equalTo(@100);
}];
```
ä¸Šè¾¹çš„`greaterThanOrEqualTo`å’Œ`lessThanOrEqualTo`éƒ½æ˜¯é™åˆ¶æŒ‚ä»¶çš„å¯æ»‘åŠ¨èŒƒå›´,è€Œæœ€åçš„`make.centerX/Y.equalTo`æ˜¯é™åˆ¶æŒ‚ä»¶çš„é»˜è®¤ä½ç½®,æˆ‘è®©å®ƒé»˜è®¤åœ¨å³ä¸‹è§’,æ‰€ä»¥é€šè¿‡åç§»é‡ç§»åŠ¨è¿‡å»

> æ³¨æ„:è¿™é‡Œæœ‰ä¸ªå‘å°±æ˜¯å› ä¸ºè¿™ä¸ªä¸œè¥¿èƒ½å››å¤„æ»‘åŠ¨ æ‰€ä»¥åŸºæœ¬éœ€è¦é”å®š`left`å’Œ`top`,æˆ‘å‘ç°åªæœ‰é€šè¿‡offsetç§»åŠ¨æ‰èƒ½ç¡®å®šæœ€åˆä½ç½®,å¦‚æœequalToç›´æ¥å†™æˆxxxviewçš„bottomæˆ–è€…rightæ˜¯æ»‘åŠ¨ä¸äº†çš„,ä»”ç»†æ€è€ƒä¸€ä¸‹masonryå°±çŸ¥é“ä¸ºå•¥äº†.

ç„¶åæ·»åŠ æ‰‹åŠ¿å¹¶å®ç°ç›¸å…³æ»‘åŠ¨äº‹ä»¶å³å¯å®ç°æ»‘åŠ¨

``` objc
UIPanGestureRecognizer *pan = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(panWithGesture:)];
[self.greenView addGestureRecognizer:pan];

...

- (void)panWithGesture:(UIPanGestureRecognizer *)pan {
    CGPoint touchPoint = [pan locationInView:self.greenView];
    self.leftConstraint.offset = touchPoint.x;
    self.topConstraint.offset = touchPoint.y;
}
        
```


#### æ—·é‡Labelçš„çº¦æŸ

``` objc
[self.bubbleTitleLabel mas_remakeConstraints:^(MASConstraintMaker *make) {
	make.height.equalTo(@26);
	make.bottom.equalTo(self.widgetView.mas_top);
	make.left.greaterThanOrEqualTo(self.greenView.mas_left).offset(0);
	make.right.lessThanOrEqualTo(self.greenView.mas_right).offset(0);
	make.centerX.lessThanOrEqualTo(self.widgetView.mas_right).offset(10);
	make.centerX.greaterThanOrEqualTo(self.widgetView.mas_left).offset(-10);
}];
```

æƒ³è¦å®ç°æ—·é‡ç§»åŠ¨å¿…é¡»å¢åŠ æ›´å¤šçš„çº¦æŸé™åˆ¶

è¿™é‡Œå°±å¢åŠ äº†

``` objc
make.centerX.lessThanOrEqualTo(self.widgetView.mas_right).offset(10);
make.centerX.greaterThanOrEqualTo(self.widgetView.mas_left).offset(-10);
```

è¿™æ ·å°±å®ç°äº† å·¦å³è¶…è¿‡æ»‘åŠ¨ä¾¿å®œè¿˜ä¾ç„¶æ§åˆ¶ç€tipçš„labelå·¦å³ç§»åŠ¨èŒƒå›´.


# æ€»ç»“

ç»è¿‡å·¥ä½œä¸­é‡åˆ°çš„é—®é¢˜å®ä¾‹,å­¦ä¹ äº†ä¸€äº›Masonryçš„æŠ€å·§,å¸Œæœ›å’Œå¤§å®¶åˆ†äº«,demoæˆ‘å·²æ”¾åˆ°ä¸‹é¢ å–œæ¬¢è‡ªè¡Œä¸‹è½½å­¦ä¹ .


[demoä¸‹è½½](https://github.com/sunyazhou13/PanViewDemo)


URL: https://sunyazhou.com/2019/09/UITraitCollection/index.html.md
Published At: 2019-09-16 18:49:05 +0000

# UITraitCollectionè¯¦è§£

![](/assets/images/20190916UITraitCollection/UITraitCollection1.webp)

# å‰è¨€


æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


## å…ˆè¯´é—®é¢˜

æœ€è¿‘åœ¨é€‚é…iOS13 æœ‰ä¸ª`Dark Mode`çš„æš—é»‘æ¨¡å¼, ä¸ºäº†é€‚é…è¿™ä¸ªæ¨¡å¼ä¸å¾—ä¸åœ¨UIViewå’ŒUIViewControllerä»¥åŠUIWindowä¸­å¤å†™å¦‚ä¸‹æ–¹æ³•

``` objc
- (void)traitCollectionDidChange:(UITraitCollection *)previousTraitCollection {
    [super traitCollectionDidChange:previousTraitCollection];
}

```

è¿™é‡Œæœ‰ä¸ª`UITraitCollection`çš„ç±»ä»¥å‰ä»æ¥æ²¡æœ‰ä»”ç»†ç ”ç©¶,ä»Šå¤©è¯¦ç»†ç ”ç©¶ä¸€ä¸‹.

> Trait ç‰¹æ€§ ç‰¹ç‚¹


æ˜¾ç„¶ è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªUIKitä¸­ç”¨äºå¤„ç†è‹¹æœæ‰‹æœºçš„ä¸€äº›ç‰¹æ€§çš„å‚¨å­˜ä¸UIç›¸å…³çš„é…ç½®, å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡å¦‚æœä½ åœ¨iOSä¿®æ”¹é€šç”¨ä¸­çš„æŸäº›ç³»ç»Ÿè®¾ç½®,æ¯”å¦‚(ä¸‹å›¾) å¯¹æ¯”åº¦ã€å…¨å±€å­—ä½“å¤§å°,è¿™ä¸ªæˆ‘ä»¬å¼€å‘äººå‘˜æ€ä¹ˆå¤„ç†.

![](/assets/images/20190916UITraitCollection/UITraitCollection2.gif)


è¿™äº›ç³»ç»Ÿçš„ç‰¹æ€§ä¿®æ”¹å°±æ”¾åˆ°è¿™ä¸ª`UITraitCollection`ä¸­,è¿™ä¸ªç±»ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç»å¸¸åœ¨VCå’ŒViewä¸­ç»å¸¸ç”¨åˆ°è€Œå¤§å®¶å¾€å¾€å®¹æ˜“å¿½ç•¥çš„,ä¸‹é¢ç®€å•è®°å½•ä¸€ä¸‹è¿™äº›ç‰¹æ€§éƒ½æœ‰å“ªäº›



## UITraitCollection APIä»‹ç»

#### åˆ¤æ–­å½“å‰è®¾å¤‡æ—¶ iPhone/iPad/tv/carPlay çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithUserInterfaceIdiom:(UIUserInterfaceIdiom)idiom;
@property (nonatomic, readonly) UIUserInterfaceIdiom userInterfaceIdiom; // unspecified: UIUserInterfaceIdiomUnspecified
```

#### å…³äºå¸ƒå±€æ–¹å‘çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithLayoutDirection:(UITraitEnvironmentLayoutDirection)layoutDirection API_AVAILABLE(ios(10.0));
@property (nonatomic, readonly) UITraitEnvironmentLayoutDirection layoutDirection API_AVAILABLE(ios(10.0)); // unspecified: UITraitEnvironmentLayoutDirectionUnspecified
```

#### å›¾ç‰‡ Scale çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithDisplayScale:(CGFloat)scale;
@property (nonatomic, readonly) CGFloat displayScale; // unspecified: 0.0
```

#### å¸ƒå±€ Size Class çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithHorizontalSizeClass:(UIUserInterfaceSizeClass)horizontalSizeClass;
@property (nonatomic, readonly) UIUserInterfaceSizeClass horizontalSizeClass; // unspecified: UIUserInterfaceSizeClassUnspecified

+ (UITraitCollection *)traitCollectionWithVerticalSizeClass:(UIUserInterfaceSizeClass)verticalSizeClass;
@property (nonatomic, readonly) UIUserInterfaceSizeClass verticalSizeClass; // unspecified: UIUserInterfaceSizeClassUnspecified

```

####  Force Touch æ˜¯å¦å¯ç”¨çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithForceTouchCapability:(UIForceTouchCapability)capability API_AVAILABLE(ios(9.0));
@property (nonatomic, readonly) UIForceTouchCapability forceTouchCapability API_AVAILABLE(ios(9.0)); // unspecified: UIForceTouchCapabilityUnknown
```

#### å…¨å±€å­—ä½“å¤§å°çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithPreferredContentSizeCategory:(UIContentSizeCategory)preferredContentSizeCategory API_AVAILABLE(ios(10.0));
@property (nonatomic, copy, readonly) UIContentSizeCategory preferredContentSizeCategory API_AVAILABLE(ios(10.0)); // unspecified: UIContentSizeCategoryUnspecified

```
 
#### è‰²åŸŸçš„é…ç½®

``` objc

+ (UITraitCollection *)traitCollectionWithDisplayGamut:(UIDisplayGamut)displayGamut API_AVAILABLE(ios(10.0));
@property (nonatomic, readonly) UIDisplayGamut displayGamut API_AVAILABLE(ios(10.0)); // unspecified: UIDisplayGamutUnspecified

```

#### æ˜¯å¦å¼€å¯é«˜å¯¹æ¯”åº¦çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithAccessibilityContrast:(UIAccessibilityContrast)accessibilityContrast API_AVAILABLE(ios(13.0), tvos(13.0)) API_UNAVAILABLE(watchos);
@property (nonatomic, readonly) UIAccessibilityContrast accessibilityContrast API_AVAILABLE(ios(13.0), tvos(13.0)) API_UNAVAILABLE(watchos); // unspecified: UIAccessibilityContrastUnspecified
```

#### å…¨å±€å­—é‡çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithLegibilityWeight:(UILegibilityWeight)legibilityWeight API_AVAILABLE(ios(13.0), tvos(13.0), watchos(6.0));
@property (nonatomic, readonly) UILegibilityWeight legibilityWeight API_AVAILABLE(ios(13.0), tvos(13.0), watchos(6.0)); // unspecified: UILegibilityWeightUnspecified
```

#### ä¸»é¢˜çš„é…ç½®

``` objc
+ (UITraitCollection *)traitCollectionWithUserInterfaceStyle:(UIUserInterfaceStyle)userInterfaceStyle API_AVAILABLE(tvos(10.0)) API_AVAILABLE(ios(12.0)) API_UNAVAILABLE(watchos);
@property (nonatomic, readonly) UIUserInterfaceStyle userInterfaceStyle API_AVAILABLE(tvos(10.0)) API_AVAILABLE(ios(12.0)) API_UNAVAILABLE(watchos); // unspecified: UIUserInterfaceStyleUnspecified
```

### å¦‚ä½•è·å– UITraitCollection

`UITraitCollection`æœ¬èº«æ˜¯ä¸€ä¸ªé…ç½®çš„é›†åˆï¼Œæ¯ä¸ª `UIView`/`UIViewController`éƒ½æœ‰è‡ªå·±çš„ `UITraitCollection`å¯¹è±¡ï¼Œå¹¶å°†è‡ªå·±çš„`UITraitCollection`ä¼ é€’ç»™å­`UIView`/`UIViewController`ä½œä¸ºé»˜è®¤å€¼ã€‚

* å¯ä»¥é€šè¿‡  `UIView`/`UIViewController`çš„å±æ€§ `traitCollection` è·å–åˆ°å½“å‰è§†å›¾çš„ UITraitCollection å¯¹è±¡

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    self.traitCollection //æ‹¿åˆ°å½“å‰å¾—
}
```

* å¯ä»¥é€šè¿‡å­ç±»é‡å†™å¦‚ä¸‹æ–¹æ³•çš„æ–¹å¼ç›‘æ§ traitCollection å±æ€§çš„å˜åŒ–

``` objc
- (void)traitCollectionDidChange:(UITraitCollection *)previousTraitCollection {
    [super traitCollectionDidChange:previousTraitCollection];
}

```

* è·å–å…¨å±€çš„`UITraitCollection`

``` objc
[UITraitCollection currentTraitCollection];
```



## æŠ€å·§

å¦‚æœè¦åœ¨UIViewControllerä¸­æ›´æ–°çŠ¶æ€æ  å½“è®¾ç½®å®Œstyleçš„æ—¶å€™å¯ä»¥è°ƒç”¨

``` objc
[self setNeedsStatusBarAppearanceUpdate];
```


# æ€»ç»“


é€šè¿‡ç®€å•çš„å­¦ä¹ `UITraitCollection`åˆæ·±åˆ»å­¦ä¹ äº†ä¸€ä¸‹è¿™ä¸ªç±»,å¸Œæœ›ä»¥åèƒ½è®°å½•ä¸€ä¸‹å­¦è¿‡çš„çŸ¥è¯†.



URL: https://sunyazhou.com/2019/09/OpenGLESDemo1/index.html.md
Published At: 2019-09-06 10:19:48 +0000

# ä»é›¶å­¦ä¹ OpenGLESçš„çº¹ç†æ¸²æŸ“

![](/assets/images/20190906OpenGLESDemo1/sunyazhou_logo_glsl.webp)


# å‰è¨€

å¾ˆä¹…æ²¡ç”¨OpenGLäº† è®°å½•ä¸€ä¸‹å­¦ä¹ GLSLä»£ç å’Œå®ç°


## Objctive-Cä»£ç 


``` objc
#import "ViewController.h"
#import <GLKit/GLKit.h>

//é¡¶ç‚¹ç»“æ„ä½“ç±»å‹
typedef struct {
    GLKVector3 positionCoord; // (x,y,z)
    GLKMatrix2 textureCoord; // (u, v)
    
} SenceVertex;


@interface ViewController ()

@property (nonatomic, assign) SenceVertex *vertices; //é¡¶ç‚¹æ•°ç»„
@property (nonatomic, strong) EAGLContext *context;

@end

@implementation ViewController

#pragma mark -
#pragma mark - override methods å¤å†™æ–¹æ³•
- (void)viewDidLoad {
    [super viewDidLoad];
    self.view.backgroundColor = [UIColor whiteColor];
    [self commonInit];
}

#pragma mark -
#pragma mark - private methods ç§æœ‰æ–¹æ³•
- (void)commonInit {
    // åˆ›å»ºä¸Šä¸‹æ–‡ ä½¿ç”¨ 2.0ç‰ˆæœ¬
    self.context = [[EAGLContext alloc] initWithAPI:kEAGLRenderingAPIOpenGLES2];
    [EAGLContext setCurrentContext:self.context];
    
    //åˆ›å»ºé¡¶ç‚¹æ•°ç»„
    self.vertices = malloc(sizeof(SenceVertex) * 4); //4ä¸ªé¡¶ç‚¹
    {% raw %}
    self.vertices[0] = (SenceVertex){{-1, 1, 0},{ 0, 1 }}; //å·¦ä¸Šè§’
    self.vertices[1] = (SenceVertex){{-1, -1, 0},{0 ,0}}; //å·¦ä¸‹è§’
    self.vertices[2] = (SenceVertex){{1, 1, 0},{1, 1}}; //å³ä¸Šè§’
    self.vertices[3] = (SenceVertex){{1, -1, 0},{1, 0}}; //å³ä¸‹è§’
    {% endraw %}
    //åˆ›å»ºä¸€ä¸ªå±•ç¤ºçº¹ç†çš„layer
    
    CAEAGLLayer *layer = [CAEAGLLayer layer];
    layer.frame = CGRectMake(0, 100, self.view.frame.size.width, self.view.frame.size.width);
    layer.contentsScale = [[UIScreen mainScreen] scale]; //è®¾ç½®ç¼©æ”¾æ¯”ä¾‹ï¼Œä¸è®¾ç½®çš„è¯ï¼Œçº¹ç†ä¼šå¤±çœŸ
    
    [self.view.layer addSublayer:layer];
    
    // ç»‘å®šçº¹ç†åˆ°è¾“å‡ºlayer
    [self bindRenderLayer:layer];
    
    // è¯»å–çº¹ç†
    NSString *imagePath = [[[NSBundle mainBundle] resourcePath] stringByAppendingPathComponent:@"logo.webp"];
    UIImage *image = [UIImage imageWithContentsOfFile:imagePath];
    GLuint textureID = [self createTextureWithImage:image];
    
    
    // è®¾ç½®è§†å£å°ºå¯¸
    
    glViewport(0, 0, self.drawableWidth, self.drawableHeight);
    
    // ç¼–è¯‘é“¾æ¥ ç€è‰²å™¨
    GLuint program = [self programWithShaderName:@"glsl"];
    glUseProgram(program);
    
    // è·å–shader ä¸­çš„å‚æ•° ç„¶åä¼ æ•°æ®è¿›å»
    GLuint positionSlot = glGetAttribLocation(program, "Position"); //è·å–é¡¶ç‚¹ç€è‰²å™¨çš„ä½ç½®
    GLuint textureCoordsSlot = glGetAttribLocation(program, "TextureCoords"); //è·å–é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„çº¹ç†åæ ‡

    GLuint textureSlot = glGetUniformLocation(program, "Texture"); //è·å–ç‰‡å…ƒç€è‰²å™¨çº¹ç†å˜é‡

    //å°†çº¹ç† ID ä¼ ç»™ç€è‰²å™¨ç¨‹åº
    glActiveTexture(GL_TEXTURE0);
    glBindTexture(GL_TEXTURE_2D, textureID);
    glUniform1i(textureSlot, 0); // å°†textureSlot èµ‹å€¼ä¸º 0, è€Œ 0 ä¸ GL_TEXTURE0 å¯¹åº”,è¿™é‡Œå¦‚æœå†™1,å°±æ˜¯GL_TEXTURE1
    
    // åˆ›å»ºé¡¶ç‚¹ç¼“å­˜
    GLuint vertexBuffer;
    glGenBuffers(1, &vertexBuffer);
    glBindBuffer(GL_ARRAY_BUFFER, vertexBuffer);
    GLsizeiptr bufferSizeBytes = sizeof(SenceVertex) * 4;
    glBufferData(GL_ARRAY_BUFFER, bufferSizeBytes, self.vertices, GL_STATIC_DRAW);
    
    // è®¾ç½®é¡¶ç‚¹æ•°æ®
    glEnableVertexAttribArray(positionSlot);
    glVertexAttribPointer(positionSlot, 3, GL_FLOAT, GL_FALSE, sizeof(SenceVertex), NULL + offsetof(SenceVertex, positionCoord));
    
    // è®¾ç½®çº¹ç†æ•°æ®
    glEnableVertexAttribArray(textureCoordsSlot);
    glVertexAttribPointer(textureCoordsSlot, 2, GL_FLOAT, GL_FALSE, sizeof(SenceVertex), NULL + offsetof(SenceVertex, textureCoord));
    
    // å¼€å§‹ç»˜åˆ¶
    glDrawArrays(GL_TRIANGLE_STRIP, 0, 4);
    
    // å°†ç»‘å®š
    [self.context presentRenderbuffer:GL_RENDERBUFFER];
    
    //åˆ é™¤é¡¶ç‚¹ç¼“å­˜
    glDeleteBuffers(1, &vertexBuffer);
    vertexBuffer = 0;
    
}

//ç»‘å®šå›¾åƒè¦è¾“å‡ºçš„ layer
- (void)bindRenderLayer:(CALayer <EAGLDrawable> *)layer {
    GLuint frameBuffer; //å¸§ç¼“å†²
    GLuint renderBuffer; //æ¸²æŸ“ç¼“å†²

    //ç»‘å®šæ¸²æŸ“ç¼“å†²åˆ° è¾“å‡ºçš„layer
    glGenRenderbuffers(1, &renderBuffer);
    glBindRenderbuffer(GL_RENDERBUFFER, renderBuffer);
    [self.context renderbufferStorage:GL_RENDERBUFFER fromDrawable:layer];
    
    //å°†æ¸²æŸ“ç¼“å†²é™„ç€åœ¨å¸§ç¼“å†²ä¸Š
    glGenFramebuffers(1, &frameBuffer);
    glBindFramebuffer(GL_FRAMEBUFFER, frameBuffer);
    glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_RENDERBUFFER, renderBuffer);
}

// é€šè¿‡ä¸€ä¸ªå›¾ç‰‡ åˆ›å»ºçº¹ç†
- (GLuint)createTextureWithImage:(UIImage *)image {
    // å°† UIImage è½¬æ¢ä¸º CGImageRef
    CGImageRef cgImageRef = [image CGImage];
    GLuint width = (GLuint)CGImageGetWidth(cgImageRef);
    GLuint height = (GLuint)CGImageGetHeight(cgImageRef);
    CGRect rect = CGRectMake(0, 0, width, height);
    
    // ç»˜åˆ¶å›¾ç‰‡
    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    void *imageData = malloc(width * height * 4);
    CGContextRef context = CGBitmapContextCreate(imageData, width, height, 8, width * 4, colorSpace, kCGImageAlphaPremultipliedLast | kCGBitmapByteOrder32Big);
    CGContextTranslateCTM(context, 0, height);
    CGContextScaleCTM(context, 1.0f, -1.0f);
    CGColorSpaceRelease(colorSpace);
    CGContextClearRect(context, rect);
    CGContextDrawImage(context, rect, cgImageRef);

    // ç”Ÿæˆçº¹ç†
    GLuint textureID;
    glGenTextures(1, &textureID);
    glBindTexture(GL_TEXTURE_2D, textureID);
    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, imageData); // å°†å›¾ç‰‡æ•°æ®å†™å…¥çº¹ç†ç¼“å­˜
    
    // è®¾ç½®å¦‚ä½•æŠŠçº¹ç´ æ˜ å°„æˆåƒç´ 
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);
    glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);
    
    // è§£ç»‘
    glBindTexture(GL_TEXTURE_2D, 0);
    
    // é‡Šæ”¾å†…å­˜
    CGContextRelease(context);
    free(imageData);
    
    return textureID;
}

// å°†ä¸€ä¸ªé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡å…ƒç€è‰²å™¨æŒ‚åœ¨åˆ°ä¸€ä¸ªç€è‰²å™¨ç¨‹åºä¸Š, å¹¶è¿”å›ç¨‹åºçš„ id
- (GLuint)programWithShaderName:(NSString *)shaderName {
    // ç¼–è¯‘ä¸¤ä¸ªç€è‰²å™¨
    GLuint vertexShader = [self compileShaderWithName:shaderName type:GL_VERTEX_SHADER];
    GLuint fragmentShader = [self compileShaderWithName:shaderName type:GL_FRAGMENT_SHADER];
    
    // æŒ‚è½½ shader åˆ° program ä¸Š
    GLuint program = glCreateProgram();
    glAttachShader(program, vertexShader);
    glAttachShader(program, fragmentShader);
    
    // é“¾æ¥ program
    glLinkProgram(program);
    
    // æ£€æŸ¥é“¾æ¥æ˜¯å¦æˆåŠŸ
    GLint linkSuccess;
    glGetProgramiv(program, GL_LINK_STATUS, &linkSuccess);
    if (linkSuccess == GL_FALSE) {
        GLchar messages[256];
        glGetProgramInfoLog(program, sizeof(messages), 0, &messages[0]);
        NSString *messageString = [NSString stringWithUTF8String:messages];
        NSAssert(NO, @"programé“¾æ¥å¤±è´¥ï¼š%@", messageString);
        exit(1);
    }
    return program;
}

// ç¼–è¯‘ä¸€ä¸ª shaderï¼Œå¹¶è¿”å› shader çš„ id
- (GLuint)compileShaderWithName:(NSString *)name type:(GLenum)shaderType {
    // æŸ¥æ‰¾ shader æ–‡ä»¶
    NSString *shaderPath = [[NSBundle mainBundle] pathForResource:name ofType:shaderType == GL_VERTEX_SHADER ? @"vsh" : @"fsh"]; // æ ¹æ®ä¸åŒçš„ç±»å‹ç¡®å®šåç¼€å
    NSError *error;
    NSString *shaderString = [NSString stringWithContentsOfFile:shaderPath encoding:NSUTF8StringEncoding error:&error];
    if (!shaderString) {
        NSAssert(NO, @"è¯»å–shaderå¤±è´¥");
        exit(1);
    }
    
    // åˆ›å»ºä¸€ä¸ª shader å¯¹è±¡
    GLuint shader = glCreateShader(shaderType);
    
    // è·å– shader çš„å†…å®¹
    const char *shaderStringUTF8 = [shaderString UTF8String];
    int shaderStringLength = (int)[shaderString length];
    glShaderSource(shader, 1, &shaderStringUTF8, &shaderStringLength);
    
    // ç¼–è¯‘shader
    glCompileShader(shader);
    
    // æŸ¥è¯¢ shader æ˜¯å¦ç¼–è¯‘æˆåŠŸ
    GLint compileSuccess;
    glGetShaderiv(shader, GL_COMPILE_STATUS, &compileSuccess);
    if (compileSuccess == GL_FALSE) {
        GLchar messages[256];
        glGetShaderInfoLog(shader, sizeof(messages), 0, &messages[0]);
        NSString *messageString = [NSString stringWithUTF8String:messages];
        NSAssert(NO, @"shaderç¼–è¯‘å¤±è´¥ï¼š%@", messageString);
        exit(1);
    }
    
    return shader;
}


#pragma mark -
#pragma mark - public methods å…¬æœ‰æ–¹æ³•



#pragma mark -
#pragma mark - getters and setters è®¾ç½®å™¨å’Œè®¿é—®å™¨
// è·å–æ¸²æŸ“ç¼“å­˜å®½åº¦
- (GLint)drawableWidth {
    GLint backingWidth;
    glGetRenderbufferParameteriv(GL_RENDERBUFFER, GL_RENDERBUFFER_WIDTH, &backingWidth);
    
    return backingWidth;
}

// è·å–æ¸²æŸ“ç¼“å­˜é«˜åº¦
- (GLint)drawableHeight {
    GLint backingHeight;
    glGetRenderbufferParameteriv(GL_RENDERBUFFER, GL_RENDERBUFFER_HEIGHT, &backingHeight);
    
    return backingHeight;
}

#pragma mark -
#pragma mark - life cycle è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸ
- (void)dealloc {
    if ([EAGLContext currentContext] == self.context) {
        [EAGLContext setCurrentContext:nil];
    }
    //é‡Šæ”¾ç»“æ„ä½“å†…å­˜çš„æ•°ç»„ éœ€è¦æ‰‹åŠ¨free
    if (_vertices) {
        free(_vertices);
        _vertices = nil;
    }
}

@end
```

### é¡¶ç‚¹ç€è‰²å™¨

``` shade
attribute vec4 Position;
attribute vec2 TextureCoords;
varying vec2 TextureCoordsVarying;

void main (void) {
    gl_Position = Position;
    TextureCoordsVarying = TextureCoords;
}

```

### ç‰‡å…ƒç€è‰²å™¨

``` shade
precision mediump float;

uniform sampler2D Texture;
varying vec2 TextureCoordsVarying;

void main (void) {
    vec4 mask = texture2D(Texture, TextureCoordsVarying);
    gl_FragColor = vec4(mask.rgb, 1.0);
}
```

# æ€»ç»“

æœ€è¿‘ä¸€æœ‰æ—¶é—´å°±å°½é‡ç ”ä¹ å›¾å½¢å›¾åƒç›¸å…³çš„æŠ€æœ¯,æœ¬æ–‡å…·æœ‰å¼ºçƒˆçš„ä¸ªäººæ„Ÿæƒ…è‰²å½©,å¦‚æœ‰è§‚çœ‹ä¸é€‚,è¯·å°½å¿«å…³é—­. æœ¬æ–‡ä»…ä½œä¸ºä¸ªäººå­¦ä¹ è®°å½•ä½¿ç”¨,ä¹Ÿæ¬¢è¿åœ¨è®¸å¯åè®®èŒƒå›´å†…è½¬è½½æˆ–åˆ†äº«,è¯·å°Šé‡ç‰ˆæƒå¹¶ä¸”ä¿ç•™åŸæ–‡é“¾æ¥,è°¢è°¢æ‚¨çš„ç†è§£åˆä½œ. å¦‚æœæ‚¨è§‰å¾—æœ¬ç«™å¯¹æ‚¨èƒ½æœ‰å¸®åŠ©,æ‚¨å¯ä»¥ä½¿ç”¨RSSæ–¹å¼è®¢é˜…æœ¬ç«™,æ„Ÿè°¢æ”¯æŒ!


[Demo](https://github.com/sunyazhou13/GLSLDemo1)

[å­¦ä¹ å‚è€ƒ](http://www.lymanli.com/2019/02/17/ios-opengles-render-texture/)


URL: https://sunyazhou.com/2019/07/LoadingAnimationI/index.html.md
Published At: 2019-07-26 11:13:44 +0000

# åšä¸€ä¸ªç®€å•çš„LoadingåŠ¨ç”»

![](/assets/images/20190726LoadingAnimationI/CircleLoadingAnimation.webp)


# å‰è¨€


ç”±äºæœ€è¿‘å·¥ä½œå¿™åˆ°ååœ°é“å›å®¶éƒ½èƒ½ç¡ç€,åšå®¢æ²¡èƒ½åŠæ—¶æ›´æ–°,ä»Šå¤©æŠ½ä¸ªæ—¶é—´å†™ä¸ªåŠ è½½åŠ¨ç”»,åºŸè¯ä¸å¤šè¯´ä¸Šå›¾.

![](/assets/images/20190726LoadingAnimationI/CircleLoadingAnimation.gif)


(é¢œè‰²å¯ä»¥è‡ªå®šä¹‰å“ˆ,éå¸¸ç®€å•,å°ç™½è‡ªå·±å¯ä»¥éšä¾¿æ”¹)




# å¼€å§‹


åˆ›å»ºä¸€ä¸ªUIViewçš„å­ç±»`UILoadingView`(åå­—æœ€å¥½ä¸è¦å¸¦`UI`å¼€å¤´å“ˆ,æˆ‘è¿™æ˜¯ä¸ºäº†ç© å¤§å®¶ç†è§£å°±è¡Œ),ç„¶åæ·»åŠ ä¸¤ä¸ªæ¥å£


``` objc

@interface UILoadingView : UIView

- (void)startLoading; //1
- (void)stopLoading;  //2

@end
```

> 1. å¼€å§‹åŠ¨ç”»
> 2. ç»“æŸåŠ¨ç”»


å®ç°çš„.mæ–‡ä»¶ä¸­æˆ‘ä»¬éœ€è¦ç”¨åˆ°`CAReplicatorLayer`,ä¸»è¦æ˜¯çœ‹ä¸Šè¾¹çš„å°åœ†ç‚¹æ¯”è¾ƒå¤š,ç”¨`CAReplicatorLayer`å¯ä»¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºå¤šä¸ªå°åœ†ç‚¹å®ä¾‹.

``` objc
@interface UILoadingView ()

@property(nonatomic, strong) CAReplicatorLayer *replicatorLayer;

@end

@implementation UILoadingView

- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self setupSubviews];
    }
    return self;
}

- (void)awakeFromNib {
    [super awakeFromNib];
    [self setupSubviews];
}

- (void)setupSubviews {
	//è¿™é‡Œè¦è¡¥å…¨ä»£ç  åˆ›å»ºéœ€è¦çš„è§†å›¾ ç»§ç»­å¾€ä¸‹çœ‹
}

@end
```

### åˆ›å»ºå­è§†å›¾

é¦–å…ˆæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªreplicatorLayerçš„å®ä¾‹å¯¹è±¡,ç„¶åå‘è¿™ä¸ªå¯¹è±¡ä¸Šæ·»åŠ ä¸€ä¸ªåœ†ç‚¹çš„,å¹¶é”™å¼€è§’åº¦.è¿™é‡Œç”¨åˆ°çš„çŸ¥è¯†ç‚¹åŸºæœ¬å°±æ˜¯positionå’Œboundså•¥å…³ç³».è¿™é‡Œæˆ‘ä¸æƒ³å•°å—¦äº†å¤§å®¶è‡ªè¡Œgoogleå°±è¡Œäº†.ä¸Šä»£ç 

``` objc
- (void)setupSubviews {
    if (self.replicatorLayer == nil) {
        self.replicatorLayer = [CAReplicatorLayer layer];
        self.replicatorLayer.backgroundColor = [UIColor clearColor].CGColor;
        [self.layer addSublayer:self.replicatorLayer];
        self.replicatorLayer.bounds = self.bounds;
        self.replicatorLayer.position = self.center;
        NSInteger instanceCount = 15;  //1
        self.replicatorLayer.instanceCount = instanceCount; //
        self.replicatorLayer.instanceTransform = CATransform3DMakeRotation(M_PI * 2 / instanceCount, 0, 0, 1); //2
        self.replicatorLayer.instanceDelay = 1 / (instanceCount * 1.0); //2
        
    }
    //åœ†ç‚¹
    CALayer *circle = [CALayer layer];
    circle.bounds = CGRectMake(0, 0, 10, 10);
    circle.cornerRadius = 5;
    circle.position = CGPointZero;
    circle.backgroundColor = [self randomColor].CGColor;
    circle.name = kCircleName; //3  è®¾ç½®layerçš„å”¯ä¸€æ ‡è¯† 
    [self.replicatorLayer addSublayer:circle];
    //å°æŠ€å·§ åˆšå¼€å§‹çš„åŠ¨ç”»ä¸æ˜¯å¾ˆè‡ªç„¶ï¼Œé‚£æ˜¯å› ä¸ºå°åœ†ç‚¹çš„åˆå§‹æ¯”ä¾‹æ˜¯1,è®©å°åœ†ç‚¹çš„åˆå§‹æ¯”ä¾‹ä¸º0.01
    circle.transform = CATransform3DMakeScale(0.01, 0.01, 0.01); //5
}
```

> 1. 1å¤„çš„ä»£ç æ˜¯è®©`CAReplicatorLayer`å¸®æˆ‘ä»¬åˆ›å»ºæŒ‡å®šæ•°é‡çš„å®ä¾‹å¯¹è±¡(æˆ‘ä»¬æ·»åŠ çš„åŸç‚¹å°±æ˜¯å®ƒéœ€è¦çš„ä¹Ÿå°±æ˜¯è¯´å®ƒå¸®ä½ åˆ›å»ºäº†instanceCountä¸ªå®ä¾‹å¯¹è±¡)
> 2. 2å¤„ä»£ç  æ˜¯è®¾ç½®é”™å¼€çš„è§’åº¦ï¼ˆ2Ï€ æ˜¯ 360Â°, å¦‚æœéœ€è¦ä¸€åœˆåˆ›å»ºæŒ‡å®šæ•°é‡çš„åœ†ç‚¹ é‚£ä¹ˆ instanceCount/2Ï€ å°±æ˜¯æ¯ä¸ªåœ†çš„è§’åº¦,è¿™é‡Œå¾ˆé‡è¦ è®¤çœŸå­¦ä¹ ä¸€ä¸‹.ï¼‰
> 3. 3å¤„ä»£ç æ˜¯ç»™è¿™ä¸ªlayerè®¾ç½®ä¸€ä¸ªå”¯ä¸€æ ‡è¯† ä¸€ä¼šå„¿è¦é€šè¿‡æ–¹æ³•æ‰¾åˆ°å®ƒ,å¦‚æœ ä¸è¿™æ ·åšä½ å°±è¦æä¸ªæˆå‘˜å˜é‡å»å­˜ä¸€ä¸‹,å¦‚æœç”¨æˆå‘˜å˜é‡å­˜å‚¨çš„è¯æ³¨æ„å†…å­˜å¼•ç”¨å…³ç³»,æˆ‘è¿™é‡Œä¸æ¨èæˆå‘˜å˜é‡çš„ææ³•.
> 4. 4å¤„ä»£ç ä¸»è¦æ˜¯è§£å†³åŠ¨ç”»ä¸è‡ªç„¶,å› ä¸ºæ·»åŠ åŠ¨ç”»çš„åœ†ç‚¹çš„åˆå§‹æ¯”ä¾‹æ˜¯1,åªæœ‰ç¬¬ä¸€æ¬¡å¼€å§‹çš„æ—¶å€™å¾ˆæ„£.


#### æ‰¾åˆ°åœ†ç‚¹layer

``` objc
- (CALayer *)findCircleLayer {
    for (CALayer *layer in [self.replicatorLayer sublayers]) {
        if ([[layer name] isEqualToString:kCircleName]) {
            return layer;
        }
    }
    return nil;
}
```

æˆ‘ä»¬ç”¨çš„æ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³• æ‰¾ä¸€ä¸‹æˆ‘ä»¬æ·»åŠ ä¸Šå»çš„layerå³å¯


#### å®ç°å¯¹å¤–æš´éœ²çš„æ–¹æ³•

``` objc
- (void)startLoading {
    CALayer *circleLayer = [self findCircleLayer];
    if (circleLayer && ![[circleLayer animationKeys] containsObject:kScaleAnimationKey]) {
        //åŠ åŠ¨ç”»
        CABasicAnimation *scale = [CABasicAnimation animationWithKeyPath:@"transform.scale"];
        scale.fromValue = @(1);
        scale.toValue = @(0.1);
        scale.duration = 1;
        scale.repeatCount = HUGE;
        [circleLayer addAnimation:scale forKey:kScaleAnimationKey];
    }
}

- (void)stopLoading {
    CALayer *circleLayer = [self findCircleLayer];
    if (circleLayer && [[circleLayer animationKeys] containsObject:kScaleAnimationKey]) {
        [circleLayer removeAnimationForKey:kScaleAnimationKey];
    }
}
```

> kScaleAnimationKey å¸¸é‡è‡ªè¡Œå®šä¹‰å³å¯.


#### æ”¯æŒAutoLayout

ç›®å‰å¤§å®¶ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯`Masonry`,æ‰€ä»¥è¿™é‡Œä½¿ç”¨`Masonry`è‡ªåŠ¨å¸ƒå±€, ä½¿ç”¨è‡ªåŠ¨å¸ƒå±€ä¸»è¦æ˜¯æ˜¯ä¸ºäº†æ–¹ä¾¿å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™å¤–éƒ¨è§†å›¾ä½¿ç”¨äº†è‡ªåŠ¨å¸ƒå±€,é‚£ä¹ˆå†…éƒ¨å°±éœ€è¦æ›´æ–°ç›¸å…³`layer`çš„`frame`.å…·ä½“ä»£ç å¦‚ä¸‹

``` objc
- (void)layoutSubviews {
    [super layoutSubviews];
    
    [CATransaction begin];
    [CATransaction setDisableActions:YES];
    self.replicatorLayer.bounds = self.bounds;
    self.replicatorLayer.position = CGPointMake(CGRectGetWidth(self.bounds)/2, CGRectGetHeight(self.bounds)/2);
    
    CALayer *circleLayer = [self findCircleLayer];
    if (circleLayer) {
        circleLayer.position = CGPointMake(self.frame.size.width / 2, self.frame.size.height/2 - 40); //è·ç¦»åœ†å¿ƒ 40pt
    }
    [CATransaction commit];
    [self.replicatorLayer layoutSublayers];
}
```

è¿™é‡Œä½¿ç”¨äº† éšå¼åŠ¨ç”»å’Œæ˜¾å¼åŠ¨ç”»ç›¸å…³çš„çŸ¥è¯†

``` objc
[CATransaction begin];
[CATransaction setDisableActions:YES];

//... è¿™é‡Œä¿®æ”¹ç›¸å…³åŠ¨ç”»å‚æ•° 

[CATransaction commit];

```

å› ä¸ºæœ‰å¯èƒ½layeråœ¨åŠ¨ç”»ä¸­,å¦‚æœåœ¨åŠ¨ç”»ä¸­ä¸€èˆ¬åœ¨è¿™é‡Œéœ€è¦åŠ ä¸Š`äº‹åŠ¡`ä¿®æ”¹è¿™æ ·æ‰ä¼šæ›´é¡ºç•…è‡ªç„¶. å¯ä»¥çœ‹åˆ°æˆ‘ä¸Šè¾¹çš„ä»£ç æ³¨é‡Šå†™çš„`40pt`çš„è·ç¦» å®é™…ä¸Šæ˜¯åœ†å¿ƒè·ç¦»æˆ‘ä»¬ä¸Šè¾¹åšçš„åŸç‚¹layerçš„çš„è·ç¦»,å¤§å®¶å¯è‡ªè¡Œä¿®æ”¹.

# æ€»ç»“


ç”±äºæœ€è¿‘åœ¨ç ”ç©¶ä¸€[éŸ³é¢‘æ³¢å½¢](https://juejin.im/post/5c1bbec66fb9a049cb18b64c)çš„åŠ¨ç”»æ•ˆæœ,æƒ³å®ç°ä¸€ä¸ªç±»ä¼¼ç½‘æ˜“äº‘éŸ³ä¹çš„é»‘èƒ¶å”±ç‰‡æ•ˆæœ,å¯æ˜¯ç”¨åˆ°çš„çŸ¥è¯†æœ‰ç‚¹å¿˜è®°,ç”¨æ­¤ç‰‡æ–‡ç« æ¥å›é¡¾å¤ä¹ ä¸€ä¸‹åŠ¨ç”»çš„çŸ¥è¯†,ä¹Ÿæ˜¯ä¸ºäº†å¾ˆä¹…æ²¡æ›´æ–°çš„åšå®¢æ›´æ–°ä¸€ä¸‹,è®°å½•ä¸€ä¸‹ç»å¸¸å¿˜è®°çš„å°æŠ€å·§

Demoæˆ‘ç»™åœ¨ä¸‹é¢ä¹ŸæŠŠç›¸å…³çš„æ–‡ç« å‚è€ƒ æ”¾åœ¨ä¸‹æ–¹,æœ‰å…´è¶£å¤§å®¶å¯ä»¥å­¦ä¹ ä¸€ä¸‹.




[loadingåŠ¨ç”»Demo](https://github.com/sunyazhou13/UILoadingView)


[å‚è€ƒ](http://www.devtalking.com/articles/calayer-animation-replicator-animation/)




URL: https://sunyazhou.com/2019/05/CentosIptables/index.html.md
Published At: 2019-05-28 10:06:24 +0000

# CentOS7å®‰è£…iptablesé˜²ç«å¢™

# å‰è¨€

æœ€è¿‘ç¿»å¢™æ€»ä¸ç¨³å®š æœ€åå‘ç°æ˜¯é˜²ç«å¢™é…ç½®é—®é¢˜ä»Šå¤© è®°å½•ä¸€ä¸‹


## é…ç½®

CentOS7é»˜è®¤çš„é˜²ç«å¢™ä¸æ˜¯iptables,è€Œæ˜¯firewalle.

å®‰è£…iptable iptable-service

``` sh
#å…ˆæ£€æŸ¥æ˜¯å¦å®‰è£…äº†iptables
service iptables status
#å®‰è£…iptables
yum install -y iptables
#å‡çº§iptables
yum update iptables 
#å®‰è£…iptables-services
yum install iptables-services

```


## ç¦ç”¨/åœæ­¢è‡ªå¸¦çš„firewalldæœåŠ¡

``` sh
#åœæ­¢firewalldæœåŠ¡
systemctl stop firewalld
#ç¦ç”¨firewalldæœåŠ¡
systemctl mask firewalld
```

## è®¾ç½®ç°æœ‰è§„åˆ™

``` sh
#æŸ¥çœ‹iptablesç°æœ‰è§„åˆ™
iptables -L -n
#å…ˆå…è®¸æ‰€æœ‰,ä¸ç„¶æœ‰å¯èƒ½ä¼šæ¯å…·
iptables -P INPUT ACCEPT
#æ¸…ç©ºæ‰€æœ‰é»˜è®¤è§„åˆ™
iptables -F
#æ¸…ç©ºæ‰€æœ‰è‡ªå®šä¹‰è§„åˆ™
iptables -X
#æ‰€æœ‰è®¡æ•°å™¨å½’0
iptables -Z
#å…è®¸æ¥è‡ªäºloæ¥å£çš„æ•°æ®åŒ…(æœ¬åœ°è®¿é—®)
iptables -A INPUT -i lo -j ACCEPT
#å¼€æ”¾22ç«¯å£
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
#å¼€æ”¾21ç«¯å£(FTP)
iptables -A INPUT -p tcp --dport 21 -j ACCEPT
#å¼€æ”¾80ç«¯å£(HTTP)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
#å¼€æ”¾443ç«¯å£(HTTPS)
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
#å…è®¸ping
iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT
#å…è®¸æ¥å—æœ¬æœºè¯·æ±‚ä¹‹åçš„è¿”å›æ•°æ® RELATED,æ˜¯ä¸ºFTPè®¾ç½®çš„
iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT
#å…¶ä»–å…¥ç«™ä¸€å¾‹ä¸¢å¼ƒ
iptables -P INPUT DROP
#æ‰€æœ‰å‡ºç«™ä¸€å¾‹ç»¿ç¯
iptables -P OUTPUT ACCEPT
#æ‰€æœ‰è½¬å‘ä¸€å¾‹ä¸¢å¼ƒ
iptables -P FORWARD DROP
```

## å…¶ä»–è§„åˆ™è®¾å®š

``` sh
#å¦‚æœè¦æ·»åŠ å†…ç½‘ipä¿¡ä»»ï¼ˆæ¥å—å…¶æ‰€æœ‰TCPè¯·æ±‚ï¼‰
iptables -A INPUT -p tcp -s 45.96.174.68 -j ACCEPT
#è¿‡æ»¤æ‰€æœ‰éä»¥ä¸Šè§„åˆ™çš„è¯·æ±‚
iptables -P INPUT DROP
#è¦å°åœä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤ï¼š
iptables -I INPUT -s ***.***.***.*** -j DROP
#è¦è§£å°ä¸€ä¸ªIPï¼Œä½¿ç”¨ä¸‹é¢è¿™æ¡å‘½ä»¤:
iptables -D INPUT -s ***.***.***.*** -j DROP

```

## ä¿å­˜è§„åˆ™è®¾å®š

``` sh
#ä¿å­˜ä¸Šè¿°è§„åˆ™
service iptables save
```

## å¼€å¯iptablesæœåŠ¡ 

``` sh
#æ³¨å†ŒiptablesæœåŠ¡
#ç›¸å½“äºä»¥å‰çš„chkconfig iptables on
systemctl enable iptables.service
#å¼€å¯æœåŠ¡
systemctl start iptables.service
#æŸ¥çœ‹çŠ¶æ€
systemctl status iptables.service
```

## è§£å†³vsftpdåœ¨iptableså¼€å¯å,æ— æ³•ä½¿ç”¨è¢«åŠ¨æ¨¡å¼çš„é—®é¢˜

1.é¦–å…ˆåœ¨/etc/sysconfig/iptables-configä¸­ä¿®æ”¹æˆ–è€…æ·»åŠ ä»¥ä¸‹å†…å®¹

``` sh
#æ·»åŠ ä»¥ä¸‹å†…å®¹,æ³¨æ„é¡ºåºä¸èƒ½è°ƒæ¢
IPTABLES_MODULES="ip_conntrack_ftp"
IPTABLES_MODULES="ip_nat_ftp"

```

2.é‡æ–°è®¾ç½®iptablesè®¾ç½®

``` sh
iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT

```

### ä»¥ä¸‹ä¸ºå®Œæ•´è®¾ç½®è„šæœ¬

``` sh
#!/bin/sh
iptables -P INPUT ACCEPT
iptables -F
iptables -X
iptables -Z
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -p tcp --dport 22 -j ACCEPT
iptables -A INPUT -p tcp --dport 21 -j ACCEPT
iptables -A INPUT -p tcp --dport 80 -j ACCEPT
iptables -A INPUT -p tcp --dport 443 -j ACCEPT
iptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT
iptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -P INPUT DROP
iptables -P OUTPUT ACCEPT
iptables -P FORWARD DROP
service iptables save
systemctl restart iptables.service
```


URL: https://sunyazhou.com/2019/05/CleanerForXcodeBuild/index.html.md
Published At: 2019-05-17 16:37:43 +0000

# Cleaner For Xcodeç¼–è¯‘

![](/assets/images/20190517CleanerForXcodeBuild/CleanerForXcode.webp)

# å‰è¨€

æœ€è¿‘å…¬å¸ç»™é…å‘ä¸€ä¸ªæœ€æ–°ç‰ˆçš„macbook pro, ç„¶åç»è¿‡ä¸€é¡¿æŠ˜è…¾ä»¥åå‘ç°åŸæ¥çš„è½¯ä»¶ æ— æ³• è¿ç§»è¿‡æ¥æˆ–è€…è¿ç§»èµ·æ¥æ¯”è¾ƒè´¹åŠ².äºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« .


## èƒŒæ™¯

ç”±äºmacç£ç›˜ç©ºé—´æœ‰é™,ä¸å¾—ä¸å€ŸåŠ©ä¸€äº›ç¬¬ä¸‰æ–¹è½¯ä»¶æ¸…ç†ç£ç›˜,å°¤å…¶å¯¹äºä¸€ä¸ªiOSå¼€å‘è€…æ¥è¯´,å›ºæ€ç¡¬ç›˜128Gçš„macæˆ‘åªèƒ½è¯´å…¬å¸å¤ªæŠ äº†,å°±æ˜¯èƒ½å®‰è£…ä¸ªXcodeå¹²æ´»,å…¶ä½™çš„æˆ‘è§‰å¾—æˆ‘çš„256Gçš„iPhone Xè¶³å¤Ÿåº”ä»˜äº†


Xcodeæ˜¯å ç”¨macç©ºé—´æœ€å¤§çš„app,æ— è®ºä»å†…å­˜ã€ç£ç›˜ioã€ç³»ç»Ÿèµ„æº å…¨éƒ¨éƒ½èƒ½æ’ç¬¬ä¸€.å› ä¸ºå¹³æ—¶éƒ½ç”¨çœŸæœºè¿è¡Œæ‰€ä»¥Xcodeè‡ªå¸¦çš„æ¨¡æ‹Ÿå™¨ä¹Ÿæ’ä¸ä¸Šç”¨åœºè¿˜å ç”¨äº†ä¸€äº›ç£ç›˜ç©ºé—´,å‡ å¹´å‰æœ‰å°é¢çš„è¿™ä¸ªè½¯ä»¶å«Cleaner For Xcode.

æ˜¯ä¸ªå¼€æºçš„å¹¶ä¸”ç”¨React Nativeå†™çš„,æˆ‘è§‰å¾—å¾ˆå¥½ç”¨,ä¸è¿‡è¿™ä¸ªå¼€å‘è€…ä¸å¤Ÿåšé“,åœ¨macçš„ app store æ ‡ä»· $0.99ã€‚


çœŸçš„æˆ‘è¯´è¿™ä¸ªä½œè€…ä½ çœŸä¸å¤Ÿåšé“ä½ éƒ½open source äº†ä¸ºå•¥ä¸æ‰“ä¸ª releaseåŒ… å¹¿å¤§ macä¸Šçš„å°ä¼™ä¼´ç”¨å‘¢.äºæ˜¯ ä»Šå¤©æœ‰ç‚¹æ—¶é—´ æˆ‘é…ä¸ŠRNç¯å¢ƒ èª“æ­»ç¼–è¯‘å‡ºä¸€ä¸ªapp**å…è´¹**ç»™å¤§å®¶ä½¿ç”¨.


## è¿‡ç¨‹ 

è¯è¯´æˆ‘çœŸä¸æƒ³è£…RN  å¤ªæµªè´¹ç£ç›˜ç©ºé—´ è¿˜æµªè´¹æ—¶é—´,è¿«ä¸å¾—å·² ç»è¿‡ä¸€ç•ªæŠ˜è…¾ é‡åˆ°å¥½å¤šå‘ 


#### å¡«å‘ç»å†

0.45ä»¥ä¸Šçš„RN éœ€è¦  boost åº“,è¿™ä¸ªåº“ ç¿»å¢™éƒ½å¾ˆè´¹åŠ² ä¸‹è½½ã€‚ã€‚ã€‚Done.

åˆè¦å®‰è£…  yarnã€nodeã€npmã€çœ‹é—¨ç‹— watchdagã€‚ã€‚ã€‚ Done.

ç¼–è¾‘é”™è¯¯, Xcode10.12.1 ç›®å‰æœ€æ–°ç‰ˆ å„ç§ç¼–è¯‘é€‰é¡¹ é™æ€åˆ†æ Done.



å¤§æ¦‚è¿‡äº† 30åˆ†é’Ÿ ç»ˆäº æŠ˜è…¾ å‡ºä¸€ä¸ªapp


# æ€»ç»“


[é“¾æ¥https://pan.baidu.com/s/1BClEjWLHS3htvKXoM11UjQ](https://pan.baidu.com/s/1BClEjWLHS3htvKXoM11UjQ) æå–ç : `uhns`


å„ä½æ‹¿å»ä¸ç”¨å®¢æ°”


å…¶å®å°±æ˜¯äº†è§£åˆ é™¤ Xcodeæ¯ä¸ªç›®å½•éƒ½å­˜å‚¨ä»€ä¹ˆç¼“å­˜ æ²¡äº‹åˆ é™¤ä¸€ä¸‹ æä¸ªå¥½çœ‹çš„UI.ä½œè€… æ˜¯æœ‰ç‚¹è›‹ç–¼ è¿™ä¹ˆç®€å•çš„åŠŸèƒ½ ä¸€ä¸ªshellæˆ–è€…objcå‡ è¡Œä»£ç æå®š éè¦å¤§åŠ¨å¹²æˆˆç”¨RN. ç„¶åè¿˜å¾ˆä¸åšé“çš„å¼€æº,è¿™ç§å¼€å‘è€…çœŸæ˜¯è›‹ç–¼.







URL: https://sunyazhou.com/2019/04/WindowsResources/index.html.md
Published At: 2019-04-24 11:26:34 +0000

# Windowsè£…æœºæ•™ç¨‹

# å‰è¨€

ä¸ºäº†è§£å†³æ¯æ¬¡éƒ½é‡è£…windowsç”µè„‘ç³»ç»Ÿæµªè´¹æ—¶é—´,å¹²è„†æ•´ç†ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹,æ–¹ä¾¿åç»­ä¿®ç”µè„‘æ€»å¿˜è®°å„ç§å·¥å…·

### PEå®‰è£…ç³»ç»Ÿæ•™ç¨‹

PEå·¥å…·ç®±åˆ¶ä½œ

ä¸»è¦æ­¥éª¤ï¼š

* ç¬¬ä¸€æ­¥:åˆ¶ä½œå‰çš„è½¯ä»¶ã€ç¡¬ä»¶å‡†å¤‡ï¼š8GåŠä»¥ä¸ŠUç›˜ä¸€ä¸ªéƒ½å¯ä»¥ï¼Œ ä¸€å°å¯æ­£å¸¸å¯ä¸Šç½‘çš„ç”µè„‘
* ç¬¬äºŒæ­¥:ç”¨ç”µè„‘åº—Uç›˜å¯åŠ¨åˆ¶ä½œå·¥å…·åˆ¶ä½œå¯åŠ¨Uç›˜
* ç¬¬ä¸‰æ­¥:ä¸‹è½½æ‚¨éœ€è¦çš„ç³»ç»Ÿæ–‡ä»¶å¹¶å¤åˆ¶åˆ°Uç›˜ä¸­
* ç¬¬å››æ­¥:è¿›å…¥BIOSè®¾ç½®Uç›˜å¯åŠ¨é¡ºåº
* ç¬¬äº”æ­¥:åœ¨è¿›å…¥WIN10 PEæ¨¡å¼åˆ†åŒºå®‰è£…ç³»ç»Ÿå³å¯
* ç¬¬å…­æ­¥:ç³»ç»Ÿæ¿€æ´»é—®é¢˜
* ç¬¬ä¸ƒæ­¥:å®‰è£…é©±åŠ¨é—®é¢˜

## åˆ¶ä½œå·¥å…·ç®±æ•™ç¨‹
é¦–å…ˆå…ˆä¸‹è½½ä¸€ä¸ªåˆ¶ä½œå¯åŠ¨å·¥å…·çš„è½¯ä»¶ï¼š  

ä¸‹è½½åœ°å€:é“¾æ¥ï¼š[http://www.usbrun.com/](http://www.usbrun.com/)


![](/assets/images/20190424WindowsResources/1.webp)

ä¸‹è½½ç²¾ç®€ç‰ˆæœ¬å¥½å å…ˆæŠŠæ€æ¯’è½¯ä»¶å…³æ‰ ï¼ï¼  åŒå‡»å®‰è£…ä¸€ä¸‹æ­¤è½¯ä»¶åˆ°ç”µè„‘ä¸Š ï¼Œå®‰è£…å¥½è½¯ä»¶åæ‰“å¼€  ï¼Œå¦‚æœè½¯ä»¶æç¤ºæ›´æ–°ï¼Œå¯ä»¥å¿½ç•¥ï¼Œä¸éœ€è¦æ›´æ–°ï¼ï¼
 

æŠŠUç›˜æ’ä¸Š 
>ã€æ³¨ï¼šUç›˜ä¼šæ ¼å¼åŒ–ï¼Œæœ‰èµ„æ–™å…ˆæ‹·è´å‡ºæ¥ä¿å­˜é¿å…è¢«æ ¼å¼æ‰äº†ã€‘

è¦æ˜¯çœ‹ä¸åˆ°è®¾å¤‡çš„è¯ï¼Œ æŠŠUç›˜é‡æ–°æ’ä¸€ä¸‹

![](/assets/images/20190424WindowsResources/2.webp)

ç‚¹ä¸€é”®åˆ¶ä½œç„¶åç­‰åˆ¶ä½œå®Œæˆå°±OKï¼ï¼ åˆ¶ä½œå®Œæˆä¹‹å ç‚¹ä¸€ä¸‹æ¨¡æ‹Ÿå¯åŠ¨çœ‹ä¸‹Uç›˜èƒ½ä¸èƒ½å¯åŠ¨ï¼Œèƒ½çš„è¯å°±OKã€‚å…³æ‰å³å¯


## ä¸‹è½½ç³»ç»Ÿæ­¥éª¤


ä¸‹é¢é€‰1ä¸ªéœ€è¦çš„ç³»ç»Ÿç‰ˆæœ¬ä¸‹è½½ (Uç›˜å®¹é‡å¤Ÿå¤§ä¸¤ä¸ªç³»ç»Ÿéƒ½å¯ä»¥ä¸‹è½½ä½¿ç”¨ æ­¤PEæ”¯æŒåŸç‰ˆç³»ç»Ÿå®‰è£…)

WIN7 64ä½ï¼ˆB360B450é”é¾™äºŒä»£CPUä¸»æ¿ä¸æ”¯æŒï¼‰
ç³»ç»Ÿä¸‹è½½è¿æ¥ï¼š[é“¾æ¥](http://www.jsgho.net/win7/jsy/35178.html)(æŠ€æœ¯å‘˜çº¯å‡€ç‰ˆ)



![](/assets/images/20190424WindowsResources/3.webp)

![](/assets/images/20190424WindowsResources/4.webp)


## WIN7~10 64ä½

ä¸“ä¸šç‰ˆ ä¸‹è½½åœ°å€ï¼š[http://msdn.itellyou.cn/](http://msdn.itellyou.cn/)  

å¯å¤åˆ¶æ­¤ç£åŠ›é“¾æ¥ä½¿ç”¨è¿…é›·æ–°å»ºä¸‹è½½ï¼š

ed2k://|file|cn_windows_10_business_edition_version_1803_updated_sep_2018_x64_dvd_07b164ed.iso|5229189120|5CC3C32DB198D647DCED4B0EB96B8547|/

ä¸‹è½½å‚è€ƒï¼š

![](/assets/images/20190424WindowsResources/5.webp)

ä¸‹è½½å¥½çš„ç³»ç»Ÿç›´æ¥æ‹·è´åˆ°æ‚¨åˆšåˆšåˆ¶ä½œå¥½çš„çš„Uç›˜é‡Œï¼Œéšä¾¿æ”¾ä»€ä¹ˆä½ç½®éƒ½å¯ä»¥ã€‚

![](/assets/images/20190424WindowsResources/6.webp)


## è®¾ç½®Uç›˜å¯åŠ¨æ­¥éª¤

åˆ¶ä½œå¥½çš„Uç›˜æ’ä¸Šæ‚¨éœ€è¦è£…ç³»ç»Ÿçš„ç”µè„‘ä¸Šï¼Œä»¥ä¸‹ä¸»æ¿Uç›˜å¿«æ·å¯åŠ¨æŒ‰é”®
åç¡•å¯åŠ¨å¿«æ·é”®ï¼šF8  
æŠ€å˜‰ã€å¾®æ˜Ÿã€ä¸ƒå½©è™¹ã€æ˜‚è¾¾ã€åæ“ã€æ˜ æ³° ç‚¹å‡»ï¼šF11  
å“ç‰Œæœºï¼šæƒ æ™®ã€æƒ æ™®ã€æˆ´å°”ã€è”æƒ³ã€ç¥å· ç‚¹å‡»ï¼šF12  

ä»¥ä¸‹åç¡•ä¸»æ¿å¿«æ·å¯åŠ¨èœå•é€‰æ‹©è¿›å…¥Uç›˜PEå‚è€ƒå›¾ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æœºå¯åŠ¨è®¾å¤‡é€‰é¡¹ï¼Œæˆ‘ä»¬é€‰æ‹©åˆšåˆšåšå¥½çš„Uç›˜ ADATA USB Flash Drlve(14800MB)æŒ‰å›è½¦å³å¯  

>ï¼ˆæ³¨æ„ï¼šé€‰æ‹©ä¸å¸¦UEFIçš„é€‰é¡¹ï¼‰

![](/assets/images/20190424WindowsResources/7.webp)

å‡ºç°Uç›˜å¯åŠ¨ç•Œé¢ å¦‚ä¸‹å›¾é€‰æ‹©  å¯åŠ¨WIN10 PE X 64 ï¼Œåˆ«çš„ä¸ç”¨å»é€‰æ‹©ã€‚ 

![](/assets/images/20190424WindowsResources/8.webp)


## åˆ†åŒºå®‰è£…ç³»ç»Ÿæ­¥éª¤

è¿›å»PEä¹‹å æˆ‘ä»¬å°±è¦å¯¹æ–°ç¡¬ç›˜ è¿›è¡Œä¸€ä¸ªåˆ†åŒºæ“ä½œäº†  

>ã€å¦‚æœæ˜¯è€ç¡¬ç›˜ï¼Œæœ‰åˆ†åŒºçš„ é‚£å¯ä»¥çœç•¥è¿™ä¸€æ­¥ ç›´æ¥æŒ‰ç…§ä¸‹é¢è£…ç³»ç»Ÿã€‘

è¿™é‡Œé‡‡ç”¨çš„æ˜¯ä¸€ä¸ªä¸‰æ˜Ÿ120Gçš„å›ºæ€ç¡¬ç›˜ï¼Œ__ä¸€èˆ¬ä¸ºäº†å‘å›å›ºæ€æœ€å¤§æ€§èƒ½ï¼Œéƒ½è¦åœ¨ä¸»æ¿é¢„å…ˆå¼€å¯AHCIæ¨¡å¼å’Œåˆ†åŒºçš„æ—¶å€™é€‰æ‹©4Kå¯¹é½__ï¼Œå¦å¤–3.0çš„æ•°æ®çº¿å’Œä¸»æ¿å¿…é¡»æ”¯æŒ3.0çš„æ¥å£ã€‚

AHCIæ¨¡å¼æ˜¯ä¸»æ¿è‡ªå¸¦çš„ æ–°ä¸»æ¿éƒ½æ”¯æŒ ï¼Œå¦‚æœæœ‰çš„è€çš„ä¸»æ¿æ˜¯IDEçš„é¢„å…ˆè®¾ç½®å¥½ï¼Œåç¡•æŠ€å˜‰B250ç­‰ä»¥ä¸Šä¸»æ¿ é»˜è®¤éƒ½æ˜¯AHCIæ¨¡å¼ä¸éœ€è¦æ›´æ”¹ 

 å°±è¦é¦–å…ˆæ‰“å¼€DGåˆ†åŒºå·¥å…·ç®±è¿›è¡Œåˆ†åŒºå¤„ç† ï¼Œå¦‚ä¸‹å›¾
 
![](/assets/images/20190424WindowsResources/9.webp)
 
ç‚¹å‡»åˆ†åŒºå·¥å…· ä¹‹å ä¼šçœ‹åˆ°æ‚¨çš„ç¡¬ç›˜  è¿™æ—¶å€™ å¯ä»¥é€‰æ‹©æ‚¨çš„æ–°ç¡¬ç›˜ä¹‹å ç‚¹å‡»ä¸Šé¢çš„å¿«é€Ÿåˆ†åŒº å¦‚ä¸‹å›¾ 
 
![](/assets/images/20190424WindowsResources/10.webp)

åœ¨æ–°çš„é¡µé¢ä¸­ ä½ å¯ä»¥é€‰æ‹©åˆ†å‡ ä¸ªåŒº  å¤šå°‘å®¹é‡ éƒ½å¯ä»¥è‡ªè¡Œå¡«å†™ åˆ«çš„ä¸éœ€è¦å»æ”¹å˜ ï¼Œå¦å¤–å³ä¸‹è§’ å°±æ˜¯4Kå¯¹é½ï¼Œåªè®¸å‹¾é€‰å³å¯ï¼Œå¦‚ä¸‹å›¾

> æ³¨ï¼šå›ºæ€ç¡¬ç›˜éœ€è¦é€‰æ‹©4Kï¼Œæœºæ¢°ç¡¬ç›˜ä¸ç”¨ç°åœ¨ ï¼Œé€‰æ‹©äº†ä¼šå¯¼è‡´è¿›ä¸äº†ç³»ç»Ÿ


![](/assets/images/20190424WindowsResources/11.webp)


åˆ†åŒºå¥½åå…³é—­åˆ†åŒºæ¥å£çª—å£çœ‹ä¸‹ä¸€æ­¥æ“ä½œ


##  å®‰è£…ç³»ç»Ÿé•œåƒæ­¥éª¤


æ‰“å¼€æ¡Œé¢ä¸Šçš„ç”µè„‘åº—ä¸€é”®è¿˜åŸï¼Œå¦‚ä¸‹å›¾  

* â‘ é€‰æ‹©ç³»ç»Ÿé•œåƒæ–‡ä»¶ï¼Œç­‰å¾…è‡ªåŠ¨è¯†åˆ«å’ŒæŒ‚è½½åå†æ¬¡é€‰æ‹©ç³»ç»Ÿç‰ˆæœ¬ã€‚
* â‘¡é€‰æ‹©éœ€è¦å®‰è£…ç³»ç»Ÿçš„åˆ†åŒºã€‚[å¯ä»¥æ ¹æ®åˆ†åŒºå®¹é‡æ ¼å¼ä¿¡æ¯æ¥åˆ¤æ–­åˆ†åŒº]
* â‘¢ç‚¹å‡»æ‰§è¡ŒæŒ‰é’®ç­‰å¾…ç³»ç»Ÿå®‰è£…å®Œæˆåé‡å¯æ‹”æ‰Uç›˜ã€‚

![](/assets/images/20190424WindowsResources/12.webp)
![](/assets/images/20190424WindowsResources/13.webp)
![](/assets/images/20190424WindowsResources/14.webp)
![](/assets/images/20190424WindowsResources/15.webp)
![](/assets/images/20190424WindowsResources/16.webp)
![](/assets/images/20190424WindowsResources/17.webp)

> PSï¼šç­‰è¿›åº¦æ¡èµ°å®Œäº†  æç¤ºé‡å¯çš„æ—¶å€™ä¸€å®šè¦æ‹”æ‰Uç›˜   å†é‡å¯å“¦ï¼ï¼ä¹‹åå°±å¯ä»¥æ­£å¸¸è¿›å…¥å®‰è£…ç³»ç»Ÿè¿‡ç¨‹äº†ï¼Œç­‰å¾…å¤§æ¦‚5-10åˆ†é’Ÿå·¦å³è£…å¥½é‡å¯å³å¯æ­£å¸¸ä½¿ç”¨äº†  

å…è´£æ¡æ¬¾
> (æœ¬ä½œå“ä»…é™ç½‘å‹äº¤æµå®‰è£…ç³»ç»Ÿç»éªŒï¼Œæˆ–å¯ä½œä¸´æ—¶å®‰è£…æµ‹è¯•PCç¡¬ä»¶ä¹‹ç”¨ï¼Œè¯·åœ¨å®‰è£…å24å°æ—¶å†…åˆ é™¤ï¼Œè‹¥éœ€è¦é•¿æœŸä½¿ç”¨ï¼Œè¯·è´­ä¹°æ­£ç‰ˆç³»ç»ŸåŠè½¯ä»¶ã€‚)


##  æ¿€æ´»ç³»ç»Ÿæ­¥éª¤


æ¿€æ´»å·¥å…·ç®±ä¸‹è½½è¿æ¥ï¼š 

`win7`ç‚¹å‡»è¿™é‡Œ é“¾æ¥: `https://pan.baidu.com/s/1iWVZW534JKqAd9mu1B0VzQ` æå–ç : `u71b`

`win8`é“¾æ¥: `https://pan.baidu.com/s/1M6t2nGwlBM4qXWT_imcI-A` æå–ç : tkhb

`win10` é“¾æ¥: `https://pan.baidu.com/s/1Tr-0PYBVmQFR0HNvzZ5yjA` æå–ç : a3mt

## åç¡•ä¸»æ¿ç½‘å¡é©±åŠ¨å®‰è£…æ­¥éª¤

æ•™ç¨‹è¿æ¥ï¼š[http://note.youdao.com/noteshare?id=40345f63671ea936740aa771cca2d438](http://note.youdao.com/noteshare?id=40345f63671ea936740aa771cca2d438)


å»ºè®®ä¸Šç½‘å…¶ä»–é©±åŠ¨é—®é¢˜ä¸‹è½½ï¼š[é©±åŠ¨ç²¾çµ æ ‡å‡†ç‰ˆ](http://www.drivergenius.com/)


# æ€»ç»“

æ¯æ¬¡è£…æœºæ€»å¿˜è®°ä¸€äº›æµç¨‹ è¿™é‡Œè®°å½•ä¸‹æ¥


[å‚è€ƒ PEå®‰è£…ç³»ç»Ÿæ•™ç¨‹](https://note.youdao.com/ynoteshare1/index.html?id=e0f8c30393c4f069555d286020f9d394&type=note)  
[Uç›˜åˆ»å½•å®‰è£…åŸç‰ˆç³»ç»Ÿæ•™ç¨‹](http://05aebac1.wiz03.com/share/s/05HHH13zK4EY2bE37Q00RO3H1CvO101754vQ2bNyFE2nhALV?tdsourcetag=s_pcqq_aiomsg)  
[I tell youç¥å¥‡çš„é•œåƒä¸‹è½½ç½‘ç«™ ç»å¯¹çº¯æ´](http://msdn.itellyou.cn/)


URL: https://sunyazhou.com/2019/04/AVRoutePickerView/index.html.md
Published At: 2019-04-17 15:19:52 +0000

# AVRoutePickerView

![](/assets/images/20190417AVRoutePickerView/cover_album.webp)


# å‰è¨€


æœ€è¿‘æ— æ„ä¸­çœ‹äº†ä¸€ä¸‹AVKitå‘ç°å†…éƒ¨å¢åŠ äº†å¾ˆå¤šæ–°çš„å†…å®¹.å…¶ä¸­æœ‰ä¸ª`AVRoutePickerView`çš„UIæ§ä»¶,æ‰“ç®—ç ”ç©¶ä¸€ä¸‹. å…¶å®è¿™ä¸ªå¾ˆå¸¸è§å°±åœ¨ç³»ç»Ÿçš„æ§åˆ¶ä¸­å¿ƒ ä¸‹æ‹‰å±å¹•å°±èƒ½çœ‹è§ å½“ä½ è¿æ¥è€³æœºæˆ–è€…æ— çº¿è“ç‰™è®¾å¤‡çš„æ—¶å€™.

![](/assets/images/20190417AVRoutePickerView/RouteChange2.gif)

è¿™é‡Œç½‘æ˜“äº‘éŸ³ä¹ä¸­æœ‰å®è·µçš„ä¾‹å­  

![](/assets/images/20190417AVRoutePickerView/RouteChange1.gif)

è¿™ä¸ªæ§ä»¶ä¸»è¦ç”¨äºAirPlayæŠ•å± å’ŒéŸ³é¢‘çš„çº¿è·¯åˆ‡æ¢

é‚£ä¹ˆæˆ‘ä»Šå¤©å°±è·Ÿå¤§å®¶ä¸€èµ·å­¦ä¹ ä¸€ä¸‹è¿™ä¸ªæ–°çš„æ§ä»¶

## ä»£ç å®ç°

å¯¼å…¥`#import <AVKit/AVKit.h>`

å‰©ä¸‹çš„å°±æ˜¯åˆ›å»ºå®ä¾‹è°ƒç”¨æ–¹æ³•

è¿™é‡Œç”¨ViewControlleråšç¤ºä¾‹

``` objc
@interface ViewController ()  <AVRoutePickerViewDelegate>

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    if (@available(iOS 11.0, *)) {
        AVRoutePickerView *routerPickerView = [[AVRoutePickerView alloc] initWithFrame:CGRectMake(100, 100, 100, 100)];
        routerPickerView.activeTintColor = [UIColor cyanColor];
        routerPickerView.delegate = self;
        [self.view addSubview:routerPickerView];
    } else {
        // Fallback on earlier versions
    }
    
}

//AirPlayç•Œé¢å¼¹å‡ºæ—¶å›è°ƒ
- (void)routePickerViewWillBeginPresentingRoutes:(AVRoutePickerView *)routePickerView API_AVAILABLE(ios(11.0)){
    NSLog(@"Airplayè§†å›¾å¼¹å‡º");
}
//AirPlayç•Œé¢ç»“æŸæ—¶å›è°ƒ
- (void)routePickerViewDidEndPresentingRoutes:(AVRoutePickerView *)routePickerView API_AVAILABLE(ios(11.0)){
    NSLog(@"Airplayè§†å›¾å¼¹å›");
}

@end
```

æ·»åŠ å®Œä¹‹åè¿è¡Œå¦‚ä¸‹

![](/assets/images/20190417AVRoutePickerView/RouteChange3.gif)

`AVRoutePickerView `è¿™ä¸ªViewæä¾›çš„API å°±ä¸¤ä¸ªé¢œè‰²å€¼å‰©ä¸‹çš„å•¥éƒ½æ²¡æœ‰,å•¥éƒ½æ”¹ä¸äº†,é‚£æ€ä¹ˆæ‰èƒ½å®ç°ç½‘æ˜“äº‘éŸ³ä¹é‚£æ ·è‡ªå®šä¹‰å›¾æ ‡å‘¢ï¼Ÿ


##### æ·»åŠ è‡ªå®šä¹‰è§†å›¾

``` objc
UIImageView *imageView = [[UIImageView alloc] initWithFrame:routerPickerView.bounds];
        imageView.image = [UIImage imageNamed:@"logo2"];
        [routerPickerView addSubview:imageView];

```

![](/assets/images/20190417AVRoutePickerView/RouteChange4.gif)

è‡ªå·±åŠ ä¸ªå›¾æ ‡å³å¯.


# æ€»ç»“

æ­¤æ§ä»¶åªé€‚ç”¨äºiOS11ä»¥å,ä½¿ç”¨çš„æ—¶å€™ è®°å¾—åŠ å¯ç”¨æ€§æ£€æµ‹API

``` objc
if (@available(iOS 11.0, *)) {
	//è¿™é‡Œå†™åˆ›å»ºè§†å›¾ä»£ç 
}
```

è¿™ä¸ªæ§ä»¶åœ¨å¤šæ•°åœºæ™¯ä¸Šæå‡äº†ç”¨æˆ·ä½“éªŒ,æ¯”å¦‚éŸ³è§†é¢‘ç±»appç»å¸¸é¢‘ç¹æ¥çº¿æ§æˆ–è€…è“ç‰™è€³æœº,é‚£ä¹ˆå¯¹è¿™ä¸ªæœ‰è¦æ±‚çš„å¯ä»¥è¯•è¯•.æ„Ÿè°¢æ”¯æŒ!


[demoç‚¹å‡»è¿™é‡Œä¸‹è½½](https://github.com/sunyazhou13/AVRoutePickerViewDemo)


URL: https://sunyazhou.com/2019/03/UIScrollTextDemo/index.html.md
Published At: 2019-03-21 09:50:20 +0000

# iOSæŠ–éŸ³æ»šåŠ¨å­—å¹•

![](/assets/images/20190321UIScrollTextDemo/CAGradientCover.webp)

# å‰è¨€

å¾ˆä¹…æ²¡æ›´æ–°åšå®¢äº†(å®¶é‡Œäº‹æƒ…æ¯”è¾ƒå¤šæ—¶é—´å¤ªç´§è¿«åŠ ä¸Šå·¥ä½œæ—¶é—´æœ‰é™),ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯æŠ–éŸ³å¾—æ»šåŠ¨å­—å¹•,ä¹Ÿå°±æ˜¯éŸ³ä¹ä¸“è¾‘çš„ä¸“è¾‘åç§° åºŸè¯ä¸å¤šè¯´ä¸Šå›¾

æŠ–éŸ³å¦‚ä¸‹  
![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo0.gif)

ç³»ç»Ÿçš„æ»šåŠ¨å­—å¹•å¦‚ä¸‹

![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo4.gif)

æœ¬ç¯‡å®Œæˆä¹‹åå¦‚ä¸‹  
![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo5.gif)


* æ”¯æŒè’™ç‰ˆæ¸å˜æ¨¡ç³Š å¯è°ƒèŠ‚
* æ”¯æŒå¯Œæ–‡æœ¬å­—ç¬¦ä¸²ç”¨äºæ˜¾ç¤ºè¡¨æƒ…æˆ–è€…å›¾ç‰‡


# å¼€ç¯‡

æ•´ä¸ªå®ç°æ¯”è¾ƒç®€å• ä¸è¶…è¿‡ 200è¡Œä»£ç 

![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo1.gif)

é¦–å…ˆæˆ‘ä»¬è¦ç”¨åˆ°ä¸¤ä¸ªCALayer

* `CATextLayer` ç”¨äºå±•ç¤ºæ–‡æœ¬
* `CAGradientLayer` ç”¨äºç»™æ–‡æœ¬åŠ è’™ç‰ˆ


ç„¶åæˆ‘ä»¬æ–°å»ºä¸€ä¸ª`UIScrollTextView`ç»§æ‰¿è‡ª`UIView`(æˆ‘è¿™æ˜¯çº¯å¨±ä¹å†™æˆUIå‰ç¼€å¤§å®¶å¯è‡ªè¡Œå°è£…å“ˆ.)

``` objc
@interface UIScrollTextView : UIView

@property (nonatomic, copy  ) NSString           *text;   //1
@property (nonatomic, strong) UIColor            *textColor; //2
@property (nonatomic, strong) UIFont             *font;  //3
 
@property (nonatomic, strong) NSAttributedString *attrString; //4

/**
 æ¸å˜å¼€å§‹çš„è·ç¦»(0~0.5) æ¨è 0.0x eg:0.026,
 å¦‚æœè®¾ç½®æˆ1çš„æ—¶å€™è§†å›¾ä¸å¤Ÿé•¿ä¼šå‡ºç°æº¢å‡ºå¾—æƒ…å†µ ä¸æ¨èè¶…å‡ºèŒƒå›´
 */
@property (nonatomic, assign) CGFloat            fade; //5

@end
```

å¯¹å¤–æš´éœ²çš„æ¥å£ 

* 1.æ˜¾ç¤ºçš„æ–‡æœ¬å†…å®¹
* 2.æ–‡æœ¬é¢œè‰²
* 3.æ–‡æœ¬å­—ä½“
* 4.å±æ€§å­—ç¬¦ä¸² è‡ªè¡Œå¯æ§é¢œè‰²å­—ä½“å’Œæ ·å¼
* 5.è’™ç‰ˆæ¸å˜æ¨¡ç³Šçš„ æ¸å˜é•¿åº¦ 

é¦–å…ˆå¤§å®¶å¯ä»¥å…ˆå¿½ç•¥è¿™äº›å¯¹å¤–æš´éœ²çš„æ¥å£ åˆ°.mä¸­çœ‹å®ç°å¦‚ä¸‹

``` objc
@interface UIScrollTextView ()

@property (nonatomic, strong) CATextLayer  *textLayer; //æ–‡æœ¬layer  
@property (nonatomic, strong) CAGradientLayer *gradientLayer; //è’™ç‰ˆæ¸å˜layer

@property (nonatomic, assign) CGFloat      textSeparateWidth; //æ–‡æœ¬åˆ†å‰²å®½åº¦
@property (nonatomic, assign) CGFloat      textWidth;   //æ–‡æœ¬å®½åº¦
@property (nonatomic, assign) CGFloat      textHeight;  //æ–‡æœ¬é«˜åº¦
@property (nonatomic, assign) CGRect       textLayerFrame; //æ–‡æœ¬layerçš„frame
@property (nonatomic, assign) CGFloat      translationX; //æ–‡å­—ä½ç½®æ¸¸æ ‡

@end
```

åœ¨`initWithFrame:`;å’Œ`awakeFromNib`æ–¹æ³•ä¸­ åˆå§‹åŒ–ä¸€äº›æˆå‘˜å˜é‡

``` objc
- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self configProperty];//åˆå§‹åŒ–æˆå‘˜å˜é‡ //1
        [self initLayer]; //2
    }
    return self;
}

- (void)configProperty {
    _text = @"";
    _textColor = [UIColor whiteColor];
    _font = [UIFont systemFontOfSize:14.0];
    self.textSeparateWidth = [kSeparateText calculateSingleLineSizeFromFont:self.font].width;
    _fade = 0.026;
    
}
```

* 1.configPropertyæ–¹æ³• åˆå§‹åŒ–é»˜è®¤å€¼
* 2.initLayeræ–¹æ³•åˆ›å»ºæˆ‘ä»¬éœ€è¦çš„2ä¸ªlayer
> configPropertyæ–¹æ³• åˆå§‹åŒ–æˆå‘˜å˜é‡æœ€å¥½ç”¨`_`ä¸‹åˆ’çº¿ è¿™æ ·ä¸ä¼šè§¦å‘`setter`å› ä¸ºæˆ‘ä»¬å¾ˆå¤šçš„ä»£ç éƒ½æ˜¯å†™åœ¨setterå’Œgetterä¸­

#### åˆå§‹åŒ–Layer


ä¸‹é¢æˆ‘ä»¬é‡ç‚¹çœ‹ä¸‹`initLayer`

``` objc
- (void)initLayer {
    //æ–‡æœ¬layer  1
    if (self.textLayer == nil) {
        self.textLayer = [[CATextLayer alloc] init];
    }
    self.textLayer.alignmentMode = kCAAlignmentNatural; //è®¾ç½®æ–‡å­—å¯¹é½æ¨¡å¼ è‡ªç„¶å¯¹é½
    self.textLayer.truncationMode = kCATruncationNone;  //è®¾ç½®æˆªæ–­æ¨¡å¼
    self.textLayer.wrapped = NO; //æ˜¯å¦æŠ˜è¡Œ
    self.textLayer.contentsScale = [UIScreen mainScreen].scale;
    if (self.textLayer.superlayer == nil) {
        [self.layer addSublayer:self.textLayer];
    }
    
    //æ¸å˜ 2
    self.gradientLayer = [CAGradientLayer layer];
    self.gradientLayer.shouldRasterize = YES;
    self.gradientLayer.rasterizationScale = [UIScreen mainScreen].scale;
    self.gradientLayer.startPoint = CGPointMake(0.0f, 0.5f); //3
    self.gradientLayer.endPoint = CGPointMake(1.0f, 0.5f);  //4
    id transparent = (id)[UIColor clearColor].CGColor; // 5
    id opaque = (id)[UIColor blackColor].CGColor; //5
    self.gradientLayer.colors = @[transparent, opaque, opaque, transparent]; // 6
    self.gradientLayer.locations = @[@0,@(self.fade),@(1-self.fade),@1]; // 7
    self.layer.mask = self.gradientLayer; //8
}
```

ä»£ç `1`å¤„ åˆ›å»º`CATextLayer`å’Œæˆ‘ä»¬åˆ›å»ºå…¶å®ƒCALayerä¸€æ ·æ²¡å•¥å¥½è¯´çš„,è®¾ç½®æŠ˜è¡Œã€å¯¹é½ã€æˆªæ–­...

ä»£ç `2`å¤„ è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹è¿™ä¸ª`CAGradientLayer`

ä»£ç `3`å’Œ`4`å¤„æ˜¯è®¾ç½®è’™ç‰ˆæ¸å˜ çš„å¼€å§‹æ–¹å‘å’Œç»“æŸæ–¹å‘. (ä»¥å±å¹•å·¦ä¸‹è§’ä¸ºåŸç‚¹0,0è®¡ç®— åˆ°å±å¹•å³ä¸Šè§’1ï¼Œ1)
   
> å¦‚æœå¼€å§‹ç‚¹æ˜¯(0.0,0.5)ç»“æŸç‚¹æ˜¯(1.0,0.5)æ˜¯æ¨ªå‘æ¸å˜  
> å¦‚æœå¼€å§‹ç‚¹æ˜¯(0.5,0)ç»“æŸç‚¹æ˜¯(0.5,1)æ˜¯çºµå‘æ¸å˜  
> è¿™ä¸¤ä¸ªç‚¹å†³å®šäº†æ¸å˜çš„æ–¹å‘


æˆ‘ä»¬å¯ä»¥æŠŠä»£ç å»æ‰è¿è¡Œçœ‹ä¸‹ä¸åŠ è’™ç‰ˆçš„æ•ˆæœå›¾ å¦‚ä¸‹:

![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo2.gif)

è¿™é‡Œæˆ‘ç”¨cyané¢œè‰²åŒºåŸŸä»£è¡¨è§†å›¾çš„å¤§å°,æ–‡æœ¬ä¸åŠ è’™ç‰ˆå®é™…ä¸Šè¶…å‡ºæ˜¾ç¤ºèŒƒå›´çš„. 

> æ³¨æ„: åŠ¨ç”»ä¸æ˜¯è¿™ä¸ªlayerè‡ªå¸¦,æ˜¯æˆ‘ä»¬è‡ªå·±åŠ çš„ä»£ç ,å¾€ä¸‹çœ‹ æœ‰ä»£ç 

ä»£ç `5`å¤„ä»£ç  æ˜¯ç»™å½“å‰æ¸å˜layeråŠ æ¸å˜é¢œè‰² å®ç°è’™ç‰ˆæ¨¡ç³Šé®ç›–çš„æ•ˆæœ

ä»£ç `6`å¤„ æŠŠå¯¹äºçš„é¢œè‰²çš„æ•°ç»„ä¸­ç»™`gradientLayer.colors`

ä»£ç `7`å¤„ å¯¹åº” ä»£ç `6`å¤„ é…åˆä½¿ç”¨,å°±åšåˆ°äº†æˆ‘ä»¬ä¸¤è¾¹æ¸å˜é®ç›–çš„æ•ˆæœ

![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo3.gif)

ä¸Šå›¾å°±æ˜¯æˆ‘ä»¬ä¸‹é¢ä»£ç çš„æ•ˆæœ,æˆ‘ä»¬åŠ äº†4ä¸ªç‚¹

``` objc
self.gradientLayer.colors = @[transparent, opaque, opaque, transparent]; // 6
self.gradientLayer.locations = @[@0,@(self.fade),@(1-self.fade),@1]; // 7
```

#### æ›´æ–°layerå¸ƒå±€

è¿™é‡Œæˆ‘ä»¬è¦åœ¨layoutSubviewsæ–¹æ³•ä¸­è®¡ç®—å‡ºæ­£ç¡®çš„å¸ƒå±€åæ ‡,å› ä¸ºå¤–éƒ¨æœ‰å¯èƒ½ä½¿ç”¨autolayoutå¸ƒå±€.

``` objc
- (void)layoutSubviews {
    [super layoutSubviews];
    
    [CATransaction begin];
    [CATransaction setDisableActions:YES];
    CGFloat textLayerFrameY = CGRectGetHeight(self.bounds)/2 - CGRectGetHeight(self.textLayer.bounds) / 2;
    self.textLayer.frame = CGRectMake(0, textLayerFrameY, CGRectGetWidth(self.textLayerFrame), CGRectGetHeight(self.textLayerFrame));
    self.gradientLayer.frame = self.bounds;
    [CATransaction commit];
}
```
è¿™é‡Œä»£ç ä¸»è¦æ˜¯æ›´æ–°gradientLayer å’ŒtextLayerçš„frame. å¹¶

##### ä¸ºä»€ä¹ˆè¦ç”¨CATransaction? 

å› ä¸ºæˆ‘ä»¬è¦åœ¨åŠ¨ç”»è¿›è¡Œä¸­æ‰‹åŠ¨æ”¹å˜åŠ¨ç”»çš„å‚æ•°è¯¦æƒ…å‚è€ƒ[è®¾ç½®åŠ¨ç”»å‚æ•°](http://jefferyfan.github.io/2016/06/27/programing/iOS/CATransaction/)


### å‰©ä¸‹çš„ä¸»è¦æœ‰3ä¸ªå·¥ä½œ

* ç»˜åˆ¶æ–‡æœ¬layer,å°±æ˜¯æŠŠæƒ³æ˜¾ç¤ºçš„å­—ç¬¦ä¸²ç»™self.textLayer.string
* æ·»åŠ æ»šåŠ¨åŠ¨ç”» 
* æˆå‘˜å˜é‡çš„setterä¸­è°ƒç”¨ç»˜åˆ¶æ–‡æœ¬layerå’Œæ»šåŠ¨åŠ¨ç”»æ–¹æ³•


##### æ·»åŠ drawTextLayerç§æœ‰æ–¹æ³•

``` objc
//æ‹¼è£…æ–‡æœ¬
- (void)drawTextLayer {
    self.textLayer.foregroundColor = self.textColor.CGColor;
    CFStringRef fontName = (__bridge CFStringRef)self.font.fontName;
    CGFontRef fontRef = CGFontCreateWithFontName(fontName);
    self.textLayer.font = fontRef;
    self.textLayer.fontSize = self.font.pointSize;
    CGFontRelease(fontRef);
    // 1
    self.textLayer.string = [NSString stringWithFormat:@"%@%@%@%@%@",_text,kSeparateText,_text,kSeparateText,_text];
}
```
è¿™é‡Œæ³¨æ„ `1` å¤„ ä»£ç  å¹²äº†ä¸¤ä»¶äº‹ 
 
* æ‹¼æ¥æ–‡æœ¬
* ç»™layer.string 

æ ¼å¼æ‹¼æ¥ __æ–‡æœ¬+3ä¸ªç©ºæ ¼+æ–‡æœ¬+3ä¸ªç©ºæ ¼+æ–‡æœ¬__

``` objc
NSString * const kSeparateText          = @"   ";   //3ä¸ªç©ºæ ¼
```
> kSeparateText æ˜¯ä¸ªå¸¸é‡  

##### æ·»åŠ æ–‡æœ¬æ»šåŠ¨åŠ¨ç”»

``` objc
- (void)startAnimation {
    if ([self.textLayer animationForKey:kTextLayerAnimationKey]) {
        [self.textLayer removeAnimationForKey:kTextLayerAnimationKey];
    }
    CABasicAnimation *animation = [CABasicAnimation animation];
    animation.keyPath = @"transform.translation.x"; //æ²¿ç€Xè½´è¿åŠ¨
    animation.fromValue = @(self.bounds.origin.x);
    animation.toValue = @(self.bounds.origin.x - self.translationX);
    animation.duration = self.textWidth * 0.035f;
    animation.repeatCount = MAXFLOAT;
    animation.removedOnCompletion = NO;
    animation.fillMode = kCAFillModeForwards;
    animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];
    [self.textLayer addAnimation:animation forKey:kTextLayerAnimationKey];
}
```

è¿™é‡Œç»™`self.textLayer`åŠ ä¸€ä¸ªCABasicAnimation,è®©å®ƒæ²¿ç€Xè½´è¿åŠ¨,å½“ç„¶å¦‚æœå¤§å®¶å–œæ¬¢åç»­æˆ‘æ·»åŠ å¤šä¸ªæ–¹å‘ç±»ä¼¼[MarqueeLabelæ»šåŠ¨æ–‡æœ¬](https://github.com/sunyazhou13/MarqueeLabel)ä¸€æ ·,ä¸è¿‡æˆ‘è§‰å¾—[MarqueeLabelæ»šåŠ¨æ–‡æœ¬](https://github.com/sunyazhou13/MarqueeLabel)çš„å®ç°å¤ªå¤æ‚,ä¸å¤Ÿæ¥åœ°æ°”,è¿™ä¸ªç®€å•çš„åŠ¨ç”»æ•ˆæœè¿˜æ˜¯è¦è‡ªå·±å†™æ¯”è¾ƒé è°±.


> ç»™self.textLayeræ·»åŠ åŠ¨ç”»å³å¯,ç›¸ä¿¡å¤§å®¶éå¸¸äº†è§£iOSåŠ¨ç”»æˆ‘å°±ä¸ä¸€ä¸€ä»‹ç»äº†.

##### æˆå‘˜å˜é‡çš„setterä¸­è°ƒç”¨ç»˜åˆ¶æ–‡æœ¬layerå’Œæ»šåŠ¨åŠ¨ç”»æ–¹æ³•

``` objc
- (void)setText:(NSString *)text {
    _text = text;
    //è®¡ç®—å•è¡Œæ–‡æœ¬å¤§å°
    CGSize size = [text calculateSingleLineSizeWithAttributeText:_font];
    _textWidth = size.width;
    _textHeight = size.height;
    _textLayerFrame = CGRectMake(0, 0, _textWidth * 3 + _textSeparateWidth * 2, _textHeight);
    _translationX = _textWidth + _textSeparateWidth;
    [self drawTextLayer];
    [self startAnimation];
}
```

è¿™é‡Œæ¯æ¬¡ç»™å½“å‰è§†å›¾è®¾ç½®ç›¸å…³æ–‡æœ¬çš„æ—¶å€™ setterå¤„,å°±è°ƒç”¨ä¸€ä¸‹ æ¸²æŸ“æ–‡æœ¬å’ŒåŠ¨ç”».è¿™æ ·å¯ä»¥å¯¹å¤–éƒ¨æš´éœ²ç›¸å…³æ¥å£å®æ—¶ä¿®æ”¹å®æ—¶ç”Ÿæ•ˆ.è‡³äºå…¶å®ƒçš„å±æ€§å­—ç¬¦ä¸²,å­—ä½“ç­‰ä¹Ÿè¦æœ€åè¿½åŠ ä¸Š

``` objc
[self drawTextLayer];
[self startAnimation];
```

å› ä¸ºæ”¹åŠ¨å¯¹æ–‡æœ¬å¤§å°æœ‰å½±å“

æ–‡å­—çš„è®¡ç®—å¤§å°è¿™é‡Œç”¨çš„æ˜¯ CoreText,æ”¯æŒå¤šè¡Œå’Œå•è¡Œ

å±æ€§å­—ç¬¦ä¸²ä¹Ÿä¸€æ ·å°±ä¸å†™åœ¨è¿™é‡Œäº†. è¯¦ç»†ä»£ç demoæˆ‘å·²ç»æŠŠå®ƒå†™åˆ°æ–‡ç« ä¸‹æ–¹ å¤§å®¶è‡ªè¡ŒåŠ è½½å­¦ä¹ å³å¯


æœ€ç»ˆæ•ˆæœ  
![](/assets/images/20190321UIScrollTextDemo/scrolltextdemo5.gif)

# æ€»ç»“

ç”±äºä¸šä½™æ—¶é—´æœ‰é™,æ²¡èƒ½1ä¸ªæœˆç¨³å®šæ›´æ–°2åæ–‡ç« ,è¯·å„ä½åŒä»ç†è§£,æŠ–éŸ³ç³»åˆ—åŠ¨ç”»éœ€è¦å…ˆå†™demoç„¶åä»”ç»†ç ”ç©¶,æœ€ç»ˆæ‰å½¢æˆæ–‡ç« .åˆ¶ä½œä¸æ˜“,æœ¬ç¯‡ä¹Ÿå‚è€ƒäº†å¼€æºä»£ç å’Œä¸€äº›æ»šåŠ¨å­—å¹•çš„åº“.ç”±äºæ¼”ç¤ºçš„ä¸å®Œç¾,æœ‰äº›ç±»è¿˜æœ‰å¯æ‰©å±•ç©ºé—´,æ¯”å¦‚ å¼€å§‹åŠ¨ç”»å’Œç»“æŸåŠ¨ç”»å¯¹å¤–æš´éœ²æ¥å£,æ¯”å¦‚åƒç³»ç»Ÿé‚£æ ·çš„è‡ªç„¶æ·»åŠ åŠ¨ç”»ç»„. æœ¬ç¯‡æ„Ÿè°¢å¼€æºä½œè€…[qiaoshi](https://github.com/sshiqiao/douyin-ios-objectc),å› ä¸ºä½œè€…å†™çš„ä¸æ˜¯å¾ˆå®Œç¾æˆ‘å­¦ä¹ ç ”ç©¶ä¸€ä¸‹,å¢åŠ äº†æ¸å˜æ•ˆæœå’Œå±æ€§å­—ç¬¦ä¸²å¾—æ”¯æŒ. 

[æœ¬ç¯‡demo](https://github.com/sunyazhou13/UIScrollTextDemo)





URL: https://sunyazhou.com/2019/02/Tools/index.html.md
Published At: 2019-02-15 10:40:15 +0000

# Macä¸Šçš„ä¸€äº›å¥½è½¯ä»¶æ¨è

# å‰è¨€

æ–°å¹´ç¬¬ä¸€ç¯‡ æŠŠè‡ªå·±ç”¨çš„æ¯”è¾ƒå¥½çš„å·¥å…·éƒ½è®°å½•ä¸‹æ¥


## æˆªå± Snipaste

æ²¡å½“æ²¡æœ‰ç½‘ç»œçš„æ—¶å€™ æˆ–è€…æ‹¿åˆ°æ–°macçš„æ—¶å€™ç”±äºæ²¡æœ‰ä»€ä¹ˆè½¯ä»¶æˆªå±,ä¸å¾—ä¸ç”¨QQæˆ–è€…å¾®ä¿¡è‡ªå¸¦çš„æˆªå±.è¿™å°±é€¼ç€æˆ‘ä¸å¾—ä¸å®‰è£…è¿™ä¸¤ä¸ªappï¼Œæœ‰äº†Snipaste è·Ÿæˆªå±è¯´å†è§å§

![](/assets/images/20190215Tools/snipaste.webp)

Snipasteæ˜¯ä¸€ä¸ªå°å·§å¼ºå¤§çš„æˆªå›¾è½¯ä»¶ï¼Œå¯ä»¥ç›´æ¥å¯¹æˆªå›¾è¿›è¡Œæ‰“ç ã€æ ‡æ³¨ã€åˆ†äº«ï¼Œè€Œä¸ç”¨å…ˆä¿å­˜åˆ°æœ¬åœ°.

ä½¿ç”¨æ–¹æ³•æ˜¯æŒ‰ä½`Fn`+`F1` å°±å‡ºç°äº†æˆªå±é¡µé¢å¤§å®¶å¯ä»¥è¯•è¯•

[ä¸‹è½½åœ°å€](https://www.snipaste.com/)


## å¿«æ·é”®æŸ¥çœ‹å™¨CheatSheet

CheatSheetå¯ä»¥å¿«é€Ÿè°ƒå‡ºå½“å‰è½¯ä»¶æ”¯æŒçš„å¿«æ·é”®ï¼Œé•¿æŒ‰commandå³å¯ï¼Œç®€å•å®ç”¨ã€‚

![](/assets/images/20190215Tools/CheatSheet.webp)


> ä½¿ç”¨ä¹‹å‰å¿…é¡»åœ¨éšè—ç­–ç•¥å’Œå®‰å…¨æ€§é‚£ä¸ªåœ°æ–¹ç»™è¿™ä¸ªåŠ ä¸Šè®¿é—®æƒé™æ‰å¯ä»¥ å…·ä½“æœ‰å›¾ç‰‡æç¤ºæŒ‰ç…§å›¾ç‰‡æ“ä½œå³å¯

[ä¸‹è½½åœ°å€](https://www.mediaatelier.com/CheatSheet/)

## ä¸‹è½½å·¥å…· Folx

è¿…é›·çš„æ›¿ä»£å“ï¼Œæ”¯æŒBTä¸‹è½½ï¼Œé‡åˆ°è¿…é›·æ— æ³•ä¸‹è½½çš„èµ„æºæ—¶ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹Folxï¼Œå…è´¹ç‰ˆå°±å¯ä»¥æ»¡è¶³åŸºæœ¬éœ€æ±‚

![](/assets/images/20190215Tools/Folx.webp)

å¯¹äºä¸€ä¸ªæ›¾ç»åœ¨ç™¾åº¦ç½‘ç›˜æ¬è¿‡ç –çš„ç¨‹åºå‘˜ æ–‡ä»¶ä¸Šä¼ ä¸‹è½½è¿™ç§æœ€åŸºç¡€çš„ä¸šåŠ¡å¿…é¡»ç©çš„å¾ˆæºœ,å½“å¹´è¿…é›·æœ‰æ„è®©æˆ‘å»é¢è¯•è¢«æˆ‘æ‹’ç»,ä¸»è¦æ˜¯å…¬å¸è·ç¦»ä½çš„åœ°æ–¹å¤ªè¿œ,ä½†æ˜¯ä»æ–‡ä»¶ä¸‹è½½é™é€Ÿçš„ç­–ç•¥ä¸Šæˆ‘è§‰å¾—æ˜¯è¿…é›·è¿˜æ˜¯ä¸è¶³ä»¥é©±åŠ¨äº’è”ç½‘å‰è¿›çš„æ–¹å‘,è¿™ç§ç¬¬ä¸‰æ–¹çš„folxå®Œå…¨å½»åº•å–ä»£äº†è¿…é›·.

[ä¸‹è½½åœ°å€](https://mac.eltima.com/cn/torrent-client.html)


## è§†é¢‘æ’­æ”¾å™¨IINA

IINAè¢«å¾ˆå¤šäººè®¤ä¸ºæ˜¯Macç«¯çš„æœ€å¼ºè§†é¢‘æ’­æ”¾å™¨ï¼Œç®€æ´æ— å¹¿å‘Šï¼Œå¹¶ä¸”åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒåœ¨çº¿å­—å¹•çš„åŠŸèƒ½ï¼Œå€¼å¾—å°è¯•

![](/assets/images/20190215Tools/IINA.webp)

å„ç§ä½¿ç”¨è¿˜è¡Œ 

[ä¸‹è½½åœ°å€](https://iina.io/)

## Mactracker

Mactrackeræä¾›äº†è‹¹æœå…¨ç³»åˆ—äº§å“çš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ€§èƒ½å‚æ•°ã€å”®ä»·ç­‰ã€‚å¯ä»¥è¿›è¡Œæ£€ç´¢ï¼Œè¿˜æœ‰å‘å¸ƒçš„æ—¶é—´é¡ºåºï¼Œæ–¹ä¾¿æŸ¥çœ‹ã€‚è¿™ä¸ªè½¯ä»¶ä¹Ÿæœ‰iOSç‰ˆã€‚

![](/assets/images/20190215Tools/Mactracker.webp)

åšä¸ºä¸€ä¸ªiOSå¼€å‘è€…,å¦‚æœä¸èƒ½å®æ—¶äº†è§£æ°´æœå…¬å¸å¾—å„ç§äº§å“çš„ç§¯æåŠ¨å‘æˆ‘è§‰å¾—æ˜¯ä¸€ç§ä¸ç§¯æçš„å·¥ä½œè¡¨ç°,è¿™ä¸ªè½¯ä»¶å¯ä»¥å®æ—¶çš„æŸ¥çœ‹è‹¹æœç›®å‰çš„æ‰€æœ‰å‘ä¸è¿‡çš„å‹å·ç­‰ç­‰info.

[ä¸‹è½½åœ°å€iTunes](https://itunes.apple.com/cn/app/mactracker/id430255202?mt=12)


## å›¾ç‰‡æ°´å°æ‰¹é‡æ·»åŠ å·¥å…· PhotoBulk

PhotoBulkå¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œæ‰¹é‡å¤„ç†ï¼Œæ¯”å¦‚æ‰¹é‡åŠ æ°´å°ï¼Œåªè¦è®¾ç½®å¥½äº†å›ºå®šçš„æ°´å°å†…å®¹ã€å¤§å°ã€ä½ç½®ï¼Œå°±å¯ä»¥ä¸€é”®ç”Ÿæˆå¸¦æ°´å°çš„å›¾ç‰‡ï¼Œååˆ†æ–¹ä¾¿ã€‚

![](/assets/images/20190215Tools/PhotoBulk.webp)

[ä¸‹è½½åœ°å€(æ”¶è´¹è½¯ä»¶)](https://itunes.apple.com/cn/app/photobulk-watermark-in-batch/id537211143?mt=12)

## è§£å‹ç¼©

Macå¯¹å‹ç¼©æ–‡ä»¶çš„æ ¼å¼æ”¯æŒä¸è¶³ï¼Œåªæ”¯æŒzipï¼Œå€ŸåŠ©The Unarchiverå¯ä»¥è¡¥è¶³è¿™ä¸ªç¼ºé™·ï¼Œå®ƒæ”¯æŒå¸¸è§çš„zipã€rarã€7zç­‰å¸¸è§æ ¼å¼ï¼Œå¯ä»¥å®Œæˆå‹ç¼©ã€è§£å‹ç­‰å·¥ä½œ

![](/assets/images/20190215Tools/TheUnarchiver.webp)

[ä¸‹è½½åœ°å€](https://itunes.apple.com/cn/app/the-unarchiver/id425424353?mt=12)

## macä¸Šç®¡ç†androidçš„æ–‡ä»¶ç®¡ç† handshaker


é”¤å­ç§‘æŠ€å‡ºå“çš„æ–‡ä»¶ç®¡ç†è½¯ä»¶ï¼Œç”¨äºåœ¨Macç”µè„‘ä¸Šç®¡ç†Androidæ‰‹æœºå†…å®¹ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥äº’ä¼ æ–‡ä»¶ã€åˆ†ç±»ç®¡ç†ã€‚

![](/assets/images/20190215Tools/HandShaker.webp)

[ä¸‹è½½åœ°å€](https://www.smartisan.com/apps/#/handshaker)

## mac è§†é¢‘è½¬gif å·¥å…· GIF Brewery 3

Macä¸Šæœ€å¼ºå¤§çš„GIFå›¾å¤„ç†å·¥å…·ï¼Œå¯ä»¥å°†è§†é¢‘è½¬ä¸ºGIFï¼Œå¯¹å°ºå¯¸ã€å¤§å°ã€èµ·æ­¢ç‚¹ç­‰è¿›è¡Œè®¾ç½®ï¼Œä¹‹å‰æ˜¯ä»˜è´¹è½¯ä»¶ï¼Œç°åœ¨å…è´¹æä¾›ã€‚

![](/assets/images/20190215Tools/GIFBrewery3.webp)

> è¿™ä¸ªè½¯ä»¶ä¸é”™ æˆ‘ç»å¸¸å†™åšå®¢é…å›¾å°±æ˜¯å½•åˆ¶æˆmovè½¬æˆgif 

[ä¸‹è½½åœ°å€]()

## macä¸ŠéŸ³é‡åˆ†åˆ«æ§åˆ¶ Background Music

Background Musicçš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œåœ¨MacBookä¸­åˆ†åˆ«æ§åˆ¶ä¸åŒè½¯ä»¶çš„éŸ³é‡ï¼Œå°±åƒAndroidæ‰‹æœºå’ŒWindowsç”µè„‘ä¸€æ ·ã€‚

![Background Music](/assets/images/20190215Tools/BackgroundMusic.webp)

æˆ‘ç»å¸¸ç”¨ä¼ä¸šIM ä½†æ€»æ˜¯å› ä¸ºèŠå¤©è½¯ä»¶çš„å£°éŸ³å¤ªå¤§ å½±å“ä½“éªŒ,æ²¡æƒ³åˆ°è¿˜æœ‰è¿™ç§ç»†è‡´å…¥å¾®çš„appä¸“é—¨è§£å†³äº†è¿™ä¸ªç—›ç‚¹.

[ä¸‹è½½åœ°å€](https://github.com/kyleneideck/BackgroundMusic/releases)

## ç¬¬ä¸‰æ–¹ç½‘æ˜“äº‘éŸ³ä¹

ç¬¬ä¸‰æ–¹çš„ç½‘æ˜“äº‘éŸ³ä¹æ’­æ”¾å™¨ï¼Œç•Œé¢ç»è¿‡é‡æ–°è®¾è®¡ï¼Œå–œæ¬¢çš„æœ‹å‹å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚

![](/assets/images/20190215Tools/ieaseMusic.webp)


è¿™ä¸ªç¬¬ä¸‰æ–¹çš„è¿‡äºèŠ±å“¨ ä¸å®ç”¨,ä¸å¦‚ä¸è£….

[ä¸‹è½½åœ°å€](https://github.com/trazyn/ieaseMusic)

# æ€»ç»“

æœ‰å¾ˆå¤šè½¯ä»¶æ²¡æœ‰åŠæ—¶æ•´ç† æœ‰æ—¶é—´ä¼šä¸å®šæ—¶æ›´æ–° å¤šè°¢æ”¯æŒ

[å–µç¥çš„å·¥å…·é›†åˆ](https://onevcat.com/apps/)  
[å‚è€ƒithome](https://www.ithome.com/0/409/410.htm)


URL: https://sunyazhou.com/2018/12/FinalSummary/index.html.md
Published At: 2018-12-28 23:04:41 +0000

# 2018å¹´ç»ˆæ€»ç»“

![](/assets/images/20181231FinalSummary/banner.webp)

# å‰è¨€

**åŸ‹å¤´è‹¦å¹²å°½äº”å¹´,æ™¨èµ·é¢é•œç™½å‘å…ˆ.**  
**ä¸€å¹´åˆ°å¤´ä¸è§æ³ª,å²æœˆèè‹’å†¬å´å¯’.**  
**ä»¿ä½›å›åˆ°ä¸€ä¸‰å¹´,åŒ—äº¬ç«™å‰æœ›ç€å¤©.**  
**åŒ—æ¼‚æ˜é‡‘é‚£åˆ»èµ·,äººç”Ÿå·²æ— å†å°‘å¹´.**

![](/assets/images/20181231FinalSummary/yingxiongbense.gif)

_æˆ‘è¦æ˜¯èƒ½åƒä½ é‚£ä¹ˆæ½‡æ´’å°±å¥½äº†,æœ‰æ—¶å€™ä½ èƒ½åšçš„äº‹æƒ…æˆ‘å´åšä¸åˆ°,æˆ‘ç›¸ä¿¡æ­£ä¹‰,å¯æ˜¯æ²¡äººç›¸ä¿¡æˆ‘..._


__è¿™ä¸€å¹´è¿‡çš„åƒç½‘é€Ÿä¸€æ ·å¿«,çœ‹ç€å¹´æœ«åˆåˆ°äº†,æˆ‘ä¾ç„¶å¾—å¢¨å®ˆé™ˆè§„çš„äº¤å‡ºæˆ‘çš„2018å¹´ç»ˆæ€»ç»“__

## 2018å›é¡¾

è¿™ä¸€å¹´çš„æ¸…å•å¦‚ä¸‹:

* å·¥ä½œ
* æ¼”å”±ä¼š
* è¯»ä¹¦
* æŠ€æœ¯
* åšæŒ
* ç”Ÿæ´»
* æ•…äº‹
* ç™¾å¹´
* æ€»ç»“

å¾ˆç²¾å½©...



## å·¥ä½œ

è¿™ä¸€å¹´æˆ‘å¾ˆåŠ¨è¡,4æœˆä»½ä»é‡‘å±±äº‘åˆ°äº†å¿«æ‰‹.è´Ÿè´£å¼€å‘å¿«æ‰‹iOSå›½å†…ç‰ˆAppçš„ç›´æ’­ä¸šåŠ¡.æˆ‘æ˜¯ä¸€ä¸ªä¸å¤ªå–œæ¬¢æ¢å·¥ä½œçš„äºº.ä»ç™¾åº¦ä¸€è·¯èµ°æ¥,å›å¤´çœ‹é™¤äº†å¿ƒé…¸å’Œçƒ­æ³ªç›ˆçœ¶...

æ¥åˆ°äº†å¿«æ‰‹,æ„Ÿè§‰åˆ°è¿™ä¸ªå…¬å¸ç¡®å®å¾ˆæœ‰æ„æ€,æ˜¯å‚åŠ å·¥ä½œä»¥æ¥æˆ‘è®¤ä¸ºæœ€å€¼å¾—å»çš„ä¸€ä¸ªå…¬å¸,å› ä¸ºæˆ‘åœ¨ä¸ä¸€ç¾¤æ¸…åçš„å­¦å­ä¸ºä¼,ä¸åŒ—é‚®çš„å°ä¼™ä¼´è‚©å¹¶è‚©,è¿™é‡ŒåŸºæœ¬50%éƒ½æ˜¯æ¸…åç³»,è€å®è¯´,å½“æˆ‘é¢è¯•çš„æ—¶å€™ä»ä¸Šåˆ10ç‚¹é¢åˆ°ä¸‹åˆ4ç‚¹å¤š,æˆ‘éƒ½ä¸çŸ¥é“æˆ‘æ˜¯æ€ä¹ˆé¢è¿‡çš„æ—¶å€™,æˆ‘çœŸçš„æƒ³æ”¾å¼ƒäº†,å¦‚æœä¸é¢åçš„é¢è¯•é‚£åªèƒ½ç®—å” å—‘.å›¢é˜Ÿçš„ä¸­åšåŠ›é‡æ¥è‡ªäºéº»çœç†å·¥å­¦é™¢,ä»¥åŠFacebookæ¥çš„å¤§ä½¬.è¿™å…¶å®æ˜¯ä¸€ç§æ”¶è·,ä¸€ç§èƒ½ä¸ä¸–ç•Œé¡¶å°–å¤§å­¦çš„æ¯•ä¸šç”Ÿä¸€èµ·å·¥ä½œçš„æœºä¼š,è™½ç„¶æˆ‘çš„å·¥ä½œç»å†ç®—ä¸ä¸Šæœ‰å¤šå¥½,ä¸è¿‡èƒ½ä¸è¿™æ ·çš„å°ä¼™ä¼´ä¸ºä¼æˆ‘åº”è¯¥æ„Ÿåˆ°è£å¹¸,å½“ç„¶è‡ªå·±ä¸èƒ½å¤ªlow.ä»–ä»¬èº«ä¸Šæœ‰æˆ‘å€¼å¾—å­¦ä¹ åœ°æ–¹,æˆ‘ä¸å–œæ¬¢æ¨ªå‘å¯¹æ¯”,åªå–œæ¬¢çºµå‘å¯¹æ¯”,å¯¹æ¯”é‚£äº›æ¯”æˆ‘ä¼˜ç§€çš„äºº.

> åŒ—é‚®(åŒ—äº¬é‚®ç”µå¤§å­¦)è¢«èª‰ä¸ºè®¡ç®—æœºç•Œçš„é»„åŸ”å†›æ ¡,å½•å…¥åˆ†æ•°ä»…æ¬¡äºæ¸…åå‡ åˆ†.

è¯´å®Œäº†æˆ‘çš„æ„Ÿå—,æˆ‘å†è¯´ä¸€ä¸‹è¿™å®¶å…¬å¸çš„ä»·å€¼è§‚,ä»æˆ‘è‚¤æµ…çš„è®¤çŸ¥ä»·å€¼è§‚æ¥çœ‹è¿™å®¶å…¬å¸,ç¡®å®å¾ˆå€¼å¾—__å°Šé‡__,æˆ‘åªè¯´ä¸¤ç‚¹:

* ç¬¬ä¸€:æ¥åœ°æ°”,å¦‚æœä½ å–œæ¬¢æŠ–éŸ³,é‚£æˆ‘åªèƒ½è¯´ä½ å¤ªä¸åˆ‡å®é™…,å› ä¸ºæŠ–éŸ³çš„ç¾å¥³ç˜¦èº«éƒ½æ˜¯AIé€šè¿‡è‚¢ä½“è¯†åˆ«å®ç°çš„,æ¢å¥è¯è¯´ä½ åœ¨è¢«å¿½æ‚ ,å†è¯´æŠ–éŸ³çš„è§†é¢‘ä¸­çš„å†…å®¹,è±ªè½¦,è±ªå®…,é«˜è´µè½»å¥¢çš„ç”Ÿæ´»,å“è´¨é«˜æ¡£çš„é¤å…...__æˆ‘å°±æƒ³é—®ä½ ,ä¸­å›½æœ‰å¤šå°‘äººèƒ½è¿‡çš„ä¸Šä½ åœ¨æŠ–éŸ³è§†é¢‘ä¸­èƒ½çœ‹åˆ°çš„ç”Ÿæ´»,ä½ èƒ½å—ï¼Ÿä½ èƒ½å¼€ç€åŠ³æ–¯è±æ–¯æœ‰äº‹æ²¡äº‹çš„ç‚«è€€å—?__å¿«æ‰‹ä¸ä¸€æ ·,è¿™é‡Œä½ èƒ½çœ‹åˆ°åº•å±‚çš„åŠ³åŠ¨äººæ°‘ä¸ºäº†ç¾å¥½çš„ç”Ÿæ´»è€Œä»˜å‡ºçš„å®è·µè¡ŒåŠ¨,ä»–ä»¬æ²¡æœ‰å¥½çš„èƒŒæ™¯,ä»–ä»¬çœŸçš„åªæœ‰èƒŒå½±,é‚£ç§èƒŒå½±å°±æ˜¯ä»–ä»¬æ‹æ‘„çš„è§†é¢‘çš„æ—¶å€™,è¿™å°±æ˜¯ä»–ä»¬çœŸå®ç”Ÿæ´»çš„å†™ç…§...
* ç¬¬äºŒ:ä¸åƒä¸»æ’­å€¾æ–œæµé‡.åŸºæœ¬ä¸ç­¾çº¦æ˜æ˜Ÿ,åäºº,è®©æ¯ä¸ªæ™®é€šäººèƒ½å‡­å€Ÿè‡ªå·±çš„æœ¬é¢†è„±é¢–è€Œå‡º,è¿™æ¢å¥è¯è¯´å°±æ˜¯åœ¨ç”¨äº’è”ç½‘å¸®åŠ©æ¯ä¸ªäººå¾—åˆ°å…¬å¹³.(å€¾æ–œæµé‡å°±æ˜¯æŠŠä¸€äº›é«˜ç«¯åäººæ¨èç»™ä½ è®©ä½ é»˜è®¤å°±å…³æ³¨ä»–å°±è·Ÿå¾®åšä¼¼çš„æœ€åæ•´çš„éƒ½æ²¡æ³•æ­£å¸¸è¯´è¯å‘ä¸œè¥¿.å…¨æ˜¯åŠˆå¤©ç›–åœ°çš„ç‰›çš®ç™£å¹¿å‘Š)

> å›å¤´å†æ¥çœ‹çœ‹BAT å“ªå®¶æ•¢ç«™å‡ºæ¥è¯´è‡ªå·±åšåˆ°äº†ä¸Šè¾¹è¿™ä¸¤ç‚¹.åšåˆ°äº†çš„åœ¨åº•éƒ¨è¯„è®ºåŒºæ‰£1.

ä»Šå¹´æ¥å¿«æ‰‹åˆä¸¤ä»¶äº‹è®©æˆ‘å¾ˆé«˜å…´

* æ­å·ä¹‹æ—…
* å¿«æ‰‹å®¶ä¹¡

#### å—ä¸‹æ­å·

åˆšåˆ°è¿™å®¶å…¬å¸ä¸ä¹…å°±èµ¶ä¸Šäº†Team Building(å›¢é˜Ÿå»ºè®¾),å»æ­å· æˆ‘ä»æœªå»è¿‡æ­å·,ç¬¬ä¸€ç«™æ˜¯æ­å·çš„æµ·å®

![](/assets/images/20181231FinalSummary/haining.webp)

> å½“å¹´å­™ä¸­å±±å…ˆç”Ÿå°±æ˜¯åœ¨è¿™é‡Œä¸‹è½¦å»é’±å¡˜æ±Ÿè§‚æ½®

è¥¿å¡˜,åœ¨å®¶ä¹¡æˆ‘ä¹ æƒ¯äº†23å¹´çš„ä½çŸ®å¹³æˆ¿,ä»æœªè§è¿‡å¦‚ä¸‹å¾—å»ºç­‘é£æ ¼,è¿™ç§å¾½ç³»çš„ç™½å¢™ç“¦æˆ¿æœ‰ä¸€ç§ä¸­å›½åœ°æ–¹çš„ç‰¹è‰²

![](/assets/images/20181231FinalSummary/hangzhou2.webp)
> çœŸæ˜¯æ æ†æ‹éå´é’©çœ‹äº†ï¼Œæ— äººä¼šç™»ä¸´æ„,ä¼‘è¯´é²ˆé±¼å ªè„å°½è¥¿é£å­£é¹°å½’æœª...

![](/assets/images/20181231FinalSummary/hangzhou1.webp)

![](/assets/images/20181231FinalSummary/hangzhou3.webp)

è¿™é‡Œæ›¾ç»æ˜¯__ä¼å­èƒ¥ï¼ˆå…¬å…ƒå‰559å¹´â€”å…¬å…ƒå‰484å¹´,å¤§çº¦æ˜¯æ˜¥ç§‹æœ«å¹´ï¼‰__ å…´ä¿®çš„æ°´åˆ©å·¥ç¨‹,æˆ‘å¯¹æ˜¥ç§‹æœ«å¹´å´ç‹å¤«å·®è¶Šç‹å‹¾è·µçš„æ•…äº‹è®°å¿†çŠ¹æ–°,ä½†å¯¹å´å›½çš„é£åœŸäººæƒ…çš„è®¤çŸ¥ä»…é™äºä¸Šå­¦æ—¶å€™è¯»çš„__ã€Šå²è®°ã€‹__å†…å®¹æè¿°,ä»æœªäº²è‡ªæ¥åˆ°è¿™é‡Œ.è™½ç„¶æˆ‘çš„è®¤çŸ¥ååˆ†è‚¤æµ…,ä½†çœ‹åˆ°äº†æ±Ÿå—é£æƒ…çš„åˆ«å…·ä¸€æ ¼è¿˜æ˜¯ä»¤æˆ‘è‚ƒç„¶èµ·æ•¬,ä»åŒ—äº¬åˆ°æ­å·çš„åˆ—è½¦ä¸Š,é€”å¾„å±±ä¸œæ³°å±±,è‹å·çš„å§‘è‹åŸ,ä¸Šæµ·çš„é•¿æ±ŸæµåŸŸ.é•¿æ±Ÿä¸‰è§’æ´²çš„ç¡®ä¸åŒäºæˆ‘çš„å®¶ä¹¡ä¸œåŒ—,è¿™é‡Œç‰©æµè½¦è¾†è¿œé«˜äºåœ¨ä¸œåŒ—çš„ä»»ä½•é«˜é€Ÿ,ä»è¿™ä¸€ç‚¹å°±å¯ä»¥å®¢è§‚çš„å‘ç°æ±Ÿæµ™ä¸€å¸¦ç»æµæ¯”ä¸œåŒ—è¦å‘è¾¾çš„å¤š.è¿™ä¸€è·¯æˆ‘å‡ ä¹ä¸€å¤œæ²¡ç¡,å„åœ°éƒ½åœ¨å¤§å…´åœŸæœ¨æåŸºå»º,ç«è½¦é€”å¾„æ¯ä¸€ä¸ªåŸå¸‚é™„è¿‘å‘¨è¾¹éƒ½å¾ˆæ˜æ˜¾çš„å‘ç°å¡”åŠæ¥¼æˆ¿,æ­£åœ¨æ–½å·¥ä½œä¸š.

æ±Ÿå—çš„é£æ™¯å¦‚ç”»çš„ç¡®å¦‚æ­¤.

__æ­å·ä¹‹æ—…æˆ‘è·¯è¿‡äº†é’±å¡˜æ±Ÿ__

![](/assets/images/20181231FinalSummary/qiantangriver.webp)

è¿™ä¸€å¹•è®©æˆ‘ä¸ç¦çš„æƒ³èµ·åˆä¸€æ—¶å€™æ¸…æ™¨èƒŒè¯µçš„ä¸€é¦–ç™½å±…æ˜“çš„ã€Šé’±å¡˜æ¹–æ˜¥è¡Œã€‹

å½“æˆ‘èº«ä¸´å…¶å¢ƒçš„æ„Ÿå—é’±å¡˜æ±Ÿçš„æ—¶å€™,æˆ‘åªæœ‰ä¸€ä¸ªæ„Ÿæ…¨,æ­¤æƒ…æ­¤æ™¯å¦‚æœæˆ‘æ˜¯ç™½å±…æ˜“æˆ‘ä¹Ÿä¸€æ ·èƒ½åšå‡ºä¸€é¦–è¯—,è¿™ä¸€å¹•ä¹Ÿè®¸åœ¨ä¸œåŒ—å‡ ä¹æ˜¯æ„Ÿå—ä¸åˆ°çš„.å¯¹äºä¸€ä¸ªä¸œåŒ—çš„å­©å­,è®©ä»–æœ‰è¯—äººçš„çµæ„Ÿçš„å‰ææ˜¯ä»–éœ€è¦æœ‰è¿™æ ·çš„ç¯å¢ƒå’Œäººæ–‡å†å².æˆ‘å–œæ¬¢æ¯”è¾ƒæˆ‘çš„å®¶ä¹¡å’Œæˆ‘å»è¿‡çš„æ‰€æœ‰åœ°æ–¹,åœ¨æˆ‘çš„å®¶ä¹¡å†°å¤©é›ªåœ°,å¤å­£æ²¡æœ‰åƒæ±Ÿå—çš„å°æ¡¥æµæ°´äººå®¶,æ²¡æœ‰å¤é“è¥¿é£ç˜¦é©¬,æ›´æ²¡æœ‰å¤•é˜³è¥¿ä¸‹æ–­è‚ äººåœ¨å¤©æ¶¯...æˆ‘çš„å®¶ä¹¡åªæœ‰é»‘åœŸåœ°å’Œæ£®æ—,ä»¥åŠä¸€æœ›æ— é™…çš„å¹³åŸ,å”¯ä¸€ä¸€æ¡æ¾èŠ±æ±Ÿè¿˜åªæ˜¯æˆ‘ä»¬ä»ç”µè§†ä¸Šæ‰èƒ½æ„Ÿå—åˆ°å”¯ä¸€äººæ–‡åœ°ç†.åœ°åŸŸçš„æ–‡åŒ–å·®è·æ˜¯æˆªç„¶ä¸åŒçš„,ä½†æ˜¯æˆ‘ä»¬çš„åˆä¸­ä¾ç„¶è¦å­¦ä¹ ç™½å±…æ˜“çš„ã€Šé’±å¡˜æ¹–æ˜¥è¡Œã€‹è¿™ç§ä»¥æˆ‘çœ‹æ¥å°±æ˜¯ä¸ºäº†åº”ä»˜è€ƒè¯•çš„ä»»åŠ¡æ–‡ç« å·²ç»è„±ç¦»åœ°åŸŸç‰¹è‰²,å˜å¾—æ¯«æ— æ„ä¹‰.æˆ‘å¹¶ä¸æ˜¯åæ¿€,å­¦è¯†æ¸Šåšæ˜¯å¥½çš„,ä½†æ˜¯,éœ€è¦äº†è§£è‡ªå·±çš„ç”Ÿæ´»åœ°åŸŸå’Œæ–‡åŒ–æˆ‘è®¤ä¸ºæ¯”èƒŒè¯µç™½å±…æ˜“çš„ã€Šé’±å¡˜æ¹–æ˜¥è¡Œã€‹æ›´æœ‰æ„ä¹‰.

#### å¿«æ‰‹å®¶ä¹¡

ä»Šå¹´æ™šäº›æ—¶å€™, å¿«æ‰‹å¾æ±‚å…¨å…¬å¸å‘˜å·¥æ„è§,ä¸ºä¸€éƒ¨åˆ†å‘˜å·¥çš„å®¶ä¹¡æ ‘ç«‹å¹¿å‘Šç‰Œ,æˆ‘å¾ˆå¹¸è¿,æˆä¸ºäº†å…¶ä¸­ä¹‹ä¸€

![](/assets/images/20181231FinalSummary/kwaihometown.webp)

æˆ‘ä¹Ÿä»æœªæƒ³è¿‡æœ‰ä¸€å¤©æˆ‘èƒ½ç™»ä¸Šæµ·ä¼¦çš„äº¬éƒ½å¹¿å‘Šç‰Œ,æˆä¸ºå¿«æ‰‹çš„å½¢è±¡ä»£è¨€äººä¹‹ä¸€,è¿™è¦æ˜¯åœ¨ç™¾åº¦ä¼°è®¡å³ä¾¿å‡åˆ°T8ä¹Ÿæœªæ›¾æœ‰å¦‚æ­¤è¿™èˆ¬çš„å¾…é‡å§! çœŸçš„å¾ˆæ„Ÿè°¢å¿«æ‰‹,__è¿™æ˜¯ä¸€å®¶æœ‰äººæ–‡ä¸»ä¹‰ç²¾ç¥å’Œè‰ºæœ¯æ°”è´¨çš„å…¬å¸.__


å·¥ä½œçš„å†…å®¹å¤§æ¦‚å°±ä»‹ç»è¿™ä¹ˆå¤šå§! ç°åœ¨çš„å·¥ä½œå’Œå›¢é˜Ÿè¿˜æ˜¯ä¸é”™çš„.å°±åƒæˆ‘å‰è¾¹è¯´çš„é‚£æ ·,ä¸æ¸…åçš„å­¦å­ä¸ºä¼,ä¸åŒ—é‚®çš„å°ä¼™ä¼´è‚©å¹¶è‚©.è¿™ä¸€åˆ‡ä¸æ˜¯æ¯ä¸ªäººéƒ½èƒ½åœ¨å·¥ä½œä¸­é‡åˆ°çš„.

## æ¼”å”±ä¼š

ä»Šå¹´å¤å¤©,ä¼ä½°åœ¨åŒ—äº¬äº”æ£µæ¾ä½“è‚²é¦† å‡¯è¿ªæ‹‰å…‹ä¸­å¿ƒå¼€ä¸ªäººæ¼”å”±ä¼š,è¿™ä¹ˆå¤šå¹´æˆ‘ä»æœªå‚åŠ è¿‡ä»»ä½•ä¸€ä¸ªæ˜æ˜ŸçœŸæ­£æ„ä¹‰ä¸Šçš„æ¼”å”±ä¼š.2013å¹´çš„æ—¶å€™åˆ˜å¾·ååœ¨åŒ—äº¬å¼€ä¸ªäººæ¼”å”±ä¼š,ç”±äºå½“æ—¶æ²¡æœ‰èˆå¾—èŠ±é’±ä¹°ç¥¨,æ‰€ä»¥è‡³ä»Šéƒ½è§‰å¾—é—æ†¾,å½“æ—¶åˆ˜å¾·åçš„é—¨ç¥¨ ï¿¥980ä¸€å¼ . å¦‚ä»Šä¼ä½°çš„æ¼”å”±ä¼šé—¨ç¥¨ï¿¥680ä¸€å¼ ,æˆ‘ä¹°äº†ä¸¤å¼ ,è¿™ä¸€æ¬¡è¯´ä»€ä¹ˆä¹Ÿè¦å»çœ‹ä¸€çœ‹,ä»¥å‰å› ä¸ºå·¥ä½œæ²¡å¤šä¹…,èŠ±é’±çš„ç¡®ä¸æ•¢å¤§æ‰‹å¤§è„š.

é¦–å¸­çœ‹å°

![](/assets/images/20181231FinalSummary/chinablue2.webp)

![](/assets/images/20181231FinalSummary/chinablue3.webp)


æˆ‘è®°å¾—ç¬¬ä¸€æ¬¡å¬ä¼ä½°çš„æ­Œçš„æ—¶å€™æ˜¯2000å¹´å·¦å³,é‚£æ—¶å€™æˆ‘å¯„äººç¯±ä¸‹åœ¨æˆ‘èˆ…å®¶ä¸œèƒœæ‘,å»åŒèƒœå»ä¸Šåˆä¸­åˆä¸€,æœ‰ä¸€æ¬¡å»ä¸€ä¸ªå«é•‡ä¸œçš„åœ°æ–¹å…¨ç­åŒå­¦éƒ½å»å¬æ–‡è‰ºæ¼”å‡º,æˆ‘ååœ¨æ‹–æ‹‰æœºçš„åè½¦æ–—ä¸Š,å”±ç€ä¼ä½°çš„ã€Šç™½é¸½ã€‹é‚£æ—¶å€™è¿˜ä¸çŸ¥é“MP3æ˜¯ä»€ä¹ˆä¸œè¥¿,èƒ½å¬ä¸Šè¿™é¦–å½•ç”¨ç£å¸¦å·²ç»å¾ˆæ»¡è¶³äº†

![](/assets/images/20181231FinalSummary/opentheshow.gif)


åœ¨ä¼ä½°çš„æ¼”å”±ä¼šä¸Šå¼€åœºçš„ç¬¬äºŒé¦–æƒ³èµ·çš„å°±æ˜¯è¿™é¦–ã€Šç™½é¸½ã€‹,å”±å‡ºæˆ‘çš„åˆä¸­å›å¿†,é‚£ä¸ªæ—¶å€™å¾ˆç©·,åæ¥æ‰çŸ¥é“è¿˜æœ‰ä¸€é¦–æˆåæ›²å«ã€ŠæŒªå¨çš„æ£®æ—ã€‹.

![](/assets/images/20181231FinalSummary/chinablue1.gif)

å½“å…¨åœºä¸€èµ·æ¼”å”±æŒªå¨çš„æ£®æ—çš„æ—¶å€™ é‚£ç§åœºåˆçš„æ•ˆæœ,ç»å¯¹æ¯”KTVå¥½å¤šäº†.çœŸçš„æ˜¯å‰æ‰€æœªæœ‰,è€å®è¯´ ç°åœºçš„å£°éŸ³ç®—æ˜¯åŸå£°äº†,è¿™åœºæ¼”å”±ä¼šçœŸçš„å€¼å¾—.

ä¼ä½°è¯´:"ä»–çš„æ­Œæ›²99%éƒ½æ˜¯è‡ªå·±çš„åŸåˆ›" ä¸è¿‡ä»”ç»†å¬è¿‡ä»–çš„æ­Œæ›² çœŸçš„å¾ˆå¤šç»å…¸  
è¿™ä¸­é—´ä¼ä½°å”±äº†ä¸€é¦–æˆ‘ç¬¬ä¸€æ„Ÿè§‰æˆ‘æ²¡å¬è¿‡çš„æ­Œæ›²,ä½†æ˜¯å¾ˆå¥½å¬,åæ¥æ‰å¾—çŸ¥å«__ã€Šè¢«åŠ¨ã€‹__,æ¨èç»™ä½ ä»¬å¬å¬.

## è¯»ä¹¦

è¿™ä¸€å¹´ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´æˆ‘çš„çœ¼ç›å¾ˆç–¼,æ¯å¤©è‡³å°‘14å°æ—¶å¯¹ç€æ˜¾ç¤ºå™¨,æ‰€ä»¥æˆ‘åˆ—ä¸¾äº†ä¸€äº›ä»Šå¹´è¿çœ‹å¸¦å¬çš„ä¹¦ç±.

ã€Šæ™šæ¸…çš„æœ€ååå…«å¹´4ã€‹  
![](/assets/images/20181231FinalSummary/wanqing.webp)

ã€Šæ›¾å›½è—©ã€‹   
![](/assets/images/20181231FinalSummary/zengguofan.webp)  

ã€Šæ™šæ¸…é‡è‡£æé¸¿ç« ã€‹    
![](/assets/images/20181231FinalSummary/lepetit.webp)


ã€Šæ¯›æ³½ä¸œä¼ ã€‹  
![](/assets/images/20181231FinalSummary/maozedong.webp)

ã€Šå‘¨æ€»ç†çš„æœ€å600å¤©ã€‹  
![](/assets/images/20181231FinalSummary/zhouzongli.webp)
 
ã€Šæ™®äº¬ä¼ è®°ã€‹  
![](/assets/images/20181231FinalSummary/pujing.webp)

ã€Šä¹ è¿‘å¹³çš„ä¸ƒå¹´çŸ¥é’å²æœˆã€‹  
![](/assets/images/20181231FinalSummary/xijinping.webp)

ã€Šä¹”å¸ƒæ–¯ä¼ ã€‹  
![](/assets/images/20181231FinalSummary/jobs.webp)

ã€Šè´§å¸æˆ˜äº‰1~5éƒ¨ã€‹   
![](/assets/images/20181231FinalSummary/currencyWars.webp)

ã€Šæ‹¿ç ´ä»‘ä¼ ã€‹  
![](/assets/images/20181231FinalSummary/Napol%C3%A9onBonaparte.webp)

ã€Šæå˜‰è¯šä¼ ã€‹  
![](/assets/images/20181231FinalSummary/superlee.webp)


#### æ™šæ¸…çš„æœ€ååå…«å¹´ ç¬¬4éƒ¨

å»å¹´æˆ‘è¯»å®Œäº†1~3éƒ¨,å¯æ˜¯é‚£æ—¶å€™è¿˜æ²¡æœ‰å®Œæ•´ç‰ˆçš„ç¬¬4éƒ¨,è¿™æœ¬ä¹¦ä¿æ•æ´ªéƒ½äº²è‡ªæ¨è,æœ€åä¸€éƒ¨ç»å¯¹æ®¿å ‚ç­å²è¯—çº§æ²¡æœ‰ä¹‹ä¸€,è¯»å®Œæœ€åä¸€éƒ¨æ‰äº†è§£,åŸæ¥åº·æœ‰ä¸ºæ˜¯ä¸ªå–œæ¬¢åŠäº‹æ€»æ‰“è„¸çš„äºº,æ ¹æœ¬åšä¸åˆ°ä¸¥äºåˆ©å·±.åŸæ¥å­™ä¸­å±±å…¶å®å¹¶æ²¡æœ‰æ•™ç§‘ä¹¦ä¸Šé‚£æ ·æœ‰å¤šå¥½,åè€Œæˆ‘è§‰å¾—è¾›äº¥é©å‘½å¾—å½’åŠŸäºè¢ä¸–å‡¯,å› ä¸ºæ™šæ¸…æ˜¯ä¸­å›½å†å²ä¸Šåƒè¥¿æ–¹æ–‡æ˜è¿›å†›æœ€æ¢å®å¾—æ—¶ä»£,è¢ä¸–å‡¯ä¸»å¼ å›ä¸»ç«‹å®ªä¿å…¨çš‡æ—è„¸é¢,è€Œé»æ´ªå…ƒè¿™äº›åæ¥è€…ä¸ºäº†æ©ç›–é€ åçš„äº‹å®ä¸»å¼ å…±å’Œ,è‘¬é€å¤§æ¸…ç‹æœæœ€å¿«çš„ä¸€ä¸ªäººæ˜¯è½½æ²£(åŒ—äº¬æ­äº²ç‹åºœå°±æ˜¯è¿™ä¸ªäººçš„,æœ€åæç»™äº†ä¸­å›½äººæ°‘æ”¿åºœ)ï¼Œå°±æ˜¯ä»–æ›¾ç»å»å¾·å›½,å¾·å›½æ²™çš‡è®©ä»–ä¸‹è·ªä»–ä¿æŒäº†ä¸­åæ°‘æ—çš„å°Šä¸¥æ²¡æœ‰ä¸‹è·ª,å¾—åˆ°äº†å¾·å›½çš‡å¸å¾—å°Šé‡,å¯¹è¿™ä¸ªäººè¿˜æ˜¯ä¸­å›½æœ€åä¸€ä¸ªçš‡å¸æº¥ä»ªå¾—çˆ¶äº².æ€»ä¹‹è¿™äº› ç»†èŠ‚éƒ½ä¼šåœ¨è¿™æœ¬ä¹¦ä¸Šè¯´åˆ°.

ä»ç¬¬ä¸€éƒ¨ä»‹ç»åŒ—æ´‹èˆ°é˜Ÿåˆ°ä»‹ç»å„ç§å·¡æ´‹èˆ° é©±é€èˆ° æŠ¤å«èˆ° é±¼é›·è‰‡... è¿™4éƒ¨ä¹¦ç®€ç›´å®Œæ•´çš„è®°å½•äº†ä¸­å›½æ¸…æœæœ«æœŸä»ä¸­æ—¥ç”²åˆæˆ˜äº‰åˆ°è¾›äº¥é©å‘½å…¨ç¨‹è®°å½•.å€¼å¾—ä¸€çœ‹,å¼ºçƒˆæ¨è

å¦‚æœéè¦æˆ‘å†™å‡ºæ¨èçš„ç†ç”±,é‚£æˆ‘åªèƒ½æ‹¿ä¸€å¼ ç…§ç‰‡è¯´æ˜ä¸€ä¸‹:

![](/assets/images/20181231FinalSummary/Krupp.webp)

è¿™æ˜¯æˆ‘ä»Šå¹´10æœˆä»½å»å¤©æ´¥å¸‚æ´¥å—åŒºå°é•‡ç«™ å°ç«™ç»ƒå…µå›­(è¢ä¸–å‡¯æ›¾ç»ç»ƒå…µçš„åœ°æ–¹)æ‹æ‘„çš„å¾·å›½å…‹è™ä¼¯å…¬å¸1860å·¦å³ç”Ÿäº§çš„é‡ç‚®.

åŒ—æ´‹æ—¶æœŸçš„å†›èˆ°å·¡æ´‹èˆ°å¤§éƒ¨åˆ†æ¥è‡ªå¾·å›½å…‹è™ä¼¯å…¬å¸,ä»è¿™é—¨ç‚®çš„åˆ¶é€ å·¥è‰ºæ¥æ¨æµ‹å½“æ—¶çš„å·¥ä¸šåˆ¶é€ ç¨‹åº¦å’ŒåŒ—æ´‹æµ·å†›çš„å†›äº‹è£…å¤‡åŸºæœ¬ç®—æ˜¯ä¸­å›½è¿‘ä»£å²äºšæ´²ç¬¬ä¸€çš„å¼ºå›½äº†.æˆ‘ä»¬ä¸æ˜¯æ‰“ä¸è¿‡æ—¥æœ¬,æˆ‘ä»¬æ‰“ä¸è¿‡çš„æ˜¯æ¸…æœå†…éƒ¨çš„è…è´¥.

#### æ›¾å›½è—©ä¼ 

å¦‚æœè¦é—®æˆ‘ä¸ºä»€ä¹ˆå¦‚æ­¤è¿™èˆ¬æ¨èæ›¾å›½è—©,æˆ‘åªèƒ½è¯´,è¿™æ˜¯æˆ‘è®¤ä¸ºæ¸…æœå†å²ä¸Šå±ˆæŒ‡å¯æ•°çš„åè‡£,ä½œä¸ºæ¸…æœç»å†è¿‡ä¸‰ä»£çš‡å¸çš„å˜æ›´,ä¸‰æœå¤§è‡£,æªå°½èŒå®ˆå…¢å…¢ä¸šä¸š,å˜‰åº†çš‡å¸è¯´ä½œä¸ºå¤§æ¸…å¸å›½çš„å¤§è‡£å¿…é¡»å¾—å¹²å•¥å•¥è¡Œ,æ›¾å›½è—©ä»0å¼€å§‹å­¦ä¹ å»ºç­‘å­¦,ä»0å¼€å§‹å­¦ä¹ è¥¿æ–¹æ–‡æ˜,ä»0å¼€å§‹å­¦ä¹ ä»»ä½•åˆ«äººèƒ½æ“…é•¿è‡ªå·±ä¸æ“…é•¿çš„ä¸œè¥¿.å„’å£«ä¸­çš„å…¸èŒƒ,æ›¾å­çš„åäºº.ç»ƒä¹ æ–°å†›è¯„å®šå¤ªå¹³å¤©å›½èµ·ä¹‰.éº¾ä¸‹åŸºæœ¬æ‹›çº³å½“æ—¶ç¥èˆŸå„è·¯é¢†åŸŸç¬¬ä¸€çš„äººæ‰,æ¯”å¦‚æˆ‘ä»¬åŒ–å­¦ä¸Šçš„å…ƒç´ å‘¨æœŸè¡¨,å°±æ˜¯å½“æ—¶åœ¨æ›¾å›½è—©å¹•åºœæ•ˆåŠ›çš„ç§‘å­¦å®¶[å¾å¯¿](https://baike.baidu.com/item/%E5%BE%90%E5%AF%BF/3672479?fr=aladdin)æ‰€åš,å¦‚æœä¸æ˜¯è¿™ä¸ªäººæˆ‘ä»¬ä»Šå¤©çœ‹åˆ°åŒ–å­¦å…ƒç´ å°†æ˜¯è‹±æ–‡ç¬¦å·,ä¸ä¼šå…¨éƒ¨éƒ½å¸¦é‡‘å­—æ—.ä½œä¸ºè€å¸ˆ,ä»–æ•™å‡ºä¸­å›½è¿‘ä»£æ–‡æ˜å­¦è´¯ä¸­è¥¿çš„ä¼Ÿå¤§é—¨ç”Ÿ[æé¸¿ç« ](https://zh.wikipedia.org/wiki/%E6%9D%8E%E9%B4%BB%E7%AB%A0),åŠŸå‹‹å“è‘—.å¯æ˜¯åæ¥çš„äººä»¬å› ä¸ºæ›¾å›½è—©æ²¡æœ‰å¤„ç†å¥½[å¤©æ´¥æ•™æ¡ˆäº‹ä»¶](https://zh.wikipedia.org/wiki/%E5%A4%A9%E6%B4%A5%E6%95%99%E6%A1%88)è€Œå€å—äº‰è®®,æˆ‘è®¤ä¸ºä¸æ˜¯å¤„ç†ä¸å¥½,çœŸæ­£çš„åŸå› æ˜¯å› ä¸º__å¼±å›½æ— å¤–äº¤__,æ˜¯æ…ˆç¦§æƒ³è®©æ›¾å›½è—©æ¥æ”¶æ‹¾è¿™ä¸ªçƒ‚æ‘Šå­åˆ»æ„æŠŠè¿™äº‹è®©æ›¾å›½è—©å½“æ›¿ç½ªç¾Š.æ¢ä½œä»Šå¤©å°±æ˜¯,æœ‰æ—¶å€™äººéåœ£è´¤å­°èƒ½æ— è¿‡,å¾—å€å—äº‰è®®çš„æ´»ç€,è¿™æ˜¾ç„¶ä¸æ˜¯æ›¾å›½è—©çš„æœ¬æ„,ä»¥æ›¾å›½è—©å¤§äººçš„åŸåˆ™å’Œç«‹åœºç»ä¸æ˜¯å› ä¸ºè¿™äº‹è¢«åˆ«äººæŠ›çŸ³å­è€Œä¸å»ä¸ºä¹‹,ç›¸åæ›¾å¤§äººæ•¢äºç›´é¢æƒ¨æ·¡çš„äººç”Ÿ,æ•¢äºæ­£è§†æ·‹æ¼“çš„çŒ®è¡€.å¦‚æœé‚£æ—¶å€™æ˜¯ç°åœ¨ä¹ å¤§å¤§çš„ä¸­å›½,æ›¾å¤§äººä¹Ÿä¼šåƒå¤–äº¤å®˜ç‹æ¯…ä¸€æ ·æ•¢äºè·Ÿä¸–ç•Œä»»ä½•ä¸€ä¸ªå›½å®¶å¹³èµ·å¹³å. è¿™æ˜¯æˆ‘é’¦ä½©è¿™ä½ä¼Ÿäººä¸ä¸ºäººçŸ¥çš„ä¸€é¢.

æ‰€ä»¥ä¸ºäº†è¡¨è¾¾æˆ‘å¯¹æ›¾å¤§äººçš„å°Šé‡æˆ‘é€æ›¾å¤§äººä¸€å‰¯å¯¹è”:

![](/assets/images/20181231FinalSummary/zengguofan1.webp)

__æ±‚å¿ è‡£å¿…äºå­å­ä¹‹é—¨__  
__å‡¡ç§€æ‰å½“ä»¥å¤©ä¸‹ä¸ºä»»__

#### æ™šæ¸…é‡è‡£æé¸¿ç« 

![](/assets/images/20181231FinalSummary/lepetit1.webp)

è¿™ä½æ…ˆç¥¥çš„è€äºº,æ”¹å˜äº†ä¸­å›½è¿‘ä»£å²,è¢«è¥¿æ–¹äººèª‰ä¸º"ä¸œæ–¹çš„è„¾æ–¯éº¦",ä¸­å›½ç¬¬ä¸€ä½ç™»ä¸Šç¾å›½æ—¶ä»£å‘¨åˆŠå°é¢äººç‰©,ä¸­å›½å†å²ä¸Šç¬¬ä¸€ä½æ¬§æ´²è€ƒå¯Ÿçš„äºº,ç¬¬ä¸€ä½... æ€»è®¡åˆ›é€  äº† 47ä¸ª ä¸­å›½ç¬¬ä¸€.

![](/assets/images/20181231FinalSummary/lepetit2.webp)
> è®¿é—®é¦™æ¸¯çš„æé¸¿ç« ä¸é¦™æ¸¯æ€»ç£åœåŠ›ä¼šé¢ï¼Œç«™ä¸æé¸¿ç« å³ä¾§è€…ä¸ºåˆ˜å­¦è¯¢ï¼Œ1900å¹´7æœˆã€‚

![](/assets/images/20181231FinalSummary/ChineseMinisterLi%20HongzhangAndPrinceBismarck.webp)

\- ä¸ºäº†è¡¨ç¤ºå¯¹æé¸¿ç« çš„å°Šé‡å’Œæ•¬æ„ï¼Œä¿¾æ–¯éº¦çš„ç€è£…æä¸ºåº„é‡ï¼Œç©¿ä¸Šäº†ä»–æå°‘ç©¿çš„ç››è£…â€”â€”å¾·çš‡æ‰€èµç‰å†•ã€çº¢é¹°å¤§åå­—å®æ˜Ÿï¼Œæ‰‹æ‹¿å¤§ç‰ï¼Œè…°æŒ‚å®å‰‘ã€‚ä¸¤äººè§é¢åï¼Œé¦–å…ˆäº’ç›¸é—®å€™å¯¹æ–¹èº«ä½“å¦‚ä½•ï¼Œäº¤æµäº†å„è‡ªçš„èº«å¿ƒå¥åº·é—®é¢˜ã€‚

è„¾æ–¯éº¦è¢«èª‰ä¸º å¾·å›½çš„é“è¡€å®°ç›¸,ç®€ç›´è·Ÿæé¸¿ç« ä¸€æ¨¡ä¸€æ ·ç»å†ä¸‰æœå¾·çš‡,æ¬§æ´²åŠ¨è¡,è‹¦æˆ˜å¤šå¹´ç»ˆäºæ¢æ¥äº†å¾·å›½çš„ç»Ÿä¸€.

![](/assets/images/20181231FinalSummary/Bismarck%2COttoF%C3%BCrst_von_und%20LiHungChang.webp)
> æé¸¿ç« ä¸ä¿¾æ–¯éº¦åœ¨é¦–ç›¸åºœé˜³å°

æˆ‘ç”¨äº†è¿™ä¹ˆå¤šç¯‡å¹…æ¥ä»‹ç»è¿™ä½æ™šæ¸…åè‡£,æˆ‘ä¸ºä»€ä¹ˆè¿™ä¹ˆå´‡æ‹œè¿™ä¸ªäºº?

å¯¹,ä½ é—®åˆ°äº†é‡ç‚¹,æˆ‘å‘Šè¯‰ä½ ç­”æ¡ˆ.

åœ¨æˆ‘ä»¬çš„å·¥ä½œç”Ÿæ´»ä¸­,æˆ‘ä»¬æ‰€ä»äº‹çš„åŠ³åŠ¨åŸºæœ¬éƒ½æ˜¯è¥¿æ–¹æ–‡æ˜çš„äº§ç‰©å§,è®¡ç®—æœº,ç‰©ç†åŒ–å­¦,å„ç§é«˜ç§‘æŠ€,ç”µè·¯,å“ªç§æˆ‘ä»¬ä»å‡ åƒå¹´çš„ä¸­å›½çš„æ–‡åŒ–æ´—ç¤¼ä¸­èƒ½æ‰¾åˆ°.æˆ‘ä»¬é¥±è¯»äº†ä¸­å›½çš„å››ä¹¦äº”ç»,å¯æ˜¯æˆ‘ä»¬åé—®è¿‡è‡ªå·±å—ï¼Ÿè¯»äº†è¿™ä¹ˆå¤šå¹´ä¹¦,æ²¡æœ‰ä»æœ¬è´¨æˆ–è€…è¯´ä»å®é™…çš„å®è·µä¸­æ”¹å˜æˆ–è€…æè¿‡ç”Ÿäº§åŠ›,ç”µè„‘,æ™ºèƒ½æ‰‹æœºéƒ½æ˜¯è¥¿æ–¹å‘æ˜çš„,æˆ‘ä»¬çš„æ—¶ä»£å·²ç»è¿›å…¥äº†å…¨ç›˜è¥¿åŒ–çš„æ•™è‚²æ¨¡å¼äº†

æˆ‘ä»¬å­¦ä¹ çš„è‹±æ–‡ è¿™ä¸œè¥¿æˆ‘ä»¬çš„å¤å…¸æ–‡å­¦ä¸­æ ¹æœ¬æ‰¾ä¸åˆ°ä¸€ä¸ªå­—æ¯æ˜¯èƒ½è·Ÿè‹±è¯­æ‰¯ä¸Šå…³ç³»çš„,æˆ‘ä»¬ä»Šå¤©ç”¨çš„æ±‰è¯­æ‹¼éŸ³æ˜¯å»ºå›½åå’Œæ°‘å›½æ—¶æœŸçš„äº§ç‰©.

åœ¨æˆ‘è‡ªå·±çš„å·¥ä½œä¸­ç»å¸¸ä¼šç»å†æˆ–è€…é­é‡ä¸€äº›å›°éš¾éš¾ä»¥åœ¨æ–­æ—¶é—´å†…å…‹æœæˆ–è€…è§£å†³,è¿™ä¸ªæ—¶å€™æˆ‘å°±åœ¨åé—®è‡ªå·±,æˆ‘æ€ä¹ˆè¯»äº†è¿™ä¹ˆå¤šå¹´ä¹¦è¿ä¸€ä¸ªæœ€ç®€å•çš„è®¡ç®—æœºç†è®ºé—®é¢˜éƒ½è§£å†³ä¸äº†,å›å¤´æƒ³æƒ³è®¡ç®—æœºä»å‘æ˜çš„é‚£ä¸€åˆ»èµ·åˆ°ç°åœ¨æ‰å‡ åå¹´,æˆ‘ä»¬ä»å°å°±æ²¡æœ‰ç»å†è¿‡è®¡ç®—çš„ç©æ³•,åŸç†å’Œåˆ¶é€ ,ä»æŸç§æ„ä¹‰ä¸Šæ¥è¯´æˆ‘ä»¬ç®—ä¸ç®—æ˜¯è½åä¸è¥¿æ–¹æ–‡æ˜,è®¡ç®—æœºä¸æ˜¯ä¸­å›½äººå‘æ˜çš„,æˆ‘ä»¬å…ˆè¦äº†è§£è‹±è¯­,äº†è§£å’Œè®¡ç®—æ‰“äº¤é“çš„ç”µè„‘è¯­è¨€,äº†è§£å¦‚ä½•ç¼–å†™è¿™ç§è¯­è¨€è·Ÿè®¡ç®—æœºäº¤æµ,æ¯å½“è¿™ä¸ªæ—¶å€™æˆ‘å†…å¿ƒæ˜¯è„†å¼±çš„,æˆ‘çš„è„†å¼±æ¥è‡ªäºæˆ‘ä¸å¤Ÿæ·±å…¥äº†è§£è®¡ç®—æœºå†…éƒ¨,ä»æˆ‘å°çš„æ—¶å€™è¯»çš„ä¹¦éƒ½æ˜¯åƒå­—æ–‡,è·Ÿè¿™ä¸ªä¸œè¥¿æ‰¯ä¸ä¸Šå…³ç³»,æˆ‘åº”è¯¥æ‰¾ä¸€ä¸ªäººä½œä¸ºæˆ‘å‰è¿›çš„æ¦œæ ·,è¿™ä¸ªäººæ˜¯è°å‘¢,æ˜¯è°åœ¨ä¸­å›½å†å²ä¸Šç¬¬ä¸€ä½æ•¢äºå­¦ä¹ è¥¿æ–¹æ–‡æ˜,å­¦è´¯ä¸­è¥¿,å­¦ä¹ è¥¿æ–¹çš„å…ˆè¿›æ–‡åŒ–,æŠ€æœ¯...åˆ¶é€ è‡ªå·±çš„å›½å®¶çš„è®¡ç®—æœº.æˆ‘è§‰å¾—è¿™ä¸ªäººéæé¸¿ç« è«å±,ä»–è™½ç„¶æ²¡æœ‰é€ è®¡ç®—æœº,ä½†æ˜¯ä»–æ¯å¤©çš„å·¥ä½œéƒ½æ˜¯é¢å¯¹ç€è‡ªå·±æå¤§æŒ‘æˆ˜çš„ä»»åŠ¡,ä»–æ¯å¤©è¦å¤„ç†æ´‹äººçš„äº‹ç‰©,ä»å¾·å›½å…‹è™ä¼¯å…¬å¸è´­ä¹°å†›èˆ°åˆ›é€ åŒ—æ´‹èˆ°é˜Ÿ,åˆ›åŠæ±Ÿå—åˆ¶é€ æ€»å±€åˆ¶é€ æªæ¢°å…µå™¨.ç”¨ä»Šå¤©çš„è¯è¯´,ä½ é¦–å…ˆå¾—æœ‰è½¦åºŠ,å¾—æœ‰å†¶ç‚¼é‡‘å±çš„æŠ€è‰º,å¾—æœ‰æŠ€æœ¯,è¿™ä½æå¤§äººå¯è°“æ˜¯ä¸­å›½ç¬¬ä¸€ä¸ªæ•¢äºè§£æ”¾æ€æƒ³è§‚å¿µæ¥å—è¥¿æ–¹æ–‡åŒ–å’Œæ•™è‚².å­¦ä¹ è¥¿æ–¹å…ˆè¿›æ–‡æ˜æŠ€æœ¯æ¥æ”¹é€ æ¸…æœçš„èƒ½è‡£äº†.

åœ¨è¥¿å­¦ä¸œè¿›çš„æµªæ½®ä¸­,æ•¢äºåƒè¥¿æ–¹å­¦ä¹ å¾—äºº,éæé¸¿ç« è«å±,æˆ‘å¿ƒä¸­ä½©æœè¿™æ ·çš„äºº,æˆ‘ä»Šå¤©å·¥ä½œä¸­é‡åˆ°çš„å›°éš¾éƒ½æ˜¯æ¥è‡ªäºè¥¿æ–¹çš„æ–‡æ˜æŠ€æœ¯.æœ‰æ—¶å€™æˆ‘ä»¬å¯¹äºä¸€äº›å›°éš¾æ„Ÿåˆ°ææƒ§,å…¶å®ææƒ§æºäºæœªçŸ¥,ä½ ä¸çŸ¥é“è¿™ä¹ˆæ“ä½œä¼šæ„å‘³ç€ä»€ä¹ˆæ„Ÿåˆ°å¿ƒç†æ²¡åº•,ä¸»è¦çš„åŸå› æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨é©¾é©­è¿™ä¸€åˆ‡.åŠªåŠ›å¼„æ‡‚æ·±å…¥ç ”ç©¶å®è·µå¾—åˆ°ç»“è®ºæ‰æ˜¯å”¯ä¸€çš„è§£å†³æ–¹å¼.

##### ç”¨å®åŠ›å»èµ¢å¾—åˆ«äººçš„å°Šé‡

æ™šæ¸…é‡è‡£æé¸¿ç« ä¸ºäº†ç»ƒå†›(æ·®å†›)å»é•‡å‹å¤ªå¹³å¤©å›½å†œæ°‘èµ·ä¹‰,è‡ªå·±å›å®‰å¾½åœ¨æ²¡æœ‰ç»è´¹å’ŒèŒæƒå¾—å‰æä¸‹,æ“ç»ƒäº†ä¸€åªæ–°å†›,æ¯æ¬¡é•‡å‹å¤ªå¹³å¤©å›½èµ·ä¹‰æ€»æ˜¯è´¥å¤šèƒœå°‘,æœ€åè¿«äºæ— å¥ˆè§£æ•£äº†é˜Ÿä¼,è‡ªå·±å»æŠ•å¥”äº†æ©å¸ˆ æ›¾å›½è—©,é‚£æ—¶å€™æ›¾å›½è—©ä¹Ÿæ˜¯ç»ƒä¹ äº†è‡ªå·±çš„ä¸€åªæ–°å†›-æ¹˜å†›,æ›¾å¤§äººä¹Ÿè·Ÿæé¸¿ç« ä¸€æ ·æ²¡æœ‰ç»è´¹,ä½†æ˜¯å„è·¯å¤§è‡£å›ä¹¡æ“ç»ƒæ–°å†›ä¸­,å‡ ä¹éƒ½åƒæé¸¿ç« ä¸€æ ·å¤±è´¥,åªæœ‰æ›¾å›½è—©çš„æ¹˜å†›ä¸å¤ªä¸€æ ·,å½“æé¸¿ç« è½é­„æŠ•å¥”æ©å¸ˆçš„æ—¶å€™,æ›¾å›½è—©å†…å¿ƒæ— æ¯”é«˜å…´,å› ä¸ºåœ¨æŸç§é‡è¦çš„å†³ç­–ä¸Šä»–çš„é—¨ç”Ÿæé¸¿ç« åŸèƒœäºè‡ªå·±,æé¸¿ç« æŠ•å¥”é—¨æˆ¿å†›è¥å»è§æ©å¸ˆ,æ›¾å›½è—©æ•…æ„å½“ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿ,ç®€å•å©å’é—¨æˆ¿è¯´æˆ‘å¤ªå¿™è®© å°‘èƒ(æé¸¿ç«  å­—å°‘èƒ)å»ä¸´è¥å¯’èˆæ­‡æ¯,å¾…æˆ‘æœ‰ç©ºä¾¿å»æ¢æœ›.åœ¨æ›¾å›½è—©çš„å¹•åºœ æ¥çº³æ¸…æœå¤§è‡£å¿…é¡» é¸£ç¤¼ç‚® å¤šå°‘å“,è¿æ¥ä»ªå¼å¿…é¡»éš†é‡,æé¸¿ç« å½“æ—¶è¿˜ç®—æ˜¯ä¸€ä¸ªä¸å¤§çš„å®˜å‘˜,æŒ‰ç…§æœå»·ç¤¼èŠ‚å¾— é¸£ç¤¼ç‚®éš†é‡æ¥å¾…çš„,åœ¨æ›¾å›½è—©è¿™é‡ŒåŸºæœ¬å°±è·Ÿä¸ªå…µå’æ¥äº†ä¸€æ ·æ²¡å•¥ååº”,è¿™æé¸¿ç« å¿ƒç†ååˆ†éš¾å—,ç¬¬äºŒå¤© ä¸€æ—©,å·¦å®—æ£ å¹³å®šè¥¿åŒ—å›ä¹±å›æ¥,æ¥è§æ›¾å›½è—©,æ›¾å›½è—©çš„è¿æ¥ä»ªå¼è¿œæ¯”æƒ³è±¡ä¸­è¦éš†é‡,é¸£ç¤¼ç‚®å¤šå°‘å“ã€‚ã€‚ã€‚è¿æ¥ä»ªå¼éå¸¸éš†é‡,è¿™ä¸€å¹•æé¸¿ç« çœ‹çœ¼åœ¨é‡Œ,è‹¦åœ¨å¿ƒé‡Œ,ä¸€ä¸ªå·¦å®—æ£ è¿æˆ‘ä¸€åŠçš„å®˜èŒéƒ½ä¸åˆ°,æ©å¸ˆå±…ç„¶è¿™ä¹ˆéš†é‡æ¥å¾…,æˆ‘æ¥äº†æ©å¸ˆå½“ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿ,æ©å¸ˆæ˜¯å¸¦æˆ‘ç™»ä¸Šæ–‡å­¦æ®¿å¤§å­¦å£«çš„äºº,æ˜¯æˆ‘ç§‘ä¸¾è€ƒè¯•ä¸­å¯¹æˆ‘ä¸¥åŠ ç®¡æ•™,æ•™æˆæˆ‘ç”Ÿå­˜æœ¬é¢†çš„äºº,ç°åœ¨è¿™èˆ¬åœºæ™¯,æ€è®©æˆ‘ä¸å¿ƒé…¸,å“ çœ‹æ¥__æˆ‘è¿˜å¾—æœ‰è‡ªå·±çš„å†›é˜Ÿ,æ‰“å‡ºå‡ æ¬¡èƒœä»—,å¾—æœ‰å®åŠ›è¿™æ ·æ‰èƒ½å¾—åˆ°æ©å¸ˆå¾—è®¤å¯,æ‰èƒ½å»èµ¢å¾—åˆ«äººçš„å°Šé‡__.æˆ‘ç°åœ¨ä»€ä¹ˆéƒ½æ²¡æœ‰,å·¦å®—æ£ å¸¦é¢†ä¸€ç¾¤å…µå’éƒ½è¿™ä¹ˆåš£å¼ ... æé¸¿ç« å½“æ—¶çš„å¿ƒé…¸æˆ‘çœ‹å®Œäº†è¿™æ®µæ•…äº‹æˆ‘å¾ˆç†è§£,æˆ‘ç›¸ä¿¡çœ‹åˆ°è¿™é‡Œçš„ä½ ä¹Ÿä¸€æ ·æ„ŸåŒèº«å—.

å…¶å®æ›¾å›½è—©çš„è‰¯è‹¦ç”¨å¿ƒæé¸¿ç« å½“æ—¶è¿˜æ²¡å¯Ÿè§‰åˆ°,ä½œä¸ºè‡ªå·±çš„é—¨ç”Ÿæ²¡æœ‰è°æ¯”æ›¾å›½è—©æ›´äº†è§£æé¸¿ç« äº†,æ›¾å›½è—©ä¸ºäº†ç£¨å¹³æé¸¿ç« çš„æ£±è§’è®©ä»–å—å¦‚æ­¤è¿™ä¹ˆå¿ƒé…¸,å°±è®©ä»–å°å°è¿™æ˜¯å•¥æ»‹å‘³,è®©ä»–æ‡‚å¾—__äººå°±å¾—ç”¨å®åŠ›å»èµ¢å¾—åˆ«äººçš„å°Šé‡__.


æ›¾å›½è—©å’Œæé¸¿ç« çš„æ•…äº‹ä¸€å¼€å§‹å¾ˆæŠµè§¦è¥¿æ–¹æ–‡æ˜,åˆ°æœ€åç–²äºåº”å¯¹å†åˆ°ä¸»åŠ¨å‡ºå‡»,å†åˆ°å­¦è´¯ä¸­è¥¿,è¦ä¸æ˜¯æ´‹äººçš„èˆ¹åšç‚®åˆ©é‚£æ€ä¹ˆä¼šæœ‰æé¸¿ç« ,æ€ä¹ˆä¼šè¯ç”Ÿã€ä¸­å›½çš„é“è¡€å®°ç›¸è„¾æ–¯éº¦ã€.æé¸¿ç« åœ¨æ´‹åŠ¡è¿åŠ¨ä¸­å¼€åˆ›äº†å¤šå°‘ä¸ªç¬¬ä¸€,å›å¤´å†çœ‹çœ‹æˆ‘çš„æˆé•¿å²åˆå¼€åˆ›äº†å¤šå°‘ç¬¬ä¸€,ç¬¬ä¸€æ¬¡èƒŒäº•ç¦»ä¹¡,ç¬¬ä¸€æ¬¡åŠ å…¥Baidu,æ¯”è¾ƒæ—©çš„æ¥è§¦iOSå¼€å‘,ç¬¬ä¸€æ¬¡ç”¨åšå®¢è®°å½•çŸ¥è¯†æŠ€è‰º,ç¬¬ä¸€æ¬¡èµ°å‡ºå†œæ‘ç”¨è®¡ç®—æœºæŠ€æœ¯æ”¹å˜å‘½è¿,æˆä¸ºæ‘é‡Œäººçš„å¸Œæœ›,æˆ‘å®Œå…¨å°±æ˜¯å†èµ°æé¸¿ç« çš„è€è·¯,å¸Œæœ›èµ°åœ¨æˆä¸ºåœ£è´¤çš„è·¯ä¸Š,è¿™æ¡è·¯ä¸Šä¸€å®šæ²¡æœ‰ã€å‰æ–¹300ç±³æœ‰é—¯çº¢ç¯æ‹ç…§ã€,æœ‰å‰äººçš„ç»éªŒè®©æˆ‘å¾ˆå¹¸è¿,ä½†å†å¾€åä¼šé‡åˆ°å‰äººéƒ½æ²¡ç»å†è¿‡å¾—ä¸œè¥¿,æˆ‘å°†æˆä¸ºåˆ«äººçš„å‰äºº.

æ•…äº‹è®²å®Œäº†

æˆ‘ä»¬å†æ¥çœ‹çœ‹ä»Šå¤©çš„æˆ‘ä»¬,æˆ‘ä»¬å¿ƒç›®ä¸­æŒ‰ç…§ç‹é˜³æ˜çš„ã€ŠçŸ¥è¡Œåˆä¸€ã€‹å¤§å®¶ä¹Ÿéƒ½ä½©æœæœ‰å®åŠ›çš„äººå§.  
å¦‚æœä½ è§‰å¾—ä¸€ä¸ªå¯ŒäºŒä»£ çˆ¹å¦ˆåœ¨ä¸€çº¿äºŒçº¿åŸå¸‚ç»™ä»–ä¹°å¥—æˆ¿ å¸®ä»–æ‘†å¹³äº†ä»–éœ€è¦çš„ä¸€åˆ‡,è¿™ä¸ªäººè¿˜æ²¡ä¸ªæ­£ç»å·¥ä½œ,æ¯å¤©éƒ½è¿‡ç€å…»å°Šå¤„ä¼˜çš„ç”Ÿæ´»ä½ ä¼šä½©æœä»–å—ï¼Ÿè¿™ä¸å°±æ˜¯æˆ‘ä»¬èº«è¾¹çš„ä¸€äº›äººå˜›? æˆ‘ç›¸ä¿¡ä½ ä¸€å®šä¸ä½©æœä»–,ä½ ä½©æœä»–çš„æ˜¯ä»–æœ‰å¦‚æ­¤æœ‰æ­£äº‹çš„çˆ¶æ¯.

![](/assets/images/20181231FinalSummary/5YearsPlan.webp)

æˆ‘ä»2013å¹´å¼€å§‹åˆ¶å®šè‡ªå·±çš„ç¬¬ä¸€ä¸ªäº”å¹´è®¡åˆ’,ç°åœ¨2018å¹´äº†,æˆ‘æ²¡æœ‰ç»™è‡ªå·±ä¸€ä¸ªæ»¡æ„çš„ç­”å·,çœ‹ç€æˆ‘çš„äº”å¹´è®¡åˆ’ å‹‰å¼ºå®Œæˆ70%çš„ç¨‹åº¦,æˆ‘å¾ˆæƒ­æ„§. æˆ‘æ‰¿è®¤æˆ‘è¯´äº†å¤§è¯,æˆ‘å‘é‚£äº›çœ‹åˆ°æˆ‘åˆ¶å®šäº”å¹´è®¡åˆ’çš„å„ä½,ä»¥åŠæˆ‘çš„é«˜ä¸­è€å¸ˆ,æ·±è¡¨æ­‰æ„. æˆ‘ç¡®å®åœ¨å¯ŒäºŒä»£çš„é¢å‰æŠ¬ä¸èµ·å¤´,æˆ‘çš„çˆ¶äº²æ²¡æœ‰æ­£äº‹,ä¸€åˆ‡éœ€è¦æˆ‘è‡ªå·±ç™½æ‰‹èµ·å®¶.

äºæ˜¯æˆ‘ç»™è‡ªå·±å†™äº†å¥åº§å³é“­: __åŸ‹å¤´è‹¦å¹²åå¹´,ä¸å¯ŒäºŒä»£æŠ¬å¤´ç›¸è§.__ 

#### æ¯›æ³½ä¸œä¼ 

è¿™æ˜¯æˆ‘ä»Šå¹´çš„åœ°å››æœ¬ä¹¦,å¬å®Œæ„Ÿè§‰æ¯›çˆ·çˆ·çš„æ•…äº‹,çœŸçš„ä¸å®¹æ˜“,è¿™ä¸ªäººå¾ˆæœ‰æ°”é­„å’Œè¯—äººæ‰å.åœ¨å†…å¤–äº¤å›°çš„æ–°ä¸­å›½å¦‚æœä»é›¶å¼€å§‹ç€æ‰‹å‡†å¤‡æœªæ¥å‡ åå¹´çš„ä»»åŠ¡æ˜¯ä¸å®¹æ˜“çš„,æ¯›çˆ·çˆ·åšåˆ°.ä»å°ç”Ÿæ´»åœ¨åœ°ä¸»çš„å®¶åº­ä¸­æ²¡æœ‰å› ä¸ºçˆ¶äº²çš„å°å†œæ€æƒ³è€Œå½±å“.

#### å‘¨æ€»ç†çš„æœ€å600å¤©

è¿™ä½å…±å’Œå›½æ€»ç†çš„å£°éŸ³ä½ éƒ½éœ€è¦å¬åˆ°,è¿™ä¹Ÿæ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¬åˆ°å‘¨æ€»ç†çš„åŸå£°å½•éŸ³,åœ¨æœ€åçš„600å¤šå¤©çš„æ—¥å­é‡Œ,è¿™ä½æ€»ç†å¯è°“é èº¬å°½ç˜æ—¥ç†ä¸‡æœº,ä¸æ±Ÿé’å›¢ä¼™æ–—æ™ºæ–—å‹‡,åŠªåŠ›çº æ­£æ–‡é©çš„é”™è¯¯,æŠŠå…±å’Œå›½çš„é‡ä»»ä¸€æ­¥ä¸€æ­¥äº¤ç»™é‚“å°å¹³,æ²¡æœ‰å°å¹³çˆ·çˆ·çš„æ”¹é©å¼€æ”¾,é‚£ä½ ä»Šå¤©ä¹Ÿè®¸å°±ä¸ä¼šçœ‹åˆ°æˆ‘å†™çš„åšå®¢æ–‡ç« æ¥æ€»ç»“æˆ‘çš„2018,å‘¨æ€»ç†çš„å‹¤ä¿­å€¼å¾—æˆ‘å»å­¦ä¹ ,ç”±äºåŒ»ç–—æ¡ä»¶ä¸æ˜¯å¾ˆå®Œå¤‡,å½“æ—¶çš„æ–°ä¸­å›½è¿˜æ²¡æœ‰èƒ½åŠ›åˆ¶é€ ä¸€äº›é«˜çº§è¯å“,å‘¨æ€»ç†çš„è¯éƒ½æ˜¯å›½å¤–è¿›å£,å¯æ˜¯è¿™ä½æ€»ç†èŠ‚ä¿­åˆ°å½“è¯ç‰‡æ‰åœ°ä¸Šå¾ˆçæƒœçš„æ¡èµ·æ¥åƒ,ä»–è¯´,æˆ‘å¤šä¹ˆå¸Œæœ›æˆ‘ä»¬å…±å’Œå›½ä¹Ÿèƒ½åˆ¶é€ è¿™ç§è¯å»å¸®åŠ©é‚£äº›åƒæˆ‘ä¸€æ ·å—ç—…ç—›æŠ˜ç£¨çš„äººæ°‘.åœ¨æœ€åçš„å²æœˆé‡Œä¸ç—…é­”åšå¼ºæŠ—äº‰.

ä¸ºäº†çºªå¿µè¿™ä½ä¼Ÿäºº,æˆ‘è®¤çœŸçš„å¬å®Œè®²è§£å‘¨æ€»ç†çš„æœ€åå²æœˆ,æˆ‘å¾ˆè£å¹¸èƒ½åœ¨ä¸­å›½å›½å®¶åšç‰©é¦†é‡Œæ‰¾åˆ°æ€»ç†çš„å‡ ä»¶ç‰©å“,è®©æˆ‘ç»ä»°ä¸€ä¸‹è¿™ä½å…±å’Œå›½æ€»ç†çš„çˆ±æˆ´äººæ°‘çš„ç²¾ç¥å’Œæ°”è´¨.

![](/assets/images/20181231FinalSummary/hatOfZhouPrimeMinister1.webp)

![](/assets/images/20181231FinalSummary/hatOfZhouPrimeMinister2.webp)

è¿™æ˜¯å‘¨æ€»ç†å‚åŠ æ—¥å†…ç“¦ä¼šè®®çš„ç¤¼å¸½ ä¹Ÿå°±æ˜¯ä¸‹é¢è¿™å¼ æˆ‘ä»¬åœ¨åˆé«˜ä¸­å†å²ä¹¦ä¸Šç»å¸¸çœ‹åˆ°çš„

![](/assets/images/20181231FinalSummary/hatOfZhouPrimeMinister3.webp)

_å›¾ç‰‡å¼•ç”¨è‡ªç™¾åº¦ç™¾ç§‘_

æˆ‘ç›¸ä¿¡ä½ çœ‹åˆ°è¿™ä½å…±å’Œå›½æ€»ç†ä¹Ÿä¼šæƒ…ä¸è‡ªç¦çš„æ½¸ç„¶æ³ªä¸‹,ä»–çš„å£°éŸ³ä½ éœ€è¦å¬åˆ°.

#### æ™®äº¬ä¼ è®°

è¿™ä½å‰å…‹æ ¼å‹ƒç‰¹å·¥,ä¿„ç½—æ–¯çš„ç¡¬æ±‰,å¯¹äºè‹è”é›†ä½“åçš„ç»æµé‡å»º,å¼ºç¡¬é“è…•è§£å†³ä¿„ç½—æ–¯å¯¡å¤´çš„è´¢åŠ¡éœ¸æƒ,è½¦è‡£æˆ˜äº‰çš„ç»ˆç»“è€…,å…‹é‡Œç±³äºšåœ°åŒºçš„å›½é™…ç²¾ç¥,æ•¢äºåœ¨ä¸–ç•Œä¸Šä¸ç¾å›½å¼ºç¡¬å¯¹æŠ—. æ™®äº¬ä¼ è®°ç¡®å®è®°å½•çš„å¾ˆè¯¦ç»†,ä¸è¿‡ å°±æˆ‘ä¸ªäººè§‚ç‚¹ ä¿„ç½—æ–¯ç°åœ¨å›½æ°‘ç»æµæ²¡æœ‰æ”¹å–„å¤šå¥½,ä¾ç„¶æ˜¯ä¸¤æ¶é©¬è½¦å¼çš„å‘å±•. ä¸ºäº†äº†è§£ä¸–ç•Œçš„å†å²å’Œæ¬§æ´²çš„åœ°ç†æˆ‘ä»Šå¹´ å­¦ä¹ å¾ˆå¤šæ¬§æ´²çš„å†…å®¹, è¿™æœ¬ä¹¦å°±æ˜¯åœ¨å­¦ä¹ èŒƒå›´å†….

#### ä¹ è¿‘å¹³çš„ä¸ƒå¹´çŸ¥é’å²æœˆ

åœ¨æˆ‘å°æ—¶å€™çˆ¶æ¯ç»å¸¸è·Ÿæˆ‘è¯´å­¦ä¹ ä¸å¥½å°±æŒ‘å¤§ç²ª,ä½†æ˜¯æˆ‘è¦è¯´çš„æ˜¯è¿™ä½ç°ä»»ä¸­åäººæ°‘å…±å’Œå›½å…±å’Œå›½çš„ä¸»å¸­å°±æ˜¯æ›¾ç»æŒ‘è¿‡ç²ª,åœ¨é™•åŒ—æ¢å®¶æ²³ä¸€æ­¥ä¸€æ­¥ä»çŸ¥é’ä¸‹ä¹¡åˆ°æ‘æ”¯ä¹¦å†åˆ°åŠ å…¥ä¸­å›½å…±äº§å…š,æ¢å¤é«˜è€ƒç»§ç»­ä¸Šæ¸…åå­¦ä¹ ,æœ€ç»ˆæˆä¸ºä¸­åäººæ°‘å…±å’Œå›½çš„å›½å®¶ä¸»å¸­,è¿™ä¸€è·¯èµ°çœŸçš„å¾ˆä¸å¹³å‡¡,è¿™æœ¬ä¹¦è®©æˆ‘è®°å¿†çŠ¹æ–°çš„ä¸€ä¸ªæ•…äº‹å€¼å¾—æˆ‘ä»¬æ¯ä¸ªäººå»å­¦ä¹ .

å½“å¹´ä¹ å¤§å¤§ ä½œä¸ºçŸ¥é’åˆšä¸‹ä¹¡, ç”±äºä¸å¤Ÿäº†è§£å†œæ‘çš„ç™¾å§“çš„ç”Ÿæ´»,åŠ ä¸Šé™•åŒ—ååˆ†è´«å›°,çŸ¥é’ä»¬éœ€è¦è‡ªå·±å­¦ä¼šåšé¥­,è‡ªå·±å­¦ä¼šæ¡æŸ´çƒ§ç«,ç”±äºç¬¬ä¸€æ¬¡æ²¡æœ‰ç»éªŒ,åˆšå»æ¢å®¶æ²³çš„ä¸€æ®µæ—¥å­èµ¶ä¸Šé™•åŒ—ä¸‹é›¨, åšé¥­çš„æŸ´éƒ½è¢«é›¨æ·‹æ¹¿äº†,æ²¡åŠæ³•å¼•ç«,çŸ¥é’ä»¬ä½ ç…ç…æˆ‘æˆ‘ç…ç…ä½ ,äº’ç›¸ä¸çŸ¥æ‰€æª,è¿™ç§æ—¥å­å®åœ¨å¤ªè¿‡è‰°éš¾, ä¹ å¤§å¤§ä¸‹ä¹¡çš„æ—¶å€™æ»¡æ»¡çš„ä¸€åŒ…åˆä¸€åŒ…çš„éƒ½æ˜¯ä¹¦,åœ¨è¿™æ®µæ—¥å­é‡Œç™½å¤©å¹²å†œæ´»æ™šä¸Šåƒå®Œé¥­è¿˜è¦ç»§ç»­å­¦ä¹ ,ç”±äºæ²¡æœ‰ä»€ä¹ˆåƒçš„æ™šä¸Šå­¦åˆ°å¾ˆæ™šçš„æ—¶å€™ä¼šè§‰å¾—é¥¿,å°±ç®€å• é”…é‡Œæ”¾ç‚¹æ°´ æ”¾é‡Œä¸¤ç¢ç‰ç±³,æŸ´è¿™ç§èµ„æºæ˜¯æœ‰é™çš„ æ‰€ä»¥ç…®å®Œçš„ç‰ç±³ ä¹Ÿä¸çŸ¥ç†Ÿæ²¡ç†Ÿå°±åƒäº†,è¿™æ®µè‰°è‹¦çš„ç”Ÿæ´»æˆ‘ç›¸ä¿¡åœ¨çœ‹è¿™ç¯‡æ–‡ç« çš„å¹´è½»äººä¹Ÿè®¸éƒ½ç†è§£ä¸äº†,ä½†æ˜¯è¿‡çš„ç¡®å®æ— æ¯”è‰°éš¾,ç”±äºé™•åŒ—çš„åº•çº¿å¤šå±±å’Œé«˜å¡ ä¸èƒ½ç§¯æ°´åŠ ä¸Šç”°åœ°æ˜¯æœ‰é™çš„,ä¹ å¤§å¤§å¸¦é¢†å…¨æ‘çš„äººæ°‘ä¿®å ¤åè“„æ°´çŒæº‰,ç„¶åå¼€å¦å†œç”°.ä¹ å¤§å¤§æ·±çŸ¥é™•åŒ—ä¸ºä»€ä¹ˆè´«ç©·å› ä¸ºç™¾å§“çš„ç”°åœ°å®åœ¨å¤ªå°‘,åªèƒ½åƒå¤§åœ°è¦ç²®é£Ÿ,å»ºå®Œå ¤åå¼€å±±æ‹“ç”°åœ°,åŠæ²¼æ°”æ± ,å½“å¹´è¿˜æ²¡æœ‰å¥½çš„æœºæ¢°,å…¨éƒ¨éƒ½æ˜¯äººå·¥æŒ‘è¿™ç²ªä¾¿è£…åˆ°æ²¼æ°”å‘.æ²¼æ°”æ± éœ€è¦æŠ€æœ¯,ä¹ å¤§å¤§åˆæ¢è®¿å››å·å­¦ä¹ åŠæ²¼æ°”çš„ç»éªŒ,æ²¼æ°”æ± åˆšæŠ•å…¥ä½¿ç”¨ä¹‹å‰éœ€è¦æŠŠæ²¼æ°”å¼„ä¸ªæ´æ¥æ£€æµ‹æ²¼æ°”æ˜¯å¦èƒ½å¤Ÿè¾¾æ ‡ä½¿ç”¨,ä¹ å¤§å¤§äº²è‡ªå¼€æ´,å½“æ—¶ç”±äºæ± å†…å‹åŠ›å¾ˆå¤§,å–·äº†ä¸€èº«ç²ªæ±¤, çœ‹åˆ°è¿™çš„æ—¶å€™æˆ‘ä¸ä»…æ„Ÿå¹,ä¸­å›½èƒ½æœ‰ä»¥ä¸ºè¿™æ ·çš„ä¸»å¸­å¤ªå¹¸è¿äº†,è¿™ä¸ªäººå¯çœŸæ˜¯æ·±å…¥åŸºå±‚åŠ³åŠ¨,æ•¢äºå¹²æœ€è„æœ€ç´¯çš„æ´»,ä¸€èˆ¬å¹²è¿™ç§æ´»çš„äººä»–è‚¯å®šçŸ¥é“åº•å±‚äººæ°‘çš„ç–¾è‹¦,ä»–ä¹Ÿä¸€å®šçŸ¥é“å¦‚æœå¸¦é¢†ç¥–å›½çš„å¹¿å¤§äººæ°‘è„±è´«è‡´å¯Œ.

å¦‚æœæ”¾åˆ°ç°åœ¨ä½ è®©ä¸€ä¸ªå¹´è½»äººå»å†œæ‘èµ¶ä¸Šä¸‹é›¨å¤©åšé¥­çš„æŸ´éƒ½æ·‹æ¹¿,æ ¹æœ¬ç‚¹ä¸ç€ç«åšé¥­,è¿™ç§è‹¦æ—¥å­çœŸæ²¡å‡ å¹´è½»äººå°è¿‡,æ›´åˆ«è¯´åŠæ²¼æ°”æ± æŒ‘ç²ªäº†.

å³ä¾¿ä½ å¿ƒç›®ä¸­çš„æ”¿åºœæœ‰å¤šä¹ˆè´ªè…,æˆ‘è§‰å¾—ä¹ å¤§å¤§ä¸ä¼š,ä»–å°è¿‡å¤ªå¤šäººæ²¡åƒè¿‡çš„è‹¦,å—åˆ°è¿‡æ–‡é©çˆ¶äº²çš„å½±å“å…¥äº†Næ¬¡å…šæ‰æœ€ç»ˆæˆåŠŸ,è¿™æ®µç»å†ä¸å¯»å¸¸,å¦‚æœä¸äº†è§£è¿™ä½å›½å®¶é¢†å¯¼äººçš„å†å²,é‚£æˆ‘ä»¬ä¹Ÿä¸ä¼šæ‡‚å¾—ç°åœ¨çš„è¾›ç¦æ¥çš„å¤šä¹ˆä¸å®¹æ˜“.ç°åœ¨å…¶å®æ¯”ä¹ å¤§å¤§çš„è¿‡å»å¹¸ç¦å¤šäº†,ä½†æ˜¯ç¤¾ä¼šä¸»ä¹‰åˆçº§é˜¶æ®µå°±è¿™æ ·,å…ˆèƒ½è§£å†³æ¸©é¥±,æ‘†è„±è´«å›°,ç„¶åå†å»ç ”ç©¶å¥”å°åº·å‘å®¶è‡´å¯Œ,æˆ‘å¸Œæœ›ä¹ å¤§å¤§çš„äººç”Ÿç»å†èƒ½è®©æ¯ä¸ªäººéƒ½çŸ¥é“,æ‰€ä»¥è¿™æœ¬ä¹¦å¼ºçƒˆæ¨è.

#### ä¹”å¸ƒæ–¯ä¼ 

ä½œä¸ºä¸€å è‹¹æœå¼€å‘è€… å¦‚æœä¸å»äº†è§£åˆ›é€ è‹¹æœçš„äººå…¶å®æ˜¯ä¸€ç§æ‚²å“€,ä¹”å¸ƒæ–¯çš„ä¸ªäººæ€§æ ¼éå¸¸æç«¯è¿½æ±‚ç»å¯¹æœºåˆ¶,å¦‚æœæ²¡æœ‰è¿™ä¹ˆåˆ»è–„çš„è¿½æ±‚å°±ä¸ä¼šæœ‰ä»Šå¤©çš„iPhone, å½“ç„¶å…‰æœ‰è¿™ç§æ°”è´¨æ˜¯ä¸å¤Ÿçš„,éœ€è¦æœ‰æŠ€æœ¯é©±åŠ¨,æ²ƒå…¹å°¼äºšå…‹å°±æ˜¯å…¶ä¸­ä¹‹ä¸€.æ•°å­¦å¤©æ‰,ç¬¬ä¸€å° Apple I å°±æ˜¯è¿™ä¸ªå¤§ç¥æ‰‹å·¥åšçš„,ç”¨èŠ¯ç‰‡å åŠ ,ç”µè·¯è®¾è®¡.....

ä¹”å¸ƒæ–¯æ˜¯ä¸€ä¸ªæå…· "ç°å®æ‰­æ›²ç«‹åœº"çš„äºº,(æ¥åœ°æ°”ä¸€ç‚¹å°±æ˜¯èƒ½å¿½æ‚ ),ä½œä¸ºå­¤å„¿çš„ä¹”å¸ƒæ–¯æ·±å—å…»çˆ¶çš„å½±å“,ä»–çˆ¶äº²æ˜¯ä¸€ä¸ªæœ¨åŒ ,è¿™ä¸ªäººè¯´:"åšä»€ä¹ˆå…¶å®è·Ÿåšå®¶å…·æ˜¯ä¸€æ ·çš„,è¡£æŸœçš„èƒŒæ¿ä¸å®¹æ˜“è¢«äººæ‰€çœ‹è§,ä½†æ˜¯è¡£æŸœçš„å¤–è¡¨è´¨é‡ä¹Ÿè¦è·Ÿå†…åœ¨çš„èƒŒæ¿ä¸€æ ·çš„å“è´¨",æ‰€ä»¥ä½ ä»Šå¤©æ‹†å¼€è‹¹æœçš„ä»»ä½•è®¾å¤‡çœ‹çœ‹ç”µè·¯æ¿å°±çŸ¥é“,é»‘è‰²PCBå°åˆ·,å†…éƒ¨ç”µè·¯è®¾ç½®å’Œå…ƒå™¨ä»¶éƒ½ååˆ†æ•´é½,çœŸçš„è·Ÿè¡£æŸœçš„èƒŒæ¿ä¸€æ ·è´¨é‡. ä¾‹å¦‚: iPhone 4/4s

è¿™æ˜¯å”¯ä¸€ä¸¤éƒ¨ä¹”å¸ƒæ–¯åœ¨ä¸–æ—¶å‘å¸ƒçš„æœ€åä¸¤æ ·äº§å“,ä½†æ˜¯ç°åœ¨çš„åº“å…‹ä¹Ÿè®¸æ²¡æœ‰100%çš„éµç…§ä¹”å¸ƒæ–¯çš„äººæ ¼å’Œä¹ æƒ¯ä»¥åŠè¿½æ±‚,æ•´çš„ç°åœ¨çš„è‹¹æœæ‰‹æœºå›½äº§çš„è´¨é‡æ€»å‡ºé—®é¢˜.è¿™è¦æ˜¯åœ¨ä¹”å¸ƒæ–¯æ—¶ä»£æˆ‘ç›¸ä¿¡è¿™å³ä¾¿æœ‰ä¹Ÿå¯ä»¥å…¨éƒ¨æ¢æ–°è€Œä¸”å¾ˆå°‘èƒ½å‡ºé—®é¢˜.

ç”±äºæ€§æ ¼çš„æç«¯å’Œè¿½æ±‚çš„æè‡´å¯¼è‡´ è‹¹æœçš„åŒäº‹æŠŠè¢«ä¹”å¸ƒæ–¯ä¼¤å®³çš„åŒäº‹ç§°ä¸º"ä½é€šæ»¤æ³¢å™¨"(æ— è®ºå¦‚ä½•å¤§å£°æˆ–è€…æ¿€çƒˆå¤§å®¶éƒ½å¾ˆä½è°ƒå¹³å’Œçš„å¤„ç†)

ä¹”å¸ƒæ–¯çš„ä¸€ç”Ÿæ˜¯ä¸æ˜¯ä¼ å¥‡æˆ‘ä¸çŸ¥é“,æˆ‘è§‰å¾—è‡³å°‘æˆ‘é€šè¿‡è‹¹æœçš„è¿™å‰¯é”®ç›˜æ•²å‡ºäº†ä¸€æ ‹100w+æ¥¼æˆ¿.

![](/assets/images/20181231FinalSummary/applekeyboard.webp)

æ˜¯çš„ æˆ‘æ˜¯ä¸€ä¸ªApple iOS Developer,è¿™ä½ä¼Ÿäººä¸ä¸ºäººçŸ¥çš„ä¸€é¢çš„å€¼å¾—å­¦ä¹ .

#### è´§å¸æˆ˜äº‰1~5éƒ¨

è¿™å‡ éƒ¨è´§å¸æˆ˜äº‰éå¸¸å¥½,è™½ç„¶ä»¥å°è¯´çš„å½¢å¼å‡ºç°,ä½†æ˜¯ä½œè€…è‡ªè¿°è¯´å¦‚æœä»¥çœŸå®çš„ææ–™å‡ºç°é‚£ä¹ˆé“¶è¡Œå®¶åŸºæœ¬ä¸ä¼šè®©è¿™æœ¬ä¹¦å‡ºç‰ˆ,å¾€å¾€å°è¯´çš„å½¢å¼å¯ä»¥é€ƒé¿å®ƒ.

ä¸€éƒ¨ä¸–ç•Œç»æµçš„å¿…é¡»ç»å…¸, è‹±æ ¼å…°é“¶è¡Œ...ç½—æ–¯æŸ´å°”å¾·å®¶æ—...å¸ƒé›·é¡¿æ£®æ—ä½“ç³»...ä¸–ç•Œç»æµçš„é‡‘æœ¬ä½,é“¶æœ¬ä½è¿˜æœ‰æˆ‘å›½çš„ä»¥ç‰©èµ„ä¸ºæœ¬ä½çš„äººæ°‘å¸,è¿™äº›èƒŒåçš„ä»·å€¼éƒ½åœ¨è¿™æœ¬ä¹¦ä¸­ä¸€ä¸€åˆ—ä¸¾.

#### æ‹¿ç ´ä»‘ä¼ 

è¿™ä½æ´»è·ƒåœ¨æ¬§æ´²åŠä¸ªä¸–çºªçš„æ³•å…°è¥¿ç¼”é€ è€…,å¤§çº¦æ´»è·ƒåœ¨ä¸­å›½çš„æ¸…æœä¸­æ™šæœŸ,å‡ºç”Ÿåœ¨æ³•å›½å—éƒ¨çš„ç§‘è¥¿å˜‰å²›çš„æ‹¿ç ´ä»‘,ä¸€è·¯é©°éª‹æ”¿åºœæ•´ç‰‡è¥¿æ¬§é¢†åœŸ,æ²¡ä¸€æ¬¡çš„æˆ˜äº‰éƒ½ä»¥èƒœåˆ©ä¸ºç»“å°¾,ä½†æ˜¯å› ä¸ºæœ€åçš„ä¸€æ¬¡æ»‘é“å¢æˆ˜å½¹è€Œæ¯äºä¸€ç”Ÿ,å…¶å®æˆ‘ä»¬åº”è¯¥ ä»¥"ä¸ä»¥æˆè´¥è®ºè‹±é›„"çš„æ€åº¦æ¥æ¬£èµè¿™ä½æˆ˜æ–—å‹‡å£«. 

ä¸ºäº†æ›´å¤šçš„äº†è§£æ¬§æ´²,æˆ‘éœ€è¦äº†è§£é‚£é‡Œçš„äººæ–‡å’Œåœ°ç†,æ‰€ä»¥è¿™æœ¬ä¹¦å€¼å¾—ä¸€çœ‹

#### æå˜‰è¯šä¼ 

æœ€åè¦è¯´è¯´è¿™ä½åŠ±å¿—ä¼Ÿäººæå˜‰è¯š,è¿™ä½æè¶…äººç®€ç›´ç§°éœ¸é¦™æ¸¯åˆæ¸©æ–‡å°”é›…,å…¶å®æè¶…äººçš„ç¥–å…ˆæ—¶æ¸…æœæ—¶æœŸçš„æ–‡å®˜æ‹”è´¡å‡ºèº«(å¯ä»¥ç†è§£ä¸ºæœ‰æ–‡åŒ–æœ‰å­¦è¯†çš„ç§€æ‰).è¿™ä½ä¼Ÿäººå¾æœå…¨æ¸¯,æ— è®ºåšäººåšäº‹éƒ½å‹¤å‹¤æ³æ³è¸è¸å®å®,ä»ä¸€å®¶åšå¡‘èƒ¶èŠ±å‚å•†åˆ°æœ€åæ”¶è´­æ¸¯ç¯,è‹±èµ„ä¼ä¸š,æ±‡ä¸°é“¶è¡Œçš„é•¿æœŸåˆä½œä¼™ä¼´,æ€¡å’Œç½®åœ°,å†åˆ°é¦™æ¸¯çš„æˆ¿åœ°äº§...ä»¥åŠæ”¶è´­å¸Œå°”é¡¿é…’åº—....å¤ªå¤šå¤ªé•¿ä¸€è¨€éš¾å°½

è¿™é‡Œè¦è¯´ä¸€ä¸‹è¿™ä¸ªæ€¡å’Œç½®åœ°,å®ƒçš„å‰èº«æ˜¯[æ€¡å’Œæ´‹è¡Œ](https://baike.baidu.com/item/%E6%80%A1%E5%92%8C%E6%B4%8B%E8%A1%8C/5039743?fr=aladdin)(è‹±èµ„ä¼ä¸š)ç”±ä¸¤åè‹æ ¼å…°è£”è‹±å›½äººå¨å»‰Â·æ¸£ç”¸ï¼ˆWilliam Jardineï¼Œ1784å¹´ï½1843å¹´ï¼‰åŠè©¹å§†å£«Â·é©¬åœ°è‡£ï¼ˆJames Mathesonï¼Œä¸€è¯‘â€œå­–åœ°è‡£â€ï¼Œ1796å¹´ï½1878å¹´ï¼‰åœ¨ä¸­å›½å¹¿å·åˆ›åŠ,å°±æ˜¯å½“å¹´æ—åˆ™å¾è™é—¨é”€çƒŸ,æ£æ¯ä¸œå°åº¦å…¬å¸çš„é¸¦ç‰‡,å®é™…ä¸ŠèƒŒåæ˜¯æ€¡å’Œæ´‹è¡Œåœ¨æŒæ§,å› ä¸ºæ—åˆ™å¾ä¾µçŠ¯äº†æ€¡å’Œæ´‹è¡Œçš„åˆ©ç›Šåœ¨ååˆ©ç›Š,è¿™ä½æ¸£ç”¸è€æ¿åœ¨è‹±å›½å¥³çš‡é¢å‰æ¸¸è¯´,æŒ‘èµ·äº†1840å¹´çš„é¸¦ç‰‡æˆ˜äº‰.

![](/assets/images/20181231FinalSummary/yihe.webp)

æ€¡å’Œæ´‹è¡Œæ—§å€ _å›¾ç‰‡å¼•è‡ªç™¾åº¦ç™¾ç§‘_

æå˜‰è¯šçš„ä¸€ç”ŸçœŸçš„ä»æ— åˆ°æœ‰,é‚»è¿‘åå·,ç¨³æ‰ç¨³æ‰“,ä¸€æ­¥ä¸€æ­¥åå¹¶æ”¶è´­.

è®©æˆ‘å°è±¡æ·±åˆ»çš„æ˜¯æ€¡å’Œå¤§ç­ çº½ç¢§åš è·Ÿæå˜‰è¯šçš„åˆä½œ...

ç»å¯¹åŠ±å¿—çš„äººç”Ÿå¥‹æ–—å² å€¼å¾—ä¸€çœ‹

## æŠ€æœ¯

è¿™ä¸€å¹´åœ¨æŠ€æœ¯ä¸ŠæŠ•å…¥å’Œæ”¶ç›Šæ²¡æœ‰æ˜æ˜¾æå‡,ä¸è¿‡æˆ‘ç»™è‡ªå·±çš„å®šä¸‹çš„OKR(Object key resultä¸€ç§å·¥ä½œç›®æ ‡çš„å®ç°æ–¹å¼ç±»ä¼¼KPI)æ˜¯æ¯ä¸ªæœˆä¿è¯äº§å‡ºä¸¤ç¯‡æŠ€æœ¯æ–‡ç« ,è‡³å°‘æœ‰ä¸€ç¯‡è´¨é‡è¾ƒé«˜ç»è¿‡è¿™ä¸€å¹´çš„æŠ€æœ¯å†™ä½œ,è¿˜æ˜¯å¾ˆæœ‰æ”¶è·çš„,æˆ‘ä»æ²¡æƒ³è¿‡èƒ½ç”¨åšå®¢è®°å½•æˆ‘çš„ç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´,å¤§å¤šéƒ½æ˜¯æŠ€æœ¯ç›¸å…³å¾ˆå°‘å†™ä¸ªäººç”Ÿæ´»,é™¤äº†å¹´ç»ˆæ€»ç»“ä»¥å¤–åŸºæœ¬éƒ½æ˜¯iOSç›¸å…³çš„æŠ€æœ¯,ä¸è¿‡æ•´ä½“ä¸Šä¸ªäººæ„Ÿè§‰è¿˜æ˜¯å¾ˆæ°´çš„,2019å¹´éœ€è¦æ¯”ç°åœ¨æ›´æœ‰è´¨é‡å’Œæ·±åº¦.

ä¸ºäº†å¥–åŠ±è‡ªå·±ä¸€å¹´çš„æŠ€æœ¯è¿›æ­¥å’Œå¯¹å†™ä½œçš„åšæŒ,2018å¹´æˆ‘ä¹°äº†æœ‰ä¸€ä¸ªBOSEé™å™ªè€³æœº(ï¿¥1888),ä½œä¸ºç¨‹åºå‘˜åªæœ‰å‡ æ ·ä¸œè¥¿è§†ä¸ºçå®

* 1.æœºæ¢°é”®ç›˜
* 2.é™å™ªè€³æœº

è¿™ä¸€å¹´åšæŒå­¦ä¹ pythonå’Œæœºå™¨å­¦ä¹ ,ä½†æ˜¯æ˜æ˜¾çš„è¿›æ­¥å¹¶ä¸å¤š,åªæ˜¯ç¨ç¨äº†è§£äº†ä¸€äº›æ•°æ®æŒ–æ˜å’ŒåŠ å·¥æ•°æ®.ä¸è¿‡ç›®å‰è´Ÿè´£å¿«æ‰‹çš„ç›´æ’­ä¸šåŠ¡è®©æˆ‘é”»ç‚¼äº†å¾ˆå¤š,æ¯ä¸€æ¬¡å¼€å‘é‡åˆ°çš„é—®é¢˜æˆ‘éƒ½ä¼šè®°ä¸‹æ¥,ä¸šä½™æ—¶é—´å†™demoç„¶åå‘è¡¨æ–‡ç« åˆ°åšå®¢è®°å½•ä¸–ç•Œè®°å½•ä½ .


ä¸è¿‡å¯¹æ¯”å»å¹´çš„KPIæŒ‡æ ‡

å»å¹´çš„KPIå¦‚ä¸‹:

* swift4 è¿›é˜¶çœ‹å®Œ
* iOS Core Animation çœ‹å®Œ
* Learn AV Foundation è¦å†™å‡ ç¯‡åšå®¢ä»ä¸Šæ¬¡æ®µçš„ä½ç½®ç»­ä¸Š
* å­¦ä¼šPythonå’Œæ•°æ®æŒ–æ˜ ä¸ºæœºå™¨å­¦ä¹ åšé“ºå«
* å¤šåª’ä½“ç›¸å…³æŠ€æœ¯æ·±è€•
* è‹±è¯­æ°´å¹³å†æé«˜ä¸€ä¸ªlevel

æ˜¾ç„¶æˆ‘æ²¡æœ‰å®Œæˆ30%,å¾ˆæƒ­æ„§,æ‰€ä»¥æˆ‘æŠŠç›®æ ‡å®ç°çš„æ–¹å¼ä»KPIå˜æˆäº†OKR.è¿™æ ·å¼¹æ€§å®ç°ç›®æ ‡ä»¥ä¾¿èƒ½æ›´å¥½çš„å®ç°2019å¹´çš„ç›®æ ‡.

è¿™ä¸€å¹´æˆ‘å¾ˆè´¥å®¶,ä¹°äº†ä¸€å †ç ´çƒ‚èŠ±äº†ä¸å°‘é’±

__æœºæ¢°é”®ç›˜__

![](/assets/images/20181231FinalSummary/keyboard.webp)

> è¿™æœºæ¢°é”®ç›˜,ç¡®å®å¾ˆå¥½,å‘¨æœ«åœ¨å®¶å†™ä»£ç éå¸¸æµç•…é¡ºæ‰‹.ï¿¥519

__iPhone X 256G ç¾ç‰ˆ__

![](/assets/images/20181231FinalSummary/iPhoneX.webp)
> åŒäº‹å»ç¾å›½å¸®å¿™ä»£è´­çš„,ä½œä¸ºä¸€ä¸ªiOS developer,æˆ‘ä¹Ÿæ˜¯å¿å—äº†4å¹´iPhone6,ç¡®å®å¡çš„ä¸è¡Œäº†,ï¿¥8000

__Apple Watch 3__

![](/assets/images/20181231FinalSummary/AppleWatch3.webp)

> è¿™ä¸ªæˆ‘è®¤ä¸ºåŸºæœ¬æ²¡å•¥ç”¨,å°±èƒ½æˆ´åœ¨æ‰‹ä¸Šçœ‹ä¸ªç‚¹å„¿,å…¶ä½™çš„åŠŸèƒ½éƒ½ç”¨ä¸äº†,ï¿¥3188

__PC__

![](/assets/images/20181231FinalSummary/PC.webp)
> ä¸ºäº†å­¦ä¹ æœºå™¨å­¦ä¹ ä¹°äº†ä¸ª1050Ti,å¾ˆä¹…æ²¡DIYäº†,æ•´å¥—è‡ªå·±çš„ä¹°çš„è£…çš„.16G DDR4 2400å†…å­˜,240G+120Gä¸¤å—ä¸‰æ˜Ÿå›ºæ€ç¡¬ç›˜,i5 8400 CPU, æŠ€å˜‰Z370ä¸»æ¿ æ€»é€ ä»· ï¿¥5547.  
> æˆ‘å·²ç»æŠŠæ—§çš„é‚£ä¸ª200+è´±å–äº†.

__BOSE é™å™ªè€³æœº__

![](/assets/images/20181231FinalSummary/bose.webp)
> åŒ11 æ‰“ç®—ä¹°ä¸ªç¨‹åºå‘˜æ¢¦æƒ³ä¸­çš„è€³æœº ï¿¥1888


__å°ç‰› N1s åŠ¨åŠ›ç‰ˆ__

![](/assets/images/20181231FinalSummary/n1s.webp)
> ä¸Šç­çš„ä»£æ­¥å·¥å…·.ï¿¥7399

ä»Šå¹´è´¥å®¶èŠ±äº† ï¿¥26541. 

ç„¶è€Œè¿™é‡Œé¢æˆ‘è§‰å¾—æœ€å¥½ç”¨çš„ä¸œè¥¿,ä¸€ä¸ªæ˜¯å°ç‰›çš„è¿™ä¸ªç”µåŠ¨è½¦,ä¸€ä¸ªæ˜¯é™å™ªè€³æœº,è‡³äºæ‰‹æœºæˆ‘è§‰å¾—å¯¹äºä¸€ä¸ªåƒæˆ‘è¿™æ ·ç©¿31å—é’±æ—ç”¸é‹çš„äºº,æ‹¿ç€ä¸€ä¸ª8000å¤šçš„ iPhone X æ— ç–‘æ˜¯æ›´åŠ é²œæ˜çš„è¯æ˜æˆ‘æ˜¯ä¸€ä¸ªåè¶³çš„å±Œä¸.ç”µåŠ¨è½¦è¿™ä¸ªä¸œè¥¿å®åœ¨è§£å†³äº†æˆ‘å¾ˆå¤šå¿™,ä¸Šä¸‹ç­æ— è®ºå»å“ªé‡Œéƒ½å¾ˆæ–¹ä¾¿,é™å™ªè€³æœºåˆ™æ˜¯åœ¨å·¥ä½œä¸­èƒ½å¾ˆå®‰é™æŠ•å…¥çš„å·¥ä½œ.è‡³äºæœºæ¢°é”®ç›˜ æ˜¾ç„¶æ²¡å•¥ç”¨,ä½†æ˜¯è‹¹æœçš„é”®ç›˜æ›´è´µ,æƒ³æƒ³è¿˜æ˜¯ç®—äº†,ä¹Ÿç®—å€¼å¾—å§.æœ€æ²¡å•¥ç”¨çš„å°±æ˜¯PC å’Œé‚£å—æ‰‹è¡¨,è¿™ä¸¤æ ·ä¸œè¥¿æ˜¯æˆ‘ä¹°ä¸œè¥¿çš„ä¸€ä¸ªè´¥ç¬”.

ä¹°äº†è¿™ä¹ˆå¤šç ´çƒ‚,èŠ±äº†ä¸å°‘é’±,ç„¶åæˆ‘å‘ç°æœ‰äº›ä¸œè¥¿ä¸€å®šè¦ç‰©å°½å…¶ç”¨.å¦‚æœèŠ±äº†å¾ˆå¤šé’±å´æ²¡æœ‰å‘æŒ¥æœ‰ç”¨çš„ä»·å€¼æ˜¾ç„¶å°±æ˜¯ä¸€ç§ä¸ç†æ€§çš„æ¶ˆè´¹..


## åšæŒ

æ¯å¹´æ•™å¸ˆèŠ‚æˆ‘éƒ½ä¼šç»™ä¸€ä½åˆä¸­çš„è¯­æ–‡è€å¸ˆæ‰“ç”µè¯é—®å€™ä¸€ä¸‹,æˆ‘ä¸€ç›´è¿ç»­åšæŒäº†11å¹´.æˆ‘è§‰å¾—æˆ‘çš„åˆä¸­å­¦ä¹ çœŸçš„å¾ˆå·®,æ²¡æœ‰ç»™è¿™ä½è€å¸ˆç•™ä¸‹è¿‡å¤ªå¥½çš„å°è±¡,æˆ‘æƒ³å¼¥è¡¥ä¸€ä¸‹,æƒ³åˆ›é€ ä¸€é¡¹è®°å½•,è¿™é¡¹è®°å½•æ˜¯è¦åšåœ¨è¿™ä½è€å¸ˆçš„å­¦ç”Ÿä¸­è¿ç»­åšæŒä¸€å¥é—®å€™çš„å­¦ç”Ÿ,ä¹‹ä¸ä¹‹ä¸€æˆ‘ä¸çŸ¥é“,æœªæ¥å¦‚æœèƒ½çš„è¯æˆ‘ä¼šå°½é‡åšæŒä¸‹å»,å¸Œæœ›è¿™ä½è€å¸ˆè®°å¾—è¿™ä½å­¦ç”Ÿå¾ˆå¹³å‡¡,ä½†å´åšäº†ä¸€ä»¶ä¸å¹³å‡¡çš„äº‹æƒ…,å¸Œæœ›è¿™ä½è€å¸ˆè®°å¾—è¿™ä½å­¦ç”Ÿæ¥è‡ªç¬¬äºŒè‰¯ç§åœº.

åœ¨æˆ‘çš„äººç”Ÿç›®æ ‡ä¸­éœ€è¦æ ‘ç«‹ä¸€ä¸ªäºŒè‰¯äººéƒ½ä½©æœçš„æ¦œæ ·.è¿™ä½æ¦œæ ·å°±æ˜¯å‘ç”Ÿåœ¨è¿™åº§å‡ ä¹åœ°å›¾éƒ½æ²¡æœ‰å¯¼èˆªè·¯çº¿ä¸”è¢«ä¸­å›½å¿½ç•¥çš„æ‘åº„.æˆ‘æ¢¦æƒ³æœ‰ä¸€å¤©è¡£é”¦è¿˜ä¹¡çš„é‚£ä¸€å¤©èƒ½ä¸ºäºŒè‰¯å»ºé€ ä¸€åº§è®¡ç®—æœºåšç‰©é¦†,åœ¨è¿™åº§åšç‰©é¦†ä¸­ä½ å¯ä»¥å°½æƒ…çš„å­¦ä¹ è®¡ç®—æœºç±»çš„ä¹¦ç±.åƒæˆ‘ä¸€æ ·ç”¨æ‰€å­¦çš„çŸ¥è¯†æ”¹å˜è‡ªå·±çš„å‘½è¿.

å› ä¸ºåœ¨æˆ‘ä¸Šå­¦çš„çº¢å…‰å†œåœºåˆä¸­,äºŒè‰¯çš„å­¦ç”Ÿå—åˆ°äº†å¤ªå¤šä¸å¹³ç­‰ä¸å…¬æ­£çš„å¾…é‡,è¿™ä¸ç¦è®©æˆ‘æ½¸ç„¶æ³ªä¸‹,ä¸ºä»€ä¹ˆæˆ‘ä»¬å°±åœ¨çº¢å…‰å†œåœºè¿™åº§é‚»è¿‘çš„å†œåœºæ‘åº„æŠ¬ä¸èµ·å¤´æ¥,æ˜¯å› ä¸ºæˆ‘ä»¬è½å,è½åå°±è¦æŒ¨æ‰“,å°±è¦å—åˆ°ä¸å…¬æ­£çš„å¾…é‡,ä¸ºäº†æ”¹å˜è¿™ä¸€åˆ‡éœ€è¦æˆ‘ä»¬å¿å—"éŸ©ä¿¡çš„èƒ¯ä¸‹ä¹‹è¾±".

åœ¨è¿™æ‰€ä¸­å­¦,è€å¸ˆä»¬åªå¯¹äº²ä¿¡å­å¼Ÿè´Ÿè´£,å¯¹è¯¥å†œåœºçš„å­å¼Ÿæ¬¡ä¹‹,å†æ¬¡æ‰èƒ½è½®åˆ°åƒäºŒè‰¯è¿™ç§å€Ÿè¯»çš„å­¦ç”Ÿä¸­å­¦ä¹ å¥½çš„å­¦ç”Ÿ,è‡³äºåƒæˆ‘è¿™ç§æ—¢æ— èƒŒæ™¯ä¹Ÿæ²¡å…³ç³»,åˆå­¦ä¹ ä¸å¥½çš„å­¦ç”Ÿè¿™ç§æ­§è§†çœŸçš„åˆ»éª¨é“­å¿ƒ,å‚åŠ å·¥ä½œåä¹Ÿä¾ç„¶æ²¡æœ‰å¿˜è®°,ä¸ºä»€ä¹ˆåŒæ ·æ˜¯ä¸­å›½äººè¿˜æè¿™ä¹ˆå…·ä½“çš„åœ°åŸŸæ­§è§†. 

æˆ‘å¸Œæœ›æˆ‘èƒ½ç”¨è‡ªå·±çš„å®è·µè¯æ˜ç»™è¿™ä½è€å¸ˆçœ‹,çœ‹çœ‹åˆ°åº•æ˜¯çº¢å…‰çš„å­¦ç”ŸåšæŒ11å¹´ç»™æ‚¨æ‰“ç”µè¯è¿˜æ˜¯äºŒè‰¯çš„å­¦ç”Ÿèƒ½åšæŒ11å¹´ç»™ä½ æ‰“ç”µè¯,__äººæ´»çš„è¦ç”¨å®åŠ›å»èµ¢å¾—åˆ«äººä½©æœå’Œå°Šé‡__,æˆ‘å¸Œæœ›è™½ç„¶äºŒè‰¯å’Œçº¢å…‰åœ°åŸŸçš„ç»æµå·®è·å¾ˆå¤§,ä½†æ˜¯æ¯ä¸ªåœ°åŸŸéƒ½æœ‰å…¶ç‹¬ç‰¹æ€§,æ²¡æœ‰å“ªé‡Œæ¯”å“ªé‡Œé«˜ä½è´µè´±ä¹‹åˆ†,è¦ç›¸äº’èåˆäº’ç›¸å°Šé‡.

å°‘ä¸€äº›æ•™è‚²èµ„æºçš„å€¾æ–œ,è®©æ¯ä¸ªå­¦ç”Ÿéƒ½èƒ½å¾—åˆ°å…¬æ­£å¹³ç­‰çš„å¾…é‡.

## ç”Ÿæ´»

æˆ‘è®¤ä¸ºäººç”Ÿæœ‰ä¸¤å ‚é€‰ä¿®è¯¾

* 1.è£…ä¿®
* 2.åšé¥­

#### è£…ä¿®

ä»17å¹´ä¹°æˆ¿åˆ°ç°åœ¨æˆ¿å­è¿˜æ²¡æœ‰ä¸‹æ¥,å¦‚æœæ˜¯æ¯›å¯æˆ¿çš„è¯,éœ€è¦è‡ªå·±å­¦ä¼šè£…ä¿®.

å¨æˆ¿: é›†æˆç¶ã€æ¶ˆæ¯’æŸœã€è’¸çƒ¤ç®± æ°´æ§½ã€å‡€æ°´å™¨ã€åƒåœ¾å¤„ç†å™¨...

è¿™å ‚è¯¾åªæœ‰ä¸¤ç§äººå¯ä»¥é€ƒé¿

* æœ‰é’±äºº
* ä¹°äºŒæ‰‹æˆ¿çš„äºº

æ˜¾ç„¶æˆ‘ä¸æ˜¯è¿™ä¸¤ç§äºº,æ—¢æ²¡é’±ä¹Ÿæ²¡ä¹°äºŒæ‰‹æˆ¿,éœ€è¦ç»å†æœ‰é™çš„è£…ä¿®ç»è´¹,æ‰è¥Ÿè§è‚˜çš„è£…ä¿®.

åœ¨æˆ¿å­æ²¡ä¸‹æ¥ä¹‹å‰æˆ‘ç»å¸¸æŠ½å‡ºæ—¶é—´äº†è§£ä¸€äº›ç›¸å…³çš„è£…ä¿®ç»éªŒ,æˆ‘æƒ³è£…å®Œä¿®ä¹Ÿè®¸å°±æˆäº†åŠä¸ªè£…ä¿®å·¥.

#### åšé¥­

è¿™æ˜¯ä¸€ä»¶åªè¦æœ‰ä¸€ä¸ªäººéœ€è¦å¹²çš„æ´».

å¦‚æœä¸å»äº†è§£å¦‚ä½•ä¸‹å¨åšé¥­,é‚£ä¹Ÿè®¸ä¸€è¾ˆå­è¿‡çš„å¾ˆå¹³åº¸,å¦‚æœä¸å»äº†è§£æ¯›è‘±å’Œå°è‘±å¤§è‘±åˆ°åº•åšé¥­å¥½ä¸å¥½åƒ,ä»€ä¹ˆæ ·çš„è‘±é€‚åˆåšä»€ä¹ˆæ ·çš„èœé‚£ä¹ˆäººå°±ä¸ä¼šæœ‰å¤ªå¤šçš„æˆé•¿.


æ˜¾ç„¶ä¸Šé¢çš„ä¸¤å ‚è¯¾æˆ‘æ²¡æœ‰é€ƒè¯¾.

æ‰€è°“ç”Ÿæ´»,æœ‰çš„å¹´è½»äººè®¤ä¸ºæˆ‘ä»¬ä¸éœ€è¦åšæˆåŠŸäººå£«,äº«å—ç°åœ¨çš„é™å¥½ä¸å°±å¯ä»¥äº†ä¹ˆ,æ˜¯çš„ä½ èƒ½äº«å—ç°åœ¨çš„ç¾å¥½é‚£ä¹ˆä¸€å®šæœ‰äººæ›¿ä½ ç ¥ç ºå‰è¡Œ,é‚£ä¸ªäººè¦ä¹ˆæ˜¯ä½ çˆ¶æ¯è¦ä¹ˆæ˜¯ä½ çˆ±äºº.

æ²¡æœ‰è¢«ç”Ÿæ´»æŠ˜ç£¨è¿‡åªæœ‰ä¸¤ç§å¯èƒ½

* ç¬¬ä¸€ æœ‰äººæ›¿ä½ æ‰›ç€
* ç¬¬äºŒ åˆ«ç€æ€¥ è¿˜æ²¡è½®åˆ°ä½ 

å®¶äººæ€»æœ‰ç”¨é’±çš„æ—¶å€™,åœ¨ä¸­å›½ ä¸€åœºå¤§ç—…èƒ½æ‘§æ¯ä¸€ä¸ªä¸­äº§é˜¶çº§çš„å®¶åº­.å³ä¾¿æ˜¯ç°åœ¨çš„åŒ»ä¿åŠ›åº¦å¾ˆå¤§,ä½†æ˜¯è¿˜æ˜¯ç»ä¸èµ·å¤§é£å¤§æµª

åœ¨å®¶é‡Œçš„è€äººæ€»è¯´é’±ä¹°ä¸æ¥å¹¸ç¦, æˆ‘æƒ³è¯´:ã€é’±ä¹°ä¸æ¥100%çš„å¹¸ç¦,æˆé•¿å99%çš„çƒ¦æ¼éƒ½æ˜¯å› ä¸ºæ²¡é’±ã€.

æˆ‘ç°åœ¨æ‡‚å¾—ä»€ä¹ˆå«é€‰æ‹©æ¯”åŠªåŠ›æ›´é‡è¦äº†,åŠªåŠ›æ˜¯ä¸ºäº†è®©è‡ªå·±æœ‰æ›´å¤šé€‰æ‹©çš„æƒåˆ©.


## æ•…äº‹

æœ‰ä¸€ä¸ªåŒå­¦,æˆ‘4å¹´é›¶2ä¸ªæœˆæ²¡æœ‰è”ç³»,æ—¶é—´è¿‡çš„çœŸå¿« ä¸€æ™ƒ å¿«5å¹´äº†,æˆ‘åˆé‡æ–°åŠ äº†ä¸€ä¸‹å¾®ä¿¡,ä¸ºäº†çºªå¿µè¿™ä½åŒå­¦,æˆ‘æ’°å†™äº†ä¸€ç¯‡é¢˜æä¸ºã€Šèˆ¹ä¸ç¯å¡”ã€‹çš„å‰§æœ¬. 


è¿™ä¹ˆå¤šå¹´æˆ‘æ€»ç»“çš„çœŸç†æ˜¯:"çˆ¶æ¯ä¸€å®šè¦æœ‰æ­£äº‹,å¦‚æœæ²¡æœ‰æ­£äº‹é‚£å­å¥³å°±å¾—ä¸ºçˆ¶æ¯çš„æ²¡æ­£äº‹ä¹°å•,å› ä¸ºçˆ¶æ¯æ²¡æœ‰ç§¯æ”’ä¸‹å„¿å¥³æœªæ¥å‡ åå¹´éœ€è¦å‘å±•çš„ç»æµåŸºç¡€,æ˜¾ç„¶å„¿å¥³å°±å¾—ç™½æ‰‹èµ·å®¶ä»é›¶å¼€å§‹".


## ç™¾å¹´

ä»Šå¹´çš„åä¸€å‡æœŸæˆ‘å»äº†é˜”åˆ«11å¹´çš„å¤©æ´¥,å»çœ‹çœ‹07å¹´å»è¿‡çš„èº«å½±,11å¹´å‰è¿˜æ²¡æœ‰GPSå®šä½çš„åœ°å›¾,æˆ‘å´ä¾ç„¶èƒ½æ‰¾åˆ°æ–¹å‘.

![](/assets/images/20181231FinalSummary/sun.webp)

è¿™æ˜¯æˆ‘åœ¨å¤©æ´¥æ‰¾åˆ°å®¶æ—ç™¾å¹´ä»¥æ¥å”¯ä¸€ç•™ä¸‹ä»…å­˜çš„å‡ å¼ ç…§ç‰‡,æˆ‘æ›¾ç¥–çˆ¶,æ›¾ç¥–æ¯,æˆ‘çš„çˆ¶äº²å’Œå§‘å§‘.ç°åœ¨çœ‹åˆ°è¿™æ˜¾å¾—æ— æ¯”çè´µ.

æˆ‘çš„ç¥–å…ˆæ˜¯é—¯å…³ä¸œå»çš„ä¸œåŒ—,å®¶è°±è®°è½½åœ°å€:å±±ä¸œçœé’å·åºœå¯¿å…‰å¿å­™å®¶ç¥åº™,ç”¸å­åŒ—ä½.

ä¹Ÿå°±æ˜¯ç°åœ¨çš„:å±±ä¸œçœæ½åŠå¸‚é’å·å¸‚å¯¿å…‰å¿å­™å®¶æ‘ 

ä½†æ˜¯æˆ‘æœç´¢åœ°å›¾å‘ç°äº†è‡³å°‘3å¤„

ç¬¬ä¸€å¤„

![](/assets/images/20181231FinalSummary/hometown1.webp)

ç¬¬äºŒå¤„

![](/assets/images/20181231FinalSummary/hometown2.webp)

ç¬¬ä¸‰å¤„

![](/assets/images/20181231FinalSummary/hometown.webp)


è¿™é‡Œæœ€æœ‰å¯èƒ½çš„æ˜¯ç¬¬ä¸€å¤„ å› ä¸ºé è¿‘æ²³æµæœ‰æ²³æµåœ°é¢è¿‡æ¸¡åŒº(ç”¸å­),ç»è¿‡ç™¾å¹´çš„åœ°åŸŸå˜åŒ–,å¯èƒ½æ²³æµæµé‡å‡å°‘,åœ°è¡¨é«˜å¤„æ°´é¢,æ—¶é—´é•¿äº†å½¢æˆæ‘è½å’Œè€•åœ°.


è¿™é‡Œå¦‚ä»Šå·²ç»é«˜é“å»ºæˆ,æˆä¸ºäº†ç¥–å›½çš„è”¬èœä¹‹ä¹¡,æˆ‘ä¸ºæ­¤æ„Ÿåˆ°æ¬£æ…°,ä¹Ÿè®¸1900å¹´å·¦å³æˆ‘çš„ç¥–å…ˆæ›¾ç»ç”Ÿæ´»åœ¨è¿™é‡Œ. 


æˆ‘çš„æ›¾ç¥–çˆ¶æ¥åˆ°ä¸œåŒ—çš„æ—¶å€™èµ¶ä¸Šäº†æ—¥æœ¬å é¢†ä¸œä¸‰çœ,é‚£æ—¶å€™ä¹Ÿè®¸è¿«äºç”Ÿè®¡å’Œæ°‘æ—çš„æ²¦è½,ä¸å¾—ä¸ä¸ºæ—¥æœ¬äººå·¥ä½œ,ä¹Ÿå°±æ˜¯åœ¨ç°åœ¨çš„é»‘é¾™æ±Ÿçœæµ·ä¼¦å¸‚æµ·åŒ—é•‡åä¸‰äº•å­æ‘,æ—¥æœ¬äººåœ¨è¿™é‡Œå…»å†›é©¬,å‰é¢æ˜¯ä¸œæ–¹çº¢æ°´åº“,æˆ‘çš„æ›¾ç¥–çˆ¶ç»ƒå°±ä¸€èº«æ‰“é“çš„æ‰‹è‰º,ä¸ºå†›é©¬é’‰é©¬æŒ,å› ä¸ºä¸œåŒ—å¾ˆå†·,è·¯é¢ç»“å†°,é˜²æ­¢é©¬æ‰“æ»‘,æ‰€ä»¥é’‰é©¬æŒæ˜¯å…¶ä¸­çš„ä»»åŠ¡ä¹‹ä¸€,ä¸Šè¾¹ä¸­é—´è¿™å¼ ç…§ç‰‡,æ˜¯å½“å¹´ä»…å­˜åˆ°ç°åœ¨çš„ä¸€å¼ æ—¥æœ¬ä¸ºå·¥åŒ ç…§çš„ç›¸ç‰‡.

æƒ³æƒ³é‚£ä¸ªæ—¶å€™çœŸæ˜¯å›½ç ´å±±æ²³åœ¨,å®¶ä¹¦æŠµä¸‡é‡‘.è¿™ä½è€äººä¹Ÿè®¸ç»å†è¿‡æ™šæ¸…è¦†ç­,ä¸­åæ°‘å›½çš„åˆå»ºåˆ°å†›é˜€æ··æˆ˜,åœ¨åˆ°æ–°ä¸­å›½çš„æˆç«‹,å†ç»3ä¸ªæœä»£çš„æ›´è¿­.

ä¹Ÿè®¸æ¢åšæ™®é€šäººéƒ½æ´»ä¸åˆ°ä¸€ä¸ªæœä»£çš„è¦†ç­

ä¸è¿‡æ‰“é“çš„æ‰‹è‰ºå¯æ˜¯ä¼ æ‰¿3ä»£äºº,æˆ‘çš„çˆ·çˆ·,å”çˆ¶,ç°åœ¨åˆ°æˆ‘çš„å“¥å“¥,å¦‚æœåœ¨ç°ä»£åº”è¯¥æˆä¸ºå·¥åŒ ,å¸Œæœ›æœ‰ä¸€å¤©æˆ‘çš„è®¡ç®—æœºåšç‰©é¦†ä¸­,èƒ½å­˜æ”¾ç€å®¶æ—æ‰“é“å·¥è‰ºçš„ç»å”±.

æ›¾ç¥–çˆ¶é‚£ä¸€ä»£äººæ´»çš„ä¸å®¹æ˜“.

## æ€»ç»“

è¿™ä¸€å¹´æˆ‘å†™äº†å¾ˆå¤šæŠ€æœ¯çš„æ–‡ç« ,æˆ‘ä¸æƒ³åœ¨å¹´ç»ˆæ€»ç»“ä¸­è¿˜è°ˆè®ºæŠ€æœ¯,åº”è¯¥è®°å½•ä¸€äº›ç”Ÿæ´»çš„ç¾å¥½å›å¿†.

å»å¹´çš„è¿™ä¸ªæ—¶å€™æˆ‘ç»™è‡ªå·±çš„å®šä¸‹çš„KPIä»Šå¹´æ˜¾ç„¶æ²¡æœ‰å®Œæˆ

2019å¹´å¸Œæœ›èƒ½ä¸æ–­å­¦ä¹ ,ä¸æ—¶ä¿±è¿›,å­¦ä¼šæ›´å¤šæœ‰ç”¨çš„çŸ¥è¯†æ¥æé«˜å½±å“åŠ›.

æœ€å,å¹¸ç¦æ˜¯å¥‹æ–—å‡ºæ¥çš„,è¿˜å¾—æ’¸èµ·è¢–å­åŠ æ²¹å¹²,å¾—æ•¢äºç›´é¢æƒ¨æ·¡çš„äººç”Ÿ,æ•¢äºç”¨å®åŠ›å»èµ¢å¾—åˆ«äººçš„å°Šé‡,è¿™æ ·æ‰èƒ½æˆä¸ºè‡ªå·±ç¾¡æ…•çš„åˆ«äºº.










URL: https://sunyazhou.com/2018/12/AwemeTransition/index.html.md
Published At: 2018-12-21 10:12:07 +0000

# iOSæŠ–éŸ³çš„è½¬åœºåŠ¨ç”»

# å‰è¨€

è¿™å‡ å¤©æ¯”è¾ƒå¿™,ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯æŠ–éŸ³çš„è½¬åœºåŠ¨ç”»å®ç° åºŸè¯ä¸å¤šè¯´ä¸Šå›¾

![](/assets/images/20181221AwemeTransition/transition.gif)

è¿™é‡Œéœ€è¦ç”¨åˆ°å‰ä¸€ç¯‡æ–‡ç« çš„ä¸Šä¸‹æ»‘[demo](https://github.com/sunyazhou13/AwemeDemo)

å­¦ä¹ è¿™ç¯‡æ–‡ç« ä¹‹å‰æ¨èçœ‹ä¸‹å–µç¥çš„[iOS7ä¸­çš„ViewControllerè½¬åœºåˆ‡æ¢](https://onevcat.com/2013/10/vc-transition-in-ios7/) 


å¦‚æœå¯¹è½¬åœºä¸æ˜¯å¾ˆäº†è§£çš„è¯å¯èƒ½å­¦ä¹ ä¼šæœ‰ä¸€äº›éš¾åº¦å’Œç–‘é—®.



## è½¬åœºè°ƒç”¨ä»£ç 

``` objc

- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath {
    AwemeListViewController *awemeVC = [[AwemeListViewController alloc] init];
    awemeVC.transitioningDelegate = self; //0
    
    // 1
    UICollectionViewCell *cell = [collectionView cellForItemAtIndexPath:indexPath];
    // 2
    CGRect cellFrame = cell.frame;
    // 3
    CGRect cellConvertedFrame = [collectionView convertRect:cellFrame toView:collectionView.superview];
    
    //å¼¹çª—è½¬åœº
    self.presentScaleAnimation.cellConvertFrame = cellConvertedFrame; //4
    
    //æ¶ˆå¤±è½¬åœº
    self.dismissScaleAnimation.selectCell = cell; // 5
    self.dismissScaleAnimation.originCellFrame  = cellFrame; //6
    self.dismissScaleAnimation.finalCellFrame = cellConvertedFrame; //7
    
    awemeVC.modalPresentationStyle = UIModalPresentationOverCurrentContext; //8
    self.modalPresentationStyle = UIModalPresentationCurrentContext; //9
    
    [self.leftDragInteractiveTransition wireToViewController:awemeVC];
    [self presentViewController:awemeVC animated:YES completion:nil];
}

```

 `0` å¤„ä»£ç ä½¿æˆ‘ä»¬éœ€è¦æŠŠå½“å‰çš„ç±»åšä¸ºè½¬åœºçš„ä»£ç†  
 `1` è¿™é‡Œæˆ‘ä»¬è¦æ‹¿å‡ºcellè¿™ä¸ªview  
 `2` æ‹¿å‡ºå½“å‰Cellçš„frameåæ ‡  
 `3` cellçš„åæ ‡è½¬æˆå±å¹•åæ ‡  
 `4` è®¾ç½®å¼¹å‡ºæ—¶å€™éœ€è¦cellåœ¨å±å¹•çš„ä½ç½®åæ ‡  
 `5` è®¾ç½®æ¶ˆå¤±è½¬åœºéœ€è¦çš„é€‰ä¸­cellè§†å›¾  
 `6` è®¾ç½®æ¶ˆå¤±è½¬åœºåŸå§‹cellåæ ‡ä½ç½®  
 `7` è®¾ç½®æ¶ˆå¤±è½¬åœºæœ€ç»ˆå¾—cellå±å¹•åæ ‡ä½ç½® ç”¨äºæ¶ˆå¤±å®Œæˆå›åˆ°åŸæ¥ä½ç½®çš„åŠ¨ç”»  
 `8` è®¾ç½®å¼¹å‡ºå¾—vcå¼¹å‡ºæ ·å¼ è¿™ä¸ªç”¨äºæ˜¾ç¤ºå¼¹å‡ºVCå¾—æ—¶å€™ é»˜è®¤åº•éƒ¨ä½¿bluaçš„é«˜æ–¯æ¨¡ç³Š  
 `9` è®¾ç½®å½“å‰VCçš„æ¨¡æ€å¼¹å‡ºæ ·å¼ä¸ºå½“å‰çš„å¼¹å‡ºä¸Šä¸‹æ–‡  
 
 > 5~7 æ­¥è®¾ç½®çš„æ¶ˆå¤±è½¬åœºåŠ¨ç”» ä¸‹é¢ä¼šè®²è§£
 
 è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯å‰é¢è®²ä¸Šä¸‹æ»‘çš„VCå¯¹è±¡ å¤§å®¶ä¸å¿…æ‹…å¿ƒ å½“å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„UIViewControllerå³å¯
 
 ## å®ç°è½¬åœºæ‰€éœ€è¦çš„ä»£ç†
 
 é¦–å…ˆåœ¨éœ€è¦å®ç°`UIViewControllerTransitioningDelegate`è¿™ä¸ªä»£ç†
 
 ``` objc
 #pragma mark -
#pragma mark - UIViewControllerAnimatedTransitioning Delegate
- (nullable id <UIViewControllerAnimatedTransitioning>)animationControllerForPresentedController:(UIViewController *)presented presentingController:(UIViewController *)presenting sourceController:(UIViewController *)source {
    
    return self.presentScaleAnimation; //present VC
}

- (nullable id <UIViewControllerAnimatedTransitioning>)animationControllerForDismissedController:(UIViewController *)dismissed {
    return self.dismissScaleAnimation; //dismiss VC
}

- (nullable id <UIViewControllerInteractiveTransitioning>)interactionControllerForDismissal:(id <UIViewControllerAnimatedTransitioning>)animator {
    return self.leftDragInteractiveTransition.isInteracting? self.leftDragInteractiveTransition: nil;
}

 ```
 
 è¿™é‡Œé¢æˆ‘ä»¬çœ‹åˆ°æˆ‘ä»¬åˆ†åˆ«è¿”å›äº†
 
 * å¼¹å‡ºåŠ¨ç”»å®ä¾‹`self.presentScaleAnimation`
 * dismissåŠ¨ç”»å®ä¾‹`self.dismissScaleAnimation`
 * ä»¥åŠ`self.leftDragInteractiveTransition`å®ä¾‹ç”¨äºè´Ÿè´£è½¬åœºåˆ‡æ¢çš„å…·ä½“å®ç°

 æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ å½“å‰çš„VCä¸­å£°æ˜3ä¸ªæˆå‘˜å˜é‡ å¹¶åˆå§‹åŒ–
 
 ``` objc
@property (nonatomic, strong) PresentScaleAnimation *presentScaleAnimation;
@property (nonatomic, strong) DismissScaleAnimation *dismissScaleAnimation;
@property (nonatomic, strong) DragLeftInteractiveTransition *leftDragInteractiveTransition;
 ```
 
 å¹¶åœ¨`viewDidLoad:`æ–¹æ³•ä¸­åˆå§‹åŒ–ä¸€ä¸‹
 
 ``` objc
 //è½¬åœºçš„ä¸¤ä¸ªåŠ¨ç”»
self.presentScaleAnimation = [[PresentScaleAnimation alloc] init];
self.dismissScaleAnimation = [[DismissScaleAnimation alloc] init];
self.leftDragInteractiveTransition = [DragLeftInteractiveTransition new];
 ```
 
 è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹è¿™ä¸‰ä¸ªæˆå‘˜éƒ½è´Ÿè´£å•¥äº‹
 
 é¦–å…ˆ`DragLeftInteractiveTransition`ç±»è´Ÿè´£è½¬åœºçš„ æ‰‹åŠ¿ è¿‡ç¨‹,å°±æ˜¯panæ‰‹åŠ¿åœ¨è¿™ä¸ªç±»é‡Œé¢å®ç°,å¹¶ç»§æ‰¿è‡ª`UIPercentDrivenInteractiveTransition`ç±»,è¿™æ˜¯iOS7ä»¥åç³»ç»Ÿæä¾›çš„è½¬åœºåŸºç±»å¿…é¡»åœ¨`interactionControllerForDismissal:`ä»£ç†åè®®ä¸­è¿”å›è¿™ä¸ªç±»æˆ–è€…å­ç±»çš„å®ä¾‹å¯¹è±¡,æ‰€ä»¥æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªæˆå‘˜å˜é‡`self.leftDragInteractiveTransition`
 
 å…¶æ¬¡æ˜¯å¼¹å‡ºpresentå’Œæ¶ˆå¤±dismissçš„åŠ¨ç”»ç±»,è¿™ä¿©ç±»å…¶å®æ˜¯è´Ÿè´£ç®€å•çš„æ‰‹åŠ¿å®Œæˆä¹‹åçš„åŠ¨ç”».
 
 è¿™ä¸¤ä¸ªç±»éƒ½æ˜¯ç»§æ‰¿è‡ªNSObjectå¹¶å®ç°`UIViewControllerAnimatedTransitioning`åè®®çš„ç±»,è¿™ä¸ªåè®®é‡Œé¢æœ‰ éœ€è¦ä½ å¤å†™æŸäº›æ–¹æ³•è¿”å›å…·ä½“çš„åŠ¨ç”»æ‰§è¡Œæ—¶é—´,å’Œä¸­é—´è¿‡ç¨‹ä¸­æˆ‘ä»¬éœ€è¦çš„ç›¸å…³çš„å®¹å™¨è§†å›¾ä»¥åŠæ§åˆ¶å™¨çš„è§†å›¾å®ä¾‹,å½“æˆ‘ä»¬è‡ªå·±æ‰§è¡Œå®Œæˆä¹‹åè°ƒç”¨ç›¸å…³çš„blockå›ç­”å‘ŠçŸ¥è½¬åœºæ˜¯å¦å®Œæˆå°±è¡Œäº†.
 
``` objc
 @implementation PresentScaleAnimation

- (NSTimeInterval)transitionDuration:(id <UIViewControllerContextTransitioning>)transitionContext{
    return 0.3f;
}

- (void)animateTransition:(id <UIViewControllerContextTransitioning>)transitionContext{
    UIViewController *toVC = [transitionContext viewControllerForKey:UITransitionContextToViewControllerKey];    
    if (CGRectEqualToRect(self.cellConvertFrame, CGRectZero)) {
        [transitionContext completeTransition:YES];
        return;
    }
    CGRect initialFrame = self.cellConvertFrame;

    UIView *containerView = [transitionContext containerView];
    [containerView addSubview:toVC.view];

    CGRect finalFrame = [transitionContext finalFrameForViewController:toVC];
    NSTimeInterval duration = [self transitionDuration:transitionContext];

    toVC.view.center = CGPointMake(initialFrame.origin.x + initialFrame.size.width/2, initialFrame.origin.y + initialFrame.size.height/2);
    toVC.view.transform = CGAffineTransformMakeScale(initialFrame.size.width/finalFrame.size.width, initialFrame.size.height/finalFrame.size.height);

    [UIView animateWithDuration:duration
                          delay:0
         usingSpringWithDamping:0.8
          initialSpringVelocity:1
                        options:UIViewAnimationOptionLayoutSubviews
                     animations:^{
                         toVC.view.center = CGPointMake(finalFrame.origin.x + finalFrame.size.width/2, finalFrame.origin.y + finalFrame.size.height/2);
                         toVC.view.transform = CGAffineTransformMakeScale(1, 1);
                     } completion:^(BOOL finished) {
                         [transitionContext completeTransition:YES];
                     }];
}
@end
```

å¾ˆç®€å•.

æ¶ˆå¤±çš„åŠ¨ç”» åŒä¸Šè¾¹å·®ä¸å¤š

``` objc
@interface DismissScaleAnimation ()

@end

@implementation DismissScaleAnimation

- (instancetype)init {
    self = [super init];
    if (self) {
        _centerFrame = CGRectMake((ScreenWidth - 5)/2, (ScreenHeight - 5)/2, 5, 5);
    }
    return self;
}

- (NSTimeInterval)transitionDuration:(id <UIViewControllerContextTransitioning>)transitionContext{
    return 0.25f;
}

- (void)animateTransition:(id <UIViewControllerContextTransitioning>)transitionContext{
    UIViewController *fromVC = [transitionContext viewControllerForKey:UITransitionContextFromViewControllerKey];
//    UINavigationController *toNavigation = (UINavigationController *)[transitionContext viewControllerForKey:UITransitionContextToViewControllerKey];
//    UIViewController *toVC = [toNavigation viewControllers].firstObject;
    
    
    UIView *snapshotView;
    CGFloat scaleRatio;
    CGRect finalFrame = self.finalCellFrame;
    if(self.selectCell && !CGRectEqualToRect(finalFrame, CGRectZero)) {
        snapshotView = [self.selectCell snapshotViewAfterScreenUpdates:NO];
        scaleRatio = fromVC.view.frame.size.width/self.selectCell.frame.size.width;
        snapshotView.layer.zPosition = 20;
    }else {
        snapshotView = [fromVC.view snapshotViewAfterScreenUpdates:NO];
        scaleRatio = fromVC.view.frame.size.width/ScreenWidth;
        finalFrame = _centerFrame;
    }
    
    UIView *containerView = [transitionContext containerView];
    [containerView addSubview:snapshotView];
    
    NSTimeInterval duration = [self transitionDuration:transitionContext];
    
    fromVC.view.alpha = 0.0f;
    snapshotView.center = fromVC.view.center;
    snapshotView.transform = CGAffineTransformMakeScale(scaleRatio, scaleRatio);
    [UIView animateWithDuration:duration
                          delay:0
         usingSpringWithDamping:0.8
          initialSpringVelocity:0.2
                        options:UIViewAnimationOptionCurveEaseInOut
                     animations:^{
                         snapshotView.transform = CGAffineTransformMakeScale(1.0f, 1.0f);
                         snapshotView.frame = finalFrame;
                     } completion:^(BOOL finished) {
                         [transitionContext finishInteractiveTransition];
                         [transitionContext completeTransition:YES];
                         [snapshotView removeFromSuperview];
                     }];
}



@end
```
æˆ‘ä»¬é‡ç‚¹éœ€è¦è¯´ä¸€ä¸‹ è½¬åœºè¿‡æ¸¡çš„ç±»`DragLeftInteractiveTransition`ç»§æ‰¿è‡ª`UIPercentDrivenInteractiveTransition`è´Ÿè´£è½¬åœºè¿‡ç¨‹,

å¤´æ–‡ä»¶çš„å£°æ˜

``` objc
@interface DragLeftInteractiveTransition : UIPercentDrivenInteractiveTransition

/** æ˜¯å¦æ­£åœ¨æ‹–åŠ¨è¿”å› æ ‡è¯†æ˜¯å¦æ­£åœ¨ä½¿ç”¨è½¬åœºçš„äº¤äº’ä¸­ */
@property (nonatomic, assign) BOOL isInteracting;


/**
 è®¾ç½®éœ€è¦è¿”å›çš„VC
 
 @param viewController æ§åˆ¶å™¨å®ä¾‹
 */
-(void)wireToViewController:(UIViewController *)viewController;


@end

```

å®ç°

``` objc

@interface DragLeftInteractiveTransition ()

@property (nonatomic, strong) UIViewController *presentingVC;
@property (nonatomic, assign) CGPoint viewControllerCenter;
@property (nonatomic, strong) CALayer *transitionMaskLayer;

@end

@implementation DragLeftInteractiveTransition

#pragma mark -
#pragma mark - override methods å¤å†™æ–¹æ³•
-(CGFloat)completionSpeed{
    return 1 - self.percentComplete;
}

- (void)updateInteractiveTransition:(CGFloat)percentComplete {
    NSLog(@"%.2f",percentComplete);
    
}

- (void)cancelInteractiveTransition {
    NSLog(@"è½¬åœºå–æ¶ˆ");
}

- (void)finishInteractiveTransition {
    NSLog(@"è½¬åœºå®Œæˆ");
}


- (CALayer *)transitionMaskLayer {
    if (_transitionMaskLayer == nil) {
        _transitionMaskLayer = [CALayer layer];
    }
    return _transitionMaskLayer;
}

#pragma mark -
#pragma mark - private methods ç§æœ‰æ–¹æ³•
- (void)prepareGestureRecognizerInView:(UIView*)view {
    UIPanGestureRecognizer *gesture = [[UIPanGestureRecognizer alloc] initWithTarget:self action:@selector(handleGesture:)];
    [view addGestureRecognizer:gesture];
}

#pragma mark -
#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
- (void)handleGesture:(UIPanGestureRecognizer *)gestureRecognizer {
    UIView *vcView = gestureRecognizer.view;
    CGPoint translation = [gestureRecognizer translationInView:vcView.superview];
    if(!self.isInteracting &&
       (translation.x < 0 ||
        translation.y < 0 ||
        translation.x < translation.y)) {
        return;
    }
    switch (gestureRecognizer.state) {
        case UIGestureRecognizerStateBegan:{
            //ä¿®å¤å½“ä»å³ä¾§å‘å·¦æ»‘åŠ¨çš„æ—¶å€™çš„bug é¿å…å¼€å§‹çš„æ—¶å€™ä»åˆå‘å·¦æ»‘åŠ¨ å½“æœªå¼€å§‹çš„æ—¶å€™
            CGPoint vel = [gestureRecognizer velocityInView:gestureRecognizer.view];
            if (!self.isInteracting && vel.x < 0) {
                self.isInteracting = NO;
                return;
            }
            self.transitionMaskLayer.frame = vcView.frame;
            self.transitionMaskLayer.opaque = NO;
            self.transitionMaskLayer.opacity = 1;
            self.transitionMaskLayer.backgroundColor = [UIColor whiteColor].CGColor; //å¿…é¡»æœ‰é¢œè‰²ä¸èƒ½é€æ˜
            [self.transitionMaskLayer setNeedsDisplay];
            [self.transitionMaskLayer displayIfNeeded];
            self.transitionMaskLayer.anchorPoint = CGPointMake(0.5, 0.5);
            self.transitionMaskLayer.position = CGPointMake(vcView.frame.size.width/2.0f, vcView.frame.size.height/2.0f);
            vcView.layer.mask = self.transitionMaskLayer;
            vcView.layer.masksToBounds = YES;
            
            self.isInteracting = YES;
        }
            break;
        case UIGestureRecognizerStateChanged: {
            CGFloat progress = translation.x / [UIScreen mainScreen].bounds.size.width;
            progress = fminf(fmaxf(progress, 0.0), 1.0);
            
            CGFloat ratio = 1.0f - progress*0.5f;
            [_presentingVC.view setCenter:CGPointMake(_viewControllerCenter.x + translation.x * ratio, _viewControllerCenter.y + translation.y * ratio)];
            _presentingVC.view.transform = CGAffineTransformMakeScale(ratio, ratio);
            [self updateInteractiveTransition:progress];
            break;
        }
        case UIGestureRecognizerStateCancelled:
        case UIGestureRecognizerStateEnded:{
            CGFloat progress = translation.x / [UIScreen mainScreen].bounds.size.width;
            progress = fminf(fmaxf(progress, 0.0), 1.0);
            if (progress < 0.2){
                [UIView animateWithDuration:progress
                                      delay:0
                                    options:UIViewAnimationOptionCurveEaseOut
                                 animations:^{
                                     CGFloat w = [UIScreen mainScreen].bounds.size.width;
                                     CGFloat h = [UIScreen mainScreen].bounds.size.height;
                                     [self.presentingVC.view setCenter:CGPointMake(w/2, h/2)];
                                     self.presentingVC.view.transform = CGAffineTransformMakeScale(1.0f, 1.0f);
                                 } completion:^(BOOL finished) {
                                     self.isInteracting = NO;
                                     [self cancelInteractiveTransition];
                                 }];
            }else {
                _isInteracting = NO;
                [self finishInteractiveTransition];
                [_presentingVC dismissViewControllerAnimated:YES completion:nil];
            }
            //ç§»é™¤ é®ç½©
            [self.transitionMaskLayer removeFromSuperlayer];
            self.transitionMaskLayer = nil;
        }
            break;
        default:
            break;
    }
}

#pragma mark -
#pragma mark - public methods å…¬æœ‰æ–¹æ³•
-(void)wireToViewController:(UIViewController *)viewController {
    self.presentingVC = viewController;
    self.viewControllerCenter = viewController.view.center;
    [self prepareGestureRecognizerInView:viewController.view];
}

@end

```


æˆ‘ä»¬å¯¹å¤–æä¾›äº†ä¸€ä¸ª`wireToViewController:`æ–¹æ³•ç”¨äºå¤–éƒ¨éœ€è¦åˆ›å»ºè½¬åœºä½¿ç”¨.

å‰é¢çš„ä»£ç æˆ‘ä»¬å‘ç°æœ‰ä¸€å¤„

``` objc
[self.leftDragInteractiveTransition wireToViewController:awemeVC];
[self presentViewController:awemeVC animated:YES completion:nil];
```

è¿™é‡Œå°±æ˜¯éœ€è¦æŠŠæˆ‘ä»¬è¦å¼¹å‡ºçš„ä¸Šä¸‹æ»‘VCå®ä¾‹ä¼ è¿›æ¥,è¿›æ¥ä¹‹åä¸ºVCçš„`self.view`åŠ ä¸ª`pan`æ‰‹åŠ¿,

å¤å†™æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸å…³å¼€å§‹ç»“æŸ å®Œæˆè¿‡ç¨‹çš„ç™¾åˆ†æ¯”ç›¸å…³æ–¹æ³•å¤å†™

``` objc
#pragma mark -
#pragma mark - override methods å¤å†™æ–¹æ³•
-(CGFloat)completionSpeed{
    return 1 - self.percentComplete;
}

- (void)updateInteractiveTransition:(CGFloat)percentComplete {
    NSLog(@"%.2f",percentComplete);
    
}

- (void)cancelInteractiveTransition {
    NSLog(@"è½¬åœºå–æ¶ˆ");
}

- (void)finishInteractiveTransition {
    NSLog(@"è½¬åœºå®Œæˆ");
}
```

çœ‹æ˜¯æ‰‹åŠ¿ å‡ºå‘å‰ å…ˆæ£€æŸ¥ä¸€ä¸‹æ˜¯å¦å¦‚ä¸‹æ¡ä»¶

``` objc
UIView *vcView = gestureRecognizer.view;
CGPoint translation = [gestureRecognizer translationInView:vcView.superview];
if(!self.isInteracting &&
   (translation.x < 0 ||
    translation.y < 0 ||
    translation.x < translation.y)) {
    return;
}
```

æ‹¿å‡ºæ‰‹åŠ¿ä½œç”¨çš„è§†å›¾,ç„¶ååæ ‡è½¬æ¢,åˆ¤æ–­å½“å‰æ˜¯å¦å·²ç»å¼€å§‹äº†åŠ¨ç”»,å¦‚æœæ²¡å¼€å§‹ æˆ–è€…xåæ ‡ < yåæ ‡æ˜¯åˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯è¶…è¿‡è¾¹ç•ŒèŒƒå›´ç­‰ç­‰å¼‚å¸¸caseå¤„ç†.

å¼€å§‹çš„æ—¶å€™éœ€è¦æ³¨æ„ä¸‹

``` objc
//ä¿®å¤å½“ä»å³ä¾§å‘å·¦æ»‘åŠ¨çš„æ—¶å€™çš„bug é¿å…å¼€å§‹çš„æ—¶å€™ä»åˆå‘å·¦æ»‘åŠ¨ å½“æœªå¼€å§‹çš„æ—¶å€™
CGPoint vel = [gestureRecognizer velocityInView:gestureRecognizer.view];
if (!self.isInteracting && vel.x < 0) {
    self.isInteracting = NO;
    return;
}
```

ç„¶å å¼€å§‹çš„æ—¶å€™åŠ ä¸ªè’™ç‰ˆåšä¸ºview.mask è¿™æ ·æ˜¯ä¸ºäº†è§£å†³tableView è¶…å‡ºcontentSizeçš„èŒƒå›´è¦éšè—

å‰©ä¸‹çš„å°±æ˜¯ä¸­é—´è¿‡ç¨‹ 

__å…³é”®çš„æ ¸å¿ƒä»£ç __

``` objc
[self updateInteractiveTransition:progress];
```

> æ›´æ–°è½¬åœºçš„è¿›åº¦ è¿™æ˜¯è¿™ä¸ªç±»çš„è‡ªå¸¦æ–¹æ³•,è°ƒç”¨å°±è¡Œäº†

æœ€å æ‰‹åŠ¿ç»“æŸ

``` objc
CGFloat progress = translation.x / [UIScreen mainScreen].bounds.size.width;
progress = fminf(fmaxf(progress, 0.0), 1.0);
if (progress < 0.2){
    [UIView animateWithDuration:progress
                          delay:0
                        options:UIViewAnimationOptionCurveEaseOut
                     animations:^{
                         CGFloat w = [UIScreen mainScreen].bounds.size.width;
                         CGFloat h = [UIScreen mainScreen].bounds.size.height;
                         [self.presentingVC.view setCenter:CGPointMake(w/2, h/2)];
                         self.presentingVC.view.transform = CGAffineTransformMakeScale(1.0f, 1.0f);
                     } completion:^(BOOL finished) {
                         self.isInteracting = NO;
                         [self cancelInteractiveTransition];
                     }];
}else {
    _isInteracting = NO;
    [self finishInteractiveTransition];
    [_presentingVC dismissViewControllerAnimated:YES completion:nil];
}
//ç§»é™¤ é®ç½©
[self.transitionMaskLayer removeFromSuperlayer];
self.transitionMaskLayer = nil;
```

> è¿™é‡Œè®¾ç½®0.2çš„å®¹å·® å¦‚æœä½ è§‰å¾—è¿™ä¸ªåº”è¯¥å¼€æ”¾æ¥å£è®¾ç½®å¯è‡ªè¡Œå°è£….

å½“ç”¨æˆ·å–æ¶ˆçš„è¯è®°å¾—è°ƒç”¨`cancelInteractiveTransition`æ–¹æ³•å–æ¶ˆ

å®Œæˆçš„è¯è°ƒç”¨`finishInteractiveTransition`å®Œæˆè½¬åœº


# æ€»ç»“

æ•´ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ å¦‚æœçœ‹è¿‡å–µç¥çš„æ–‡ç« å°†ä¼šæ›´åŠ æ¸…æ™°çš„äº†è§£è½¬åœºçš„ä¸‰ä¸ªè¿‡ç¨‹
å°±æ˜¯ å¼¹å‡ºå’Œæ¶ˆå¤±åŠ¨ç”» ä»¥åŠä¸€ä¸ªä¸­é—´è½¬åœºè¿‡ç¨‹éœ€è¦æˆ‘ä»¬ç†Ÿæ‚‰.

ä¼˜åŒ–ç‚¹: åœ¨åŸå¼€æºå·¥ç¨‹ä¸­çš„demoè½¬åœºå³æ»‘æ˜¯æœ‰bugçš„,æˆ‘åšäº†ä¸€ä¸‹å¦‚ä¸‹åˆ¤æ–­

``` objc
//ä¿®å¤å½“ä»å³ä¾§å‘å·¦æ»‘åŠ¨çš„æ—¶å€™çš„bug é¿å…å¼€å§‹çš„æ—¶å€™ä»åˆå‘å·¦æ»‘åŠ¨ å½“æœªå¼€å§‹çš„æ—¶å€™
CGPoint vel = [gestureRecognizer velocityInView:gestureRecognizer.view];
if (!self.isInteracting && vel.x < 0) {
    self.isInteracting = NO;
    return;
}

```

`vel`è¿™ä¸ªå˜é‡ å…¶å®æ˜¯åˆ¤æ–­å½“æˆ‘ä»¬ä»å³ä¾§åˆ’å…¥è¿”å›.ä¿®å¤äº†åŸæ¥å¼€æºçš„ä¸€ä¸ªbug

è¿˜æœ‰ åŸæ¥å¼€æºä¸­`tableView`çš„`contentSize`ä»¥å¤– åŒºåŸŸéœ²åœ¨å¤–éƒ¨,æˆ‘ç”¨äº†ä¸€ä¸ªmaskçš„è’™ç‰ˆé®ä½äº†æ˜¾ç¤ºåœ¨å¤–çš„åŒºåŸŸ.


å”¯ä¸€æœ‰äº›è®¸é—æ†¾çš„åœ°æ–¹æ˜¯æŠ–éŸ³çš„å·¦æ»‘è¿”å›æ—¶å€™,æœ‰èƒŒæ™¯é®ç›–é€æ˜çš„æ¸å˜.è¿™é‡Œç”±äºæ—¶é—´å…³ç³»å’Œç¯‡å¹…é™åˆ¶æˆ‘æ²¡æœ‰èŠ±è¶³å¤Ÿçš„æ—¶é—´è°ƒç ”.åç»­å®Œå–„,å†™çš„ä¸å¥½è¯·å¤§å®¶å¤šå¤šæŒ‡æ•™


[æœ€ç»ˆå¾—Demoåœ¨è¿™é‡Œ](https://github.com/sunyazhou13/AwemeDemoTransition)



URL: https://sunyazhou.com/2018/12/DetectingPanGestureDirection/index.html.md
Published At: 2018-12-06 13:59:46 +0000

# æ¢æµ‹UIPanGestureçš„æ»‘åŠ¨æ–¹å‘

# å‰è¨€

è¿™å‡ å¤©é‡åˆ°ä¸€ä¸ªé—®é¢˜ å°±æ˜¯æ‹–åŠ¨æ‰‹åŠ¿ä½œç”¨åœ¨ä¸€ä¸ªviewä¸Šçš„æ—¶å€™ æ— æ³•åŒºåˆ†æ–¹å‘

äºæ˜¯æ‰¾åˆ°stackOverFlowä¸Šçš„ç­”æ¡ˆ è®°å½•ä¸€ä¸‹

``` objc
- (void)panRecognized:(UIPanGestureRecognizer *)rec
{
    CGPoint vel = [rec velocityInView:self.view];
    if (vel.x > 0)
    {
        // user dragged towards the right å‘å³æ‹–åŠ¨
    }
    else
    {
        // user dragged towards the left å‘å·¦æ‹–åŠ¨
    }
}

```


[å‚è€ƒ](https://stackoverflow.com/questions/11777281/detecting-the-direction-of-pan-gesture-in-ios)


URL: https://sunyazhou.com/2018/11/LikeAnimation/index.html.md
Published At: 2018-11-27 11:16:14 +0000

# iOSæŠ–éŸ³ç‚¹èµåŠ¨ç”»å®ç°

# å‰è¨€

hi å¤§å®¶å¥½ åˆè·Ÿå¤§å®¶è§é¢äº†,ä»Šå¤©ç»™å¤§å®¶åˆ†äº«çš„æ˜¯æŠ–éŸ³çš„ç‚¹èµåŠ¨ç”»çš„å®ç°, åºŸè¯ä¸å¤šè¯´ä¸Šå›¾

![](/assets/images/20181127LikeAnimation/likeAnimation1.gif)


æœ¬ç¯‡æ–‡ç« ä¸»è¦åŒ…å«æŠ€æœ¯ç‚¹:

* CAShapeLayerå’Œè´èµ›å°”æ›²çº¿ç»˜åˆ¶ä¸‰è§’å½¢
* ç»„åˆåŠ¨ç”»çš„æ—¶é—´æŠ€å·§

æˆ‘ä¹ æƒ¯å†™å®Œæ–‡ç« çš„demoéƒ½é™„åœ¨æ–‡ç« åº•éƒ¨,å¦‚æœä¸æƒ³çœ‹åŸç†çš„å°ä¼™ä¼´å¯ç›´æ¥è·³åˆ°åº•éƒ¨æ‰¾demoä¸‹è½½.

# å®ç°åŸç†


é¦–å…ˆ æˆ‘ä»¬æ¥è¯¦ç»†åˆ†è§£ä¸€ä¸‹è¿™ä¸ªåŠ¨ç”» 

![](/assets/images/20181127LikeAnimation/likeAnimation2.gif)
> è¯·ä»”ç»†è§‚å¯Ÿ


æˆ‘ä»¬æ¥çœ‹å•ç‹¬çš„ä¸€ä¸ªåŠ¨ç”» 

![](/assets/images/20181127LikeAnimation/likeAnimation3.gif)

> è¯·ä»”ç»†è§‚çœ‹ æˆ‘è®¾ç½®10ç§’çš„duration ä»¥ä¾¿äºå¤§å®¶èƒ½çœ‹æ¸…æ¥š

## å®ç°åŸç†

ä»ä¸Šè¿°ä¸¤å¼ å›¾ä¸­,æˆ‘ä»¬å¯ä»¥çœ‹åˆ° å®ƒæ˜¯ä¸€ä¸ª ä¸‰è§’å½¢çš„è´å¡å°”æ›²çº¿ 

![](/assets/images/20181127LikeAnimation/likeAnimation4.webp)


è¿™æ ·çš„åŠ¨ç”»éœ€è¦ç»è¿‡:

* 2Ï€ (360Â°)æ—‹è½¬ä¸€å‘¨
* åœ†ä¸€å‘¨ä¸€å…±æœ‰å…­ä¸ª ä¸‰è§’å½¢çš„è´èµ›å°”æ›²çº¿å›¾å½¢å½¢çŠ¶.
* ä¸€ä¸ªåŠ¨ç”»ç»„ å†…éƒ¨åŒ…å«ç¼©æ”¾åŠ¨ç”» ä»0~1çš„æ”¾å¤§ ,åŠ¨ç”»å¦‚æœæ‰§è¡Œ10ç§’,é‚£ä¹ˆ scaleç¼©æ”¾åŠ¨ç”»æ‰§è¡Œ 10*0.2 = 2ç§’, åŠ¨ç”»ç»„ä¸­è¿˜åŒ…å«å¦ä¸€ä¸ªåŠ¨ç”»æ˜¯ ä»ç»“æŸä½ç½®çš„åŠ¨ç”»åˆ°ç»“å°¾æ¶ˆå¤±çš„ä½ç½®å¤§å°å˜åŒ–ç›´åˆ°åŠ¨ç”»æ¶ˆå¤±.
* æ²¿ç€åœ†å½¢æ¯ 60Â°è§’åº¦ åˆ›å»ºä¸€ä¸ªä¸Šå›¾çš„ä¸‰è§’å½¢å›¾å½¢.

è¯´äº†è¿™ä¹ˆå¤š å®é™…å°±æ˜¯ç”¨`CABasicAnimation`çš„keypathæ˜¯`path`å’Œ`CABasicAnimation`çš„`keypath`æ˜¯`transform.scale`çš„åŠ¨ç”»ç»„åˆåœ¨ä¸€èµ·ä½œç”¨äºä¸€ä¸ªä¸‰è§’å½¢ä¸Š,å¹¶ä¸”ä¸€å…±åˆ›å»º6ä¸ªä¸‰è§’å½¢å›¾å½¢.

ç»“æŸçš„æ—¶å€™å¤§æ¦‚æ˜¯è¿™æ ·çš„

![](/assets/images/20181127LikeAnimation/likeAnimation5.gif)

ç»“æŸçš„æ—¶å€™å®é™…ä¸Šæ˜¯ä¸€ä¸ªä» ä¸Šä¸€æ¬¡åŠ¨ç”»æ‰§è¡Œå®Œæˆçš„pathå‘ ä¸€æ¡çº¿ä¸Šä¸‰ä¸ªç‚¹çš„pathè¿‡æ¸¡çš„è¿‡ç¨‹,ç›´åˆ°æœ€åéšè—æ¶ˆå¤±.

å¥½ä¸‹é¢æˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªåŠ¨ç”»

> æ³¨æ„: èƒŒæ™¯çš„â¤ï¸çº¢å¿ƒæ˜¯ ä¸€å¼ å›¾ä¸åœ¨æœ¬ç¯‡è®²è¿°èŒƒå›´

## ä»£ç å®ç°


é¦–å…ˆæˆ‘ä»¬å­ç±»è¯ä¸€ä¸ª`ZanLikeView`ç»§æ‰¿è‡ª`UIView`å¹¶è®¾ç½®åº•éƒ¨çš„å›¾ç‰‡å’Œç‚¹å‡»å˜æ¢çš„â¤ï¸å›¾ç‰‡,å°±æ˜¯ä¸¤å¼ UIImageViewåŠ æ‰‹åŠ¿,å½“ç‚¹å‡»çš„æ—¶å€™åŒºåˆ†ä¸åŒviewçš„tagå°±çŸ¥é“å“ªä¸ªimageviewç‚¹å‡»,è¿™æ ·å°±å¯ä»¥åšä¸¤å¼ åŠ¨ç”»ä¸åŒçš„æ•ˆæœäº†,ä¸è¿‡è¿™äº›å¯ä»¥å‚è€ƒdemo.

æˆ‘ä¸»è¦ä»‹ç»æ ¸å¿ƒä»£ç 

åˆ›å»º `CAShapeLayer`ç”¨äºåšå½¢çŠ¶å›¾å½¢ç›¸å…³çš„å›¾å½¢åŠ¨ç”».

``` objc
CAShapeLayer *layer = [[CAShapeLayer alloc]init];
layer.position = _likeBefore.center;
layer.fillColor = [UIColor redColor].CGColor;
```
> é¢œè‰²æœ€ç»ˆå¯å¯¹å¤–æš´éœ²æ¥å£

forå¾ªç¯æ¯ 30Â°è§’åˆ›å»ºä¸€ä¸ªä¸Šè¿°çš„ä¸‰è§’å½¢.æˆ‘ä»¬éœ€è¦åˆ›å»º 6ä¸ª å°±å¾ªç¯6æ¬¡


åˆ›å»ºåˆå§‹ä½ç½®çš„è´å¡å°”path

``` objc
CGFloat length = 30;
CGFloat duration = 0.5f;
for(int i = 0 ; i < 6; i++) {
	CAShapeLayer *layer = [[CAShapeLayer alloc]init];
	layer.position = _likeBefore.center;
	layer.fillColor = [[UIColor redColor].CGColor;
	
	//...  1
	//...  2
	//...  3
}
```

> è¿™é‡Œæˆ‘ä»¬ä¸€å…±åˆ›å»º6ä¸ªshapeLayerçš„å®ä¾‹å¹¶å¡«å……æˆé¢œè‰²,æˆ‘ä»¬è¿™é‡Œå¡«å……çš„æ˜¯çº¢è‰² å…¶å®ƒçš„é¢œè‰²å¯è‡ªè¡Œå°è£….
> _likeBefore æ˜¯æˆ‘ä»¬çœ‹åˆ°ç™½è‰²çš„â¤ï¸èƒŒæ™¯è§†å›¾(UIImageView)

ä¸‹é¢ åœ¨`//...  1`çš„åœ°æ–¹åŠ å…¥å¦‚ä¸‹ä»£ç 

``` objc
UIBezierPath *startPath = [UIBezierPath bezierPath];
[startPath moveToPoint:CGPointMake(-2, -length)];
[startPath addLineToPoint:CGPointMake(2, -length)];
[startPath addLineToPoint:CGPointMake(0, 0)];
```

è¿™è¡Œä»£ç åŠ å®Œå°±æ˜¯è¿™æ ·çš„å›¾å½¢

![](/assets/images/20181127LikeAnimation/likeAnimation4.webp)

ç„¶ååˆ›å»ºå®Œæˆæˆ‘ä»¬éœ€è¦æŠŠpathç»™layer.path. è®°å¾—è½¬æˆCGPath

``` objc
layer.path = startPath.CGPath;
layer.transform = CATransform3DMakeRotation(M_PI / 3.0f * i, 0.0, 0.0, 1.0);
[self.layer addSublayer:layer]
```
> æ³¨: CATransform3DMakeRotation()å‡½æ•° å½“x,y,zå€¼ä¸º0æ—¶,ä»£è¡¨åœ¨è¯¥è½´æ–¹å‘ä¸Šä¸è¿›è¡Œæ—‹è½¬,å½“å€¼ä¸º-1æ—¶,ä»£è¡¨åœ¨è¯¥è½´æ–¹å‘ä¸Šè¿›è¡Œé€†æ—¶é’ˆæ—‹è½¬,å½“å€¼ä¸º1æ—¶,ä»£è¡¨åœ¨è¯¥è½´æ–¹å‘ä¸Šè¿›è¡Œé¡ºæ—¶é’ˆæ—‹è½¬  
> å› ä¸ºæˆ‘ä»¬æ˜¯éœ€è¦60Â°åˆ›å»ºä¸€ä¸ªlayeræ‰€ä»¥éœ€è¦é¡ºæ—¶é’ˆ M_PI / 3.0f = 60Â°. æ¯å¾ªç¯ä¸€æ¬¡åˆ™åˆ›å»ºç¬¬Nä¸ªè§’åº¦`ä¹˜`60Â°.

æ¥ç€åœ¨`//...  2`æ·»åŠ å¦‚ä¸‹ä»£ç 

``` objc
//åŠ¨ç”»ç»„
CAAnimationGroup *group = [[CAAnimationGroup alloc] init];
group.removedOnCompletion = NO;
group.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
group.fillMode = kCAFillModeForwards;
group.duration = duration;

//ç¼©æ”¾åŠ¨ç”»
CABasicAnimation *scaleAnim = [CABasicAnimation animationWithKeyPath:@"transform.scale"];
scaleAnim.fromValue = @(0.0);
scaleAnim.toValue = @(1.0);
scaleAnim.duration = duration * 0.2f; //æ³¨æ„è¿™é‡Œæ˜¯åœ¨ç»™å®šæ—¶é•¿çš„åœ°æ–¹å‰0.2fçš„æ—¶é—´é‡Œæ‰§è¡Œç¼©æ”¾
```
> è¿™é‡Œè¯´ä¸‹duration * 0.2f. æ¯”å¦‚æˆ‘ç»™å®š 10ç§’çš„duration,é‚£ä¹ˆ duration * 0.2 = 2 ç§’æ‰§è¡Œç¼©æ”¾.


æœ€ååœ¨`//...  3`çš„ä»£ç å‡ºåŠ ä¸Šå¦‚ä¸‹ä»£ç 

``` objc
//ç»“æŸç‚¹
UIBezierPath *endPath = [UIBezierPath bezierPath];
[endPath moveToPoint:CGPointMake(-2, -length)];
[endPath addLineToPoint:CGPointMake(2, -length)];
[endPath addLineToPoint:CGPointMake(0, -length)];
            
CABasicAnimation *pathAnim = [CABasicAnimation animationWithKeyPath:@"path"];
pathAnim.fromValue = (__bridge id)layer.path;
pathAnim.toValue = (__bridge id)endPath.CGPath;
pathAnim.beginTime = duration * 0.2f;
pathAnim.duration = duration * 0.8f;
    
[group setAnimations:@[scaleAnim, pathAnim]];
[layer addAnimation:group forKey:nil];
```

è¿™å‡ è¡Œä»£ç çš„æ„è¯†æ˜¯ ä»æˆ‘ä»¬ä¸Šä¸€ä¸ªlayerçš„pathä½ç½®å¼€å§‹å‘æˆ‘ä»¬ç»“æŸä½ç½®çš„pathè¿‡æ¸¡,å¹¶ä¸”æ³¨æ„å¼€å§‹æ—¶é—´  
`pathAnim.beginTime`æ˜¯ duration * 0.2ä¹Ÿå°±æ˜¯è¯´ åœ¨ä¸Šä¸€ä¸ªåŠ¨ç”»ç»“æŸçš„æ—¶é—´ç‚¹æ‰å¼€å§‹ç»“æŸè¿‡æ¸¡,è¿‡æ¸¡çš„æ—¶é•¿å‰©ä½™æ˜¯duration * 0.8.è¿™æ ·ä¸¤ä¸ªè¿è´¯åœ¨ä¸€èµ·çš„åŠ¨ç”»å°±æ‰§è¡Œå®Œäº†,æœ€åæŠŠåŠ¨ç”»åŠ åˆ°åŠ¨ç”»ç»„ å¤©åŠ ç»™layer.

ä¸‹å›¾æ˜¯ä»å¼€å§‹åˆ°ç»“æŸç‚¹è¿‡æ¸¡çš„åŠ¨ç”».

![](/assets/images/20181127LikeAnimation/likeAnimation5.gif)

å‰©ä½™çš„å·¥ä½œå°±æ˜¯åšä¸ªæ™®é€šçš„åŠ¨ç”»çš„ åŸºæœ¬æ²¡ä»€ä¹ˆäº†.


``` objc
[UIView animateWithDuration:0.35f
                      delay:0.0f
                    options:UIViewAnimationOptionCurveEaseIn
                 animations:^{
                     self.likeAfter.transform = CGAffineTransformScale(CGAffineTransformMakeRotation(-M_PI_4), 0.1f, 0.1f);
                 }
                 completion:^(BOOL finished) {
                     [self.likeAfter setHidden:YES];
                     self.likeBefore.userInteractionEnabled = YES;
                     self.likeAfter.userInteractionEnabled = YES;
                 }];
```

#### æŠ€å·§

ç»“æŸåŠ¨ç”»çš„å¼€å§‹æ—¶é—´å’Œç»“æŸæ—¶é—´æ§åˆ¶,æ°åˆ°å¥½å¤„.


# æ€»ç»“

åŠ¨ç”»å®ç°çš„ç»†èŠ‚éœ€è¦ç ”ç©¶å’Œå­¦ä¹ å’Œå®è·µ,åœ¨è¿™é‡Œæ„Ÿè°¢å¼€æºä½œè€…çš„ä»£ç ç»™äº†æ€è·¯, æˆ‘ä¸ªäººé€šè¿‡å­¦ä¹ å’Œæ¨¡ä»¿æ•´ç†å‡ºåŸç†å†™å‡ºä»£ç æ ¡éªŒå¹¶å¢åŠ ç›¸å…³å¯¹å¤–æ¥å£.


[ç‚¹å‡»ä¸‹è½½Demo](https://github.com/sunyazhou13/LikeDemo)

[ç›´æ¥ä¸‹è½½zip](https://github.com/sunyazhou13/LikeDemo/archive/master.zip)


URL: https://sunyazhou.com/2018/11/PlayLoadingAnimation/index.html.md
Published At: 2018-11-14 14:14:39 +0000

# iOSè§†é¢‘åŠ è½½åŠ¨ç”»

# å‰è¨€

è¿™å‡ å¤©ä¸€ç›´è·Ÿå¼€æºçš„æŠ–éŸ³demoæ–—æ™ºæ–—å‹‡,ä»Šå¤©è·Ÿå¤§å®¶åˆ†äº«çš„æ˜¯æŠ–éŸ³ä¸­æˆ–è€…å¿«æ‰‹ä¸­åŠ è½½è§†é¢‘çš„åŠ¨ç”» 

ä¸Šå›¾çœ‹æˆå“

![](/assets/images/20181114PlayLoadingAnimation/playloading.gif)



# å®ç°åŸç†


é¦–å…ˆæˆ‘åˆ›å»ºä¸€ä¸ªè§†å›¾

``` objc
@interface ViewController ()
@property (nonatomic, strong) UIView *playLoadingView;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    //init player status bar
    self.playLoadingView = [[UIView alloc]init];
    self.playLoadingView.backgroundColor = [UIColor whiteColor];
    [self.playLoadingView setHidden:YES];
    [self.view addSubview:self.playLoadingView];
    
    //make constraintes
    [self.playLoadingView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.center.equalTo(self.view);
        make.width.mas_equalTo(1.0f); //å®½ 1 dp
        make.height.mas_equalTo(0.5f); //é«˜ 0.5 dp
    }];
    
    [self startLoadingPlayAnimation:YES]; //è°ƒç”¨åŠ¨ç”»ä»£ç 
}

```

> è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° æˆ‘ä»¬å®é™…ä¸Šåˆ›å»ºçš„æ˜¯ä¸€ä¸ª 1ptå®½åº¦ 0.5 ptçš„å®½åº¦ çš„è§†å›¾

ç´§æ¥ç€åŠ¨ç”»å®ç°çš„ä»£ç 

``` objc
- (void)startLoadingPlayAnimation:(BOOL)isStart {
    if (isStart) {
        self.playLoadingView.backgroundColor = [UIColor whiteColor];
        self.playLoadingView.hidden = NO;
        [self.playLoadingView.layer removeAllAnimations];
        
        CAAnimationGroup *animationGroup = [[CAAnimationGroup alloc] init];
        animationGroup.duration = 0.5;
        animationGroup.beginTime = CACurrentMediaTime() + 0.5;
        animationGroup.repeatCount = MAXFLOAT;
        animationGroup.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
        
        CABasicAnimation *scaleAnimation = [CABasicAnimation animation];
        scaleAnimation.keyPath = @"transform.scale.x";
        scaleAnimation.fromValue = @(1.0f);
        scaleAnimation.toValue = @(1.0f * ScreenWidth);
        
        CABasicAnimation *alphaAnimation = [CABasicAnimation animation];
        alphaAnimation.keyPath = @"opacity";
        alphaAnimation.fromValue = @(1.0f);
        alphaAnimation.toValue = @(0.5f);
        
        [animationGroup setAnimations:@[scaleAnimation, alphaAnimation]];
        [self.playLoadingView.layer addAnimation:animationGroup forKey:nil];
    } else {
        [self.playLoadingView.layer removeAllAnimations];
        self.playLoadingView.hidden = YES;
    }
}

```

å®Œäº‹ å°±è¿™å‡ è¡Œä»£ç  æå®š

å…¶å®æ ¸å¿ƒçš„åªæœ‰4è¡Œä»£ç 

``` objc
CABasicAnimation *scaleAnimation = [CABasicAnimation animation];
scaleAnimation.keyPath = @"transform.scale.x";
scaleAnimation.fromValue = @(1.0f);
scaleAnimation.toValue = @(1.0f * ScreenWidth);
```

> å…³é”®åœ¨`scaleAnimation.keyPath = @"transform.scale.x";` è¿™é‡Œæˆ‘ä»¬è¦æ²¿ç€xåšç¼©æ”¾

ç¼©æ”¾çš„å¾—å€¼ä» __1~å±å¹•å®½åº¦__, å½“ç„¶å€¼å¤šå¤§è‡ªå·±å¯ä»¥æ§åˆ¶. 

å¦‚æœ`@"transform.scale.y"` åˆ™æ˜¯æ²¿ç€Yè½´ç¼©æ”¾

å½“ç„¶ å¦‚æœå†™æˆ`@"transform.scale"` é‚£å°±X,Y ä¸€èµ·ç¼©æ”¾ å¤§å®¶å¯ä»¥è¯•è¯•.


# æ€»ç»“

æœ¬ç¯‡çš„åŠ¨ç”»æŠ€å·§æ˜¯ ç¼©æ”¾çš„ `transform.scale.y` ä»ä¸€ä¸ªç‚¹ åšlayerç¼©æ”¾ å°±ä¼šå‡ºç° åŠ è½½æ•ˆæœ.


[æœ€åé™„ä¸Šdemo](https://github.com/sunyazhou13/PlayLoadingDemo)

æ„Ÿè°¢å¤§å®¶æ”¯æŒ





URL: https://sunyazhou.com/2018/11/AllKeypathOfCALayer/index.html.md
Published At: 2018-11-13 11:46:45 +0000

# iOSæ‰€æœ‰Animationç›¸å…³å¯ç”¨çš„Keypath

# å‰è¨€

åœ¨Core Animationä¸­ æˆ‘ä»¬ç»å¸¸ä½¿ç”¨CABasicAnimationæˆ–è€…å®ƒçš„å­ç±»åšä¸€äº›åŠ¨ç”»

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½è¦ç”¨åˆ°Keypath,æœ€è¿‘åœ¨ç ”ç©¶åŠ¨ç”»,æƒ³æ•´ç†ä¸€ä¸‹æ‰€æœ‰å¯ç”¨çš„Keypathåœ¨iOSçš„æ ¸å¿ƒåŠ¨ç”»ä¸­.



# CALayerçš„ç›¸å…³å±æ€§


åºŸè¯ä¸å¤šè¯´ æˆ‘ä»¬ä¸Šä¸€æ®µä»£ç æ¼”ç¤ºä¸€ä¸‹ è¿™ç¯‡çš„ä¸»é¢˜

``` objc
CABasicAnimation * scaleAnimation = [CABasicAnimation animation];
scaleAnimation.keyPath = @"transform.scale.x";
scaleAnimation.fromValue = @(1.0f);
scaleAnimation.toValue = @(1.0f * ScreenWidth);
```

ä¸€èˆ¬æˆ‘ä»¬ç»™ä¸€ä¸ªViewçš„Layeræ·»åŠ animation

``` objc
[xxxView.layer addAnimation: scaleAnimation forKey:@"testAnimationName"];
```

è¿™é‡Œé¢æˆ‘ä»¬æ³¨æ„åˆ°`scaleAnimation.keyPath`å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² æ˜¯ä¸€ä¸ªè¢«å¤–éƒ¨ä¿®æ”¹çš„æˆå‘˜å˜é‡çš„ç±»ä¼¼çš„ä¸œè¥¿,ä½†æ˜¯æˆ‘ä»¬è‡ªå·±åˆä¸èƒ½éšä¾¿æƒ³å†™å†™å•¥

è¿™ä¸ªå®é™…ä¸Šæ˜¯ä¸€ä¸ªlayerçš„å±æ€§ æˆ–è€…æˆå‘˜å˜é‡.

## å…¨éƒ¨å¯ä¿®æ”¹çš„keypathæœ‰å“ªäº›å‘¢ï¼Ÿ

### CALayer animatable properties åŠ¨ç”»æœ‰å¦‚ä¸‹è¿™äº›

``` 
nchorPoint
backgroundColor
backgroundFilters
borderColor
borderWidth
bounds
compositingFilter
contents
contentsRect
cornerRadius
doubleSided
filters
frame
hidden
mask
masksToBounds
opacity
position
shadowColor
shadowOffset
shadowOpacity
shadowPath
shadowRadius
sublayers
sublayerTransform
transform
zPosition

```

å‰©ä¸‹çš„éƒ½æ˜¯ç»§æ‰¿è‡ªCALayer

### CAEmitterLayer animatable properties:

``` 
emitterPosition
emitterZPosition
emitterSize
```

### CAGradientLayer animatable properties

```
colors
locations
endPoint
startPoint

```

### CAReplicatorLayer animatable properties


```
instanceDelay
instanceTransform
instanceRedOffset
instanceGreenOffset
instanceBlueOffset
instanceAlphaOffset

```

### CAShapeLayer animatable properties

``` 
fillColor
lineDashPhase
lineWidth
miterLimit
strokeColor
strokeStart
strokeEnd

```

###  CATextLayer animatable properties

```
fontSize
foregroundColor

```

### CATransform3D Key-Value Coding Extensions(KVCçš„ Keypath)

```

rotation.x
rotation.y
rotation.z
rotation
scale.x
scale.y
scale.z
scale
translation.x
translation.y
translation.z

```

#### CGPoint keyPaths

```
x
y

```

#### CGSize keyPaths

```
width
height

```

### CGRect keyPaths

```
origin
origin.x
origin.y
size
size.width
size.height
```

> è¿˜æœ‰ä¸€äº›é™„åŠ å¯[å‚è€ƒ](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/AnimatableProperties/AnimatableProperties.html), ä»¥åŠè¯¦ç»†å†…å®¹å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514-CH1-SW1),ä»¥åŠä¸€äº›[ç»“æ„ä½“](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/CoreAnimation_guide/Key-ValueCodingExtensions/Key-ValueCodingExtensions.html#//apple_ref/doc/uid/TP40004514-CH12-SW2).


ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰æˆ‘ç›®å‰æ‰¾åˆ°çš„å…¨éƒ¨åŠ¨ç”»å¯ç”¨çš„`keypath`.


## å¯åŠ¨ç”»å±æ€§ä»‹ç»

### å‡ ä½•å±æ€§(Geometry Properties)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
|transform.rotation.x|æŒ‰xè½´æ—‹è½¬çš„å¼§åº¦|
|transform.rotation.y|æŒ‰yè½´æ—‹è½¬çš„å¼§åº¦|
|transform.rotation.z|æŒ‰zè½´æ—‹è½¬çš„å¼§åº¦|
|transform.rotation|æŒ‰zè½´æ—‹è½¬çš„å¼§åº¦, å’Œtransform.rotation.zæ•ˆæœä¸€æ ·|
|transform.scale.x|åœ¨xè½´æŒ‰æ¯”ä¾‹æ”¾å¤§ç¼©å°|
|transform.scale.y|åœ¨yè½´æŒ‰æ¯”ä¾‹æ”¾å¤§ç¼©å°|
|transform.scale.z|åœ¨zè½´æŒ‰æ¯”ä¾‹æ”¾å¤§ç¼©å°|
|transform.scale|æ•´ä½“æŒ‰æ¯”ä¾‹æ”¾å¤§ç¼©å°|
|transform.translation.x|æ²¿xè½´å¹³ç§»|
|transform.translation.y|æ²¿yè½´å¹³ç§»|
|transform.translation.z|æ²¿zè½´å¹³ç§»|
|transform.translation| x,y åæ ‡å‡å‘ç”Ÿæ”¹å˜ |
|transform | CATransform3D 4xbounds4çŸ©é˜µ|
|bounds|layerå¤§å°|
|position|layerä½ç½®|
|anchorPoint|é”šç‚¹ä½ç½®|
|cornerRadius| åœ†è§’å¤§å° |
|zPosition |zè½´ä½ç½® |

> æ³¨æ„: è¿™é‡Œæ²¡æœ‰frame,layerçš„ frame æ˜¯ä¸æ”¯æŒåŠ¨ç”»çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ”¹å˜positionå’Œboundsæ¥ä»£æ›¿frame


### Layerå†…å®¹ (Layer Content)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
|contents | Layerå†…å®¹ï¼Œå‘ˆç°åœ¨èƒŒæ™¯é¢œè‰²ä¹‹ä¸Š|

### é˜´å½±å±æ€§ (Shadow Properties)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
|shadowColor|é˜´å½±é¢œè‰²|
|shadowOffset| é˜´å½±åç§»è·ç¦» |
|shadowOpacity|é˜´å½±é€æ˜åº¦|
|shadowRadius|é˜´å½±åœ†è§’|
|shadowPath|é˜´å½±è½¨è¿¹|

### é€æ˜åº¦ (Opacity Property)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
|opacity| é€æ˜åº¦|

### é®ç½© (Mask Properties)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
|mask| |

### ShapeLayerå±æ€§ (ShapeLayer)

|å¯ç”¨ Key Path | ç¤ºæ„ |
| ------| ------ |
| fillColor | å¡«å……é¢œè‰² |
| strokeColor | æè¾¹é¢œè‰² |
| strokeStart | æè¾¹é¢œè‰²å¼€å§‹ ä»æ— åˆ°æœ‰ |
| strokeEnd |  æè¾¹é¢œè‰²ç»“æŸ ä»æœ‰åˆ°æ—  |
| lineWidth |è·¯å¾„çš„çº¿å®½|
| miterLimit | ç›¸äº¤é•¿åº¦çš„æœ€å¤§å€¼ |
| lineDashPhase | è™šçº¿æ ·å¼ |




# æ€»ç»“

ä»¥ä¸Šæ˜¯æˆ‘ æœé›†æ•´ç† åˆ°çš„æ‰€æœ‰keypathä»…ä¾›å‚è€ƒ

å¤šå¹´å‰ æˆ‘èµ°åœ¨ è¾‰ç…Œå›½é™…åˆ°è¥¿äºŒæ——çš„å¤§è¡—ä¸Š è„‘è¢‹é‡Œè¿˜åœ¨æ€è€ƒ ä¸ºä»€ä¹ˆanimationçš„è¿™ç§keypathæ€»æ˜¯ææˆå­—ç¬¦ä¸² æ•´æ•´å°±å®¹æ˜“å†™é”™.ä»Šå¤©è‡ªå·±çš„è¿™ç¯‡æ–‡ç« ç»™äº†ç­”æ¡ˆ,ç­”æ¡ˆæ˜¯ KVCçš„æˆå‘˜å˜é‡å¹¶æ²¡æœ‰ç›´æ¥è·å–å˜é‡å,è€Œæ˜¯è¦å†™æˆ å­—ç¬¦ä¸²çš„å˜é‡å.å†…å®¹é€šè¿‡å­—ç¬¦ä¸²å»åšä¸€äº›äº‹æƒ….




URL: https://sunyazhou.com/2018/11/AwemeAlbumAnimation/index.html.md
Published At: 2018-11-08 11:52:06 +0000

# iOSæŠ–éŸ³å³ä¸‹è§’ä¸“è¾‘åŠ¨ç”»

# å‰è¨€

å‰ä¸¤å¤©åˆ†äº«äº† æŠ–éŸ³ ä¸Šä¸‹æ»‘åˆ‡æ¢ ,ä»Šå¤©ç»™å’Œå¤§å®¶åˆ†äº«çš„æ˜¯æŠ–éŸ³å³å°è§’åº•éƒ¨çš„ä¸“è¾‘åŠ¨ç”»

ä¸Šå›¾çœ‹ä¸‹

![](/assets/images/20181108AwemeAlbumAnimation/final.gif)

å†çœ‹ä¸‹æŠ–éŸ³çš„

![](/assets/images/20181108AwemeAlbumAnimation/AlbumAnimation.gif)

# å…·ä½“å®ç°æ€è·¯

é¦–å…ˆéœ€è¦3æ¶¨ç´ æ è¿™ä¸ªåœ¨demoä¸­å°±å¯ä»¥æ‰¾åˆ°å“ˆ

åœ¨æ–‡ç« åº•éƒ¨demoä¸­æœ‰

1. ContrainerView
2. Background Layer 
3. Album (UIImageView)

![](/assets/images/20181108AwemeAlbumAnimation/album1.webp)

æˆ‘ä»¬é¦–å…ˆå†™ä¸ª `MusicAlbumView` ç»§æ‰¿è‡ªUIView

``` objc
@interface MusicAlbumView : UIView

@property (nonatomic, strong) UIImageView  *album;
// å¼€å§‹åŠ¨ç”» rate åŠ¨ç”»æ—¶é—´ç³»æ•°
- (void)startAnimation:(CGFloat)rate;
// é‡ç½®è§†å›¾ åˆ é™¤æ‰€æœ‰å·²æ·»åŠ çš„åŠ¨ç”»ç»„
- (void)resetView;

@end

```

### å¹¶æä¾›ä¸¤ä¸ªæ¥å£ 

* ä¸€ä¸ªå¼€å§‹åŠ¨ç”»
* ä¸€ä¸ªé‡ç½®åŠ¨ç”»

`album` æˆå‘˜å˜é‡ æ˜¯ä¸ºäº†ç»™å¤–éƒ¨åŠ è½½ç½‘ç»œå›¾ç‰‡ä½¿ç”¨ æ‰€ä»¥æš´éœ²åœ¨.hä¸­, ä¾‹å¦‚ä¸‹é¢çš„è°ƒç”¨

``` objc
__weak __typeof(self) wself = self;
//åŠ è½½ç½‘ç»œå›¾
[self.musicAlbum.album sd_setImageWithURL:[NSURL URLWithString:@"https://www.sunyazhou.com/images/logo2.jpg"] completed:^(UIImage * _Nullable image, NSError * _Nullable error, SDImageCacheType cacheType, NSURL * _Nullable imageURL) {
    if(!error) {
        wself.musicAlbum.album.image = image;
    }
}];
    
```

### ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å†…éƒ¨å¦‚ä½•å°è£…

é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºèƒŒæ™¯

``` objc
- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        self.noteLayers = [NSMutableArray array];
        //ä¸“è¾‘èƒŒæ™¯å®¹å™¨è§†å›¾
        self.albumContainer =[[UIView alloc]initWithFrame:self.bounds];
        [self addSubview:self.albumContainer];
    }
    return self;
}
```
> è¿™é‡Œåˆå§‹åŒ–çš„æ•°ç»„æ˜¯ä¸ºä¸‹é¢è£…åŠ¨ç”»layerä½¿ç”¨ æ–¹ä¾¿ Resetçš„æ—¶å€™ ç§»é™¤æ‰€æœ‰layerå’ŒåŠ¨ç”»

ä¸€ä¸ªäº§å“èƒŒæ™¯å®¹å™¨UIView + ä¸€ä¸ªäº§å“èƒŒæ™¯Layer + ä¸€ä¸ªä¸ªäººå¤´åƒèƒŒæ™¯UIImageView 

æˆ‘ä»¬ä¾æ¬¡æŠŠä¸‹é¢ä»£ç å†™åœ¨`[self addSubview:self.albumContainer]`åº•éƒ¨

æ·»åŠ å”±ç‰‡èƒŒæ™¯


``` objc
//æ·»åŠ å”±ç‰‡iconçš„layer
CALayer *backgroudLayer = [CALayer layer];
backgroudLayer.frame = self.bounds;
backgroudLayer.contents = (id)[UIImage imageNamed:@"music_cover"].CGImage;
[self.albumContainer.layer addSublayer:backgroudLayer];

```

å¤´åƒè§†å›¾

``` objc
//æ”¾åœ¨å”±ç‰‡å†…éƒ¨çš„å›¾ç‰‡
CGFloat w = CGRectGetWidth(frame) / 2.0f;
CGFloat h = CGRectGetHeight(frame) / 2.0f;
CGRect albumFrame = CGRectMake(w / 2.0f, h / 2.0f, w, h);
self.album = [[UIImageView alloc]initWithFrame:albumFrame];
self.album.contentMode = UIViewContentModeScaleAspectFill;
[self.albumContainer addSubview:self.album];
self.album.layer.cornerRadius = h / 2.0f;
self.album.layer.masksToBounds = YES;
        
```

ç„¶åå±…ä¸­å¯¹é½.


#### ç»™`self.albumContainer.layer`åŠ æ—‹è½¬



æˆ‘ä»¬åœ¨å¤–éƒ¨è°ƒç”¨startAnimation:æ–¹æ³•çš„æ—¶å€™ ç»™`self.albumContainer.layer`æ·»åŠ æ—‹è½¬åŠ¨ç”»æ—‹è½¬

``` objc

- (void)startAnimation:(CGFloat)rate {
    CABasicAnimation* rotationAnimation;
    rotationAnimation = [CABasicAnimation animationWithKeyPath:@"transform.rotation.z"];
    rotationAnimation.toValue = [NSNumber numberWithFloat: M_PI * 2.0];
    rotationAnimation.duration = 3.0f;
    rotationAnimation.cumulative = YES;
    rotationAnimation.repeatCount = MAXFLOAT;
    [self.albumContainer.layer addAnimation:rotationAnimation forKey:@"rotationAnimation"];
}
```

åŠ å®Œæ•ˆæœæ˜¯è¿™æ ·çš„

![](/assets/images/20181108AwemeAlbumAnimation/album2.gif)


#### å¦‚ä½•å®ç°å¼§åº¦åŠ¨ç”»

å¥½ å®Œæˆä¸€åŠäº† ä¸‹é¢æˆ‘ä»¬æ¥è¯´ä¸€ä¸‹ å¼§åº¦æ—‹è½¬.

ç°ä»”ç»†è§‚å¯Ÿä¸€ä¸‹åŠ¨ç”»çš„éŸ³ç¬¦

![](/assets/images/20181108AwemeAlbumAnimation/album3.gif)


è¿™æ˜¯ä¸€å¼ éŸ³ç¬¦åŠ¨ç”» å®ƒçš„è¿åŠ¨è½¨è¿¹å¤§æ¦‚æ˜¯è¿™æ ·çš„

![](/assets/images/20181108AwemeAlbumAnimation/bezier1.webp)

æˆ‘ä»¬å…¶å®ç”¨åˆ°çš„æ˜¯è´å¡å°”æ›²çº¿åŠ¨ç”» (æˆ‘ç”»çš„ä¸æ˜¯å¾ˆå¥½ å¤§å®¶ç†è§£è¿™ä¸ªæ„æ€å°±å¥½)


ç„¶åè®©éŸ³ç¬¦çš„layeræ²¿ç€ è¿™ä¸ªè´å¡å°”æ›²çº¿åšæ—‹è½¬... å…¶å®æ˜¯ä¸‹é¢çš„ä¸€äº›åˆ—åŠ¨ä½œç»„åˆ


è¿™ä¸ªéœ€è¦ä¸€ä¸ªåŠ¨ç”»ç»„ åŒ…å«å¦‚ä¸‹åŠ¨ä½œ 

* ä¸€ä¸ªè´å¡å°”æ›²çº¿è¿åŠ¨çš„è½¨è¿¹åŠ¨ç”»å•Š
* æ—‹è½¬å¼§åº¦ å¤§æ¦‚åŠåœˆ å°ä¸€äº› M_PI * 0.10 ~ M_PI * -0.10 ä¹‹é—´æ—‹è½¬çš„åŠ¨ç”»
* é€æ˜åº¦ ä»0 åˆ° 1 åœ¨åˆ° 0 ä¹‹é—´è¿åŠ¨çš„é€æ˜åº¦åŠ¨ç”» 
* ç¼©æ”¾åŠ¨ç”» ä»å¼€å§‹ 1x åˆ° 2x ä¹‹é—´å˜åŒ–


å¥½æˆ‘ä»¬æ¥è§£å†³ä¸€ä¸‹ å…³é”®çš„è´èµ›å°”æ›²çº¿

é¦–å…ˆåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç»„ 

``` objc
CAAnimationGroup *animationGroup = [[CAAnimationGroup alloc]init];
animationGroup.duration = rate/4.0f;
animationGroup.beginTime = CACurrentMediaTime() + delayTime;
animationGroup.repeatCount = MAXFLOAT;
animationGroup.removedOnCompletion = NO;
animationGroup.fillMode = kCAFillModeForwards;
animationGroup.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];
```

> rate å¤–éƒ¨ä¼ å…¥ delayTimeæ˜¯ åŠ¨ç”»ç»„å¼€å§‹åŠ¨ç”»çš„å»¶è¿Ÿçš„æ—¶é—´ æˆ‘ä»¬è®¾ç½® delayTime ä¸º0å°±æ˜¯ä¸å»¶æ—¶ ä¸‹é¢è§£é‡Šä¸ºä»€ä¹ˆè¿™ä¹ˆå†™


åˆ›å»ºä¸€ä¸ª è´èµ›å°”æ›²çº¿ä¸œåŠ¨ç”»

``` objc
//bezierè·¯å¾„å¸§åŠ¨ç”»
CAKeyframeAnimation * pathAnimation = [CAKeyframeAnimation animationWithKeyPath:@"position"];
    
```

ç„¶åæŠŠä¸‹é¢è¿™å¨ä»£ç åŠ åˆ° ä¸Šé¢ä»£ç çš„åº•éƒ¨

``` objc

CGFloat sideXLength = 40.0f;  //Xè½´å·¦å³ä¾§åç§»é‡
CGFloat sideYLength = 100.0f; //Yè½´ä¸Šä¸‹åç§»é‡

CGPoint beginPoint = CGPointMake(CGRectGetMidX(self.bounds) - 5,  //è´èµ›å°”æ›²çº¿å¼€å§‹ç‚¹CGRectGetMaxY(self.bounds));
CGPoint endPoint = CGPointMake(beginPoint.x - sideXLength, beginPoint.y - sideYLength); //è´å¡å°”æ›²çº¿ç»“æŸç‚¹
NSInteger controlLength = 60; //è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹é•¿åº¦
CGPoint controlPoint = CGPointMake(beginPoint.x - sideXLength/2.0f - controlLength, beginPoint.y - sideYLength/2.0f + controlLength); //è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹

UIBezierPath *customPath = [UIBezierPath bezierPath]; //åˆ›å»ºè´å¡å°”è½¨è¿¹
[customPath moveToPoint:beginPoint];
[customPath addQuadCurveToPoint:endPoint controlPoint:controlPoint]; //æ ¸å¿ƒä»£ç  äºŒæ¬¡æ›²çº¿æ–¹ç¨‹å¼ å¯ä»¥googleæŸ¥ä¸€ä¸‹

pathAnimation.path = customPath.CGPath; //è®©åŠ¨ç”»æ²¿ç€è½¨è¿¹è¿åŠ¨

```

æˆ‘æ¥è§£é‡Šä¸€ä¸‹ å…³é”®å˜é‡

> beginPoint å¼€å§‹ç‚¹: å½“å‰è§†å›¾Xåæ ‡ä¸­å¿ƒ å‘ å·¦åç§» 5dp (Xè½´æ˜¯å·¦å³) Yçš„åæ ‡æ˜¯å½“å‰è§†å›¾é«˜åº¦ å°±æ˜¯æœ€ä¸‹é¢
> endPoint ç»“æŸç‚¹: å¼€å§‹ç‚¹çš„X å‡å» 40å·¦ä¾§åç§»(å°±æ˜¯è·ç¦»å·¦ä¾§æ›´è¿œ) Yä¹Ÿæ˜¯ å‡å»åç§»ä¹‹å åˆ°äº† è§†å›¾çš„å¤–éƒ¨ å·¦ä¸Šæ–¹.
> controlPoint æ§åˆ¶ç‚¹: å¼€å§‹ç‚¹ æ¯”å¦‚ Xæ˜¯ 30 - 60/2.0 - 60 = -60,æ˜¾ç„¶å·²ç»è·‘åˆ°æœ€å·¦è¾¹äº† è¶…å‡ºäº†è§†å›¾èŒƒå›´, Y åé¢æ˜¯+ controlLength è¯´æ˜æ˜¯åŠ å¤§ Yåæ ‡. 

å¤§å®¶å¯ä»¥ä¸ç”¨ç†è§£è¿™äº›ç»†èŠ‚ çœ‹ä¸‹é¢å›¾å°±å¥½äº† 

![](/assets/images/20181108AwemeAlbumAnimation/bezier2.webp)

> customPath: è´å¡å°”æ›²çº¿å¯¹è±¡

``` objc

[customPath moveToPoint:beginPoint];
//æ ¸å¿ƒä»£ç  äºŒæ¬¡æ›²çº¿æ–¹ç¨‹å¼ å¯ä»¥googleæŸ¥ä¸€ä¸‹
[customPath addQuadCurveToPoint:endPoint controlPoint:controlPoint];
//è®©åŠ¨ç”»æ²¿ç€è½¨è¿¹è¿åŠ¨
pathAnimation.path = customPath.CGPath;

```


è¿™å°±æ˜¯ å¢åŠ å¼€å§‹ç‚¹ ç»“æŸç‚¹ æ§åˆ¶ç‚¹ä¹‹åçš„è´å¡å°”è½¨è¿¹,ç„¶å è®¾ç½®è½¨è¿¹åŠ¨ç”»çš„pathå°±å®Œäº‹äº†.

è¿™ä¸€æ­¥æå®Œ ç„¶å æŠŠ`pathAnimation` æ”¾åˆ°åŠ¨ç”»ç»„ä¸­,ç„¶ååˆ›å»ºä¸€ä¸ª éŸ³ç¬¦çš„layeræ·»åŠ åŠ¨ç”»ç»„

``` objc
[animationGroup setAnimations:@[pathAnimation]];
    
CAShapeLayer *layer = [CAShapeLayer layer];
layer.contents = (__bridge id _Nullable)([UIImage imageNamed:imageName].CGImage);
layer.frame = CGRectMake(beginPoint.x, beginPoint.y, 10, 10);
[self.layer addSublayer:layer];
[self.noteLayers addObject:layer];
[layer addAnimation:animationGroup forKey:nil];
```

> `[self.noteLayers addObject:layer];`è¿™è¡Œä»£ç æ˜¯æˆ‘ä»¬å‰é¢å£°æ˜çš„å…¨å±€å˜é‡ å­˜layer,resetçš„æ—¶å€™åˆ é™¤ç›¸å…³layerå’ŒåŠ¨ç”»ä½¿ç”¨

æˆ‘ä»¬æ¥çœ‹ä¸‹ ç®€å•ä¸€ä¸ªéŸ³ç¬¦ æ²¿ç€è´å¡å°”æ›²çº¿è¿åŠ¨

![](/assets/images/20181108AwemeAlbumAnimation/album4.gif)

å¥½ä¸‹é¢çš„å·¥ä½œå°±æ˜¯ åŠ æ—‹è½¬ é€æ˜ ç¼©æ”¾åŠ¨ç”»

``` objc
//æ—‹è½¬å¸§åŠ¨ç”»
CAKeyframeAnimation * rotationAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.rotation"];
//è¿™é‡Œå®é™…ä¸Šæ˜¯æ§åˆ¶åŠ¨ç”»å¼€å§‹å¼§åº¦å’Œç»“æŸå¼§åº¦ M_PI(180Â°) å°±æ˜¯åŠåœ† * 0.10 æˆ–è€… * -0.10jæ˜¯ä¸ºäº†å…³é”®ç‚¹ä¸Šä¸‹åç§»çš„18Â°çš„é—´éš™
[rotationAnimation setValues:@[
                               [NSNumber numberWithFloat:0],
                               [NSNumber numberWithFloat:M_PI * 0.10],
                               [NSNumber numberWithFloat:M_PI * -0.10]]];
//é€æ˜åº¦å¸§åŠ¨ç”»
CAKeyframeAnimation * opacityAnimation = [CAKeyframeAnimation animationWithKeyPath:@"opacity"];
[opacityAnimation setValues:@[
                              [NSNumber numberWithFloat:0],
                              [NSNumber numberWithFloat:0.2f],
                              [NSNumber numberWithFloat:0.7f],
                              [NSNumber numberWithFloat:0.2f],
                              [NSNumber numberWithFloat:0]]];
//ç¼©æ”¾å¸§åŠ¨ç”»
CABasicAnimation *scaleAnimation = [CABasicAnimation animation];
scaleAnimation.keyPath = @"transform.scale";
scaleAnimation.fromValue = @(1.0f);
scaleAnimation.toValue = @(2.0f);
```

æœ€åæ·»æŠŠæ‰€æœ‰çš„åŠ¨ç”»æ·»åŠ åˆ°åŠ¨ç”»ç»„

``` objc
[animationGroup setAnimations:@[pathAnimation, scaleAnimation,  rotationAnimation,opacityAnimation]];
```

> æ³¨æ„ä¸€ä¸‹: ä¸ºäº†è®©éŸ³ç¬¦çš„å›¾ç‰‡æ›´ç”ŸåŠ¨æˆ‘ä»¬éœ€è¦æŠŠ`layer.opacity = 0.0f;` è¿™ä¸ªéŸ³ç¬¦é€æ˜ ä»è€Œç”¨é€æ˜åº¦å¸§åŠ¨ç”»æ§åˆ¶é€æ˜.


ç„¶åå°è£…å¥½æ–¹æ³• æŠŠä¸Šè¾¹æˆ‘ä»¬åšçš„è´å¡å°”æ›²çº¿ é€æ˜ æ¸å˜ ç¼©æ”¾  åŠ¨ç”»ç»„éƒ½æ”¾åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢


å®Œæ•´ä»£ç å¦‚ä¸‹

``` objc
- (void)addNotoAnimation:(NSString *)imageName
               delayTime:(NSTimeInterval)delayTime
                    rate:(CGFloat)rate{
    CAAnimationGroup *animationGroup = [[CAAnimationGroup alloc]init];
    animationGroup.duration = rate/4.0f;
    animationGroup.beginTime = CACurrentMediaTime() + delayTime;
    animationGroup.repeatCount = MAXFLOAT;
    animationGroup.removedOnCompletion = NO;
    animationGroup.fillMode = kCAFillModeForwards;
    animationGroup.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionLinear];
    
    //bezierè·¯å¾„å¸§åŠ¨ç”»
    CAKeyframeAnimation * pathAnimation = [CAKeyframeAnimation animationWithKeyPath:@"position"];
    
    //Xè½´å·¦å³ä¾§åç§»é‡
    CGFloat sideXLength = 40.0f;
    //Yè½´ä¸Šä¸‹åç§»é‡
    CGFloat sideYLength = 100.0f;
    
    //è´èµ›å°”æ›²çº¿å¼€å§‹ç‚¹
    CGPoint beginPoint = CGPointMake(CGRectGetMidX(self.bounds) - 5, CGRectGetMaxY(self.bounds));
    //è´å¡å°”æ›²çº¿ç»“æŸç‚¹
    CGPoint endPoint = CGPointMake(beginPoint.x - sideXLength, beginPoint.y - sideYLength);
    //è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹é•¿åº¦
    NSInteger controlLength = 60;
    //è´å¡å°”æ›²çº¿æ§åˆ¶ç‚¹
    CGPoint controlPoint = CGPointMake(beginPoint.x - sideXLength/2.0f - controlLength, beginPoint.y - sideYLength/2.0f + controlLength);
    //åˆ›å»ºè´å¡å°”è½¨è¿¹
    UIBezierPath *customPath = [UIBezierPath bezierPath];
    [customPath moveToPoint:beginPoint];
    //æ ¸å¿ƒä»£ç  äºŒæ¬¡æ›²çº¿æ–¹ç¨‹å¼ å¯ä»¥googleæŸ¥ä¸€ä¸‹
    [customPath addQuadCurveToPoint:endPoint controlPoint:controlPoint];
    //è®©åŠ¨ç”»æ²¿ç€è½¨è¿¹è¿åŠ¨
    pathAnimation.path = customPath.CGPath;
    
    
    //æ—‹è½¬å¸§åŠ¨ç”»
    CAKeyframeAnimation * rotationAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.rotation"];
    //è¿™é‡Œå®é™…ä¸Šæ˜¯æ§åˆ¶åŠ¨ç”»å¼€å§‹å¼§åº¦å’Œç»“æŸå¼§åº¦ M_PI(180Â°) å°±æ˜¯åŠåœ† * 0.10 æˆ–è€… * -0.10jæ˜¯ä¸ºäº†å…³é”®ç‚¹ä¸Šä¸‹åç§»çš„18Â°çš„é—´éš™
    [rotationAnimation setValues:@[
                                   [NSNumber numberWithFloat:0],
                                   [NSNumber numberWithFloat:M_PI * 0.10],
                                   [NSNumber numberWithFloat:M_PI * -0.10]]];
    //é€æ˜åº¦å¸§åŠ¨ç”»
    CAKeyframeAnimation * opacityAnimation = [CAKeyframeAnimation animationWithKeyPath:@"opacity"];
    [opacityAnimation setValues:@[
                                  [NSNumber numberWithFloat:0],
                                  [NSNumber numberWithFloat:0.2f],
                                  [NSNumber numberWithFloat:0.7f],
                                  [NSNumber numberWithFloat:0.2f],
                                  [NSNumber numberWithFloat:0]]];
    //ç¼©æ”¾å¸§åŠ¨ç”»
    CABasicAnimation *scaleAnimation = [CABasicAnimation animation];
    scaleAnimation.keyPath = @"transform.scale";
    scaleAnimation.fromValue = @(1.0f);
    scaleAnimation.toValue = @(2.0f);
    
    [animationGroup setAnimations:@[pathAnimation, scaleAnimation,  rotationAnimation,opacityAnimation]];
    
    CAShapeLayer *layer = [CAShapeLayer layer];
    layer.opacity = 0.0f;
    layer.contents = (__bridge id _Nullable)([UIImage imageNamed:imageName].CGImage);
    layer.frame = CGRectMake(beginPoint.x, beginPoint.y, 10, 10);
    [self.layer addSublayer:layer];
    [self.noteLayers addObject:layer];
    [layer addAnimation:animationGroup forKey:nil];
}

```

åœ¨æˆ‘ä»¬å¯¹å¤–æä¾›çš„startAnimation:æ–¹æ³•ä¸­è°ƒç”¨

``` objc
- (void)startAnimation:(CGFloat)rate {
    rate = fabs(rate);  //check é˜²æ­¢ rateè¾“å…¥ä¸ºè´Ÿå€¼
    [self resetView];   //é¦–å…ˆé‡ç½®åŠ¨ç”»
   	//è¿™é‡Œè°ƒç”¨
	[self addNotoAnimation:@"icon_home_musicnote1" delayTime:0.0f rate:rate];
	//ã€‚ã€‚ã€‚å°é¢çš„æ—‹è½¬åŠ¨ç”»    
}
```

å†™åˆ°è¿™é‡Œå¤§æ¦‚å°±å®Œæˆäº†ä¸€ä¸ªéŸ³ç¬¦çš„åŠ¨ç”» 
å¦‚æœåƒåšå¤šä¸ªéŸ³ç¬¦åŠ¨ç”» å°±å¤šè°ƒç”¨å‡ æ¬¡ ç„¶åæ§åˆ¶å¥½å¼€å§‹æ—¶é—´çš„å»¶æ—¶

``` objc
[self addNotoAnimation:@"icon_home_musicnote1" delayTime:0.0f rate:rate];
[self addNotoAnimation:@"icon_home_musicnote2" delayTime:1.0f rate:rate];
[self addNotoAnimation:@"icon_home_musicnote1" delayTime:2.0f rate:rate];
```

__å†™åˆ°è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®é™…ä¸Šæ˜¯ é€šè¿‡delayTime å»¶æ—¶(å•ä½ç§’) å¼€æ§åˆ¶ æ¯ä¸ªéŸ³ç¬¦ è·ç¦»ä¸Šä¸ªéŸ³ç¬¦çš„é—´éš”æ—¶é—´,é€šè¿‡é—´éš”æ—¶é—´æ¥æ§åˆ¶éŸ³ç¬¦ä¹‹é—´ äº¤æ›¿ å‡ºç°__.


æ‰€ä»¥ä¸Šé¢çš„åŠ¨ç”»ç»„é‡Œé¢æœ‰è¿™æ ·ä¸€è¡Œä»£ç 

``` objc
animationGroup.beginTime = CACurrentMediaTime() + delayTime;
```

å°±æ˜¯åŸºäºå½“å‰çš„æ—¶é—´å»¶è¿Ÿ1ç§’æˆ–è€…2ç§’æ¥æ§åˆ¶ 

å®Œæˆä¹‹å å°±æ˜¯è¿™æ ·äº†


![](/assets/images/20181108AwemeAlbumAnimation/final.gif)


# æ€»ç»“


é¦–å…ˆæ„Ÿè°¢å¼€æºçš„å°ä¼™ä¼´ çš„ä»£ç ,æˆ‘è®¤çœŸç ”è¯»äº†å‡ éä¹Ÿå†™äº†ä¸€äº›ä»£ç ,æœ‰äº›ä¸œè¥¿çœŸæ˜¯ å¤©ä¸‹å¤§äº‹å¿…åšäºç»† å¤©ä¸‹éš¾äº‹å¿…åšäºæ˜“çš„æ„Ÿå—.

è¿™é‡Œçš„ä»£ç å®ç°ä¸»è¦åˆ†å¼€ ä¸“è¾‘å›¾æ—‹è½¬å’ŒéŸ³ç¬¦åŠ¨ç”»ç»„çš„å®ç°å³å¯ 

å¸Œæœ›å’Œå¤§å®¶åˆ†äº« æŠ€æœ¯æŠ€å·§.å†™çš„æ¯”è¾ƒå‡Œä¹± æˆ‘ä¼šé€æ¸æé«˜è¿™æ–¹é¢çš„èƒ½åŠ›.å¸Œæœ›å¤§å®¶å¤šå¤šæŒ‡æ•™


[æœ€ç»ˆçš„demo](https://github.com/sunyazhou13/MusicAlbumViewDemo)


å‚è€ƒ

[iOSé«˜ä»¿æŠ–éŸ³app](https://github.com/sunyazhou13/douyin-ios-objectc)





URL: https://sunyazhou.com/2018/11/AwemeTopBottomScrollDemo/index.html.md
Published At: 2018-11-06 17:55:09 +0000

# iOSæŠ–éŸ³çš„ä¸Šä¸‹æ»‘å®ç°

# å‰è¨€ 

ä¸€ç›´ä¸€æ¥éƒ½åœ¨ ç ”ç©¶æŠ–éŸ³Appåšçš„çŸ­è§†é¢‘ ä¸Šä¸‹æ»‘åŠ¨ çš„æŠ€æœ¯å®ç°, ä»Šå¤©å†™äº†ä¸ªdemo,æ–¹ä¾¿å­¦ä¹ æŠ€æœ¯æŠ€å·§å’Œè®°å½•çŸ¥è¯†,


![](/assets/images/20181106AwemeTopBottomScrollDemo/AwemeDemo1.gif)


# æŠ€æœ¯å®ç°åŸç†

* UITableView 


å…¶å®å°±æ˜¯ä¸€ä¸ªUITableViewæ”¹å˜ä¸Šä¸‹æ˜¾ç¤ºèŒƒå›´. talk is cheap show me the code

æˆ‘è¯´è¯ä¸ç»•å¼¯å­,ä»£ç å¦‚ä¸‹ å®ç°èµ·æ¥éå¸¸ç®€å•

``` objc

_tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, -SCREEN_HEIGHT, SCREEN_WIDTH, SCREEN_HEIGHT * 5)];
_tableView.contentInset = UIEdgeInsetsMake(SCREEN_HEIGHT, 0, SCREEN_HEIGHT * 3, 0);

```

1. åˆå§‹åŒ–çš„æ—¶å€™,TableViewæ”¾åœ¨å±å¹•å¤–è¾¹.
2. contentInset æ˜¾ç¤ºå†…å®¹çš„å†…è¾¹è·, ä»¥æ­¤æ˜¯ `ä¸Š`, `å·¦`, `ä¸‹`,  `å³`, ä¸Šè¾¹è· è·ç¦»æ•´å¥½å±å¹•é«˜åº¦,åº•éƒ¨ æ˜¯ é¡¶éƒ¨è¾¹è·(å±å¹•é«˜åº¦çš„ 3å€) æ–¹ä¾¿æ»‘åŠ¨, å·¦å³åˆ†åˆ«é¡¶åˆ°ä¸¤è¾¹ æå®š.

æˆ‘ç”»ä¸ªå›¾æ¼”ç¤ºä¸€ä¸‹.

![](/assets/images/20181106AwemeTopBottomScrollDemo/AwemeDemo2.webp)



çœ‹åˆ°è¿™å¼ å›¾ å¤§å®¶ä¹Ÿè®¸ å·²ç»æ˜ç™½äº†ï¼Œæœ€æ ¸å¿ƒçš„åœ°æ–¹æ˜¯æ§åˆ¶ TableViewçš„ä¸Šä¸‹è¾¹è·,ä¸Šè¾¹è·ç•™å¤Ÿä¸€ä¸ªå±å¹•é«˜åº¦,ä¸‹è¾¹è·ç•™å¤Ÿä¸‹æ»‘3å±å·¦å³çš„ç¼“å†².


# è¯´ä¸€ä¸‹ç”¨åˆ°çš„æŠ€å·§

åˆ›å»ºtableViewå¾ˆç®€å• å¦‚æœç†è§£ä¸äº† å¯ä»¥ä¸‹è½½æ–‡ç« æœ«å°¾demo

æœ‰ä¸ªå°æŠ€å·§æ˜¯ å¦‚ä½•åšåˆ° ä¸Šä¸‹æ»‘åŠ¨ èƒ½å¤Ÿå®Œæ•´çš„ æ»‘åŠ¨åˆ°å¯¹åº”ä½ç½® æ•´å¥½ å æ»¡å±å¹•ç±»ä¼¼ å¼€å¯äº†UIScrollViewçš„ `pagingEnabled`.


## å®ç°æ»‘åŠ¨çš„ä»£ç†æ–¹æ³•

é¦–å…ˆéœ€è¦å£°æ˜ä¸€ä¸ªå½“å‰æ»‘åŠ¨é¡µç çš„æˆå‘˜å˜é‡

``` objc
@property (nonatomic, assign) NSInteger  currentIndex;
```

ç„¶åæ»‘åŠ¨ä»£ç†åœæ­¢çš„æ—¶å€™  åˆ¤æ–­ä¸€ä¸‹

``` objc
#pragma mark -
#pragma mark - ScrollView delegate
- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate{
    dispatch_async(dispatch_get_main_queue(), ^{
        CGPoint translatedPoint = [scrollView.panGestureRecognizer translationInView:scrollView];
        //UITableViewç¦æ­¢å“åº”å…¶ä»–æ»‘åŠ¨æ‰‹åŠ¿
        scrollView.panGestureRecognizer.enabled = NO;
        
        if(translatedPoint.y < -50 && self.currentIndex < (kDataSourceCount - 1)) {
            self.currentIndex ++;   //å‘ä¸‹æ»‘åŠ¨ç´¢å¼•é€’å¢
        }
        if(translatedPoint.y > 50 && self.currentIndex > 0) {
            self.currentIndex --;   //å‘ä¸Šæ»‘åŠ¨ç´¢å¼•é€’å‡
        }
        [UIView animateWithDuration:0.15
                              delay:0.0
                            options:UIViewAnimationOptionCurveEaseOut animations:^{
                                //UITableViewæ»‘åŠ¨åˆ°æŒ‡å®šcell
                                [self.tableView scrollToRowAtIndexPath:[NSIndexPath indexPathForRow:self.currentIndex inSection:0] atScrollPosition:UITableViewScrollPositionTop animated:NO];
                            } completion:^(BOOL finished) {
                                //UITableViewå¯ä»¥å“åº”å…¶ä»–æ»‘åŠ¨æ‰‹åŠ¿
                                scrollView.panGestureRecognizer.enabled = YES;
                            }];
        
    });
}

```


> è¿™é‡Œçš„ `50` å®é™…ä¸Šæ˜¯ä½ èƒ½å…è®¸æ»‘åŠ¨çš„æœ€å¤§è§¦å‘åŒºé—´.å¯ä»¥è‡ªå·±ä¸‹è½½demoç©ä¸€ä¸‹å°±çŸ¥é“äº†. 

åŸºäºæ»‘åŠ¨åŒºé—´ åš åŠ å‡ å½“å‰é¡µç æ§åˆ¶.ç„¶å åšä¸ªç®€å•çš„UIViewåŠ¨ç”».

> æ³¨æ„: å¼€å§‹åŠ¨ç”»çš„æ—¶å€™æœ€å¥½ä¸è¦ç›¸åº”panæ‰‹åŠ¿,ç»“æŸåŠ¨ç”»çš„æ—¶å€™å†æ¢å¤å›å»,è¿™æ ·å¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„æ”¶æ‹¾æ»‘åŠ¨å¼•èµ·çš„é—®é¢˜.


### ä¸ºä»€ä¹ˆè¦æ»‘åŠ¨é¡µç `self.currentIndex`

å› ä¸ºæˆ‘ä»¬è¦ç”¨KVO æ¥å®ç° é¡µé¢å˜åŠ¨é©±åŠ¨æ»‘åŠ¨çš„åŠ¨ç”»

åœ¨ viewDidLoad:æ–¹æ³•ä¸­ æˆ‘ä»¬æœ‰ä¸ªsetupView:æ–¹æ³•ä¸­ æœ‰ä¸‹æ®µä»£ç 

``` objc
[self addObserver:self forKeyPath:@"currentIndex" options:NSKeyValueObservingOptionInitial|NSKeyValueObservingOptionNew context:nil];
```

__æ˜¯çš„æˆ‘ä»¬è¦è‡ªå·±ç›‘å¬è‡ªå·±çš„æˆå‘˜å˜é‡å»æäº›äº‹æƒ…__.

``` objc
//è§‚å¯ŸcurrentIndexå˜åŒ–
-(void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary<NSKeyValueChangeKey,id> *)change context:(void *)context {
    if ([keyPath isEqualToString:@"currentIndex"]) {
        //è·å–å½“å‰æ˜¾ç¤ºçš„cell
        AwemeListCell *cell = [self.tableView cellForRowAtIndexPath:[NSIndexPath indexPathForRow:_currentIndex inSection:0]];
        __weak typeof (cell) wcell = cell;
        __weak typeof (self) wself = self;
        //ç”¨cellæ§åˆ¶ç›¸å…³è§†é¢‘æ’­æ”¾
        
    } else {
        return [super observeValueForKeyPath:keyPath ofObject:object change:change context:context];
    }
}
```

> demoä¸­æœ‰è¿™æ®µä»£ç  å…¶å®æ˜¯ä¸ºäº†ä»¥å cellä¸Šæ–¹palyerViewçš„æ—¶å€™ æ§åˆ¶ç›¸åº”æš‚åœæˆ–è€…åœæ­¢ æˆ–è€…å…¶ä»–æ“ä½œçš„è¡Œä¸º. è¿™é‡ŒåæœŸæˆ‘ä»¬å®Œå–„


### ç‚¹å‡»çŠ¶æ€æ æ»‘åŠ¨åˆ°é¡¶éƒ¨

æˆ‘ä»¬å¦‚ä½•ç›‘å¬çŠ¶æ€æ çš„äº‹ä»¶?

æˆ‘ä»¬å½“ç„¶å¯ä»¥è®¾ç½®TableViewè‡ªåŠ¨æ»‘åŠ¨åˆ°é¡¶éƒ¨.ä½†æ˜¯ æˆ‘ä»¬æ€ä¹ˆæ‹¦æˆªä¸‹æ¥è¿™ä¸ªäº‹ä»¶å»æŠŠæˆ‘ä»¬ ç›¸å…³é¡µç  __ç½®`0`__


ä¸ºä»€ä¹ˆç½®0å‘¢?çœ‹ä¸‹ ä¸‹é¢è¿™å¼ å›¾

![](/assets/images/20181106AwemeTopBottomScrollDemo/AwemeDemo3Error.gif)

è™½ç„¶æˆ‘ä»¬èƒ½å®ç° è‡ªåŠ¨æ»‘åŠ¨TableViewåˆ°é¡¶éƒ¨ ä½†æ˜¯ æˆ‘ä»¬æ‹¦æˆªä¸åˆ°é¡¶éƒ¨çŠ¶æ€æ ç‚¹å‡»çš„äº‹ä»¶,åœ¨è¿™ä¸ªäº‹ä»¶è°ƒç”¨çš„åœ°æ–¹ æŠŠå½“å‰é¡µç ç½®`0`.


#### ç›‘å¬ç‚¹å‡»çŠ¶æ€æ äº‹ä»¶

è¿™é‡Œä½¿ç”¨çš„æ˜¯åœ¨AppDelegate ä¸­ å¤å†™ touchesBagan:æ–¹æ³•

``` objc
- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event {
    [super touchesBegan:touches withEvent:event];
    
    //å½“è§¦æ‘¸çŠ¶æ€æ çš„æ—¶å€™å‘é€è§¦æ‘¸é€šçŸ¥ è¿™æ ·æ§åˆ¶å™¨å°±æ”¶åˆ°äº†ç‚¹å‡»äº‹ä»¶
    CGPoint touchLocation = [[[event allTouches] anyObject] locationInView:self.window];
    CGRect statusBarFrame = [UIApplication sharedApplication].statusBarFrame;
    if (CGRectContainsPoint(statusBarFrame, touchLocation)) {
        [[NSNotificationCenter defaultCenter] postNotificationName:StatusBarTouchBeginNotification object:nil];
    }
}

```

åœ¨è¿™é‡Œæˆ‘ä»¬åˆ¤æ–­ç‚¹å‡»åŒºåŸŸæ˜¯å¦åœ¨çŠ¶æ€æ èŒƒå›´å†…,æ˜¯çš„è¯æˆ‘ä»¬å‘é€é€šçŸ¥.


åœ¨æˆ‘ä»¬ç”¨åˆ°TableViewçš„VCé‡Œé¢æ³¨å†Œè¿™ä¸ªé€šçŸ¥,ç„¶å ç½®`0`.

``` objc
#pragma mark -
#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
- (void)statusBarTouchBegin {
    _currentIndex = 0; //KVO
}

```

è¿™é‡Œæˆ‘ä»¬ç½®`0`å¤„ç†.

> è¿™é‡Œå¤„ç†çš„æ–¹å¼ç®€å•ç²—æš´,ä½ æœ‰æ›´å¥½çš„å®ç°æ–¹å¼å¯ä»¥åº•éƒ¨è¯„è®º,éå¸¸æ„Ÿè°¢.


# æ€»ç»“

ä»¥ä¸Šæ˜¯ç®€å•å®ç°äº†æŠ–éŸ³çš„ä¸Šä¸‹æ»‘,demoåœ¨ä¸‹æ–¹, ä¸‹ä¸€æœŸç»™å¤§å®¶æ¼”ç¤ºæ›´å¤šç»†èŠ‚,å¦‚æœå¯èƒ½çš„è¯,æœ€ç»ˆæå‡ºä¸ªè§†é¢‘æ”¾cellä¸Š å®ç°æ•´ä¸ªä¸Šä¸‹æ»‘æ§åˆ¶è¿‡ç¨‹è§†é¢‘æš‚åœ æ’­æ”¾ åœæ­¢ç­‰ç­‰,å› ä¸ºå¦‚æœå®Œæ•´çš„å®ç°æŠ–éŸ³,éœ€è¦å¾ˆé•¿çš„ä»£ç é‡,ä¸ºäº†è®©å¤§å®¶ä¸€èµ·å­¦ä¹ ,æˆ‘æŠŠæ¯ä¸ªç»†èŠ‚æ‹†æˆä¸€å°èŠ‚.å•ç‹¬å†™æˆæ–‡ç« è®¨è®ºå’Œå­¦ä¹ .


[æŠ–éŸ³ä¸Šä¸‹æ»‘Demo](https://github.com/sunyazhou13/AwemeDemo)

å‚è€ƒå¼€æº

[æŠ–éŸ³ä¸ªäººä¸»é¡µ](https://github.com/sshiqiao/douyin-ios-objectc)




URL: https://sunyazhou.com/2018/10/LabelDanceAnimation/index.html.md
Published At: 2018-10-29 18:13:15 +0000

# iOSæ•°å­—å€æ•°åŠ¨ç”»

# å‰è¨€ 

å†™äº†ä¸€ä¸ªç®€å•çš„åˆ©ç”¨ é€æ˜åº¦å’Œ ç¼©æ”¾ å®ç°çš„ æ•°å­—å€æ•°åŠ¨ç”» 

![demo](/assets/images/20181029LabelDanceAnimation/danceLabel.gif)


# å®ç°æ€è·¯

ä¸Šä»£ç  çœ‹æ¯”è¾ƒæ¸…æ™°

``` objc
// æ•°å­—è·³åŠ¨åŠ¨ç”»
- (void)labelDanceAnimation:(NSTimeInterval)duration {
    //é€æ˜åº¦
    CABasicAnimation *opacityAnimation = [CABasicAnimation animationWithKeyPath:@"opacity"];
    opacityAnimation.duration = 0.4 * duration;
    opacityAnimation.fromValue = @0.f;
    opacityAnimation.toValue = @1.f;
    
    //ç¼©æ”¾
    CAKeyframeAnimation *scaleAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"];
    scaleAnimation.duration = duration;
    scaleAnimation.values = @[@3.f, @1.f, @1.2f, @1.f];
    scaleAnimation.keyTimes = @[@0.f, @0.16f, @0.28f, @0.4f];
    scaleAnimation.removedOnCompletion = YES;
    scaleAnimation.fillMode = kCAFillModeForwards;
    
    CAAnimationGroup *animationGroup = [CAAnimationGroup animation];
    animationGroup.animations = @[opacityAnimation, scaleAnimation];
    animationGroup.duration = duration;
    animationGroup.removedOnCompletion = YES;
    animationGroup.fillMode = kCAFillModeForwards;
    
    [self.comboLabel.layer addAnimation:animationGroup forKey:@"kComboAnimationKey"];
}

```

åˆ©ç”¨ä¸€ä¸ªé€æ˜åº¦ä» 0 ~ 1ä¹‹é—´çš„alpha,ç„¶åç¼©æ”¾ ä¹‹ååŠ åˆ°åŠ¨ç”»ç»„å®ç°ä¸€ä¸‹å°±å¥½äº†

> åˆ‡è®°åŠ¨ç”»å®Œæˆæœ€å¥½ç§»é™¤ å¦åˆ™å¯èƒ½å¼•èµ·åŠ¨ç”»å†…å­˜é—®é¢˜

è¿™é‡Œè®¾ç½®æ–œä½“å­—ä½“

``` objc
self.comboLabel.font = [UIFont fontWithName:@"AvenirNext-BoldItalic" size:50];
```

çœ‹ç€æ¯”è¾ƒæ˜æ˜¾


æœ€åæŒ‰é’®ç‚¹å‡»çš„æ—¶å€™è°ƒç”¨

``` objc
- (IBAction)clickAction:(UIButton *)sender {
    self.danceCount++;
    [self labelDanceAnimation:0.4];
    self.comboLabel.text = [NSString stringWithFormat:@"+  %tu",self.danceCount];
}
```

å¦‚æœå®ç° dozenåŠ¨ç”»çš„è¯å¾ˆç®€å•, __danceCount % 10 == 0__ æ±‚æ¨¡å°±è¡Œäº†.

# æ€»ç»“

è¿™ä¸ªåŠ¨ç”»æ¯”è¾ƒé€‚åˆ æœ‰äº›ç›´æ’­åœºæ™¯çš„ç‚¹å‡»æ“ä½œè®¡æ•°ç›¸å…³.æ„Ÿè°¢è§‚çœ‹


[Demoåœ¨è¿™é‡Œ](https://github.com/sunyazhou13/LiveComboLabel)







URL: https://sunyazhou.com/2018/09/BreathAnimation/index.html.md
Published At: 2018-09-29 10:09:30 +0000

# iOSå‘¼å¸åŠ¨ç”»

# å‰è¨€

å¿«æ”¾å‡äº†, æ€•åä¸€æ–‡ç« æ›´æ–°ä¸åŠæ—¶,æ—©ç‚¹å®Œæˆæ–‡ç« ,ä¿è¯æ¯ä¸ªæœˆ 2ç¯‡çš„äº§å‡ºé‡, ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯ å‘¼å¸åŠ¨ç”», åšçš„ä¸æ˜¯ç‰¹åˆ«å¥½.

ä¸Šå›¾

![](/assets/images/20180929BreathAnimation/breathAnimation.gif)

å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ 


# éœ€æ±‚å’Œå®ç°æ€è·¯


å…·ä½“è¦æ±‚

* å†…éƒ¨å¤´åƒå‘¼å¸æ”¾å¤§ç¼©å° æ— é™å¾ªç¯
* æ¯æ¬¡æ”¾å¤§åŒæ—¶éœ€è¦èƒŒæ™¯è¿˜æœ‰ä¸€å¼ å›¾ä¹Ÿæ”¾å¤§ å¹¶ä¸”é€æ˜
* ç‚¹å‡»ç¼©æ”¾æ•´ä¸ªèƒŒæ™¯è§†å›¾


## å®ç°æ€è·¯

é¦–å…ˆ éœ€è¦ä½¿ç”¨åˆ›å»ºä¸€ä¸ªLayer è£…ç¬¬ä¸€ä¸ªæ— é™æ”¾å¤§ç¼©å°çš„å‘¼å¸çš„å›¾    
èƒŒæ™¯ä¹Ÿéœ€è¦ä¸€ä¸ªLayer åš æ”¾å¤§+é€æ˜åº¦æ¸å˜çš„åŠ¨ç”»ç»„å¹¶ä¸”ä¹Ÿæ”¾ç½®ä¸€å¼ éœ€è¦æ”¾å¤§æ¸å˜çš„å›¾ç‰‡

æœ€åç‚¹å‡»è§¦å‘. æ·»åŠ ä¸€ä¸ªä¸€æ¬¡æ€§çš„ç¼©æ”¾åŠ¨ç”»å³å¯


### å‘¼å¸åŠ¨ç”»layerå’ŒåŠ¨ç”»


å‘¼å¸layer

``` objc
CALayer *layer = [CALayer layer];
layer.position = CGPointMake(kHeartSizeWidth/2.0f, kHeartSizeHeight/2.0f);
layer.bounds = CGRectMake(0, 0, kHeartSizeWidth/2.0f, kHeartSizeHeight/2.0f);
layer.backgroundColor = [UIColor clearColor].CGColor;
layer.contents = (__bridge id _Nullable)([UIImage imageNamed:@"breathImage"].CGImage);
layer.contentsGravity = kCAGravityResizeAspect;
[self.heartView.layer addSublayer:layer];
```
> kHeartSizeHeight å’ŒkHeartSizeWidth æ˜¯å¸¸é‡ demoä¸­å†™å¥½äº†100

åŠ å¸§åŠ¨ç”»

``` objc
CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"];
animation.values = @[@1.f, @1.4f, @1.f];
animation.keyTimes = @[@0.f, @0.5f, @1.f];
animation.duration = 1; //1000ms
animation.repeatCount = FLT_MAX;
animation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut];
[animation setValue:kBreathAnimationKey forKey:kBreathAnimationName];
[layer addAnimation:animation forKey:kBreathAnimationKey];
```

> å·®å€¼å™¨ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ ä¾‹å¦‚:

``` objc

[CAMediaTimingFunction functionWithControlPoints:0.33 :0 :0.67 :1]

```

è¿™é‡Œæˆ‘åšçš„æŒç»­æ—¶å¸¸1ç§’ 

### æ”¾å¤§æ¸å˜åŠ¨ç”»group

åˆ›å»ºæ–°layer

``` objc
CALayer *breathLayer = [CALayer layer];
breathLayer.position = layer.position;
breathLayer.bounds = layer.bounds;
breathLayer.backgroundColor = [UIColor clearColor].CGColor;
breathLayer.contents = (__bridge id _Nullable)([UIImage imageNamed:@"breathImage"].CGImage);
breathLayer.contentsGravity = kCAGravityResizeAspect;
[self.heartView.layer insertSublayer:breathLayer below:layer];
//[self.heartView.layer addSublayer:breathLayer];

```

> è¿™é‡Œç”¨çš„æ˜¯æ”¾åœ¨ å‘¼å¸layeråè¾¹ å¦‚æœæƒ³æ”¾åœ¨å‘¼å¸layerå‰è¾¹ å°±æŠŠé‡Œé¢æ³¨é‡Šæ‰“å¼€ ç„¶åæ³¨æ‰ inerté‚£è¡Œä»£ç 

åŠ¨ç”»ç»„ åŒ…å« æ”¾å¤§ æ¸å˜


``` objc
//ç¼©æ”¾
CAKeyframeAnimation *scaleAnimation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"];
scaleAnimation.values = @[@1.f, @2.4f];
scaleAnimation.keyTimes = @[@0.f,@1.f];
scaleAnimation.duration = animation.duration;
scaleAnimation.repeatCount = FLT_MAX;
scaleAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];
//é€æ˜åº¦
CAKeyframeAnimation *opacityAnimation = [CAKeyframeAnimation animation];
opacityAnimation.keyPath = @"opacity";
opacityAnimation.values = @[@1.f, @0.f];
opacityAnimation.duration = 0.4f;
opacityAnimation.keyTimes = @[@0.f, @1.f];
opacityAnimation.repeatCount = FLT_MAX;
opacityAnimation.duration = animation.duration;
opacityAnimation.timingFunction = [CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseIn];

//åŠ¨ç”»ç»„
CAAnimationGroup *scaleOpacityGroup = [CAAnimationGroup animation];
scaleOpacityGroup.animations = @[scaleAnimation, opacityAnimation];
scaleOpacityGroup.removedOnCompletion = NO;
scaleOpacityGroup.fillMode = kCAFillModeForwards;
scaleOpacityGroup.duration = animation.duration;
scaleOpacityGroup.repeatCount = FLT_MAX;
[breathLayer addAnimation:scaleOpacityGroup forKey:kBreathScaleName];
```

### ç‚¹å‡»ç¼©æ”¾åŠ¨ç”»

è·Ÿç¬¬ä¸€ä¸ªä¸€æ · åªä¸è¿‡ æ‰§è¡Œæ¬¡æ•°é»˜è®¤ä¸€æ¬¡ æ‰§è¡Œå®Œå°±å¯ä»¥äº†

``` objc
- (void)shakeAnimation {
    CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@"transform.scale"];
    animation.values = @[@1.0f, @0.8f, @1.f];
    animation.keyTimes = @[@0.f,@0.5f, @1.f];
    animation.duration = 0.35f;
    animation.timingFunctions = @[[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut],[CAMediaTimingFunction functionWithName:kCAMediaTimingFunctionEaseInEaseOut]];
    [self.heartView.layer addAnimation:animation forKey:@""];
}

```

æ‰‹åŠ¿è§¦å‘çš„æ—¶å€™ è°ƒç”¨ä¸€ä¸‹


### é‡åˆ°çš„é—®é¢˜

åœ¨å¼€å‘åŠ¨ç”»çš„æ—¶å€™é‡åˆ° éƒ½ä¸€ä¸ªåŠ¨ç”» è¦æ‰§è¡Œ å‘¼å¸ 

å‘¼å¸å¦‚æœduration åˆ°ä¸­é—´çš„è¯ æ¯”å¦‚1ç§’ é‚£ä¹ˆ0.5ç§’çš„æ—¶å€™ å®ƒå°±éœ€è¦æŠ˜å› 

é‚£ä¹ˆç¬¬äºŒä¸ªåŠ¨ç”»åˆšåˆšæ‰§è¡Œåˆ°ä¸€åŠ,å°±ä¼šæ„Ÿè§‰å¾ˆå¥‡æ€ª

![](/assets/images/20180929BreathAnimation/aniamation.webp)


å¦‚æœ__æ¸å˜åŠ¨ç”»__æ‰§è¡Œ0.5ç§’çš„è¯ å®ƒæ˜¯é‡å¤çš„ é‚£ä¹ˆä»–å°±é‡æ–°å¼€å§‹ ç›¸å½“äº å‘¼å¸æŠ˜å›çš„æ—¶å€™å®ƒåˆé‡æ–°å¼€å¼€å§‹æ¸å˜

#### æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

æˆ‘ä»¬æŠŠ0.5ç§’çš„åŠ¨ç”»åŠ åˆ° åŠ¨ç”»ç»„é‡Œé¢,ç„¶åç»™åŠ¨ç”»ç»„è®¾ç½®çš„æ—¶é•¿ä¿æŒå’Œå‘¼å¸åŠ¨ç”» ä¸€æ ·,è¿™æ ·å‰©ä½™çš„0.5çš„æ—¶å€™ æ¸å˜åŠ¨ç”»æ˜¯ä¸ä¼šé‡æ–°å¼€å§‹çš„.


# æ€»ç»“

åŠ¨ç”»å¾ˆä¹…æ²¡ç©äº† åŸºæœ¬éƒ½å¿˜äº†ä¸€å¹²äºŒå‡€äº†,ä»¥åè¦å‹¤åŠ ç»ƒä¹ ,å¤šå‡ºæ–‡ç« å’Œdemo,è®°å½•ä¸€äº›æ›´å¤šçš„çŸ¥è¯†æŠ€å·§.

åšå®¢åƒè½¦ä¸€æ ·,è¦æ˜¯ä¸æ˜¯çš„æ—¶å€™ç»å¸¸ä¿å…»,æ‰èƒ½èµ°æ›´è¿œçš„è·¯,è®°å½•æ›´å¤šçš„ç¾å¥½.

å…¨æ–‡å®Œ

[Demoåœ¨è¿™é‡Œä¸‹è½½](https://github.com/sunyazhou13/BreathAnimation)


URL: https://sunyazhou.com/2018/09/IncreasingTapAreaOfButton/index.html.md
Published At: 2018-09-20 09:40:06 +0000

# iOSæ‰©å¤§UIButtonçš„ç‚¹å‡»çš„å“åº”èŒƒå›´

# å‰è¨€

å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸é‡åˆ°`UIButton`ç‚¹å‡»åŒºåŸŸå¤ªå° åˆä¸æƒ³ æ”¹åŠ¨æŒ‰é’®çš„å¤§å°.

ä»Šå¤©çš„æ–‡ç« å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹è§£å†³è¿™ç§é—®é¢˜çš„ä»£ç 


# å®ç°æ€è·¯

* å­ç±»è¯UIButton å¤å†™ å®ƒçš„`hitTest:`æ–¹æ³•
* å­ç±»è¯UIButton å¤å†™ point:inside:withEvent: æ–¹æ³•


## ç¬¬ä¸€ç§æ–¹å¼

``` swift
override func hitTest(_ point: CGPoint, with event: UIEvent?) -> UIView? {
	let biggerButtonFrame = theButton.frame.insetBy(dx: -30, dy: -30) // 1	
	if biggerButtonFrame.contains(point) { // 2
		return theButton // 3
	}		
	return super.hitTest(point, with: event) // 4
}

```


* 1. è®©theButtonçš„ x æ‰©å¤§ 30, y æ‰©å¤§ 30 (æ­£æ•°ä¸ºç¼©å° è´Ÿæ•°ä¸ºæ”¾å¤§. ç„¶åå®½é«˜ åˆ†åˆ«æ˜¯2 * 30å’Œ 2 * 30)
* 2. åˆ¤æ–­ç‚¹å‡»çš„ä½ç½®æ˜¯å¦åœ¨æ”¾å¤§å®Œçš„frameå†….
* 3. å¦‚æœæ˜¯ å°±è¿”å›button
* 4. ä¸æ˜¯çš„è¯è®©äº‹ä»¶ç»§ç»­ä¼ é€’


> æ³¨æ„:_è¿™é‡Œæ²¡åˆ¤æ–­ theButton.alpha == 0 å’Œ theButton.userInterface.. ==  YES è¿˜æœ‰å®ƒæ˜¯å¦å¯è§ä¹‹ç±»çš„,è¯·è‡ªè¡Œåˆ¤æ–­_

## ç¬¬äºŒç§æ–¹å¼


å¤å†™UIViewçš„point:æ–¹æ³•

``` swift
override func point(inside point: CGPoint, with event: UIEvent?) -> Bool {
	let biggerFrame = bounds.insetBy(dx: -30, dy: -30)

	return biggerFrame.contains(point)
}
```


OCçš„ç‰ˆæœ¬æ˜¯è¿™æ ·

``` objc
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event {
	//è¿™é‡Œå†™ä¸Š 
	
	CGRectInset(<#CGRect rect#>, <#CGFloat dx#>, <#CGFloat dy#>)
	...
}
```


ä½†æ˜¯ ç¬¬äºŒç§æ–¹å¼ å…¶å® æ˜¯ hitTest:æ–¹æ³•è°ƒç”¨ä¹‹å‰UIViewçš„åˆ¤æ–­,å®ƒåˆ¤æ–­å½“å‰ç‚¹å‡»çš„pointæ˜¯å¦åœ¨è¿™ä¸ªUIViewä¸Š.

ä¸è¿‡ è¿˜æ˜¯æ¨èç¬¬ä¸€ç§æ–¹å¼


## æ ¸å¿ƒä»£ç 


å…¶å® æœ€æ ¸å¿ƒçš„ä»£ç æ˜¯


CGRectInset(<#CGRect rect#>, <#CGFloat dx#>, <#CGFloat dy#>)


> CGRect CGRectOffset(CGRect rect, CGFloat dx, CGFloat dy)æ˜¯ä»¥rectä¸ºä¸­å¿ƒï¼Œæ ¹æ®dxå’Œdyæ¥å®ç°ç¼©å°ã€‚

å¦‚æœdx å’Œ dyæ˜¯è´Ÿæ•° åˆ™æ”¾å¤§ ,æ­£æ•°åˆ™ç¼©å°

ä½†æ˜¯å¤§å®¶å¯èƒ½å¾ˆç–‘æƒ‘ é‚£å®½åº¦å’Œé«˜åº¦æ€ä¹ˆ ç¼©å°æ”¾å¤§


é¦–å…ˆ: æˆ‘ä»¬æ˜ç¡® è¿™ä¸ªAPIçš„å«ä¹‰ åªè¦ä¼ å…¥æ­£æ•° å®ƒå°±ç¼©æ”¾ é‚£ä¹ˆ å®½é«˜ä¹Ÿä¼šé€‚å½“å‰ä¼ å…¥çš„dxå’Œdyæ¥å†³å®š ç¼©æ”¾æ¯”

å› ä¸ºæ˜¯ä¸­å¿ƒç‚¹ç¼©æ”¾ æ‰€ä»¥å®½é«˜ __è¦ X 2__,å› ä¸ºæœ‰ä¸¤ä¾§å˜›,å·¦ä¾§ç¼©å°30å³ä¾§ä¹Ÿéœ€è¦ç¼©å°30,ä¸Šéƒ¨å’Œåº•éƒ¨æ˜¯ä¸€æ ·çš„.


å¤§å®¶å¯è‡ªè¡ŒæŸ¥é˜…googleçœ‹ä¸‹



[å‚è€ƒIncreasing the tap area of a UIButton](https://rolandleth.com/increasing-the-tap-area-of-a-uibutton)  
[å‚è€ƒ iOSè§¦æ‘¸äº‹ä»¶å…¨å®¶æ¡¶](https://mp.weixin.qq.com/s/9rvSRt4kfpy7e87EJoaJOQ)

å…¨æ–‡å®Œ







URL: https://sunyazhou.com/2018/09/KeyboardAnimation/index.html.md
Published At: 2018-09-18 09:49:58 +0000

# iOSé”®ç›˜åŠ¨ç”»ç»†èŠ‚

![](/assets/images/20180918KeyboardAnimation/keyboard1.webp)


# å‰è¨€

å¾ˆä¹…æ²¡å†™æŠ€æœ¯æ–‡ç« é‡Œ,æœ¬ç¯‡è®°å½•äº†ä¸€ä¸‹ä¸€ä¸ªé”®ç›˜å¼¹å‡ºçš„å°ç»†èŠ‚åŠ¨ç”»,åƒå¾®ä¿¡ä¸€æ ·æµç¨‹


ä¸Šå›¾

![](/assets/images/20180918KeyboardAnimation/keyboardAnimation.gif)



# åŠ¨ç”»ç»†èŠ‚ä»£ç 


ç»†èŠ‚æ ¸å¿ƒä¸»è¦æ˜¯é€šçŸ¥ä¸­çš„ä¸€äº›key

* åŠ¨ç”»æ—¶é•¿
* åŠ¨ç”»çš„å‡ºç°æ–¹å¼

...

ä¸‹é¢çš„é€šçŸ¥æ˜¯æ¥æ”¶ é”®ç›˜å°†è¦å‡ºç°çš„é€šçŸ¥`UIKeyboardWillShowNotification`



``` objc
[[NSNotificationCenter defaultCenter] addObserver:self
                                             selector:@selector(didReceiveKeyboardShowNotification:)
                                                 name:UIKeyboardWillShowNotification
                                               object:nil];
```

ç„¶åæ˜¯å®ç°çš„æ ¸å¿ƒä»£ç 

``` objc
- (void)didReceiveKeyboardShowNotification:(NSNotification *)noti {
    NSDictionary *userInfo = noti.userInfo;
    NSTimeInterval animationDuration;
    UIViewAnimationCurve animationCurve;
    CGRect keyboardFrame;
    [[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] getValue:&animationCurve];
    [[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] getValue:&animationDuration];
    [[userInfo objectForKey:UIKeyboardFrameEndUserInfoKey] getValue:&keyboardFrame];
    
    UIViewAnimationOptions animationOptions = animationCurve << 16;
    
    self.bottomConstrains.offset = -CGRectGetHeight(keyboardFrame);
    [UIView animateWithDuration:animationDuration delay:0. options:animationOptions animations:^{
        [self.view setNeedsUpdateConstraints];
        [self.view layoutIfNeeded];
    } completion:^(BOOL finished) {
        
    }];
}
```

> self.bottomConstrains.offset = -CGRectGetHeight(keyboardFrame); æ˜¯æˆ‘å†™çš„çº¦æŸ è¯¦ç»†è¯·å‚è€ƒdemo


é”®ç›˜æ¶ˆå¤±ä¹Ÿæ˜¯ä¸€æ ·çš„ `UIKeyboardWillHideNotification` æ¥æ”¶è¿™ä¸ªkey

``` objc
[[NSNotificationCenter defaultCenter] addObserver:self
                                             selector:@selector(didReceiveKeyboardHideNotification:)
                                                 name:UIKeyboardWillHideNotification
                                               object:nil];
```


æ¶ˆå¤±çš„æ—¶å€™ æŠŠçº¦æŸåç§»é‡è®¾ç½®`0`å³å¯

``` objc
- (void)didReceiveKeyboardHideNotification:(NSNotification *)noti {
    NSDictionary *userInfo = noti.userInfo;
    NSTimeInterval animationDuration;
    UIViewAnimationCurve animationCurve;
    CGRect keyboardFrame;
    [[userInfo objectForKey:UIKeyboardAnimationCurveUserInfoKey] getValue:&animationCurve];
    [[userInfo objectForKey:UIKeyboardAnimationDurationUserInfoKey] getValue:&animationDuration];
    [[userInfo objectForKey:UIKeyboardFrameEndUserInfoKey] getValue:&keyboardFrame];
    
    UIViewAnimationOptions animationOptions = animationCurve << 16;
    self.bottomConstrains.offset = 0;
    [UIView animateWithDuration:animationDuration delay:0. options:animationOptions animations:^{
        [self.view setNeedsUpdateConstraints];
        [self.view layoutIfNeeded];
    } completion:^(BOOL finished) {
        
    }];
}
```

> self.bottomConstrains.offset = 0; //è®¾ç½®åç§»é‡ä¼šåŸæ¥ä½ç½®



åˆ©ç”¨Masonryåšçš„åŠ¨ç”»


æœ€å åˆ«å¿˜è®°ç§»é™¤é€šçŸ¥


``` objc
- (void)dealloc {
    [[NSNotificationCenter defaultCenter] removeObserver:self];
}
```


# æ€»ç»“


é”®ç›˜å¼¹å‡ºè¿™ä¸ªå¾®å°çš„ç»†èŠ‚ å¾ˆå®¹æ˜“è¢«å¤§å®¶å¿½è§†,å†™è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºäº†è®°å½•çŸ¥è¯†å’ŒæŠ€å·§,å¸Œæœ›å„ä½å¤šå¤šæŒ‡æ•™


[Demoç‚¹å‡»è¿™é‡Œä¸‹è½½](https://github.com/sunyazhou13/KeyboardAnimation)

å…¨æ–‡å®Œ





URL: https://sunyazhou.com/2018/09/Beacon/index.html.md
Published At: 2018-09-02 12:12:51 +0000

# èˆ¹ä¸ç¯å¡”

# å‰è¨€

![](/assets/images/20180902Beacon/beacon.webp)


è·å…°ğŸ‡³ğŸ‡±è¢«ç§°ä¸º"æµ·ä¸Šé©¬è½¦å¤«"ï¼Œä»Šå¤©è®²è¿°çš„æ•…äº‹ä¸æµ·ä¸Šé©¬è½¦å¤«çš„æœ‰å…³çš„çˆ±æƒ…æ•…äº‹ï¼Œä½†å®ƒå±äºä¸œæ–¹ï¼Œå±äºä¸­å›½ã€‚


# èˆ¹ğŸš¢

å®ƒæ˜¯ä¸€æœå°èˆ¹ï¼Œèˆ¹ä¸Šæœ‰ä¸¤åªèˆ¹æ¡¨ï¼Œè¿™è‰˜èˆ¹ä»é©¶å‡ºé€ èˆ¹å‚çš„æ—¶å€™ï¼Œå°±è¢«å®šä¹‰ä¸ºæ™®é€šè´§ç‰©è¿è¾“èˆ¹åªï¼Œè½½é‡ä¸è¶…è¿‡1å¨ï¼Œé€ è¿™è‰˜èˆ¹çš„ä¸»äººå¸Œæœ›èƒ½é è¿™åªèˆ¹å…»å®¶ç³Šå£ï¼Œä½†åˆèˆä¸å¾—èŠ±æ›´å¤šçš„é’±ä¹°å¥½çš„æœ¨æ–™æ¥åˆ¶é€ å®ƒã€‚

# ç¯å¡”

è¿™æ˜¯ä¸€åº§é›†æˆå¾ˆå¤šé«˜æ–°ç§‘æŠ€çš„ç¯å¡”ï¼Œå¡”åŸºå¯ä»¥åœ¨æµ·ä¸Šæ¼‚æµ®ï¼Œè‡ªåŠ¨å¹³è¡¡ç³»ç»Ÿè®©ä»–åœ¨æµ·æµªçš„åŠ¨è¡ä¸­ç¨³å¦‚æ³°å±±ï¼Œç¯å¡”çš„çˆ¶æ¯è·ç¦»è¿™åº§æ–°çš„ç¯å¡”ä¸è¿œï¼Œå½¢æˆæµ·ä¸Šç¯å¡”ç¾¤ï¼Œå‘å‡ºå¾ˆå¼ºçš„æ¿€å…‰æŸï¼ŒæŒ‡æ˜èˆªçº¿æ–¹å‘ï¼Œè¿™åæ–°çš„ç¯å¡”è¿˜èƒ½å‘å‡ºåŠ å¯†çš„æ— çº¿ç”µä¿¡å·ï¼Œè¿™åº§ç¯å¡”é€šè¿‡è‡ªèº«çš„å¤ªé˜³èƒ½å¤–å£³å’Œé£åŠ›å‘ç”µæœºæä¾›ç”µåŠ›ï¼Œè¿˜èƒ½é€šè¿‡åè½äºæ¸¯å£æµ·å²¸çº¿çš„çˆ¶æ¯ç¯å¡”ç¾¤æ— çº¿ä¼ è¾“ç”µåŠ›ç»™è‡ªå·±å……ç”µã€‚åªè¦å¥¹è§‰å¾—ç”µåŠ›ä¸è¶³ï¼Œå¥¹å°±å¯ä»¥ç§»åŠ¨å›çˆ¶æ¯ç¯å¡”ç¾¤çš„æ— çº¿å……ç”µæœ‰æ•ˆèŒƒå›´è¡¥å……èƒ½é‡ï¼Œåœ¨ä¼—å¤šç¯å¡”ç¾¤ä¸­ï¼Œæœ‰ä¸¤åº§åœ°é¢ç¯å¡”ä¸ºå¥¹æä¾›ç¨³å®šçš„ç”µåŠ›è¾“é€ã€‚è¿™åº§ç¯å¡”å¾ˆå¹¸ç¦ã€‚ä½†è¿™åº§ç¯å¡”å–œæ¬¢æ¸¸å¼‹åœ¨è·ç¦»çˆ¶æ¯ç¯å¡”ä¸è¿œçš„æµ…æµ·åŒºï¼Œè·ç¦»ç¯å¡”ä¸è¶…è¿‡å‡ æµ·é‡Œçš„èŒƒå›´å†…ã€‚

# é‚‚é€…é‚£åªèˆ¹

åŒåœ¨æµ…æµ·åŒºï¼Œæœ‰ä¸€å¤©è¿™åªèˆ¹åœ¨æµ·ä¸Šçš„ä¸€æ¬¡é£æ€¥æµªé«˜çš„å¤œæ™šè¿·å¤±äº†æ–¹å‘ï¼Œé‚£åªç§»åŠ¨çš„ç¯å¡”å‘ç°äº†å®ƒï¼Œå¹¶å›åº”äº†ç¯å…‰äº¤æ¢ä¿¡ä»¤ï¼Œæ¸æ¸åœ°ï¼Œè¿™è‰˜èˆ¹èƒ½è¯†åˆ«è¿™ä¸ªç¯å¡”å‘å‡ºçš„ç¯å…‰æŸï¼Œèˆ¹æ¸æ¸åœ°å–œæ¬¢ä¸Šäº†è¿™åº§ç§»åŠ¨çš„ç¯å¡”ï¼Œè¿™åº§ç¯å¡”ä¹Ÿå¾ˆé’¦ä½©è¿™è‰˜èˆ¹ï¼Œä»–èƒ½åœ¨å¦‚æ­¤å¤§çš„é£æµªä¸­å±¹ç«‹ä¸æ²‰ï¼Œå¯æ˜¯èˆ¹è‡ªå·±æ·±æ·±åœ°çŸ¥é“ï¼Œè‡ªå·±æ˜¯è½½è´§èˆ¹ï¼Œåªæœ‰é€šè¿‡æ‹‰æ›´å¤šçš„è´§æ‰èƒ½è®©ä¸»äººæŠŠè‡ªå·±æ”¹é€ æˆæ›´å¤§çš„èˆ°èˆ¹ï¼Œç¯å¡”çœ‹å‡ºäº†èˆ¹çœ¼ä¸­çš„è¿·èŒ«ï¼Œè¯´:"ä½ å¯ä»¥ç•™åœ¨æµ…æµ·åŒºï¼Œæ‹‰ç€æ™®é€šçš„è´§ç‰©ï¼Œæˆ‘çš„ç¯å¡”çˆ¶æ¯é‚£é‡Œæ˜¯ä¸€åº§æ¸¯å£ï¼Œä»–ä»¬ä¹Ÿè®¸æœ‰äº›å°çš„è´§ç‰©å¯ä»¥ç»™ä½ "ï¼Œèˆ¹å¿ƒé‡Œä¹Ÿå¾ˆæƒ³ç•™åœ¨è¿™åº§ç¯å¡”é™„è¿‘çš„æ¸¯å£åšä¸€äº›æ™®é€šçš„è´§ç‰©è¿è¾“ï¼Œå¯æ˜¯èˆ¹å‡ºèº«å¯’å¾®ï¼Œæ€•è¢«ç¯å¡”çˆ¶æ¯çœ‹ä¸èµ·ï¼ŒåŠ ä¹‹è¿™åº§æ¸¯å£çš„è´¸æ˜“å¾ˆä¸é€æ˜ï¼Œåªæœ‰æœ‰å…³ç³»çš„èˆ¹æ‰èƒ½å¾—åˆ°å¥½çš„è´§ç‰©ï¼Œèˆ¹çš„è‡ªå°Šå¿ƒå—åˆ°äº†æå¤§æ‰“å‡»ï¼Œå†³å¿ƒä¸€å®šè¦æˆä¸ºä¸€è‰˜æ——èˆ°ï¼Œæ‰æœ‰èµ„æ ¼å»è¿™åº§æ¸¯å£æ‹‰é‡è¾¾å‡ åå¨çš„é›†è£…ç®±ï¼Œå»èµ¢å¾—ç¯å¡”çˆ¶æ¯å’Œç¯å¡”çš„å°Šé‡ã€‚å°±è¿™æ ·é‚£å¤©çš„é£æµªè¿‡åï¼Œèˆ¹ç¦»å¼€äº†è¿™åº§ç¯å¡”ï¼Œå»äº†å¾ˆå¤šåƒè¿™åªå°èˆ¹ç»„æˆçš„å°èˆ¹ç¾¤é˜Ÿã€‚

# æµ·ä¸Šæ¼‚æ³Š

åœ¨å¤§æµ·ä¸Šè¿é€å®Œå…¨è¶…è½½çš„è´§ç‰©ï¼Œè¿‡ç€æ¼‚æµçš„ç”Ÿæ´»ï¼Œä¸¾ç›®æ— äº²ï¼ŒèƒŒäº•ç¦»ä¹¡ï¼Œç”±äºæ¯æ¬¡éƒ½æ‹‰è¶…è½½çš„è´§ç‰©ï¼Œèˆ¹æ¯æ¬¡éƒ½æ‰“è‚¿è„¸å……èƒ–å­çš„è¿è‡ªå·±è¿ä¸åŠ¨çš„è´§ç‰©ï¼Œæ¯æ¬¡è§¦ç¤éƒ½æ’å¾—éä½“é³ä¼¤ï¼Œæ¸æ¸åœ°èˆ¹å­¦ä¼šäº†è‡ªæˆ‘ä¿®å¤å’Œç–—ä¼¤ï¼Œå°±è¿™æ ·èˆ¹çš„ä¸»äººèµšäº†ç¬¬ä¸€æ¡¶é‡‘ï¼Œæ‰“ç®—æ”¹é€ å‡çº§è¿™è‰˜æœ¨èˆ¹ï¼ŒæŠŠä»–å˜æˆä¸€è‰˜é“ç”²èˆ°èˆ¹ï¼Œå»æ‰äº†åŒæ¡¨ï¼Œè¿˜ç”¨å‘åŠ¨æœºæä¾›åŠ¨åŠ›ï¼Œè¿™è‰˜èˆ¹çš„ç¯å…‰ç³»ç»Ÿä¸çŸ¥ä¸ºä½•ï¼Œå¯¹é‚£åº§ç¯å¡”å‘å‡ºçš„å…‰æœ‰ä¸€ç§ç‰¹æ®Šçš„èƒ½åŠ›ï¼Œè¯†åˆ«ç‡èƒ½è¾¾åˆ°200%.å¯æ˜¯å¯¹å…¶å®ƒç¯å¡”çš„å…‰æŸè¯†åˆ«åŸºæœ¬50%éƒ½è¾¾ä¸åˆ°ï¼Œèˆ¹ä¸»äººå¯¹è¿™å¥—ç¯å…‰ç³»ç»Ÿç®€ç›´é£Ÿä¹‹æ— ç”¨å¼ƒä¹‹å¯æƒœã€‚å¯æ˜¯èˆ¹è‡ªå·±æ»¡è¶³ï¼ŒçŸ¥é“ç¯å…‰è¯†åˆ«ç³»ç»Ÿè¿˜åœ¨æˆ‘å°±ä¸ä¼šå¤±å»æ–¹å‘ï¼Œæˆ‘å°±èƒ½è¿é€æ›´é‡çš„è´§ç‰©ï¼Œæˆ‘å°±èƒ½çœ‹åˆ°é‚£åº§ç¯å¡”ï¼Œé‚£åº§æ‚¬æµ®çš„ç¯å¡”ã€‚

åˆšè´§è¿ä¸ä¹…ï¼Œèˆ¹ç»™ç¯å¡”å‘å‡ºäº†æ— çº¿ç”µä¿¡å·ï¼Œè¯·æ±‚ç¯å¡”èƒ½å¦å’Œå¥¹ä¸€æ ·æ¥è¿™åº§å¤§çš„æ¸¯å£æŒ‡åæ–¹å‘ï¼Œèˆ¹å†…å¿ƒæ˜¯æ²¡æœ‰åº•çš„ï¼Œä¸çŸ¥é“æ–°çš„æ¸¯å£æ˜¯å¥½æ˜¯åï¼Œåªæ˜¯è¿™é‡Œçš„è´¸æ˜“å¾ˆå‘è¾¾å¯ä»¥ç§¯ç´¯æ›´å¤šèµ„æœ¬ï¼Œç¯å¡”å‘æ¥åé¦ˆä¿¡å·ï¼Œè¡¨è¾¾äº†ç¯å¡”ä¸æƒ³æ¥åˆ°æ–°æ¸¯å£çš„æ„æ„¿ï¼Œèˆ¹å¾ˆä¼¤å¿ƒï¼Œä¹Ÿå¾ˆæ— åŠ©ï¼Œä¼¤å¿ƒçš„æ˜¯è‡ªå·±å¤ªå¼±å°ï¼Œæ— åŠ©çš„æ˜¯å°±ç®—ç¯å¡”æ¥äº†èˆ¹ä¹Ÿç»™ä¸äº†ç¯å¡”éœ€è¦çš„ä¸€åˆ‡ç”µåŠ›å’Œå¸Œæœ›ã€‚ä¸è¿‡èˆ¹å†…å¿ƒæ²¡æœ‰æ”¾å¼ƒï¼Œåªè¦åŠªåŠ›æ‰èƒ½å¾—åˆ°é‚£äº›éœ€è¦çš„ä¸€åˆ‡ã€‚

ç¬¬ä¸€æ¬¡è¿é€è´§ç‰©å›åˆ°æ¸¯å£ï¼Œèˆ¹èº«å·²ç»ä»æœ¨æ¿æ¢æˆäº†è½»å‹é“ç”²ï¼Œå¯ä»¥è¿è½½ä¸è¶…è¿‡10å¨çš„è´§ç‰©ï¼Œå½“ä»–ç¬¬ä¸€æ¬¡å›åˆ°æ¸¯å£æ—¶ï¼Œç¯å…‰ç³»ç»Ÿè¯†åˆ«é‚£åº§ç¯å¡”å‘å‡ºçš„å…‰æŸå¾ˆç²¾å‡†ï¼Œç”šè‡³å…‰çš„è‰²å½©éƒ½å¯ä»¥æ¨¡æ‹Ÿå˜æ¢ï¼Œç”¨èˆ¹çš„å¿ƒé‡Œè¯è¯´ï¼Œæˆ‘ç”šè‡³å¯ä»¥è¯†åˆ«é‚£åº§ç¯å¡”å…‰é—ªçƒå¿«æ…¢ï¼Œé—ªçƒæ¬¡æ•°åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆæ„æ€ï¼Œä»¥åŠæœ€é‡è¦çš„æ˜¯æˆ‘èƒ½è§£å¯†å‡ºå¥¹å‘å‡ºçš„åŠ å¯†ä¿¡å·ã€‚é‚£åº§ç¯å¡”ä¹Ÿå¾ˆé«˜å…´ï¼Œé‚£è‰˜å¾ˆä¸ä¸€æ ·çš„èˆ¹å›åº”å¥¹çš„é€Ÿåº¦å¾ˆå¿«å¾ˆç²¾å‡†ï¼Œä¹Ÿè®¸è¿™åº§ç¯å¡”çš„å…‰çº¿ä¸“ä¸ºé‚£è‰˜èˆ¹è€Œå‘ã€‚

èˆ¹åœé åœ¨æ¸¯å£ä¸€å‘¨æ—¶é—´ï¼Œç„¶ååˆè¦å†ä¸€æ¬¡çš„å‡ºæµ·èˆªè¡Œï¼Œèˆ¹è¿™ä¸€å‘¨æƒ³äº†å¾ˆå¤šï¼Œ"æˆ‘çºµç„¶èƒ½è¿é‡10å¨çš„è´§ç‰©ï¼Œå¯æ˜¯é©¬è¾¾è¿˜è¾¾ä¸åˆ°æŒ‡å®šçš„èŠ‚æ•°ï¼Œé€Ÿåº¦ä¸å¤Ÿå¿«"(èŠ‚ æ˜¯æŒ‡èˆ¹åªèˆªè¡Œé€Ÿåº¦çš„å•ä½ï¼Œç±»ä¼¼æ±½è½¦çš„é©¬åŠ›æ˜¯å¤šå°‘åŒ¹)ï¼Œå°±è¿™æ ·é“åˆ«äº†ç¯å¡”åˆå¼€å§‹æ‰¬å¸†èµ·èˆªã€‚

åœ¨æµ·ä¸Šèˆªè¡Œçš„æ—¶å€™ï¼Œèˆ¹ä¸€ç›´æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒè¿™äº›ç¾å¥½ï¼Œæ˜¯å› ä¸ºè¿‡ä¸Šæ›´å¥½çš„ç”Ÿæ´»å—ï¼Ÿæ˜¯ä¸ºäº†æŠŠè‡ªèº«æ‰“é€ æˆæ——èˆ°å»æ‹‰è´§å—ï¼Ÿè¿˜æ˜¯å› ä¸ºè´«ç©·æˆ‘éœ€è¦è‡ªæˆ‘æ•‘èµçš„è„±è´«è‡´å¯Œï¼Ÿ

åœ¨èˆªè¡Œä¸­ï¼Œèˆ¹ä¼šé—´éš”ä¸€å®šæ—¶é—´ç»™ç¯å¡”å‘é€æ— çº¿ç”µæ³¢ï¼Œä»è€Œè¯æ˜ä»–çš„å­˜åœ¨ã€‚

åœ¨èˆªè¡Œçš„å‡ å¹´ä¸­ï¼Œç¯å¡”å¾ˆå­¤ç‹¬ï¼Œèˆ¹ä¹Ÿä¸€æ ·å­¤ç‹¬ï¼Œçªç„¶æœ‰ä¸€å¤©èˆ¹ä»å…¶å®ƒèˆ¹é‚£é‡Œå¾—çŸ¥ç¯å¡”æ—è¾¹å‡ºç°äº†ä¸€åº§æ–°çš„ç¯å¡”ï¼Œèˆ¹ä¼¤å¿ƒäº†ï¼Œè‡ªå·±æ²¡æœ‰æœºä¼šå»ç¯å¡”çˆ¶æ¯é‚£é‡Œèµ¢å¾—ä»–ä»¬çš„å°Šé‡äº†ï¼Œäºæ˜¯èˆ¹å¸è½½äº†æ—§çš„ç¯å…‰è¯†åˆ«ç³»ç»Ÿï¼Œå¸è½½äº†æ— çº¿ç”µå°æ”¶å‘å™¨ã€‚ç›´åˆ°ä¸€æ®µæ—¶é—´ä»¥åèˆ¹æ¢ä¸Šäº†æ–°çš„æ— çº¿ç”µå°å’Œç¯å…‰ç³»ç»Ÿï¼Œä»å…‰è°±ä¸­åˆ é™¤äº†é‚£åº§ç§»åŠ¨çš„ç¯å¡”çš„å…¨éƒ¨ä¿¡é“å’Œäº¤æ¢ç§˜é’¥ï¼Œä»æ­¤å¤±å»äº†ä¸€åˆ‡å’Œé‚£åº§ç¯å¡”çš„è”ç³»ã€‚

æ¯æ¬¡è¿é€è´§ç‰©çš„å‘¨æœŸå¤§æ¦‚éœ€è¦åœ¨æµ·ä¸Šèˆªè¡Œä¸€å¹´ï¼Œæ¯å¹´èˆ¹éƒ½ä¼šå›åˆ°æµ…æµ·åŒºçš„æ¸¯å£ä¸€æ¬¡çœ‹æœ›é‚£åº§ç¯å¡”ï¼Œè¿œè¿œçš„æœ›ç€å¥¹ï¼Œä½†é‚£åº§ç¯å¡”å¿ƒé‡Œäº†è§£ï¼Œé‚£è‰˜èˆ¹ä¸€å¹´ä¸€å®šæœ‰ä¸€æ¬¡ä¼šå›åˆ°è¿™é‡Œï¼Œåªæ˜¯å®ƒä¸å‘å‡ºå…‰è€Œå·²ã€‚

çªç„¶æœ‰ä¸€å¤©èˆ¹å¬è¯´æ–°å»ºåœ¨æ‚¬æµ®ç¯å¡”æ—è¾¹çš„æ–°ç¯å¡”å› ä¸ºæ–½å·¥æ—¶é—´ç´§ä»»åŠ¡é‡å¯¼è‡´è´¨é‡ä¸åˆæ ¼è€Œåå¡Œï¼Œèˆ¹ä¸ºé‚£åº§æ‚¬æµ®çš„ç¯å¡”æ·±æ·±åœ°æäº†ä¸€æŠŠæ±—ï¼Œå¥¹æ²¡äº‹å§ï¼Ÿæˆ‘æ˜¯ä¸æ˜¯åº”è¯¥åœ¨è¿™ä¸ªæ—¶å€™è·Ÿå¥¹è¯´å¥è¯ï¼Œå®‰æ…°ä¸€ä¸‹å¥¹ï¼Œå¯æ˜¯æˆ‘çš„æ— çº¿ç”µç³»ç»Ÿä¸­å·²ç»æ²¡æœ‰äº†å¥¹çš„ä¿¡é“å’Œäº¤æ¢ç§˜é’¥ã€‚æˆ‘æ¯”å¥¹éƒ½ä¼¤å¿ƒï¼Œåœ¨å¥¹éœ€è¦æˆ‘çš„å…‰æŸçš„æ—¶å€™æˆ‘å±…ç„¶å‘ä¸å‡ºæ¥ä»»ä½•å¥¹éœ€è¦çš„å…‰æŸï¼Œè®©æˆ‘å”¯ä¸€èƒ½æœ‰æ¬£æ…°çš„æ˜¯ï¼Œå¥¹è¿˜æœ‰çˆ¶æ¯ç¯å¡”ä¸ºå¥¹æä¾›åœ°é¢ç”µåŠ›è¾“é€ï¼Œä¿éšœå¥¹æ²¡æœ‰è¢«åå¡Œçš„é£é™©ã€‚

å°±è¿™æ ·æ—¶å…‰è¿‡äº†4å¹´2ä¸ªæœˆï¼Œåœ¨è¿™å››å¹´ä¸­èˆ¹åœ¨æ¯ä¸ªèˆªè¡Œçš„å¤œæ™šæ—¶ä¸æ—¶çš„åšåŒä¸€ä¸ªæ¢¦ï¼Œæ¢¦åˆ°é‚£åº§ç§»åŠ¨çš„ç¯å¡”åœ¨å‘å‡ºå¯»æ‰¾ä»–çš„å…‰æŸï¼Œä»–å›åº”äº†è¿™ç¯å¡”ä»¥åŒæ ·çš„å…‰æŸå’Œæ— çº¿ç”µä¿¡å·ï¼Œäº’ç›¸æ‹¥æŠ±ç€å“­æ³£ã€‚æ¯æ¬¡æ¢¦é‡Œé†’æ¥ï¼Œèˆ¹çš„çœ¼è§’é‡Œå«ç€çœ¼æ³ªï¼ˆå½“æˆ‘å†™åˆ°è¿™é‡Œæ—¶çœ¼è§’é‡Œå·²ç»æµå‡ºäº†çœ¼æ³ªï¼‰ï¼Œæ¯æ¬¡é†’æ¥èˆ¹éƒ½ä¼šå‘å‡ºä¸€æ¬¡ä¿¡å·ï¼Œè®°å½•ä¸‹æ—¶é—´ï¼Œå°±è¿™æ ·4å¹´ä¸­æ¢¦åˆ°äº†ç¯å¡”15æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯å¾ˆä¼¤å¿ƒï¼Œèˆ¹ä¹Ÿè®¸æ°¸è¿œä¹Ÿæƒ³ä¸æ˜ç™½è‡ªå·±åˆ°åº•åšé”™äº†ä»€ä¹ˆï¼Œæ€ä¹ˆæ°¸è¿œå¿˜ä¸æ‰é‚£æ°¸ä¸ç£¨ç­çš„ç”µæ³¢ï¼Œæ€ä¹ˆæ°¸è¿œä¹Ÿæ²¡æœ‰æœºä¼šèµ¢å¾—å±äºè‡ªå·±çš„å°Šé‡ï¼Œèˆ¹çš„å››å¹´ä¸­ä¸æ–­å®Œå–„è‡ªå·±çš„ç¼ºé™·ï¼ŒæŠŠè‡ªå·±ä»è½»å‹é“ç”²èˆ°å‡çº§æˆäº†å·¡æ´‹èˆ°ï¼Œä½†èˆ¹çš„å†…å¿ƒä¾ç„¶æ²¡æœ‰ä¸æ¯«çš„é«˜å…´ï¼Œå³ä¾¿è‡ªå·±èƒ½æ‹‰åƒå¨è´§ç‰©ï¼Œä¸‡å¨æ’é‡ï¼Œå‡ åƒèŠ‚é€Ÿåº¦ï¼Œæˆä¸ºæˆ˜åˆ—èˆ°åˆèƒ½æ€æ ·ï¼Œèƒ½æ¢å›é‚£åº§æ‚¬æµ®çš„ç¯å¡”å—ï¼Ÿä¸èƒ½ï¼Œå› ä¸ºèˆ¹å¾ˆå¤±è´¥ï¼Œä¸€è¾ˆå­ä¹Ÿè®¸éƒ½æ˜¯è½½é›†è£…ç®±çš„å‘½è¿ï¼Œè¿æ›´å¤šçš„è´§ç‰©ï¼Œèˆ¹æ²‰é»˜äº†ï¼Œèˆ¹å¾ˆæƒ³å‡»æ²‰è‡ªå·±æ°¸è¿œæ²‰æ²¡ã€‚

èˆ¹è¯•å›¾å¯ç”¨æ–°çš„ç¯å…‰ç³»ç»Ÿå°è¯•å‘å‡ºé‚£åº§ç¯å¡”éœ€è¦çš„å…‰æŸå’Œæ–°çš„æ— çº¿ç”µå°æ¥æ”¶ç³»ç»Ÿï¼Œä»å…¶å®ƒå‹èˆ¹é‚£é‡Œæ‰¾åˆ°è¿™åº§ç¯å¡”ä¿¡å·é¢‘é“å’Œå…‰è°±ã€‚ä¸ä¹…æ”¶åˆ°äº†æ‚¬æµ®ç¯å¡”çš„åº”ç­”ï¼Œèˆ¹å†…å¿ƒå¾ˆçŸ›ç›¾ï¼Œå¾ˆé«˜å…´ï¼Œå¾ˆå¿ƒé…¸ï¼Œå¾ˆæ— åŠ©ï¼Œå¾—çŸ¥é‚£åº§æ–°ç¯å¡”å€’å¡Œåæµ·æ´‹æ€»ç½²è”åˆåœ°é¢æ¸¯å£ä»¥åŠçˆ¶æ¯ç¯å¡”ï¼Œä¸ºæ‚¬æµ®ç¯å¡”å»ºé€ äº†ä¸€åº§æ–°çš„ç¯å¡”ï¼Œå¹¶ä¸”ç”¨é’¢ç¼†å›ºå®šå¡”åŸºï¼Œè®©å¥¹ä¸åœ¨å­¤ç‹¬ï¼Œä¸åœ¨é£æµªçš„æ´—ç¤¼ä¸­æ‘‡æ‘†ä¸å®šã€‚

ç¯å¡”ä¹Ÿè®¸ä¸çŸ¥é“èˆ¹çš„ç¯å…‰ç³»ç»Ÿä¸­åªæ¢äº†ç¯èŠ¯å’Œç¯ç½©è¿˜æœ‰çº¿è·¯ï¼Œç¯å…‰çš„èŠ¯ç‰‡ä¾ç„¶è¿˜æ˜¯åŸæ¥çš„èŠ¯ç‰‡ï¼Œåªæ˜¯ç°åœ¨ä»…ä»…èƒ½è¯†åˆ«90%çš„é‚£åº§ç¯å¡”å…‰æŸã€‚èˆ¹çš„å†…å¿ƒæ˜¯æ›¿ç¯å¡”é«˜å…´çš„ï¼Œå¥¹ç»ˆäºæœ‰äº†å¥¹æƒ³è¦çš„ä¸€åˆ‡ã€‚ä½†èˆ¹ä¹Ÿè®¸å¾ˆä¼¤å¿ƒï¼Œä»–çš„é‚£åº§ç¯å¡”å·²ç»å€’å¡Œäº†ï¼Œå†ä¹Ÿä¸èƒ½åœ¨æµ·ä¸­ä¸ºèˆ¹æŒ‡æ˜æ–¹å‘äº†ï¼Œèˆ¹ä¹Ÿä¸å¾—ä¸æ‰¾ä¸‹ä¸€åº§ç¯å¡”...

# ç»“å°¾

è¿™è‰˜èˆ¹å«"è‰¯å·¥"å·ã€‚

çœŸäººæ•…äº‹æ”¹ç¼–ï¼Œç‰ˆæƒæ‰€æœ‰ç¿»ç‰ˆå¿…ç©¶ã€‚



URL: https://sunyazhou.com/2018/08/CPUThreadDebug/index.html.md
Published At: 2018-08-17 17:19:23 +0000

# iOSä¸­CPUçº¿ç¨‹è°ƒè¯•é«˜çº§æŠ€å·§

# å‰è¨€ 

æœ€è¿‘åœ¨å¼€å‘ç›´æ’­,å‘ç°CPUæ€§èƒ½è¢«æ‰“æ»¡åå¯¼è‡´CPUé™é¢‘,å‘çƒ­ä¸¥é‡,ç„¶åå¡é¡¿...

ä¸ºäº†å®šä½è¿™ä¸ªé—®é¢˜æˆ‘ä»¬èŠ±è´¹äº†è‡³å°‘ 3å¤©çš„æ—¶é—´ ä¸€ç‚¹ä¸€ç‚¹è·Ÿè¸ªCPUçš„çº¿ç¨‹ä»£ç ,å½“é‡åˆ°C++çš„threadçš„æ—¶å€™æ²¡æœ‰ç¬¦å·è¡¨,åªèƒ½çœ‹è§ä¸€å¨å¯¹è±¡åœ°å€,é™¤æ­¤ä»¥å¤–è¿ä¸ªæ–¹æ³•åéƒ½æ²¡æœ‰çš„æ—¶å€™çœŸæ˜¯æ‰‹è¶³æ— æª.æœ¬ç¯‡ä»‹ç»ä¸€ä¸ªé«˜çº§è°ƒè¯• æ–¹æ³•,ä½¿ç”¨ç¬¦å·è¡¨å’Œç›¸å…³ æŒ‡ä»¤å¯»è¸ª ç›¸å…³ä»£ç è°ƒç”¨,å†™çš„ä¸å¥½ å¤§ä½¬ä»¬è¯·è½»å–·.ä»£ç ç›¸å…³è¿‡ç¨‹æ„Ÿè°¢åŒäº‹ é™ˆè±ªçš„å¤§åŠ›æ”¯æŒ.


# Talk is cheap show me the code

æˆ‘ä»¬çš„å®ç°æ€è·¯æ˜¯æ‰¾åˆ°åŠ¨æ€åº“çš„é¦–åœ°å€è°ƒç”¨ä»æ­¤å…¥æ‰‹ç”¨ç›¸å…³æŒ‡ä»¤æ¢å¤


### å‰æœŸå‡†å¤‡

* build settingä¸­å¼€å¯ç¬¦å·è¡¨

![](/assets/images/20180817CPUThreadDebug/enableDysm.webp)




## 1.å¯¼å…¥å¤´æ–‡ä»¶


``` objc
#import <mach-o/dyld.h>
```

è¿™æ˜¯mac osçš„å¯æ‰§è¡Œæ–‡ä»¶çš„åŠ¨æ€é“¾æ¥åº“å¤´æ–‡ä»¶ å†…éƒ¨å†…å»ºå‡½æ•°æœ‰å‡ ä¸ªæˆ‘ä»¬éœ€è¦ç”¨åˆ°

## 2.å¤åˆ¶ä¸‹é¢ä»£ç åˆ°ä½ çš„ç›¸å…³è°ƒç”¨çš„åœ°æ–¹

``` objc
//1
uint32_t count = _dyld_image_count();
DDLogInfo(@"Dyld image count %d", count);
//2
for (int i = 0; i < count; i++) {
    char *image_name = (char *)_dyld_get_image_name(i);
    //3
    const struct mach_header *mh = _dyld_get_image_header(i);
    intptr_t vmaddr_slide = _dyld_get_image_vmaddr_slide(i);
    //4
    NSLog(@"Image name %s at address 0x%llx and ASLR slide 0x%lx.\n",
              image_name, (mach_vm_address_t)mh, vmaddr_slide);
}

```

æˆ‘è§£é‡Šä¸€ä¸‹ä»¥ä¸Šä»£ç   

* 1.æ‹¿å‡ºå½“å‰é•œåƒæ•°é‡  
* 2.éå†é•œåƒ  
* 3.è·å–é•œåƒé¦–åœ°å€  
* 4.æ‰“å°  

ç„¶åè¿è¡Œä½ çš„ç¨‹åº

ç„¶åçœ‹ä¸‹æ§åˆ¶å° è¿‡æ»¤ä¸€ä¸‹ ASLRæˆ‘ä»¬logä¸­çš„é”®å…¥å†…å®¹

![](/assets/images/20180817CPUThreadDebug/consoloDebug.webp)


ç„¶å ç‚¹å‡» å·¥ç¨‹ä¸­çš„Product 

![](/assets/images/20180817CPUThreadDebug/products.webp)

å³é”® show in finder

![](/assets/images/20180817CPUThreadDebug/productDir.webp)

ä¸‹ä¸€æ­¥éª¤ æ‰“å¼€ç»ˆç«¯ cd åˆ°è¿™è¿™ä¸ªç›®å½•(å¯ä»¥æ‰“å¼€ç»ˆç«¯ è¾“å…¥ cd ç©ºæ ¼ æ‹–æ‹½é‚£ä¸ªæ–‡ä»¶å¤¹)

![](/assets/images/20180817CPUThreadDebug/dirFinal.webp)

ç„¶å `pwd`ä¸€ä¸‹ çœ‹çœ‹


## 3.æ§åˆ¶å°æœç´¢ç›¸å…³æˆ‘ä»¬æ‰“å°logçš„ä»£ç 

æ‰¾åˆ°æˆ‘ä»¬ç¬¬ä¸€æ¡é¦–åœ°å€

![](/assets/images/20180817CPUThreadDebug/importent.webp)

> æ³¨æ„:__è¿™ä¸€æ­¥éå¸¸é‡è¦ å¦‚æœä¸å¥½ä½¿,è¯·é‡è¯•å‡ æ¬¡.__

#### æ‹¿å‡ºmainå‡½æ•°çš„é¦–åœ°å€ ASLRä¸­æœæœçš„ é¦–åœ°å€ç„¶åå¤åˆ¶ __å›åˆ°ç»ˆç«¯ä¸­è¾“å…¥__

``` sh
atos -arch arm64 -o com_kwai_gif.app.dSYM/Contents/Resources/DWARF/com_kwai_gif -l  0x1006b8000
```

> æ³¨æ„:__è¿™é‡Œæ˜¯ç¬¦å·è¡¨è·¯å¾„__,å¦‚æœä¸çŸ¥é“åœ¨å“ªé‡Œæ‰¾åˆ°è¯·googleä¸€ä¸‹.

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ å¥½ä¸å¥½ä½¿

é¦–å…ˆåœ¨æ§åˆ¶å°é¡¶éƒ¨çš„é¢æ¿ç‚¹å‡»

![](/assets/images/20180817CPUThreadDebug/breakpoint1.webp)


ç„¶å åœ¨ consoloä¸­è¾“å…¥ `bt` 

![](/assets/images/20180817CPUThreadDebug/main.webp)



å¦‚æœçœ‹åˆ° å¦‚ä¸‹å†…å®¹è¯´æ˜å·²ç»æˆåŠŸ.

![](/assets/images/20180817CPUThreadDebug/mainResult.webp)

## 4.çœŸæœºè¿è¡Œ æ‰¾å‡ºæœªçŸ¥çº¿ç¨‹

é¦–å…ˆç‚¹å‡»Xcodeå·¥ç¨‹ä¸­çš„Profileè¿è¡Œ`instruments`,æˆ‘è¿™é‡Œæ˜¯è¿è¡Œå·¥ç¨‹ä¹‹å Xcode9.4å¯ä»¥æ— ç¼è½¬æ¢åˆ°`instruments`

![](/assets/images/20180817CPUThreadDebug/instruments0.webp)

æˆ‘ä»¬æ‰¾åˆ°ç›¸å…³çº¿ç¨‹ æ²¡æœ‰åç§°ä¹Ÿä¸çŸ¥é“å¯¹è±¡å«ä»€ä¹ˆ å°±ä¸€ä¸ªåå…­è¿›åˆ¶åœ°å€

![](/assets/images/20180817CPUThreadDebug/instruments2.webp)

æˆ‘ä»¬éšä¾¿æ‰¾ä¸ªåœ°å€ åœ¨ç»ˆç«¯ä¸­è¾“å…¥ 

![](/assets/images/20180817CPUThreadDebug/instruments3.webp)


å¥½äº† å¦‚æœæœ‰é—®é¢˜ è¯·åˆ é™¤productå’Œç¬¦å·è¡¨é‡æ–°ç¼–è¯‘

# æ€»ç»“

CPUè°ƒè¯•çš„è¿‡ç¨‹éå¸¸éº»çƒ¦,è€Œä¸”ä¸­é—´è¿‡ç¨‹çš„ä»£ç å¤šæ•°éƒ½æ˜¯C++çš„è°ƒç”¨,ä¸»è¦æ˜¯çº¿ç¨‹æ¶ˆè€—çš„å¼€é”€,ä¸­æœ‰å¾ˆå¤šæ”¶è·å¸Œæœ›å¤§å®¶å¤šå¤šæŒ‡æ•™.

å…¨æ–‡å®Œ











URL: https://sunyazhou.com/2018/08/TapticEngineFeedback/index.html.md
Published At: 2018-08-13 14:28:04 +0000

# Taptic EngineæŒ¯åŠ¨åé¦ˆ

![](/assets/images/20180813TapticEngineFeedback/TapticEngine.webp)


# å‰è¨€

Taptic Engine æ˜¯è‹¹æœäº§å“ä¸Šæ¨å‡ºçš„å…¨æ–°éœ‡åŠ¨æ¨¡å—ï¼Œè¯¥å…ƒä»¶æœ€æ—©å‡ºç°åœ¨ Apple Watch ä¸­ã€‚iPhone 6s å’Œ iPhone 6s Plus ä¸­ï¼Œä¹ŸåŒæ ·å†…ç½®äº†Taptic Engineï¼Œåœ¨è®¾è®¡ä¸Šæœ‰æ‰€å‡çº§ã€‚

Taptic Engine æŒ¯åŠ¨æ¨¡å—ä¸º Apple Watch ä»¥åŠ iPhone 6sã€iPhone 7 æä¾›äº† Force Touch ä»¥åŠ 3D Touchï¼Œä¸åŒçš„å±å¹•æ“ä½œï¼Œå¯ä»¥æ„Ÿå—åˆ°ä¸åŒçš„æŒ¯åŠ¨è§¦è§‰æ•ˆæœï¼Œå¸¦æ¥æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ


# è§¦è§‰æŒ¯åŠ¨ä½“éªŒ

## æŒ¯åŠ¨ä»£ç (æ—§æ–¹æ¡ˆ)

è°ƒç”¨è¿™è¡Œä»£ç è™½ç„¶å¯ä»¥æŒ¯åŠ¨ ä½†æ˜¯å®ƒå±äºé•¿æŒ¯åŠ¨

``` objc
AudioServicesPlaySystemSound(kSystemSoundID_Vibrate);
```

## æŒ¯åŠ¨ä»£ç (æ–°æ–¹æ¡ˆ)

iOS10 å¼•å…¥äº†ä¸€ç§æ–°çš„ã€äº§ç”Ÿè§¦è§‰åé¦ˆçš„æ–¹å¼ï¼Œ å¸®åŠ©ç”¨æˆ·è®¤è¯†åˆ°ä¸åŒçš„éœ‡åŠ¨åé¦ˆæœ‰ä¸åŒçš„å«ä¹‰ ã€‚è¿™ä¸ªåŠŸèƒ½çš„æ ¸å¿ƒå°±æ˜¯ç”± UIFeedbackGenerator æä¾›ã€‚

`UIFeedbackGenerator` å¯ä»¥å¸®åŠ©ä½ å®ç° `haptic feedback`ã€‚å®ƒçš„è¦æ±‚æ˜¯ï¼š

* æ”¯æŒ Taptic Engine æœºå‹ (iPhone 7 ä»¥åŠ iPhone 7 Plus).
* app éœ€è¦åœ¨å‰å°è¿è¡Œ
* ç³»ç»Ÿ Taptic setting éœ€è¦å¼€å¯

> ä¸‹å›¾å¼€å¯ å£°éŸ³ä¸è§¦æ„Ÿ
> æ‰‹æœº -- è®¾ç½® -- å£°éŸ³ä¸è§¦æ„Ÿ -- ç³»ç»Ÿè§¦æ„Ÿåé¦ˆ(æ‰“å¼€)
> ![](/assets/images/20180813TapticEngineFeedback/setting.webp)
 

### è°ƒç”¨ç›¸å…³æŒ¯åŠ¨ä»£ç å®ç°æŒ¯åŠ¨åŠŸèƒ½


`UIFeedbackGenerator` å­ç±»æœ‰:

* UIImpactFeedbackGenerator
* UISelectionFeedbackGenerator
* UINotificationFeedbackGenerator


#### UIImpactFeedbackGeneratoræŒ¯åŠ¨

``` objc
UIImpactFeedbackGenerator *generator = [[UIImpactFeedbackGenerator alloc] initWithStyle: UIImpactFeedbackStyleLight];
[generator impactOccurred];
```

æŒ¯åŠ¨styleæœ‰ä¸‰ç§æšä¸¾

``` objc
typedef NS_ENUM(NSInteger, UIImpactFeedbackStyle) {
    UIImpactFeedbackStyleLight,
    UIImpactFeedbackStyleMedium,
    UIImpactFeedbackStyleHeavy
};

```

> åŸºæœ¬æ¯æ¬¡æŒ¯åŠ¨ç›¸å½“äºåˆ›å»ºä¸€ä¸ªå®ä¾‹è°ƒç”¨ä¸€æ¬¡æ–¹æ³•å°±è¡Œäº†,å¦‚æœè§‰å¾—æ€§èƒ½æ›´å¥½çš„è®¾è®¡å¯ä»¥ææˆæˆå‘˜å˜é‡


åé¦ˆç»“æœ

| UIImpactFeedbackGenerator | UIImpactFeedbackStyleLight | UIImpactFeedbackStyleMedium | UIImpactFeedbackStyleHeavy |
| ------| ------ | ------ | ------ |
| iPhone 7ï¼ˆiOS 10ï¼‰åŠä»¥ä¸Šæœºå‹ | å¾®å¼±çŸ­æŒ¯ | ä¸­ç­‰çŸ­æŒ¯ | æ˜æ˜¾çŸ­æŒ¯ |
| iPhone 6s Pulsï¼ˆiOS 9ï¼‰ | é•¿æŒ¯ | é•¿æŒ¯ | é•¿æŒ¯ |
| iPhone 6ï¼ˆiOS 10ï¼‰ | æ— æŒ¯åŠ¨ | æ— æŒ¯åŠ¨ | æ— æŒ¯åŠ¨ |



#### UISelectionFeedbackGeneratoræŒ¯åŠ¨

è¿™é‡Œæˆ‘è¯•å›¾ææˆæˆå‘˜å˜é‡æ¨¡æ‹Ÿæ‰‹åŠ¿æ‹–æ‹½ æŒ¯åŠ¨

``` objc
@property (nonatomic, strong) UISelectionFeedbackGenerator *feedbackGesGenerator;

```
äº‹ä»¶ç›¸åº”

``` objc
- (IBAction)gestrueHandle:(UIGestureRecognizer *)sender {
    switch (sender.state) {
        case UIGestureRecognizerStateBegan:
            
            // Instantiate a new generator.
            self.feedbackGesGenerator = [[UISelectionFeedbackGenerator alloc] init];
            
            // Prepare the generator when the gesture begins.
            [self.feedbackGesGenerator prepare];
            
            break;
            
        case UIGestureRecognizerStateChanged: {
            
            // Check to see if the selection has changed...
           
                // Trigger selection feedback.
                [self.feedbackGesGenerator selectionChanged];
                
                // Keep the generator in a prepared state.
                [self.feedbackGesGenerator prepare];
            
            }
            
            break;
            
        case UIGestureRecognizerStateCancelled:
        case UIGestureRecognizerStateEnded:
        case UIGestureRecognizerStateFailed:
            
            // Release the current generator.
            self.feedbackGesGenerator = nil;
            
            break;
            
        default:
            
            // Do nothing.
            break;
    }
}
```

> æ³¨æ„: __è¿™é‡Œè°ƒç”¨äº†ä¸€ä¸‹`[self.feedbackGesGenerator prepare]`æ–¹æ³•è®©æŒ¯åŠ¨å¼•æ“å‡†å¤‡å°±ç»ª,æ–¹ä¾¿ä¸‹æ¬¡å¿«é€Ÿå¯åŠ¨__è¿™ä¸ªæ–¹æ³•æ˜¯çˆ¶ç±»çš„æ–¹æ³•




#### UINotificationFeedbackGeneratoræŒ¯åŠ¨

``` objc
UINotificationFeedbackGenerator *notifiFeedBack = [[UINotificationFeedbackGenerator alloc] init];
    [notifiFeedBack notificationOccurred:UINotificationFeedbackTypeWarning];

```

åŒæ ·`UINotificationFeedbackType`ä¹Ÿæ˜¯ä¸‰ç§æšä¸¾

``` objc
typedef NS_ENUM(NSInteger, UINotificationFeedbackType) {
    UINotificationFeedbackTypeSuccess,
    UINotificationFeedbackTypeWarning,
    UINotificationFeedbackTypeError
};
```


# æ€»ç»“

å‡ ç§ä¸åŒçš„æŒ¯åŠ¨API å¯ä»¥è§†æƒ…å†µè€Œä½¿ç”¨, æ¯”è¾ƒå¸¸ç”¨çš„æ˜¯ `UIImpactFeedbackGenerator`, å½“ç„¶ä¹Ÿå¯ä»¥éšæ„ä½¿ç”¨æ³¨æ„æ“ä½œç³»ç»Ÿåˆ¤æ–­æ£€æŸ¥ã€‚

ä¾‹å¦‚:

``` objc
if (@available(iOS 10.0, *)) {
	//å†™ç›¸å…³æŒ¯åŠ¨ä»£ç 
}
```


å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2018/07/ToolBarBlur/index.html.md
Published At: 2018-07-23 18:22:05 +0000

# åˆ©ç”¨UIToolBaråšé«˜æ–¯æ¨¡ç³ŠèƒŒæ™¯

![](/assets/images/20180723ToolBarBlur/blur.gif)

``` objc
- (UIView *)containerBackgroundView {
    if (!_containerBackgroundView) {
        UIToolbar *toolBar = [[UIToolbar alloc] initWithFrame:CGRectZero];
        toolBar.barStyle = UIBarStyleBlack;
        toolBar.clipsToBounds = YES;
        _containerBackgroundView = toolBar;
    }
    return _containerBackgroundView;
}

```

ä¹Ÿå¯ä»¥ä½¿ç”¨`UIBlurEffect`


``` objc
UIBlurEffect *blurEffect = [UIBlurEffect effectWithStyle:UIBlurEffectStyleLight];
UIVisualEffectView *blurView = [[UIVisualEffectView alloc] initWithEffect:blurEffect];
blurView.frame = myView.bounds;
[myView addSubview:blurView];

```


UIBlurEffectStyle 

* UIBlurEffectStyleExtraLight,//é¢å¤–äº®åº¦ï¼Œï¼ˆé«˜äº®é£æ ¼ï¼‰

* UIBlurEffectStyleLight,//äº®é£æ ¼

* UIBlurEffectStyleDark//æš—é£æ ¼

> UIBlurEffect ä¸èƒ½è°ƒèŠ‚æ¨¡ç³ŠåŠå¾„

å¦‚æœè¦è°ƒæ•´æ¨¡ç³ŠåŠå¾„

å¯ä»¥å¯¹å›¾ç‰‡è¿›è¡Œé«˜æ–¯æ¨¡ç³Š

``` objc
-(UIImage *)convertToBlurImage:(UIImage *)image{
    CIFilter *gaussianBlurFilter = [CIFilter filterWithName:@"CIGaussianBlur"];
    [gaussianBlurFilter setDefaults];
    CIImage *inputImage = [CIImage imageWithCGImage:[image CGImage]];
    [gaussianBlurFilter setValue:inputImage forKey:kCIInputImageKey];
    [gaussianBlurFilter setValue:@5 forKey:kCIInputRadiusKey];
    CIImage *outputImage = [gaussianBlurFilter outputImage];
    CIContext *context   = [CIContext contextWithOptions:nil];
    CGImageRef cgimg     = [context createCGImage:outputImage fromRect:[inputImage extent]];  // note, use input image extent if you want it the same size, the output image extent is larger
    UIImage *convertedImage = [UIImage imageWithCGImage:cgimg];
    return convertedImage;
}

```

æ ¸å¿ƒä»£ç æ˜¯`[gaussianBlurFilter setValue:@5 forKey:kCIInputRadiusKey]`;

ä½†æ˜¯æˆ‘æµ‹è¯•100ä¹Ÿæ²¡å•¥é—®é¢˜ æ²¡æœ‰æµ‹è¯•å‡ºæœ€å¤§å€¼

ä»¥ä¸Šæ˜¯å‡ ç§é«˜æ–¯æ¨¡ç³Šçš„ç›¸å…³ä»£ç  


å…¨æ–‡å®Œ





URL: https://sunyazhou.com/2018/07/LinuxBash/index.html.md
Published At: 2018-07-18 09:29:39 +0000

# Linux ç»ˆç«¯ Bash å¸¸ç”¨å¿«æ·é”®ä»‹ç»åŠç»éªŒ

![](/assets/images/20180718LinuxBash/20130520LinuxLogoOnCentos5.webp)


# bashåŠå…¶ç‰¹æ€§

* [bash](http://cn.linux.vbird.org/linux_basic/0320bash.php)å®è´¨ä¸Šæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œä¸€ä¸ªç”¨æˆ·çš„å·¥ä½œç¯å¢ƒã€‚
* åœ¨æ¯ä¸€ä¸ªshellä¸‹å¯ä»¥å†æ‰“å¼€ä¸€ä¸ªshellï¼Œæ–°æ‰“å¼€çš„shellå¯ä»¥ç§°ä¸ºå­shellï¼Œæ¯ä¸€ä¸ªshellä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚
* å¯ä»¥ä½¿ç”¨pstreeå‘½ä»¤æŸ¥çœ‹å½“å‰shellä¸‹çš„å­shellä¸ªæ•°ã€‚

### 1. æœ€é‡è¦çš„è‡ªåŠ¨è¡¥å…¨

| å‘½ä»¤ | è§£é‡Š |
| ----- | ----- |
| Tab | è‡ªåŠ¨è¡¥å…¨ |

### 2. ç¼–è¾‘è·³è½¬

| å‘½ä»¤	| è§£é‡Š |
| ----- | ----- |
| Ctrl + A | è·³è½¬åˆ°å½“å‰è¡Œé¦– |
|Ctrl + E | è·³è½¬åˆ°å½“å‰è¡Œæœ« |
|Alt + F | å°†å…‰æ ‡åœ¨å½“å‰è¡Œä¸Šå‘åç§»åŠ¨ä¸€ä¸ªå•è¯ |
|Alt + B | å°†å…‰æ ‡åœ¨å½“å‰è¡Œä¸Šå‘å‰ç§»åŠ¨ä¸€ä¸ªå•è¯ |
|Ctrl + W	| åˆ é™¤å½“å‰å…‰æ ‡å‰çš„ä¸€ä¸ªå•è¯ |
|Ctrl + K	| åˆ é™¤å½“å‰å…‰æ ‡åçš„å†…å®¹ |
|Ctrl + U | æ¸…é™¤æ•´è¡Œ |
|Ctrl + L	| æ¸…å±ï¼Œç±»ä¼¼äº clear å‘½ä»¤ |
|Ctrl + H	| é€€æ ¼ï¼Œç±»ä¼¼äº backspace é”® |
|Ctrl + T	| å°†å½“å‰å…‰æ ‡å‰çš„ä¸¤ä¸ªå­—ç¬¦äº’æ¢ä½ç½® |
|Esc + T	| å°†å½“å‰å…‰æ ‡å‰çš„ä¸¤ä¸ªå•è¯äº’æ¢ä½ç½® |

`Ctrl + W` å’Œ `Ctrl + U` ç›¸å½“å¸¸ç”¨ã€‚æ‹¼å†™é”™æ˜¯å¾ˆå¸¸è§çš„äº‹ã€‚

`Ctrl + L` ä¹Ÿä¸ç”¨å¤šè¯´ã€‚

### 3. è¿›ç¨‹ç›¸å…³

| å‘½ä»¤	| è§£é‡Š |
| ----- | ----- |
| Ctrl + C | ç»ˆæ­¢å½“å‰è¿›ç¨‹ |
| Ctrl + Z | å°†å½“å‰è¿›ç¨‹åœ¨åå°æŒ‚èµ·
| Ctrl + D | é€€å‡ºå½“å‰ Shellï¼Œç±»ä¼¼äº exit å‘½ä»¤ | 


`Ctrl + C` æ˜¯å‘å½“å‰è¿è¡Œçš„è¿›ç¨‹å‘é€ SIGINT ä¿¡å·ï¼Œç»ˆæ­¢è¿›ç¨‹ã€‚

> SIGINT - This signal is the same as pressing ctrl-c. On some systems, "delete" + "break" sends the same signal to the process. The process is interrupted and stopped. However, the process can ignore this signal.


`Ctrl + Z` å¹¶ä¸ç»“æŸè¿›ç¨‹ï¼Œè€Œæ˜¯æŒ‚èµ·åœ¨åå°ã€‚ä¹‹åä»ç„¶å¯ä»¥é€šè¿‡ `fg`å‘½ä»¤æ¢å¤ã€‚å¯¹åº”çš„ä¿¡å·æ˜¯ SIGTSTPã€‚

### 3. æœç´¢ä½¿ç”¨è¿‡çš„å‘½ä»¤ï¼ˆç‰¹åˆ«æ¨èï¼‰

| å‘½ä»¤	| è§£é‡Š |
| ----- | ----- |
| Ctrl + R | ç”¨äºæœç´¢ä¹‹å‰ä½¿ç”¨è¿‡çš„å‘½ä»¤ |

æˆ‘ç»å¸¸ç”¨ `history` æŸ¥çœ‹å†å²å‘½ä»¤ï¼Œå…¶å®å·²ç»æœ‰ç°æˆçš„å¿«æ·é”®å¯ä»¥ç”¨ã€‚

æŒ‰ä¸‹ `Ctrl + R` ä¹‹åï¼Œè¾“å…¥æŸ¥è¯¢çš„å…³é”®å­—ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå¯ä»¥ç»§ç»­æŒ‰ `Ctrl + R` è¿›è¡Œéå†ã€‚

è¿™ä¸ªå‘½ä»¤å…¶å®ä¹Ÿæ˜¯é€šè¿‡ `history` è®°å½•æ¥æŸ¥è¯¢çš„ã€‚å¦‚æœä¸å–œæ¬¢è¿™ç§æ–¹å¼ï¼Œå¯ä»¥ç›´æ¥ `history | grep xxx` ä¹Ÿæ˜¯ä¸é”™çš„ã€‚


[å‚è€ƒ Linuxå…¬ç¤¾](https://www.linuxidc.com/Linux/2017-11/148262.htm)



# æ€»ç»“

è¿™äº›å‘½ä»¤å¯¹å·¥ä½œæ•ˆç‡æå‡å¾ˆæ˜¾è‘—,éœ€è¦åå¤å­¦ä¹ ç‰¢è®°,æ–‡ç« æœ€åæ¨èå¤§å®¶å…³æ³¨`Linuxå…¬ç¤¾`è¿™ä¸ªå…·æœ‰å†å²äººæ–‡ç²¾ç¥çš„Linuxç¤¾åŒº, å®ƒè®©æˆ‘å­¦åˆ°ä¸å°‘ä¸œè¥¿.






URL: https://sunyazhou.com/2018/06/FilterString/index.html.md
Published At: 2018-06-25 18:35:17 +0000

# Objective-Cä¸­ä½¿ç”¨æ­£åˆ™å»é™¤éæ•°å­—å­—æ¯æ±‰å­—

# å‰è¨€

ä»Šå¤©ç¢°åˆ°ä¸ªéœ€æ±‚,PMè¦æ±‚è¾“å…¥æ¡†ä¸­å–å‡ºéå­—æ¯æ•°å­—æ±‰å­—çš„è¾“å…¥.

![](/assets/images/20180625FilterString/RegularExpressDemo.gif)

å¸¦ç€è¿™ä¸ªç–‘é—®å¼€å§‹ä»Šå¤©çš„æ–‡ç« 

# å‡†å¤‡å·¥ä½œ

åˆ›å»ºä¸ªdemo ä»£ç å¦‚ä¸‹

``` objc
@interface ViewController ()
@property (weak, nonatomic) IBOutlet UITextField *input;
@property (weak, nonatomic) IBOutlet UILabel *label;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.input.delegate = self;
    [self.input addTarget:self action:@selector(textChange:) forControlEvents:UIControlEventEditingChanged];
}

//å½“æ–‡æœ¬å†…å®¹æ”¹å˜æ—¶è°ƒç”¨
- (void)textChange:(UITextField *)textField
{
    //è¿™é‡Œè°ƒç”¨ç›¸å…³æ–¹æ³•è¿‡æ»¤å­—ç¬¦ä¸²æ˜¾ç¤ºå‡ºæ¥
    self.label.text = //...;
}
```

åœ¨ç½‘ä¸Šæ‰¾äº†ä¸€åœˆå¤§å¤šéƒ½æ˜¯ä½¿ç”¨è°“è¯å»åˆ¤æ–­æ—¶å€™åŒ…å«,æ²¡æœ‰å‡ ä¸ªç»™å‡ºç›¸åº”çš„å¤„ç†å­—ç¬¦ä¸².

æˆ‘æ‰¾åˆ°äº†3ç§ å¤„ç†å­—ç¬¦ä¸²çš„æ–¹å¼

* æ–¹æ¡ˆ1 ä½¿ç”¨è°“è¯è¿‡æ»¤
* æ–¹æ¡ˆ2 ä½¿ç”¨æ­£åˆ™è¿‡æ»¤å¢åŠ å¯»æ‰¾çš„å­—ç¬¦ä¸²é•¿åº¦
* æ–¹æ¡ˆ3 ä½¿ç”¨æ­£åˆ™ç²¾ç®€è¿‡æ»¤å­—ç¬¦ä¸²


``` objc
æ–¹æ¡ˆ1
- (NSString *)filterString1:(NSString *)str {
    NSString *regex = @"^[a-zA-Z0-9\u4e00-\u9fa5]+";
    NSPredicate *pred = [NSPredicate predicateWithFormat:@"SELF MATCHES %@", regex];
    NSMutableString * retStr = [NSMutableString string];
    for(NSInteger i=0; i< [str length];i++){
        NSRange range = NSMakeRange(i, 1);
        NSString *character = [str substringWithRange:range];
        if([pred evaluateWithObject:character])
        {
            [retStr appendString:character];
        }
    }
    return retStr;
}
```

> è¿™ç§æ–¹å¼è™½ç„¶èƒ½å®ç° ä½†æ˜¯ä»£ç ç•¥æ˜¾å†—é•¿,ä¸è¿‡èƒ½å°±è§£å†³é—®é¢˜


``` objc
//æ–¹æ¡ˆ2
- (NSString *)filterString2:(NSString *)str {
    NSString *regex = @"[^a-zA-Z0-9\u4e00-\u9fa5]";
    NSMutableString *mstr = [NSMutableString stringWithFormat:@"%@", str];
    NSUInteger i = [mstr replaceOccurrencesOfString:regex withString:@"" options:NSRegularExpressionSearch range:NSMakeRange(0, mstr.length)];
    return [NSString stringWithFormat:@"%@-é•¿åº¦:%zd",mstr,i];
}
```

> åŒæ ·çš„æ–¹æ³•ä½¿ç”¨æ­£åˆ™`replaceOccurrencesOfString:withString:options:range:`æ–¹æ³•æ›¿æ¢å­—ç¬¦ä¸²

ä¸‹é¢æˆ‘ä»¬ç²¾ç®€åˆ°2è¡Œä»£ç 

``` objc
//æ–¹æ¡ˆ3
- (NSString *)filterString3:(NSString *)str {
    NSString *regex = @"[^a-zA-Z0-9\u4e00-\u9fa5]";
    return [str stringByReplacingOccurrencesOfString:regex withString:@"" options:NSRegularExpressionSearch range:NSMakeRange(0, str.length)];
}
```

> æœ€ç»ˆæ–¹æ¡ˆ3 å¾—åˆ°çš„é¢„æœŸç»“æœè¿˜æ˜¯ä¸é”™,æ¨èä½¿ç”¨


# æ€»ç»“

æœ‰äº›é—®é¢˜éƒ½æ˜¯åœ¨å·¥ä½œä¸­é‡åˆ°,å¸Œæœ›è®°å½•ä¸‹æ¥ä¸€èµ·åˆ†äº«å’Œå­¦ä¹ .


å…¨å®Œå®Œ

[Demoåœ¨è¿™é‡Œ](https://github.com/sunyazhou13/RegularExpressDemo)






URL: https://sunyazhou.com/2018/06/NSAttributeString/index.html.md
Published At: 2018-06-15 10:10:58 +0000

# ä½¿ç”¨NSAttributeStringå®ç°ä¸åŒé¢œè‰²å¤§å°æ˜¾ç¤º

![](/assets/images/20180615NSAttributeString/richtext.webp)
# å‰è¨€

æœ€è¿‘å¼€å‘éœ€æ±‚é‡åˆ°ä¸€ä¸ªæ¯”è¾ƒç®€å•ä½†åˆæ£˜æ‰‹çš„é—®é¢˜.å…ˆçœ‹éœ€æ±‚

![](/assets/images/20180615NSAttributeString/NSAttributeString1.webp)

ä¸€ä¸ª`UILabel`æ˜¾ç¤ºä¸åŒå¤§å°é¢œè‰²çš„å­—ç¬¦ä¸²,å½“ç„¶æˆ‘ä»¬é¦–å…ˆçš„æƒ³åˆ°å±æ€§å­—ç¬¦ä¸²,ä½†æ˜¯æ³¨æ„: æˆ‘ä»¬è¿™é‡Œè¦å¤„ç†å›½é™…åŒ–å®Œæˆçš„å­—ç¬¦ä¸²ä¹Ÿå°±æ˜¯è¯´ï¼š

å¿…é¡»åœ¨å›½é™…åŒ–å®Œæˆä»¥åæ‰èƒ½è¿½åŠ æˆ‘ä»¬çš„é€»è¾‘,è€Œä¸æ˜¯ä¸€ä¸Šæ¥å°±åŠ å±æ€§å­—ç¬¦ä¸²

æ¯”å¦‚:  `2åˆ†14ç§’` or `2min14secs`

ä¹Ÿå°±æ˜¯ç»™æˆ‘ä»¬çš„æ˜¯ä¸€ä¸ª  `"2åˆ†14ç§’"`å­—ç¬¦ä¸² æˆ‘ä»¬éœ€è¦åŒ¹é…rangeæ¥ä¿®æ”¹æˆ–è€…æ›¿æ¢. å¸¦ç€è¿™ä¸ªç–‘é—®å¼€å§‹ä»Šå¤©çš„æ–‡ç« ?

## å®ç°æ€è·¯

å­”åœ£è´¤æœ‰äº‘:"ä¸¾ä¸€éš…ä¸ä»¥ä¸‰éš…åï¼Œåˆ™ä¸å¤ä¹Ÿã€‚"  
> å‡ºè‡ªã€Šè®ºè¯­Â·ç¬¬ä¸ƒç« Â·è¿°è€Œç¯‡ã€‹

ä¸ºäº†ä¸æ„§å¯¹åœ£è´¤å¯¹æˆ‘çš„æœŸå¾…æˆ‘æŠŠ è¿™ä¸ªé—®é¢˜å®šä½å‡çº§æˆ 4ä¸ªç­‰çº§

* Level 1  æœ€ä¼˜è§£,æ—¶é—´å¤æ‚åº¦æœ€ä½,æ•ˆç‡æœ€é«˜
* Level 2  éæœ€ä¼˜è§£,æ—¶é—´å¤æ‚åº¦æœ€ä½,æ•ˆç‡é«˜
* Level 3  éƒ½ä¸€èˆ¬
* Level 4  ç®€å•ç²—æš´

æˆ‘æƒ³åˆ°äº†ä»¥ä¸‹è‡³å°‘ä¸¤ç§æ–¹æ³•

1. é€šè¿‡è®¡ç®—å‡ºæ¥çš„æ—¶é—´  eg: `åˆ†` `ç§’`   å­—ç¬¦ä¸² rangeå»å›½é™…åŒ–å¤„ç†å®Œçš„å­—ç¬¦ä¸²å»åŒ¹é…ä¿®æ”¹
2. ç”¨æ­£åˆ™åŒ¹é…æ•°å­—
3. ç”¨è°“è¯åŒ¹é…æ•°å­—
4. level4å¤ªä¸šä½™äº†ä¸æ•¢æƒ³å‘ä¸€ä¸ªå·¥ä½œå¥½å‡ å¹´çš„å¼€å‘è€…è¿˜å†™å‡ºè¿™ä¹ˆæ‰“è„¸çš„ä»£ç 

### å‡†å¤‡å·¥ä½œ

åœ¨å·¥ç¨‹ä¸­æ‹–æ‹½äº†ä¸€ä¸ªlabel

``` objc

@interface ViewController ()
@property (weak, nonatomic) IBOutlet UILabel *label;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
 
 	//è°ƒç”¨
    NSAttributedString *resultTime = [self formattedCurrentTime:133];
    self.label.attributedText = resultTime;
}

```

### æ–¹æ¡ˆ1: å­—ç¬¦ä¸²rangeåŒ¹é…

``` objc
/**
 è¿”å›å½“å‰æ—¶é—´æ ¼å¼
 @return è¿”å›ç»„è£…å¥½çš„å­—ç¬¦ä¸²
 */
- (NSAttributedString *)formattedCurrentTime:(NSTimeInterval)timeInterval {
    
    NSUInteger time = (NSUInteger)timeInterval;
    NSInteger minutes = (time / 60) % 60;
    NSInteger seconds = time % 60;
    NSString *minStr = [NSString stringWithFormat:@" %zd ",minutes];
    NSString *secStr = [NSString stringWithFormat:@" %zd ",seconds];
    //å‡è®¾è¿™å°±æ˜¯æˆ‘ä»¬å›½é™…åŒ–åçš„å­—ç¬¦ä¸²
    NSString *localizedFormatString = [NSString stringWithFormat:@"%@åˆ†%@ç§’",minStr,secStr];
    NSMutableAttributedString *attributeStr = [[NSMutableAttributedString alloc] initWithString:localizedFormatString];
    NSRange minRange, secRange;
    if (@available(iOS 9.0, *)) {
        minRange = [localizedFormatString localizedStandardRangeOfString:minStr];
        secRange = [localizedFormatString localizedStandardRangeOfString:secStr];
    } else {
        minRange = [localizedFormatString rangeOfString:minStr];
        secRange = [localizedFormatString rangeOfString:secStr];
    }
    NSDictionary *timeAttrs = @{ NSForegroundColorAttributeName : [UIColor redColor],
                                 NSFontAttributeName : [UIFont systemFontOfSize:40.0f]};
    [attributeStr addAttributes:timeAttrs range:minRange];
    [attributeStr addAttributes:timeAttrs range:secRange];    
    return [[NSAttributedString alloc] initWithAttributedString:attributeStr];;
}
```

çœ‹ä¸‹æ˜¾ç¤ºç»“æœ

![](/assets/images/20180615NSAttributeString/arrtributestring1.webp)

> æ˜¯ä¸æ˜¯çœ‹ä¸Šå»å¾ˆå¥½

ä½†æˆ‘è®¤ä¸ºè¿™å¹¶ä¸å®Œç¾,è¿™ç§ææ³•è™½ç„¶ç®€å•ç›´æ¥,ä½†æ˜¯è¿‡äºä¾èµ–`minStr`å’Œ`secStr`çš„åŸå§‹range,åŸºäºiOS9ä¹‹åæä¾›çš„APIè®¡ç®—`range`

``` objc
if (@available(iOS 9.0, *)) {
    minRange = [localizedFormatString localizedStandardRangeOfString:minStr];
    secRange = [localizedFormatString localizedStandardRangeOfString:secStr];
} else {
    minRange = [localizedFormatString rangeOfString:minStr];
    secRange = [localizedFormatString rangeOfString:secStr];
}
```
> æ³¨æ„:*APIå¹³å°åŒºåˆ†*

ä½†æ˜¯è¿™ä¹ˆå®ç°æœ‰ä¸ªBug å½“é‡åˆ°åŒæ ·å­—ç¬¦ä¸²çš„æ—¶å€™å°±ä¼šåŒ¹é…é”™ä½, å¦‚å›¾

![](/assets/images/20180615NSAttributeString/NSAttributeStringBug1.webp)

é”™è¯¯çš„åŸå› æ˜¾ç„¶å¤§å®¶éƒ½äº†è§£

å­—ç¬¦ä¸² "0" çš„rangeç›¸åŒäº†,ä½†å°±è§£å†³è¿™ä¸ªé—®é¢˜è€Œè¨€,ç®€å•åˆ¤æ–­ä¸€ä¸‹rangeç„¶åæˆªå–å­—ç¬¦ä¸²å‘åè·³è·ƒlengthç»§ç»­æˆªå–è·å–èƒ½å®ç°,ä½†è¿™æ˜¾ç„¶å¾ˆå•°å—¦,ä¸‡ä¸€æœ‰ä¸€å¤© ä½ é‡åˆ°çš„æ˜¯ "`0å°æ—¶0åˆ†12ç§’`"è¿™ç§å­—ç¬¦ä¸²é‚£è¯¥å¦‚ä½•å†™å‘¢ï¼Ÿ

æ˜¯ä¸æ˜¯è¦é€’å½’çš„éå†ä¸€éç„¶åæŒ¨ä¸ªå–`Range` åšå±æ€§ä¿®æ”¹?

è¿™æ ·çš„ç»“æœæ˜¾ç„¶ä¸ä½†ä»£ç å•°å—¦ å®ç°èµ·æ¥æˆæœ¬è¿˜æ˜¯æ¯”è¾ƒé«˜çš„,å¯¹ä»£ç é˜…è¯»æ€§éƒ½æœ‰å¾ˆå¤§å½±å“(å†™å¾—å¥½çš„ä»£ç é™¤å¤–å“ˆ). 


##### é‚£æ€ä¹ˆä¸å•°å—¦å‘¢?

æœ‰ä¸€ç§ææ³•å°±æ˜¯ ç”¨ä¸¤ä¸ªä¸åŒçš„å­—ç¬¦å ä½.ç„¶å å›½é™…åŒ–å®Œæˆä¹‹åå–Range,å†ç„¶åæ›¿æ¢æ–‡å­—,ææ³•è™½ç„¶lowç‚¹,ä½†æ˜¯æ—¶é—´å¤æ‚åº¦é™ä½äº†ä¸å°‘,è¿˜æ˜¯å¯ä»¥è€ƒè™‘çš„.ä»£ç æˆ‘å°±ä¸å†™äº† æˆ‘æ€•å°ä¼™ä¼´reviewä»£ç çš„æ—¶å€™ä¼šè™æˆ‘.ç»§ç»­å¾€ä¸‹çœ‹

**è¯„çº§: Level 2**

é‚£å¦‚ä½•ä¸ä¾èµ–rangeè§£å†³è¿™ç§é—®é¢˜å‘¢ï¼Ÿ

### æ–¹æ¡ˆ2: æ­£åˆ™åŒ¹é…

``` objc
/**
 è¿”å›å½“å‰æ—¶é—´æ ¼å¼
 @return è¿”å›ç»„è£…å¥½çš„å­—ç¬¦ä¸²
 */
- (NSAttributedString *)formattedCurrentTime:(NSTimeInterval)timeInterval {
    
    NSUInteger time = (NSUInteger)timeInterval;
    NSInteger minutes = (time / 60) % 60;
    NSInteger seconds = time % 60;
    NSString *minStr = [NSString stringWithFormat:@" %zd ",minutes];
    NSString *secStr = [NSString stringWithFormat:@" %zd ",seconds];
    //å‡è®¾è¿™å°±æ˜¯æˆ‘ä»¬å›½é™…åŒ–åçš„å­—ç¬¦ä¸²
    NSString *localizedFormatString = [NSString stringWithFormat:@"%@åˆ†%@ç§’",minStr,secStr];
    NSMutableAttributedString *attributeStr = [[NSMutableAttributedString alloc] initWithString:localizedFormatString];
    NSDictionary *timeAttrs = @{ NSForegroundColorAttributeName : [UIColor redColor],
                                 NSFontAttributeName : [UIFont systemFontOfSize:40.0f]};    
    /** æ–¹æ¡ˆ2 **/
    NSError *error = nil;
    NSRegularExpression *reg = [NSRegularExpression regularExpressionWithPattern:@"[0-9]+" options:NSRegularExpressionCaseInsensitive error:&error];
    if (error == nil) {
        NSArray *matches = [reg matchesInString:localizedFormatString options:NSMatchingReportCompletion range:NSMakeRange(0, localizedFormatString.length)];
        for (NSTextCheckingResult *match in matches) {
            for (NSUInteger i = 0; i < match.numberOfRanges; i++) {
                NSRange range = [match rangeAtIndex:i];
                if (range.location != NSNotFound) {
                    [attributeStr addAttributes:timeAttrs range:range];
                }
            }
        }
    }
    return [[NSAttributedString alloc] initWithAttributedString:attributeStr];;
}

```

çœ‹ä¸‹æ˜¾ç¤ºç»“æœ

![](/assets/images/20180615NSAttributeString/attributestring2.webp)

å®Œç¾å®ç°

> è¿™ç§æ–¹æ¡ˆç¼ºç‚¹å°±æ˜¯,æ—¶é—´å¤æ‚åº¦é«˜äº†ä¸€äº›,éœ€è¦æ¯æ¬¡æ­£åˆ™éå†
> æœ‰ç‚¹æ˜¯æ‰©å±•æ€§å¥½ä¸€ç‚¹,ä¸‡ä¸€æœ‰ä¸€å¤©PMåˆæäº†éœ€æ±‚è¦åšæˆ `A1` `B2` `C3 ` `XXX#è¯é¢˜`è¿™ç§ï¼Œé‚£ä¸€å®šä¼šå‡ºå‘

ä½†æˆ‘ç¬¬ä¸€æ¬¡è¿™ä¹ˆå®ç°è¢«å°ä¼™ä¼´å˜²ç¬‘å¾ˆä¸šä½™.ç¡®å®å¾ˆä¸šä½™,ä½†å®ƒèƒ½é¿å…æ–¹æ¡ˆ1ä¸­çš„bug.è€Œä¸”ç›¸å½“ç²¾ç¡®.

**è¯„çº§: Level 2**

### æ–¹æ¡ˆ3: è°“è¯åŒ¹é…

è¿™ç§ææ³•æˆ‘æ²¡å°è¯•,ä¼°è®¡ä¼šæ¯” æ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2éƒ½å¿«ä¸€äº›å’Œç®€å•ç›´æ¥ä¸€äº›,æ—¶é—´å¤ªç´§å¼ ç®—äº†,æœŸå¾…è¯„è®ºè½»å–·å§ï¼

### æ–¹æ¡ˆ4: ç®€å•ç²—æš´

å°±æ 4ä¸ªlabel. æˆ‘éƒ½æƒ³è±¡åˆ°äº†è¢«å®ä¹ ç”Ÿå˜²è®½+æ‰“è„¸çš„ææ³•å‘ç”Ÿåœ¨ä¸€ä¸ªå·¥ä½œå¥½å‡ å¹´å¼€å‘è€…èº«ä¸Šæ˜¯å¤šä¹ˆæƒ¨ç—›çš„ç”»é¢. æ”¾å¼ƒè¿™ç§lowçš„ææ³•

# æ€»ç»“

æœ€ç»ˆè§£å†³é—®é¢˜çš„æ–¹æ¡ˆè¿˜æ˜¯æ–¹æ¡ˆ2:æ­£åˆ™åŒ¹é…æ¯”è¾ƒé è°±,è€Œä¸”ä¸€åŠ³æ°¸é€¸

æœ¬ç¯‡ä¸»è¦è›‹ç–¼çš„é—®é¢˜æ˜¯ å›½é™…åŒ–åçš„å­—ç¬¦ä¸²è¿”å›ç»“æœå,å¯¹è¿”å›çš„ç»“æœè¿›è¡ŒåŠ å·¥å¤„ç†.

æ²¡æœ‰åšåˆ°Level 1çº§çš„åšæ³•å¾ˆæ˜¯é—æ†¾,æ„§å¯¹åœ£è´¤. å¸Œæœ›å°ä¼™ä¼´å¤šææå»ºè®®.

[Demo](https://github.com/sunyazhou13/NSAttributeStringDemo)åœ¨è¿™é‡Œæ‰¾åˆ°

## è¡¥å……

æ ¼å¼åŒ–æ—¶é—´çš„ä»£ç 

``` objc
/**
 è¿”å›æ—¶é—´æ ¼å¼ HH:mm:ss
 @return è¿”å›ç»„è£…å¥½çš„å­—ç¬¦ä¸²
 */
- (NSString *)formattedCurrentTime {
    NSUInteger time = (NSUInteger)self.recorder.currentTime;
    NSInteger hours = (time / 3600);
    NSInteger minutes = (time / 60) % 60;
    NSInteger seconds = time % 60;
    
    NSString *format = @"%02i:%02i:%02i";
    return [NSString stringWithFormat:format, hours, minutes, seconds];
}

```

å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2018/06/SwiftRandom/index.html.md
Published At: 2018-06-08 09:18:03 +0000

# Swift4.2ä¸­çš„éšæœºæ•°

![](/assets/images/20180608SwiftRandom/whatisnewinswift.webp)

# å‰è¨€

åœ¨ä¸Šä¸€ç¯‡æ–‡ç« å‘å¸ƒä¸ä¹…WWDC2018å°±æ‹‰å¼€äº†åºå¹•,è®©æˆ‘è§‰å¾—æœ‰ä¸€ç‚¹æ¯”è¾ƒè›‹ç–¼çš„(a bit of pain) æ˜¯swift4.2ä¸­å¢åŠ äº†ç³»ç»Ÿçš„éšæœºæ•°æ”¯æŒ.æ‰€ä»¥ä¸å¾—ä¸å®Œå–„çš„å¥½ä¸Šä¸€ç¯‡æ–‡ç« çš„ç¼ºæ¼å’Œæ–°æŠ€æœ¯çš„ç ”ç©¶å­¦ä¹ .ç‰¹æ­¤æ–°å‘ä¸€ç¯‡æ–°çš„éšæœºæ•°æ–‡ç« ä»¥å½°å…¶å’.

## å¼€å‘ç¯å¢ƒ

* Xcode10æˆ–è€…æ›´é«˜ç‰ˆæœ¬ 
* Swift4.2
* ä½¿ç”¨Xcodeä¸­çš„Playground


## ç”Ÿæˆéšæœºæ•°

åœ¨ä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å¤§éƒ¨åˆ†æ—¶é—´éƒ½åœ¨å›´ç»•[arcrandom()](https://man.openbsd.org/arc4random.3)å‡½æ•°æ¥ä»‹ç»éšæœºæ•°.å½“ç„¶ä¹Ÿæœ‰å®ƒçš„ä¸€äº›å˜ç§.egï¼šarc4random_uniform(),rand(),random().ä½†æ— è®ºå¦‚ä½•è¿™äº›å‡½æ•°å¤šæ•°éƒ½æ˜¯ç³»ç»Ÿçº§å‡½æ•°ã€‚


åœ¨swift4.2ä¸­ æ‰€æœ‰çš„ æ•°å­—ç±»å‹(å°±æ˜¯æ™®é€šæ•°æ®ç±»å‹ä¸­ä»£è¡¨æ•°å­—çš„)éƒ½æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•`random(in:)`,è¿™ä¸ªæ–¹æ³•å°†æ¥æ”¶ä¸€ä¸ªèŒƒå›´(Range)æˆ–è€…å¼€é—­èŒƒå›´,è¿”å›ä¸€ä¸ªæ— åºçš„éšæœºæ•°(a uniform distribution). è¿™äº›éšæœºå‡½æ•°å°†ä¼šåŒ…å«åœ¨swiftçš„æ ‡å‡†åº“ä¸­,å¦‚æœè·¨å¹³å°çš„è¯æ ‡å‡†åº“å‡½æ•°éƒ½æ˜¯ä¸€è‡´çš„,ä¸åƒä¸Šé¢ä»‹ç»çš„ç³»ç»Ÿéšæœºå‡½æ•°.


``` swift

Int.random(in: 1...1000) //â†’ 580
Double.random(in: 0..<1) //â†’ 0.3211009027224093
UInt32.random(in: 0xD800...0xDFFF) //â†’ 56324
```

### æ¨¡åå·®(Modulo bias)

ä»¥ä¸‹ä»£ç æ¼”ç¤ºäº†æˆ‘ä»¬å¸¸ç”¨çš„å–æ¨¡ æ–¹å¼éšæœº

``` swift
// Wrong! âŒ
let between0And5 = UInt8.random() % 6

```

è¿™ç§éšæœºæ•° æœ‰å¯èƒ½ä¸å¤Ÿå‡åŒ€åˆ†å¸ƒ,è¿™ç§éå‡åŒ€åˆ†å¸ƒçš„æ–¹å¼å°±å«[`æ¨¡åå·®`](https://www.quora.com/What-is-modulo-bias).

é‚£å¦‚ä½•è§£å†³è¿™ç§è«åå·®çš„é—®é¢˜å‘¢?

åœ¨swiftä¸­å°±æ˜¯ç”¨æˆ‘ä¸Šè¾¹ä»‹ç»çš„æ–¹æ³•.

``` swift
// Correct âœ…
let between0And5 = UInt8.random(in: 0..<6) // â†’ 5
```

å¦‚æœæˆ‘ä»¬éœ€è¦éšæœºä¸€ä¸ª`æ•°å­—æ•°æ®ç±»å‹`å…¨èŒƒå›´çš„éšæœºæ•°çš„è¯å¯ä»¥ä½¿ç”¨ `.min ... .max`æ¥è¿›è¡ŒèŒƒå›´éšæœº. å¦‚ä¸‹ä»£ç :

``` swift 
let between0And255 = UInt8.random(in: .min ... .max) // â†’ 190
```


### Boolå€¼éšæœº

è™½ç„¶è¿™ç§ç±»å‹å®Œå…¨å¯ä»¥ç”¨ %2 ==0 æˆ–è€… %2==0 æ¥è§£å†³,ä½†æ˜¯swiftè¿˜æ˜¯å¾ˆè´Ÿè´£ä»»çš„å¸®æˆ‘ä»¬åšåˆ°äº†è¿™ä¸€ç‚¹, ä¸¾ä¸ª`æŠ›ç¡¬å¸`åœºæ™¯çš„éšæœºä¾‹å­:

``` swift
func coinToss(count tossCount: Int) -> (heads: Int, tails: Int) {
    var result = (heads: 0, tails: 0)
    for _ in 0..<tossCount {
        let toss = Bool.random()
        if toss {
            result.heads += 1
        } else {
            result.tails += 1
        }
    }
    return result
}

let (heads, tails) = coinToss(count: 100)

// â†’ (heads 54, tails 46)
```

> heads â†’ äººå¤´é¢   
> tails â†’ èƒŒé¢

### å®¹å™¨ç±»å‹çš„å…ƒç´ éšæœº(Random collection elements)

é¦–å…ˆå¤§å®¶å¯ä»¥[`Collection`](https://developer.apple.com/documentation/swift/collection)ç†è§£æˆä¸€ä¸ªé›†æˆ`NSObject`çš„ç±»å®ç°äº†å®¹å™¨åè®®çš„ç±»å‹.eg: æ•°ç»„ï¼Œå­—å…¸ç­‰ç­‰ã€‚ã€‚ã€‚ã€‚

è¿™äº›`Collection` ç±»å‹éƒ½æœ‰ä¸€ä¸ª`randomElement()`æ–¹æ³•(å¯ä»¥çœ‹ä¸‹ä¸Šä¸€ç¯‡æ–‡ç« æœ«å°¾ä»‹ç»çš„10ä¸ªå­—ç¬¦ä¸²çš„æ•°).è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª`Optional`å¯é€‰ç±»å‹.å› ä¸º`Collection`å¯èƒ½ä¸ºç©º.

``` swift 
let emptyRange = 10..<10
emptyRange.isEmpty // â†’ true
emptyRange.randomElement() // â†’ nil
```
> å¯ä»¥çœ‹åˆ°å…ƒç´ éšæœºä¸ºnil

æˆ‘ä»¬ä¸¾ä¸ªä¸Šä¸€èŠ‚çš„ä¾‹å­è¿˜æµ‹è¯•ä¸€ä¸‹

``` swift
var arr = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]
let randomElement = arr.randomElement()!  // â†’ "8"
```

ä¸¾ä¸ªå­—ç¬¦ä¸²emotionè¡¨æƒ…çš„demo

``` swift
let emotions = "ğŸ˜€ğŸ˜‚ğŸ˜ŠğŸ˜ğŸ¤ªğŸ˜ğŸ˜©ğŸ˜­ğŸ˜¡"
let randomEmotion = emotions.randomElement()! // â†’ "ğŸ˜¡"
```

### Shuffling é›†åˆéšæœºæ’åˆ—(æ´—ç‰Œç®—æ³•)

ä½¿ç”¨[shuffled()](https://developer.apple.com/documentation/swift/sequence/2996816-shuffled)æ–¹æ³•å»éšæœºæ’åˆ—ä¸€ä¸ªåºåˆ—æˆ–å®¹æ˜“.

``` swift
(1...20).shuffled() 
// â†’ numbers is now [16, 9, 2, 18, 5, 13, 8, 11, 17, 3, 6, 1, 14, 7, 10, 15, 20, 19, 12, 4]
```

ä»¥ä¸Šå®ç°äº†ä¸€ä¸ªç±»ä¼¼æ´—ç‰Œç®—æ³•çš„æ’åº 1~20 ä¹‹é—´çš„æ•° æ³¨æ„ï¼šå·¦å³éƒ½æ˜¯é—­åŒºé—´(é—­åŒºé—´åŒ…å«æœ¬èº«) å› ä¸ºè¿™é‡Œç”¨çš„æ˜¯`...`,ä¸ç†è§£å¤§å®¶å¯ä»¥æŸ¥æ‰¾ä¸€ä¸‹swiftç›¸å…³åŒºé—´æ ‡è¯†çš„çŸ¥è¯†.

## éšæœºæ•°ç”Ÿæˆçš„åè®®ï¼ˆRandom number generatorsï¼‰

`Random number generators`ç®€ç§°`RNG`,ä»¥ä¸‹ç®€ç§°`RNG`.

### é»˜è®¤çš„RNG

ä»¥ä¸Šä»‹ç»çš„ä½¿ç”¨æ–¹æ³•éƒ½æ˜¯è¢«å®šä¹‰åœ¨swiftçš„æ ‡å‡†åº“ä¸­çš„æ–¹æ³•. å«[Random.default](https://forums.swift.org/t/se-0202-amendment-proposal-rename-random-to-defaultrandomnumbergenerator/12942)

[SE-0202](https://github.com/apple/swift-evolution/blob/master/proposals/0202-random-unification.md) è®¨è®ºäº†è¿™ç§é»˜è®¤éšæœºçš„ä¸€äº›é—®é¢˜

æˆ‘åœ¨è¿™é‡Œç®€è¦ä¸€ä¸‹

> The aspiration is that this RNG should be cryptographically secure, provide reasonable performance, and should be thread safe. If a vendor is unable to provide these goals, they should document it clearly. â€¦ if an RNG on a platform has the possibility of failing, then it must fail [i.e. trap] when it is unable to complete its operation.  
> å¤§æ¦‚æ„æ€å°±æ˜¯ é«˜æ€§èƒ½,é«˜å®‰å…¨æ€§,çº¿ç¨‹å®‰å…¨.... 

### è‡ªå®šä¹‰RNGs 

å¯¹äºå¤§å¤šæ•°ç®€å•çš„ç”¨ä¾‹ï¼Œç¼ºçœçš„RNGåº”è¯¥æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨çš„ä»£ç å¯¹éšæœºæ•°ç”Ÿæˆå™¨æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œæ¯”å¦‚ç‰¹å®šçš„ç®—æ³•æˆ–ç”¨å¯é‡å¤çš„ç§å­åˆå§‹åŒ–RNGçš„èƒ½åŠ›ï¼Œé‚£ä¹ˆæ‚¨å°±å¯ä»¥é€šè¿‡é‡‡ç”¨éšæœºæ•°ç”Ÿæˆå™¨åè®®æ¥å®ç°è‡ªå·±çš„RNGã€‚åè®®åªæœ‰ä¸€ä¸ªè¦æ±‚:`next()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•äº§ç”Ÿ`8ä¸ªæ–°çš„å­—èŠ‚éšæœºæ•°`:

``` swift
public protocol RandomNumberGenerator {
    /// Returns a value from a uniform, independent
    /// distribution of binary data.
    public mutating func next() -> UInt64
}
```

> æ³¨æ„:åè®®éœ€è¦ç»Ÿä¸€çš„åˆ†å¸ƒã€‚å…¶æ€æƒ³æ˜¯ï¼Œéœ€è¦å…·æœ‰éå‡åŒ€åˆ†å¸ƒçš„éšæœºå€¼çš„ç”¨æˆ·å¯ä»¥åœ¨ç¬¬äºŒæ­¥å°†æœŸæœ›çš„åˆ†å¸ƒåº”ç”¨åˆ°å‡åŒ€åˆ†å¸ƒéšæœºæ€§åºåˆ—é‡Œã€‚  
> å°±æ˜¯å¦‚æœæƒ³æŒ‰ç…§è‡ªå·±çš„æ–¹æ³•éšæœºéœ€è¦å§next()å‡½æ•°å†™ä¸Š,å†™å¥½æ³›å‹å‡½æ•°è§„åˆ™å°±è¡Œäº†.

### ä½¿ç”¨è‡ªå®šä¹‰éšæœºRNG

æ‰€æœ‰ç”¨äºç”Ÿæˆéšæœºå€¼çš„æ ‡å‡†åº“apiéƒ½æä¾›äº†å…è®¸ç”¨æˆ·ä¼ å…¥è‡ªå®šä¹‰éšæœºæ•°ç”Ÿæˆå™¨çš„æ–¹æ³•é‡è½½ã€‚ä¾‹å¦‚ï¼ŒIntç±»å‹æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•:

``` swift
extension Int {
    static func random(in range: Range<Int>) -> Int { ... }
    static func random<T>(in range: Range<Int>,
        using generator: inout T) -> Int
        where T: RandomNumberGenerator { ... }
    // The overloads that take a ClosedRange are not shown
}
```

è¿™ä¸ª`generator`å‚æ•°éœ€è¦æ€»æ˜¯ä¼ å…¥[`inout`](https://docs.swift.org/swift-book/ReferenceManual/Declarations.html#ID545),å› ä¸ºåœ¨äº§ç”Ÿæ–°çš„éšæœºæ€§æ—¶ï¼ŒRNGsé€šå¸¸ä¼šæ”¹å˜å®ƒä»¬çš„çŠ¶æ€ã€‚


ä¸‹é¢çœ‹ä¸‹æˆ‘ä»¬æ€ä¹ˆè°ƒç”¨è‡ªå®šä¹‰éšæœº, æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯å˜çš„å¹¶ä¸”æ»¡è¶³inoutçš„è¦æ±‚çš„æ–¹æ³•.

``` swift
var mersenneTwister = MersenneTwisterRNG(...) // assume this exists
Int.random(in: 10..<20, using: &mersenneTwister)
```


### åœ¨è‡ªæœ‰ç±»å‹ä¸­ç”Ÿæˆéšæœºå€¼

é€šè¿‡ä¸Šé¢æˆ‘ä»¬äº†è§£åˆ°

è‡ªå®šä¹‰éšæœºåè®®éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ ‡å‡†åº“æ¨¡å¼çš„æ­¥éª¤:

* æä¾›é™æ€éšæœºæ–¹æ³•`random() -> Self` è¿™ä¸ªæ–¹æ³•ä½¿ç”¨é»˜è®¤çš„RNG,å¦‚æœæˆ‘ä»¬è§„èŒƒéšæœºèŒƒå›´çš„æ—¶å€™è¿™ä¸ªå‡½æ•°èƒ½è¡¥å……é¢å¤–å‚æ•°.ä»¥ä¾¿äºæˆ‘ä»¬è§„èŒƒéšæœºçš„range.  
* æä¾›ç¬¬äºŒä¸ªæ–¹æ³•`random<T: RandomNumberGenerator>(using generator: inout T) -> Self`è¿™ä¸ªæ˜¯ç”Ÿæˆé»˜è®¤éšæœºæ•°çš„æ ¸å¿ƒæ–¹æ³•.


ä¸¾ä¸ªæ‰‘å…‹æ¸¸æˆä¸­çš„æšä¸¾ä¾‹å­, è¿™é‡Œé¢æˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨[`Swift4.2`](https://github.com/apple/swift-evolution/blob/master/proposals/0194-derived-collection-of-enum-cases.md)ä¸­çš„[allCase](https://developer.apple.com/documentation/swift/caseiterable)å±æ€§.

``` swift 
enum Suit: String, CaseIterable {
    case diamonds = "â™¦"
    case clubs = "â™£"
    case hearts = "â™¥"
    case spades = "â™ "
    
    static func random() -> Suit {
        return Suit.random(using: &Random.default)
    }
    
    static func random<T: RandomNumberGenerator>
        (using generator: inout T) -> Suit
    {
        // Force-unwrap can't fail as long as the
        // enum has at least one case.
        return allCases.randomElement(using: &generator)!
    }
}

let randomSuit = Suit.random() // â†’ clubs
randomSuit.rawValue // â†’ "â™ "
```


## æ€»ç»“

æœ¬ç¯‡è¡¥å……äº†æ–°ç‰ˆSwift4.2ä¸­å¯¹æ ‡å‡†åº“ä¸­çš„éšæœºå‡½æ•°æ”¯æŒ,ä¹Ÿä»‹ç»äº†æ´—ç‰Œå‡½æ•°é»˜è®¤éšæœºå‡åŒ€æ’åˆ—,å¸Œæœ›å°ä¼™ä¼´ä»¬çœ‹å®Œæœ‰æ‰€æ”¶è·,æœ‰é—®é¢˜è¿˜è¯·å¤šå¤šæŒ‡æ•™

å…¨æ–‡å®Œ


[å‚è€ƒ](https://oleb.net/blog/2018/06/random-numbers-in-swift/)




URL: https://sunyazhou.com/2018/06/Random/index.html.md
Published At: 2018-06-01 17:30:56 +0000

# Swiftä¸­çš„éšæœºæ•°

![](/assets/images/20180601Random/SwiftRandomNumbers.webp)

# å‰è¨€


ä»Šå¤©å„¿ç«¥èŠ‚,å†™ä¸€ç¯‡`éšæœºæ•°`æŠ€æœ¯æ–‡ç« çºªå¿µ`ç•™å®ˆå„¿ç«¥(èµ„æ·±)`çš„ç«¥å¹´.



## swiftä¸­çš„éšæœºæ•°ä½¿ç”¨

åœ¨æˆ‘ä»¬å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ç”¨åˆ°æ±‚å–ä¸€äº›éšæœºæ•°,ä»Šå¤©åˆ—ä¸¾å‡ ç§å†™ç¯‡æ–‡ç« 

## æ•´å‹éšæœºæ•°

é¦–å…ˆæ˜¯è¿™ä¸ªarc4random()

> `arc4random()`ä½¿ç”¨äº†`arc4`å¯†ç åŠ å¯†çš„`key` `stream`ç”Ÿæˆå™¨ï¼Œäº§ç”Ÿä¸€ä¸ª`[0, 2^32)`åŒºé—´çš„éšæœºæ•°(æ³¨æ„æ˜¯å·¦é—­å³å¼€åŒºé—´)ã€‚è¿™ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹æ˜¯`UInt32`

> æç¤º: _`[`å’Œ`]` åˆ†åˆ«ä»£è¡¨å·¦å³é—­åŒºé—´_,
> _`(`å’Œ`)`ä»£è¡¨å·¦å³å¼€åŒºé—´_
> ä¹Ÿå°±æ˜¯`ä¸­æ‹¬å·` -> ä»£è¡¨ é—­åŒºé—´, é—­åŒºé—´ä»£è¡¨åŒ…å«.  
> å°æ‹¬å· -> ä»£è¡¨å¼€åŒºé—´, å¼€åŒºé—´ä»£è¡¨ä¸åŒ…å«.  
> æ‰€ä»¥ä»¥ä¸‹çœ‹åˆ°

``` swift 
arc4random()   //"4058056034"
```

å¦‚æœæˆ‘ä»¬æƒ³ç”Ÿæˆä¸€ä¸ª**æŒ‡å®šèŒƒå›´å†…**çš„æ•´å‹éšæœºæ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨`arc4random()` `%` `upper_bound`çš„æ–¹å¼ï¼Œå…¶ä¸­`upper_bound`æŒ‡å®šçš„æ˜¯ä¸Šè¾¹ç•Œï¼Œå¦‚ä¸‹ä»£ç :

æ±‚ä¸€ä¸ª10ä»¥å†…çš„éšæœºæ•°

``` swift 
arc4random() % 10  // 0~9 æ³¨æ„æ²¡æœ‰10å“ˆ
```

ä¸è¿‡ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œåœ¨`upper_bound`ä¸æ˜¯`2`çš„å¹‚æ¬¡æ–¹æ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæ‰€è°“`Modulo bias`(æ¨¡åå·®)çš„é—®é¢˜ã€‚

å¯ä»¥ä½¿ç”¨`arc4random_uniform()`ï¼Œå®ƒæ¥å—ä¸€ä¸ª`UInt32`ç±»å‹çš„å‚æ•°ï¼Œ**æŒ‡å®šéšæœºæ•°åŒºé—´çš„ä¸Šè¾¹ç•Œ**`upper_bound`ï¼Œè¯¥å‡½æ•°ç”Ÿæˆçš„éšæœºæ•°èŒƒå›´æ˜¯[0, upper_bound)ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

``` swift 
arc4random_uniform(10)		// 5
```

é‚£é—®é¢˜æ¥äº†ï¼Ÿæˆ‘æƒ³æŒ‡å®šåŒºé—´éšæœº æ¯”å¦‚: `[10, 200)`.

``` swift 
let maxNum: UInt32 = 200
let minNum: UInt32 = 10
arc4random_uniform(maxNum - minNum) + minNum   // 153
```

å¯ä»¥çœ‹åˆ°ä¸Šè¿°ç»“æœ æ˜¯ `153`.

swiftä¹Ÿå¯ä»¥ç”¨Cå‡½æ•°ä¸­çš„éšæœº eg: random() æˆ–è€… rand(),ä½†æ˜¯è¿™äº›æœ‰ä¸‹é¢ç¼ºç‚¹:

* è¿™ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦åˆå§‹ç§å­ï¼Œé€šå¸¸æ˜¯ä»¥å½“å‰æ—¶é—´æ¥ç¡®å®š,å±äºä¼ªéšæœº.
* è¿™ä¸¤ä¸ªå‡½æ•°çš„ä¸Šé™åœ¨`RAND_MAX=0X7fffffff`(2147483647)ï¼Œæ˜¯`arc4random`çš„ä¸€åŠ.
* `rand()`å‡½æ•°ä»¥æœ‰è§„å¾‹çš„ä½ä½å¾ªç¯æ–¹å¼å®ç°ï¼Œæ›´å®¹æ˜“é¢„æµ‹

``` c
srand(UInt32(time(nil)))  // ç§å­,randomå¯¹åº”çš„æ˜¯srandom
rand()				      // 1,314,695,483
rand() % 10	   			  // 8
```

## 64ä½æ•´å‹éšæœºæ•°

æˆ‘ä»¬å‘ç°è¿™äº›å‡½æ•°ä¸»è¦éƒ½æ˜¯é’ˆå¯¹`32`ä½æ•´å‹æ•°æ¥æ“ä½œçš„.å¦‚æœéœ€è¦ç”Ÿæˆä¸€ä¸ª`64`ä½çš„æ•´å‹éšæœºæ•°å‘¢?

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç :

``` swift 
func arc4random <T: ExpressibleByIntegerLiteral> (type: T.Type) -> T {
    var r: T = 0
    arc4random_buf(&r, MemoryLayout<T>.size)
    return r
}
```
å¯ä»¥åƒä¸‹é¢è¿™æ ·è°ƒç”¨ 

``` swift
arc4random(type: UInt64.self) //8021765689869396105
arc4random(type: UInt32.self) //1293034028
arc4random(type: UInt16.self) //29059
arc4random(type: UInt8.self)  //183

```
> swift 4 è¯­æ³•

è¿™ä¸ªå‡½æ•°ä¸­ä½¿ç”¨äº†`arc4random_buf()`æ¥ç”Ÿæˆéšæœºæ•°ã€‚

è¿™ä¸ªå‡½æ•°ä½¿ç”¨ARC4åŠ å¯†çš„éšæœºæ•°æ¥å¡«å……è¯¥å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„é•¿åº¦çš„ç¼“å­˜åŒºåŸŸã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥çš„æ˜¯sizeof(UInt64)ï¼Œè¯¥å‡½æ•°ä¾¿ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°æ¥å¡«å……8ä¸ªå­—èŠ‚çš„åŒºåŸŸï¼Œå¹¶è¿”å›ç»™rã€‚é‚£ä¹ˆ64ä½çš„éšæœºæ•°ç”Ÿæˆæ–¹æ³•ä¾¿å¯ä»¥å¦‚ä¸‹å®ç°ï¼š

``` swift 
extension UInt64 {
    static func random(lower: UInt64 = min, upper: UInt64 = max) -> UInt64 {
        var m: UInt64
        let u = upper - lower
        var r = arc4random(type: UInt64.self)
        if u > UInt64(Int64.max) {
            m = 1 + ~u
        } else {
            m = ((max - (u * 2)) + 1) % u
        }
        while r < m {
            r = arc4random(type: UInt64.self)
        }
        return (r % u) + lower
    }
}
```

æˆ‘ä»¬æ¥è¯•ç”¨ä¸€ä¸‹ï¼š

``` swift
UInt64.random()      //9223372036854775807
```


## æµ®ç‚¹å‹éšæœºæ•°

å¦‚æœéœ€è¦ä¸€ä¸ªæµ®ç‚¹å€¼çš„éšæœºæ•°ï¼Œåˆ™å¯ä»¥ä½¿ç”¨drand48å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°äº§ç”Ÿä¸€ä¸ª[0.0, 1.0]åŒºé—´ä¸­çš„æµ®ç‚¹æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯Doubleç±»å‹ã€‚å…¶ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºï¼š


``` swift
srand48(Int(time(nil)))
drand48()  //0.4643666202473504
```

> æ³¨æ„:éœ€è¦å…ˆè°ƒç”¨srand48()ç”Ÿæˆç§å­

## ç¤ºä¾‹å®è·µ

å¦‚ä½•ç”Ÿæˆä¸€ä¸ª0~9 è¿™å‡ ä¸ªæ•°ç»„åšä¸ªéšæœºæ’åº,å®ç°ç±»ä¼¼é“¶è¡Œç±»åŠ¨æ€é”®ç›˜çš„åŠŸèƒ½

``` swift
var arr = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"]
arr.sort { (s1, s2) -> Bool in
    arc4random() < arc4random()
}

print(arr)
```

åœ¨é—­åŒ…ä¸­ï¼Œéšæœºç”Ÿæˆä¸¤ä¸ªæ•°ï¼Œæ¯”è¾ƒå®ƒä»¬ä¹‹é—´çš„å¤§å°ï¼Œæ¥ç¡®å®šæ•°ç»„çš„æ’åº.æ³¨æ„ä¸éœ€è¦é‡æ–°èµ‹å€¼äº†åœ¨swift4ä¸Š.


# æ€»ç»“

éšæœºæ•°ç›¸å…³çš„çŸ¥è¯†å®¹æ˜“å¿˜è®°,ç‰¹æ­¤è®°å½•ä¸€äº›æŠ€å·§,äº‰å–æ¯ä¸ªæœˆå‘å¸ƒä¸¤ç¯‡æ–‡ç« .

[å‚è€ƒ](http://southpeak.github.io/2015/09/26/ios-techset-5/)




URL: https://sunyazhou.com/2018/05/HowToCreateTopBottomRoundedCornersForViews/index.html.md
Published At: 2018-05-15 09:58:00 +0000

# UIViewä¸åŒæ–¹å‘çš„å¯¼è§’

![](/assets/images/20180515HowToCreateTopBottomRoundedCornersForViews/TopBottomCornerDemo.webp)

# å‰è¨€

å¼€å‘ä¸­æ€»å› ä¸ºä¸€äº›æ¯”è¾ƒè›‹ç–¼çš„å¯¼è§’é—®é¢˜è€Œå›°æ‰°ç€æˆ‘ä»¬,å°¤å…¶æ˜¯æˆ‘ä»¬è¦ç»™ä¸€ä¸ªUIViewå¯¼è§’æˆ å·¦ä¸Š ã€å·¦ä¸‹ã€‚ã€‚ã€‚

è¿™ç§éœ€æ±‚å¾ˆå€¼å¾—ç”¨ä»£ç å®ç°ä¸€ä¸‹, ä»Šå¤©çªç„¶åœ¨[AppCode](https://www.appcoda.com/rounded-corners-uiview/?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+appcoda+%28AppCoda%3A+Your+iOS+Programming+Community%29)æ‰¾åˆ°äº†ä¸€ç¯‡å¥½æ–‡ç« .äºæ˜¯æœ‰äº†ä¸‹æ–‡


## é€šå¸¸å¯¼è§’



``` swift 
self.view.cornerRadius = 20.0
self.view.clipToBounds = true
```

è¿™ä¸¤è¡Œä»£ç æ˜¯å…¨æ–¹å‘å¯¼è§’

å¦‚æœåƒè¦ææˆä¸åŒæ–¹å‘çš„è¯å¯ä»¥ç”¨iOS11 æ–°çš„APIå’Œ iOS11ä»¥å‰çš„`CAShapeLayer`ç”»è´èµ›å°”æ›²çº¿æ¥è§£å†³

é¦–å…ˆæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªUIView

``` swift
class ViewController: UIViewController {
    
    var cardView: UIView!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        cardView = UIView()
        view.addSubview(cardView)
        cardView.translatesAutoresizingMaskIntoConstraints = false
        //æŠŠViewå±…ä¸­
        cardView.widthAnchor.constraint(equalToConstant: 200).isActive = true
        cardView.heightAnchor.constraint(equalToConstant: 200).isActive = true
        cardView.centerXAnchor.constraint(equalTo: view.centerXAnchor).isActive = true
        cardView.centerYAnchor.constraint(equalTo: view.centerYAnchor).isActive = true
        cardView.backgroundColor = UIColor(red: 1.0, green: 0.784, blue: 0.2, alpha: 1)      
    }
}
```


iOS11 ä»¥åè‹¹æœæä¾›äº†ä¸€ä¸ª`UIView`çš„å±æ€§å«`maskedCorners`ç”¨äºCALayerçš„åŠ¨ç”»ç›¸å…³.

``` swift
public struct CACornerMask : OptionSet {

    public init(rawValue: UInt)

    
    public static var layerMinXMinYCorner: CACornerMask { get }

    public static var layerMaxXMinYCorner: CACornerMask { get }

    public static var layerMinXMaxYCorner: CACornerMask { get }

    public static var layerMaxXMaxYCorner: CACornerMask { get }
}

```

ä¸‹é¢æˆ‘è¯´ä¸€ä¸‹

* layerMinXMinYCorner åº•éƒ¨å³ä¾§ çš„åœ†è§’ -> å³ä¸‹è§’
* layerMaxXMinYCorner é¡¶éƒ¨å³ä¾§ çš„åœ†è§’ -> å³ä¸Šè§’
* layerMinXMaxYCorner åº•éƒ¨å·¦ä¾§ çš„åœ†è§’ -> å·¦ä¸‹è§’
* layerMinXMinYCorner é¡¶éƒ¨å·¦ä¾§ çš„åœ†è§’ -> å·¦ä¸Šè§’



ä¸€èˆ¬æˆ‘ä»¬éƒ½ä¸ºUIViewå†™ä¸ª extension

``` swift
extension UIView {
    func roundCorners(cornerRadius: Double) {
        self.layer.cornerRadius = CGFloat(cornerRadius)
        self.clipsToBounds = true
        
        if #available(iOS 11.0, *) {
            self.layer.maskedCorners = [.layerMinXMinYCorner, .layerMaxXMinYCorner]
        } else {
            let path = UIBezierPath(roundedRect: self.bounds, byRoundingCorners: [.topLeft, .topRight], cornerRadii: CGSize(width: cornerRadius, height: cornerRadius))
            let maskLayer = CAShapeLayer()
            maskLayer.frame = self.bounds
            maskLayer.path = path.cgPath
            self.layer.mask = maskLayer
        }
        
    }
}
```

è¿™é‡ŒåŒºåˆ†äº†iOS11ä¹‹å‰å’Œä¹‹åçš„ä¸¤ç§ææ³•.

ä¹‹å‰çš„è¯æˆ‘ä»¬éƒ½æ˜¯ç”¨ä¸€ä¸ªè´å¡å°”æ›²çº¿ç”»path.ç„¶ååˆ›å»ºCAShapeLayer ç»™self.layer.maskåšä¸€ç§é€æ˜çš„é®ç½©æ¥è§£å†³ä¸åŒæ–¹å‘å¯¼è§’é—®é¢˜.


## æ·»åŠ åŠ¨ç”»æ•ˆæœçš„å¯¼è§’


æˆ‘ä»¬åœ¨åŸViewDidLoad()æ–¹æ³•é‡Œé¢åŠ ä¸ªæ‰‹åŠ¿.

å¹¶å†™å¥½è§¦å‘çš„äº‹ä»¶, å®Œæ•´çš„ä»£ç å¦‚ä¸‹

``` swift
import UIKit

class ViewController: UIViewController {
    
    var cardView: UIView!
    
    override func viewDidLoad() {
        super.viewDidLoad()
        
        cardView = UIView()
        view.addSubview(cardView)
        cardView.translatesAutoresizingMaskIntoConstraints = false
        cardView.widthAnchor.constraint(equalToConstant: 200).isActive = true
        cardView.heightAnchor.constraint(equalToConstant: 200).isActive = true
        cardView.centerXAnchor.constraint(equalTo: view.centerXAnchor).isActive = true
        cardView.centerYAnchor.constraint(equalTo: view.centerYAnchor).isActive = true
        cardView.backgroundColor = UIColor(red: 1.0, green: 0.784, blue: 0.2, alpha: 1)
        
        
        let tapRecognizer = UITapGestureRecognizer(target: self, action: #selector(animateCornerChange(recognizer:)))
        cardView.addGestureRecognizer(tapRecognizer)
        
    }

    
    
    @objc func animateCornerChange(recognizer: UITapGestureRecognizer) {
        let targetRadius: Double = (cardView.layer.cornerRadius == 0.0) ? 100.0:0.0
        
        if #available(iOS 10.0, *) {
            UIViewPropertyAnimator(duration: 0.4, curve: .easeInOut) {
                self.cardView.roundCorners(cornerRadius: targetRadius)
                }.startAnimation()
        } else {
            UIView.animate(withDuration: 1.0, delay: 0.0, options: .curveEaseInOut, animations: {
                
            }, completion: nil)
        }
    }
}

extension UIView {
    func roundCorners(cornerRadius: Double) {
        self.layer.cornerRadius = CGFloat(cornerRadius)
        self.clipsToBounds = true
        
        if #available(iOS 11.0, *) {
            self.layer.maskedCorners = [.layerMinXMinYCorner, .layerMaxXMinYCorner]
        } else {
            let path = UIBezierPath(roundedRect: self.bounds, byRoundingCorners: [.topLeft, .topRight], cornerRadii: CGSize(width: cornerRadius, height: cornerRadius))
            let maskLayer = CAShapeLayer()
            maskLayer.frame = self.bounds
            maskLayer.path = path.cgPath
            self.layer.mask = maskLayer
        }
        
    }
}
```

### è¿™é‡Œä¸»è¦å¼ºè°ƒä¸€ä¸‹åŠ¨ç”»çš„æ–°API

iOS10ä¹‹åUå¢åŠ ä¸€ä¸ªæ–°çš„åŠ¨ç”»æ•ˆæœAPI

``` swift
UIViewPropertyAnimator(duration: 0.4, curve: .easeInOut) {
//è¿™é‡Œå†™ç›¸å…³Viewçš„æ“ä½œä»£ç  ã€‚ã€‚ã€‚eg:ä¸‹é¢ä»£ç 
                self.cardView.roundCorners(cornerRadius: targetRadius)
                }.startAnimation()
```

iOSä¹‹å‰å¯ä»¥é€šè¿‡å¤è€çš„APIæ¥å®ç°

``` swift
UIView.animate(withDuration: 1.0, delay: 0.0, options: .curveEaseInOut, animations: {
//è¿™é‡Œå†™ç›¸å…³Viewçš„æ“ä½œä»£ç  ã€‚ã€‚ã€‚eg:ä¸‹é¢ä»£ç 
                self.cardView.roundCorners(cornerRadius: targetRadius)
            }, completion: nil)
```


æœ€ç»ˆçš„æ•ˆæœ

![](/assets/images/20180515HowToCreateTopBottomRoundedCornersForViews/TopBottomCornerDemo.gif)



# æ€»ç»“

iOSä¸€äº›ç®€å•çš„åŠ¨ç”»å¯¼è§’æ¯”è¾ƒå¸¸ç”¨æ‰€ä»¥è®°å½•ä¸‹æ¥,å¸Œæœ›å¤§å®¶å¤šå¤šæŒ‡æ•™


[æœ¬æ–‡Demo](https://github.com/sunyazhou13/TopBottomCornerDemo)


URL: https://sunyazhou.com/2018/05/ManualControlUIViewControllerLifeCycle/index.html.md
Published At: 2018-05-08 12:01:27 +0000

# æ‰‹åŠ¨ç®¡ç†UIViewControllerçš„ç”Ÿå‘½å‘¨æœŸ

# å‰è¨€

è¯è¯´å¾ˆä¹…ä¸ç”¨UIViewControllerçš„ä¸å¸¸ç”¨ çš„APIæ¸æ¸çš„éƒ½æ²¡æœ‰äº†å°è±¡,åœ¨ iOS å®¢æˆ·ç«¯ä¸­ï¼Œå¤šä¸ª childViewController çš„é¡µé¢æ˜¯ä¸ªå¾ˆå¸¸è§çš„äº¤äº’è®¾è®¡,æœ€æ—©çš„ç½‘æ˜“æ–°é—»,ä»Šæ—¥å¤´æ¡ç­‰.è¿™ç¯‡æ–‡ç« å›å‘³ä¸€ä¸‹å¤è€çš„æ‰‹åŠ¨æ§åˆ¶è§†å›¾æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸçš„API.

# UIViewController

æˆ‘ä»¬åœ¨ä½¿ç”¨`addChildViewController:`çš„æ—¶å€™ä¼šé‡åˆ°ä¸ªé—®é¢˜.å¦‚ä½•æ‰‹åŠ¨æ§åˆ¶è¢«æ·»åŠ æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸ.

å¦‚ä¸‹ä»£ç 


``` objc
self.vc1 = [[VC1ViewController alloc] init]; //å­æ§åˆ¶å™¨
self.vc2 = [[VC2ViewController alloc] init]; //å­æ§åˆ¶å™¨
    
[self addChildViewController:self.vc1]; //æ·»åŠ åˆ°çˆ¶æ§åˆ¶å™¨ä¸­
[self.view addSubview:self.vc1.view];   //æŠŠå­æ§åˆ¶å™¨çš„ view æ·»åŠ åˆ°çˆ¶æ§åˆ¶å™¨çš„ view ä¸Šé¢
self.vc1.view.frame = CGRectMake(0, 0, 100, 100); //è®¾ç½® frame
[self.vc1 didMoveToParentViewController:self];//å­æ§åˆ¶å™¨è¢«é€šçŸ¥æœ‰äº†ä¸€ä¸ªçˆ¶æ§åˆ¶å™¨


    
[self addChildViewController:self.vc2];
[self.view addSubview:self.vc2.view];
self.vc2.view.frame = CGRectMake(0, 0, 100, 100);
[self.vc2 didMoveToParentViewController:self];//å­æ§åˆ¶å™¨è¢«é€šçŸ¥æœ‰äº†ä¸€ä¸ªçˆ¶æ§åˆ¶å™¨
```

å¦‚æœæ˜¯ç§»é™¤çš„è¯ä½¿ç”¨å¦‚ä¸‹ä»£ç 

``` objc
//ç§»é™¤ä¸€ä¸ª childViewController
[self.vc1 willMoveToParentViewController:nil];//å­æ§åˆ¶å™¨è¢«é€šçŸ¥å³å°†è§£é™¤çˆ¶å­å…³ç³»
[self.vc1.view removeFromSuperview];//æŠŠå­æ§åˆ¶å™¨çš„ view ä»åˆ°çˆ¶æ§åˆ¶å™¨çš„ view ä¸Šé¢ç§»é™¤
[self.vc1 removeFromParentViewController];//çœŸæ­£çš„è§£é™¤å…³ç³»,ä¼šè‡ªå·±è°ƒç”¨ [self.vc1 didMoveToParentViewController:nil]

```


å½“æˆ‘ä»¬æ·»åŠ childåˆ°çˆ¶æ§åˆ¶å™¨çš„æ—¶å€™
å®ƒçš„

``` objc
- (void)viewWillAppear:(BOOL)animated{
    [super viewWillAppear:animated];
}

- (void)viewDidAppear:(BOOL)animated{
    [super viewDidAppear:animated];
}

- (void)viewWillDisappear:(BOOL)animated{
    [super viewWillDisappear:animated];
    
}

- (void)viewDidDisappear:(BOOL)animated{
    [super viewDidDisappear:animated];
}
```
è¿™äº›æ”¾ç³»ç»Ÿå†…éƒ¨ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬è°ƒç”¨

#### æ‰‹åŠ¨ç®¡ç†child ViewController çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•

éœ€è¦åœ¨çˆ¶ViewControlleré‡Œé¢å¤å†™å¦‚ä¸‹æ–¹æ³• å¹¶è¿”å›`NO`

``` objc
- (BOOL)shouldAutomaticallyForwardAppearanceMethods{
    //æ‰‹åŠ¨ç®¡ç†å­VCçš„ç”Ÿå‘½å‘¨æœŸ
    return NO;
}
```

ä¸è¿‡æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸èƒ½æ‰‹åŠ¨è°ƒç”¨ viewWillAppearã€viewDidAppearç­‰ç­‰è¿™äº›æ–¹æ³•ï¼Œè€Œåº”è¯¥è°ƒç”¨ï¼š

``` objc
- (void)beginAppearanceTransition:(BOOL)isAppearing animated:(BOOL)animated;
- (void)endAppearanceTransition;
```

> æ³¨æ„:_**ç”¨è¿™ä¸¤ä¸ªæ–¹æ³•æ¥é—´æ¥è§¦å‘å­æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”å®ƒä»¬éœ€è¦æˆå¯¹ä½¿ç”¨**_


`isAppearing` è®¾ç½®ä¸º `YES` : è§¦å‘ `viewWillAppear:`;  

`isAppearing` è®¾ç½®ä¸º `NO` : è§¦å‘ `viewWillDisappear:`;

`endAppearanceTransition`æ–¹æ³•ä¼šåŸºäºæˆ‘ä»¬ä¼ å…¥çš„`isAppearing`  
æ¥è°ƒç”¨`viewDidAppear:`ä»¥åŠ`viewDidDisappear:`æ–¹æ³•



ä¸ºäº†æµ‹è¯•æˆ‘å†™ä¸€æ®µä»£ç 

``` objc
- (IBAction)click:(UIButton *)sender {
    sender.selected = !sender.selected;
    if (sender.selected) {
        [self.vc1 beginAppearanceTransition:NO animated:YES];  //è°ƒç”¨vc1çš„ viewWillDisappear:
        [self.vc2 beginAppearanceTransition:YES animated:YES];  //è°ƒç”¨vc2çš„ viewWillAppear:
        [self.vc1 endAppearanceTransition]; //è°ƒç”¨vc1çš„viewDidDisappear: 
        [self.vc2 endAppearanceTransition]; //è°ƒç”¨vc2çš„viewDidAppear:
    } else {
        [self.vc1 beginAppearanceTransition:YES animated:YES];
        [self.vc2 beginAppearanceTransition:NO animated:YES];
        [self.vc1 endAppearanceTransition];
        [self.vc2 endAppearanceTransition];
    }
}

```

[Demo](https://github.com/sunyazhou13/VCLifeCycle)

å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2018/05/AudioUnit/index.html.md
Published At: 2018-05-07 14:59:41 +0000

# AudioUnit

![](/assets/images/20180507AudioUnit/auHostApp.webp)

# å‰è¨€


å£°éŸ³çš„æ¸²æŸ“åœ¨iOSå¹³å°ä¸Šå›ç›´æ¥ä½¿ç”¨`AudioUnit`çš„APIæ¥å®Œæˆ.ç”¨æ¥å®ç°ä¸€äº›ç±»ä¼¼`å¤§å”`,`KTV`,`è€³è¿”ç­‰æ•ˆæœ`....

ä»Šå¤©å¸¦é¢†å¤§å®¶æ·±å…¥äº†è§£å’Œå­¦ä¹ ä¸€ä¸‹è¿™äº›éŸ³æ•ˆ.


## å®ç°iOSå˜å£°çš„èƒŒæ™¯

å£°éŸ³å˜å£°ä¸€èˆ¬éƒ½æ˜¯å‘ç”Ÿåœ¨ ä¸€ç«¯é‡‡é›†å½•åˆ¶å¦ä¸€ç«¯æ’­æ”¾éŸ³é¢‘, å¿½ç•¥ä¸­é—´çš„è½¬ç è¿‡ç¨‹,åœ¨è¾“å…¥è¾“å‡ºçš„ä¸­é—´è¿‡ç¨‹ä¸­è¿›è¡Œç›¸åº”çš„éŸ³é¢‘å‚æ•°å°±å®ç°äº†å˜å£°. 

ä¸‹å›¾æ˜¯AVAudioSessionçš„å·¥ä½œæµ
![](/assets/images/20180507AudioUnit/ASPGIntro.webp)

å¤§å®¶å¸¸ç”¨çš„å˜å£°æ–¹æ¡ˆæœ‰å¾ˆå¤š:

1. FFMpegæä¾›å†…éƒ¨æ•ˆæœå™¨ eg:EQå‡è¡¡å™¨  
2. AVFoundationåº•å±‚çš„`Audio Unit` eg: æ··å“reverb
3. SoundTouch
4. å…¶å®ƒæ–¹æ¡ˆ...


è¿™é‡Œæˆ‘ä»¬é€‰ç”¨iOS AVFoundationæœ¬èº«æä¾›çš„éŸ³é¢‘å¤„ç†å•å…ƒ`Audio Unit`. 

`Audio Unit`æä¾›å¦‚ä¸‹åŠŸèƒ½:

* ä½å»¶è¿Ÿçš„éŸ³é¢‘I/O eg:voip
* å¤šè·¯å£°éŸ³çš„åˆæˆå¹¶å›æ”¾ eg:æ¸¸æˆä¸­çš„éŸ³ä¹åˆæˆå™¨
* Audio Unit è‡ªèº«æä¾› egï¼šå›å£°æ¶ˆé™¤ã€Mixä¸¤è½¨éŸ³é¢‘ã€å‡è¡¡å™¨ã€å‹ç¼©å™¨ã€æ··å“æ•ˆæœå™¨ç­‰.
* éœ€è¦å›¾çŠ¶çš„ç»“æ„æ¥å¤„ç†éŸ³é¢‘. eg: æœ‰ç‚¹ç±»ä¼¼PCæ—¶ä»£çš„ä¸»æ’­ç»å¸¸ç”¨çš„ä¸€ç§å«KX é©±åŠ¨. 

ä¸‹å›¾æ˜¯KX é©±åŠ¨è¿çº¿å›¾ windowså¹³å° 

![](/assets/images/20180507AudioUnit/kx.webp)

## AudioUnitä»‹ç»


#### iOSå±‚çº§æ¶æ„å›¾

![](/assets/images/20180507AudioUnit/iPhone0sAudioArchitecture.webp)

![](/assets/images/20180507AudioUnit/AboutAudioUnitHosting.webp)

> å£°éŸ³çš„å¤„ç†è¿‡ç¨‹, é¦–å…ˆéœ€è¦è®¤è¯†ä¸€ä¸‹`AUGraph`

![](/assets/images/20180507AudioUnit/simpleAuChain.webp)

> **audio processing graph**:  A representation of a signal chain comprising an interconnection of audio units. Also called an AUGraph or graph. Core Audio represents such an interconnected network as a software object of typeAUGraph. Audio processing graphs must end in an output unit. See also audio unit.  
> ä¸€ç§ä¿¡å·é“¾çš„è¡¨ç¤ºï¼ŒåŒ…æ‹¬éŸ³é¢‘å•å…ƒçš„äº’è¿ã€‚ä¹Ÿç§°ä¸ºAUGraphæˆ–graphã€‚Core Audioä»£è¡¨ç€è¿™æ ·ä¸€ä¸ªç›¸äº’è¿æ¥çš„ç½‘ç»œï¼Œå®ƒæ˜¯ä¸€ä¸ª`AUGraph`ç±»å‹çš„å¯¹è±¡ã€‚



#### audio unit ç»“æ„å›¾(å·¥ä½œæµ)

![](/assets/images/20180507AudioUnit/auArchitecture.webp)

#### Audio Unit æ„æˆå›¾

![](/assets/images/20180507AudioUnit/AudioUnitScopes.webp)

Unit ä¸€èˆ¬ åˆ†ä¸º Element0 å’Œ  Element1


ä¸‹é¢æˆ‘ä»¬ä¸¾Remote I/O Unitä¸ºä¾‹:  

RemoteIO è¿™ä¸ªUnitæ˜¯å’Œç¡¬ä»¶IOç›¸å…³çš„Unitï¼Œå®ƒåˆ†ä¸ºè¾“å…¥ç«¯å’Œè¾“å‡ºç«¯, è¾“å…¥ç«¯ä¸€èˆ¬æŒ‡éº¦å…‹é£,è¾“å‡ºç«¯ä¸€èˆ¬æŒ‡æ‰¬å£°å™¨.


> `Element0` æ§åˆ¶è¾“å‡º  
> `Element1` æ§åˆ¶è¾“å…¥   
> å›¾ä¸­Element ä¹Ÿå« busï¼›  
> éŸ³é¢‘æµä»è¾“å…¥åŸŸï¼ˆinput scopeï¼‰è¾“å…¥ï¼Œ ä»è¾“å‡ºåŸŸï¼ˆoutput scopeï¼‰è¾“å‡º
> æ•´ä¸ªRenderè¿‡ç¨‹å°±æ˜¯ä¸€æ¬¡RenderCycle
  

![](/assets/images/20180507AudioUnit/IOUnit.webp)

__åŒæ—¶æ¯ä¸ªElementåˆ†ä¸ºInput Scope å’Œ Output Scope.å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨æ‰¬å£°å™¨çš„å£°éŸ³æ’­æ”¾åŠŸèƒ½,å¿…é¡»éœ€å°†è¿™ä¸ªUnitçš„`Element0`çš„`OutputScope`å’ŒSpeakè¿›è¡Œè¿æ¥. å¦‚æœæƒ³ä½¿ç”¨éº¦å…‹é£å½•éŸ³åŠŸèƒ½,é‚£ä¹ˆå¿…é¡»å°†è¿™ä¸ªUnitçš„`Element1`çš„`InputScope`å’Œéº¦å…‹é£è¿›è¡Œè¿æ¥.__


### æ„å»ºAudio Unit

é¦–å…ˆéœ€è¦å¯ç”¨éŸ³é¢‘ä¼šè¯ è¿™äº›å¤§å®¶è‡ªå·±é…ç½®å°±å¥½ äº† 

``` 
	//é…ç½®ä¼šè¯ç›¸å…³ä¼ªä»£ç 
	[[AVAudioSession sharedInstance].xxxxx xxxxx];
```

å¦‚ä½•ç”¨ä»£ç æ„å»ºä¸€ä¸ªAudio Unitï¼Ÿ è¿™é‡Œæˆ‘ä»¬ä»¥Remote I/O Unit ä¸ºä¾‹:

åˆ›å»ºAudioUnitæœ‰ä¸¤ç§æ–¹å¼

1. ç›´æ¥ä½¿ç”¨AudioUnitè£¸åˆ›å»º 
2. ä½¿ç”¨AUGraphå’ŒAUNodeæ¥æ„å»º



* ç¬¬ä¸€ç§ è£¸åˆ›å»º

``` objc
#import "ViewController.h"
#import <AudioUnit/AudioUnit.h>
@interface ViewController ()
{
    AudioUnit ioUnitInstance; //å£°æ˜ä¸€å˜é‡
}

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    //é¦–å…ˆæ„é€ å‡ºè¦ç”¨åˆ°åˆ›å»ºUnitçš„ç»“æ„ä½“
    AudioComponentDescription ioUnitDescription;
    ioUnitDescription.componentType = kAudioUnitType_Output;
    ioUnitDescription.componentSubType = kAudioUnitSubType_RemoteIO;
    ioUnitDescription.componentManufacturer = kAudioUnitManufacturer_Apple;
    ioUnitDescription.componentFlags = 0;
    ioUnitDescription.componentFlagsMask = 0;
    
    AudioComponent ioUnitRef = AudioComponentFindNext(NULL, &ioUnitDescription);
    //åˆ›å»ºAudioUnitå®ä¾‹
    AudioComponentInstanceNew(ioUnitRef, &ioUnitInstance);
}
```


* ç¬¬äºŒç§ä½¿ç”¨AUGraphå’ŒAUNode

``` objc
#import "ViewController.h"
#import <AudioUnit/AudioUnit.h>
#import <AudioToolbox/AudioToolbox.h>
@interface ViewController ()
{
    AUGraph     processingGraph;
    AUNode      ioNode;
    AudioUnit   ioUnit;
}

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    //é¦–å…ˆæ„é€ å‡ºè¦ç”¨åˆ°åˆ›å»ºUnitçš„ç»“æ„ä½“
    AudioComponentDescription ioUnitDescription;
    ioUnitDescription.componentType = kAudioUnitType_Output;
    ioUnitDescription.componentSubType = kAudioUnitSubType_RemoteIO;
    ioUnitDescription.componentManufacturer = kAudioUnitManufacturer_Apple;
    ioUnitDescription.componentFlags = 0;
    ioUnitDescription.componentFlagsMask = 0;
    
    //1 new
    NewAUGraph(&processingGraph);
    AUGraphAddNode(processingGraph, &ioUnitDescription, &ioNode);
    
    //2 open
    AUGraphOpen(processingGraph);
    
    //3 ä»ç›¸åº”çš„Nodeä¸­è·å¾—AudioUnit
    AUGraphNodeInfo(processingGraph, ioNode, NULL, &ioUnit);
    
}

```

> æ¨èä½¿ç”¨ç¬¬äºŒç§å› ä¸ºè¿™ç§åˆ›å»ºæ‰©å±•æ€§æ›´é«˜ä¸€äº›  
> æ³¨æ„:__*AUNodeå¿…é¡»å’ŒAudioUnitæˆå¯¹å‡ºç°*__



å¦‚ä¸‹å›¾ ï¼šRemote I/O Unit 

![](/assets/images/20180507AudioUnit/IOUnit.webp)

> éº¦å…‹é£æˆ–è€…æ‰¬å£°å™¨åœ¨Audio Unitä¸­æœ‰ç›¸åº”çš„æšä¸¾.  
> ç›´æ’­ä¸­çš„`è€³è¿”`å°±æ˜¯ç”¨çš„è¿™ä¸ªæŠŠéº¦å…‹é£é‡‡é›†çš„æ•°æ®ç›´æ¥æ‰”ç»™æ‰¬å£°å™¨ è¿™æ ·å°±èƒ½åšåˆ° ä½å»¶è¿Ÿçš„å®æ—¶å¬åˆ°éº¦å…‹é£çš„å£°éŸ³.  
> ç›´æ’­ä¸­ä¸€èˆ¬ä½¿ç”¨`Remote I/O` unitæ¥è¿›è¡Œé‡‡é›†å·¥ä½œ

ä½¿ç”¨AudioUnitè¿æ¥æ‰¬å£°å™¨

``` objc
OSStatus status = noErr;
UInt32 onFlag = 1;
UInt32 busZero = 0; //Element0  å°±æ˜¯bus0
status = AudioUnitSetProperty(remoteIOUnit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Output, busZero, &onFlag, sizeof(onFlag));
CheckStatus(status, @"ä¸èƒ½è¿æ¥æ‰¬å£°å™¨", YES);
    
```

> æ³¨æ„: kAudioUnitScope_Output å°±æ˜¯è¿æ¥æ‰¬å£°å™¨çš„key

è¿æ¥éº¦å…‹é£

``` objc
OSStatus status = noErr;
UInt32 busOne = 1; //Element1 å°±æ˜¯bus1 æ¥éº¦å…‹é£è¾“å…¥
UInt32 oneFlag = 1;
status =  AudioUnitSetProperty(remoteIOUnit, kAudioOutputUnitProperty_EnableIO, kAudioUnitScope_Input, busOne, &oneFlag, sizeof(oneFlag));
CheckStatus(status, @"ä¸èƒ½è¿æ¥éº¦å…‹é£", YES);
```

å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç æ£€æŸ¥æ¯ä¸€æ­¥æ‰§è¡Œå‡ºé”™debug  

``` objc
static void CheckStatus(OSStatus status, NSString *message, BOOL fatal) {
    if (status != noErr) {
        char fourCC[16];
        *(UInt32 *)fourCC = CFSwapInt32HostToBig(status);
        fourCC[4] = '\0';
        if (isprint(fourCC[0]) && isprint(fourCC[1]) &&
            isprint(fourCC[2]) && isprint(fourCC[4])) {
            NSLog(@"%@:%s",message, fourCC);
        } else {
            NSLog(@"%@:%d",message, (int)status);
        }
        
        if (fatal) {
            exit(-1);
        }
    }
}
```

> ç”±äºstatusæ¯æ¬¡æŠ¥é”™éƒ½æ‰“å° ç›¸å…³æ•°å­—å¤§å®¶å¯èƒ½ä¸ç†è§£å¯ä»¥ç‚¹å‡»[OSStatus](https://www.osstatus.com/) æŸ¥è¯¢ç›¸å…³é”™è¯¯ç 

#### AVAudioMix

æˆ‘ä»¬ä¸€èˆ¬éƒ½åœ¨é‡‡é›†ã€å½•åˆ¶æˆ–ç¼–è¾‘éŸ³è§†é¢‘ç›¸åº”çš„ç±»ä¸­ä½¿ç”¨AVAudioMixer.

ä¸¾ä¸ªä¾‹å­:æˆ‘ä»¬å˜å£°å®ç°çš„æµç¨‹å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ __AVAudioPlayer -> AVPlayerItem -> AVAudioMixer-> AUGraph -> AUNode + AudioUnit__


![](/assets/images/20180507AudioUnit/AVAudioMixClass.webp)

#### AudioStreamBasicDescription é…ç½®éº¦å…‹é£è¾“å…¥çš„å‚æ•°

å½“æˆ‘ä»¬æ§åˆ¶Remote IO Unitçš„æ—¶å€™æƒ³å‘Šè¯‰éº¦å…‹é£ å„ç§inputçš„å‚æ•° å¯ä»¥é€šè¿‡ ä¸€ä¸ªå«ASBD æ ¼å¼çš„ç»“æ„ä½“æ•°æ®æè¿°æ¥è®¾ç½®ç»™ç›¸åº”çš„Unit


##### Audio Stream Format æè¿°ASBD

``` objc
UInt32 bytePerSample = sizeof(Float32);
AudioStreamBasicDescription asbd;
bzero(&asbd, sizeof(asbd));
asbd.mFormatID = kAudioFormatLinearPCM;
asbd.mSampleRate = 44100;
asbd.mChannelsPerFrame = channels;
asbd.mFramesPerPacket = 1;
asbd.mFormatFlags = kAudioFormatFlagsNativeFloatPacked | kAudioFormatFlagIsNonInterleaved;
asbd.mBitsPerChannel = 8 * bytePerSample;
asbd.mBytesPerFrame = bytePerSample;
asbd.mBytesPerPacket = bytePerSample;
    
```

> ä¸Šè¾¹ä»£ç å±•ç¤ºäº†å¦‚ä½•å¡«å……ASBDç»“æ„ä½“,è¿™ä¸ªæè¿°éŸ³è§†é¢‘çš„å…·ä½“æ ¼å¼.


ä¸‹é¢å…·ä½“ä»‹ç»ä¸€ä¸‹å„ä¸ªå‚æ•°çš„æ„æ€

* mFormatID å¯ç”¨æ¥æŒ‡å®šç¼–ç æ ¼å¼ eg:PCM
* mSampleRate é‡‡æ ·ç‡
* mChannelsPerFrame æ¯ä¸ªFrameæœ‰å‡ ä¸ªchannel
* mFramesPerPacket æ¯ä¸ªPacketæœ‰å‡ Frame
* mFormatFlags è¿™ä¸ªæ˜¯ç”¨æ¥æè¿°å£°éŸ³æ ¼å¼è¡¨ç¤ºæ ¼å¼çš„å‚æ•°,ä¸Šé¢ä»£ç æˆ‘ä»¬æŒ‡å®šçš„æ˜¯æ¯ä¸ªsampleçš„è¡¨ç¤ºæ ¼å¼ä¸ºFloatæ ¼å¼,æœ‰ç‚¹ç±»ä¼¼SInt16,å¦‚æœåè¾¹æ˜¯NonInterleavedä»£è¡¨éäº¤é”™çš„,å¯¹äºè¿™ä¸ªéŸ³é¢‘æ¥è®²å°±æ˜¯å·¦å³å£°é“çš„æ˜¯éäº¤é”™å­˜æ”¾çš„,å®é™…çš„éŸ³é¢‘æ•°æ®ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªAudioBufferListç»“æ„ä¸­çš„å˜é‡mBuffersä¸­,å¦‚æœmFormatFlagsæŒ‡å®šçš„æ˜¯NonInterleaved,é‚£ä¹ˆå·¦å£°é“å°±åœ¨ä¼šåœ¨mBuffers[0]é‡Œé¢,å³å£°é“å°±åœ¨mBuffers[1]é‡Œé¢.
* mBitsPerChannel è¡¨ç¤ºä¸€ä¸ªå£°é“çš„éŸ³é¢‘æ•°æ®ç”¨å¤šå°‘ä½æ¥è¡¨ç¤º,ä¸Šé¢æˆ‘ä»¬ç”¨çš„æ˜¯Floatæ¥è¡¨ç¤º, æ‰€ä»¥è¿™é‡Œä½¿ç”¨çš„æ˜¯ 8 ä¹˜ä»¥ æ¯ä¸ªé‡‡æ ·çš„å­—èŠ‚æ•°æ¥èµ‹å€¼.
* mBytesPerFrame å’Œ mBytesPerPacket è¿™ä¸¤ä¸ªçš„èµ‹å€¼éœ€è¦æ ¹æ®mFormatFlags çš„å€¼æ¥è¿›è¡Œåˆ†é…,å¦‚æœæ˜¯NonInterleavedéäº¤é”™çš„æƒ…å†µä¸‹, å°±èµ‹å€¼bytePerSample(å› ä¸ºå·¦å³å£°é“æ˜¯åˆ†å¼€çš„).ä½†å¦‚æœæ˜¯Interleavedçš„è¯,é‚£å°±åº”è¯¥æ˜¯ bytePerSample * channels (å› ä¸ºå·¦å³å£°é“æ˜¯äº¤é”™å­˜æ”¾),è¿™æ ·æ‰èƒ½è¡¨ç¤ºä¸€ä¸ªFrameé‡Œé¢åˆ°åº•æœ‰å¤šå°‘byte.

è®²äº†è¿™ä¹ˆå¤š é‚£æˆ‘ä»¬æ€ä¹ˆæŠŠè¿™ä¸ªASDBç»™ Unit?

å¦‚ä¸‹ä»£ç  è®¾ç½®ASBDç»™ç›¸åº”çš„Audio Unit

``` objc
AudioUnitSetProperty(remoteIOUnit, kAudioUnitProperty_StreamFormat, kAudioUnitScope_Output, 1, &asbd, sizeof(asbd));
```

å®Œæ•´çš„ä»£ç å¦‚ä¸‹

``` objc
//è®¾ç½®ASBD
AudioStreamBasicDescription inputFormat;
inputFormat.mSampleRate = 44100;
inputFormat.mFormatID = kAudioFormatLinearPCM;
inputFormat.mFormatFlags = kAudioFormatFlagIsSignedInteger | kAudioFormatFlagIsNonInterleaved;
inputFormat.mFramesPerPacket = 1;
inputFormat.mChannelsPerFrame = 1;
inputFormat.mBytesPerPacket = 2;
inputFormat.mBytesPerFrame = 2;
inputFormat.mBitsPerChannel = 16;
//è®¾ç½®ç»™è¾“å…¥ç«¯ é…ç½®éº¦å…‹é£è¾“å‡ºçš„æ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼
OSStatus status = noErr;
status = AudioUnitSetProperty(audioUnit,
                              kAudioUnitProperty_StreamFormat,
                              kAudioUnitScope_Output,
                              InputBus,
                              &inputFormat,
                              sizeof(inputFormat));
CheckStatus(status, @"AudioUnitGetProperty bus1 output ASBD error", YES);
```


### Audio Unit åˆ†ç±»

``` objc
CF_ENUM(UInt32) {
	kAudioUnitType_Output					= 'auou',
	kAudioUnitType_MusicDevice				= 'aumu',
	kAudioUnitType_MusicEffect				= 'aumf',
	kAudioUnitType_FormatConverter			= 'aufc',
	kAudioUnitType_Effect					= 'aufx',
	kAudioUnitType_Mixer					= 'aumx',
	kAudioUnitType_Panner					= 'aupn',
	kAudioUnitType_Generator				= 'augn',
	kAudioUnitType_OfflineEffect			= 'auol',
	kAudioUnitType_MIDIProcessor			= 'aumi'
};
```

| åˆ†ç±» | åŠŸèƒ½/ä½œç”¨ |ç±»å‹ |
| :------ | :------ | :------ |
| Effect Unit | æä¾›å£°éŸ³ç‰¹æ•ˆå¤„ç†| kAudioUnitType_Effect |
| Mixer Units | æä¾›Mixå¤šè·¯å£°éŸ³çš„åŠŸèƒ½ | kAudioUnitType_Mixer|
| I/O Units | I/O é‡‡é›†éŸ³é¢‘ä¸æ’­æ”¾éŸ³é¢‘åŠŸèƒ½| kAudioUnitType_Output |
| AUConverter Units | æ ¼å¼è½¬æ¢ eg:é‡‡æ ·æ ¼å¼Floatè½¬SInt16ã€äº¤é”™æˆ–å¹³é“ºã€å•åŒå£°é“çš„è½¬æ¢| kAudioUnitType_FormatConverter |
| Generator Units | æä¾›æ’­æ”¾å™¨åŠŸèƒ½ | kAudioUnitType_Generator |


``` objc
CF_ENUM(UInt32) {
	kAudioUnitSubType_PeakLimiter			= 'lmtr',
	kAudioUnitSubType_DynamicsProcessor		= 'dcmp',
	kAudioUnitSubType_LowPassFilter			= 'lpas',
	kAudioUnitSubType_HighPassFilter		= 'hpas',
	kAudioUnitSubType_BandPassFilter		= 'bpas',
	kAudioUnitSubType_HighShelfFilter		= 'hshf',
	kAudioUnitSubType_LowShelfFilter		= 'lshf',
	kAudioUnitSubType_ParametricEQ			= 'pmeq',
	kAudioUnitSubType_Distortion			= 'dist',
	kAudioUnitSubType_Delay					= 'dely',
	kAudioUnitSubType_SampleDelay			= 'sdly',
	kAudioUnitSubType_NBandEQ				= 'nbeq'
};


CF_ENUM(UInt32) {
	kAudioUnitSubType_Reverb2				= 'rvb2',
	kAudioUnitSubType_AUiPodEQ				= 'ipeq'
};

```


#### Effect Unit å­ç±»å‹åŠç”¨é€”è¯´æ˜

| å­ç±»å‹ | ç”¨é€”è¯´æ˜ | å­æšä¸¾ç±»å‹ |
| :------ | :------ | :------ |
|å‡è¡¡æ•ˆæœå™¨ | ä¸ºå£°éŸ³çš„æŸäº›[é¢‘å¸¦](https://baike.baidu.com/item/%E9%A2%91%E5%B8%A6)å¢å¼ºæˆ–è¡°å‡èƒ½é‡ï¼Œæ•ˆæœå™¨éœ€è¦æŒ‡å®šå¤šä¸ªé¢‘å¸¦,ç„¶åä¸ºå„é¢‘å¸¦è®¾ç½®å¢ç›Šæœ€ç»ˆæ”¹å˜å£°éŸ³åœ¨éŸ³åŸŸä¸Šçš„èƒ½é‡åˆ†å¸ƒ | kAudioUnitSubType_NBandEQ|
| å‹ç¼©æ•ˆæœå™¨ | å½“å£°éŸ³è¾ƒå°æˆ–è¾ƒå¤§é€šè¿‡è®¾ç½®é˜€å€¼æ¥æé«˜æˆ–é™ä½å£°éŸ³èƒ½é‡ eg:ä½œç”¨æ—¶é—´ã€é‡Šæ”¾æ—¶é—´ã€ä»¥åŠè§¦å‘å€¼ä»è€Œæœ€ç»ˆæ§åˆ¶å£°éŸ³åœ¨æ—¶åŸŸä¸Šçš„èƒ½é‡èŒƒå›´ | kAudioUnitSubType_DynamicsProcessor |
| æ··å“æ•ˆæœå™¨ | é€šè¿‡å£°éŸ³åå°„çš„å»¶è¿Ÿæ§åˆ¶å£°éŸ³æ•ˆæœ | kAudioUnitSubType_Reverb2 |

> Effect Unit ä¸‹æœ€å¸¸ç”¨çš„æ•ˆæœå™¨å°±ä¸Šè¾¹è¿™ä¸‰ç§, åƒé«˜é€š(High Pass)ã€ä½é€š(Low Pass)ã€å¸¦é€š(Band Pass)ã€å»¶è¿Ÿ(Delay)ã€å‹é™(Limiter) ç­‰è¿™äº›ä¸æ˜¯å¾ˆå¸¸ç”¨,å¦‚æœå¤§å®¶å¯¹è¿™ä¸ªå¾ˆç†Ÿæ‚‰å¯ä»¥è¯•è¯•ä½¿ç”¨ä¸€ä¸‹.

#### Mixer Units å­ç±»å‹åŠç”¨é€”è¯´æ˜

| å­ç±»å‹ | ç”¨é€”è¯´æ˜ | å­æšä¸¾ç±»å‹ |
| :------ | :------ | :------ |
| 3D Mixer | ä»…æ”¯æŒ macOS | |
| MultiChannelMixer | å¤šè·¯å£°éŸ³æ··éŸ³æ•ˆæœå™¨,å¯ä»¥æ¥å—å¤šè·¯éŸ³é¢‘è¾“å…¥,è¿˜å¯ä»¥åˆ†åˆ«è°ƒæ•´æ¯ä¸€è·¯çš„éŸ³é¢‘å¢ç›Šå’Œå¼€å…³,å¹¶å°†å¤šè·¯éŸ³é¢‘åˆæˆä¸€è·¯ | kAudioUnitSubType_MultiChannelMixer |

#### I/O Units å­ç±»å‹åŠç”¨é€”è¯´æ˜

| å­ç±»å‹ | ç”¨é€”è¯´æ˜ | å­æšä¸¾ç±»å‹ |
| :------ | :------ | :------ |
| Remote I/O | é‡‡é›†éŸ³é¢‘ä¸æ’­æ”¾éŸ³é¢‘,åœ¨Audio Unitä¸­ä½¿ç”¨éº¦å…‹é£å’Œæ‰¬å£°å™¨çš„æ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ªUnit | kAudioUnitType_Output |
| Generic Output | è¿›è¡Œç¦»çº¿å¤„ç†,æˆ–è€…è¯´AUGraphä¸­ä¸ä½¿ç”¨æ‰¬å£°å™¨æ¥é©±åŠ¨æ•´ä¸ªæ•°æ®æµ,è€Œå¸Œæœ›ä½¿ç”¨ä¸€ä¸ªè¾“å‡º(å¯ä»¥æ”¾å…¥å†…å­˜é˜Ÿåˆ—æˆ–è€…ç£ç›˜I/Oæ“ä½œ)æ¥é©±åŠ¨æ•°æ®æµæ—¶ | kAudioUnitSubType_GenericOutput |

#### AUConverter Units å­ç±»å‹åŠç”¨é€”è¯´æ˜

| å­ç±»å‹ | ç”¨é€”è¯´æ˜ | å­æšä¸¾ç±»å‹ |
| :------ | :------ | :------ |
| AUConverter | æ ¼å¼è½¬æ¢,å½“æŸäº›æ•ˆæœå™¨å¯¹è¾“å…¥çš„éŸ³é¢‘æ ¼å¼æœ‰æ˜ç¡®è¦æ±‚æ—¶,æˆ–è€…æˆ‘ä»¬å°†éŸ³é¢‘æ•°æ®è¾“å…¥ç»™ä¸€äº›å…¶å®ƒçš„ç¼–ç å™¨è¿›è¡Œç¼–ç ã€‚ã€‚ã€‚  |kAudioUnitSubType_AUConverter|
|Time Pitch|å˜é€Ÿå˜è°ƒæ•ˆæœå™¨,è°ƒæ•´å£°éŸ³éŸ³é«˜. eg:ä¼šè¯´è¯çš„TomçŒ« |kAudioUnitSubType_NewTimePitch

> æ³¨æ„: AUConverter  å¦‚æœç”±FFMpegè§£ç å‡ºæ¥çš„PCM æ˜¯SInt16æ ¼å¼ å¦‚æœè¦ç”¨æ ¼å¼è½¬æ¢æ•ˆæœå™¨unitå¿…é¡»è½¬æˆFloat32æ ¼å¼è¡¨ç¤ºçš„æ•°æ®.

#### Generator Units å­ç±»å‹åŠç”¨é€”è¯´æ˜


| å­ç±»å‹ | ç”¨é€”è¯´æ˜ | å­æšä¸¾ç±»å‹ |
| :------ | :------ | :------ |
|AudioFilePlayer | æ¥æ”¶è£¸PCM æ’­æ”¾ ä¸€èˆ¬å¤§å®¶å¯ä»¥ç”¨è¿™ä¸ªé…åˆRemote I/O åšæ’­æ”¾å™¨ |	kAudioUnitSubType_AudioFilePlayer | 


ç›¸å…³shellå‘½ä»¤ __å°†éŸ³é¢‘æ–‡ä»¶è½¬æˆpcm__

``` sh
ffmpeg -i test.mp3 -acodec pcm_s16le -f s16le output.pcm
```

> brew install ffmpeg

[Demoå®ç°è€³è¿”åŠŸèƒ½](https://github.com/sunyazhou13/AduioUnitDemo)  
[Demo2å®ç°è€³è¿”+ä¼´å¥æ’­æ”¾](https://github.com/sunyazhou13/AudioUnitDemo2)


#### ä¸‹é¢æˆ‘åˆ†äº«ä¸€ä¸ªå˜å£°ä¸­æ··å“æ•ˆæœä»£ç 

``` objc

//å£°æ˜éƒ¨åˆ†  .h
@interface KSYAudioReverbFilter : NSObject


-(instancetype)init;

- (void)setupWithAUGraph:(AUGraph)auGraph asbd:(const AudioStreamBasicDescription *)asbd maxFrame:(CMItemCount)max;

// Global, CrossFade, 0->100, 100
@property (nonatomic) double dryWetMix;
// Global, Decibels, -20->20, 0dB.
@property (nonatomic) double gain;
// Global, Secs, 0.0001->1.0, 0.008
@property (nonatomic) double minDelayTime;
// Global, Secs, 0.0001->1.0, 0.050
@property (nonatomic) double maxDelayTime;
// Global, Secs, 0.001->20.0, 1.0
@property (nonatomic) double decayTimeAt0Hz;
// Global, Secs, 0.001->20.0, 0.5
@property (nonatomic) double decayTimeAtNyquist;
// Global, Integer, 1->1000, 1
@property (nonatomic) double randomizeReflections;

@end


//å®ç°éƒ¨åˆ†

//é€šç”¨çš„å®
#define RC_CHECK(rc, str) if (rc != noErr) \
{ \
NSLog(@"Err :%@ %@ %@", @(rc), str, @(__func__)); \
}

@implementation KSYAudioReverbFilter

-(instancetype)init{
    self = [super init];
    if (self){
        self.acDes = (AudioComponentDescription){kAudioUnitType_Effect, kAudioUnitSubType_Reverb2, kAudioUnitManufacturer_Apple, 0, 0};
    }
    
    return self;
}

- (void)setupWithAUGraph:(AUGraph)auGraph asbd:(const AudioStreamBasicDescription *)asbd maxFrame:(CMItemCount)maxFrame
{
    //
    OSStatus status = noErr;
    NSAssert(auGraph != nil, @"auGraph is null");
    audioGraph = auGraph;
    NSLog(@"setup :%@", NSStringFromCode(_acDes.componentSubType));
    status = AUGraphAddNode(auGraph, &_acDes, &_node);
    
    if (noErr != status){
        
        NSString *error = [NSString stringWithFormat:@"add node with type %u failed", _acDes.componentType];
        NSLog(@"%@", error);
        return ;
    }
    status = AUGraphNodeInfo(auGraph, _node, NULL, &_audioUnit);
    if (noErr != status){
        NSLog(@"create audiouinit failed err:%@", @(status));
        return ;
    }
    
    RC_CHECK(AudioUnitSetProperty(_audioUnit,
                                  kAudioUnitProperty_StreamFormat,
                                  kAudioUnitScope_Input, 0, asbd, sizeof(AudioStreamBasicDescription)),
             @"kAudioUnitProperty_StreamFormat kAudioUnitScope_Input err");
    
    RC_CHECK(AudioUnitSetProperty(_audioUnit,
                                  kAudioUnitProperty_StreamFormat,
                                  kAudioUnitScope_Output, 0, asbd, sizeof(AudioStreamBasicDescription)),
             @"kAudioUnitProperty_StreamFormat kAudioUnitScope_Output err");
    
    // Set audio unit maximum frames per slice to max frames.
    RC_CHECK(AudioUnitSetProperty(_audioUnit,
                                  kAudioUnitProperty_MaximumFramesPerSlice,
                                  kAudioUnitScope_Global, 0, &maxFrame, (UInt32)sizeof(UInt32)),
             @"set kAudioUnitProperty_MaximumFramesPerSlice err");
}

#pragma mark - Setters

- (void)setDryWetMix:(double)dryWetMix
{
    [self setGlobalParam:kReverb2Param_DryWetMix value:dryWetMix];
}

- (void)setGain:(double)gain
{
    [self setGlobalParam:kReverb2Param_Gain value:gain];
}

- (void)setMinDelayTime:(double)minDelayTime
{
    [self setGlobalParam:kReverb2Param_MinDelayTime value:minDelayTime];
}

- (void)setMaxDelayTime:(double)maxDelayTime
{
    [self setGlobalParam:kReverb2Param_MaxDelayTime value:maxDelayTime];
}

- (void)setDecayTimeAt0Hz:(double)decayTimeAt0Hz
{
    [self setGlobalParam:kReverb2Param_DecayTimeAt0Hz value:decayTimeAt0Hz];
}

- (void)setDecayTimeAtNyquist:(double)decayTimeAtNyquist
{
    [self setGlobalParam:kReverb2Param_DecayTimeAtNyquist value:decayTimeAtNyquist];
}

- (void)setRandomizeReflections:(double)randomizeReflections
{
    [self setGlobalParam:kReverb2Param_RandomizeReflections value:randomizeReflections];
}

//é€šç”¨æ–¹æ³•
- (void)setGlobalParam:(AudioUnitParameterID)paramId value:(AudioUnitParameterValue)value
{

    RC_CHECK(AudioUnitSetParameter(_audioUnit,
                                   paramId,
                                   kAudioUnitScope_Global, 0, value, 0),
             ([NSString stringWithFormat:@"set %u value %f err", paramId, value]));
}

@end



```

å¤–éƒ¨è°ƒç”¨çš„è¯å°±æ˜¯è¿™æ ·çš„

``` objc
AURenderCallbackStruct renderCallbackStruct;
renderCallbackStruct.inputProc = ksyme_RenderCallback;
renderCallbackStruct.inputProcRefCon = (void *)self.apt;
    
if (!_reverbFilter){
    _reverbFilter = [[KSYAudioReverbFilter alloc] init];
    [_reverbFilter setupWithAUGraph:auGraph asbd:format maxFrame:max];
    _reverbFilter.renderCallBack = renderCallbackStruct;
}
```

### è¿æ¥node

``` objc
AUGraphClearConnections(auGraph);
NSMutableArray *array = [[NSMutableArray alloc] init];
[array addObject:@(_mixFilter.node)];

[array addObjectsFromArray:@[@(_reverbFilter.node),@(_delayFilter.node),@(_pitchFilter.node)]];
for (int i = 0; i < array.count -1; i++) {
    AUGraphConnectNodeInput(auGraph,[array[i] intValue], 0,[array[i+1] intValue], 0);
}
    
```

æ ¸å¿ƒä»£ç å°±æ˜¯å¦‚ä½•è¿æ¥Node

``` objc
AUGraphConnectNodeInput(auGraph,reverbNode, 0, remoteIONode, 0)
```

> 0ä»£è¡¨ bus0

ç³»ç»Ÿå®šä¹‰çš„APIæ˜¯è¿™æ ·çš„

``` objc
extern OSStatus
AUGraphConnectNodeInput(	AUGraph			inGraph,
						AUNode			inSourceNode,
						UInt32			inSourceOutputNumber,
						AUNode			inDestNode,
						UInt32			inDestInputNumber)		__OSX_AVAILABLE_STARTING(__MAC_10_0,__IPHONE_2_0);
```


## æ€»ç»“


Audio Unitçš„ç›¸å…³æŠ€æœ¯å­¦ä¹ ç‚¹æ¯”è¾ƒå¤šå¤§å®¶çµæ´»æŒæ¡è¿ç”¨,ä¸æ‡‚æ²¡å…³ç³»ä»ç®€å•çš„Unitå¼€å§‹å­¦èµ·.


å…¨æ–‡å®Œ


å‚è€ƒåˆ—è¡¨:  
[iOS Audioç›¸å…³æœ¯è¯­(Glossary)](https://developer.apple.com/library/content/documentation/MusicAudio/Reference/CoreAudioGlossary/Glossary/core_audio_glossary.html#//apple_ref/doc/uid/TP40004453-CH210-SW1)  
[å‚è€ƒ](https://developer.apple.com/library/content/documentation/MusicAudio/Conceptual/AudioUnitHostingGuide_iOS/Introduction/Introduction.html)  
[å¦‚ä½•è‡ªå·±åˆ¶ä½œä¸€ä¸ªAudio Unit](https://developer.apple.com/library/content/documentation/MusicAudio/Conceptual/AudioUnitProgrammingGuide/Tutorial-BuildingASimpleEffectUnitWithAGenericView/Tutorial-BuildingASimpleEffectUnitWithAGenericView.html#//apple_ref/doc/uid/TP40003278-CH5-SW4)  
[é‡‘å±±äº‘ç›´æ’­éŸ³æ•ˆå®ç°](https://www.jianshu.com/p/05cae433faea)  
[Audio Unitå®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/content/documentation/MusicAudio/Conceptual/AudioUnitHostingGuide_iOS/AudioUnitHostingFundamentals/AudioUnitHostingFundamentals.html#//apple_ref/doc/uid/TP40009492-CH3-SW12)




URL: https://sunyazhou.com/2018/04/RunLoop/index.html.md
Published At: 2018-04-02 14:16:34 +0000

# æ·±å…¥ç†è§£RunLoop

![](/assets/images/20180402RunLoop/RunLoop6.webp)


# å‰è¨€

`RunLoop` æ˜¯ `iOS` å’Œ `OSX` å¼€å‘ä¸­éå¸¸åŸºç¡€çš„ä¸€ä¸ªæ¦‚å¿µï¼Œè¿™ç¯‡æ–‡ç« å°†ä»`CFRunLoop`çš„æºç å…¥æ‰‹ï¼Œä»‹ç» `RunLoop` çš„æ¦‚å¿µä»¥åŠåº•å±‚å®ç°åŸç†ã€‚ä¹‹åä¼šä»‹ç»ä¸€ä¸‹åœ¨ `iOS` ä¸­ï¼Œè‹¹æœæ˜¯å¦‚ä½•åˆ©ç”¨`RunLoop`å®ç°è‡ªåŠ¨é‡Šæ”¾æ± ã€å»¶è¿Ÿå›è°ƒã€è§¦æ‘¸äº‹ä»¶ã€å±å¹•åˆ·æ–°ç­‰åŠŸèƒ½çš„ã€‚

## æœ¬æ–‡å†…å®¹

* RunLoop çš„æ¦‚å¿µ
* RunLoop ä¸çº¿ç¨‹çš„å…³ç³»
* RunLoop å¯¹å¤–çš„æ¥å£
* RunLoop çš„ Mode
* RunLoop çš„å†…éƒ¨é€»è¾‘
* RunLoop çš„åº•å±‚å®ç°
* è‹¹æœç”¨ RunLoop å®ç°çš„åŠŸèƒ½
	1. AutoreleasePool
	2. äº‹ä»¶å“åº”
	3. æ‰‹åŠ¿è¯†åˆ«
	4. ç•Œé¢æ›´æ–°
	5. å®šæ—¶å™¨
	6. PerformSelecter
	7. å…³äºGCD
	8. å…³äºç½‘ç»œè¯·æ±‚
* RunLoop çš„å®é™…åº”ç”¨ä¸¾ä¾‹
	1. AFNetworking
	2. AsyncDisplayKit

	
### RunLoop çš„æ¦‚å¿µ

ä¸€èˆ¬æ¥è®²ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåçº¿ç¨‹å°±ä¼šé€€å‡ºã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœºåˆ¶ï¼Œè®©çº¿ç¨‹èƒ½éšæ—¶å¤„ç†äº‹ä»¶ä½†å¹¶ä¸é€€å‡ºï¼Œé€šå¸¸çš„ä»£ç é€»è¾‘æ˜¯è¿™æ ·çš„ï¼š

``` swift
function loop() {
    initialize();
    do {
        var message = get_next_message();
        process_message(message);
    } while (message != quit);
}
```

è¿™ç§æ¨¡å‹é€šå¸¸è¢«ç§°ä½œ [Event Loop](https://en.wikipedia.org/wiki/Event_loop)ã€‚ `Event Loop` åœ¨å¾ˆå¤šç³»ç»Ÿå’Œæ¡†æ¶é‡Œéƒ½æœ‰å®ç°ï¼Œæ¯”å¦‚ `Node.js`çš„äº‹ä»¶å¤„ç†ï¼Œæ¯”å¦‚ `Windows` ç¨‹åºçš„æ¶ˆæ¯å¾ªç¯ï¼Œå†æ¯”å¦‚ `OSX/iOS` é‡Œçš„ `RunLoop`ã€‚å®ç°è¿™ç§æ¨¡å‹çš„å…³é”®ç‚¹åœ¨äºï¼šå¦‚ä½•`ç®¡ç†äº‹ä»¶/æ¶ˆæ¯`ï¼Œå¦‚ä½•è®©çº¿ç¨‹åœ¨æ²¡æœ‰å¤„ç†æ¶ˆæ¯æ—¶ä¼‘çœ ä»¥é¿å…èµ„æºå ç”¨ã€åœ¨æœ‰æ¶ˆæ¯åˆ°æ¥æ—¶ç«‹åˆ»è¢«å”¤é†’ã€‚


æ‰€ä»¥ï¼Œ`RunLoop` å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç®¡ç†äº†å…¶éœ€è¦å¤„ç†çš„äº‹ä»¶å’Œæ¶ˆæ¯ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå…¥å£å‡½æ•°æ¥æ‰§è¡Œä¸Šé¢ `Event Loop` çš„é€»è¾‘ã€‚çº¿ç¨‹æ‰§è¡Œäº†è¿™ä¸ªå‡½æ•°åï¼Œå°±ä¼šä¸€ç›´å¤„äºè¿™ä¸ªå‡½æ•°å†…éƒ¨ â€œ`æ¥å—æ¶ˆæ¯`->`ç­‰å¾…->`å¤„ç†`â€ çš„å¾ªç¯ä¸­ï¼Œç›´åˆ°è¿™ä¸ªå¾ªç¯ç»“æŸï¼ˆæ¯”å¦‚ä¼ å…¥ `quit` çš„æ¶ˆæ¯ï¼‰ï¼Œå‡½æ•°è¿”å›ã€‚

`OSX/iOS` ç³»ç»Ÿä¸­ï¼Œæä¾›äº†ä¸¤ä¸ªè¿™æ ·çš„å¯¹è±¡ï¼š`NSRunLoop` å’Œ `CFRunLoopRef`ã€‚  

`CFRunLoopRef` æ˜¯åœ¨ `CoreFoundation` æ¡†æ¶å†…çš„ï¼Œå®ƒæä¾›äº†çº¯ `C` å‡½æ•°çš„ `API`ï¼Œæ‰€æœ‰è¿™äº› `API` éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚  

`NSRunLoop` æ˜¯åŸºäº `CFRunLoopRef` çš„å°è£…ï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„ `API`ï¼Œä½†æ˜¯è¿™äº› `API` ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚  

CFRunLoopRef çš„ä»£ç æ˜¯[å¼€æº](http://opensource.apple.com/source/CF/CF-855.17/CFRunLoop.c)çš„ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œ [http://opensource.apple.com/tarballs/CF/](https://opensource.apple.com/tarballs/CF/) ä¸‹è½½åˆ°æ•´ä¸ª `CoreFoundation` çš„æºç æ¥æŸ¥çœ‹ã€‚

(Update: Swift å¼€æºåï¼Œè‹¹æœåˆç»´æŠ¤äº†ä¸€ä¸ªè·¨å¹³å°çš„ CoreFoundation ç‰ˆæœ¬ï¼š[https://github.com/apple/swift-corelibs-foundation/](https://github.com/apple/swift-corelibs-foundation/)ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„æºç å¯èƒ½å’Œç°æœ‰`iOS`ç³»ç»Ÿä¸­çš„å®ç°ç•¥ä¸ä¸€æ ·ï¼Œä½†æ›´å®¹æ˜“ç¼–è¯‘ï¼Œè€Œä¸”å·²ç»é€‚é…äº†`Linux/Windows`ã€‚)


### RunLoop ä¸çº¿ç¨‹çš„å…³ç³»

é¦–å…ˆï¼Œ`iOS` å¼€å‘ä¸­èƒ½é‡åˆ°ä¸¤ä¸ªçº¿ç¨‹å¯¹è±¡: `pthread_t` å’Œ `NSThread`ã€‚è¿‡å»è‹¹æœæœ‰ä»½æ–‡æ¡£æ ‡æ˜äº† `NSThread` åªæ˜¯ `pthread_t` çš„å°è£…ï¼Œä½†é‚£ä»½æ–‡æ¡£å·²ç»å¤±æ•ˆäº†ï¼Œç°åœ¨å®ƒä»¬ä¹Ÿæœ‰å¯èƒ½éƒ½æ˜¯ç›´æ¥åŒ…è£…è‡ªæœ€åº•å±‚çš„ `mach thread`ã€‚è‹¹æœå¹¶æ²¡æœ‰æä¾›è¿™ä¸¤ä¸ªå¯¹è±¡ç›¸äº’è½¬æ¢çš„æ¥å£ï¼Œä½†ä¸ç®¡æ€ä¹ˆæ ·ï¼Œå¯ä»¥è‚¯å®šçš„æ˜¯ `pthread_t` å’Œ `NSThread` æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ `pthread_main_thread_np()` æˆ– `[NSThread mainThread]` æ¥è·å–ä¸»çº¿ç¨‹ï¼›ä¹Ÿå¯ä»¥é€šè¿‡ `pthread_self()` æˆ– `[NSThread currentThread]` æ¥è·å–å½“å‰çº¿ç¨‹ã€‚`CFRunLoop` æ˜¯åŸºäº `pthread` æ¥ç®¡ç†çš„ã€‚

è‹¹æœä¸å…è®¸ç›´æ¥åˆ›å»º `RunLoop`ï¼Œå®ƒåªæä¾›äº†ä¸¤ä¸ªè‡ªåŠ¨è·å–çš„å‡½æ•°ï¼š`CFRunLoopGetMain()` å’Œ `CFRunLoopGetCurrent()`ã€‚ è¿™ä¸¤ä¸ªå‡½æ•°å†…éƒ¨çš„é€»è¾‘å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·:

``` c
/// å…¨å±€çš„Dictionaryï¼Œkey æ˜¯ pthread_tï¼Œ value æ˜¯ CFRunLoopRef
static CFMutableDictionaryRef loopsDic;
/// è®¿é—® loopsDic æ—¶çš„é”
static CFSpinLock_t loopsLock;
 
/// è·å–ä¸€ä¸ª pthread å¯¹åº”çš„ RunLoopã€‚
CFRunLoopRef _CFRunLoopGet(pthread_t thread) {
    OSSpinLockLock(&loopsLock);
    
    if (!loopsDic) {
        // ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶ï¼Œåˆå§‹åŒ–å…¨å±€Dicï¼Œå¹¶å…ˆä¸ºä¸»çº¿ç¨‹åˆ›å»ºä¸€ä¸ª RunLoopã€‚
        loopsDic = CFDictionaryCreateMutable();
        CFRunLoopRef mainLoop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, pthread_main_thread_np(), mainLoop);
    }
    
    /// ç›´æ¥ä» Dictionary é‡Œè·å–ã€‚
    CFRunLoopRef loop = CFDictionaryGetValue(loopsDic, thread));
    
    if (!loop) {
        /// å–ä¸åˆ°æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª
        loop = _CFRunLoopCreate();
        CFDictionarySetValue(loopsDic, thread, loop);
        /// æ³¨å†Œä¸€ä¸ªå›è°ƒï¼Œå½“çº¿ç¨‹é”€æ¯æ—¶ï¼Œé¡ºä¾¿ä¹Ÿé”€æ¯å…¶å¯¹åº”çš„ RunLoopã€‚
        _CFSetTSD(..., thread, loop, __CFFinalizeRunLoop);
    }
    
    OSSpinLockUnLock(&loopsLock);
    return loop;
}
 
CFRunLoopRef CFRunLoopGetMain() {
    return _CFRunLoopGet(pthread_main_thread_np());
}
 
CFRunLoopRef CFRunLoopGetCurrent() {
    return _CFRunLoopGet(pthread_self());
}
```


ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹å’Œ`RunLoop`ä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå…¶å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„ `Dictionary` é‡Œã€‚çº¿ç¨‹åˆšåˆ›å»ºæ—¶å¹¶æ²¡æœ‰ `RunLoop`ï¼Œå¦‚æœä½ ä¸ä¸»åŠ¨è·å–ï¼Œé‚£å®ƒä¸€ç›´éƒ½ä¸ä¼šæœ‰ã€‚`RunLoop` çš„åˆ›å»ºæ˜¯å‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶ï¼Œ`RunLoop` çš„é”€æ¯æ˜¯å‘ç”Ÿåœ¨çº¿ç¨‹ç»“æŸæ—¶ã€‚ä½ åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹çš„å†…éƒ¨è·å–å…¶ `RunLoop`ï¼ˆä¸»çº¿ç¨‹é™¤å¤–ï¼‰.



### RunLoop å¯¹å¤–çš„æ¥å£


åœ¨ `CoreFoundation` é‡Œé¢å…³äº `RunLoop` æœ‰5ä¸ªç±»:

* `CFRunLoopRef`
* `CFRunLoopModeRef`
* `CFRunLoopSourceRef`
* `CFRunLoopTimerRef`
* `CFRunLoopObserverRef`


å…¶ä¸­ `CFRunLoopModeRef` ç±»å¹¶æ²¡æœ‰å¯¹å¤–æš´éœ²ï¼Œåªæ˜¯é€šè¿‡ `CFRunLoopRef` çš„æ¥å£è¿›è¡Œäº†å°è£…ã€‚ä»–ä»¬çš„å…³ç³»å¦‚ä¸‹:

![](/assets/images/20180402RunLoop/RunLoop0.webp)


ä¸€ä¸ª `RunLoop` åŒ…å«è‹¥å¹²ä¸ª `Mode`ï¼Œæ¯ä¸ª `Mode `åˆåŒ…å«è‹¥å¹²ä¸ª `Source`/`Timer`/`Observer`ã€‚æ¯æ¬¡è°ƒç”¨ `RunLoop` çš„ä¸»å‡½æ•°æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª `Mode`ï¼Œè¿™ä¸ª`Mode`è¢«ç§°ä½œ `CurrentMode`ã€‚å¦‚æœéœ€è¦åˆ‡æ¢ `Mode`ï¼Œåªèƒ½é€€å‡º `Loop`ï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ª `Mode` è¿›å…¥ã€‚è¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„ `Source`/`Timer`/`Observer`ï¼Œè®©å…¶äº’ä¸å½±å“ã€‚

**CFRunLoopSourceRef** æ˜¯äº‹ä»¶äº§ç”Ÿçš„åœ°æ–¹ã€‚`Source`æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼š`Source0` å’Œ `Source1`ã€‚

* `Source0` åªåŒ…å«äº†ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå®ƒå¹¶ä¸èƒ½ä¸»åŠ¨è§¦å‘äº‹ä»¶ã€‚ä½¿ç”¨æ—¶ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨ `CFRunLoopSourceSignal(source)`ï¼Œå°†è¿™ä¸ª `Source` æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œç„¶åæ‰‹åŠ¨è°ƒç”¨ `CFRunLoopWakeUp(runloop)` æ¥å”¤é†’ `RunLoop`ï¼Œè®©å…¶å¤„ç†è¿™ä¸ªäº‹ä»¶ã€‚  
* `Source1` åŒ…å«äº†ä¸€ä¸ª `mach_port` å’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œè¢«ç”¨äºé€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ã€‚è¿™ç§ `Source` èƒ½ä¸»åŠ¨å”¤é†’ `RunLoop` çš„çº¿ç¨‹ï¼Œå…¶åŸç†åœ¨ä¸‹é¢ä¼šè®²åˆ°ã€‚


**CFRunLoopTimerRef** æ˜¯åŸºäºæ—¶é—´çš„è§¦å‘å™¨ï¼Œå®ƒå’Œ `NSTimer` æ˜¯`toll-free bridged `çš„ï¼Œå¯ä»¥æ··ç”¨ã€‚å…¶åŒ…å«ä¸€ä¸ªæ—¶é—´é•¿åº¦å’Œä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ã€‚å½“å…¶åŠ å…¥åˆ° `RunLoop` æ—¶ï¼Œ`RunLoop`ä¼šæ³¨å†Œå¯¹åº”çš„æ—¶é—´ç‚¹ï¼Œå½“æ—¶é—´ç‚¹åˆ°æ—¶ï¼Œ`RunLoop`ä¼šè¢«å”¤é†’ä»¥æ‰§è¡Œé‚£ä¸ªå›è°ƒã€‚


**CFRunLoopObserverRef** æ˜¯è§‚å¯Ÿè€…ï¼Œæ¯ä¸ª `Observer` éƒ½åŒ…å«äº†ä¸€ä¸ªå›è°ƒï¼ˆå‡½æ•°æŒ‡é’ˆï¼‰ï¼Œå½“ `RunLoop` çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè§‚å¯Ÿè€…å°±èƒ½é€šè¿‡å›è°ƒæ¥å—åˆ°è¿™ä¸ªå˜åŒ–ã€‚å¯ä»¥è§‚æµ‹çš„æ—¶é—´ç‚¹æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š

``` c
typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) {
    kCFRunLoopEntry         = (1UL << 0), // å³å°†è¿›å…¥Loop
    kCFRunLoopBeforeTimers  = (1UL << 1), // å³å°†å¤„ç† Timer
    kCFRunLoopBeforeSources = (1UL << 2), // å³å°†å¤„ç† Source
    kCFRunLoopBeforeWaiting = (1UL << 5), // å³å°†è¿›å…¥ä¼‘çœ 
    kCFRunLoopAfterWaiting  = (1UL << 6), // åˆšä»ä¼‘çœ ä¸­å”¤é†’
    kCFRunLoopExit          = (1UL << 7), // å³å°†é€€å‡ºLoop
};
```

ä¸Šé¢çš„ `Source`/`Timer`/`Observer` è¢«ç»Ÿç§°ä¸º `__mode item__`ï¼Œä¸€ä¸ª `item` å¯ä»¥è¢«åŒæ—¶åŠ å…¥å¤šä¸ª`mode`ã€‚ä½†ä¸€ä¸ª `item` è¢«é‡å¤åŠ å…¥åŒä¸€ä¸ª `mode` æ—¶æ˜¯ä¸ä¼šæœ‰æ•ˆæœçš„ã€‚å¦‚æœä¸€ä¸ª `mode` ä¸­ä¸€ä¸ª `item` éƒ½æ²¡æœ‰ï¼Œåˆ™ `RunLoop` ä¼šç›´æ¥é€€å‡ºï¼Œä¸è¿›å…¥å¾ªç¯ã€‚

### RunLoop çš„ Mode

`CFRunLoopMode` å’Œ `CFRunLoop` çš„ç»“æ„å¤§è‡´å¦‚ä¸‹ï¼š

``` objc
struct __CFRunLoopMode {
    CFStringRef _name;            // Mode Name, ä¾‹å¦‚ @"kCFRunLoopDefaultMode"
    CFMutableSetRef _sources0;    // Set
    CFMutableSetRef _sources1;    // Set
    CFMutableArrayRef _observers; // Array
    CFMutableArrayRef _timers;    // Array
    ...
};
 
struct __CFRunLoop {
    CFMutableSetRef _commonModes;     // Set
    CFMutableSetRef _commonModeItems; // Set<Source/Observer/Timer>
    CFRunLoopModeRef _currentMode;    // Current Runloop Mode
    CFMutableSetRef _modes;           // Set
    ...
};
```


è¿™é‡Œæœ‰ä¸ªæ¦‚å¿µå« â€œ`CommonModes`â€ï¼šä¸€ä¸ª `Mode` å¯ä»¥å°†è‡ªå·±æ ‡è®°ä¸ºâ€`Common`â€å±æ€§ï¼ˆé€šè¿‡å°†å…¶ `ModeName` æ·»åŠ åˆ° `RunLoop` çš„ â€œ`commonModes`â€ ä¸­ï¼‰ã€‚æ¯å½“ `RunLoop` çš„å†…å®¹å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ`RunLoop` éƒ½ä¼šè‡ªåŠ¨å°† `_commonModeItems` é‡Œçš„ `Source`/`Observer`/`Timer`åŒæ­¥åˆ°å…·æœ‰ â€œ`Common`â€ æ ‡è®°çš„æ‰€æœ‰`Mode`é‡Œã€‚

åº”ç”¨åœºæ™¯ä¸¾ä¾‹ï¼šä¸»çº¿ç¨‹çš„ `RunLoop` é‡Œæœ‰ä¸¤ä¸ªé¢„ç½®çš„ `Mode`ï¼š`kCFRunLoopDefaultMode` å’Œ `UITrackingRunLoopMode`ã€‚è¿™ä¸¤ä¸ª `Mode` éƒ½å·²ç»è¢«æ ‡è®°ä¸ºâ€`Common`â€å±æ€§ã€‚`DefaultMode` æ˜¯ `App` å¹³æ—¶æ‰€å¤„çš„çŠ¶æ€ï¼Œ`TrackingRunLoopMode` æ˜¯è¿½è¸ª `ScrollView`æ»‘åŠ¨æ—¶çš„çŠ¶æ€ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ª`Timer`å¹¶åŠ åˆ° `DefaultMode` æ—¶ï¼Œ`Timer` ä¼šå¾—åˆ°é‡å¤å›è°ƒï¼Œä½†æ­¤æ—¶æ»‘åŠ¨ä¸€ä¸ª`TableView`æ—¶ï¼Œ`RunLoop` ä¼šå°† `mode` åˆ‡æ¢ä¸º `TrackingRunLoopMode`ï¼Œè¿™æ—¶ `Timer` å°±ä¸ä¼šè¢«å›è°ƒï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šå½±å“åˆ°æ»‘åŠ¨æ“ä½œã€‚

æœ‰æ—¶ä½ éœ€è¦ä¸€ä¸ª`Timer`ï¼Œåœ¨ä¸¤ä¸ª `Mode` ä¸­éƒ½èƒ½å¾—åˆ°å›è°ƒï¼Œä¸€ç§åŠæ³•å°±æ˜¯å°†è¿™ä¸ª `Timer` åˆ†åˆ«åŠ å…¥è¿™ä¸¤ä¸ª `Mode`ã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼ï¼Œå°±æ˜¯å°† `Timer` åŠ å…¥åˆ°é¡¶å±‚çš„ `RunLoop` çš„ â€œ`commonModeItems`â€ ä¸­ã€‚â€`commonModeItems`â€ è¢« `RunLoop` è‡ªåŠ¨æ›´æ–°åˆ°æ‰€æœ‰å…·æœ‰â€`Common`â€å±æ€§çš„ `Mode` é‡Œå»ã€‚

`CFRunLoop`å¯¹å¤–æš´éœ²çš„ç®¡ç† `Mode` æ¥å£åªæœ‰ä¸‹é¢2ä¸ª:

``` c
CFRunLoopAddCommonMode(CFRunLoopRef runloop, CFStringRef modeName);
CFRunLoopRunInMode(CFStringRef modeName, ...);
```

`Mode` æš´éœ²çš„ç®¡ç† `mode item` çš„æ¥å£æœ‰ä¸‹é¢å‡ ä¸ªï¼š

``` c
CFRunLoopAddSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);
CFRunLoopAddObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);
CFRunLoopAddTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);
CFRunLoopRemoveSource(CFRunLoopRef rl, CFRunLoopSourceRef source, CFStringRef modeName);
CFRunLoopRemoveObserver(CFRunLoopRef rl, CFRunLoopObserverRef observer, CFStringRef modeName);
CFRunLoopRemoveTimer(CFRunLoopRef rl, CFRunLoopTimerRef timer, CFStringRef mode);
```

ä½ åªèƒ½é€šè¿‡ `mode name` æ¥æ“ä½œå†…éƒ¨çš„ `mode`ï¼Œå½“ä½ ä¼ å…¥ä¸€ä¸ªæ–°çš„ `mode name` ä½† `RunLoop` å†…éƒ¨æ²¡æœ‰å¯¹åº” `mode` æ—¶ï¼Œ`RunLoop`ä¼šè‡ªåŠ¨å¸®ä½ åˆ›å»ºå¯¹åº”çš„ `CFRunLoopModeRef`ã€‚å¯¹äºä¸€ä¸ª `RunLoop` æ¥è¯´ï¼Œå…¶å†…éƒ¨çš„ `mode` åªèƒ½å¢åŠ ä¸èƒ½åˆ é™¤ã€‚

è‹¹æœå…¬å¼€æä¾›çš„ `Mode` æœ‰ä¸¤ä¸ªï¼š`kCFRunLoopDefaultMode` (`NSDefaultRunLoopMode`) å’Œ `UITrackingRunLoopMode`ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸¤ä¸ª `Mode Name` æ¥æ“ä½œå…¶å¯¹åº”çš„`Mode`ã€‚

åŒæ—¶è‹¹æœè¿˜æä¾›äº†ä¸€ä¸ªæ“ä½œ `Common` æ ‡è®°çš„å­—ç¬¦ä¸²ï¼š`kCFRunLoopCommonModes` (`NSRunLoopCommonModes`)ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªå­—ç¬¦ä¸²æ¥æ“ä½œ `Common Items`ï¼Œæˆ–æ ‡è®°ä¸€ä¸ª `Mode` ä¸º â€œ`Common`â€ã€‚ä½¿ç”¨æ—¶æ³¨æ„åŒºåˆ†è¿™ä¸ªå­—ç¬¦ä¸²å’Œå…¶ä»– `mode name`ã€‚

### RunLoop çš„å†…éƒ¨é€»è¾‘

æ ¹æ®è‹¹æœåœ¨[æ–‡æ¡£](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html#//apple_ref/doc/uid/10000057i-CH16-SW23)é‡Œçš„è¯´æ˜ï¼Œ`RunLoop` å†…éƒ¨çš„é€»è¾‘å¤§è‡´å¦‚ä¸‹:

![](/assets/images/20180402RunLoop/RunLoop1.webp)

å…¶å†…éƒ¨ä»£ç æ•´ç†å¦‚ä¸‹ (å¤ªé•¿äº†ä¸æƒ³çœ‹å¯ä»¥ç›´æ¥è·³è¿‡å»ï¼Œåé¢ä¼šæœ‰è¯´æ˜)


``` c
/// ç”¨DefaultModeå¯åŠ¨
void CFRunLoopRun(void) {
    CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false);
}
 
/// ç”¨æŒ‡å®šçš„Modeå¯åŠ¨ï¼Œå…è®¸è®¾ç½®RunLoopè¶…æ—¶æ—¶é—´
int CFRunLoopRunInMode(CFStringRef modeName, CFTimeInterval seconds, Boolean stopAfterHandle) {
    return CFRunLoopRunSpecific(CFRunLoopGetCurrent(), modeName, seconds, returnAfterSourceHandled);
}
 
/// RunLoopçš„å®ç°
int CFRunLoopRunSpecific(runloop, modeName, seconds, stopAfterHandle) {
    
    /// é¦–å…ˆæ ¹æ®modeNameæ‰¾åˆ°å¯¹åº”mode
    CFRunLoopModeRef currentMode = __CFRunLoopFindMode(runloop, modeName, false);
    /// å¦‚æœmodeé‡Œæ²¡æœ‰source/timer/observer, ç›´æ¥è¿”å›ã€‚
    if (__CFRunLoopModeIsEmpty(currentMode)) return;
    
    /// 1. é€šçŸ¥ Observers: RunLoop å³å°†è¿›å…¥ loopã€‚
    __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopEntry);
    
    /// å†…éƒ¨å‡½æ•°ï¼Œè¿›å…¥loop
    __CFRunLoopRun(runloop, currentMode, seconds, returnAfterSourceHandled) {
        
        Boolean sourceHandledThisLoop = NO;
        int retVal = 0;
        do {
 
            /// 2. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Timer å›è°ƒã€‚
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeTimers);
            /// 3. é€šçŸ¥ Observers: RunLoop å³å°†è§¦å‘ Source0 (éport) å›è°ƒã€‚
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeSources);
            /// æ‰§è¡Œè¢«åŠ å…¥çš„block
            __CFRunLoopDoBlocks(runloop, currentMode);
            
            /// 4. RunLoop è§¦å‘ Source0 (éport) å›è°ƒã€‚
            sourceHandledThisLoop = __CFRunLoopDoSources0(runloop, currentMode, stopAfterHandle);
            /// æ‰§è¡Œè¢«åŠ å…¥çš„block
            __CFRunLoopDoBlocks(runloop, currentMode);
 
            /// 5. å¦‚æœæœ‰ Source1 (åŸºäºport) å¤„äº ready çŠ¶æ€ï¼Œç›´æ¥å¤„ç†è¿™ä¸ª Source1 ç„¶åè·³è½¬å»å¤„ç†æ¶ˆæ¯ã€‚
            if (__Source0DidDispatchPortLastTime) {
                Boolean hasMsg = __CFRunLoopServiceMachPort(dispatchPort, &msg)
                if (hasMsg) goto handle_msg;
            }
            
            /// é€šçŸ¥ Observers: RunLoop çš„çº¿ç¨‹å³å°†è¿›å…¥ä¼‘çœ (sleep)ã€‚
            if (!sourceHandledThisLoop) {
                __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopBeforeWaiting);
            }
            
            /// 7. è°ƒç”¨ mach_msg ç­‰å¾…æ¥å— mach_port çš„æ¶ˆæ¯ã€‚çº¿ç¨‹å°†è¿›å…¥ä¼‘çœ , ç›´åˆ°è¢«ä¸‹é¢æŸä¸€ä¸ªäº‹ä»¶å”¤é†’ã€‚
            /// â€¢ ä¸€ä¸ªåŸºäº port çš„Source çš„äº‹ä»¶ã€‚
            /// â€¢ ä¸€ä¸ª Timer åˆ°æ—¶é—´äº†
            /// â€¢ RunLoop è‡ªèº«çš„è¶…æ—¶æ—¶é—´åˆ°äº†
            /// â€¢ è¢«å…¶ä»–ä»€ä¹ˆè°ƒç”¨è€…æ‰‹åŠ¨å”¤é†’
            __CFRunLoopServiceMachPort(waitSet, &msg, sizeof(msg_buffer), &livePort) {
                mach_msg(msg, MACH_RCV_MSG, port); // thread wait for receive msg
            }
 
            /// 8. é€šçŸ¥ Observers: RunLoop çš„çº¿ç¨‹åˆšåˆšè¢«å”¤é†’äº†ã€‚
            __CFRunLoopDoObservers(runloop, currentMode, kCFRunLoopAfterWaiting);
            
            /// æ”¶åˆ°æ¶ˆæ¯ï¼Œå¤„ç†æ¶ˆæ¯ã€‚
            handle_msg:
 
            /// 9.1 å¦‚æœä¸€ä¸ª Timer åˆ°æ—¶é—´äº†ï¼Œè§¦å‘è¿™ä¸ªTimerçš„å›è°ƒã€‚
            if (msg_is_timer) {
                __CFRunLoopDoTimers(runloop, currentMode, mach_absolute_time())
            } 
 
            /// 9.2 å¦‚æœæœ‰dispatchåˆ°main_queueçš„blockï¼Œæ‰§è¡Œblockã€‚
            else if (msg_is_dispatch) {
                __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg);
            } 
 
            /// 9.3 å¦‚æœä¸€ä¸ª Source1 (åŸºäºport) å‘å‡ºäº‹ä»¶äº†ï¼Œå¤„ç†è¿™ä¸ªäº‹ä»¶
            else {
                CFRunLoopSourceRef source1 = __CFRunLoopModeFindSourceForMachPort(runloop, currentMode, livePort);
                sourceHandledThisLoop = __CFRunLoopDoSource1(runloop, currentMode, source1, msg);
                if (sourceHandledThisLoop) {
                    mach_msg(reply, MACH_SEND_MSG, reply);
                }
            }
            
            /// æ‰§è¡ŒåŠ å…¥åˆ°Loopçš„block
            __CFRunLoopDoBlocks(runloop, currentMode);
            
 
            if (sourceHandledThisLoop && stopAfterHandle) {
                /// è¿›å…¥loopæ—¶å‚æ•°è¯´å¤„ç†å®Œäº‹ä»¶å°±è¿”å›ã€‚
                retVal = kCFRunLoopRunHandledSource;
            } else if (timeout) {
                /// è¶…å‡ºä¼ å…¥å‚æ•°æ ‡è®°çš„è¶…æ—¶æ—¶é—´äº†
                retVal = kCFRunLoopRunTimedOut;
            } else if (__CFRunLoopIsStopped(runloop)) {
                /// è¢«å¤–éƒ¨è°ƒç”¨è€…å¼ºåˆ¶åœæ­¢äº†
                retVal = kCFRunLoopRunStopped;
            } else if (__CFRunLoopModeIsEmpty(runloop, currentMode)) {
                /// source/timer/observerä¸€ä¸ªéƒ½æ²¡æœ‰äº†
                retVal = kCFRunLoopRunFinished;
            }
            
            /// å¦‚æœæ²¡è¶…æ—¶ï¼Œmodeé‡Œæ²¡ç©ºï¼Œloopä¹Ÿæ²¡è¢«åœæ­¢ï¼Œé‚£ç»§ç»­loopã€‚
        } while (retVal == 0);
    }
    
    /// 10. é€šçŸ¥ Observers: RunLoop å³å°†é€€å‡ºã€‚
    __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit);
}

```


### RunLoop çš„åº•å±‚å®ç°

ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œ`RunLoop` çš„æ ¸å¿ƒæ˜¯åŸºäº `mach port` çš„ï¼Œå…¶è¿›å…¥ä¼‘çœ æ—¶è°ƒç”¨çš„å‡½æ•°æ˜¯ `mach_msg()`ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸ªé€»è¾‘ï¼Œä¸‹é¢ç¨å¾®ä»‹ç»ä¸€ä¸‹ `OSX/iOS` çš„ç³»ç»Ÿæ¶æ„ã€‚

![](/assets/images/20180402RunLoop/RunLoop3.webp)


è‹¹æœå®˜æ–¹å°†æ•´ä¸ªç³»ç»Ÿå¤§è‡´åˆ’åˆ†ä¸ºä¸Šè¿°4ä¸ªå±‚æ¬¡ï¼š
åº”ç”¨å±‚åŒ…æ‹¬ç”¨æˆ·èƒ½æ¥è§¦åˆ°çš„å›¾å½¢åº”ç”¨ï¼Œä¾‹å¦‚ `Spotlight`ã€`Aqua`ã€`SpringBoard` ç­‰ã€‚
åº”ç”¨æ¡†æ¶å±‚å³å¼€å‘äººå‘˜æ¥è§¦åˆ°çš„ `Cocoa `ç­‰æ¡†æ¶ã€‚
æ ¸å¿ƒæ¡†æ¶å±‚åŒ…æ‹¬å„ç§æ ¸å¿ƒæ¡†æ¶ã€`OpenGL` ç­‰å†…å®¹ã€‚
`Darwin` å³æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒï¼ŒåŒ…æ‹¬ç³»ç»Ÿå†…æ ¸ã€é©±åŠ¨ã€`Shell` ç­‰å†…å®¹ï¼Œè¿™ä¸€å±‚æ˜¯å¼€æºçš„ï¼Œå…¶æ‰€æœ‰æºç éƒ½å¯ä»¥åœ¨ [opensource.apple.com](https://opensource.apple.com/) é‡Œæ‰¾åˆ°ã€‚

__æˆ‘ä»¬åœ¨æ·±å…¥çœ‹ä¸€ä¸‹ Darwin è¿™ä¸ªæ ¸å¿ƒçš„æ¶æ„ï¼š__

![](/assets/images/20180402RunLoop/RunLoop4.webp)


å…¶ä¸­ï¼Œåœ¨ç¡¬ä»¶å±‚ä¸Šé¢çš„ä¸‰ä¸ªç»„æˆéƒ¨åˆ†ï¼š`Mach`ã€`BSD`ã€`IOKit` (è¿˜åŒ…æ‹¬ä¸€äº›ä¸Šé¢æ²¡æ ‡æ³¨çš„å†…å®¹)ï¼Œå…±åŒç»„æˆäº† `XNU` å†…æ ¸ã€‚
`XNU` å†…æ ¸çš„å†…ç¯è¢«ç§°ä½œ `Mach`ï¼Œå…¶ä½œä¸ºä¸€ä¸ªå¾®å†…æ ¸ï¼Œä»…æä¾›äº†è¯¸å¦‚å¤„ç†å™¨è°ƒåº¦ã€`IPC` (è¿›ç¨‹é—´é€šä¿¡)ç­‰éå¸¸å°‘é‡çš„åŸºç¡€æœåŠ¡ã€‚  
`BSD` å±‚å¯ä»¥çœ‹ä½œå›´ç»• `Mach` å±‚çš„ä¸€ä¸ªå¤–ç¯ï¼Œå…¶æä¾›äº†è¯¸å¦‚è¿›ç¨‹ç®¡ç†ã€æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œç­‰åŠŸèƒ½ã€‚  
`IOKit` å±‚æ˜¯ä¸ºè®¾å¤‡é©±åŠ¨æä¾›äº†ä¸€ä¸ªé¢å‘å¯¹è±¡(`C++`)çš„ä¸€ä¸ªæ¡†æ¶ã€‚


`Mach` æœ¬èº«æä¾›çš„ `API` éå¸¸æœ‰é™ï¼Œè€Œä¸”è‹¹æœä¹Ÿä¸é¼“åŠ±ä½¿ç”¨ `Mach` çš„ `API`ï¼Œä½†æ˜¯è¿™äº›`API`éå¸¸åŸºç¡€ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›`API`çš„è¯ï¼Œå…¶ä»–ä»»ä½•å·¥ä½œéƒ½æ— æ³•å®æ–½ã€‚åœ¨ `Mach` ä¸­ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯é€šè¿‡è‡ªå·±çš„å¯¹è±¡å®ç°çš„ï¼Œè¿›ç¨‹ã€çº¿ç¨‹å’Œè™šæ‹Ÿå†…å­˜éƒ½è¢«ç§°ä¸ºâ€å¯¹è±¡â€ã€‚å’Œå…¶ä»–æ¶æ„ä¸åŒï¼Œ `Mach` çš„å¯¹è±¡é—´ä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½é€šè¿‡æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼å®ç°å¯¹è±¡é—´çš„é€šä¿¡ã€‚â€`æ¶ˆæ¯`â€æ˜¯ `Mach` ä¸­æœ€åŸºç¡€çš„æ¦‚å¿µï¼Œæ¶ˆæ¯åœ¨ä¸¤ä¸ªç«¯å£ (`port`) ä¹‹é—´ä¼ é€’ï¼Œè¿™å°±æ˜¯ `Mach` çš„ `IPC` (è¿›ç¨‹é—´é€šä¿¡) çš„æ ¸å¿ƒã€‚

`Mach` çš„æ¶ˆæ¯å®šä¹‰æ˜¯åœ¨ `<mach/message.h>` å¤´æ–‡ä»¶çš„ï¼Œå¾ˆç®€å•ï¼š

``` c
typedef struct {
  mach_msg_header_t header;
  mach_msg_body_t body;
} mach_msg_base_t;
 
typedef struct {
  mach_msg_bits_t msgh_bits;
  mach_msg_size_t msgh_size;
  mach_port_t msgh_remote_port;
  mach_port_t msgh_local_port;
  mach_port_name_t msgh_voucher_port;
  mach_msg_id_t msgh_id;
} mach_msg_header_t;
```

ä¸€æ¡ `Mach` æ¶ˆæ¯å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ•°æ®åŒ… (`BLOB`)ï¼Œå…¶å¤´éƒ¨å®šä¹‰äº†å½“å‰ç«¯å£ `local_port` å’Œç›®æ ‡ç«¯å£ `remote_port`ï¼Œå‘é€å’Œæ¥å—æ¶ˆæ¯æ˜¯é€šè¿‡åŒä¸€ä¸ª `API` è¿›è¡Œçš„ï¼Œå…¶ `option` æ ‡è®°äº†æ¶ˆæ¯ä¼ é€’çš„æ–¹å‘ï¼š

``` c
mach_msg_return_t mach_msg(
			mach_msg_header_t *msg,
			mach_msg_option_t option,
			mach_msg_size_t send_size,
			mach_msg_size_t rcv_size,
			mach_port_name_t rcv_name,
			mach_msg_timeout_t timeout,
			mach_port_name_t notify);
```


ä¸ºäº†å®ç°æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶ï¼Œ`mach_msg()` å‡½æ•°å®é™…ä¸Šæ˜¯è°ƒç”¨äº†ä¸€ä¸ª `Mach` é™·é˜± `(trap)`ï¼Œå³å‡½æ•°`mach_msg_trap()`ï¼Œé™·é˜±è¿™ä¸ªæ¦‚å¿µåœ¨ `Mach` ä¸­ç­‰åŒäºç³»ç»Ÿè°ƒç”¨ã€‚å½“ä½ åœ¨ç”¨æˆ·æ€è°ƒç”¨`mach_msg_trap()` æ—¶ä¼šè§¦å‘é™·é˜±æœºåˆ¶ï¼Œåˆ‡æ¢åˆ°å†…æ ¸æ€ï¼›å†…æ ¸æ€ä¸­å†…æ ¸å®ç°çš„ `mach_msg()` å‡½æ•°ä¼šå®Œæˆå®é™…çš„å·¥ä½œï¼Œå¦‚ä¸‹å›¾ï¼š

![](/assets/images/20180402RunLoop/RunLoop5.webp)

è¿™äº›æ¦‚å¿µå¯ä»¥å‚è€ƒç»´åŸºç™¾ç§‘: [System_call](http://en.wikipedia.org/wiki/System_call)ã€[Trap_(computing)](http://en.wikipedia.org/wiki/Trap_(computing))ã€‚


`RunLoop` çš„æ ¸å¿ƒå°±æ˜¯ä¸€ä¸ª `mach_msg()` (è§ä¸Šé¢ä»£ç çš„ç¬¬7æ­¥)ï¼Œ`RunLoop` è°ƒç”¨è¿™ä¸ªå‡½æ•°å»æ¥æ”¶æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰åˆ«äººå‘é€ `port` æ¶ˆæ¯è¿‡æ¥ï¼Œå†…æ ¸ä¼šå°†çº¿ç¨‹ç½®äºç­‰å¾…çŠ¶æ€ã€‚ä¾‹å¦‚ä½ åœ¨æ¨¡æ‹Ÿå™¨é‡Œè·‘èµ·ä¸€ä¸ª `iOS` çš„ `App`ï¼Œç„¶ååœ¨ `App` é™æ­¢æ—¶ç‚¹å‡»æš‚åœï¼Œä½ ä¼šçœ‹åˆ°ä¸»çº¿ç¨‹è°ƒç”¨æ ˆæ˜¯åœç•™åœ¨ `mach_msg_trap()` è¿™ä¸ªåœ°æ–¹ã€‚

å…³äºå…·ä½“çš„å¦‚ä½•åˆ©ç”¨ `mach port` å‘é€ä¿¡æ¯ï¼Œå¯ä»¥çœ‹çœ‹ [NSHipster è¿™ä¸€ç¯‡æ–‡ç« ](http://nshipster.com/inter-process-communication/)ï¼Œæˆ–è€…[è¿™é‡Œ](http://segmentfault.com/a/1190000002400329)çš„ä¸­æ–‡ç¿»è¯‘.

å…³äº`Mach`çš„å†å²å¯ä»¥çœ‹çœ‹è¿™ç¯‡å¾ˆæœ‰è¶£çš„æ–‡ç« ï¼š[Mac OS X èƒŒåçš„æ•…äº‹ï¼ˆä¸‰ï¼‰Mach ä¹‹çˆ¶ Avie Tevanian](http://www.programmer.com.cn/8121/)ã€‚

### è‹¹æœç”¨ RunLoop å®ç°çš„åŠŸèƒ½

é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹`App`å¯åŠ¨å`RunLoop`çš„çŠ¶æ€ï¼š

``` c
CFRunLoop {
    current mode = kCFRunLoopDefaultMode
    common modes = {
        UITrackingRunLoopMode
        kCFRunLoopDefaultMode
    }
 
    common mode items = {
 
        // source0 (manual)
        CFRunLoopSource {order =-1, {
            callout = _UIApplicationHandleEventQueue}}
        CFRunLoopSource {order =-1, {
            callout = PurpleEventSignalCallback }}
        CFRunLoopSource {order = 0, {
            callout = FBSSerialQueueRunLoopSourceHandler}}
 
        // source1 (mach port)
        CFRunLoopSource {order = 0,  {port = 17923}}
        CFRunLoopSource {order = 0,  {port = 12039}}
        CFRunLoopSource {order = 0,  {port = 16647}}
        CFRunLoopSource {order =-1, {
            callout = PurpleEventCallback}}
        CFRunLoopSource {order = 0, {port = 2407,
            callout = _ZL20notify_port_callbackP12__CFMachPortPvlS1_}}
        CFRunLoopSource {order = 0, {port = 1c03,
            callout = __IOHIDEventSystemClientAvailabilityCallback}}
        CFRunLoopSource {order = 0, {port = 1b03,
            callout = __IOHIDEventSystemClientQueueCallback}}
        CFRunLoopSource {order = 1, {port = 1903,
            callout = __IOMIGMachPortPortCallback}}
 
        // Ovserver
        CFRunLoopObserver {order = -2147483647, activities = 0x1, // Entry
            callout = _wrapRunLoopWithAutoreleasePoolHandler}
        CFRunLoopObserver {order = 0, activities = 0x20,          // BeforeWaiting
            callout = _UIGestureRecognizerUpdateObserver}
        CFRunLoopObserver {order = 1999000, activities = 0xa0,    // BeforeWaiting | Exit
            callout = _afterCACommitHandler}
        CFRunLoopObserver {order = 2000000, activities = 0xa0,    // BeforeWaiting | Exit
            callout = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv}
        CFRunLoopObserver {order = 2147483647, activities = 0xa0, // BeforeWaiting | Exit
            callout = _wrapRunLoopWithAutoreleasePoolHandler}
 
        // Timer
        CFRunLoopTimer {firing = No, interval = 3.1536e+09, tolerance = 0,
            next fire date = 453098071 (-4421.76019 @ 96223387169499),
            callout = _ZN2CAL14timer_callbackEP16__CFRunLoopTimerPv (QuartzCore.framework)}
    },
 
    modes ï¼ {
        CFRunLoopMode  {
            sources0 =  { /* same as 'common mode items' */ },
            sources1 =  { /* same as 'common mode items' */ },
            observers = { /* same as 'common mode items' */ },
            timers =    { /* same as 'common mode items' */ },
        },
 
        CFRunLoopMode  {
            sources0 =  { /* same as 'common mode items' */ },
            sources1 =  { /* same as 'common mode items' */ },
            observers = { /* same as 'common mode items' */ },
            timers =    { /* same as 'common mode items' */ },
        },
 
        CFRunLoopMode  {
            sources0 = {
                CFRunLoopSource {order = 0, {
                    callout = FBSSerialQueueRunLoopSourceHandler}}
            },
            sources1 = (null),
            observers = {
                CFRunLoopObserver >{activities = 0xa0, order = 2000000,
                    callout = _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv}
            )},
            timers = (null),
        },
 
        CFRunLoopMode  {
            sources0 = {
                CFRunLoopSource {order = -1, {
                    callout = PurpleEventSignalCallback}}
            },
            sources1 = {
                CFRunLoopSource {order = -1, {
                    callout = PurpleEventCallback}}
            },
            observers = (null),
            timers = (null),
        },
        
        CFRunLoopMode  {
            sources0 = (null),
            sources1 = (null),
            observers = (null),
            timers = (null),
        }
    }
}
```


å¯ä»¥çœ‹åˆ°ï¼Œç³»ç»Ÿé»˜è®¤æ³¨å†Œäº†5ä¸ª`Mode:

1. `kCFRunLoopDefaultMode`: `App`çš„é»˜è®¤ `Mode`ï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ª `Mode` ä¸‹è¿è¡Œçš„ã€‚
2. `UITrackingRunLoopMode`: ç•Œé¢è·Ÿè¸ª `Mode`ï¼Œç”¨äº `ScrollView` è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– `Mode` å½±å“ã€‚
3. `UIInitializationRunLoopMode`: åœ¨åˆšå¯åŠ¨ `App` æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª `Mode`ï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ã€‚
4. `GSEventReceiveRunLoopMode`: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ `Mode`ï¼Œé€šå¸¸ç”¨ä¸åˆ°ã€‚
5. `kCFRunLoopCommonModes`: è¿™æ˜¯ä¸€ä¸ªå ä½çš„ `Mode`ï¼Œæ²¡æœ‰å®é™…ä½œç”¨ã€‚

ä½ å¯ä»¥åœ¨[è¿™é‡Œ](http://iphonedevwiki.net/index.php/CFRunLoop)çœ‹åˆ°æ›´å¤šçš„è‹¹æœå†…éƒ¨çš„ `Mode`ï¼Œä½†é‚£äº› `Mode` åœ¨å¼€å‘ä¸­å°±å¾ˆéš¾é‡åˆ°äº†ã€‚


å½“ `RunLoop` è¿›è¡Œå›è°ƒæ—¶ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡ä¸€ä¸ªå¾ˆé•¿çš„å‡½æ•°è°ƒç”¨å‡ºå» (`call out`), å½“ä½ åœ¨ä½ çš„ä»£ç ä¸­ä¸‹æ–­ç‚¹è°ƒè¯•æ—¶ï¼Œé€šå¸¸èƒ½åœ¨è°ƒç”¨æ ˆä¸Šçœ‹åˆ°è¿™äº›å‡½æ•°ã€‚ä¸‹é¢æ˜¯è¿™å‡ ä¸ªå‡½æ•°çš„æ•´ç†ç‰ˆæœ¬ï¼Œå¦‚æœä½ åœ¨è°ƒç”¨æ ˆä¸­çœ‹åˆ°è¿™äº›é•¿å‡½æ•°åï¼Œåœ¨è¿™é‡ŒæŸ¥æ‰¾ä¸€ä¸‹å°±èƒ½å®šä½åˆ°å…·ä½“çš„è°ƒç”¨åœ°ç‚¹äº†ï¼š

``` c
{
    /// 1. é€šçŸ¥Observersï¼Œå³å°†è¿›å…¥RunLoop
    /// æ­¤å¤„æœ‰Observerä¼šåˆ›å»ºAutoreleasePool: _objc_autoreleasePoolPush();
    __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopEntry);
    do {
 
        /// 2. é€šçŸ¥ Observers: å³å°†è§¦å‘ Timer å›è°ƒã€‚
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeTimers);
        /// 3. é€šçŸ¥ Observers: å³å°†è§¦å‘ Source (éåŸºäºportçš„,Source0) å›è°ƒã€‚
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeSources);
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);
 
        /// 4. è§¦å‘ Source0 (éåŸºäºportçš„) å›è°ƒã€‚
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__(source0);
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__(block);
 
        /// 6. é€šçŸ¥Observersï¼Œå³å°†è¿›å…¥ä¼‘çœ 
        /// æ­¤å¤„æœ‰Observeré‡Šæ”¾å¹¶æ–°å»ºAutoreleasePool: _objc_autoreleasePoolPop(); _objc_autoreleasePoolPush();
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopBeforeWaiting);
 
        /// 7. sleep to wait msg.
        mach_msg() -> mach_msg_trap();
        
 
        /// 8. é€šçŸ¥Observersï¼Œçº¿ç¨‹è¢«å”¤é†’
        __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopAfterWaiting);
 
        /// 9. å¦‚æœæ˜¯è¢«Timerå”¤é†’çš„ï¼Œå›è°ƒTimer
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__(timer);
 
        /// 9. å¦‚æœæ˜¯è¢«dispatchå”¤é†’çš„ï¼Œæ‰§è¡Œæ‰€æœ‰è°ƒç”¨ dispatch_async ç­‰æ–¹æ³•æ”¾å…¥main queue çš„ block
        __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(dispatched_block);
 
        /// 9. å¦‚æœå¦‚æœRunloopæ˜¯è¢« Source1 (åŸºäºportçš„) çš„äº‹ä»¶å”¤é†’äº†ï¼Œå¤„ç†è¿™ä¸ªäº‹ä»¶
        __CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__(source1);
 
 
    } while (...);
 
    /// 10. é€šçŸ¥Observersï¼Œå³å°†é€€å‡ºRunLoop
    /// æ­¤å¤„æœ‰Observeré‡Šæ”¾AutoreleasePool: _objc_autoreleasePoolPop();
    __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(kCFRunLoopExit);
}

```

#### AutoreleasePool

Appå¯åŠ¨åï¼Œè‹¹æœåœ¨ä¸»çº¿ç¨‹ `RunLoop` é‡Œæ³¨å†Œäº†ä¸¤ä¸ª `Observer`ï¼Œå…¶å›è°ƒéƒ½æ˜¯ `_wrapRunLoopWithAutoreleasePoolHandler()`ã€‚

ç¬¬ä¸€ä¸ª `Observer` ç›‘è§†çš„äº‹ä»¶æ˜¯ `Entry`(å³å°†è¿›å…¥`Loop`)ï¼Œå…¶å›è°ƒå†…ä¼šè°ƒç”¨ `_objc_autoreleasePoolPush()` åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚å…¶ `order` æ˜¯`-2147483647`ï¼Œä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯åˆ›å»ºé‡Šæ”¾æ± å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹å‰ã€‚

ç¬¬äºŒä¸ª `Observer` ç›‘è§†äº†ä¸¤ä¸ªäº‹ä»¶ï¼š `BeforeWaiting`(å‡†å¤‡è¿›å…¥ä¼‘çœ ) æ—¶è°ƒç”¨`_objc_autoreleasePoolPop()` å’Œ `_objc_autoreleasePoolPush()` é‡Šæ”¾æ—§çš„æ± å¹¶åˆ›å»ºæ–°æ± ï¼›`Exit`(å³å°†é€€å‡º`Loop`) æ—¶è°ƒç”¨ `_objc_autoreleasePoolPop()` æ¥é‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™ä¸ª `Observer` çš„ `order` æ˜¯ `2147483647`ï¼Œä¼˜å…ˆçº§æœ€ä½ï¼Œä¿è¯å…¶é‡Šæ”¾æ± å­å‘ç”Ÿåœ¨å…¶ä»–æ‰€æœ‰å›è°ƒä¹‹åã€‚


åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œé€šå¸¸æ˜¯å†™åœ¨è¯¸å¦‚äº‹ä»¶å›è°ƒã€`Timer`å›è°ƒå†…çš„ã€‚è¿™äº›å›è°ƒä¼šè¢« `RunLoop` åˆ›å»ºå¥½çš„ `AutoreleasePool` ç¯ç»•ç€ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°å†…å­˜æ³„æ¼ï¼Œå¼€å‘è€…ä¹Ÿä¸å¿…æ˜¾ç¤ºåˆ›å»º` Pool` äº†ã€‚


#### äº‹ä»¶å“åº”

è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª `Source1` (åŸºäº `mach port` çš„) ç”¨æ¥æ¥æ”¶ç³»ç»Ÿäº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¸º `__IOHIDEventSystemClientQueueCallback()`ã€‚

å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶(è§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰)å‘ç”Ÿåï¼Œé¦–å…ˆç”± IOKit.framework ç”Ÿæˆä¸€ä¸ª `IOHIDEvent` äº‹ä»¶å¹¶ç”± `SpringBoard` æ¥æ”¶ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¯¦ç»†æƒ…å†µå¯ä»¥å‚è€ƒ[è¿™é‡Œ](http://iphonedevwiki.net/index.php/IOHIDFamily)ã€‚`SpringBoard` åªæ¥æ”¶æŒ‰é”®(é”å±/é™éŸ³ç­‰)ï¼Œè§¦æ‘¸ï¼ŒåŠ é€Ÿï¼Œæ¥è¿‘ä¼ æ„Ÿå™¨ç­‰å‡ ç§ `Event`ï¼Œéšåç”¨ `mach port` è½¬å‘ç»™éœ€è¦çš„`App`è¿›ç¨‹ã€‚éšåè‹¹æœæ³¨å†Œçš„é‚£ä¸ª `Source1` å°±ä¼šè§¦å‘å›è°ƒï¼Œå¹¶è°ƒç”¨ `_UIApplicationHandleEventQueue()` è¿›è¡Œåº”ç”¨å†…éƒ¨çš„åˆ†å‘ã€‚


`_UIApplicationHandleEventQueue()` ä¼šæŠŠ `IOHIDEvent` å¤„ç†å¹¶åŒ…è£…æˆ `UIEvent` è¿›è¡Œå¤„ç†æˆ–åˆ†å‘ï¼Œå…¶ä¸­åŒ…æ‹¬è¯†åˆ« `UIGesture`/`å¤„ç†å±å¹•æ—‹è½¬`/å‘é€ç»™ `UIWindow` ç­‰ã€‚é€šå¸¸äº‹ä»¶æ¯”å¦‚ `UIButton` ç‚¹å‡»ã€`touchesBegin`/`Move`/`End`/`Cancel` äº‹ä»¶éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒä¸­å®Œæˆçš„ã€‚

#### æ‰‹åŠ¿è¯†åˆ«

å½“ä¸Šé¢çš„ `_UIApplicationHandleEventQueue()` è¯†åˆ«äº†ä¸€ä¸ªæ‰‹åŠ¿æ—¶ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨ `Cancel` å°†å½“å‰çš„ `touchesBegin`/`Move`/`End` ç³»åˆ—å›è°ƒæ‰“æ–­ã€‚éšåç³»ç»Ÿå°†å¯¹åº”çš„ `UIGestureRecognizer` æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚

è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª `Observer` ç›‘æµ‹ `BeforeWaiting` (`Loop`å³å°†è¿›å…¥ä¼‘çœ ) äº‹ä»¶ï¼Œè¿™ä¸ª`Observer`çš„å›è°ƒå‡½æ•°æ˜¯ `_UIGestureRecognizerUpdateObserver()`ï¼Œå…¶å†…éƒ¨ä¼šè·å–æ‰€æœ‰åˆšè¢«æ ‡è®°ä¸ºå¾…å¤„ç†çš„ `GestureRecognizer`ï¼Œå¹¶æ‰§è¡Œ`GestureRecognizer`çš„å›è°ƒã€‚

å½“æœ‰ `UIGestureRecognizer` çš„å˜åŒ–(`åˆ›å»º`/`é”€æ¯`/`çŠ¶æ€æ”¹å˜`)æ—¶ï¼Œè¿™ä¸ªå›è°ƒéƒ½ä¼šè¿›è¡Œç›¸åº”å¤„ç†ã€‚

#### ç•Œé¢æ›´æ–°

å½“åœ¨æ“ä½œ `UI` æ—¶ï¼Œæ¯”å¦‚æ”¹å˜äº† `Frame`ã€æ›´æ–°äº† `UIView`/`CALayer` çš„å±‚æ¬¡æ—¶ï¼Œæˆ–è€…æ‰‹åŠ¨è°ƒç”¨äº† `UIView`/`CALayer` çš„ `setNeedsLayout`/`setNeedsDisplay`æ–¹æ³•åï¼Œè¿™ä¸ª `UIView`/`CALayer` å°±è¢«æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œå¹¶è¢«æäº¤åˆ°ä¸€ä¸ªå…¨å±€çš„å®¹å™¨å»ã€‚

è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª `Observer` ç›‘å¬ `BeforeWaiting`(å³å°†è¿›å…¥ä¼‘çœ ) å’Œ `Exit` (å³å°†é€€å‡º`Loop`) äº‹ä»¶ï¼Œå›è°ƒå»æ‰§è¡Œä¸€ä¸ªå¾ˆé•¿çš„å‡½æ•°ï¼š
`_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()`ã€‚è¿™ä¸ªå‡½æ•°é‡Œä¼šéå†æ‰€æœ‰å¾…å¤„ç†çš„ `UIView`/`CAlayer` ä»¥æ‰§è¡Œå®é™…çš„ç»˜åˆ¶å’Œè°ƒæ•´ï¼Œå¹¶æ›´æ–° `UI` ç•Œé¢ã€‚

è¿™ä¸ªå‡½æ•°å†…éƒ¨çš„è°ƒç”¨æ ˆå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š

``` c++
_ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()
    QuartzCore:CA::Transaction::observer_callback:
        CA::Transaction::commit();
            CA::Context::commit_transaction();
                CA::Layer::layout_and_display_if_needed();
                    CA::Layer::layout_if_needed();
                        [CALayer layoutSublayers];
                            [UIView layoutSubviews];
                    CA::Layer::display_if_needed();
                        [CALayer display];
                            [UIView drawRect];

```

#### å®šæ—¶å™¨

`NSTimer` å…¶å®å°±æ˜¯ `CFRunLoopTimerRef`ï¼Œä»–ä»¬ä¹‹é—´æ˜¯ `toll-free bridged` çš„ã€‚ä¸€ä¸ª `NSTimer` æ³¨å†Œåˆ° `RunLoop` åï¼Œ`RunLoop` ä¼šä¸ºå…¶é‡å¤çš„æ—¶é—´ç‚¹æ³¨å†Œå¥½äº‹ä»¶ã€‚ä¾‹å¦‚ `10:00`, `10:10`, `10:20` è¿™å‡ ä¸ªæ—¶é—´ç‚¹ã€‚`RunLoop`ä¸ºäº†èŠ‚çœèµ„æºï¼Œå¹¶ä¸ä¼šåœ¨éå¸¸å‡†ç¡®çš„æ—¶é—´ç‚¹å›è°ƒè¿™ä¸ª`Timer`ã€‚`Timer` æœ‰ä¸ªå±æ€§å«åš `Tolerance` (å®½å®¹åº¦)ï¼Œæ ‡ç¤ºäº†å½“æ—¶é—´ç‚¹åˆ°åï¼Œå®¹è®¸æœ‰å¤šå°‘æœ€å¤§è¯¯å·®ã€‚

å¦‚æœæŸä¸ªæ—¶é—´ç‚¹è¢«é”™è¿‡äº†ï¼Œä¾‹å¦‚æ‰§è¡Œäº†ä¸€ä¸ªå¾ˆé•¿çš„ä»»åŠ¡ï¼Œåˆ™é‚£ä¸ªæ—¶é—´ç‚¹çš„å›è°ƒä¹Ÿä¼šè·³è¿‡å»ï¼Œä¸ä¼šå»¶åæ‰§è¡Œã€‚å°±æ¯”å¦‚ç­‰å…¬äº¤ï¼Œå¦‚æœ `10:10` æ—¶æˆ‘å¿™ç€ç©æ‰‹æœºé”™è¿‡äº†é‚£ä¸ªç‚¹çš„å…¬äº¤ï¼Œé‚£æˆ‘åªèƒ½ç­‰ `10:20` è¿™ä¸€è¶Ÿäº†ã€‚


`CADisplayLink` æ˜¯ä¸€ä¸ªå’Œå±å¹•åˆ·æ–°ç‡ä¸€è‡´çš„å®šæ—¶å™¨ï¼ˆä½†å®é™…å®ç°åŸç†æ›´å¤æ‚ï¼Œå’Œ `NSTimer` å¹¶ä¸ä¸€æ ·ï¼Œå…¶å†…éƒ¨å®é™…æ˜¯æ“ä½œäº†ä¸€ä¸ª `Source`ï¼‰ã€‚å¦‚æœåœ¨ä¸¤æ¬¡å±å¹•åˆ·æ–°ä¹‹é—´æ‰§è¡Œäº†ä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œé‚£å…¶ä¸­å°±ä¼šæœ‰ä¸€å¸§è¢«è·³è¿‡å»ï¼ˆå’Œ `NSTimer` ç›¸ä¼¼ï¼‰ï¼Œé€ æˆç•Œé¢å¡é¡¿çš„æ„Ÿè§‰ã€‚åœ¨å¿«é€Ÿæ»‘åŠ¨`TableView`æ—¶ï¼Œå³ä½¿ä¸€å¸§çš„å¡é¡¿ä¹Ÿä¼šè®©ç”¨æˆ·æœ‰æ‰€å¯Ÿè§‰ã€‚`Facebook` å¼€æºçš„`AsyncDisplayLink` å°±æ˜¯ä¸ºäº†è§£å†³ç•Œé¢å¡é¡¿çš„é—®é¢˜ï¼Œå…¶å†…éƒ¨ä¹Ÿç”¨åˆ°äº† `RunLoop`ï¼Œè¿™ä¸ªç¨åæˆ‘ä¼šå†å•ç‹¬å†™ä¸€é¡µåšå®¢æ¥åˆ†æã€‚


#### PerformSelecter

å½“è°ƒç”¨ `NSObject` çš„ `performSelecter:afterDelay:` åï¼Œå®é™…ä¸Šå…¶å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª `Timer` å¹¶æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„ `RunLoop` ä¸­ã€‚æ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ `RunLoop`ï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚

å½“è°ƒç”¨ `performSelector:onThread:` æ—¶ï¼Œå®é™…ä¸Šå…¶ä¼šåˆ›å»ºä¸€ä¸ª `Timer` åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹å»ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¯¹åº”çº¿ç¨‹æ²¡æœ‰ `RunLoop` è¯¥æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚

#### å…³äºGCD

å®é™…ä¸Š `RunLoop` åº•å±‚ä¹Ÿä¼šç”¨åˆ° GCD çš„ä¸œè¥¿ï¼Œ ä¾‹å¦‚ `dispatch_async()`ã€‚

> NSTimer æ˜¯ç”¨äº† XNU å†…æ ¸çš„ `mk_timer`æ¥é©±åŠ¨çš„ï¼Œè€Œé GCD é©±åŠ¨çš„.


å½“è°ƒç”¨ `dispatch_async(dispatch_get_main_queue(), block)` æ—¶ï¼Œ`libDispatch` ä¼šå‘ä¸»çº¿ç¨‹çš„ `RunLoop` å‘é€æ¶ˆæ¯ï¼ŒRunLoopä¼šè¢«å”¤é†’ï¼Œå¹¶ä»æ¶ˆæ¯ä¸­å–å¾—è¿™ä¸ª `block`ï¼Œå¹¶åœ¨å›è°ƒ `__CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__()` é‡Œæ‰§è¡Œè¿™ä¸ª `block`ã€‚ä½†è¿™ä¸ªé€»è¾‘ä»…é™äº `dispatch` åˆ°ä¸»çº¿ç¨‹ï¼Œ`dispatch` åˆ°å…¶ä»–çº¿ç¨‹ä»ç„¶æ˜¯ç”± `libDispatch` å¤„ç†çš„ã€‚

#### å…³äºç½‘ç»œè¯·æ±‚

iOS ä¸­ï¼Œå…³äºç½‘ç»œè¯·æ±‚çš„æ¥å£è‡ªä¸‹è‡³ä¸Šæœ‰å¦‚ä¸‹å‡ å±‚:

``` c
CFSocket
CFNetwork       ->ASIHttpRequest
NSURLConnection ->AFNetworking
NSURLSession    ->AFNetworking2, Alamofire
```

* `CFSocket` æ˜¯æœ€åº•å±‚çš„æ¥å£ï¼Œåªè´Ÿè´£ `socket` é€šä¿¡ã€‚
* `CFNetwork` æ˜¯åŸºäº `CFSocket` ç­‰æ¥å£çš„ä¸Šå±‚å°è£…ï¼Œ`ASIHttpRequest` å·¥ä½œäºè¿™ä¸€å±‚ã€‚
* `NSURLConnection` æ˜¯åŸºäº `CFNetwork` çš„æ›´é«˜å±‚çš„å°è£…ï¼Œæä¾›é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œ`AFNetworking`å·¥ä½œäºè¿™ä¸€å±‚ã€‚
* `NSURLSession` æ˜¯ `iOS7` ä¸­æ–°å¢çš„æ¥å£ï¼Œè¡¨é¢ä¸Šæ˜¯å’Œ `NSURLConnection`å¹¶åˆ—çš„ï¼Œä½†åº•å±‚ä»ç„¶ç”¨åˆ°äº† `NSURLConnection` çš„éƒ¨åˆ†åŠŸèƒ½ (æ¯”å¦‚ `com.apple.NSURLConnectionLoader` çº¿ç¨‹)ï¼Œ`AFNetworking2` å’Œ `Alamofire` å·¥ä½œäºè¿™ä¸€å±‚ã€‚


##### ä¸‹é¢ä¸»è¦ä»‹ç»ä¸‹ NSURLConnection çš„å·¥ä½œè¿‡ç¨‹ã€‚

é€šå¸¸ä½¿ç”¨ `NSURLConnection`æ—¶ï¼Œä½ ä¼šä¼ å…¥ä¸€ä¸ª `Delegate`ï¼Œå½“è°ƒç”¨äº† `[connection start]` åï¼Œè¿™ä¸ª `Delegate` å°±ä¼šä¸åœæ”¶åˆ°äº‹ä»¶å›è°ƒã€‚å®é™…ä¸Šï¼Œ`start` è¿™ä¸ªå‡½æ•°çš„å†…éƒ¨ä¼šä¼šè·å– `CurrentRunLoop`ï¼Œç„¶ååœ¨å…¶ä¸­çš„ `DefaultMode` æ·»åŠ äº†4ä¸ª `Source0 `(å³éœ€è¦æ‰‹åŠ¨è§¦å‘çš„`Source`)ã€‚`CFMultiplexerSource` æ˜¯è´Ÿè´£å„ç§ `Delegate` å›è°ƒçš„ï¼Œ`CFHTTPCookieStorage` æ˜¯å¤„ç†å„ç§ `Cookie` çš„ã€‚


å½“å¼€å§‹ç½‘ç»œä¼ è¾“æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° `NSURLConnection` åˆ›å»ºäº†ä¸¤ä¸ªæ–°çº¿ç¨‹ï¼š`com.apple.NSURLConnectionLoader` å’Œ `com.apple.CFSocket.private`ã€‚å…¶ä¸­ `CFSocket` çº¿ç¨‹æ˜¯å¤„ç†åº•å±‚ `socket` è¿æ¥çš„ã€‚`NSURLConnectionLoader` è¿™ä¸ªçº¿ç¨‹å†…éƒ¨ä¼šä½¿ç”¨ `RunLoop` æ¥æ¥æ”¶åº•å±‚ `socket` çš„äº‹ä»¶ï¼Œå¹¶é€šè¿‡ä¹‹å‰æ·»åŠ çš„ `Source0` é€šçŸ¥åˆ°ä¸Šå±‚çš„ `Delegate`ã€‚

![](/assets/images/20180402RunLoop/RunLoopNetwork.webp)

`NSURLConnectionLoader` ä¸­çš„ `RunLoop` é€šè¿‡ä¸€äº›åŸºäº `mach port` çš„`Source` æ¥æ”¶æ¥è‡ªåº•å±‚ `CFSocket` çš„é€šçŸ¥ã€‚å½“æ”¶åˆ°é€šçŸ¥åï¼Œå…¶ä¼šåœ¨åˆé€‚çš„æ—¶æœºå‘ `CFMultiplexerSource` ç­‰ `Source0` å‘é€é€šçŸ¥ï¼ŒåŒæ—¶å”¤é†’ `Delegate` çº¿ç¨‹çš„ `RunLoop` æ¥è®©å…¶å¤„ç†è¿™äº›é€šçŸ¥ã€‚`CFMultiplexerSource` ä¼šåœ¨ `Delegate` çº¿ç¨‹çš„ `RunLoop` å¯¹ `Delegate` æ‰§è¡Œå®é™…çš„å›è°ƒã€‚


### RunLoop çš„å®é™…åº”ç”¨ä¸¾ä¾‹

#### AFNetworking

[AFURLConnectionOperation](https://github.com/AFNetworking/AFNetworking/blob/master/AFNetworking%2FAFURLConnectionOperation.m) è¿™ä¸ªç±»æ˜¯åŸºäº `NSURLConnection` æ„å»ºçš„ï¼Œå…¶å¸Œæœ›èƒ½åœ¨åå°çº¿ç¨‹æ¥æ”¶ `Delegate` å›è°ƒã€‚ä¸ºæ­¤ `AFNetworking `å•ç‹¬åˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œå¹¶åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­å¯åŠ¨äº†ä¸€ä¸ª `RunLoop`


``` objc
+ (void)networkRequestThreadEntryPoint:(id)__unused object {
    @autoreleasepool {
        [[NSThread currentThread] setName:@"AFNetworking"];
        NSRunLoop *runLoop = [NSRunLoop currentRunLoop];
        [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode];
        [runLoop run];
    }
}
 
+ (NSThread *)networkRequestThread {
    static NSThread *_networkRequestThread = nil;
    static dispatch_once_t oncePredicate;
    dispatch_once(&oncePredicate, ^{
        _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil];
        [_networkRequestThread start];
    });
    return _networkRequestThread;
}
```

`RunLoop` å¯åŠ¨å‰å†…éƒ¨å¿…é¡»è¦æœ‰è‡³å°‘ä¸€ä¸ª `Timer`/`Observer`/`Source`ï¼Œæ‰€ä»¥ `AFNetworking` åœ¨ `[runLoop run]` ä¹‹å‰å…ˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ `NSMachPort` æ·»åŠ è¿›å»äº†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè°ƒç”¨è€…éœ€è¦æŒæœ‰è¿™ä¸ª `NSMachPort` (`mach_port`) å¹¶åœ¨å¤–éƒ¨çº¿ç¨‹é€šè¿‡è¿™ä¸ª `port` å‘é€æ¶ˆæ¯åˆ° `loop` å†…ï¼›ä½†æ­¤å¤„æ·»åŠ  `port` åªæ˜¯ä¸ºäº†è®© `RunLoop` ä¸è‡³äºé€€å‡ºï¼Œå¹¶æ²¡æœ‰ç”¨äºå®é™…çš„å‘é€æ¶ˆæ¯ã€‚

``` objc
- (void)start {
    [self.lock lock];
    if ([self isCancelled]) {
        [self performSelector:@selector(cancelConnection) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    } else if ([self isReady]) {
        self.state = AFOperationExecutingState;
        [self performSelector:@selector(operationDidStart) onThread:[[self class] networkRequestThread] withObject:nil waitUntilDone:NO modes:[self.runLoopModes allObjects]];
    }
    [self.lock unlock];
}
```

å½“éœ€è¦è¿™ä¸ªåå°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œ`AFNetworking` é€šè¿‡è°ƒç”¨ `[NSObject performSelector:onThread:..]` å°†è¿™ä¸ªä»»åŠ¡æ‰”åˆ°äº†åå°çº¿ç¨‹çš„ `RunLoop` ä¸­ã€‚

#### AsyncDisplayKit

[AsyncDisplayKit](https://github.com/facebook/AsyncDisplayKit) æ˜¯ Facebook æ¨å‡ºçš„ç”¨äºä¿æŒç•Œé¢æµç•…æ€§çš„æ¡†æ¶ï¼Œå…¶åŸç†å¤§è‡´å¦‚ä¸‹ï¼š

`UI` çº¿ç¨‹ä¸­ä¸€æ—¦å‡ºç°ç¹é‡çš„ä»»åŠ¡å°±ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ï¼Œè¿™ç±»ä»»åŠ¡é€šå¸¸åˆ†ä¸º3ç±»ï¼š`æ’ç‰ˆ`ï¼Œ`ç»˜åˆ¶`ï¼Œ`UIå¯¹è±¡æ“ä½œ`ã€‚

æ’ç‰ˆé€šå¸¸åŒ…æ‹¬è®¡ç®—è§†å›¾å¤§å°ã€è®¡ç®—æ–‡æœ¬é«˜åº¦ã€é‡æ–°è®¡ç®—å­å¼å›¾çš„æ’ç‰ˆç­‰æ“ä½œã€‚
ç»˜åˆ¶ä¸€èˆ¬æœ‰æ–‡æœ¬ç»˜åˆ¶ (ä¾‹å¦‚ `CoreText`)ã€å›¾ç‰‡ç»˜åˆ¶ (ä¾‹å¦‚é¢„å…ˆè§£å‹)ã€å…ƒç´ ç»˜åˆ¶ (`Quartz`)ç­‰æ“ä½œã€‚
`UI`å¯¹è±¡æ“ä½œé€šå¸¸åŒ…æ‹¬ `UIView`/`CALayer` ç­‰ UI å¯¹è±¡çš„åˆ›å»ºã€è®¾ç½®å±æ€§å’Œé”€æ¯ã€‚

å…¶ä¸­å‰ä¸¤ç±»æ“ä½œå¯ä»¥é€šè¿‡å„ç§æ–¹æ³•æ‰”åˆ°åå°çº¿ç¨‹æ‰§è¡Œï¼Œè€Œæœ€åä¸€ç±»æ“ä½œåªèƒ½åœ¨ä¸»çº¿ç¨‹å®Œæˆï¼Œå¹¶ä¸”æœ‰æ—¶åé¢çš„æ“ä½œéœ€è¦ä¾èµ–å‰é¢æ“ä½œçš„ç»“æœ ï¼ˆä¾‹å¦‚`TextView`åˆ›å»ºæ—¶å¯èƒ½éœ€è¦æå‰è®¡ç®—å‡ºæ–‡æœ¬çš„å¤§å°ï¼‰ã€‚`ASDK` æ‰€åšçš„ï¼Œå°±æ˜¯å°½é‡å°†èƒ½æ”¾å…¥åå°çš„ä»»åŠ¡æ”¾å…¥åå°ï¼Œä¸èƒ½çš„åˆ™å°½é‡æ¨è¿Ÿ (ä¾‹å¦‚è§†å›¾çš„åˆ›å»ºã€å±æ€§çš„è°ƒæ•´)ã€‚

ä¸ºæ­¤ï¼Œ`ASDK` åˆ›å»ºäº†ä¸€ä¸ªåä¸º `ASDisplayNode` çš„å¯¹è±¡ï¼Œå¹¶åœ¨å†…éƒ¨å°è£…äº† `UIView`/`CALayer`ï¼Œå®ƒå…·æœ‰å’Œ `UIView`/`CALayer` ç›¸ä¼¼çš„å±æ€§ï¼Œä¾‹å¦‚ `frame`ã€`backgroundColor`ç­‰ã€‚æ‰€æœ‰è¿™äº›å±æ€§éƒ½å¯ä»¥åœ¨åå°çº¿ç¨‹æ›´æ”¹ï¼Œå¼€å‘è€…å¯ä»¥åªé€šè¿‡ `Node` æ¥æ“ä½œå…¶å†…éƒ¨çš„ `UIView`/`CALayer`ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ’ç‰ˆå’Œç»˜åˆ¶æ”¾å…¥äº†åå°çº¿ç¨‹ã€‚ä½†æ˜¯æ— è®ºæ€ä¹ˆæ“ä½œï¼Œè¿™äº›å±æ€§æ€»éœ€è¦åœ¨æŸä¸ªæ—¶åˆ»åŒæ­¥åˆ°ä¸»çº¿ç¨‹çš„ `UIView`/`CALayer` å»ã€‚

`ASDK` ä»¿ç…§ `QuartzCore`/`UIKit` æ¡†æ¶çš„æ¨¡å¼ï¼Œå®ç°äº†ä¸€å¥—ç±»ä¼¼çš„ç•Œé¢æ›´æ–°çš„æœºåˆ¶ï¼šå³åœ¨ä¸»çº¿ç¨‹çš„ `RunLoop` ä¸­æ·»åŠ ä¸€ä¸ª `Observer`ï¼Œç›‘å¬äº† `kCFRunLoopBeforeWaiting` å’Œ `kCFRunLoopExit` äº‹ä»¶ï¼Œåœ¨æ”¶åˆ°å›è°ƒæ—¶ï¼Œéå†æ‰€æœ‰ä¹‹å‰æ”¾å…¥é˜Ÿåˆ—çš„å¾…å¤„ç†çš„ä»»åŠ¡ï¼Œç„¶åä¸€ä¸€æ‰§è¡Œã€‚
å…·ä½“çš„ä»£ç å¯ä»¥çœ‹è¿™é‡Œï¼š[_ASAsyncTransactionGroup](https://github.com/facebook/AsyncDisplayKit/blob/master/AsyncDisplayKit%2FDetails%2FTransactions%2F_ASAsyncTransactionGroup.m)ã€‚

### æœ€å

`RunLoop` éœ€è¦æ·±å…¥ç†è§£

å…¨æ–‡å®Œ

[å‚è€ƒ](https://blog.ibireme.com/2015/05/18/runloop/#base)


URL: https://sunyazhou.com/2018/03/Swft4ArraySkills/index.html.md
Published At: 2018-03-14 10:17:56 +0000

# Swift 4 ä¸­çš„æ•°ç»„æŠ€å·§

# å‰è¨€

å¹´å‰ä¹°äº†æœ¬[Swift è¿›é˜¶](https://objccn.io/products/advanced-swift/)(swift4.0),è¿‡å®Œå¹´å›æ¥æ­£åœ¨ä¸€ç‚¹ç‚¹å­¦ä¹ ,ä¸å¾—ä¸è¯´å–µç¥å†™çš„ä¸œè¥¿è¿˜æ˜¯ä¸é”™çš„,ï¿¥69å…ƒå¯¹å¹¿å¤§ç¨‹åºå‘˜æ¥è¯´å·²ç»ä¸ç®—å•¥äº†.å¦‚æœæ„Ÿå…´è¶£å¯ä»¥ä¹°ä¸€æœ¬,çœŸå¿ƒä¸é”™

å½“æˆ‘ä»å¤´æ¥å­¦ä¹ æ•°ç»„çš„æ—¶å€™å‘ç°å¥½å¤šå‡½æ•°çœŸçš„å¤ªæœ‰ç”¨äº†

## Swift 4.0 ä¸­çš„å¯å˜æ•°ç»„æŠ€å·§

æˆ‘ä»¬å¯ç”¨ Xcode åˆ›å»ºplayground æ¥è¿›è¡Œç»ƒä¹ 

__é¦–å…ˆåˆ›å»ºä¸ªæ•°ç»„__

``` swift
let array = NSMutableArray(array: [1, 2, 3, 4 , 5, 6])

```

__for in å¾ªç¯éå†__

``` swift
for x in array {
    print(x)
}
```

æ‰“å°

``` sh
1 2 3 4 5 6
```

__æƒ³è¦æ‰£é™¤ç¬¬ä¸€ä¸ªå…ƒç´ å‰©ä½™çš„å…ƒç´ è¿›è¡Œè¿­ä»£éå†å‘¢ï¼Ÿ__

``` swift 
for x in array.dropFirst(){
    print(x)
}
```

æ‰“å°

``` sh
2 3 4 5 6
```

> dropFirst() å‡½æ•°å‚æ•°æ˜¯å¯ä»¥æ·»åŠ æ•°å€¼çš„  for x in array.dropFirst(3) æ‰“å°:4 5 6.


æœ‰ `first` çš„åœ°æ–¹åŸºæœ¬å°±æœ‰`last`

__æƒ³è¦æ‰£é™¤æœ€å 3 ä¸ªå…ƒç´ ä»¥å¤–çš„å…ƒç´ è¿›è¡Œéå†ï¼Ÿ__

``` swift
for x in array.dropLast(3){
    print(x)
}
```

æ‰“å°

``` sh
1 2 3
```

__å¸¦ä¸‹æ ‡å’Œæ•°ç»„å…ƒç´ éå†__

``` swift
for (num, element) in array.enumerated() {
    print(num, element)
}
```

æ‰“å° å·¦è¾¹ä¸‹æ ‡ å³è¾¹å…ƒç´ 

``` sh
0 1
1 2
2 3
3 4
4 5
5 6

```

> å·¦è¾¹ä¸‹æ ‡ å³è¾¹å…ƒç´ 


å…¨æ–‡å®Œ





URL: https://sunyazhou.com/2018/03/WhatIsThedSYM/index.html.md
Published At: 2018-03-08 11:14:12 +0000

# ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨?

![](/assets/images/20180308WhatIsThedSYM/homePageLog.webp)

# å‰è¨€

iOS å¼€å‘ä¸­ç»å¸¸å›å®šä½ bug é€šè¿‡å´©æºƒå †æ ˆ,æ­¤æ—¶æˆ‘ä»¬éœ€è¦å€ŸåŠ©ç¬¦å·è¡¨æ¥æ¢å¤å†…å­˜åœ°å€å¯¹åº”ä»£ç è°ƒç”¨ä¿¡æ¯,ä¸ºäº†è§£å¼€è¿™ä¸ªå¤§å®¶è€³ç†Ÿèƒ½è¯¦å´æ€»æœ‰äººé—®çš„é—®é¢˜çš„é¢çº±,æˆ‘åœ¨ bugle å¹³å°å’Œä¸€äº›æ–‡ç« ä¸­æ”¶é›†äº†ç›¸å…³çŸ¥è¯†æ•´ç†å‡ºæ¥,ä»¥ä¾¿åç»­æ–¹ä¾¿è®°å¿†.


## æœ¬å‘¨ä¸»è¦å†…å®¹å¦‚ä¸‹

* ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨ï¼Ÿ
* ä¸ºä»€ä¹ˆè¦é…ç½®ç¬¦å·è¡¨ï¼Ÿ
* dSYMæ–‡ä»¶ï¼Ÿ



### ä»€ä¹ˆæ˜¯ç¬¦å·è¡¨ï¼Ÿ

ç¬¦å·è¡¨æ˜¯å†…å­˜åœ°å€ä¸å‡½æ•°åã€æ–‡ä»¶åã€è¡Œå·çš„æ˜ å°„è¡¨ã€‚ç¬¦å·è¡¨å…ƒç´ å¦‚ä¸‹æ‰€ç¤ºï¼š

`<èµ·å§‹åœ°å€>` `<ç»“æŸåœ°å€>` `<å‡½æ•°>` [`<æ–‡ä»¶å>`:`<è¡Œå·>`]  


### ä¸ºä»€ä¹ˆè¦é…ç½®ç¬¦å·è¡¨ï¼Ÿ

ä¸ºäº†èƒ½å¿«é€Ÿå¹¶å‡†ç¡®åœ°å®šä½ç”¨æˆ·APPå‘ç”Ÿ`Crash`çš„ä»£ç `ä½ç½®`ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç¬¦å·è¡¨å¯¹APPå‘ç”Ÿ`Crash`çš„ç¨‹åº`å †æ ˆ`è¿›è¡Œ`è§£æ`å’Œ`è¿˜åŸ`ã€‚

ä¸¾ä¸€ä¸ªä¾‹å­ï¼š

![](/assets/images/20180308WhatIsThedSYM/stackSymbol.webp)


ä¸Šå›¾æ˜¯æˆ‘ä»¬é€šè¿‡ç¬¦å·è¡¨æ¥è§£æå‡ºæ¥å´©æºƒå †æ ˆçš„è°ƒç”¨



### ä»€ä¹ˆæ˜¯dSYMæ–‡ä»¶ï¼Ÿ

iOSå¹³å°ä¸­ï¼Œ`dSYM`æ–‡ä»¶æ˜¯æŒ‡å…·æœ‰è°ƒè¯•ä¿¡æ¯çš„ç›®æ ‡æ–‡ä»¶ï¼Œæ–‡ä»¶åé€šå¸¸ä¸ºï¼š `com.å…¬å¸å.dSYM`ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](/assets/images/20180308WhatIsThedSYM/testdSYM.webp)

ä¸€èˆ¬éƒ½æ˜¯å’ŒXcode å·¥ç¨‹åçš„ agetä¸€æ ·çš„åå­—

> ä¸ºäº†æ–¹ä¾¿æ‰¾å›Crashå¯¹åº”çš„dSYMæ–‡ä»¶å’Œè¿˜åŸå †æ ˆï¼Œå»ºè®®æ¯æ¬¡æ„å»ºæˆ–è€…å‘å¸ƒAPPç‰ˆæœ¬çš„æ—¶å€™ï¼Œå¤‡ä»½å¥½dSYMæ–‡ä»¶



#### å¦‚ä½•å®šä½dSYMæ–‡ä»¶ï¼Ÿ

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé¡¹ç›®ç¼–è¯‘å®Œ`dSYM`æ–‡ä»¶è·Ÿ`app`æ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ï¼Œä¸‹é¢ä»¥`XCode`ä½œä¸ºIDEè¯¦ç»†è¯´æ˜å®šä½`dSYM`æ–‡ä»¶

![](/assets/images/20180308WhatIsThedSYM/dSYM1.webp)

![](/assets/images/20180308WhatIsThedSYM/dSYM2.webp)


> è¿™é‡Œç”¨ release æ¨¡å¼åšçš„æµ‹è¯• 

æˆ‘ä»¬çœ‹åˆ° å’Œå·¥ç¨‹ `target`ä¸€æ ·çš„åç§°çš„ `.dSYM`.


#### XCodeç¼–è¯‘åæ²¡æœ‰ç”ŸæˆdSYMæ–‡ä»¶?

XCodeåœ¨ `Release`ç¼–è¯‘ç¯å¢ƒä¸‹é»˜è®¤ä¼šç”Ÿæˆ`dSYM`æ–‡ä»¶ï¼Œè€Œ`Debug`ç¼–è¯‘ç¯å¢ƒä¸‹é»˜è®¤ä¸ä¼šç”Ÿæˆ

å¦‚æœè¦åœ¨`Debug`å¯¹åº”çš„`Xcode`é…ç½®å¦‚ä¸‹:

`XCode -> Build Settings -> Code Generation -> Generate Debug Symbols -> Yes`  
`XCode -> Build Settings -> Build Option -> Debug Information Format -> DWARF with dSYM File`

![](/assets/images/20180308WhatIsThedSYM/dSYM3.webp)  
![](/assets/images/20180308WhatIsThedSYM/dSYM4.webp)

#### å¼€å¯Bitcodeä¹‹åéœ€è¦æ³¨æ„å“ªäº›é—®é¢˜?

* åœ¨ç‚¹`Upload to App Store`ä¸Šä¼ åˆ°`App Store`æœåŠ¡å™¨çš„æ—¶å€™éœ€è¦å£°æ˜ç¬¦å·æ–‡ä»¶(`dSYM`æ–‡ä»¶)çš„ç”Ÿæˆ:

![](/assets/images/20180308WhatIsThedSYM/dSYM5.webp)

* åœ¨é…ç½®ç¬¦å·è¡¨æ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦ä»App Storeä¸­æŠŠè¯¥ç‰ˆæœ¬å¯¹åº”çš„dSYMæ–‡ä»¶ä¸‹è½½å›æœ¬åœ°,ç„¶åç”¨ç¬¦å·è¡¨å·¥å…·ç”Ÿæˆå’Œä¸Šä¼ ç¬¦å·è¡¨æ–‡ä»¶ã€‚

è¿™é‡Œæ‰¾å›`ipa`ç‰ˆæœ¬å¯¹åº”çš„dSYMæ–‡ä»¶æœ‰ä¸¤ç§æ–¹å¼

1. é€šè¿‡Xcodeçš„å½’æ¡£æ–‡ä»¶æ‰¾å›dSYM,æ‰“å¼€`Xcode` é¡¶éƒ¨èœå•æ  -> `Window` -> `Organizer` çª—å£,å¦‚ä¸‹å›¾:
	![](/assets/images/20180308WhatIsThedSYM/BitcodedSYM2.webp)  
	æ‰“å¼€ `Xcode` é¡¶éƒ¨èœå•æ ï¼Œé€‰æ‹©`Archive` æ ‡ç­¾:   
	![](/assets/images/20180308WhatIsThedSYM/BitcodedSYM3.webp)  
	æ‰¾åˆ°å‘å¸ƒçš„å½’æ¡£åŒ…ï¼Œå³é”®ç‚¹å‡»å¯¹åº”å½’æ¡£åŒ…ï¼Œé€‰æ‹©`Show in Finder`æ“ä½œ:  
	![](/assets/images/20180308WhatIsThedSYM/BitcodedSYM4.webp)
	å³é”®é€‰æ‹©å®šä½åˆ°çš„å½’æ¡£æ–‡ä»¶ï¼Œé€‰æ‹©æ˜¾ç¤ºåŒ…å†…å®¹æ“ä½œ:  
	![](/assets/images/20180308WhatIsThedSYM/BitcodedSYM5.webp)  
	é€‰æ‹©`dSYMs`ç›®å½•ï¼Œç›®å½•å†…å³ä¸ºä¸‹è½½åˆ°çš„ `dSYM` æ–‡ä»¶:  
	![](/assets/images/20180308WhatIsThedSYM/BitcodedSYM6.webp)
	
2. é€šè¿‡[iTunes Connect](https://itunesconnect.apple.com/)æ‰¾å›
	
	![](/assets/images/20180308WhatIsThedSYM/itunesConnect.webp)
	
	åœ¨â€œæ‰€æœ‰æ„ä»¶ç‰ˆæœ¬ï¼ˆAll Buildsï¼‰â€ä¸­é€‰æ‹©æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œç‚¹â€œä¸‹è½½`dSYM`ï¼ˆDownload dSYMï¼‰â€ä¸‹è½½dSYMæ–‡ä»¶.
	
	

> æ³¨æ„:_ä¸€ä¸ª`Archiver`ä¸`dSYM`æ–‡ä»¶ä¸€ä¸€å¯¹åº”,æé”™äº†å®¹æ˜“ç¿»è¯‘ä¸å‡ºæ¥æ¥æºç çš„è°ƒç”¨_

## è¿˜åŸç¬¦å·å‘½ä»¤ 2024å¹´04æœˆ03æ—¥æ›´æ–°

``` sh
atos -o KWPlayer.app.dSYM/Contents/Resources/DWARF/KWPlayer -arch arm64 -l 0x102100000 0x10720df70 0x10720a5ac 0x10720e13c 0x107211aa0 0x107215574 0x107211aa0 0x10720770c 0x10720772c 0x10720f6ec 0x10720f9e8 0x107208df0 0x1072039b8
```
è¾“å‡ºå¦‚ä¸‹:

``` objc
-[LOTLayerContainer display] (in KWPlayer) (LOTLayerContainer.m:385)
-[LOTCompositionContainer displayWithFloatFrame:forceUpdate:] (in KWPlayer) (LOTCompositionContainer.m:107)
-[LOTLayerContainer displayWithFloatFrame:forceUpdate:] (in KWPlayer) (LOTLayerContainer.m:411)
-[LOTRenderGroup updateWithFrame:withModifierBlock:forceLocalUpdate:] (in KWPlayer) (LOTRenderGroup.m:142)
-[LOTTrimPathNode updateWithFrame:withModifierBlock:forceLocalUpdate:] (in KWPlayer) (LOTTrimPathNode.m:62)
-[LOTRenderGroup updateWithFrame:withModifierBlock:forceLocalUpdate:] (in KWPlayer) (LOTRenderGroup.m:142)
-[LOTAnimatorNode updateWithFrame:withModifierBlock:forceLocalUpdate:] (in KWPlayer) (LOTAnimatorNode.m:51)
-[LOTAnimatorNode updateWithFrame:withModifierBlock:forceLocalUpdate:] (in KWPlayer) (LOTAnimatorNode.m:54)
-[LOTPathAnimator performLocalUpdate] (in KWPlayer) (LOTPathAnimator.m:36)
-[LOTPathInterpolator pathForFrame:cacheLengths:] (in KWPlayer) (LOTPathInterpolator.m:0)
-[LOTBezierPath LOT_addCurveToPoint:controlPoint1:controlPoint2:] (in KWPlayer) (LOTBezierPath.m:167)
LOT_PointInCubicCurve (in KWPlayer) (CGGeometry+LOTAdditions.m:366)
```

`-l` å‘½ä»¤åå¯ä»¥æ¥å¤šä¸ªåœ°å€ å¯ä»¥ç”¨ `,`é€—å·å’Œ ç©ºæ ¼éš”å¼€

åŸå§‹æ–‡ä»¶å¦‚ä¸‹

``` sh
Heaviest stack for the target process:
  5  ??? (dyld + 24012) [0x1be4d6dcc]
  5  ??? (KWPlayer + 108397220) [0x1088602a4]
  5  ??? (UIKitCore + 2276456) [0x19dbc0c68]
  5  ??? (UIKitCore + 2278956) [0x19dbc162c]
  5  ??? (GraphicsServices + 13560) [0x1ded1e4f8]
  5  ??? (CoreFoundation + 210040) [0x19b79d478]
  3  ??? (CoreFoundation + 211096) [0x19b79d898]
  3  ??? (CoreFoundation + 215900) [0x19b79eb5c]
  3  ??? (CoreFoundation + 222120) [0x19b7a03a8]
  3  ??? (CoreFoundation + 225580) [0x19b7a112c]
  3  ??? (UIKitCore + 696208) [0x19da3ef90]
  3  ??? (UIKitCore + 696020) [0x19da3eed4]
  3  ??? (UIKitCore + 698340) [0x19da3f7e4]
  3  ??? (UIKitCore + 699596) [0x19da3fccc]
  3  ??? (QuartzCore + 416484) [0x19cddbae4]
  3  ??? (QuartzCore + 417340) [0x19cddbe3c]
  2  ??? (QuartzCore + 445280) [0x19cde2b60]
  2  ??? (QuartzCore + 419644) [0x19cddc73c]
  1  ??? (KWPlayer + 84991856) [0x10720df70]
  1  ??? (KWPlayer + 84977068) [0x10720a5ac]
  1  ??? (KWPlayer + 84992316) [0x10720e13c]
  1  ??? (KWPlayer + 85007008) [0x107211aa0]
  1  ??? (KWPlayer + 85022068) [0x107215574]
  1  ??? (KWPlayer + 85007008) [0x107211aa0]
  1  ??? (KWPlayer + 84965132) [0x10720770c]
  1  ??? (KWPlayer + 84965164) [0x10720772c]
  1  ??? (KWPlayer + 84997868) [0x10720f6ec]
  1  ??? (KWPlayer + 84998632) [0x10720f9e8]
  1  ??? (KWPlayer + 84970992) [0x107208df0]
  1  ??? (KWPlayer + 84949432) [0x1072039b8]

```

å‚è€ƒå¦‚ä¸‹:

[Bugly iOS ç¬¦å·è¡¨é…ç½®](https://bugly.qq.com/docs/user-guide/symbol-configuration-ios/?v=1520478187041#dsym_1)  
[App å¯åŠ¨æ—¶é—´ï¼šè¿‡å»ï¼Œç°åœ¨å’Œæœªæ¥](https://techblog.toutiao.com/2017/07/05/session413/)


å…¨æ–‡å®Œ
  



URL: https://sunyazhou.com/2018/03/ComputerGraphicsRenderingProcess/index.html.md
Published At: 2018-03-05 12:11:41 +0000

# è®¡ç®—æœºå›¾å½¢æ¸²æŸ“çš„æµç¨‹

![](/assets/images/20180305ComputerGraphicsRenderingProcess/IvanSutherland.webp)

# å‰è¨€

ä»Šå¤©åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ç¯‡æœ‰ä»·å€¼çš„æ–‡ç« ,æ¥è¯´æ˜è®¡ç®—æœºä¸­çš„å›¾åƒæ¸²æŸ“æµç¨‹ä»¥åŠåƒç´ ç‚¹è®¡ç®—å’Œåæ ‡ç‚¹ç›¸å…³çš„çŸ¥è¯†.

## è®¡ç®—æœºå›¾å½¢æ¸²æŸ“çš„æµç¨‹

è®¡ç®—æœºçš„ç»˜å›¾è¿‡ç¨‹å¯ä»¥ç®€å•ç”¨æµæ°´çº¿æ¥è¯´æ˜ï¼Œè€Œäº§å“(æ•°æ®)å°±æ˜¯ç»è¿‡æµæ°´çº¿ä½œä¸š(æ¸²æŸ“)åˆ°å±å¹•çš„å›¾åƒã€‚è¿™æ¡æµæ°´çº¿å¯ä»¥ç®€åŒ–ä¸º(æœ¬æ–‡çš„æ¦‚å¿µ):ç»˜å›¾ä½ç½®åº§æ ‡æŒ‡å®š;ç€è‰²æŒ‡å®š;è¾“å‡ºæŒ‡å®š;ä¸‹å›¾ç®€å•è§£é‡Šäº†è¿™ä¸€ä¸ªæµæ°´çº¿è¿‡ç¨‹ã€‚è®¡ç®—æœºç»˜å›¾éœ€è¦ä¸€ä¸ªè¾“å…¥ç»˜å›¾æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å¯ä»¥æ˜¯ç”¨æˆ·æŒ‡å®šçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ“ä½œç³»ç»Ÿå†³å®šçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ··åˆçš„ã€‚è¿™äº›æ•°æ®æ˜¯åˆ†ç»„çš„ã€‚


* åº§æ ‡ç”Ÿæˆï¼šå½“ç»˜å›¾æ•°æ®é€å…¥åº§æ ‡ç”Ÿæˆç³»ç»Ÿåï¼Œæµæ°´çº¿å°±ä¼šå¯¹å…¶è¿›è¡Œåº§æ ‡åˆ†æ´¾ï¼Œå›¾1å³ä¸Šçš„çº¿æ¡†å›¾æŠ½è±¡æè¿°äº†è¿™ä¸ªè¿‡ç¨‹ã€‚
* ç€è‰²æŒ‡å®šï¼šå½“åº§æ ‡ç³»ç»Ÿç”Ÿæˆå‡ºå¸¦åº§æ ‡çš„ç»˜å›¾æ•°æ®åå°±éœ€è¦é€å…¥ç€è‰²å™¨ï¼Œç€è‰²å™¨æŒ‡å®šäº†è¿™äº›çº¿æ¡†çš„å¡«å……é¢œè‰²æˆ–çº¹ç†ã€‚
* æ¸²æŸ“ï¼šç€è‰²å™¨å°†ç»˜å›¾æ•°æ®åŠ ä¸Šç€è‰²æ•°æ®åå°±è¢«é€å…¥æ¸²æŸ“å™¨ï¼Œæ¸²æŸ“å™¨æ ¹æ®ç»˜å›¾æ•°æ®æè¿°ï¼Œå°†åƒç´ å¡«å……åˆ°æè¿°çš„çº¿æ¡†ç»„é‡Œå¹¶é€å…¥å¸§ç¼“å­˜ï¼Œç„¶åç„¶åé€å…¥æ˜¾ç¤ºå™¨ï¼Œæ˜¾ç¤ºå™¨è·å–åˆ°å¸§ç¼“å­˜çš„æ•°æ®åå†æ ¹æ®æ•°æ®çš„æè¿°æ¥ç»˜å›¾åˆ°å±å¹•ä¸Šã€‚

![](/assets/images/20180305ComputerGraphicsRenderingProcess/render1.webp)


## åƒç´ ä¸ç‚¹ï¼ˆpointï¼‰ä¸ç‚¹ï¼ˆdotï¼‰


åƒç´ ä¸ç‚¹ï¼ˆpointï¼‰ï¼Œç‚¹ï¼ˆdotï¼‰è¿™ä¸‰ä¸ªå•ä½å¾ˆå®¹æ˜“ä»¤äººæ··æ·†ï¼ŒåŸå› åœ¨äºå®ƒä»¬åœ¨å¾ˆå¤šåœºåˆä¸Šæ˜¯å¯ä»¥äº’æ¢çš„ã€‚ä½†æ˜¯æœ¬æ–‡éœ€è¦åŒºåˆ†è¿™ä¸¤è€…çš„æ¦‚å¿µã€‚

åƒç´ æŒ‡çš„æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„åŒ…å«äº†RGBä¸‰ä¸ªæ•°æ®ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯çº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰²ã€‚æˆ‘ä»¬è¯´ä¸€å¼ è®¡ç®—æœºç”Ÿæˆçš„ä½å›¾æ—¶ï¼Œæˆ‘ä»¬ä¼šè¯´è¿™å›¾æ˜¯å¤šå°‘åƒç´ xå¤šå°‘åƒç´ ï¼Œä¾‹å¦‚800x600åƒç´ ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåƒç´ æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„å°ºå¯¸å•ä½ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µã€‚

ç‚¹ï¼ˆdotï¼‰æŒ‡çš„æ˜¯æ˜¾ç¤ºå™¨å±å¹•çš„ç‚¹æˆ–æ‰“å°çš„ç‚¹ï¼Œæ˜¯å…·ä½“æŒ‡ä»£çš„äº‹ç‰©ã€‚æˆ‘ä»¬æƒ³è¯´çš„DPIå³dot per inchï¼Œæ¯è‹±å¯¸å¤šå°‘ä¸ªç‚¹ã€‚ä¸€èˆ¬æ¥è¯´1ä¸ªç‚¹å¯¹åº”ä¸€ä¸ªåƒç´ ï¼Œå¸¸è§çš„æ‰“å°å°ºå¯¸æ˜¯72DPIï¼Œå³æ¯è‹±å¯¸72ç‚¹ï¼Œä¹Ÿå°±æ˜¯åŒ…å«72ä¸ªåƒç´ çš„æ•°æ®ã€‚å½“åƒç´ è¢«è®¡ç®—æœºè¾“å‡ºæˆç‚¹æŠ•å°„éƒ½å±å¹•æˆ–çº¸é¢ä¸Šæ—¶ï¼Œå®ƒæ‰å…·å¤‡äº†å°ºå¯¸çš„æ¦‚å¿µï¼Œå³ç‚¹ï¼ˆdotï¼‰ã€‚

ç‚¹ï¼ˆpointï¼‰æŒ‡çš„æ˜¯åº§æ ‡ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒåŒ…å«äº†ä¸¤ä¸ªæ•°æ®ï¼ˆæˆ–ä¸‰ä¸ªï¼‰Xå’ŒY(å’ŒZ)åº§æ ‡ã€‚ç»˜å›¾æ•°æ®é‡Œæ˜¯åŒ…å«äº†è¿™ä¸ªåº§æ ‡æ•°æ®çš„ã€‚å¯¹äºæ²¡æœ‰ä½¿ç”¨HiDPIçš„æ“ä½œç³»ç»Ÿæ¥è¯´ï¼Œä¸€ä¸ªåº§æ ‡ç‚¹å¯¹åº”ä¸€ä¸ªåƒç´ ã€‚


## ç‚¹ï¼ˆpointï¼‰ä¸ä¸€å®šç­‰äºåƒç´ 

ä¸€èˆ¬æ¥è¯´ï¼Œç‚¹ï¼ˆdotï¼‰ä¸åƒç´ æ˜¯å¯ä»¥äº’æ¢æŒ‡ä»£çš„ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨Retinaçš„æ¦‚å¿µè¢«æå‡ºå‰ä¸€ç›´è¿™æ ·ä½¿ç”¨å®ƒä»¬ã€‚ä½†æ˜¯ï¼Œç°åœ¨è¿™ä¸¤ä¸ªæ¦‚å¿µå¿…é¡»è¦åŒºåˆ†å‡ºæ¥ã€‚åƒç´ åªæ˜¯ä¸€ä¸ªæè¿°RGBçš„æ•°æ®ç»“æ„ï¼Œå®ƒæ²¡æœ‰ä»»ä½•å°ºå¯¸å•ä½ï¼Œå®ƒæ›´ä¸æ˜¯ä¸€ä¸ªçŸ©å½¢ã€‚å½“åƒç´ è¢«è¾“å‡ºåˆ°å±å¹•æˆ–çº¸å¼ ä¸Šæ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨ç‚¹æ¥æŒ‡ä»£è¿™ç§å«æœ‰é¢œè‰²ï¼Œæœ‰å°ºå¯¸çš„å…·ä½“äº‹ç‰©ã€‚

æ™®é€šçš„æ˜¾ç¤ºå±å¹•æˆ–æ‰“å°æœºï¼Œæˆ‘ä»¬ä¼šè¯´å±å¹•ä¸Šçš„ä¸€ä¸ªç‚¹ï¼ˆdotï¼‰æ˜¯ç”±ä¸€ä¸ªåƒç´ ï¼ˆRGBæ•°æ®ï¼‰ç»„æˆçš„ï¼Œæ‰“å°åçš„ç‚¹æ˜¯ç”±ä¸€ä¸ªåƒç´ ç»è¿‡è‰²å½©è½¬æ¢ï¼ˆCMYKæ•°æ®ï¼‰ç»„æˆçš„ã€‚

å¯¹äºæ‰“å°æœºæ¥è¯´ï¼Œä¸€èˆ¬çš„DPIæ˜¯72ã€‚ä¹Ÿå°±æ˜¯æŒ‡æˆ‘ä»¬åœ¨æ˜¾ç¤ºå™¨å±å¹•ä¸Šçœ‹åˆ°720x720åƒç´ çš„ä½å›¾ï¼Œåœ¨æ‰“å°å‡ºæ¥åçš„é¢ç§¯æ˜¯10x10è‹±å¯¸ï¼Œä½†æ˜¯å±å¹•ä¸Šçš„ä½å›¾é¢ç§¯å¹¶ä¸ä¼šè·Ÿæ‰“å°å‡ºæ¥çš„é¢ç§¯ä¸€è‡´ã€‚å› ä¸ºå±å¹•ä¸Šçš„ä¸€ä¸ªç‚¹ä¸æ‰“å°çš„ç‚¹çš„å°ºå¯¸ä¸ä¸€æ ·ã€‚

PPIæŒ‡çš„æ˜¯æ¯è‹±å¯¸å¤šå°‘åƒç´ ï¼Œä¸DPIæœ‰ä¸€å®šæ¦‚å¿µä¸Šçš„åŒºåˆ«ã€‚PPIä¸€èˆ¬æŒ‡çš„æ˜¯å±å¹•çš„ç‚¹å¯†åº¦ï¼ŒDPIæŒ‡çš„æ˜¯æ‰“å°ç‚¹çš„å¯†åº¦ã€‚PPIä¸æ˜¯å›ºå®šçš„ï¼Œä¸åŒå±å¹•å°ºå¯¸ç»“åˆä¸åŒçš„åˆ†è¾¨ç‡ä¼šæœ‰ä¸åŒçš„PPIï¼Œä½†æ˜¯DPIåˆ™æ˜¯ç›¸å¯¹å›ºå®šåœ¨72ã€‚

HiDPIæ˜¯è‹¹æœçš„ä¸€é¡¹ç»˜å›¾æŠ€æœ¯ï¼Œç»“åˆè¿™ç§æŠ€æœ¯ï¼Œè®¡ç®—æœºåº§æ ‡ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç‚¹ï¼ˆpointï¼‰ä¸å†å¯¹åº”ä¸€ä¸ªåƒç´ ï¼Œä¸€èˆ¬æ¥è¯´ä¼šæ˜¯ä¸€ä¸ªåº§æ ‡ç‚¹å¯¹åº”å››ä¸ªåƒç´ ï¼Œè€Œä¸€ä¸ªåƒç´ å¯¹åº”å±å¹•çš„ä¸€ä¸ªç‰©ç†ç‚¹ï¼ˆdotï¼‰ã€‚

ç”±äºåƒç´ æ˜¯ä¸€ç»„è‰²å½©æ•°æ®ï¼Œæ‰€ä»¥ç»˜å›¾æ•°æ®åœ¨ç»è¿‡ç€è‰²å™¨åæ‰åŒ…å«äº†å®ƒã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç»˜å›¾æ•°æ®åœ¨é€å…¥ç€è‰²å™¨å‰æ˜¯æè¿°ä¸€ä¸ª100x100çš„çŸ©å½¢ï¼Œç»è¿‡ç€è‰²å™¨æŒ‡å®šè‰²å½©å±æ€§åä¼šè¢«é€å…¥ä¸€ä¸ªHiDPIç³»ç»Ÿï¼Œè¿™ä¸ªç³»ç»Ÿå°†200x200ä¸ªåƒç´ çš„æ•°æ®æ·»åŠ åˆ°ç»˜å›¾æ•°æ®é‡Œã€‚åœ¨ç»è¿‡æ¸²æŸ“å™¨åï¼Œç›¸å½“äºå°†200x200ä¸ªåƒç´ å¡«å……è¿›100x100è¿™ä¸ªçŸ©å½¢çº¿æ¡†ã€‚


![](/assets/images/20180305ComputerGraphicsRenderingProcess/render2.webp)

## å¸§ç¼“å­˜ä¸æ˜¾ç¤ºå™¨å±å¹•

å¸§ç¼“å­˜æ˜¯å‚¨å­˜è®¡ç®—æœºæ¸²æŸ“åçš„å›¾å½¢æ•°æ®çš„ï¼Œè¿™äº›æ•°æ®åŒ…æ‹¬åº§æ ‡ï¼Œåƒç´ ï¼Œåˆ†è¾¨ç‡ç­‰ç­‰ã€‚ã€‚ç®€å•æ¥è¯´å°±æ˜¯æè¿°å›¾è±¡çš„æ•°æ®ï¼Œå½“è¿™äº›æè¿°æ•°æ®é€å…¥æ˜¾ç¤ºå™¨åï¼Œæ˜¾ç¤ºå™¨å°±çŸ¥é“æ€ä¹ˆç»˜å›¾äº†ã€‚

ä¸€èˆ¬æ¥è¯´çš„å±å¹•åˆ†è¾¨ç‡æŒ‡çš„æ˜¯æ¸²æŸ“å™¨ç”Ÿäº§å‡ºæ¥çš„åƒç´ æ•°æ®æ’åˆ—ï¼Œä¾‹å¦‚1280x800åƒç´ ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯è¿™ä¸ªå±å¹•åˆ†è¾¨ç‡ä¸æ˜¾ç¤ºå™¨å±å¹•çš„ç‰©ç†ç‚¹æ’åˆ—æ²¡å…³ç³»çš„ã€‚å±å¹•åˆ†è¾¨ç‡æ˜¯å¯è®¾ç½®çš„ï¼Œæ˜¾ç¤ºå™¨çš„ç‰©ç†ç‚¹æ’åˆ—æ˜¯å›ºå®šçš„ã€‚ä¾‹å¦‚å¸§ç¼“å­˜é‡Œçš„åˆ†è¾¨ç‡æ˜¯1280x800åƒç´ ï¼Œä½†æ˜¯æ˜¾ç¤ºå™¨å±å¹•æ˜¯1920x1200ç‚¹æ’åˆ—çš„ï¼Œé‚£ä¹ˆæ˜¾ç¤ºå™¨ä¼šæ€ä¹ˆå°†å¸§ç¼“å­˜é‡Œçš„æ•°æ®å‘ˆç°åˆ°å±å¹•ä¸Šå‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡è‡ªé€‚åº”æ”¾ç¼©ï¼Œæ˜¯ç»è¿‡æ˜¾ç¤ºå™¨å†…éƒ¨èŠ¯ç‰‡æ¥è½¬æ¢çš„ã€‚

13å¯¸çš„RMBPåœ¨åˆ†è¾¨ç‡è®¾ç½®é‡Œæ˜¯è¿™æ ·æè¿°çš„ï¼Œçœ‹èµ·æ¥åƒ1280x800åƒç´ ï¼Œçœ‹èµ·æ¥åƒ1440x900åƒç´ ã€‚æˆ‘ä»¬éœ€è¦è¿™æ ·ç†è§£ï¼Œ1280x800åƒç´ æ˜¯ç›¸å¯¹äºæ—§æ¬¾ä¸å¸¦Retinaçš„æœºå™¨ï¼Œä¹Ÿå°±æ˜¯ç»˜å›¾æ•°æ®é€å…¥ç€è‰²å™¨å‰çš„åº§æ ‡ç³»ç»Ÿä¸æ¸²æŸ“åçš„åº§æ ‡æ˜¯1:1å¯¹åº”çš„å‚è€ƒå€¼ã€‚å®é™…ä¸Šåœ¨ç»è¿‡æ¸²æŸ“åï¼Œå®ƒçš„å®é™…åƒç´ æ˜¯2560x1600ï¼Œä¹Ÿå°±æ˜¯å¸§ç¼“å­˜é‡Œæ˜¯æ•°æ®æ˜¯2560x1600åƒç´ ã€‚åŒæ ·åœ°çœ‹èµ·æ¥1440x900åƒç´ å®é™…æ¸²æŸ“åçš„åƒç´ æ˜¯2880x1800ã€‚ç”±äº13å¯¸çš„å±å¹•å®é™…ç‚¹æ’åˆ—æ˜¯2560x1600ï¼Œæ‰€ä»¥å¸§ç¼“å­˜2880x1800åƒç´ åœ¨è¾“å‡ºåˆ°å±å¹•åä¼šè¢«è‡ªé€‚åº”ç¼©æ”¾æ‰ã€‚


## DPIä¸Retina

æ“ä½œç³»ç»Ÿæ ‡å‡†çš„æ¡Œé¢æ‰“å°DPIæ˜¯72ï¼Œä½†æ˜¯éšç€HiDPIæŠ€æœ¯å’Œé«˜PPIå±å¹•å‡ºç°åï¼Œè¿™ä¸ªæ ‡å‡†ä¹Ÿè®¸ä¼šæœ‰ä¸€å®šçš„å˜åŒ–ã€‚æˆ‘ä»¬åœ¨Retinaçš„OS Xä¸‹ç”¨Photoshopæ–°å»ºä¸€ä¸ªæ–‡ä»¶æ—¶é»˜è®¤çš„DPIæŒ‡å®šåœ¨144ä¸Šäº†ï¼Œè¿™æ˜¯æ ‡å‡†è½¬å˜çš„ä¸€ä¸ªä¿¡å·ã€‚

åœ¨æ²¡æœ‰ä½¿ç”¨ç±»ä¼¼HiDPIæŠ€æœ¯çš„æ“ä½œç³»ç»Ÿä¸Šï¼Œå±å¹•åˆ†è¾¨ç‡å¯¹åº”çš„æ‰“å°DPIæ˜¯72ã€‚ä½¿ç”¨HiDPIçš„Retinaæœºå™¨çš„æ‰“å°DPIæ˜¯144ï¼Œç”¨ä»¥ä¿è¯åœ¨ç»Ÿä¸€å°ºä¸‹å…·æœ‰æ›´å¤šçš„ç‚¹å¯†åº¦ã€‚è¿™ç‚¹å¯¹äºå°å‰å·¥ä½œéå¸¸é‡è¦ã€‚


å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2018/03/LearningAVFoundationPlayingVideo/index.html.md
Published At: 2018-03-04 16:56:06 +0000

# Learning AV Foundation(äº”)æ’­æ”¾è§†é¢‘

![](/assets/images/20180304LearningAVFoundationPlayingVideo/5kAirplay.webp)

# å‰è¨€

å¾ˆä¹…æ²¡æœ‰å†™Learning AV Foundationç›¸å…³çš„æ–‡ç« äº†,è¨€å½’æ­£ä¼ 
æœ¬ç¯‡ä»‹ç»ä¸€ä¸‹ç®€å•çš„è§†é¢‘æ’­æ”¾

äº†è§£è§†é¢‘æ’­æ”¾ä¹‹å‰æˆ‘ä»¬æ¥çœ‹æˆ`AVPlayer`éœ€è¦çš„ä¸€äº›ç»„ä»¶æ¨¡å‹


![AVPlayerç»„ä»¶æ¨¡å‹](/assets/images/20180304LearningAVFoundationPlayingVideo/AVPlayer.webp)


## AVPlayer

`AVPlayer`æ˜¯ä¸€ä¸ªç”¨æ¥æ’­æ”¾åŸºäºåŸºäºæ—¶é—´çš„è§†å¬åª’ä½“çš„æ§åˆ¶å¯¹è±¡,æ”¯æŒæ’­æ”¾:

* æœ¬åœ° åª’ä½“æ–‡ä»¶
* å¼‚æ­¥ä¸‹è½½ åª’ä½“æ–‡ä»¶
* HTTP Live Streamingåè®®çš„æµåª’ä½“ æ–‡ä»¶

`AVPlayer` æ˜¯ä¸ª é€»è¾‘å±‚ç»„ä»¶

(åº”ç”¨å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ å±‚)
> UIå±‚  
> ä¸šåŠ¡é€»è¾‘å±‚  
> æŒä¹…å±‚+ç½‘ç»œå±‚  

å¦‚æœæ’­æ”¾`MP3`æˆ–`AAC`ç­‰éŸ³é¢‘æ–‡ä»¶, æ˜¯æ²¡æœ‰å•¥UIå¯è§†åŒ–çš„é¡µé¢çš„ã€‚è¦æ˜¯æ’­æ”¾ä¸€ä¸ª`	QuickTime`çš„ç”µå½±æˆ–ä¸€ä¸ª`MPEG-4`è§†é¢‘, å°±ä¼šæå¾—å¾ˆä¸é€‚åº”.  
å¦‚æœè¦æ’­æ”¾è§†é¢‘ç­‰åŠŸèƒ½è®¾è®¡åˆ°UIçš„è¯ï¼Œå¯ä»¥ä½¿ç”¨`AVPlayerLayer`ç±»ã€‚

> æ³¨æ„: _`AVPlayer`åªç®¡ç†ä¸€ä¸ªå•ç‹¬èµ„æºçš„æ’­æ”¾, å¦‚æœæ’­æ”¾å¤šä¸ªå¯ä»¥ä½¿ç”¨`AVPlayer`çš„å­ç±»`AVQueuePlayer`, ç”¨å®ƒæ¥ç®¡ç†ä¸€ä¸ªèµ„æºé˜Ÿåˆ—, å½“éœ€è¦åœ¨ä¸€ä¸ªåºåˆ—ä¸­æ’­æ”¾å¤šä¸ªæ¡ç›®æˆ–è€… ä¸ºéŸ³é¢‘ã€è§†é¢‘èµ„æºè®¾ç½®æ’­æ”¾å¾ªç¯æ—¶åˆ»ä½¿ç”¨è¿™ä¸ªç±»_.

## AVPlayerLayer


`AVPlayerLayer`æ„å»ºäº `Core Animation`ä¹‹ä¸Š, æ˜¯`AV Foundation`ä¸­èƒ½æ‰¾åˆ°çš„ä½æ•°ä¸å¤šçš„UIç»„ä»¶. `Core Animation` æ˜¯`Mac`å’Œ`iOS`å¹³å°ä¸Šè´Ÿè´£å›¾å½¢æ¸²æŸ“ä¸åŠ¨ç”»çš„åŸºç¡€æ¡†æ¶,ä¸»è¦ç”¨äºè¿™äº›å¹³å°çš„ç¾åŒ–å’ŒåŠ¨ç”»æµç•…åº¦çš„æå‡. `Core Animation`æœ¬èº«å…·æœ‰åŸºäºæ—¶é—´çš„å±æ€§,å¹¶ä¸”ç”±äºå®ƒåŸºäº`OpenGL`,æ‰€ä»¥å…·æœ‰å¾ˆå¥½çš„æ€§èƒ½.

`AVPlayerLayer`æ‰©å±•äº†`Core Animation` çš„`CALayer`ç±», å¹¶é€šè¿‡æ¡†æ¶æ˜¾ç¤ºè§†é¢‘å†…å®¹åˆ°å±å¹•ä¸Š.
æˆ‘ä»¬çŸ¥é“Layeræ˜¯ä¸å“åº”äº‹ä»¶çš„.

åˆ›å»º`AVPlayerLayer`éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ª`AVPlayer`çš„å¯¹è±¡ï¼Œ`AVPlayerLayer`æœ‰ä¸€ä¸ª`videoGravity`å±æ€§å¯ä»¥è®¾ç½®ä¸‰ç§ç±»ä¼¼å¡«å……æ¨¡å¼çš„ä¸œè¥¿,ç”¨æ¥æ‹‰æ‰¯å’Œç¼©æ”¾çš„è§†é¢‘. ä¸‹é¢åˆ—ä¸¾äº†16:9çš„è§†é¢‘ç½®äº4:3çŸ©å½¢èŒƒå›´æ¥è¯´æ˜ä¸åŒçš„`gravity`.

å¦‚ä¸‹å›¾:

__AVLayerVideoGravityResizeAspect__ä¿æŒç¼©æ”¾æ¯”ä¾‹
![](/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResizeAspect.webp)

__AVLayerVideoGravityResizeAspectFill__å¡«å……
![](/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResizeAspectFill.webp)


__AVLayerVideoGravityResize__æ‹‰ä¼¸

![](/assets/images/20180304LearningAVFoundationPlayingVideo/AVLayerVideoGravityResize.webp)



## AVPlayerItem

æˆ‘ä»¬éœ€è¦ä½¿ç”¨`AVPlayer`æ’­æ”¾`AVAsset`,å‰é¢æˆ‘çŸ¥é“`AVAsset`å…ƒæ•°æ®é‡Œé¢æœ‰`åˆ›å»ºæ—¶é—´`ã€`å…ƒæ•°æ®`å’Œ`æ—¶é•¿`ç­‰ä¿¡æ¯.ä½†æ˜¯å¹¶æ²¡æœ‰åª’ä½“ä¸­ç‰¹å®šä½ç½®çš„æ–¹æ³•.

__è¿™æ˜¯å› ä¸º`AVAsset`æ¨¡å‹åªåŒ…å«åª’ä½“èµ„æºçš„é™æ€ä¿¡æ¯.è¿™äº›ä¸å˜çš„å±æ€§ç”¨æ¥æè¿°å¯¹è±¡çš„é™æ€ä¿¡æ¯.è¿™å°±æ„å‘³ç€ä»…ä½¿ç”¨`AVAsset`å¯¹è±¡æ˜¯ä¸èƒ½å®ç°æ’­æ”¾åŠŸèƒ½çš„.å¦‚æœæ’­æ”¾æˆ‘ä»¬éœ€è¦ä½¿ç”¨`AVPlayerItem`__

__`AVPlayerItem`å¯ä»¥ç†è§£æˆæ˜¯ä¸€ä¸ªåŠ¨æ€çš„`AVAsset`æ¨¡å‹,__  
`AVPlayerItem`æœ‰`seekToTime:`æ–¹æ³•å’Œ`presentationSize:`,`AVPlayerItem`ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåª’ä½“æ›²ç›®ç»„æˆ.

`AVPlayerItem`é‡Œé¢æœ‰``AVPlayerItemTrack`è½¨é“å±æ€§.


## æ’­æ”¾ç¤ºä¾‹

``` objc
- (void)viewDidLoad {
	self.localURL = [[NSBundle mainBundle] URLForResource:@"hubblecast" withExtension:@"m4v"];

    AVAsset *asset = [AVAsset assetWithURL:self.localURL];
    
    AVPlayerItem *item = [AVPlayerItem playerItemWithAsset:asset];
    
    AVPlayer *player = [AVPlayer playerWithPlayerItem:item];
    
    AVPlayerLayer *layer = [AVPlayerLayer playerLayerWithPlayer:player];
    
    [self.view.layer addSublayer:layer];
}
```

è¿™ä¸ª`AVPlayerItem`å¹¶æ²¡æœ‰ä»»ä½•ä»£ç†å‘ŠçŸ¥æˆ‘ä»¬æ˜¯å¦å·²ç»å¼€å§‹æ’­æ”¾,æ‰€ä»¥ä¸€èˆ¬çš„ææ³•éƒ½æ˜¯ä½¿ç”¨`KVO`å»ç›‘å¬å®ƒçš„ä¸€ä¸ªå±æ€§,`AVPlayerItemStatus`

``` objc
typedef NS_ENUM(NSInteger, AVPlayerItemStatus) {
	AVPlayerItemStatusUnknown,
	AVPlayerItemStatusReadyToPlay,
	AVPlayerItemStatusFailed
};
```

å½“å®ƒçš„`status`å˜æˆ`AVPlayerItemStatusReadyToPlay`å°±è¯´æ˜å·²è½½å…¥å®Œæˆå‡†å¤‡æ’­æ”¾.

## CMTime

ä½¿ç”¨`CMTime`æ¥å¤„ç†å„ç§éŸ³è§†é¢‘ç›¸å…³çš„æ—¶é—´æ“ä½œ,ä»–æ˜¯`CoreMedia`frameworkä¸­çš„ç»“æ„ä½“.ä¸“é—¨ç”¨äºå¤„ç†ç²¾ç¡®çš„æ—¶é—´,æˆ‘ä»¬ä»¥å‰ç”¨çš„`NSTimeInterval`æ˜¯å­˜åœ¨è®¡ç®—ä¸ç²¾ç¡®çš„é—®é¢˜(è‹¹æœå®˜æ–¹è¯´çš„).


``` objc
typedef struct
{
	CMTimeValue	value;		//åˆ†å­
	CMTimeScale	timescale; //åˆ†æ¯
	CMTimeFlags	flags;		//æ ‡è®°æ˜¯å¦å¤±æ•ˆ eg. kCMTimeFlags_Valid, kCMTimeFlags_PositiveInfinity
	CMTimeEpoch	epoch;		
} CMTime;
```

è¿™ä¸ªç»“æ„ä½“æœ€å…³é”®çš„å³ä½¿`value`(64ä½æ•´å½¢)å’Œ`timescale`(32ä½æ•´å½¢).

å®ƒè¡¨è¾¾æ—¶é—´çš„æ–¹å¼ä»¥åˆ†æ•°è¡¨ç¤ºæ¯”å¦‚:

`0.5`ç§’

``` objc
CMTime halfSecond = CMTimeMake(1, 2); //0.5ç§’
CMTime fiveSecond = CMTimeMake(5, 1); //5ç§’
CMTime oneSample = CMTimeMake(1, 44100); //ä¸€ä¸ªæŠ½æ ·çš„æ ·æœ¬
CMTime zeroTime = kCMTimeZero;
```


## åˆ›å»ºè‡ªå·±çš„æ’­æ”¾å™¨

é¦–å…ˆéœ€è¦å°è£…ä¸€ä¸ª`player`,


``` objc
#import <UIKit/UIKit.h>
#import "TransportProtocol.h"
@class AVPlayer;
@interface PlayerView : UIView
@property (nonatomic, readonly) id <TransportProtocol>  transport;
- (id)initWithPlayer:(AVPlayer *)player;
@end

```

.mæ–‡ä»¶å®ç°

``` objc
#import "PlayerView.h"
#import <AVFoundation/AVFoundation.h>
#import "THOverlayView.h"
@interface PlayerView ()

@property (nonatomic, strong) THOverlayView *overlayView;

@end

@implementation PlayerView
+ (Class)layerClass{
    return [AVPlayerLayer class];
}

- (id)initWithPlayer:(AVPlayer *)player{
    self = [super initWithFrame:CGRectZero];
    if (self) {
        self.backgroundColor = [UIColor blackColor];
        self.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;
        [(AVPlayerLayer *)[self layer] setPlayer:player];
        [[NSBundle mainBundle] loadNibNamed:@"THOverlayView" owner:self options:nil];
        [self addSubview:self.overlayView];
    }
    return self;
}

- (void)layoutSubviews{
    [super layoutSubviews];
    self.overlayView.frame = self.bounds;
}

- (id <TransportProtocol>)transport{
    return self.overlayView;
}

@end
```

transport æ˜¯æ’­æ”¾å™¨çš„è§†å›¾ç‚¹å‡»è§†å›¾ä»£ç†ç­‰é›†æˆäº† åœ¨ä¸€èµ·

``` objc
@protocol TransportDelegate <NSObject>
- (void)play;
- (void)pause;
- (void)stop;

- (void)scrubbingDidStart;
- (void)scrubbedToTime:(NSTimeInterval)time;
- (void)scrubbingDidEnd;

- (void)jumpedToTime:(NSTimeInterval)time;

@optional
- (void)subtitleSelected:(NSString *)subtitle;

@end

@protocol TransportProtocol <NSObject>

@property (weak, nonatomic) id <TransportDelegate> delegate;

- (void)setTitle:(NSString *)title;
- (void)setCurrentTime:(NSTimeInterval)time duration:(NSTimeInterval)duration;
- (void)setScrubbingTime:(NSTimeInterval)time;
- (void)playbackComplete;
- (void)setSubtitles:(NSArray *)subtitles;
@end
```

THOverlayViewæ–‡ä»¶æ˜¯é¡¶å±‚è§†å›¾ç‚¹å‡»æ’­æ”¾ç­‰ç­‰æ§ä»¶.

``` objc
#import <Foundation/Foundation.h>
#import <UIKit/UIKit.h>
@interface PlayerController : NSObject
@property (nonatomic, strong, readonly) UIView *view;
- (id)initWithURL:(NSURL *)assetURL;
@end
```

æ’­æ”¾å™¨çš„å®ç°æ–‡ä»¶å¦‚ä¸‹

``` objc
#import "PlayerController.h"
#import <AVFoundation/AVFoundation.h>
#import "TransportProtocol.h"
#import "PlayerView.h"
#import "AVAsset+Additions.h"
#import "UIAlertView+Additions.h"
#import "THThumbnail.h"

// AVPlayerItem's status property
#define STATUS_KEYPATH @"status"

// Refresh interval for timed observations of AVPlayer
#define REFRESH_INTERVAL 0.5f

// Define this constant for the key-value observation context.
static const NSString *PlayerItemStatusContext;

@interface PlayerController () <TransportDelegate>

@property (nonatomic, strong) AVAsset               *asset;
@property (nonatomic, strong) AVPlayerItem          *playerItem;
@property (nonatomic, strong) AVPlayer              *player;
@property (nonatomic, strong) PlayerView            *playerView;
@property (nonatomic, weak) id <TransportProtocol>  transport;
@property (nonatomic, strong) id                    timeObserver;
@property (nonatomic, strong) id                    itemEndObserver;
@property (nonatomic, assign) float                 lastPlaybackRate;
@property (strong, nonatomic) AVAssetImageGenerator *imageGenerator;
@end

@implementation PlayerController

#pragma mark - Setup

- (id)initWithURL:(NSURL *)assetURL {
    self = [super init];
    if (self) {
        _asset = [AVAsset assetWithURL:assetURL];                           // 1
        [self prepareToPlay];
    }
    return self;
}

- (void)prepareToPlay {
    NSArray *keys = @[
                      @"tracks",
                      @"duration",
                      @"commonMetadata",
                      @"availableMediaCharacteristicsWithMediaSelectionOptions"
                      ];
    self.playerItem = [AVPlayerItem playerItemWithAsset:self.asset          // 2
                           automaticallyLoadedAssetKeys:keys];
    
    [self.playerItem addObserver:self                                       // 3
                      forKeyPath:STATUS_KEYPATH
                         options:0
                         context:&PlayerItemStatusContext];
    
    self.player = [AVPlayer playerWithPlayerItem:self.playerItem];          // 4
    
    self.playerView = [[PlayerView alloc] initWithPlayer:self.player];    // 5
    self.transport = self.playerView.transport;
    self.transport.delegate = self;
}

- (void)observeValueForKeyPath:(NSString *)keyPath
                      ofObject:(id)object
                        change:(NSDictionary *)change
                       context:(void *)context {
    
    if (context == &PlayerItemStatusContext) {
        
        dispatch_async(dispatch_get_main_queue(), ^{                        // 1
            
            [self.playerItem removeObserver:self forKeyPath:STATUS_KEYPATH];
            
            if (self.playerItem.status == AVPlayerItemStatusReadyToPlay) {
                
                // Set up time observers.                                   // 2
                [self addPlayerItemTimeObserver];
                [self addItemEndObserverForPlayerItem];
                
                CMTime duration = self.playerItem.duration;
                
                // Synchronize the time display                             // 3
                [self.transport setCurrentTime:CMTimeGetSeconds(kCMTimeZero)
                                      duration:CMTimeGetSeconds(duration)];
                
                // Set the video title.
                [self.transport setTitle:self.asset.title];                 // 4
                
                [self.player play];                                         // 5
                
                [self loadMediaOptions];
                [self generateThumbnails];
                
            } else {
                [UIAlertView showAlertWithTitle:@"Error"
                                        message:@"Failed to load video"];
            }
        });
    }
}

- (void)loadMediaOptions {
    NSString *mc = AVMediaCharacteristicLegible;                            // 1
    AVMediaSelectionGroup *group =
    [self.asset mediaSelectionGroupForMediaCharacteristic:mc];          // 2
    if (group) {
        NSMutableArray *subtitles = [NSMutableArray array];                 // 3
        for (AVMediaSelectionOption *option in group.options) {
            [subtitles addObject:option.displayName];
        }
        [self.transport setSubtitles:subtitles];                            // 4
    } else {
        [self.transport setSubtitles:nil];
    }
}

- (void)subtitleSelected:(NSString *)subtitle {
    NSString *mc = AVMediaCharacteristicLegible;
    AVMediaSelectionGroup *group =
    [self.asset mediaSelectionGroupForMediaCharacteristic:mc];          // 1
    BOOL selected = NO;
    for (AVMediaSelectionOption *option in group.options) {
        if ([option.displayName isEqualToString:subtitle]) {
            [self.playerItem selectMediaOption:option                       // 2
                         inMediaSelectionGroup:group];
            selected = YES;
        }
    }
    if (!selected) {
        [self.playerItem selectMediaOption:nil                              // 3
                     inMediaSelectionGroup:group];
    }
}


#pragma mark - Time Observers

- (void)addPlayerItemTimeObserver {
    
    // Create 0.5 second refresh interval - REFRESH_INTERVAL == 0.5
    CMTime interval =
    CMTimeMakeWithSeconds(REFRESH_INTERVAL, NSEC_PER_SEC);              // 1
    
    // Main dispatch queue
    dispatch_queue_t queue = dispatch_get_main_queue();                     // 2
    
    // Create callback block for time observer
    __weak PlayerController *weakSelf = self;                             // 3
    void (^callback)(CMTime time) = ^(CMTime time) {
        NSTimeInterval currentTime = CMTimeGetSeconds(time);
        NSTimeInterval duration = CMTimeGetSeconds(weakSelf.playerItem.duration);
        [weakSelf.transport setCurrentTime:currentTime duration:duration];  // 4
    };
    
    // Add observer and store pointer for future use
    self.timeObserver =                                                     // 5
    [self.player addPeriodicTimeObserverForInterval:interval
                                              queue:queue
                                         usingBlock:callback];
}

- (void)addItemEndObserverForPlayerItem {
    
    NSString *name = AVPlayerItemDidPlayToEndTimeNotification;
    
    NSOperationQueue *queue = [NSOperationQueue mainQueue];
    
    __weak PlayerController *weakSelf = self;                             // 1
    void (^callback)(NSNotification *note) = ^(NSNotification *notification) {
        [weakSelf.player seekToTime:kCMTimeZero                             // 2
                  completionHandler:^(BOOL finished) {
                      [weakSelf.transport playbackComplete];                          // 3
                  }];
    };
    
    self.itemEndObserver =                                                  // 4
    [[NSNotificationCenter defaultCenter] addObserverForName:name
                                                      object:self.playerItem
                                                       queue:queue
                                                  usingBlock:callback];
}

#pragma mark - THTransportDelegate Methods

- (void)play {
    [self.player play];
}

- (void)pause {
    self.lastPlaybackRate = self.player.rate;
    [self.player pause];
}

- (void)stop {
    [self.player setRate:0.0f];
    [self.transport playbackComplete];
}

- (void)jumpedToTime:(NSTimeInterval)time {
    [self.player seekToTime:CMTimeMakeWithSeconds(time, NSEC_PER_SEC)];
}

- (void)scrubbingDidStart {                                                 // 1
    self.lastPlaybackRate = self.player.rate;
    [self.player pause];
    [self.player removeTimeObserver:self.timeObserver];
    self.timeObserver = nil;
}

- (void)scrubbedToTime:(NSTimeInterval)time {                               // 2
    [self.playerItem cancelPendingSeeks];
    [self.player seekToTime:CMTimeMakeWithSeconds(time, NSEC_PER_SEC) toleranceBefore:kCMTimeZero toleranceAfter:kCMTimeZero];
}

- (void)scrubbingDidEnd {                                                   // 3
    [self addPlayerItemTimeObserver];
    if (self.lastPlaybackRate > 0.0f) {
        [self.player play];
    }
}


#pragma mark - Thumbnail Generation

- (void)generateThumbnails {
    
    self.imageGenerator =                                                   // 1
    [AVAssetImageGenerator assetImageGeneratorWithAsset:self.asset];
    
    // Generate the @2x equivalent
    self.imageGenerator.maximumSize = CGSizeMake(200.0f, 0.0f);             // 2
    
    CMTime duration = self.asset.duration;
    
    NSMutableArray *times = [NSMutableArray array];                         // 3
    CMTimeValue increment = duration.value / 20;
    CMTimeValue currentValue = 2.0 * duration.timescale;
    while (currentValue <= duration.value) {
        CMTime time = CMTimeMake(currentValue, duration.timescale);
        [times addObject:[NSValue valueWithCMTime:time]];
        currentValue += increment;
    }
    
    __block NSUInteger imageCount = times.count;                            // 4
    __block NSMutableArray *images = [NSMutableArray array];
    
    AVAssetImageGeneratorCompletionHandler handler;                         // 5
    
    handler = ^(CMTime requestedTime,
                CGImageRef imageRef,
                CMTime actualTime,
                AVAssetImageGeneratorResult result,
                NSError *error) {
        
        if (result == AVAssetImageGeneratorSucceeded) {                     // 6
            UIImage *image = [UIImage imageWithCGImage:imageRef];
            id thumbnail =
            [THThumbnail thumbnailWithImage:image time:actualTime];
            [images addObject:thumbnail];
        } else {
            NSLog(@"Error: %@", [error localizedDescription]);
        }
        
        // If the decremented image count is at 0, we're all done.
        if (--imageCount == 0) {                                            // 7
            dispatch_async(dispatch_get_main_queue(), ^{
                NSString *name = THThumbnailsGeneratedNotification;
                NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
                [nc postNotificationName:name object:images];
            });
        }
    };
    
    [self.imageGenerator generateCGImagesAsynchronouslyForTimes:times       // 8
                                              completionHandler:handler];
}


#pragma mark - Housekeeping

- (UIView *)view {
    return self.playerView;
}

- (void)dealloc {
    if (self.itemEndObserver) {                                             // 5
        NSNotificationCenter *nc = [NSNotificationCenter defaultCenter];
        [nc removeObserver:self.itemEndObserver
                      name:AVPlayerItemDidPlayToEndTimeNotification
                    object:self.player.currentItem];
        self.itemEndObserver = nil;
    }
}

@end

```

è¿™é‡Œè¯´ä¸€ä¸‹å¦‚ä½•ç›‘å¬æ—¶é—´ä»è€Œå¾—çŸ¥æ’­æ”¾æ—¶é—´å›è°ƒ

### ç›‘å¬æ—¶é—´

å½“æ’­æ”¾å™¨æ’­æ”¾çš„æ—¶å€™æˆ‘ä»¬æ— æ³•å¾—çŸ¥æ’­æ”¾åˆ°æ’­æ”¾å™¨çš„å“ªä¸ªä½ç½®,ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜`AVPlayerItem`æ·»åŠ äº†ä¸¤ä¸ªç›‘å¬æ’­æ”¾çš„æ–¹æ³•ä»¥åŠå…·ä½“çš„ç”¨æ³•`API`.

#### å®šæœŸç›‘å¬

``` objc
- (id)addPeriodicTimeObserverForInterval:(CMTime)interval
                                   queue:(nullable dispatch_queue_t)queue
                              usingBlock:(void (^)(CMTime time))block;
```

è¿™é‡Œä¸»è¦æ˜¯ä¸ºäº†éšç€æ—¶é—´çš„å˜åŒ–ç§»åŠ¨æ’­æ”¾å™¨seekä½ç½®æ›´æ–°æ—¶é—´æ˜¾ç¤º,é€šè¿‡`AVPlayer`çš„`addPeriodicTimeObserverForInterval:queue:usingBlock:` æ¥ç›‘å¬æ’­æ”¾æ—¶é—´çš„å˜åŒ–

* `interv`_ç›‘å¬å‘¨æœŸçš„é—´éš”`CMTime`_
* `queue` _é€šçŸ¥å‘é€çš„é¡ºåºè°ƒåº¦é˜Ÿåˆ—,ä¸€èˆ¬æˆ‘ä»¬éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹å›æ‰.(æ³¨æ„è¿™é‡Œä¸èƒ½æ”¾åœ¨å¹¶è¡Œé˜Ÿåˆ—ä¸­)_
* `block` _æŒ‡å®šå‘¨æœŸçš„æ—¶é—´å›è°ƒ._


ä¸‹é¢æ˜¯ç¤ºä¾‹ä»£ç 


``` objc
- (void)addPlayerItemTimeObserver {
    
    // Create 0.5 second refresh interval - REFRESH_INTERVAL == 0.5
    CMTime interval =
    CMTimeMakeWithSeconds(REFRESH_INTERVAL, NSEC_PER_SEC);              // 1
    
    // Main dispatch queue
    dispatch_queue_t queue = dispatch_get_main_queue();                     // 2
    
    // Create callback block for time observer
    __weak PlayerController *weakSelf = self;                             // 3
    void (^callback)(CMTime time) = ^(CMTime time) {
        NSTimeInterval currentTime = CMTimeGetSeconds(time);
        NSTimeInterval duration = CMTimeGetSeconds(weakSelf.playerItem.duration);
        [weakSelf.transport setCurrentTime:currentTime duration:duration];  // 4
    };
    
    // Add observer and store pointer for future use
    self.timeObserver =                                                     // 5
    [self.player addPeriodicTimeObserverForInterval:interval
                                              queue:queue
                                         usingBlock:callback];
}
```


#### è¾¹ç•Œç›‘å¬

ä»€ä¹ˆå«è¾¹ç•Œç›‘å¬å‘¢?å°±æ˜¯æ’­æ”¾å™¨æ’­æ”¾åˆ°æŸä¸ªæ—¶é—´çš„è§¦å‘çš„ æ—¶é—´ä½ç½®.

``` objc
- (id)addBoundaryTimeObserverForTimes:(NSArray<NSValue *> *)times
                                queue:(nullable dispatch_queue_t)queue
                           usingBlock:(void (^)(void))block;
```

* `times` _CMTimeå€¼ç»„æˆä¸€ä¸ª`NSArray`,è¿™é‡Œé¢å®šä¹‰çš„ä¸€ä¸ªæ—¶é—´ç‚¹çš„æ•°ç»„.eg: 25% 50% 75%ç­‰æ—¶é—´ç‚¹._
* `queue` _é€šçŸ¥å‘é€çš„é¡ºåºè°ƒåº¦é˜Ÿåˆ—,ä¸€èˆ¬æˆ‘ä»¬éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹å›æ‰.(æ³¨æ„è¿™é‡Œä¸èƒ½æ”¾åœ¨å¹¶è¡Œé˜Ÿåˆ—ä¸­)_
* `block` _æŒ‡å®šå‘¨æœŸçš„æ—¶é—´å›è°ƒ._


### æ˜¾ç¤ºå­—å¹•

`AVPlayerLayer`é‡Œæœ‰ä¸¤ä¸ªç±»æ¥å¤„ç†å­—å¹•

* AVMediaSelectionGroup
* AVMediaSelectionOption

`AVMediaSelectionOption` ç”¨äºè¡¨ç¤º`AVAsset`å¤‡ç”¨åª’ä½“æ˜¾ç¤º.åœ¨å‰å‡ ç¯‡ä¸­æˆ‘è®²è¿‡ä¸€ä¸ªåª’ä½“å…ƒæ•°æ®ä¸­æœ‰`éŸ³é¢‘è½¨`ã€`è§†é¢‘è½¨`ã€`å­—å¹•è½¨`,`å¤‡ç”¨ç›¸æœºè§’åº¦`ç­‰.

æˆ‘ä»¬å¦‚æœæƒ³æ‰¾å‡ºå­—å¹•çš„è¯éœ€è¦ç”¨åˆ°`AVAsset`çš„`availableMediaCharacteristicsWithMediaSelectionOptions`å±æ€§.

``` objc
@property (nonatomic, readonly) NSArray<AVMediaCharacteristic> *availableMediaCharacteristicsWithMediaSelectionOptions NS_AVAILABLE(10_8, 5_0);
```

è¿™ä¸ªå±æ€§ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„çš„`å­—ç¬¦ä¸²`,è¿™äº›`å­—ç¬¦ä¸²`ç”¨äºè¡¨ç¤ºä¿å­˜åœ¨èµ„æºä¸­å¯ç”¨é€‰é¡¹çš„åª’ä½“ç‰¹å¾,å…¶å®æ•°ç»„ä¸­åŒ…å«çš„å­—ç¬¦ä¸²çš„å€¼ä¸ºå¦‚ä¸‹ï¼š

* AVMediaCharacteristicVisual è§†é¢‘
* AVMediaCharacteristicAudible éŸ³é¢‘
* AVMediaCharacteristicLegible å­—å¹•æˆ–éšè—å¼å­—å¹•


``` objc

- (nullable AVMediaSelectionGroup *)mediaSelectionGroupForMediaCharacteristic:(AVMediaCharacteristic)mediaCharacteristic NS_AVAILABLE(10_8, 5_0);

```

è¯·æ±‚å¯ç”¨åª’ä½“ç‰¹æ€§æ•°æ®å,è°ƒç”¨`AVAsset`çš„`mediaSelectionGroupForMediaCharacteristic:`æ–¹æ³•.ä¸ºå…¶ä¼ é€’è¦æ£€ç´¢çš„é€‰é¡¹çš„ç‰¹å®šåª’ä½“ç‰¹å¾.è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ª`AVMediaSelectionGroup`,å®ƒä½œä¸ºä¸€ä¸ªæˆ–å¤šä¸ªäº’æ–¥çš„`AVMediaSelectionGroup`å®ä¾‹çš„å®¹å™¨.

``` objc
- (void)loadMediaOptions {
    NSString *mc = AVMediaCharacteristicLegible;                            // 1
    AVMediaSelectionGroup *group =
        [self.asset mediaSelectionGroupForMediaCharacteristic:mc];          // 2
    if (group) {
        NSMutableArray *subtitles = [NSMutableArray array];                 // 3
        for (AVMediaSelectionOption *option in group.options) {
            [subtitles addObject:option.displayName];
        }
        [self.transport setSubtitles:subtitles];                            // 4
    } else {
        [self.transport setSubtitles:nil];
    }
}
```




## AirPlay

AirPlayç›¸ä¿¡å¤§éƒ¨åˆ†iOSå¼€å‘è€…éƒ½è€³ç†Ÿèƒ½è¯¦,è¿™ä¸ªä¸œè¥¿æ˜¯ç”¨äºæ— çº¿æ–¹å¼å°†æµåª’ä½“éŸ³é¢‘/è§†é¢‘å†…å®¹åœ¨`Apple TV`ä¸Šæ’­æ”¾.æˆ–è€…å°†çº¯éŸ³é¢‘å†…å®¹åœ¨å¤šç§ç¬¬ä¸‰æ–¹éŸ³é¢‘ç³»ç»Ÿä¸­æ’­æ”¾(å¦‚æ±½è½¦ä¸­å†…ç½®çš„CarPlay).å¦‚æœå¤§å®¶æœ‰`Apple TV`æˆ–å…¶å®ƒéŸ³é¢‘ç³»ç»Ÿä¸­çš„ä¸€ä¸ª,å°±ä¼šè§‰å¾—è¿™ä¸ªåŠŸèƒ½å®åœ¨å¤ªå®ç”¨äº†.å…¶å®æŠŠè¿™ä¸ªåŠŸèƒ½æ•´åˆåˆ°æˆ‘ä»¬çš„APPä¸­ååˆ†å®¹æ˜“.

`AVPlayer`æœ‰ä¸€ä¸ªå±æ€§æ˜¯`allowsExternalPlayback`,å…è®¸å¯ç”¨æˆ–è€…ç¦ç”¨`AirPlay`æ’­æ”¾åŠŸèƒ½.è¯¥å±æ€§é»˜è®¤æ˜¯`YES`,å³åœ¨ä¸åšä»»ä½•é¢å¤–ç¼–ç çš„æƒ…å†µä¸‹,æ’­æ”¾å™¨åº”ç”¨ç¨‹åºä¹Ÿä¼šè‡ªåŠ¨æ”¯æŒ`AirPlay`åŠŸèƒ½.

``` objc
@property (nonatomic) BOOL allowsExternalPlayback NS_AVAILABLE(10_11, 6_0);
```

ä¸è¿‡ä»iOS11ä¹‹åæ‰æœ‰ä¸“é—¨é’ˆå¯¹AirPlayçš„frameworkåŠŸèƒ½API,åœ¨ä»¥å‰æˆ‘ä»¬ä½¿ç”¨`Media Player`ä¸­çš„`MPVolumeView`æ¥å®ç°.

ç¤ºä¾‹ä»£ç :

```
	MPVolumeView *volumeView = [[MPVolumeView alloc] init];
    volumeView.showsVolumeSlider = NO;
    [volumeView sizeToFit];
    [transportView addSubview:volumeView];
```

å½“AirPlayå¯ç”¨æ—¶,è€Œä¸”WIFI ç½‘ç»œå¯ç”¨æ—¶æ‰ä¼šæ˜¾ç¤ºçº¿è·¯é€‰æ‹©æŒ‰é’®.è¿™ä¸¤ä¸ªæ¡ä»¶åªæœ‰ä¸€ä¸ªä¸æ»¡è¶³, MPVolumeView å°±ä¼šè‡ªåŠ¨éšè—æŒ‰é’®.



## æ€»ç»“

æœ¬ç« è®²è¿°äº† å¦‚ä½•ä½¿ç”¨AVPlayerä»¥åŠAVPlayerItem çš„ä¸€äº›å±æ€§ ç›‘å¬æ’­æ”¾è¿›åº¦å›è°ƒ,å– å­—å¹•ç­‰ç­‰.

[è¯¦ç»†demoè¯·å‚è€ƒ](https://github.com/sunyazhou13/Learning-AV-Foundation-Demos)


URL: https://sunyazhou.com/2018/02/WordEmbeding/index.html.md
Published At: 2018-02-04 12:24:30 +0000

# NLPåˆ†è¯WordEmbeding

![](/assets/images/20180204WordEmbeding/wordembeding.webp)

# å‰è¨€

å­¦ä¹ è¿‡ç¨‹ä¸­è®°å½•ä¸€ä¸‹pythonä»£ç 



``` python
#!/usr/bin/env python
# coding:utf8

import sys
reload(sys)
sys.setdefaultencoding('utf8')


# åŠ è½½åŒ…
from gensim.models import Word2Vec
from gensim.models.word2vec import LineSentence

# è®­ç»ƒæ¨¡å‹
# sentences = LineSentence('wiki.zh.word.text')
# sizeï¼šè¯å‘é‡çš„ç»´åº¦
# windowï¼šä¸Šä¸‹æ–‡ç¯å¢ƒçš„çª—å£å¤§å°
# min_countï¼šå¿½ç•¥å‡ºç°æ¬¡æ•°ä½äºmin_countçš„è¯
# model = Word2Vec(sentences, size=128, window=5, min_count=5, workers=4)

# ä¿å­˜æ¨¡å‹
# model.save('word_embedding_128')

# å¦‚æœå·²ç»ä¿å­˜è¿‡æ¨¡å‹ï¼Œåˆ™ç›´æ¥åŠ è½½å³å¯
# å‰é¢è®­ç»ƒå¹¶ä¿å­˜çš„ä»£ç éƒ½å¯ä»¥çœç•¥
model = Word2Vec.load("word_embedding_128")

# ä½¿ç”¨æ¨¡å‹
# è¿”å›å’Œä¸€ä¸ªè¯è¯­æœ€ç›¸å…³çš„å¤šä¸ªè¯è¯­ä»¥åŠå¯¹åº”çš„ç›¸å…³åº¦
items = model.most_similar(u'ä¸­å›½')
for item in items:
	# è¯çš„å†…å®¹ï¼Œè¯çš„ç›¸å…³åº¦
	print item[0], item[1]

# è¿”å›ä¸¤ä¸ªè¯è¯­ä¹‹é—´çš„ç›¸å…³åº¦
model.similarity(u'ç”·äºº',  u'å¥³äºº')

```
   
å‚è€ƒåˆ†è¯å¦‚ä¸‹:  

[å“ˆå·¥å¤§åˆ†è¯](https://www.ltp-cloud.com/demo/)  
[jiebaåˆ†è¯](https://github.com/fxsjy/jieba)  
[stanfordåˆ†è¯](https://nlp.stanford.edu/software/segmenter.shtml)



URL: https://sunyazhou.com/2018/01/PythonMySQL/index.html.md
Published At: 2018-01-13 22:27:18 +0000

# ä½¿ç”¨Pythonæ“ä½œMySQLæ•°æ®åº“

![](/assets/images/20180113PythonMySQL/MysqlPython.webp)


# å‰è¨€

ä¸ºäº†å®ç°`ä¸æ–·å­¸ç¿’ èˆ‡æ™‚ä¿±é€²`å‘¨æœ«æŠŠå¤§éƒ¨åˆ†æ—¶é—´æ”¾åœ¨äº†å­¦ä¹ `Python`ä¸Š.
åœ¨æœ€è¿‘çš„å­¦ä¹ ä¸­æœ‰ä¸€äº›æœ‰ä»·å€¼çš„éƒ¨åˆ†éƒ½æ‘˜å½•æ•´ç†å‡ºæ¥æ”¾åˆ°åšå®¢ä¸Š,ä»¥å…åç»­ç”¨åˆ°çš„æ—¶å€™å¿˜è®°æ—¶å›æ¥ç¿»ç¿»åšå®¢.

æˆ‘æ˜¯åœ¨`study.163.com`çš„è¿™ä¸ª[ã€Šå…¨æ ˆæ•°æ®å·¥ç¨‹å¸ˆå…»æˆæ”»ç•¥ã€‹](http://study.163.com/course/courseMain.htm?courseId=1003520028)è¯¾ç¨‹ä¸­å­¦ä¹ çš„,æ¨èå¤§å®¶å­¦ä¹ ä¸€ä¸‹.

## æœ¬ç¯‡ä¸»è¦å†…å®¹

ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªå¤§éƒ¨åˆ†

1. æ­å»º`Web`ç¯å¢ƒ
2. æ•°æ®åº“MySQLçš„ä½¿ç”¨æ–¹æ³•
3. ä½¿ç”¨Pythonæ“ä½œMySQL

### æ­å»º`Web`ç¯å¢ƒ

* Webç¯å¢ƒ: Apacheã€Nginx...
* WebæœåŠ¡å¯åŠ¨ä¸­ç›¸å…³é…ç½®.

#### Webç¯å¢ƒ: Apacheã€Nginx...

ä¸¤ä¸ªå¹³å°çš„ç›¸å…³çš„ä¸‹è½½

[MAMP](https://www.mamp.info/en/): Mac, Apache, MySQL, PHP 
> Mac, Apache, MySQL, PHP ç¼©å†™`MAMP`

[WAMP](https://www.mamp.info/en/): Windows, Apache, MySQL, PHP 
> Windows, Apache, MySQL, PHP ç¼©å†™`WAMP`

å½“ç„¶è¿˜æœ‰linuxç‰ˆæœ¬è¿™é‡Œå°±ä¸åšå¤šä»‹ç»äº†

æ€»ä¹‹éœ€è¦å®‰è£…è¿™ä¸ªè½¯ä»¶è¿›è¡Œç¯å¢ƒé…ç½®çš„æ­å»º.

æˆ‘è¿™é‡Œç”¨`MAMP`ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹

![](/assets/images/20180113PythonMySQL/mamp1.webp)

æ‰“å¼€ä¹‹å  
![](/assets/images/20180113PythonMySQL/mamp2.webp)

#### WebæœåŠ¡å¯åŠ¨ä¸­ç›¸å…³é…ç½®

å¼€å¯`Apatch Server`å’Œ`MySQL Server`æœåŠ¡(å³ä¸Šè§’).
ç„¶åç‚¹å‡»`Perferences`,è¿›è¡Œæœ¬åœ°ç«¯å£é…ç½®.

![](/assets/images/20180113PythonMySQL/mamp3.webp)

è¿™é‡Œæœ‰ä¸¤ç§é»˜è®¤é…ç½®(çº¢è‰²æ¡†é€‰éƒ¨åˆ†) 

å¦‚æœæŠŠæœåŠ¡å¼€å¯çš„è¯é‚£ä¹ˆæ‰“å¼€æµè§ˆå™¨è¾“å…¥:`localhost:8888`å°±å¯ä»¥çœ‹åˆ°ç›¸å…³çš„æ•ˆæœ
> localhost == 127.0.0.1

`8888`æ˜¯æœåŠ¡çš„ç«¯å£

ä¸‹é¢è¿™å¼ å›¾å¯ä»¥é€‰æ‹©æ–‡ä»¶æ ¹ç›®å½•
![](/assets/images/20180113PythonMySQL/mamp4.webp)

ä»€ä¹ˆæ„æ€å‘¢?

å°±æ˜¯ä½ æŠŠç½‘é¡µçš„ç›¸å…³æ–‡ä»¶æ”¾åˆ° è¿™ä¸ªæ–‡ä»¶å¤¹çš„è¯
å°±ä¼šåœ¨æµè§ˆå™¨ä¸Šç›´æ¥æµè§ˆ.

![](/assets/images/20180113PythonMySQL/mamp2.webp)

è¿™å¼ å›¾ä¸­é—´çš„`Open Start Page`. 

![](/assets/images/20180113PythonMySQL/sql1.webp)


è¿›å…¥åˆ°æ•°æ®åº“é…ç½®ç›¸å…³

é…ç½®æ•°æ®åº“åç§°
![](/assets/images/20180113PythonMySQL/sql2.webp)

è¾“å…¥è¡¨å

![](/assets/images/20180113PythonMySQL/sql3.webp)

é…ç½®æ•°æ®åº“è¡¨
![](/assets/images/20180113PythonMySQL/sql4.webp)

é…ç½®å®Œå³ä¾§å®Œæˆ

### æ•°æ®åº“MySQLçš„ä½¿ç”¨æ–¹æ³•

* åŸºæœ¬æ¦‚å¿µ
* ç»ˆç«¯é…ç½®Python MySQL
* Navicat æ•°æ®çš„å¯¼å‡ºå¯¼å…¥
* ä¸ªäººçš„ä¹ æƒ¯ææ³•

#### åŸºæœ¬æ¦‚å¿µ

`CURD`æ“ä½œ:

* `C` Create
* `R` Read
* `U` Update
* `D` Delete

è¿™å°±æ˜¯æ•°æ®åº“ç›¸å…³çŸ¥è¯†ä¸­ `å¢``åˆ ``æ”¹``æŸ¥`

#### ç»ˆç«¯é…ç½®Python MySQL

åœ¨ç»ˆç«¯ä¸­ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤å®‰è£…MySQLç¯å¢ƒ

``` sh
pip install MySQL-python
```
æˆ‘å®‰è£…çš„æ—¶å€™å‡ºé”™äº†

![](/assets/images/20180113PythonMySQL/PipInstallMysqlPython.webp)

æœ€åæ‰§è¡Œ

``` sh
brew install mysql-python
```
ç„¶åå†å»æ‰§è¡Œ`pip install MySQL-python`

å¦‚ä½•æµ‹è¯•æ˜¯å¦æˆåŠŸ

åœ¨shellä¸­è¾“å…¥`python`

![](/assets/images/20180113PythonMySQL/pythonshell1.webp)

æ‰§è¡Œ

``` python
import MySQLdb

```

å¦‚æœæ²¡æœ‰é”™è¯¯å°±æ˜¯OKçš„.


#### Navicat æ•°æ®çš„å¯¼å‡ºå¯¼å…¥

è¿™ä¸ªæ•°æ®åº“å¯è§†åŒ–æ“ä½œè½¯ä»¶å¤§å®¶è‡ªè¡Œä¸‹è½½å§  
![](/assets/images/20180113PythonMySQL/navicat1.webp)


æ‰“å¼€ä¹‹åç‚¹å‡»å·¦ä¸Šè§’ç‚¹å‡»æ–°å»ºconnect é€‰æ‹©MySQL
![](/assets/images/20180113PythonMySQL/navicat2.webp)

æ¥ç€é…ç½®æ•°æ®åº“çš„ä¿¡æ¯
![](/assets/images/20180113PythonMySQL/navicat3.webp)

è¿™é‡Œçš„åç§°å°±æ˜¯__æ•°æ®åº“åç§°__
`host`åœ°æ–¹æœ¬åœ°,å¦‚æœæ˜¯è¿œç¨‹çš„è¯,å¡«å†™`ip`æˆ–è€…`url`  
`port`å‰é¢æˆ‘ä»¬è®¾ç½®äº†`8889`  
è´¦å·å’Œå¯†ç è¾“å…¥`root`(å‰é¢å›¾é‡Œé¢å·²ç»çœ‹åˆ°äº†è´¦å·å¯†ç éƒ½æ˜¯ä¸€æ ·çš„)


ä¸‹é¢å°±æ˜¯è¿æ¥æ•°æ®åº“

![](/assets/images/20180113PythonMySQL/navicat4.webp)


ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯

![](/assets/images/20180113PythonMySQL/navicat5.webp)

__æ•°æ®åº“å¯¼å‡ºå’Œå¯¼å…¥,å½“ç„¶ä¹Ÿå¯ä»¥å¯¼å‡ºå¯¼å…¥æ•°æ®è¡¨.__



#### ä¸ªäººçš„ä¹ æƒ¯ææ³•

* ä½¿ç”¨`phpmyadmin`æ–°å»ºæ•°æ®åº“å’Œæ•°æ®è¡¨
* ä½¿ç”¨`python`æ’å…¥ã€è¯»å–ã€æ›´æ–°ã€ä¿®æ”¹æ•°æ®
* ä½¿ç”¨`Navicat`å¯¼å‡ºæ•°æ®åº“
* ä½¿ç”¨`phpmyadmin`å¯¼å…¥æ•°æ®åº“ 

æœ€ådeloy(éƒ¨ç½²)åˆ°çº¿ä¸Š,è¿™æ ·å°±å¯ä»¥é¿å…å„ç§é”™è¯¯æ“ä½œæ•°æ®åº“çš„é—®é¢˜

### ä½¿ç”¨Pythonæ“ä½œMySQL

è¿™ä¸ªæ²¡å•¥å°±æ˜¯codingéƒ¨åˆ†,ä½¿ç”¨ä¹‹å‰æŠŠç‚¹å‡»[è¿™é‡Œä¸‹è½½](/assets/images/20180113PythonMySQL/DoubanMovieClean.txt)è¿™ä¸ªæ–‡æœ¬æ–‡ä»¶


æˆ‘ä»¬ç”¨`sublime text`æ–°å»ºä¸€ä¸ª`text.py`æ–‡ä»¶


``` python
#!/usr/bin/env python
# coding:utf8

import sys
reload(sys)
sys.setdefaultencoding("utf8")

import MySQLdb
import MySQLdb.cursors
```

![](/assets/images/20180113PythonMySQL/Pythoncode1.webp)


> æ³¨æ„:_test.pyæœ€å¥½å’Œdouban_movie_clean.txtä¿æŒåœ¨åŒä¸€ä¸ªç›®å½•è¿™æ ·å°±ä¸ç”¨å†™è·¯å¾„äº†_

æ¥ç€åˆ›å»ºæ•°æ®åº“è¿æ¥

``` python

db = MySQLdb.connect(host='127.0.0.1', user='root', passwd='root', db='douban', port=8889, charset='utf8', cursorclass=MySQLdb.cursors.DictCursor) //1
db.autocommit(True) //2
cursor = db.cursor() //3

fr = open('douban_movie_clean.txt','r') //4

fr.close() //4

cursor.close() //3
db.close() //1

```
> æ³¨æ„ `db`è®°å¾—ç”¨å®Œå…³é—­,`cursor`ä¹Ÿè¦è®°å¾—å…³é—­, `fr`æ˜¯æ–‡ä»¶çš„è¯»å†™ å’Œæ•°æ®åº“æ²¡å•¥å…³ç³»ä¹Ÿéœ€è¦è®°å¾—ç”¨å®Œå…³é—­

ä¸‹é¢è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ„æ€

1. `db`åˆ›å»ºè¾“å…¥åº“å®ä¾‹,è¾“å…¥å‚æ•° `host`(è¿™é‡Œç”¨çš„æ˜¯127.0.0.1ä¹Ÿå¯ä»¥æ¢æˆlocalhost)ã€`passwd`ã€`db`ã€`port`ã€`charset`ã€`cursorclass`.
2. è‡ªåŠ¨æ”¹å®Œæäº¤å®Œæˆæ›´æ–°æ•°æ®åº“
3. é€šè¿‡`db`å®ä¾‹æ‹¿åˆ°ä¸€ä¸ªè¿æ¥`cursor` æ¯æ¬¡éƒ½é€šè¿‡`cursor.execute()`æ‰§è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œsqlè¯­å¥
4. è¯»å–æœ¬åœ°çš„æ–‡æœ¬æ–‡ä»¶

å¤§æ¦‚å°±æ˜¯è¿™ä¸ªæ„æ€

#### è¯»å–æ•°æ®

``` python
# Create
# è¯»å–æ•°æ®
fr = open('douban_movie_clean.txt', 'r')

count = 0
for line in fr:
	count += 1
	# countè¡¨ç¤ºå½“å‰å¤„ç†åˆ°ç¬¬å‡ è¡Œäº†
	print count
	# è·³è¿‡è¡¨å¤´
	if count == 1:
		continue

	# strip()å‡½æ•°å¯ä»¥å»æ‰å­—ç¬¦ä¸²ä¸¤ç«¯çš„ç©ºç™½ç¬¦
	# split()å‡½æ•°æŒ‰ç…§ç»™å®šçš„åˆ†å‰²ç¬¦å°†å­—ç¬¦ä¸²åˆ†å‰²ä¸ºåˆ—è¡¨
	line = line.strip().split('^')
	# æ’å…¥æ•°æ®ï¼Œæ³¨æ„å¯¹é½å­—æ®µ
	# execute()å‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºè¦æ‰§è¡Œçš„SQLå‘½ä»¤
	# è¿™é‡Œç”¨å­—ç¬¦ä¸²æ ¼å¼åŒ–çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿
	# %sè¡¨ç¤ºä¸€ä¸ªå ä½ç¬¦
	# ç¬¬äºŒä¸ªå‚æ•°ä¸ºéœ€è¦æ ¼å¼åŒ–çš„å‚æ•°ï¼Œä¼ å…¥åˆ°æ¨¡æ¿ä¸­
	cursor.execute("insert into movie(title, url, rate, length, description) values(%s, %s, %s, %s, %s)", [line[1], line[2], line[4], line[-3], line[-1]])

# å…³é—­è¯»æ–‡ä»¶
fr.close()
```

é€šè¿‡æˆ‘ä»¬æ‹¿åˆ°çš„`cursor`è¿æ¥å®ä¾‹æ¥æ‰§è¡Œ`cursor.execute()`å‡½æ•°è¿›è¡Œ`sql`çš„æ’å…¥æ“ä½œ.

![](/assets/images/20180113PythonMySQL/Pythoncode2.webp)

æ¥çœ‹ä¸‹ç»“æœ
![](/assets/images/20180113PythonMySQL/sqlresult.webp)


#### æ›´æ–°æ•°æ®

æ›´æ–°æ•°æ® æ¯”å¦‚æˆ‘æƒ³æŠŠid=1çš„è®°å½•æ›´æ–°ä¸€ä¸‹`title`å­—æ®µå’Œ`length`é•¿åº¦

``` python
# Update
cursor.execute("update movie set title=%s, length=%s where id=1", ['å­™äºšæ´²', 999])
```

#### è¯»å–æ•°æ®

``` python
# Read
cursor.execute("select title, length from movie where id=1")
movies = cursor.fetchone()
```

#### åˆ é™¤æ•°æ®

``` python
# Delete
cursor.execute("delete from movie where id=%s",[2])
```

---

ä¸‹é¢çœ‹ä¸‹å®Œæˆçš„ä»£ç 


``` python 
#!/usr/bin/env python
# coding:utf8

import sys
reload(sys)
sys.setdefaultencoding("utf8")


import MySQLdb
import MySQLdb.cursors

db = MySQLdb.connect(host='127.0.0.1', user='root', passwd='root', db='douban', port=8889, charset='utf8', cursorclass=MySQLdb.cursors.DictCursor)
db.autocommit(True)
cursor = db.cursor()

fr = open('douban_movie_clean.txt','r')

# Create
count = 0
for line in fr:
	count += 1
	print count
	if count == 1:
		continue
	line = line.strip().split('^')
	cursor.execute("insert into movie(title, url, rate, length, description) values(%s, %s, %s, %s, %s)", [line[1], line[2], line[4], line[-3], line[-1]])
fr.close()

# Update
cursor.execute("update movie set title=%s, length=%s where id=1", ['å­™äºšæ´²', 999])

# Read
cursor.execute("select title, length from movie where id=1")
movies = cursor.fetchone()

print len(movies)
# print movies[0]


# Delete

cursor.execute("delete from movie where id=%s",[2])


cursor.close()
db.close()
```


## æ€»ç»“

é€šè¿‡å­¦ä¹ `python`æ“ä½œæ•°æ®åº“å¾ˆæœ‰æ”¶è·,æƒ³èµ·äº†å¤§å­¦ææœˆè¾‰è€å¸ˆæ•™æˆ‘æ€ä¹ˆç”¨javaè¿æ¥æ•°æ®åº“.
åœ¨å·¥ä½œä¸­æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°ä¸€å¤§å †æ•°æ®å¦‚ä½•æ’å…¥åˆ°æ•°æ®ç­‰é—®é¢˜,é€šè¿‡å­¦ä¹ äº†æœ¬ç« å†…å®¹å¯ä»¥å¾ˆå®¹æ˜“çš„å¤„ç†æ‰¹é‡æ•°æ®.

å…³äºæ›´å¤šçš„SQLè¯­å¥ 
å‚è€ƒ[SQL æ•™ç¨‹](http://www.runoob.com/sql/sql-tutorial.html)


å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2018/01/AVAudioSessionCategory/index.html.md
Published At: 2018-01-12 10:32:18 +0000

# AVAudioSession-Categoryå„ç§å§¿åŠ¿

![AVAudioSession](/assets/images/20180112AVAudioSessionCategory/ASPGIntro.webp)
# å‰è¨€


2018æ–°å¹´ç¬¬ä¸€ç¯‡, æ¢³ç†`AVAudioSession`çš„`Category`,è§£å†³éŸ³é¢‘å¼€å‘ä¸­çš„å„ç§æ’­æ”¾è¢«æ‰“æ–­æˆ–è€…é¦–æ¬¡å¯åŠ¨æ—¶æ— å£°éŸ³çš„é—®é¢˜


## å¼€ç¯‡

ç”±äº`iOS`ç³»ç»Ÿçš„ç‰¹æ®Šæ€§,æ‰€æœ‰`App`å…±ç”¨ä¸€ä¸ª`AVAudioSession`æ‰€ä»¥è¿™ä¸ªä¼šè¯æ˜¯ä¸ªå•ä¾‹å¯¹è±¡.(`macOS`æ˜¯æ”¯æŒåŒæ—¶æ’­æ”¾å¤šè·¯éŸ³é¢‘æ–‡ä»¶)

å½“é‡åˆ°`æ’æ‹”è€³æœº`,`æ¥ç”µè¯`,`è°ƒèµ· siri`,ç­‰ç­‰,å°±å‡ºç°éŸ³é¢‘ä¼šè¯è¢«ç³»ç»Ÿæ—¶é—´æ‰“æ–­ç­‰è¡Œä¸ºè¡¨ç°:

* æ˜¯è¿›è¡Œå½•éŸ³è¿˜æ˜¯æ’­æ”¾ï¼Ÿ
* å½“ç³»ç»Ÿé™éŸ³é”®æŒ‰ä¸‹æ—¶è¯¥å¦‚ä½•è¡¨ç°ï¼Ÿ
* æ˜¯ä»æ‰¬å£°å™¨è¿˜æ˜¯ä»å¬ç­’é‡Œé¢æ’­æ”¾å£°éŸ³ï¼Ÿ
* æ’æ‹”è€³æœºåå¦‚ä½•è¡¨ç°ï¼Ÿ
* æ¥ç”µè¯/é—¹é’Ÿå“äº†åå¦‚ä½•è¡¨ç°ï¼Ÿ
* å…¶ä»–éŸ³é¢‘Appå¯åŠ¨åå¦‚ä½•è¡¨ç°ï¼Ÿ


### Sessioné»˜è®¤è¡Œä¸º

* å¯ä»¥è¿›è¡Œæ’­æ”¾ï¼Œä½†æ˜¯ä¸èƒ½è¿›è¡Œå½•åˆ¶ã€‚
* å½“ç”¨æˆ·å°†æ‰‹æœºä¸Šçš„é™éŸ³æ‹¨ç‰‡æ‹¨åˆ°â€œé™éŸ³â€çŠ¶æ€æ—¶ï¼Œæ­¤æ—¶å¦‚æœæ­£åœ¨æ’­æ”¾éŸ³é¢‘ï¼Œé‚£ä¹ˆæ’­æ”¾å†…å®¹ä¼šè¢«é™éŸ³ã€‚
* å½“ç”¨æˆ·æŒ‰äº†æ‰‹æœºçš„é”å±é”®æˆ–è€…æ‰‹æœºè‡ªåŠ¨é”å±äº†ï¼Œæ­¤æ—¶å¦‚æœæ­£åœ¨æ’­æ”¾éŸ³é¢‘ï¼Œé‚£ä¹ˆæ’­æ”¾ä¼šé™éŸ³å¹¶è¢«æš‚åœã€‚
* å¦‚æœä½ çš„Appåœ¨å¼€å§‹æ’­æ”¾çš„æ—¶å€™ï¼Œæ­¤æ—¶QQéŸ³ä¹ç­‰å…¶ä»–Appæ­£åœ¨æ’­æ”¾ï¼Œé‚£ä¹ˆå…¶ä»–æ’­æ”¾å™¨ä¼šè¢«é™éŸ³å¹¶æš‚åœã€‚

`AVAudioSession`é»˜è®¤çš„è¡Œä¸ºç›¸å½“äºè®¾ç½®äº†`Category`ä¸º`AVAudioSessionCategorySoloAmbient`

ç¤ºä¾‹ä»£ç :

``` objc
- (void)configSession{	
    [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategorySoloAmbient error:&error];
    if (error) {
        NSLog(@"%@",error);
    }
}
```

### AVAudioSession

ä¸Šè¾¹è¯´äº† è¿™ä¸ªç±»æ˜¯ä¸ªå•ä¾‹

``` objc
+ (AVAudioSession *)sharedInstance;
```

é€šè¿‡ä¸Šè¾¹æ–¹æ³•è·å¾—å•ä¾‹

è™½ç„¶ç³»ç»Ÿä¼šåœ¨Appå¯åŠ¨çš„æ—¶å€™ï¼Œæ¿€æ´»è¿™ä¸ªå”¯ä¸€çš„`AVAudioSession`ï¼Œä½†æ˜¯æœ€å¥½è¿˜æ˜¯åœ¨è‡ªå·±ç”¨çš„æ—¶å€™å†æ¬¡è¿›è¡Œæ¿€æ´»ï¼š

``` 
- (BOOL)setActive:(BOOL)active error:(NSError * _Nullable *)outError;
```
é€šè¿‡è®¾ç½®`active`ä¸º`YES`æ¿€æ´»`Session`ï¼Œè®¾ç½®ä¸º`NO`è§£é™¤`Session`çš„æ¿€æ´»çŠ¶æ€ã€‚`BOOL`è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦æˆåŠŸï¼Œå¦‚æœå¤±è´¥çš„è¯å¯ä»¥é€šè¿‡`NSError`çš„`error.localizedDescription`æŸ¥çœ‹å‡ºé”™åŸå› ã€‚

> å› ä¸º`AVAudioSession`ä¼šå½±å“å…¶ä»–`App`çš„è¡¨ç°ï¼Œå½“è‡ªå·±`App`çš„`Session`è¢«æ¿€æ´»ï¼Œå…¶ä»–`App`çš„å°±ä¼šè¢«è§£é™¤æ¿€æ´».

__å¦‚ä½•è¦è®©è‡ªå·±çš„`Session`è§£é™¤æ¿€æ´»åæ¢å¤å…¶ä»–`App Session`çš„æ¿€æ´»çŠ¶æ€å‘¢?__

æ­¤æ—¶å¯ä»¥ä½¿ç”¨ï¼š

```
- (BOOL)setActive:(BOOL)active withOptions:(AVAudioSessionSetActiveOptions)options error:(NSError * _Nullable *)outError;
```

__è¿™é‡Œçš„`options`ä¼ å…¥`AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation`å³å¯.__

å½“ç„¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`otherAudioPlaying`å˜é‡æ¥æå‰åˆ¤æ–­å½“å‰æ˜¯å¦æœ‰å…¶ä»–Appåœ¨æ’­æ”¾éŸ³é¢‘ã€‚

``` objc
NSLog(@"Current Category:%@", [AVAudioSession sharedInstance].category); //è¿”å›å½“å‰ category
```

``` sh
Current Category:AVAudioSessionCategorySoloAmbien
```

### ä¸ƒå¤§Category

ä¸‹é¢ä»‹ç»ä¸€ä¸‹`AVAudioSession`éå¸¸é‡è¦çš„ä¸ƒç§`Category`.

``` objc
#pragma mark -- Values for the category property --

AVF_EXPORT NSString *const AVAudioSessionCategoryAmbient;

AVF_EXPORT NSString *const AVAudioSessionCategorySoloAmbient;

AVF_EXPORT NSString *const AVAudioSessionCategoryPlayback;

AVF_EXPORT NSString *const AVAudioSessionCategoryRecord;

AVF_EXPORT NSString *const AVAudioSessionCategoryPlayAndRecord;

AVF_EXPORT NSString *const AVAudioSessionCategoryAudioProcessing NS_DEPRECATED_IOS(3_0, 10_0) __TVOS_PROHIBITED __WATCHOS_PROHIBITED;

AVF_EXPORT NSString *const AVAudioSessionCategoryMultiRoute NS_AVAILABLE_IOS(6_0);
```



`AVAudioSession`å°†ä½¿ç”¨éŸ³é¢‘çš„åœºæ™¯åˆ†æˆä¸ƒå¤§ç±»ï¼Œé€šè¿‡è®¾ç½®`Session`ä¸ºä¸åŒçš„ç±»åˆ«ï¼Œå¯ä»¥æ§åˆ¶ï¼š

* å½“Appæ¿€æ´»Sessionçš„æ—¶å€™ï¼Œæ˜¯å¦ä¼šæ‰“æ–­å…¶ä»–ä¸æ”¯æŒæ··éŸ³çš„Appå£°éŸ³
* å½“ç”¨æˆ·è§¦å‘æ‰‹æœºä¸Šçš„â€œé™éŸ³â€é”®æ—¶æˆ–è€…é”å±æ—¶ï¼Œæ˜¯å¦ç›¸åº”é™éŸ³
* å½“å‰çŠ¶æ€æ˜¯å¦æ”¯æŒå½•éŸ³
* å½“å‰çŠ¶æ€æ˜¯å¦æ”¯æŒæ’­æ”¾
* æ¯ä¸ªAppå¯åŠ¨æ—¶éƒ½ä¼šè®¾ç½®æˆä¸Šé¢è¯´çš„é»˜è®¤çŠ¶æ€ï¼Œå³å…¶ä»–Appä¼šè¢«ä¸­æ–­åŒæ—¶ç›¸åº”â€œé™éŸ³â€é”®çš„æ’­æ”¾æ¨¡å¼ã€‚é€šè¿‡ä¸‹è¡¨å¯ä»¥ç»†åˆ†æ¯ä¸ªç±»åˆ«çš„æ”¯æŒæƒ…å†µï¼š

| ç±»åˆ« | å½“æŒ‰â€œé™éŸ³â€æˆ–è€…é”å±æ˜¯æ˜¯å¦é™éŸ³ | æ˜¯å¦å¼•èµ·ä¸æ”¯æŒæ··éŸ³çš„Appä¸­æ–­ | æ˜¯å¦æ”¯æŒå½•éŸ³å’Œæ’­æ”¾ |
| :------: | :------: | :------: | :------: |
| AVAudioSessionCategoryAmbient | æ˜¯ | å¦ | åªæ”¯æŒæ’­æ”¾ |
| AVAudioSessionCategoryAudioProcessing | N/A | éƒ½ä¸æ”¯æŒ | N/A |
| AVAudioSessionCategoryMultiRoute | å¦ | æ˜¯ | æ—¢å¯ä»¥å½•éŸ³ä¹Ÿå¯ä»¥æ’­æ”¾ |
| AVAudioSessionCategoryPlayAndRecord | å¦ | é»˜è®¤ä¸å¼•èµ· | æ—¢å¯ä»¥å½•éŸ³ä¹Ÿå¯ä»¥æ’­æ”¾ |
| AVAudioSessionCategoryPlayback | å¦ | é»˜è®¤å¼•èµ· | åªç”¨äºæ’­æ”¾ |
| AVAudioSessionCategoryRecord | å¦ | æ˜¯ | åªç”¨äºå½•éŸ³ |
| AVAudioSessionCategorySoloAmbient | æ˜¯ | æ˜¯ | åªç”¨äºæ’­æ”¾ |


å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®é»˜è®¤çš„å°±æ˜¯`AVAudioSessionCategorySoloAmbient`ç±»åˆ«.  
ä»è¡¨ä¸­æˆ‘ä»¬å¯ä»¥æ€»ç»“å¦‚ä¸‹ï¼š  

* _`AVAudioSessionCategoryAmbient`:åªç”¨äºæ’­æ”¾éŸ³ä¹æ—¶ï¼Œå¹¶ä¸”å¯ä»¥å’ŒQQéŸ³ä¹åŒæ—¶æ’­æ”¾ï¼Œæ¯”å¦‚ç©æ¸¸æˆçš„æ—¶å€™è¿˜æƒ³å¬QQéŸ³ä¹çš„æ­Œï¼Œé‚£ä¹ˆæŠŠæ¸¸æˆæ’­æ”¾èƒŒæ™¯éŸ³å°±è®¾ç½®æˆè¿™ç§ç±»åˆ«ã€‚åŒæ—¶ï¼Œå½“ç”¨æˆ·é”å±æˆ–è€…é™éŸ³æ—¶ä¹Ÿä¼šéšç€é™éŸ³ï¼Œè¿™ç§ç±»åˆ«åŸºæœ¬ä½¿ç”¨æ‰€æœ‰Appçš„èƒŒæ™¯åœºæ™¯ã€‚_

* _`AVAudioSessionCategoryAudioProcessing`:ä¸»è¦ç”¨äºéŸ³é¢‘æ ¼å¼å¤„ç†ï¼Œä¸€èˆ¬å¯ä»¥é…åˆAudioUnitè¿›è¡Œä½¿ç”¨._

* _`AVAudioSessionCategoryMultiRoute`:æƒ³è±¡ä¸€ä¸ªDJç”¨çš„Appï¼Œæ‰‹æœºè¿ç€HDMIåˆ°æ‰¬å£°å™¨æ’­æ”¾å½“å‰çš„éŸ³ä¹ï¼Œç„¶åè€³æœºé‡Œé¢æ’­æ”¾ä¸‹ä¸€æ›²ï¼Œè¿™ç§å¸¸äººä¸ç†è§£çš„åœºæ™¯ï¼Œè¿™ä¸ªç±»åˆ«å¯ä»¥æ”¯æŒå¤šä¸ªè®¾å¤‡è¾“å…¥è¾“å‡º._

* _`AVAudioSessionCategoryPlayAndRecord`: å¦‚æœæ—¢æƒ³æ’­æ”¾åˆæƒ³å½•åˆ¶è¯¥ç”¨ä»€ä¹ˆæ¨¡å¼å‘¢ï¼Ÿæ¯”å¦‚VoIPï¼Œæ‰“ç”µè¯è¿™ç§åœºæ™¯ï¼ŒPlayAndRecordå°±æ˜¯ä¸“é—¨ä¸ºè¿™æ ·çš„åœºæ™¯è®¾è®¡çš„._

* _`AVAudioSessionCategoryPlayback`:å¦‚æœé”å±äº†è¿˜æƒ³å¬å£°éŸ³æ€ä¹ˆåŠï¼Ÿç”¨è¿™ä¸ªç±»åˆ«ï¼Œæ¯”å¦‚Appæœ¬èº«å°±æ˜¯æ’­æ”¾å™¨ï¼ŒåŒæ—¶å½“Appæ’­æ”¾æ—¶ï¼Œå…¶ä»–ç±»ä¼¼QQéŸ³ä¹å°±ä¸èƒ½æ’­æ”¾äº†ã€‚æ‰€ä»¥è¿™ç§ç±»åˆ«ä¸€èˆ¬ç”¨äºæ’­æ”¾å™¨ç±»App._

* _`AVAudioSessionCategoryRecord`:æœ‰äº†æ’­æ”¾å™¨ï¼Œè‚¯å®šè¦å½•éŸ³æœºï¼Œæ¯”å¦‚å¾®ä¿¡è¯­éŸ³çš„å½•åˆ¶ï¼Œå°±è¦ç”¨åˆ°è¿™ä¸ªç±»åˆ«ï¼Œæ—¢ç„¶è¦å®‰é™çš„å½•éŸ³ï¼Œè‚¯å®šä¸å¸Œæœ›æœ‰QQéŸ³ä¹äº†ï¼Œæ‰€ä»¥å…¶ä»–æ’­æ”¾å£°éŸ³ä¼šä¸­æ–­ã€‚æƒ³æƒ³å¾®ä¿¡è¯­éŸ³çš„åœºæ™¯ï¼Œå°±çŸ¥é“ä»€ä¹ˆæ—¶å€™ç”¨ä»–äº†._

* _`AVAudioSessionCategorySoloAmbient`:ä¹Ÿæ˜¯åªç”¨äºæ’­æ”¾,ä½†æ˜¯å’Œ`AVAudioSessionCategoryAmbient`ä¸åŒçš„æ˜¯ï¼Œç”¨äº†å®ƒå°±åˆ«æƒ³å¬QQéŸ³ä¹äº†ï¼Œæ¯”å¦‚ä¸å¸Œæœ›QQéŸ³ä¹å¹²æ‰°çš„Appï¼Œç±»ä¼¼èŠ‚å¥å¤§å¸ˆã€‚åŒæ ·å½“ç”¨æˆ·é”å±æˆ–è€…é™éŸ³æ—¶ä¹Ÿä¼šéšç€é™éŸ³ï¼Œé”å±äº†å°±ç©ä¸äº†èŠ‚å¥å¤§å¸ˆäº†._


äº†è§£äº†è¿™ä¸ƒå¤§ç±»åˆ«ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦è¿›è¡Œå¯¹åº”ç±»åˆ«çš„è®¾ç½®äº†ï¼š

``` objc
- (BOOL)setCategory:(NSString *)category error:(NSError **)outError;
```

ä¼ å…¥å¯¹åº”çš„åˆ—è¡¨æšä¸¾å³å¯ã€‚å¦‚æœè¿”å›`NO`å¯ä»¥é€šè¿‡`NSError`çš„`error.localizedDescription`æŸ¥çœ‹åŸå› .

å¯ä»¥é€šè¿‡:

``` objc
@property(readonly) NSArray<NSString *> *availableCategories;
```

å±æ€§,æŸ¥çœ‹å½“å‰è®¾å¤‡æ”¯æŒå“ªäº›ç±»åˆ«,ç„¶åå†è¿›è¡Œè®¾ç½®,ä»è€Œä¿è¯ä¼ å…¥å‚æ•°çš„åˆæ³•,å‡å°‘é”™è¯¯çš„å¯èƒ½.

æ¯”å¦‚ä½¿ç”¨å¦‚ä¸‹ä»£ç :

``` objc
	NSLog(@"Current Category:%@", [AVAudioSession sharedInstance].category);
    NSError *error = nil;
    [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:&error];
    if (nil != error) {
        NSLog(@"set Option error %@", error.localizedDescription);
    }
    NSLog(@"Current Category:%@", [AVAudioSession sharedInstance].category);

```

æ­¤æ—¶åœ¨æ’­æ”¾éŸ³ä¹çš„æ—¶å€™ï¼Œå†å»æŒ‰ä¸‹é™éŸ³é”®ï¼Œä¼šå‘ç°ï¼ŒéŸ³ä¹è¿˜åœ¨ç»§ç»­æ’­æ”¾ï¼Œä¸ä¼šè¢«é™éŸ³ã€‚


### ç±»åˆ«çš„é€‰é¡¹(Category Options)



ä¸Šé¢ä»‹ç»çš„è¿™ä¸ªä¸ƒå¤§ç±»åˆ«ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯è®¾å®šäº†ä¸ƒç§ä¸»åœºæ™¯ï¼Œè€Œè¿™ä¸ƒç±»è‚¯å®šæ˜¯ä¸èƒ½æ»¡è¶³å¼€å‘è€…æ‰€æœ‰çš„éœ€æ±‚çš„ã€‚`CoreAudio`æä¾›çš„æ–¹æ³•æ˜¯ï¼Œ__é¦–å…ˆå®šä¸‹ä¸ƒç§çš„ä¸€ç§åŸºè°ƒ,ç„¶ååœ¨è¿›è¡Œå¾®è°ƒ.`CoreAudio`ä¸ºæ¯ç§`Category`éƒ½æä¾›äº†äº›è®¸é€‰é¡¹æ¥è¿›è¡Œå¾®è°ƒ.__


åœ¨è®¾ç½®å®Œç±»åˆ«åï¼Œå¯ä»¥é€šè¿‡:

``` objc
@property(readonly) AVAudioSessionCategoryOptions categoryOptions;
```

å±æ€§,æŸ¥çœ‹å½“å‰ç±»åˆ«è®¾ç½®äº†å“ªäº›é€‰é¡¹,æ³¨æ„è¿™é‡Œçš„è¿”å›å€¼æ˜¯`AVAudioSessionCategoryOptions`,__å®é™…æ˜¯å¤šä¸ª`options`çš„`|`è¿ç®—__.  
é»˜è®¤æƒ…å†µä¸‹æ˜¯`0`.

``` objc
typedef NS_OPTIONS(NSUInteger, AVAudioSessionCategoryOptions)
{
	AVAudioSessionCategoryOptionMixWithOthers			= 0x1,
	AVAudioSessionCategoryOptionDuckOthers				= 0x2,
	AVAudioSessionCategoryOptionAllowBluetooth	__TVOS_PROHIBITED __WATCHOS_PROHIBITED		= 0x4,
	AVAudioSessionCategoryOptionDefaultToSpeaker __TVOS_PROHIBITED __WATCHOS_PROHIBITED		= 0x8,
	AVAudioSessionCategoryOptionInterruptSpokenAudioAndMixWithOthers NS_AVAILABLE_IOS(9_0) = 0x11,
	AVAudioSessionCategoryOptionAllowBluetoothA2DP API_AVAILABLE(ios(10.0), watchos(3.0), tvos(10.0)) = 0x20,
	AVAudioSessionCategoryOptionAllowAirPlay API_AVAILABLE(ios(10.0), tvos(10.0)) __WATCHOS_PROHIBITED = 0x40,
} NS_AVAILABLE_IOS(6_0);
```


| é€‰é¡¹ | é€‚ç”¨ç±»åˆ« | ä½œç”¨ | 
| :------ | :------ | :------: |
| AVAudioSessionCategoryOptionMixWithOthers | AVAudioSessionCategoryPlayAndRecord, AVAudioSessionCategoryPlayback, and AVAudioSessionCategoryMultiRoute | æ˜¯å¦å¯ä»¥å’Œå…¶ä»–åå°Appè¿›è¡Œæ··éŸ³ |
| AVAudioSessionCategoryOptionDuckOthers | AVAudioSessionCategoryAmbient, AVAudioSessionCategoryPlayAndRecord, AVAudioSessionCategoryPlayback, and AVAudioSessionCategoryMultiRoute | æ˜¯å¦å‹ä½å…¶ä»–Appå£°éŸ³ |
| AVAudioSessionCategoryOptionAllowBluetooth | AVAudioSessionCategoryRecord and AVAudioSessionCategoryPlayAndRecord | æ˜¯å¦æ”¯æŒè“ç‰™è€³æœº |
| AVAudioSessionCategoryOptionDefaultToSpeaker | AVAudioSessionCategoryPlayAndRecord  | æ˜¯å¦é»˜è®¤ç”¨å…æå£°éŸ³ |

> ç›®å‰ä¸»è¦çš„é€‰é¡¹æœ‰è¿™å‡ ç§ï¼Œéƒ½æœ‰å¯¹åº”çš„ä½¿ç”¨åœºæ™¯ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰iOS9ä¹‹åæ–°å¢åŠ çš„ä¸€äº›

| é€‰é¡¹ | é€‚ç”¨ç±»åˆ« | ä½œç”¨ | æœ€ä½é€‚ç”¨ç³»ç»Ÿ |
| :------ | :------ | :------: | :------|
| AVAudioSessionCategoryOptionInterruptSpokenAudioAndMixWithOthers  | -- | -- | iOS 9|
| AVAudioSessionCategoryOptionAllowBluetoothA2DP  | -- | -- | iOS 10|
| AVAudioSessionCategoryOptionAllowAirPlay  | -- | æ”¯æŒè“ç‰™A2DPè€³æœºå’ŒAirPlay | iOS 10|


ä¸‹é¢ä»‹ç»ä¸€ä¸‹æ¯ä¸ªå­åœºæ™¯é€‰é¡¹çš„ä½œç”¨:

* _`AVAudioSessionCategoryOptionMixWithOthers`:å¦‚æœç¡®å®ç”¨çš„`AVAudioSessionCategoryPlayback`å®ç°çš„ä¸€ä¸ªèƒŒæ™¯éŸ³ï¼Œå¯æ˜¯ï¼Œåˆæƒ³å’ŒQQéŸ³ä¹å¹¶å­˜ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨`AVAudioSessionCategoryPlayback`ç±»åˆ«ä¸‹åœ¨è®¾ç½®è¿™ä¸ªé€‰é¡¹ï¼Œå°±å¯ä»¥å®ç°å…±å­˜äº†._

* _`AVAudioSessionCategoryOptionDuckOthers`ï¼šåœ¨å®æ—¶é€šè¯çš„åœºæ™¯ï¼Œæ¯”å¦‚QQéŸ³ä¹ï¼Œå½“è¿›è¡Œè§†é¢‘é€šè¯çš„æ—¶å€™ï¼Œä¼šå‘ç°QQéŸ³ä¹è‡ªåŠ¨å£°éŸ³é™ä½äº†ï¼Œæ­¤æ—¶å°±æ˜¯é€šè¿‡è®¾ç½®è¿™ä¸ªé€‰é¡¹æ¥å¯¹å…¶ä»–éŸ³ä¹Appè¿›è¡Œäº†å‹åˆ¶._

* _`AVAudioSessionCategoryOptionAllowBluetooth`ï¼šå¦‚æœè¦æ”¯æŒè“ç‰™è€³æœºç”µè¯ï¼Œåˆ™éœ€è¦è®¾ç½®è¿™ä¸ªé€‰é¡¹._

* _`AVAudioSessionCategoryOptionDefaultToSpeaker`ï¼š å¦‚æœåœ¨VoIPæ¨¡å¼ä¸‹ï¼Œå¸Œæœ›é»˜è®¤æ‰“å¼€å…æåŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®è¿™ä¸ªé€‰é¡¹._

é€šè¿‡æ¥å£:

``` objc
- (BOOL)setCategory:(NSString *)category withOptions:(AVAudioSessionCategoryOptions)options error:(NSError **)outError;
```

æ¥å¯¹å½“å‰çš„ç±»åˆ«è¿›è¡Œé€‰é¡¹(options)çš„è®¾ç½®.

å®ä¾‹ä»£ç :

``` objc
- (void)xxxMethod{
    [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback withOptions:AVAudioSessionCategoryOptionMixWithOthers error:&error];
    if (nil != error) {
        NSLog(@"set Option error %@", error.localizedDescription);
    }
    options = [[AVAudioSession sharedInstance] categoryOptions];
    NSLog(@"Category[%@] has %lu options",  [AVAudioSession sharedInstance].category, options);
}
```

æ­¤æ—¶ï¼Œå¦‚æœæ‰“å¼€QQéŸ³ä¹æ’­æ”¾å™¨ï¼Œç„¶åå†å¼€å§‹è¿›è¡Œæ’­æ”¾ï¼Œä¼šå‘ç°ï¼ŒQQå’Œæˆ‘ä»¬çš„å®ä¾‹éƒ½åœ¨æ’­æ”¾ï¼Œå¹¶ä¸”è¿›è¡Œäº†è‡ªåŠ¨æ··éŸ³ã€‚

### ä¸ƒå¤§æ¨¡å¼

é€šè¿‡ä¸Šé¢çš„`ä¸ƒå¤§ç±»åˆ«`:

``` objc
#pragma mark -- Values for the mode property --

AVF_EXPORT NSString *const AVAudioSessionModeDefault NS_AVAILABLE_IOS(5_0);

AVF_EXPORT NSString *const AVAudioSessionModeVoiceChat NS_AVAILABLE_IOS(5_0);

AVF_EXPORT NSString *const AVAudioSessionModeGameChat NS_AVAILABLE_IOS(5_0);

AVF_EXPORT NSString *const AVAudioSessionModeVideoRecording NS_AVAILABLE_IOS(5_0);

AVF_EXPORT NSString *const AVAudioSessionModeMeasurement NS_AVAILABLE_IOS(5_0);

AVF_EXPORT NSString *const AVAudioSessionModeMoviePlayback NS_AVAILABLE_IOS(6_0);

AVF_EXPORT NSString *const AVAudioSessionModeVideoChat NS_AVAILABLE_IOS(7_0);

AVF_EXPORT NSString *const AVAudioSessionModeSpokenAudio NS_AVAILABLE_IOS(9_0);
```


æˆ‘ä»¬åŸºæœ¬è¦†ç›–äº†å¸¸ç”¨çš„__ä¸»åœºæ™¯__ï¼Œåœ¨æ¯ä¸ªä¸»åœºæ™¯ä¸­å¯ä»¥é€šè¿‡`Option`è¿›è¡Œ__å¾®è°ƒ__ã€‚ä¸ºæ­¤`CoreAudio`æä¾›äº†ä¸ƒå¤§æ¯”è¾ƒå¸¸è§å¾®è°ƒåçš„å­åœºæ™¯ã€‚å«åš`å„ä¸ªç±»åˆ«çš„æ¨¡å¼`.

| æ¨¡å¼Mode | é€‚ç”¨çš„ç±»åˆ« | åœºæ™¯ | 
| :------ | :------ | :------: |
| AVAudioSessionModeDefault | æ‰€æœ‰ç±»åˆ« | é»˜è®¤çš„æ¨¡å¼ |
| AVAudioSessionModeVoiceChat | AVAudioSessionCategoryPlayAndRecord  | VoIP |
| AVAudioSessionModeGameChat | AVAudioSessionCategoryPlayAndRecord | æ¸¸æˆå½•åˆ¶ï¼Œç”±GKVoiceChatè‡ªåŠ¨è®¾ç½®ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ |
| AVAudioSessionModeVideoRecording | AVAudioSessionCategoryPlayAndRecord AVAudioSessionCategoryRecord | å½•åˆ¶è§†é¢‘æ—¶|
| AVAudioSessionModeMoviePlayback | AVAudioSessionCategoryPlayback | è§†é¢‘æ’­æ”¾|
| AVAudioSessionModeMeasurement | AVAudioSessionCategoryPlayAndRecord AVAudioSessionCategoryRecord AVAudioSessionCategoryPlayback | æœ€å°ç³»ç»Ÿ |
| AVAudioSessionModeVideoChat | AVAudioSessionCategoryPlayAndRecord | è§†é¢‘é€šè¯ |

æ¯ä¸ªæ¨¡å¼æœ‰å…¶é€‚ç”¨çš„ç±»åˆ«ï¼Œæ‰€ä»¥ï¼Œå¹¶ä¸æ˜¯æœ‰â€œä¸ƒä¸ƒ å››åä¹â€ç§ç»„åˆã€‚å¦‚æœå½“å‰å¤„äºçš„ç±»åˆ«ä¸‹æ²¡æœ‰è¿™ä¸ªæ¨¡å¼ï¼Œé‚£ä¹ˆæ˜¯è®¾ç½®ä¸æˆåŠŸçš„ã€‚  

è®¾ç½®å®ŒCategoryåå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç :

``` objc
@property(readonly) NSArray<NSString *> *availableModes;

```

è¿™ä¸ªå±æ€§,æŸ¥çœ‹å…¶æ”¯æŒå“ªäº›å±æ€§ï¼Œåšåˆæ³•æ€§æ ¡éªŒã€‚


ä¸‹é¢è¯´ä¸€ä¸‹å…·ä½“åº”ç”¨åœºæ™¯:


* __`AVAudioSessionModeDefault`ï¼š æ¯ç§ç±»åˆ«é»˜è®¤çš„å°±æ˜¯è¿™ä¸ªæ¨¡å¼ï¼Œæ‰€æœ‰è¦æƒ³è¿˜åŸçš„è¯ï¼Œå°±è®¾ç½®æˆè¿™ä¸ªæ¨¡å¼ã€‚__

* __`AVAudioSessionModeVoiceChat`ï¼šä¸»è¦ç”¨äºVoIPåœºæ™¯ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šé€‰æ‹©æœ€ä½³çš„è¾“å…¥è®¾å¤‡ï¼Œæ¯”å¦‚æ’ä¸Šè€³æœºå°±ä½¿ç”¨è€³æœºä¸Šçš„éº¦å…‹é£è¿›è¡Œé‡‡é›†ã€‚æ­¤æ—¶æœ‰ä¸ªå‰¯ä½œç”¨ï¼Œä»–ä¼šè®¾ç½®ç±»åˆ«çš„é€‰é¡¹ä¸º`AVAudioSessionCategoryOptionAllowBluetooth`ä»è€Œæ”¯æŒè“ç‰™è€³æœºã€‚__

* __`AVAudioSessionModeVideoChat` ï¼š ä¸»è¦ç”¨äºè§†é¢‘é€šè¯ï¼Œæ¯”å¦‚QQè§†é¢‘ã€FaceTimeã€‚æ—¶ç³»ç»Ÿä¹Ÿä¼šé€‰æ‹©æœ€ä½³çš„è¾“å…¥è®¾å¤‡ï¼Œæ¯”å¦‚æ’ä¸Šè€³æœºå°±ä½¿ç”¨è€³æœºä¸Šçš„éº¦å…‹é£è¿›è¡Œé‡‡é›†å¹¶ä¸”ä¼šè®¾ç½®ç±»åˆ«çš„é€‰é¡¹ä¸º`AVAudioSessionCategoryOptionAllowBluetooth`å’Œ`AVAudioSessionCategoryOptionDefaultToSpeaker`ã€‚__

* __`AVAudioSessionModeGameChat` ï¼š é€‚ç”¨äºæ¸¸æˆAppçš„é‡‡é›†å’Œæ’­æ”¾ï¼Œæ¯”å¦‚â€œGKVoiceChatâ€å¯¹è±¡ï¼Œä¸€èˆ¬ä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®.__

> å¦å¤–å‡ ç§å’ŒéŸ³é¢‘APPå…³ç³»ä¸å¤§ï¼Œä¸€èˆ¬æˆ‘ä»¬åªéœ€è¦å…³æ³¨VoIPæˆ–è€…è§†é¢‘é€šè¯å³å¯ã€‚


é€šè¿‡è°ƒç”¨ï¼š

``` objc
- (BOOL)setMode:(NSString *)mode error:(NSError **)outError;
```

å¯ä»¥åœ¨è®¾ç½®`Category`ä¹‹åå†è®¾ç½®æ¨¡å¼ã€‚

å½“ç„¶ï¼Œè¿™äº›æ¨¡å¼åªæ˜¯`CoreAduio`æ€»ç»“çš„ï¼Œä¸ä¸€å®šå®Œå…¨æ»¡è¶³è¦æ±‚ï¼Œå¯¹äºå…·ä½“çš„æ¨¡å¼ï¼Œåœ¨`iOS10`ä¸­è¿˜æ˜¯å¯ä»¥å¾®è°ƒçš„ã€‚  

é€šè¿‡æ¥å£:  

``` objc

- (BOOL)setCategory:(NSString *)category mode:(NSString *)mode options:(AVAudioSessionCategoryOptions)options error:(NSError **)outError;

```

ä½†æ˜¯åœ¨`iOS9`åŠä»¥ä¸‹å°±åªèƒ½åœ¨`Category`ä¸Šè°ƒäº†ï¼Œå…¶å®æœ¬è´¨æ˜¯ä¸€æ ·çš„ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ä¸ªAPIè¯­æ³•ç³–ï¼Œæ¥å£å°è£….

### ç³»ç»Ÿä¸­æ–­å“åº”

ä¸Šé¢è¯´çš„è¿™äº›`Categorg`ã€`Option`ä»¥åŠ`Mode`éƒ½æ˜¯å¯¹è‡ªå·±ä½œä¸ºæ’­æ”¾ä¸»ä½“æ—¶çš„è¡¨ç°ï¼Œä½†æ˜¯å‡è®¾ï¼Œç°åœ¨æ­£åœ¨æ’­æ”¾ç€ï¼Œçªç„¶æ¥ç”µè¯äº†ã€é—¹é’Ÿå“äº†æˆ–è€…ä½ åœ¨åå°æ”¾æ­Œä½†æ˜¯ç”¨æˆ·å¯åŠ¨å…¶ä»–Appç”¨ä¸Šé¢çš„æ–¹æ³•å½±å“çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„Appè¯¥å¦‚ä½•è¡¨ç°å‘¢ï¼Ÿæœ€å¸¸ç”¨çš„åœºæ™¯å½“ç„¶æ˜¯å…ˆæš‚åœï¼Œå¾…æ¢å¤çš„æ—¶å€™å†ç»§ç»­ã€‚é‚£æˆ‘ä»¬çš„Appè¦å¦‚ä½•æ„ŸçŸ¥åˆ°è¿™ä¸ªç»ˆç«¯ä»¥åŠä½•æ—¶æ¢å¤å‘¢ï¼Ÿ

`AVAudioSession`æä¾›äº†å¤šç§`Notifications`æ¥è¿›è¡Œæ­¤ç±»çŠ¶å†µçš„é€šçŸ¥ã€‚å…¶ä¸­å°†æ¥ç”µè¯ã€é—¹é“ƒå“ç­‰éƒ½å½’ç»“ä¸ºä¸€èˆ¬æ€§çš„ä¸­æ–­

ç”¨`AVAudioSessionInterruptionNotification`æ¥é€šçŸ¥ã€‚å…¶å›è°ƒå›æ¥çš„`userInfo`ä¸»è¦åŒ…å«ä¸¤ä¸ªé”®ï¼š

* _`AVAudioSessionInterruptionTypeKey`ï¼š å–å€¼ä¸º`AVAudioSessionInterruptionTypeBegan`è¡¨ç¤ºä¸­æ–­å¼€å§‹ï¼Œæˆ‘ä»¬åº”è¯¥æš‚åœæ’­æ”¾å’Œé‡‡é›†ï¼Œå–å€¼ä¸º`AVAudioSessionInterruptionTypeEnded`è¡¨ç¤ºä¸­æ–­ç»“æŸï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­æ’­æ”¾å’Œé‡‡é›†ã€‚_

* _`AVAudioSessionInterruptionOptionKey`ï¼š å½“å‰åªæœ‰ä¸€ç§å€¼`AVAudioSessionInterruptionOptionShouldResume`è¡¨ç¤ºæ­¤æ—¶ä¹Ÿåº”è¯¥æ¢å¤ç»§ç»­æ’­æ”¾å’Œé‡‡é›†ã€‚_

__è€Œå°†å…¶ä»–`App`å æ®`AudioSession`çš„æ—¶å€™ç”¨`AVAudioSessionSilenceSecondaryAudioHintNotification`æ¥è¿›è¡Œé€šçŸ¥ã€‚å…¶å›è°ƒå›æ¥çš„__`userInfo`é”®ä¸º:

``` objc
AVAudioSessionSilenceSecondaryAudioHintTypeKey
```

å¯èƒ½åŒ…å«çš„å€¼:

* `AVAudioSessionSilenceSecondaryAudioHintTypeBegin`ï¼š è¡¨ç¤ºå…¶ä»–`App`å¼€å§‹å æ®`Session`.

* `AVAudioSessionSilenceSecondaryAudioHintTypeEnd`: è¡¨ç¤ºå…¶ä»–`App`å¼€å§‹é‡Šæ”¾`Session`.


### å¤–è®¾æ”¹å˜

é™¤äº†å…¶ä»–`App`å’Œç³»ç»ŸæœåŠ¡ï¼Œä¼šå¯¹æˆ‘ä»¬çš„`App`äº§ç”Ÿå½±å“ä»¥å¤–ï¼Œç”¨æˆ·çš„æ‰‹ä¹Ÿä¼šå¯¹æˆ‘ä»¬äº§ç”Ÿå½±å“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ`AudioSession`ä¼šåœ¨`App`å¯åŠ¨æ—¶é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„è¾“å‡ºæ–¹æ¡ˆï¼Œæ¯”å¦‚æ’å…¥è€³æœºçš„æ—¶å€™ï¼Œå°±ç”¨è€³æœºã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·å¯èƒ½æ‹”å‡ºè€³æœºï¼Œæˆ‘ä»¬Appè¦å¦‚ä½•æ„ŸçŸ¥è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿ


åŒæ ·`AVAudioSession`ä¹Ÿæ˜¯é€šè¿‡`Notifications`æ¥è¿›è¡Œæ­¤ç±»çŠ¶å†µçš„é€šçŸ¥ã€‚

å‡è®¾æœ‰è¿™æ ·çš„App
![](/assets/images/20180112AVAudioSessionCategory/RouteChange.webp)

æœ€å¼€å§‹åœ¨å½•éŸ³æ—¶ï¼Œç”¨æˆ·æ’å…¥å’Œæ‹”å‡ºè€³æœºæˆ‘ä»¬éƒ½åœæ­¢å½•éŸ³ï¼Œè¿™é‡Œé€šè¿‡`Notification`æ¥é€šçŸ¥æœ‰æ–°è®¾å¤‡äº†ï¼Œæˆ–è€…è®¾å¤‡è¢«é€€å‡ºäº†ï¼Œç„¶åæˆ‘ä»¬æ§åˆ¶åœæ­¢å½•éŸ³ã€‚æˆ–è€…åœ¨æ’­æ”¾æ—¶ï¼Œå½“è€³æœºè¢«æ‹”å‡ºå‡ºæ—¶ï¼Œ`Notification`ç»™äº†é€šçŸ¥ï¼Œæˆ‘ä»¬å…ˆæš‚åœéŸ³ä¹æ’­æ”¾ï¼Œå¾…è€³æœºæ’å›æ—¶ï¼Œåœ¨ç»§ç»­æ’­æ”¾ã€‚

åœ¨`NSNotificationCenter`ä¸­å¯¹`AVAudioSessionRouteChangeNotification`è¿›è¡Œæ³¨å†Œã€‚åœ¨å…¶`userInfo`ä¸­æœ‰é”®ï¼š

* `AVAudioSessionRouteChangeReasonKey` : è¡¨ç¤ºæ”¹å˜çš„åŸå› 
* `AVAudioSessionSilenceSecondaryAudioHintTypeKey`ï¼š å’Œä¸Šé¢çš„ä¸­æ–­æ„ä¹‰æ„ä¹‰ä¸€æ ·ã€‚


| æšä¸¾å€¼ | æ„ä¹‰ |
| :------ | :------: | 
| AVAudioSessionRouteChangeReasonUnknown  | æœªçŸ¥åŸå›  |
| AVAudioSessionRouteChangeReasonNewDeviceAvailable  | æœ‰æ–°è®¾å¤‡å¯ç”¨ |
| AVAudioSessionRouteChangeReasonOldDeviceUnavailable  | è€è®¾å¤‡ä¸å¯ç”¨ |
| AVAudioSessionRouteChangeReasonCategoryChange  | ç±»åˆ«æ”¹å˜äº† |
| AVAudioSessionRouteChangeReasonOverride  | Appé‡ç½®äº†è¾“å‡ºè®¾ç½® |
| AVAudioSessionRouteChangeReasonWakeFromSleep  | ä»ç¡çœ çŠ¶æ€å‘¼é†’ |
| AVAudioSessionRouteChangeReasonNoSuitableRouteForCategory  | å½“å‰Categoryä¸‹æ²¡æœ‰åˆé€‚çš„è®¾å¤‡ |
| AVAudioSessionRouteChangeReasonRouteConfigurationChange  | Rotuerçš„é…ç½®æ”¹å˜äº† |


# æ€»ç»“

`AVAudioSession`æ„å»ºäº†ä¸€ä¸ªéŸ³é¢‘ä½¿ç”¨ç”Ÿå‘½å‘¨æœŸçš„ä¸Šä¸‹æ–‡ã€‚å½“å‰çŠ¶æ€æ˜¯å¦å¯ä»¥å½•éŸ³ã€å¯¹å…¶ä»–Appæœ‰æ€æ ·çš„å½±å“ã€æ˜¯å¦å“åº”ç³»ç»Ÿçš„é™éŸ³é”®ã€å¦‚ä½•æ„ŸçŸ¥æ¥ç”µè¯äº†ç­‰éƒ½å¯ä»¥é€šè¿‡å®ƒæ¥å®ç°ã€‚å°¤ä¸ºé‡è¦çš„æ˜¯`AVAudioSession`ä¸ä»…å¯ä»¥å’Œ`AVFoundation`ä¸­çš„`AVAudioPlyaer`/`AVAudioRecorder`é…åˆï¼Œå…¶ä»–å½•éŸ³/æ’­æ”¾å·¥å…·æ¯”å¦‚`AudioUnit`ã€`AudioQueueService`ä¹Ÿéƒ½éœ€è¦ä»–è¿›è¡Œå½•éŸ³ã€é™éŸ³ç­‰ä¸Šä¸‹æ–‡é…åˆã€‚


[å‚è€ƒ](https://www.jianshu.com/p/3e0a399380df)  
[å‚è€ƒ2](http://cinvoke.me/?p=37)

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/12/FinalSummary/index.html.md
Published At: 2017-12-31 10:46:20 +0000

# 2017å¹´ç»ˆæ€»ç»“

![](/assets/images/20171230FinalSummary/2017FinalSummart1.webp)

# å‰è¨€

**æ—¶é—´åƒè½¦è½®ä¸€æ ·åœ¨é£è½¬**  
**å†å²åƒæ±Ÿæ²³ä¸€æ ·åœ¨æµæ·Œ**  
**æ•´æ•´èµ°è¿‡äº†365ä¸ªé£é›¨å†ç¨‹**    
**2017å¹´è¿‡çš„å¦‚æ­¤ä¸å¯»å¸¸**  
**ä¸€åº¦æ˜¥å¤ç§‹å†¬ ä¸€åº¦é›¨é›ªé£éœœ**  
**ä¸€åº¦ç¿»å±±è¶Šå²­ ä¸€åº¦èµ·ä¼å»¶å®•**  


åˆä¸€å¹´è¿‡å»äº†,æˆ‘ä¹Ÿå¾—å¢¨å®ˆæˆè§„çš„æŒ‰æ—¶äº¤å‡ºæˆ‘çš„å¹´ç»ˆæ€»ç»“äº†,ä¸ºäº†ä¸æ ‡æ–°ç«‹å¼‚,æˆ‘å¿…é¡»å°½é‡ä¸åºŸè¯.(**talk is cheap, show me the code!**)


## 2017å›é¡¾

è¿™ä¸€å¹´çš„é‡ç‚¹äº‹ä»¶ä¸»è¦å¦‚ä¸‹:

* æŠ€æœ¯
* ä¹°æˆ¿
* å·¥ä½œ
* ä¹¦æ³• 
* è¯»ä¹¦
* è¿åŠ¨
* é©¾ç…§

### æŠ€æœ¯

è¿™ä¸€å¹´è®©æˆ‘å”¯ä¸€æœ‰äº›è®¸æˆå°±æ„Ÿçš„äº‹æƒ…è«è¿‡äºæˆ‘æ­å»ºäº†è‡ªå·±çš„æŠ€æœ¯åšå®¢,èƒ½åœ¨è¿™é‡Œè®°å½•æˆ‘çš„æŠ€æœ¯æˆé•¿å’Œç”Ÿæ´»ä¸­çš„ç‚¹ç‚¹æ»´æ»´.

ä»å¹´åˆæˆ‘æ­å»ºåšå®¢å¼€å§‹è‡³ä»Šå·²å‘è¡¨æ•´æ•´45ç¯‡.

![blog](/assets/images/20171230FinalSummary/2017FinalSummaryBlog1.webp)

æ­£å¦‚æˆ‘çš„**å…³äº**é¡µé¢è¯´çš„,æˆ‘å¹¶æ²¡æœ‰å¯¹å®ƒçš„å“è´¨å¤ªè¿‡äºè‹›æ±‚,å°½é‡è®°å½•ä¸€ä¸‹å®¹æ˜“å¿˜è®°çš„æŠ€æœ¯å’Œç”Ÿæ´»ç»éªŒ. è™½ç„¶å¤§å®¶çœ‹åˆ°è¿™äº›å¹¶æ²¡æœ‰å¤ªè¿‡ç•™æ„,ä½†æˆ‘è‡ªå·±ç¡®è§‰å¾—å¦‚æ•°å®¶ç,æ¯•ç«Ÿè¿™æ˜¯ä¸€ç¬”è´¢å¯Œ.å½“æˆ‘å‡ å¹´åä¼šçœ‹è¿™ç¯‡å¹´ç»ˆæ€»ç»“çš„æ—¶å€™,å¸Œæœ›è‡ªå·±**æ²¡æœ‰å› ä¸ºè™šåº¦å¹´åè€Œæ‚”æ¨,ä¹Ÿæ²¡æœ‰å› ä¸ºç¢Œç¢Œæ— ä¸ºè€Œç¾è€»**.

![](/assets/images/20171230FinalSummary/2017FinalSummaryBlog2.webp)

æˆ‘æ˜¯ä¸€ä¸ªä¸å–œæ¬¢ç©å„ç§æ¸¸æˆçš„90å,æ¯å¤©çœ‹ç€ç»Ÿè®¡åå°æ‰æ‰¾å›ä¸€ç‚¹å¹²æ´»çš„å¿ƒæƒ….

ä»Šå¹´çš„æŠ€æœ¯å¤šæ•°é›†ä¸­åœ¨å¤šåª’ä½“ä¸Š,æ¯å¤©å’ŒéŸ³è§†é¢‘æ–—æ™ºæ–—å‹‡.ä»Šå¹´çš„å‰åŠéƒ¨åˆ†åœ¨å¼€å‘TCPçš„èŠå¤©åº”ç”¨å«`ç™¾åº¦Hi for mac`. å½“ç„¶å‚é•¿[Robin(æå½¦å®)](https://baike.baidu.com/item/%E6%9D%8E%E5%BD%A6%E5%AE%8F/125160?fr=aladdin))ä¹Ÿåœ¨ç”¨. *å¯¹äºè¿™ä¸ªæ»¡è„‘å­äººå·¥æ™ºèƒ½ä¸€é—¨å¿ƒæ€ç ”ç©¶æ— äººé©¾é©¶æ¯æ¬¡äº§å“éƒ½è½åœ°çš„ä¸å’‹åœ°æ•´æ•´æ ¸å¿ƒæŠ€æœ¯äººå‘˜æ€»ç•™ä¸ä½çš„å‚é•¿,æˆ‘é€’è¿‡å»äº†æˆ‘çš„è¾èŒç”³è¯·*.ä»Šå¹´ä¸‹åŠå¹´åœ¨å…¨åŠ›ç ”ç©¶å¤šåª’ä½“çŸ­è§†é¢‘ç›¸å…³çš„å¼€å‘,`Open GL`,`GPUImage`,`AV Foundation`...... å­å“§å­å“§(kengchi ä¸€å£°). ç›´åˆ°å†™åšå®¢ç°åœ¨ä¸ºæ­¢,æ‰åˆšåˆšç ”ç©¶å®Œ`AV Foundation`æœ€åä¸€é¡µ. æäº†å¾ˆä¹…æŠ€æœ¯æ·±æ„Ÿåœ¨æŸäº›é¢†åŸŸéœ€è¦æ·±è€•,ä¸èƒ½ç›²ç›®çš„è·Ÿé£,è¿˜å¾—è„šè¸å®åœ°.

28å²,90å.è¿™ä¸€å¹´æ„Ÿè§‰æŠ€æœ¯ä¸Šæ²¡æœ‰å•¥æˆå°±æ„Ÿ,åˆ°æœ‰å¦‚ä¸‹æ„Ÿæ…¨:
> ä¹Ÿè®¸å¤§ç¥éƒ½æ˜¯å‘½ä¸­æ³¨å®šçš„,è€Œæˆ‘å¾ˆä¸å¹¸,æ²¡æœ‰è¢«æ³¨å®š.

---


### ä¹°æˆ¿

è¿™æ˜¯æˆ‘2017å¹´ç»å†è¿‡æœ€å§‹æ–™æœªåŠçš„ä¸€ä¸ªå¤§äº‹ä»¶.


#### çœ‹æˆ¿

è¿™äº‹å¾—ä»2016çš„åä¸€é•¿å‡è¯´èµ·, æˆ‘å›å“ˆå°”æ»¨çœ‹æˆ¿

ä»å“ˆå°”æ»¨ä¸‡è¾¾å¹¿åœºæ²¿ç€ å“ˆå°”æ»¨å¤§è¡— æ­¥è¡Œ, åˆ°ç¾¤åŠ› åˆæ­¥è¡Œå›æ¥.è·Ÿæˆ‘ä¸€ä¸ªæ¯”è¾ƒè¦å¥½çš„é«˜ä¸­å®¤å‹.

å¤§æ¦‚çš„è·¯çº¿æ˜¯è¿™æ ·çš„:

![çœ‹æˆ¿](/assets/images/20171230FinalSummary/2017FinalSummaryFindHouse.webp)


æ®æˆ‘åæ¥ç»Ÿè®¡ æ¯å¤©è‡³å°‘æ­¥è¡Œ18å…¬é‡Œä»¥ä¸Š. 

äºæ˜¯æˆ‘å¾—å‡ºçœ‹æˆ¿çš„ç»éªŒåˆ—è¡¨:

| åŒºåŸŸ | æˆ¿ä»· | æˆ¿å±‹ç±»å‹ | è£…ä¿®ç±»å‹ | å‘å±•æ½œåŠ› | æ¨èçœ‹æˆ¿è£…å¤‡ |
| :------: | :------: |  :------: | :------: | :------: | :------: |
| å“ˆè¥¿ | å‡ä»·8k~1w | æœŸæˆ¿å¤š/ç°æˆ¿å°‘ | æ¯›å¯å¤š/ç²¾/ç®€è£…å°‘ | é«˜é“/å­¦åŒº/å•†åœˆ/åœ°é“ | ç”µåŠ¨è½¦+è·‘é‹ |
| ç¾¤åŠ› | å‡ä»·6k~9k | æœŸæˆ¿å°‘/ç°æˆ¿å°‘ | æ¯›å¯ | å‘¨è¾¹å•¥ä¹Ÿæ²¡æœ‰(å…³ä¸œå¤å··/æ¾èŠ±æ±Ÿ) | ç”µåŠ¨è½¦+è·‘é‹ |
| å…¶å®ƒ | N/A | N/A | äºŒæ‰‹å±…å¤š | å‘¨è¾¹é…å¥—æ²¡è°ƒç ” | ç”µåŠ¨è½¦+è·‘é‹ |
 

> æ³¨æ„:*ä¸ºå•¥æˆ‘æ¨èçš„æ˜¯ç”µåŠ¨è½¦+è·‘é‹,å› ä¸ºæˆ‘çœ‹æˆ¿æ—¶å‘ç°æœ‰çš„åŒºåŸŸè·¨åº¦å¤ªå¤§,éœ€è¦è½¦æœ€å¥½,æœ‰çš„åŒºåŸŸè·¨åº¦å°æœ‰è½¦æ²¡åœ°æ–¹åœ,å°¤å…¶æ˜¯ä¸€äº›è¿˜æ²¡å»ºæˆçš„åœ°å—,ä½ å»äº†æ¼«å¤©æ¼‚ç°,æ³¥æ³ä¸å ª,ä½ å¼€è½¦ä¸æ˜¯åˆ·è½¦å°±æ˜¯éº»çƒ¦è€½è¯¯æ—¶é—´,è½¦é€Ÿå¤ªå¿«ä½ çœ‹ä¸æ¸…æ¥šå“ªæ˜¯å“ª,èµ°èµ°åœåœè½¦æˆ‘è®¤ä¸ºä¸æ–¹ä¾¿,æ‘©æ‰˜è½¦å¤ªå¤§ä¸€èˆ¬,åªæœ‰ç”µåŠ¨è½¦æœ€åˆé€‚,ä¸€ä¸ªéª‘è½¦ä¸€ä¸ªçœ‹,å“ªé‡Œä¸æ¸…æ¥šçœ‹å“ª.ä½†éœ€è¦ä¸€ä¸ªç»­èˆªé‡Œç¨‹é«˜ç‚¹çš„ç”µåŠ¨è½¦.è¿˜æœ‰è·‘é‹,çœ‹æˆ¿å¿…é¡»å¾—èµ°,ä¸Šæ¥¼ä¸‹æ¥¼,è¿™ä¸ªå•å…ƒé‚£ä¸ªå°åŒºçš„.æ²¡æœ‰ä¸€åŒèˆ’æœçš„é‹èµ°ä¸€ä¸Šåˆå°±çŸ¥é“å•¥æ»‹å‘³äº†.*


å¯æƒœæˆ‘æ²¡è½¦,åªæœ‰ä¸€åŒè…¿å’Œä¸€åŒ`new balance`è·‘é‹,æ¯å¤©èµ°ä¸Š18å…¬é‡Œ,å¯èƒ½æ˜¯é‹å«å¤ªèˆ’æœäº†,è„šéƒ½ç£¨çº¢äº†éƒ½æ²¡èµ·æ³¡,æˆ‘è¿˜æš—è‡ªæ…¨å¹æˆ‘è‡ªå·±å¤šé«˜æ˜å¾—å›æ²¡ç©¿åˆ«çš„é‹,å¯æ˜¯æ²¡å½“æˆ‘é«˜å…´ä¸€ä¼šå„¿å°±å‘ç°,é‹å«å¿«ç£¨ç¢äº†. æ‰€ä»¥å»ºè®®å¤§å®¶çœ‹æˆ¿è¦ `ç®¡ä½å˜´`,`å¸¦å¤Ÿæ°´`,`è¿ˆå¼€è…¿`,åˆ«åƒå¤ªé¥±äº†.

| æˆ‘çœ‹è¿‡çš„æˆ¿åœ°äº§ | æ¨èæ„è§å’Œç»“è®º |
| :------: | :------: |
| æœ‰ä¸ªå«ä»€ä¹ˆçº¢æ˜ŸåŸ | çº¯æ‰¯æ·¡æµªè´¹æ—¶é—´ ä¸æ¨è |
| ä¸œæ–¹æ–°å¤©åœ° | ç¼ºé’±çš„å¯ä»¥è€ƒè™‘,æ®è¯´æ˜¯æˆ¿æœ¬ä¸‹æ¥å¾ˆè´¹åŠ² |
| æ’å¤§çºåº­ | æˆ¿å±‹æœå‘è®©æˆ‘è§‰å¾—éš¾å—,ç®€è£…,æ€•è´¹äº‹çš„å¯ä»¥è€ƒè™‘,æ‹åŒ…å…¥ä½å¤§å¼€å‘æ¯”è¾ƒé è°±|
| é‡‘çˆµä¸‡è±¡ | è²Œä¼¼åœ¨æ–°å¤©åœ°ä¸œè¾¹,å¢™çš®å­ç›´æ‰ä¸æ•¢ä¹°,ä¸æ¨è |
| è¾°èƒ½æºªæ ‘åº­é™¢ | ç²¾è£…,æ¨è,å°±æ˜¯è´µ,ä¼°è®¡éƒ½æ²¡æœ‰äº† |
| åŒ—çº¬45åº¦ | å°±å‰©å…¬å¯“äº†,æ²¡ä½å®…äº†,ä¹°ä¸äº†äº† |
| å›è´µä¸œæ–¹ç‘æ™¯ | å”®æ¥¼å‘˜æŒºäºŒ,æ¸…åå¤§è¡—å—åŒ—è¿˜æ˜¯åŸä¸­æ‘,ä¸€èˆ¬,ä»·æ ¼æ­»è´µè¿˜æ²¡å•¥äº®ç‚¹ |
| æ¼«æ­¥å·´é» | æ²¡æˆ¿äº†,å‰©ä¸‹çš„éƒ½ä¸å’‹å¥½,æˆ¿å±‹å¤ªå¤§,å†…å®¤å¾ˆä¸é€‚åˆæˆ‘ä»¬ä¸œåŒ—äººçš„ä¹ æƒ¯,ä¸€èˆ¬ |
| ç™¾å¹´ä¿ªæ™¯ | æ²¡æˆ¿, ä»·æ ¼ä¸€èˆ¬,æˆ¿å±‹æ ¼å±€è¿˜è¡Œ,å–œæ¬¢å®‰é™çš„å¯ä»¥è€ƒè™‘,ä»·æ ¼ç¨è´µ| 
| è§‚æ±Ÿå›½é™… | æ˜¯æˆ‘è§è¿‡ç¾¤åŠ›æœ€è´µçš„äº†å½“æ—¶1.5w ä¸è¿‡æ²¡å•¥å¥½æˆ¿å­äº†,ä¸å·®é’±æ¨è|
| å…¶å®ƒ | åŸºæœ¬æ²¡æœ‰å¥½çš„,æ¿æ¥¼åŸºæœ¬éƒ½æ˜¯æœŸæˆ¿è¿˜æ²¡æœ‰,é«˜å±‚ä¸æ˜¯æ—¶é—´é•¿å°±å„ç§ä¸é è°±|

ä¸Šè¿°è¿™äº›åªä»£è¡¨æˆ‘ä¸ªäººçœ‹æ³•.


æ—¶é—´åˆ°è¾¾2017å¹´1æœˆä»½,è¿‡å¹´å›å®¶

æˆ‘è¶è¿™ä¸ªæ—¶é—´ç‚¹åˆå»äº†å‡ å®¶,å‘ç°

æˆ¿ä»· ä»`8`åƒæ¶¨åˆ°`1w`,æ’å¤§çºåº­æœ€ä¸ºæ˜æ˜¾.åä¸€çš„æ—¶å€™è¿˜æœ‰äº›å¥½çš„æˆ·å‹,åä¸€ä»¥ååŸºæœ¬ç»è¿¹.å‰©ä¸‹ä¸€å †ç ´æˆ·å‹,è¦ä¸æŒ¡å…‰è¦ä¹ˆæˆ¿å±‹å¸ƒå±€ç‹­çª„.

#### å“ˆå°”æ»¨æˆ·å£å’ŒåŒ—äº¬å…¬ç§¯é‡‘

æˆ‘æ˜¯ä¸ªåŒ—æ¼‚çš„ç å†œå¤§å­¦æ¯•ä¸šç›´æ¥å»äº†åŒ—äº¬. æˆ·å£è¿˜ä¸å±äºå“ˆå°”æ»¨å¸‚.
æ®æˆ‘è·‘å®Œå¤§éƒ¨åˆ†çš„å”®æ¥¼å¤„å,æ‰“å¬çš„å…¬ç§¯é‡‘ä½¿ç”¨æ–¹å¼,

1. åŒ—äº¬çš„å…¬ç§¯é‡‘å¦‚æœæƒ³åœ¨å“ˆå°”æ»¨å¸‚ç”¨å¿…é¡»æ˜¯å“ˆå°”æ»¨å¸‚æˆ·å£æ‰èƒ½ç”¨.
2. æƒ³åŠç†å“ˆå°”æ»¨å¸‚æˆ·å£å¿…é¡»å¾—ä¹°æˆ¿,æˆ–è€…å•ä½æ¥æ”¶ç­‰é›†ä½“æˆ·å£.
3. æƒ³åœ¨`å“ˆå°”æ»¨`ä¹°æˆ¿ç”¨`åŒ—äº¬å…¬ç§¯é‡‘`å¿…é¡»å¾—æ˜¯**å“ˆå°”æ»¨å¸‚æˆ·å£**,åˆ«çš„åœ°æ–¹ç”¨ä¸äº†.


å†™åˆ°è¿™é‡Œæˆ‘çœŸçš„æƒ³éª‚å¨˜äº†,ä½†ä¸ºäº†ä¿æŒå„’å£«çš„é£èŒƒæˆ‘è¿˜æ˜¯å¿äº†,æˆ‘ä¸å¾—ä¸è¯´,è¿™æ˜¯ä¸ª__é¸¡ç”Ÿè›‹__,__è›‹ç”Ÿé¸¡__çš„é—®é¢˜.

å¦‚æœè¯´å†œæ‘æˆ·å£æƒ³æˆä¸ºå“ˆå°”æ»¨å¸‚å¸‚æ°‘æ˜¯å› ä¸ºæˆ‘ä»¬å†œæ‘äººæ¯ä¸ªäººåˆ†å—åœ°çš„è¯,é‚£æˆ‘è¯·æ”¿åºœæ”¶å›æˆ‘çš„åœŸåœ°,æŠŠæˆ‘æˆ·å£æ”¹æˆå“ˆå°”æ»¨å¸‚æˆ·å£.é‚£å—ç ´åœŸåœ°å¦‚æœèƒ½å‘å®¶è‡´å¯Œæˆ‘åˆä½•å¿…èƒŒäº•ç¦»ä¹¡å»åŒ—æ¼‚.


#### è¿‡å¹´ç­¹åˆ’ä¹°æˆ¿

![](/assets/images/20171230FinalSummary/HaerbinFuture.webp)

[åŸå›¾æ¸…æ™°](/assets/images/20171230FinalSummary/HaerbinFutureBig.webp)

å›å®¶è¿‡å¹´,è¿™å¹´è¿‡å¾—æˆ‘å¿ƒæƒ…éƒ½ä¸åœ¨å¹´ä¸Š,å¿ƒæƒ…å¾ˆçŸ›ç›¾,è¿‡äº†åˆä¸ƒå°±ä¸Šç­å›åŒ—äº¬äº†.æˆ‘çš„å®¶åœ¨ç»¥åŒ–å¸‚æµ·ä¼¦å¸‚.

å›åŒ—äº¬çš„ä¸¤ä¸ªæœˆæ—¶é—´é‡Œ,æ ¹æœ¬éƒ½æ²¡æœ‰ä»€ä¹ˆå¹²æ´»çš„åŠ²å¤´,äºæ˜¯æˆ‘å°±ç»™çˆ¶æ¯æ‰“ç”µè¯

æˆ‘è¯´äº†è‡³ä»Šä¸ºæ­¢æœ€å…·æ·åœ°æœ‰å£°çš„è¯.

æˆ‘åœ¨ç”µè¯ä¸­å¯¹çˆ¶æ¯è¯´:"æˆ‘åœ¨åŒ—äº¬,è·ç¦»å“ˆå°”æ»¨1200å¤šå…¬é‡Œ,ä½ ä»¬è¯´æˆ‘æ˜¯åƒé‡Œå¥”æ³¢å»çœ‹æˆ¿,è¿˜æ˜¯ä½ ä»¬å»å‘¢,æˆ‘å‘¨æœ«å°±ä¸¤å¤©å‡,å»äº†å›æ¥æœ€å¤šä¹Ÿå°±èƒ½çœ‹ä¸ŠåŠå¤©,ä½ ä»¬åœ¨å®¶æ²¡å•¥äº‹è·ç¦»å“ˆå°”æ»¨é‚£ä¹ˆè¿‘ä¸ºå•¥ä¸å»å¸®æˆ‘å»çœ‹çœ‹æˆ¿å‘¢."(çˆ¶æ¯æ¯å¹´éƒ½å»å¤–é¢æ‰“å·¥)

> çˆ¶æ¯ç¡®å®å¬äº†è¿™ä¸€ç•ªè¯,ä¹Ÿéƒ½æ„ŸåŒèº«å—

äºæ˜¯ä¿©äººè¡ŒåŠ¨äº†èµ·æ¥, ä¸€å‘¨è·‘äº†ä¸¤è¶Ÿå“ˆå°”æ»¨.ç”±äºå“ˆå°”æ»¨ä¹Ÿæ²¡å•¥äº²æˆšåªèƒ½å»äº† å›æµ·ä¼¦,å»äº†å›æµ·ä¼¦.

æˆ‘çš„ä¸€ç•ªè¯èµ·äº†å†³å®šæ€§ä½œç”¨, è¿™ä¿©äººåœ¨å‘¨äº”æ‰“ç”µè¯å‘Šè¯‰æˆ‘,ä»–ä»¬çœ‹ä¸­äº†çˆ±è¾¾88.å›æ¥å§ï¼

#### __å¤©æ—¶__ __åœ°åˆ©__ __äººå’Œ__

ä¹°æˆ¿ç»å¯¹æ˜¯ä¸€ä»¶`å¤©æ—¶`,`åœ°åˆ©`,`äººå’Œ`çš„äº‹æƒ….

æˆ‘çˆ¶æ¯å¸®æˆ‘çœ‹æˆ¿è¿™ä¸€å‘¨,æˆ‘åŸºæœ¬ä¹Ÿæ²¡å¿ƒæƒ…å¹²æ´»,æˆ‘çš„è€å¤§(ç»ç†)çœ‹æˆ‘çš„å¿ƒæƒ…æˆ‘éƒ½èƒ½çŒœåˆ°äº†,æœ€åä»–ç»™äº†æˆ‘ä¸€å‘¨å‡,å›å®¶ä¹°æˆ¿.

å› ä¸ºè¿™ä¸€å‘¨æˆ‘åœ¨åŠç†å„ç§é“¶è¡Œçš„ æ”¶å…¥è¯æ˜,é“¶è¡Œæµæ°´çš„æ‰“å°è´·æ¬¾å“ˆå°”æ»¨å„ç§é“¶è¡Œçš„æ¨¡æ¿,å…¬ç§¯é‡‘ç­‰

åŒ—äº¬çš„å…¬ç§¯é‡‘å¦‚æœæƒ³æ‹¿å‡ºæ¥å½“é¦–ä»˜,å¿…é¡»é€€å‡ºåŒ—äº¬å¸‚å…¬ç§¯é‡‘.ç›¸å½“äºç¦»å¼€åŒ—äº¬.
è¯´ç™½äº†å°±æ˜¯å¾—ç¦»èŒ.

è¿™æ®µç»å†è®©æˆ‘è‡³ä»Šéš¾å¿˜,å½“æ—¶çš„çœŸæ˜¯è¿›é€€ç»´è°·.

#### åé£æœºå›å®¶ä¹°æˆ¿

2017å¹´çš„3æœˆæŸæ—¥å‡Œæ™¨5ç‚¹,å‘¨å…­ å¤©æ°”:__è½»åº¦é›¾éœ¾__,åœ°ç‚¹:å»å¾€åŒ—äº¬é¦–éƒ½å›½é™…æœºåœºT2èˆªç«™æ¥¼çš„è·¯ä¸Š

å‰å¤©æ™šä¸Šé¢„çº¦çš„æ»´æ»´ä¸“è½¦æ—©å·²åœ¨æ¥¼ä¸‹ç­‰å€™,æˆ‘å’Œ`æˆ‘å®¶é‚£ä½`åœ¨æœ€åä¸€éç¡®è®¤ æˆ·å£æœ¬ã€èº«ä»½è¯ã€å…¬å¸äººåŠ›èµ„æºéƒ¨ç­¾å‘çš„å„ç§é“¶è¡Œçš„æ”¶å…¥è¯æ˜ã€å„ç§é“¶è¡Œå¡ã€é“¶è¡Œæµæ°´å•...... ç¡®è®¤å®Œæ¯• å‡ºå‘.

è·¯ä¸Šå¸æœºæ˜¯ä¸ªè¯å”   

å¸æœºè¯´:"è¿™æ˜¯å»å“ª!"  
æˆ‘è¯´:"å›å®¶çœ‹çœ‹æˆ¿"

...

å¸æœºè¯´:"æˆ‘ä»¬åŒ—äº¬æ”¿åºœç»™æˆ‘ä»¬åˆ†çš„æˆ¿å­ ä¸€å¹³ æ‰3000å¤š,è·ç¦»åœ°é“ä¸ç®—å¤ªè¿œ"  
æˆ‘è¯´:"åŒ—äº¬äººçœŸå¥½...å›½å®¶éƒ½å¦‚æ­¤ç…§é¡¾"


...

å¸æœºè¯´:"å”‰ éƒ½æ˜¯è¿™äº›å¤–æ¥äººå£æŠŠè¿™æˆ¿ä»·æèµ·æ¥çš„,è¦ä¸æˆ‘ä»¬è¿˜èƒ½å†ä¾¿å®œç‚¹ï¼"  
æˆ‘è¯´:"...è¦å•¥è‡ªè¡Œè½¦çŸ¥è¶³å§!"


å¸æœºè¯´:"&%&*#$#&#$#^#$^!"

...

æˆ‘çœŸéƒ½æ‡’çš„å’Œä»–åå£æ°´.

> ç‰›é€¼å“„å“„çš„åŒ—äº¬äºº,ä½ è¦æ˜¯å»å“ˆå°”æ»¨ç§Ÿæˆ¿,åŒ—äº¬æˆ·å£,å“¥çš„æˆ¿å­å°±åŒå€ä»·æ ¼ç§Ÿä½ ,ä¸ä½å°±å›åŒ—äº¬,å†°åŸäººä¸å¤ªæ¬¢è¿ä½ è¿™ç§å¾—äº†ä¾¿å®œè¿˜ä¸çŸ¥è¶³çš„åŒ—äº¬åœŸè‘—


ç»ˆäºåˆ°æœºåœº,é›¾éœ¾è²Œä¼¼æ•£å»äº†ä¸å°‘.

ä¸œæ–¹èˆªç©ºçš„é£æœº æ—©å·²åœ¨åœæœºåªç­‰ç€å€¼æœº(å€¼æœºå°±æ˜¯ä½ é€‰å¥½ä½ çš„åº§ä½)æ£€ç¥¨äº†.

æ‰“å°å–ç¥¨...  

ç­‰äº†å¥½é•¿æ—¶é—´å‘ç°å»å¤ªæ—©äº†,ä¸å»å¤ªæ—©ä¹Ÿä¸è¡Œ,å°±åŒ—äº¬è¿™äº¤é€šè¿˜æ˜¯å®æ„¿æ—©å»ä¸‰ä¸ªå°æ—¶ä¹Ÿä¸èƒ½ç›¸ä¿¡taxi.åœ°é“ç»•é“å¥½è¿œ.

æˆ‘çœ‹é£æœºç¥¨ä¸Šè¾¹å†™ç€ 9:58åˆ†åˆ°å“ˆå°”æ»¨

...


æ£€ç¥¨...  
ç™»æœº...  

7:59

èµ·é£ (èµ·é£èµ·äº†åŠä¸ªå°æ—¶æˆ‘æœäº†,åˆ«å‘Šè¯‰ä½ è¦delayäº†,åç«è½¦æ€»æ™šç‚¹,åé£æœºè¿˜æ™šç‚¹æˆ‘ä¹Ÿæ˜¯é†‰äº†)

å½“é£æœºèµ·é£å¼€åˆ°åŒ—äº¬çš„ä¸Šç©º,æ—©å·²æ²¡äº†é›¾éœ¾,å‡ºç°åœ¨çœ¼å‰çš„æ˜¯`ç¥–å›½çš„ä¸‡é‡Œé•¿åŸ`(è¿™ä¸ªæ—¶å€™å¦‚æœèƒ½æ”¾ä¸Šä¸€é¦–ã€Šæˆ‘çš„ä¸­å›½å¿ƒã€‹ä½ æƒ³èµ·é‚£é¦–æ­Œè¯, é•¿æ±Ÿ...é•¿åŸ..),å¦‚æœè¯´å»è¿‡é•¿åŸè§‰å¾—å¾ˆæ²¡æ„æ€,é‚£ä¹ˆå½“ä½ åœ¨é£æœºä¸Šä¿¯è§†å®ƒçš„æ—¶å€™,æˆ‘è§‰å¾—ä½ ä¼šçœ‹åˆ°å¦ä¸€ç§å¿ƒæƒ…,é‚£æ„Ÿè§‰ç»å¯¹å‰æ‰€æœªæœ‰.æœ‰æœºä¼šå¤§å®¶å¯ä»¥è¯•è¯•,ä½†è¦åœ¨å¤©æ°”éå¸¸å¥½çš„æ—¶å€™,å¤ªé˜³åˆšä»ä¸œæ–¹å‡èµ·. åæ¥æˆ‘æ‰å‘ç°å¦‚æœä½ æ˜¯ä¸ªæµ·å½’çš„äººæ‰å½“ä½ çœ‹åˆ°ç¥–å›½çš„ä¸‡é‡Œé•¿åŸå¿ƒç†æ˜¯ä»€ä¹ˆæ»‹å‘³(ä½ çš„é£æœºè¦é™è½åœ¨ç¥–å›½çš„é¦–éƒ½å›½é™… æœºåœº,çœ‹ç€æ¢¦å¯å·²ä¹…çš„ä¸‡é‡Œé•¿åŸ).


> å½“æ—¶æˆ‘çš„ç›´è§‰å‘Šè¯‰æˆ‘,ä»Šå¤©æ˜¯ä¸ªå¥½å…†å¤´.ä¹°æˆ¿åº”è¯¥åæ‹¿ä¹ç¨³.

é£æœºç©¿è¶Šè¾½å®çš„ä¸Šç©º,çœ‹åˆ°ä¸€æ¶ `æ­¼-15`è²Œä¼¼æ˜¯æˆ˜æ–—æœº é£æœºè…¹éƒ¨å¸¦ç€ä¸€é¢—å¯¼å¼¹ ç›´çº¿å‘å—é£å»... ä¼°è®¡æ˜¯æ¯å¤©æ‰§è¡Œä»»åŠ¡,ç´§æ¥ç€ å°±æ˜¯ç™½é›ªçš‘çš‘çš„ å¹³åŸ å°½è§ˆæ— ä½™.

æˆ‘åˆ»æ„è§‚å¯Ÿè¿‡,è¿™é›ªçš„åšåº¦ ä»ç•¥è£¹åœ°è¡¨... é£è¿‡å‰æ—é€æ¸å¢åŠ é›ªçš„åšåº¦...åˆ°å“ˆå°”æ»¨ å¤ªåšäº†.

é£è¡Œä¹Ÿå°±ä¸€ä¸ªå°æ—¶...

å¦‚æœå“ˆå°”æ»¨æœºåœºæ˜¯æˆ‘è§è¿‡æœ€ç ´çš„æœºåœºé‚£åº”è¯¥æ˜¯æˆ‘è¯´é”™äº†,å¦‚æœæˆ‘è¯´ä½ çœ‹åˆ°ä¸€ç‰‡`è‹ç±³åœ°`è¿˜æœ‰ç¨è®¸`ç”µçº¿æ†å­`é£æœºè·‘é“çš„æ°´æ³¥åœ°ä¸Šéƒ½å†»æˆå†°äº† é’ä¸€å—ç´«ä¸€å—çš„ åœ°è¡¨ çœ‹æ¸…åè¿™æ˜¯é£æœºèµ·é™çš„è·‘é“ä½ ä¹Ÿè®¸ä¸ä¿¡,ä½†æ˜¯è¿™é£æœºå°±èƒ½åœ¨è¿™ç§æ¶åŠ£ç¯å¢ƒæ­£å¸¸èµ·é™. é™è½åŠä¸ªå°æ—¶,é£è¡Œå‘˜è¿™ä¸ªå±Œä¸ ä¸çŸ¥é“å¹²å•¥ é£è¡Œé€Ÿåº¦é™è½çš„æ—¶å€™æ…¢çš„å¯æ€œ,å“ˆå°”æ»¨å‘¨è¾¹çš„æ‘åº„å±¯å­ çœ‹çš„ä¸€æ¸…äºŒæ¥š,å“å‘€,å½“æ—¶é‚£å¿ƒæƒ…,æˆ‘åªèƒ½è¯´æˆ‘ç¬¬ä¸€æ¬¡åé£æœºå›å“ˆå°”æ»¨,ä¸çŸ¥é“å¤ªå¹³æœºåœºå‘¨è¾¹å¤ªè’å‡‰.

é™è½ä¹‹åæˆ‘æ€»ç»“  

åŸæ¥ è¡Œç¨‹ä¸¤ä¸ªå°æ—¶å…¶å® ä¸­é€”é£è¡Œä¹Ÿå°±ä¸€ä¸ªå°æ—¶,èµ·é£åŠä¸ªå°æ—¶,é™è½åŠä¸ªå°æ—¶.æˆ‘èƒ½è¯´å•¥å‘¢,å®Œç¾æ²¡æ™šç‚¹.è¿™é£æœºå¼€çš„æˆ‘ç»™ä½ æ‰“101åˆ†.   

åå¤§å·´åˆ°å“ˆè¥¿...

ä¸‹æ¥å¤§å·´è·¯è¿‡å“ˆè¥¿ç«™ä¸œå¹¿åœº,ç›´å¥”çˆ±è¾¾å”®æ¥¼å¤„. 

**å¥‡è¿¹çš„ä¸€å¹•å‘ç”Ÿäº†**   

æˆ‘åäº†ä¸€å£å”¾æ²«, ä¸åä¸æ­£, æ²¿ç€ å¹¿åœºä¸Šæœ‰åœ°æ¼ç¼éš™çš„å¤§ç†çŸ³`ç›´ç›´`ååˆ°äº†ä¸‹æ°´é“,åè¿›å»äº†,è¿è¾¹éƒ½æ²¡æ²¾,å°±æ˜¯è¿™ä¹ˆå‡†, æˆ‘å½“æ—¶æƒŠå‘†äº†,å¯æƒœå½“æ—¶ç€æ€¥æ²¡ç…§ç›¸. 

> è¿™æ˜¯çœŸäº‹,æˆ‘å½“æ—¶çš„ç›´è§‰å‘Šè¯‰æˆ‘,æ€ä¹ˆè¿™ä¹ˆæ­£é“, unblievableçœ‹æ¥ä»Šå¤©ä¹°æˆ¿èƒ½ä¹°æˆ.


åˆ°äº†çˆ±è¾¾å”®æ¥¼å¤„æˆ‘çˆ¶æ¯æ—©å·²åœ¨é‚£ç­‰ç€æˆ‘äº†,

æˆ‘çˆ¶æ¯è¯´è¦ä¸è¦åœ¨å‘¨è¾¹çœ‹çœ‹,æˆ‘è¯´ä¸ç”¨äº†ç ç“œåˆ‡èœæŒ‘æˆ·å‹,ä¹°å§!

äºæ˜¯å°±æ˜¯å¹²å‡€åˆ©è½çš„äº¤å®Œå®šé‡‘,å›å®¶åŠç†ç»“å©šæ‰‹ç»­,å¼ ç½—é’±.

> çœ‹åˆ°è¿™é‡Œæé†’ä¸€ä¸‹å¤§å®¶,äº‹åæˆ‘å‘ç°æˆ‘é€‰çš„æˆ·å‹æ²¡æœ‰é˜³å°,æ˜¯é£˜çª—é‚£ç§çœ‹æ ·å­.

![](/assets/images/20171230FinalSummary/2017FinalSummaryHouseLayout.webp)

çˆ±è¾¾88-1å•å…ƒ-12æ¥¼-ä¸‰å®¤ä¸¤å…ä¸€å«-`124.7`å¹³,å½“æ—¶çš„ä»·æ ¼ 10800/å¹³ 


æ¥å¼ å°é¡¶çš„ç…§ç‰‡ æ„Ÿè°¢__çº¢å§__æä¾›:
![](/assets/images/20171230FinalSummary/Aida88Contructing.webp) 


åœ¨è¿‡å»çš„å‡ å¹´æˆ‘å›å®¶çš„è·¯çº¿æ˜¯è¿™æ ·çš„:
![](/assets/images/20171230FinalSummary/HailunPath.webp)

ä»`åŒ—äº¬ååœ°é“`åˆ°`åŒ—äº¬ç«™`-->`å“ˆå°”æ»¨ç«™`-->`æµ·ä¼¦ç«™`-->`å¤§å®¢(å¤§å·´)`-->`ç¬¬äºŒè‰¯ç§åœº`  
å…¨ç¨‹`1455`å…¬é‡Œå·¦å³,è¯´çš„å‡„æƒ¨ä¸€äº›åå¤§å·´å›å†œæ‘åœ°å›¾éƒ½æ²¡æœ‰å¯¼èˆª.å‹æ ¹éƒ½æ²¡æœ‰è¿™ä¸ªè·¯çº¿,åˆ°æµ·ä¼¦`40å…¬é‡Œå·¦å³`

å¦‚æœè¯´äº¤æˆ¿ä»¥åæˆ‘çš„è·¯çº¿åº”è¯¥æ˜¯è¿™æ ·çš„:  
![](/assets/images/20171230FinalSummary/HaerbinPath.webp)  
ä»`åŒ—äº¬ååœ°é“`åˆ°`åŒ—äº¬ç«™`-->`å“ˆå°”æ»¨è¥¿ç«™` å®Œäº‹ èµ°5åˆ†é’Ÿæˆ‘åˆ°å®¶äº†.

> ä¸ºäº†è¿™`265`å…¬é‡Œ(å“ˆå°”æ»¨å‡å»åˆ°æµ·ä¼¦å†œæ‘çš„å…¬é‡Œ)æˆ‘å·²ä¸ºä¹‹å¥‹æ–—äº†è‡³å°‘`4`å¹´,æœªæ¥è¿˜ä¼šç»§ç»­å¥‹æ–—åˆ°æŠŠæˆ¿è´·è¿˜å®Œ.

#### è´·æ¬¾

å›å®¶åŠç†å®Œæœ€å‘çš„äº‹æƒ…å‘ç”Ÿäº†

æˆ‘é¦–ä»˜äº¤äº†61wå¤š è´·äº†60ä¸‡,å“ˆå°”æ»¨é“¶è¡Œæ˜¯æˆ‘è§è¿‡æœ€SBçš„é“¶è¡Œ,æˆ‘çš„é“¶è¡Œæµæ°´å·²ç»é«˜å‡ºä¸¤ä¸ªæœˆçš„è¿˜è´·ä»·æ ¼,ä½†å®ƒè¿˜è¦æˆ‘å¥³æœ‹å‹çš„æµæ°´ä¹Ÿè¦è¾¾åˆ°å’Œæˆ‘åŒç­‰æ ‡å‡†.æˆ‘å½“æ—¶çœŸæ˜¯è†ˆåº”çš„å“ˆå°”æ»¨é“¶è¡Œå’¬ç‰™åˆ‡é½¿. åæ¥é€šè¿‡æ‹›å•†é“¶è¡ŒåŠç†çš„å•†ä¸šè´·æ¬¾ä¹°çš„æˆ¿.è‡³æ­¤æˆ‘æƒ³è¯´å¦‚æœä½ æœ‰èƒ½åŠ›è¾¾åˆ°è¿™ä¸ªé“¶è¡Œçš„æ ‡å‡†ä½ åº”è¯¥ç¦»ä¸­äº§é˜¶çº§ä¸è¿œäº†,å·²ç»æ˜¯å°åº·ä¸­çš„å°åº·äº†.


åœ¨è¿™é‡Œæˆ‘è¯´å‡ ä¸ªæ¯”è¾ƒå‘çš„åœ°æ–¹

1. é“¶è¡Œçš„è´·æ¬¾é“¶è¡Œæµæ°´éœ€è¦ç°åœºæ‰“å°,ä½œå‡çš„æµæ°´å°±ä¸è¦å»è´·æ¬¾äº†å¦åˆ™ä¼šå¾—ä¸å¿å¤±.
2. è¿˜è´·èƒ½åŠ›ä¸å¤Ÿçš„éœ€è¦æ‰¾ä¸€ä¸ªä¸­é—´äºº.ä»–çš„è¦æ±‚æ˜¯å’Œä½ ä¸€æ ·å‡†å¤‡ç›¸å…³ææ–™.è¿™ç§åŸºæœ¬å°±éœ€è¦é å„ç§äº²æˆšäº†,å¯æƒœçš„æ˜¯æˆ‘å®¶æœ‰è¿™æ ·çš„äº²æˆšå´æœ‰è´·æ¬¾.
3. è´·æ¬¾çš„æ—¶å€™ è´·æ¬¾ä¸šåŠ¡å‘˜æ€»æ¨èä½ ä¹°å„ç§ç†è´¢äº§å“,ä¸è¦ä¹°trust me.
4. è´·æ¬¾çš„é“¶è¡Œé‡Œé¢å¿…é¡»ä¿è¯æœ‰è‡³å°‘è¿˜è´·èƒ½åŠ›ä¸‰ä¸ªæœˆçš„å­˜æ¬¾.

æˆ‘è¢«ç¬¬`4`æ¡å‘äº†,æˆ‘äº¤å®Œé¦–ä»˜çš„æ—¶å€™è¦è¯´èº«æ— åˆ†æ–‡é‚£æœ‰ç‚¹æ‰¯æ·¡,ä½†æ˜¯ä¹Ÿå°±æœ€å¤š`2000å¤šå…ƒ`,ä¸¤ä¸ªäººå›åŒ—äº¬çš„è·¯è´¹å»é™¤æ‰ åƒé¥­ä½å®¿éƒ½å‹‰å¼ºä¸èƒ½ç»´æŒäº†.è¿˜è¦æˆ‘å­˜è¿›å»`3ä¸‡`è¿™ä¸æ‰¯æ·¡å˜›ï¼Ÿåæ¥åˆå’Œæ¯”è¾ƒå¥½çš„åŒå­¦,å§å§å€Ÿç‚¹é’±å­˜è¿›å»äº†.å”‰ å¤ªTMæ‰¯æ·¡äº†

æˆ‘å·²ç»å›åˆ°è§£æ”¾å‰äº†,è¿˜è¦æˆ‘æ€æ ·.

è‡³æ­¤æˆ‘è§‰å¾—ä¸€ä¸ªå›½å®¶è¿æœ€åŸºæœ¬çš„è€ç™¾å§“ä½æˆ¿éƒ½æˆé—®é¢˜è¿™å·²ç»ä¸æ˜¯ä¸€ä¸ªå¥½çš„å›½å®¶äº†.

> __æ³¨æ„:é“¶è¡Œè´·æ¬¾æ”¾æ¬¾ä¹‹åä¸€å®šè¦å»å”®æ¥¼å¤„ç´¢è¦å‘ç¥¨,åªæœ‰é¦–ä»˜æ¬¾å‘ç¥¨+å°¾æ¬¾å‘ç¥¨=æˆ¿äº§è¯,ä¸¤å¼ å‘ç¥¨æœ‰ä¸€å¼ æ²¡æœ‰çš„è¯éƒ½å®¹æ˜“æ‹¿ä¸åˆ°æˆ¿äº§è¯,è¿™äº‹æ¯”è¾ƒå‘çš„æ˜¯å”®æ¥¼å¤„çš„å”®æ¥¼å‘˜ä¸å‘Šè¯‰æˆ‘ä»¬è¿™äº›ä¸šä¸». (2018/02/28æ—¥æ›´æ–°)__



#### åŠç†å®Œæ‰€æœ‰ä¹°æˆ¿æ‰‹ç»­

æœ‰ä¸€ç§æ„Ÿè§‰å«å¦‚é‡Šé‡è´Ÿ,å°±æ˜¯å½¢å®¹ä¹°å®Œæˆ¿åŠç†è´·æ¬¾.ç­‰å¾…å®¡æ‰¹å®Œæˆæœ€åæˆä¸ºä¸€ä¸ªä¸æŠ˜ä¸æ‰£çš„æˆ¿å¥´,é‚£è¿™æ®µè¯è¯´çš„åº”è¯¥æ˜¯æˆ‘,å¿ƒç†çš„ä¸€å—çŸ³å¤´ç®—æ˜¯è½äº†åœ°.


4æœˆä»½æ”¶åˆ°æ‹›å•†é“¶è¡Œçš„å®¡æ‰¹åˆåŒ,é“¶è¡Œè¦æ±‚å¿…é¡»æœ¬äººå»å–.ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç†äººæ‹¿ç€æœ¬äººèº«ä»½è¯ ä»£ç†äººèº«ä»½è¯å»å–,äºæ˜¯æˆ‘æ±‚åŠ©äº†æˆ‘çš„ä¸€ä¸ª å°å­¦ã€åˆä¸­ã€é«˜ä¸­åŒå­¦.å¸®æˆ‘å»çˆ±å»ºæ”¯è¡Œå–å‡ºæˆ‘çš„è´·æ¬¾åˆåŒå¸®æˆ‘é‚®å¯„åˆ°äº†åŒ—äº¬.

æˆ‘ä¹°æˆ¿çˆ¶æ¯æ²¡æ‹¿å¤šå°‘é’±,å…¨æ˜¯è¿™å‡ å¹´å¤§å­¦æ¯•ä¸šè¾›è‹¦åŒ—æ¼‚å¿å—é›¾éœ¾æ‹¿ç”Ÿå‘½ç§¯æ”’ä¸‹æ¥çš„.
æ‰€ä»¥æˆ‘ä¸ç¾¡æ…•é‚£äº›æ‹¿é’±ç»™å„¿å¥³ä¹°æˆ¿çš„çˆ¶æ¯.

è‡³æ­¤ä¹°æˆ¿ ç®—æ˜¯å‘Šä¸€æ®µè½.

> ä¹°æˆ¿å¦‚æœå†™ä¸¤ä¸ªäººåçš„è¯,æ˜¯ç­¾å‘çš„6ä»½åˆåŒ, æˆ¿åœ°äº§,é“¶è¡Œ,æœ¬äººå„ä¸€ä»½  
> äº§æƒæ‰€æœ‰æ˜¯è°ç­¾ 51% å’Œè°ç­¾ 49%çš„æ¯”ä¾‹


#### æå–åŒ—äº¬å…¬ç§¯é‡‘

åŒ—äº¬å…¬ç§¯é‡‘æå–éœ€è¦æä¾›å¦‚ä¸‹ææ–™:

* è´­æˆ¿åˆåŒåŸä»¶å’Œè´­æˆ¿åˆåŒå¤å°ä»¶
* è´·æ¬¾åˆåŒåŸä»¶å’Œè´·æ¬¾åˆåŒå¤å°ä»¶
* åŒ—äº¬çº³ç¨è¿ç»­ä¸€å¹´ä»¥ä¸Šæ‰“å°
* è´­æˆ¿å‘ç¥¨åŸä»¶ä»¥åŠç¨åŠ¡æŸ¥è¯¢æˆªå›¾æ‰“å°
* è´­æˆ¿çš„ä»˜æ¬¾å°ç¥¨
* å…¬å¸çš„æå–å…¬ç§¯é‡‘ç« ç¨‹è¡¨æ ¼
* éƒ¨é—¨ç»ç†ç­¾å­—è®¤å¯å•
* æœ¬äººäº²è‡ªç­¾å­—è®¤å¯å¯¹æä¾›ææ–™çš„çœŸå®æ€§è®¤å¯å•

è¿™äº›ä¸œè¥¿åŠå®Œä¹‹å å…¬ç§¯é‡‘å¯ä»¥çº¦å®šæ”¯å–.ç”±äºç™¾åº¦ç ´å…¬å¸çš„ä¿¡èª‰ä¸å¥½,åªèƒ½æ¯ä¸ªå­£åº¦(3ä¸ªæœˆ)æå–ä¸€æ¬¡.

**åŠç†å®Œä¹‹ååŒ—äº¬ä½æˆ¿å…¬ç§¯é‡‘ä¼šè¿”å›ç»™æˆ‘ä»¬ä¸€å¼ `å…¬ç§¯é‡‘çº¦å®šæå–è®°å½•å•`ç”¨äºå…¶å®ƒäººæå–çš„å‡­è¯,ä¸‹æ¬¡æå–å¿…é¡»å‡­å€Ÿè¿™å¼ æå–è®°å½•å•,æ¯”å¦‚æˆ‘å¥³æœ‹å‹å¥¹æƒ³æå–å¿…é¡»æ‹¿è¿™ä¸ªè®°å½•å•,è®°ä½è¿™å¾ˆé‡è¦.**

ç¬¬ä¸€ç¬”é’±å…¥è´¦çš„æ—¶å€™éƒ½å·²ç»æ˜¯ 6æœˆæœ«,ç¬¬ä¸€ä»¶äº‹å°±æ˜¯æŠŠä¹°æˆ¿æ—¶å€™å€Ÿç‚¹é’±éƒ½è¿˜æ¸….

> æˆ‘å°±æƒ³ä¸æ˜ç™½ä¸ºå•¥å…¬ç§¯é‡‘çš„é’±æ˜¯æˆ‘çš„æˆ‘è¿˜æå–å‡ºæ¥è¿™ä¹ˆè´¹åŠ²,å³ä¾¿æ˜¯åä¹å¤§å„ç§å¼€ä¼šå‡å°‘å„ç§æ‰‹ç»­æˆ‘å‘ç°å¤–åœ°äººä¾ç„¶è¿˜æ˜¯è€æ ·å­,åªæœ‰åŒ—äº¬äººæå–å„ç§æ–¹ä¾¿.æˆ‘æ»¡è…”æ¿€æ„¤çš„è†ˆåº”èµ·æ¥é‚£ä¸ªå‡ºç§Ÿè½¦å¸æœº.

ç»è¿‡äº†å¦‚æ­¤å¤æ‚çš„æ‰‹ç»­ æˆ‘æ‰å¾—ä»¥ä¹°å¥—æˆ¿,æƒ³æƒ³çœŸæ˜¯å¿ƒé…¸æ— åŠ©,ç¡®åˆé»¯ç„¶ç¥ä¼¤, åœ¨ä¸­å›½ä¹°æˆ¿å°±æ˜¯è¿™ä¹ˆè´¹äº‹, åæ¥ä¹°æˆ¿çš„çœ‹å®¢ä»¬, åšå¥½ä¸€ä¸ªæ‰“æŒä¹…æˆ˜çš„å‡†å¤‡,å› ä¸ºæˆ‘ä»¬åœ¨å’Œä¸­å›½çš„ä½“åˆ¶æ–—æ™ºæ–—å‹‡.

å¦‚æœå¯¹æœ¬äººä¹°æˆ¿ç»å†æœ‰ä»»ä½•é—®é¢˜ è¯·åº•éƒ¨ç•™è¨€,æˆ‘ä¸€ä¸€è§£ç­”.

åˆ°æ­¤ä¹°æˆ¿ç»“æŸ, æˆ‘ç›¸ä¿¡è·Ÿæˆ‘åšé‚»å±…çš„äººç»ä¸æ˜¯ä¸€èˆ¬çš„æ™®é€šäºº,ä»–ä¹Ÿå¿…å®šç»å†æˆ‘çš„è¿™äº›è‡³å°‘ä¸€éƒ¨åˆ†,æ”¶å…¥ã€åœ°ä½ã€ç­‰ç­‰ç­‰ç­‰,å› ä¸ºèƒ½åœ¨çˆ±è¾¾è¿™ä¸ªåœ°å—ä¹°æˆ¿çš„äºº,éå¯Œå³è´µ,å¸Œæœ›æˆ‘çš„ç»å†å’Œä¹°æˆ¿ç»éªŒèƒ½ç»™ä½ æä¾›å€Ÿé‰´,å°‘èµ°å¼¯è·¯.

---

### å·¥ä½œ

#### ç¦»å¼€ä¸­å›½äº’è”ç½‘ä¹‹å·…-ç™¾åº¦

![](/assets/images/20171230FinalSummary/2017FinalSummaryWork1.webp)

å¦‚æœä½ æ˜¯ä¸€ä¸ªå¹´è½»éœ€è¦é”»ç‚¼çš„ç¨‹åºå‘˜æˆ‘å»ºè®®ä½ å»ç™¾åº¦,é‚£é‡Œæœ‰ä½ æˆé•¿æ‰€éœ€è¦çš„åœŸå£¤

![](/assets/images/20171230FinalSummary/2017FinalSummaryWork2.webp)

ä¸Šè¾¹è¿™å¼ æ˜¯åŠå…¬ç¯å¢ƒ,å¯ä»¥è¯´ç¡®å®å¾ˆå¥½.


**æœ‰ä¸€ç§ç¦»èŒå«çœŸçš„å¹²å¤Ÿäº†**

ç¦»å¼€ç™¾åº¦ä¸å…¶è¯´æ˜¯ä¸€ç§**æŸå¤±**ä¸å¦‚è¯´æ˜¯**é€‰æ‹©æ¯”åŠªåŠ›æ›´é‡è¦**.

è®¤è¯†äº†å¾ˆå¤šç²¾è‹±å°ä¼™ä¼´,ä»–ä»¬ä¸æ˜¯__å¹²å•¥å•¥è¡Œ__çš„äººå°±æ˜¯åœ¨æŸä¸ªé¢†åŸŸ__ä¸–ç•Œæ’è¡Œæ¦œéƒ½æœ‰æˆå°±__çš„äºº.

æˆ‘ä¸€å¼€å§‹åœ¨ç™¾åº¦äº‘è®¾å¤‡,åæ¥äº§å“ä¸æµè½¬å²—åˆ°**ç™¾åº¦ç½‘ç›˜**.æ˜¯çš„ä½ ä»Šå¤©ç”¨çš„`iOS`ç™¾åº¦ç½‘ç›˜æˆ–è€…__macOSç™¾åº¦ç½‘ç›˜__å°±æœ‰æˆ‘å¼€å‘çš„ä¸€æ®µæ•…äº‹.

åæ¥è§‰å¾—å›¢é˜Ÿæ°”æ°›ä¸æ˜¯å¾ˆå¥½è½¬æˆ˜åˆ°ç™¾åº¦hiåšèŠå¤©,å¦‚æœæˆ‘è¯´QQå¾®ä¿¡ä½ çŸ¥é“çš„è¯,é‚£ä¹ˆç™¾åº¦æœ‰æ²¡æœ‰ç±»ä¼¼QQã€å¾®ä¿¡è¿™æ ·çš„èŠå¤©å·¥å…·å‘¢,æœ‰çš„,è¿™ç©æ„å°±å«ç™¾åº¦Hi.

åœ¨Hiå›¢é˜Ÿ æ¥è§¦åˆ°äº†ä¸€ä½æ¥è‡ª`æ¸…åå¤§å­¦`æ¯•ä¸šçš„è€ä¹¡__æ¶›å…„__.

å¦‚æœè¯´è¿™å¬èµ·æ¥æ„Ÿè§‰å¾ˆæœ‰é¢å­çš„è¯,é‚£æˆ‘æ¥è¯´ä¸€ä¸ª2017å¹´æˆ‘å¬è¿‡æœ€çœŸå®çš„ç¬‘è¯.

æ®æ¶›å…„è¯´:

__ä»–å½“å¹´é«˜è€ƒçš„æ—¶å€™,æ•°å­¦æ‰“äº†`149`åˆ†(150æ»¡åˆ†),è®©æ¶›å…„å¾ˆä¸èƒ½é‡Šæ€€çš„æ˜¯ä»–æœ‰æ—¶å€™åƒé¥­çš„æ—¶å€™éƒ½å†æ€è€ƒä¸ºå•¥ä¸æ˜¯`150`åˆ†,ä»–å·é¢ä¹Ÿå·²ç»å¾ˆå¹²å‡€äº†,æ²¡æœ‰é”™è¯¯çš„é¢˜ç›®å•Š.ç»ˆäºæœ‰ä¸€å¤©ä»–æ‰¾åˆ°äº†ç­”æ¡ˆ,ä»–è¯´:"æœ‰å¯èƒ½æ˜¯å·é¢å¤ªå¹²å‡€äº†æ‰£äº†ä¸€åˆ†"__.

> è¿™æ˜¯ä¸€ä»¶2017å¹´æˆ‘å¬è¿‡æœ€æç¬‘ä¸”çœŸå®çš„ç¬‘è¯,å›æƒ³æˆ‘çš„é«˜è€ƒ..è¿˜æ˜¯ç®—äº†,è¿™å°±æ˜¯å·®è·.


ç¦»å¼€çš„ç™¾åº¦Hi æ¥åˆ°çš„æ–°çš„å…¬å¸ é‡‘å±±äº‘

è¿›å…¬å¸çš„æ—¶å€™å”‰ ä¸€çœ¼æœ›å» å¥½å¤šå¼ ç†Ÿæ‚‰çš„é¢å­”,åŸæ¥ç›¸å½“ä¸€éƒ¨åˆ†åŒäº‹éƒ½æ˜¯ç™¾åº¦çš„å‰åŒäº‹.

å·¥ä½œå°±è¿™æ ·æŠŠ,ä¸å¤šä»‹ç»äº†

---

### ä¹¦æ³•


è¿™ä¸€å¹´ä¹°äº†ä¸¤åªæ¯›ç¬”èŠ±äº†å¤§æ¦‚200å¤š

![](/assets/images/20171230FinalSummary/Brush.webp)


ä¸è¿‡ç”¨èµ·æ¥ç¡®å®å¾ˆå¥½,å¥½é©¬é…å¥½é,å¥½ç¬”é…æ¯›æ¯¡.

![](/assets/images/20171230FinalSummary/calligraphy.webp)

æœ‰å¹¸åœ¨ç™¾åº¦ç¢°åˆ°ä¹¦æ³•é«˜æ‰‹-è€ä¹¡`æ½˜æ—­`,è¿™ä¸ªç»¥æ£±äººçœŸæ˜¯å¹²å•¥å•¥è¡Œ,å†™ä»£ç é£é©°ç”µæ£.è¿˜æœ‰ä¸€æ‰‹å¥½ä¹¦æ³•.è®©æˆ‘è¿™ä¸ªæµ·ä¼¦äººå¾ˆä½©æœ.

![](/assets/images/20171230FinalSummary/Linzexu.webp)

è¿™æ˜¯æ—åˆ™å¾å½“å¹´å†™ç»™çš‡å¸çš„è™é—¨é”€çƒŸå¥æŠ˜.æ˜¯æˆ‘å­¦ä¹ ä¹¦æ³•çš„æœ€ç»ˆç›®æ ‡.

---

### è¯»ä¹¦

åœ¨æ–‡å­¦ä¸Š 2017è¯»è¿‡+å¬è¿‡çš„ä¹¦æˆ‘éƒ½ä¸€ä¸€è®°å½• ä¹Ÿæ¨èå¤§å®¶çœ‹çœ‹.


* ã€Šå‘é„™çš„åœ£äººæ›¹æ“ã€‹1~10éƒ¨å…¨å¬å®Œ 

![](/assets/images/20171230FinalSummary/Novel1.webp)

* ã€ŠçŸ¥è¡Œåˆä¸€ ç‹é˜³æ˜ ã€‹

![](/assets/images/20171230FinalSummary/Novel2.webp)

* ã€Šå¤§æ¸…ç›¸å›½ã€‹ é™ˆå»·æ•¬   
![](/assets/images/20171230FinalSummary/Novel3.webp)

* ã€Šæ™šæ¸…çš„æœ€ååå…«å¹´ã€‹1~3éƒ¨

![](/assets/images/20171230FinalSummary/Novel4.webp)

* ã€ŠLearn AV Foundationã€‹

![](/assets/images/20171230FinalSummary/LearnAvFoundation.webp)



ç®€å•å°±è¿™ä¹ˆå¤š

è¿™é‡Œæ¯”è¾ƒæ¨èçš„æ˜¯__ã€Šå¤§æ¸…ç›¸å›½ã€‹__å’Œ__ã€Šæ™šæ¸…æœ€åçš„åå…«å¹´ã€‹__

#### è¯»ã€Šæ™šæ¸…æœ€åçš„åå…«å¹´ã€‹ä¸­æœ‰ä¸€ä¸ªæ•…äº‹å€¼å¾—å­¦ä¹ 

![](/assets/images/20171230FinalSummary/FuDaoAnZheng.webp)

> ç¦å²›å®‰æ­£ï¼ˆ1852ä¸€1919ï¼‰æ—¥æœ¬ä¿¡å·äººï¼æ—¥æœ¬æ®–æ°‘æœºæ„å…³ä¸œéƒ½ç£åºœéƒ½ç£ã€‚é™†å†›å¤§å°†ã€‚æœ‰â€œæ—¥æœ¬æƒ…æŠ¥æˆ˜ä¹‹çˆ¶â€ä¹‹ç§°ã€‚ä»–æ˜¯ä¸€ä¸ªå…·æœ‰è¶…å‰çœ¼å…‰çš„é˜´è°‹å®¶ã€æˆ˜ç•¥å®¶.  

> 1887å¹´ï¼Œç¦å²›å®‰æ­£è¢«ä»»å‘½ä¸ºæ—¥æœ¬é©»å¾·å›½æ­¦å®˜ã€‚åœ¨å¾·å›½çš„äº”å¹´ä¸­ï¼Œä»–è¯¦ç»†çš„è€ƒå¯Ÿäº†æ¬§æ´²å„å›½çš„æƒ…å†µï¼Œå…¶ä¸­ä¿„å›½çš„åŠ¨å‘å¼•èµ·äº†ä»–çš„æå¤§å…³æ³¨ã€‚è¿«äºè‹±å›½çš„ç‰µåˆ¶ï¼Œä¿„å›½ä¼ ç»Ÿçš„å—è¿›æ”¿ç­–è¢«è¿«æ”¾ç¼“ï¼Œç¦å²›å®‰æ­£æ­£ç¡®é¢„æµ‹ä¿„å›½å¿…ç„¶ä¼šè½¬å‘ä¸œè¿›ã€‚æœç„¶ï¼Œ1891å¹´1æœˆï¼Œä¿„å›½å…¬å¸ƒäº†å»ºé€ è¥¿ä¼¯åˆ©äºšå¤§é“è·¯çš„è®¡åˆ’ï¼Œå¹¶ç«‹å³åŠ¨å·¥ã€‚è¿™æ¡è¿æ¥ä¿„å›½é¦–éƒ½åœ£å½¼å¾—å ¡å’Œç¬¦æ‹‰è¿ªæ²ƒæ–¯æ‰˜å…‹ï¼ˆæµ·å‚å´´ï¼‰ï¼Œæ¨ªç©¿æ¬§äºšå¤§é™†çš„é“è·¯ï¼Œå¯ä»¥è¯´æ˜¯ä¿„å›½ä¾µç•¥äºšæ´²çš„æœ€å¤§æ­¦å™¨ã€‚è¥¿ä¼¯åˆ©äºšé“è·¯æ¨ªç©¿ä¸­å›½ä¸œåŒ—éƒ¨ï¼Œä»å“ˆå°”æ»¨å‘å—æœ‰ä¸€åˆ†æ”¯ï¼Œç›´è¾¾æ—…é¡ºã€å¤§è¿ï¼Œå¯ä»¥ä½¿ä¿„å›½è½»è€Œæ˜“ä¸¾çš„è¿›å…¥äºšæ´²ã€‚ç¦å²›é¢„æµ‹è¿™æ¡é“è·¯å¤§çº¦è¦è€—æ—¶åå¹´ï¼Œä»–è®¤ä¸ºè¿™åå¹´æ˜¯å…³ç³»æ—¥æœ¬ç”Ÿæ­»å­˜äº¡çš„åå¹´ï¼Œæ—¥æœ¬å¯¹æ­¤ç»ä¸èƒ½è¢–æ‰‹æ—è§‚ã€‚  

![](/assets/images/20171230FinalSummary/Russia.webp)

> __ä¸ºäº†æŒæ¡ä¿„å›½ä¸œè¿›æ”¿ç­–çš„å®é™…æƒ…å†µï¼Œç¦å²›å†³å®šäº²è‡ªæ²¿ç€è¥¿ä¼¯åˆ©äºšé“è·¯è¿›è¡Œå®åœ°ä¾¦å¯Ÿã€‚è¿™ä¸ªå¤§èƒ†çš„è®¡åˆ’ç«‹å³å¾—åˆ°äº†å‚è°‹æ¬¡é•¿å·ä¸Šæ“å…­çš„å¤§åŠ›æ”¯æŒã€‚ç”±äºç¦å²›çš„å†›äººèº«ä»½ä¼šæš´éœ²ç©¿è¶Šè®¡åˆ’çš„ç›®çš„ï¼Œäºæ˜¯ç¦å²›å¯¹å¤–å®£å¸ƒè¦è¿›è¡Œä¸€æ¬¡å•éª‘ç©¿è¶Šä¸¥å¯’æ—¶æœŸè¥¿ä¼¯åˆ©äºšçš„æ¢é™©æ—…è¡Œã€‚å³ä½¿æ˜¯åœŸç”ŸåœŸé•¿çš„ä¿„å›½äººï¼Œä¹Ÿä¸æ•¢è½»è¨€åœ¨ä¸¥å†¬æ—¶æœŸç©¿è¶Šè¥¿ä¼¯åˆ©äºšï¼Œæ›´ä½•å†µæ˜¯ä¸€ä¸ªæ²¡æœ‰ä¸¥å¯’åœ°åŒºç”Ÿæ´»ç»å†çš„å¤–å›½äººã€‚ç¦å²›æ­¤è¨€ä¸€å‡ºï¼Œä¸–ç•Œå“—ç„¶ï¼Œè¥¿æ–¹æ¢é™©å®¶å¯¹ä»–çš„â€œç©¿è¶Šâ€è®¡åˆ’å—¤ä¹‹ä»¥é¼»ï¼Œå¤§å®¶éƒ½ç­‰ç€çœ‹è¿™ä¸ªæ—¥æœ¬äººçš„ç¬‘è¯ã€‚ä½†ç¦å²›å®‰æ­£æä¸ºåšå®šï¼Œä»–æ·±çŸ¥è¿™ä¸ªè®¡åˆ’å¯¹æ—¥æœ¬æ„å‘³ç€ä»€ä¹ˆ__ã€‚  
> __1892å¹´2æœˆ11æ—¥ï¼Œç¦å²›å’Œçˆ±éª‘â€œå‡¯æ—‹â€ä»å¾·å›½è¸ä¸Šç©¿è¶Šä¹‹æ—…ï¼Œåœ¨é›¶ä¸‹20æ‘„æ°åº¦çš„ä¸¥å¯’ä¸­åŒ—ä¸Šã€‚3æœˆä¸‹æ—¬ï¼Œåˆ°è¾¾åœ£å½¼å¾—å ¡åï¼Œç¦å²›å‘æ—¥æœ¬å‚è°‹æœ¬éƒ¨å‘å»äº†ç¬¬ä¸€ä»½å…³äºä¿„å›½é™†å†›çš„è°ƒæŸ¥æŠ¥å‘Šã€‚æ­¤æ—¶ï¼Œä¿„æ–¹ä¹Ÿéšçº¦è§‰å¯Ÿåˆ°ç¦å²›çš„æ­¤æ¬¡â€œæ—…è¡Œâ€æ˜¯é¡¹åº„èˆå‰‘ï¼Œæ„åœ¨æ²›å…¬ã€‚4æœˆ9æ—¥ï¼Œç¦å²›ç¦»å¼€åœ£å½¼å¾—å ¡ï¼Œäºå½“æœˆä¸‹æ—¬æŠµè¾¾è«æ–¯ç§‘ã€‚åœ¨é‚£é‡Œå—åˆ°äº†æ²™çš‡å’Œçš‡åçš„æ¥è§å’Œèµå®´ã€‚ç»è¿‡ç»†è‡´è€ƒå¯Ÿï¼Œç¦å²›å‘æ—¥æœ¬å‚è°‹æœ¬éƒ¨æäº¤äº†å…³äºè¥¿ä¼¯åˆ©äºšé“è·¯å»ºè®¾æ–¹é¢çš„æŠ¥å‘Šã€‚9æœˆä¸‹æ—¬ï¼Œç¦å²›åˆ°è¾¾ä¸­ä¿„ä¸¤å›½çš„ç•Œå±±â€•æµ·æ‹”3000å¤šç±³çš„é˜¿å°”æ³°å±±ã€‚ä»é˜¿å°”æ³°å±±æç›®è¿œæœ›ï¼Œæ»¡ç›®çš‘çš‘ç™½é›ªã€‚è‡³æ­¤ï¼Œç¦å²›å·²ç»èµ°äº†7000å…¬é‡Œï¼Œå®Œæˆä¸€åŠè·¯ç¨‹ã€‚
ç¦å²›å®‰æ­£åœ¨æ—…é€”ä¸­è¿æ¥äº†1893å¹´ã€‚1æœˆä¸‹æ—¬åˆ°2æœˆæ˜¯è¥¿ä¼¯åˆ©äºšæœ€å¯’å†·çš„æ—¶æœŸï¼Œæ°”æ¸©è¾¾åˆ°é›¶ä¸‹50åº¦ã€‚ä¿„å›½äººå‡ ä¹ä¸åœ¨è¿™æ ·ä¸¥å¯’çš„å†¬å¤©å¤–å‡ºï¼Œä½†æ˜¯ç¦å²›å´ä»¥æƒŠäººçš„æ„å¿—åœ¨è’æ— äººçƒŸçš„å†°å¤©é›ªåœ°é‡Œé¡½å¼ºå‰è¡Œã€‚æœ€ç»ˆï¼Œå‡­å€Ÿé¡½å¼ºçš„çš„æ¯…åŠ›ï¼Œç¦å²›èµ°å‡ºäº†è¥¿ä¼¯åˆ©äºšã€‚æ²¿ç€é€æ¸è½¬æš–çš„é»‘é¾™æ±Ÿä¸€è·¯å—ä¸‹è¿›å…¥ä¸­å›½ï¼Œç¦å²›å®‰æ­£åˆç”¨äº†ä¸¤ä¸ªå¤šæœˆçš„æ—¶é—´ï¼Œåœ¨ç‘·ç²ã€é½é½å“ˆå°”ã€å‰æ—ç­‰åœ°åˆºæ¢å†›æƒ…ã€‚ç»è¿‡ä¸€å¹´å¤šçš„è‰°è‹¦è·‹æ¶‰ï¼Œç¦å²›å·²ç»èº«å¿ƒä¿±ç–²ã€‚ä»–ç»ˆäºåˆ°äº†ç»ˆç‚¹ç«™--ç¬¦æ‹‰è¿ªæ²ƒæ–¯æ‰˜å…‹ã€‚åœ¨è¿™æ¬¡çš„è¥¿ä¼¯åˆ©äºšç©¿è¶Šä¸­ï¼Œç¦å²›å®‰æ­£è‡³å°‘æ¢äº†å…«åŒ¹é©¬ï¼Œå†æ—¶488å¤©ï¼Œè¡Œç¨‹14000å…¬é‡Œï¼Œåˆ›ä¸‹äº†æƒ…æŠ¥ä¾¦å¯Ÿå²ä¸Šçš„å¥‡è¿¹__ã€‚
å±…ä½åœ¨ç¬¦æ‹‰è¿ªæ²ƒæ–¯æ‰˜å…‹çš„æ—¥æœ¬äººæ¬£å–œè‹¥ç‹‚åœ°è¿æ¥ç¦å²›çš„åˆ°æ¥ã€‚å…¨ä¸–ç•Œéƒ½åœ¨å¤§è‚†æŠ¥åˆ°ä»–å•éª‘ç©¿è¶Šè¥¿ä¼¯åˆ©äºšçš„æ¶ˆæ¯ã€‚ç¦å²›å®‰æ­£æˆäº†ä¸–ç•Œçš„åäººã€‚æ˜æ²»å¤©çš‡ç‰¹æˆäºˆä»–ä¸‰ç­‰æ—­æ—¥é‡å…‰å‹‹ç« å¹¶äº²è‡ªè®¾å®´æ¬¾å¾…ã€‚ç¦å²›å®‰æ­£åœ¨ç©¿è¶Šä¸­è·å¾—çš„ç¬¬ä¸€æ‰‹èµ„æ–™ï¼Œæˆä¸ºæ—¥ä¿„æˆ˜äº‰ä¸­æ—¥æœ¬è·èƒœçš„é‡è¦ä¿¡æ¯ä¿éšœã€‚
ä¸€ä¸ªå›½å®¶çš„æƒ…æŠ¥å·¥ä½œï¼Œå•é å‡ ä¸ªäººçš„åŠ›é‡æ˜¯è¿œè¿œä¸å¤Ÿçš„ï¼Œç»è¿‡é•¿æœŸçš„ç»è¥æ‰èƒ½å½¢æˆä¸€ä¸ªåºå¤§è€Œæœ‰æ•ˆçš„æƒ…æŠ¥ç½‘ç»œã€‚åœ¨è¿™æ–¹é¢ï¼Œç¦å²›ä¹Ÿæ˜¯ä¸€ä¸ªè¡Œå®¶é‡Œæ‰‹

è¿™ä¸ªäººæ—¥æœ¬äººæ¨ªç©¿ä¿„å›½æ¬§äºšè¿œä¸œå¤§é“è·¯,ä¹Ÿå°±æ˜¯ä»Šå¤©çš„è«æ–¯ç§‘->>æ»¡æ´²é‡Œ->>é½é½å“ˆå°”->>å¤§åº†->>å“ˆå°”æ»¨->>ç‰¡ä¸¹æ±Ÿ->>æµ·å‚å´´ å¯¹ä¿„è´¸æ˜“è·¨å›½ä¸“åˆ—é“è·¯çº¿.

å°±ä¸ºäº†æœé›†æˆ˜ç•¥æƒ…æŠ¥,é“è·¯é€”ç»å±±å·åœ°å½¢åœ°è²Œæ²³æµéƒ½ç»˜åˆ¶æˆåœ°å›¾(é‚£æ—¶å€™è¿˜æ²¡æœ‰googleå«æ˜Ÿå®šä½åœ°å›¾),ä¸ºäº†æˆ˜äº‰åšå¥½å……è¶³çš„å‡†å¤‡. 

è¿™ä¸ªäººçš„æ„å¿—æ·±æ·±çš„é¼“èˆäº†æˆ‘,å¦‚æœä¸€ä¸ªå›½å®¶æƒ³ä¾µç•¥å¦ä¸€ä¸ªå›½å®¶,å‡ºä¸€ä¸¤ä¸ªè¿™æ ·çš„äººæ‰å°±å·®ä¸å¤šå¤Ÿäº†.

ä¸‹å›¾æ˜¯æ™šæ¸…çš„ä¸œåŒ—å†›
![](/assets/images/20171230FinalSummary/ManqingDongbeijun.webp)

è¿™äº›ä¹¦å¤šæ•°éƒ½æ˜¯å¬çš„å°‘æ•°ç”¨kindleçœ‹çš„.2018å¹´ä¼šå†æ¥å†å‰.

---

### è¿åŠ¨

è¿™ä¸€å¹´ä¸€ç›´åšæŒæ‰“ç¾½æ¯›çƒ
![](/assets/images/20171230FinalSummary/BadmintonTeam2.webp)

å‚åŠ äº†é‡‘å±±çš„ç¾½æ¯›çƒæ¯”èµ›æ‹¿äº†ä¸€ä¸ªå­£å†› è€å®è¯´çº¯æ‰“é…±æ²¹å“ˆè§ç¬‘è§ç¬‘ 
![](/assets/images/20171230FinalSummary/Awards1.webp)
![](/assets/images/20171230FinalSummary/Awards2.webp)  

é‡‘å±±çš„å°ä¼™ä¼´ä»¬è¿˜æ˜¯ä¸é”™çš„å›¢é˜Ÿ  
![](/assets/images/20171230FinalSummary/BadmintonTeam1.gif)

--- 

### é©¾ç…§

è¿™æ˜¯2017å¹´æˆ‘è§‰å¾—æœ€å€¼å¾—å»åšçš„ä¸€ä»¶äº‹,ç»ˆäºæŠŠé©¾é©¶è¯è€ƒäº†.ä¸Šå­¦çš„æ—¶å€™å®¶é‡Œæ¡ä»¶å®åœ¨å¤ªå·®äº†,æ²¡é’±è€ƒé©¾ç…§,ä¸Šç­ä»¥åæ²¡æœ‰äº†æ—¶é—´.æ€»ä¹‹ç»“æœè¿˜æ˜¯å¥½çš„



æ¥å¼ æµ·æ·€é©¾æ ¡çš„ç…§ç‰‡.   
![](/assets/images/20171230FinalSummary/DrivingLicence.webp)

è¯´ä¸€ä¸‹è€ƒé©¾ç…§çš„æ„Ÿè§¦

ç§‘ç›®ä¸€ã€äºŒã€ä¸‰ã€å›› ä¸€æ°”å‘µæˆ.2ä¸ªæœˆé¡ºåˆ©æ‹¿æœ¬,æ€»è®¡è·‘äº†11è¶Ÿé©¾æ ¡.

ä¸è¿‡ä¸å¾—ä¸è¯´é¦–éƒ½çš„æ•™è‚²è¿˜æ˜¯å¾ˆå¥½çš„,æ•™å­¦è®¾ç½®ä¸€åº”ä¿±å…¨.æœç„¶è¿˜æ˜¯å¾—çœ‹é¦–éƒ½çš„å‘å±•.

å¦‚æœæ˜¯è‡ªå°Šå¿ƒå¼ºçš„äººæˆ‘å»ºè®®å¯ä»¥æŠ¥å.å¦‚æœæŒ¨éª‚å‡ å¥éƒ½æ¥å—ä¸äº†çš„è¯è¿˜æ˜¯åˆ«æŠ¥äº†.



## 2018ç›®æ ‡

è¯´å®Œäº†2017å¹´çš„å„ç§å¤§äº‹ä»¶

ä¸‹é¢æˆ‘åˆ—ä¸€ä¸‹ä»Šå¹´çš„ç›®æ ‡

* swift4 è¿›é˜¶çœ‹å®Œ 
* iOS Core Animation çœ‹å®Œ
* Learn AV Foundation è¦å†™å‡ ç¯‡åšå®¢ä»ä¸Šæ¬¡æ®µçš„ä½ç½®ç»­ä¸Š
* å­¦ä¼šPythonå’Œæ•°æ®æŒ–æ˜ ä¸ºæœºå™¨å­¦ä¹ åšé“ºå«
* äººå·¥æ™ºèƒ½é¢†åŸŸè¦æœ‰è·¨è¶³
* å¤šåª’ä½“ç›¸å…³æŠ€æœ¯æ·±è€•
* è‹±è¯­æ°´å¹³å†æé«˜ä¸€ä¸ªlevel



å¥½äº†ç›®æ ‡å°±è¿™äº›å§


# æ€»ç»“

è¿™ä¸€å¹´è¿‡å¾ˆå¤šäº‹ä»¶éƒ½æ²¡æ¥å¾—åŠæƒ³å°±å‘ç”Ÿäº†,æœ‰äº›æƒ³çš„åŸºæœ¬å¾ˆå°‘å®Œæˆ,åšå®¢è´¨é‡æœ‰é‡çš„ç§¯ç´¯å´æ²¡æœ‰è´¨çš„é£è·ƒ. å¦‚æœç”¨å‡ ä¸ªå­—æ¥ç»“æŸ2017çš„å¹´ç»ˆæ€»ç»“é‚£æˆ‘åªèƒ½å‘å‡ºè¿™å¥è¯å§ï¼

**é›„å…³æ¼«é“çœŸå¦‚é“,è€Œä»Šè¿ˆæ­¥ä»å¤´è¶Š.**








URL: https://sunyazhou.com/2017/12/markdownAudio/index.html.md
Published At: 2017-12-27 12:04:07 +0000

# Markdownä¸­æ’å…¥éŸ³é¢‘æ–‡ä»¶

# å‰è¨€

å–œæ¬¢åœ¨åšå®¢æ–‡ç« æ‰“å¼€çš„æ—¶å€™ æ’­æ”¾ä¸€é¦–èƒŒæ™¯éŸ³ä¹, ä½†Markdownæœ¬èº«æ˜¯ä¸æ”¯æŒæ’å…¥éŸ³é¢‘è§†é¢‘,å¸¦ç€è¿™ä¸ªç–‘é—®å¼€å§‹è¿™ç¯‡æ–‡ç« .


## markdownæ’å…¥éŸ³ä¹

`markdown`å…¶å®å°±æ˜¯ ä¸€ç§`html`çš„è½¬æ¢è¯­æ³•,å…¶å®å†…éƒ¨ä¹ŸåŒæ—¶æ”¯æŒç›´æ¥å†™`html`æ ‡ç­¾, å¦‚æœä¸äº†è§£å„ç§æ ‡ç­¾è¯·ç‚¹å‡»[w3cschool](https://www.w3schools.com/tags/tag_iframe.asp)æŸ¥çœ‹å„ç§ API çš„ç”¨æ³•,æ­¤æ—¶è¦ç”¨åˆ°çš„æ ‡ç­¾ä¸º`iframe`ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œå…¶ä¸­

* `div`ç”¨äºæ§åˆ¶æ ¼å¼ï¼Œè‹¥æ— åˆ™é»˜è®¤ä¸ºå±…å·¦
* `frameborder`ç”¨äºè§„å®šæ˜¯å¦æ˜¾ç¤ºæ¡†æ¶å‘¨å›´çš„è¾¹æ¡†ï¼Œ1ä¸ºæ˜¯ï¼Œ0ä¸ºå¦
* `marginwidth`åŠ`marginheight`è¡¨ç¤ºè·ç¦»è¾¹ç¼˜çš„åƒç´ å¤§å°
* `width`åŠ`height`è¡¨ç¤ºæ’­æ”¾æ¡çš„é•¿åº¦å’Œå®½åº¦
* `src`ä¸ºæ’­æ”¾é“¾æ¥ï¼Œå¯ä»¥åœ¨å¦‚ç½‘æ˜“äº‘éŸ³ä¹çš„`ç”Ÿæˆå¤–é“¾æ’­æ”¾å™¨`è·å–è¯¥é“¾æ¥ï¼ŒåŒæ—¶ä¹Ÿè·å¾—ä»¥ä¸‹ä»£ç ï¼Œå¹¶å¯ä»¥è‡ªè¡Œæ›´æ”¹ï¼›ä¹Ÿå¯å°†éŸ³é¢‘é“¾æ¥æ”¹ä¸ºè§†é¢‘é“¾æ¥ï¼Œä»è€Œæ’­æ”¾è§†é¢‘

> å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒéŸ³é¢‘å’Œè§†é¢‘åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¼šè‡ªåŠ¨å¾ªç¯æ’­æ”¾çš„ï¼Œå¯ä»¥ä¿®æ”¹é“¾æ¥çš„å€¼è¿›è¡Œä¿®æ”¹ 
åœ¨`src`åŸŸä¸­ï¼Œ`auto`å€¼è¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨æ’­æ”¾ï¼Œå½“å€¼ä¸º`1`æ—¶ä¸ºè‡ªåŠ¨æ’­æ”¾ï¼Œ`0`åˆ™ä¸æ˜¯
åœ¨`src`åŸŸä¸­ï¼Œæœ‰äº›é“¾æ¥ä¼šé™„æœ‰`height`æˆ–`width`å€¼ï¼Œå…¶è¡¨ç¤ºè¡¨ç¤ºæ’­æ”¾æ¡†çš„åŸºæœ¬å®½é«˜ï¼Œå¯ä»¥æ›´æ¢å…¶å€¼ä»¥è·å¾—æƒ³è¦çš„æ’­æ”¾æ¡†å¤§å°ï¼Œæ­¤æ—¶å¯ä»¥ä¸ç”¨å¡«å†™å¤–éƒ¨çš„`width`åŠ`height`.

``` html
<div align=life> 
<iframe frameborder="no" marginwidth="0" marginheight="0" width=400 height=140 src="https://music.163.com/outchain/player?type=2&id=34341360&auto=0&height=66"></iframe>
</div>
```


<div align=life> 
<iframe frameborder="no" marginwidth="0" marginheight="0" width=400 height=140 src="https://music.163.com/outchain/player?type=2&id=34341360&auto=0&height=66"></iframe>
</div>


## æ¥å£è¯´æ˜

è¿™é‡Œé¢å¯ä»¥çœ‹åˆ° ç”¨äº† 

``` 
https://music.163.com/outchain/player?type=2&id=34341360&auto=0&height=66
```

è¿™ä¸ªæ¥å£çš„`id=34341360`æ˜¯ä»è¿™é‡Œè·å–çš„

![](/assets/images/20171227MarkdownAudio/markdownAudio1.webp)

æ‰¾åˆ°`å¤åˆ¶é“¾æ¥`,ç„¶åç”¨æµè§ˆå™¨æ‰“å¼€.

![](/assets/images/20171227MarkdownAudio/markdownAudio2.webp)

åè¾¹çš„ `id=34341360`å°±æ˜¯æˆ‘ä»¬è¦çš„ `id` ç„¶åæ¥å£æ›¿æ¢å°±å¯ä»¥äº†


æ›´å¤šæŠ€å·§å¯å‚è€ƒä»¥å‰å†™çš„ä¸€ç¯‡æ–‡ç«   
[markdownæŠ˜å ](https://www.sunyazhou.com/2017/10/25/20171025markdownSkill/)    
[markdown è¡¨æ ¼](https://www.sunyazhou.com/2017/09/29/20170929MarkdownTable/)

å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2017/12/AudioPan/index.html.md
Published At: 2017-12-19 11:40:13 +0000

# éŸ³é¢‘å£°åƒPanå€¼ç”µå¹³å·¦å³å£°é“å¹³è¡¡

![](/assets/images/20171219AudioPan/AudioPan.webp)


# å‰è¨€

æœ€è¿‘åœ¨å¼€å‘å¤šåª’ä½“éŸ³è§†é¢‘ç›¸å…³ä¸šåŠ¡,æœŸé—´é‡åˆ°çš„é—®é¢˜è¿™é‡Œå…¨åšè®°å½•ä¸‹æ¥,ä¸‹é¢æ˜¯åŒäº‹æä¾›çš„ä¸€ä¸ªä¾‹å­æˆ‘æ•´ç†å‡ºæ¥,ä»¥å¤‡åç»­å¼€å‘é‡åˆ°æ­¤ç±»é—®é¢˜æœ‰ä¸ªå¤‡æ¡ˆ.

## å¼€ç¯‡

æœ€è¿‘å¼€å‘éŸ³é¢‘æ¶‰åŠåˆ°å·¦å³å£°é“è°ƒèŠ‚,åŸºäºå·¦å³å£°é“çš„éŸ³é‡å®ç° å£°éŸ³ç¯ç»•æ•ˆæœ.
ä¸‹é¢æ˜¯ UI æ¼”ç¤º.


![](/assets/images/20171219AudioPan/AudioPanDemo.gif)


è¿™é‡Œå…¶å®ä¿®æ”¹çš„ç±»ä¼¼ `AVAudioPlayer`é‡Œé¢çš„`pan`å€¼ä¿®æ”¹

![](/assets/images/20171219AudioPan/PanAudioApi.webp)


æˆ‘åœ¨ä»¥å‰çš„æ–‡ç« ä¹Ÿæœ‰ä¸€ç¯‡æåˆ°è¿‡è¿™ä¸ª[pan å€¼](https://www.sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/)


å¯èƒ½å¤§å®¶ä¸ç†è§£ä¸ºå•¥ è¿™ä¸ª API èµ·åå«`pan`

åœ¨å£°å­¦é¢†åŸŸè¿™ä¸ªä¸œè¥¿æœ‰ä¸“é—¨çš„åå­—å« `å£°åƒ`.

[è¿™ç¯‡æ–‡ç« ](http://underwaysoft.com/writing/books/dsp-develop.html#%E7%BA%BF%E6%80%A7%E5%A3%B0%E5%83%8F%EF%BC%88<span class=cnBracket>Pan</span>%EF%BC%89)ä»‹ç»äº†ä¸€äº›æˆ‘ä»¬å¯¹å£°å­¦çŸ¥è¯†çš„ç®€å•ä»‹ç»,è™½ç„¶ä¸çŸ¥é“ä½œè€…æ˜¯è°,ä½†æ˜¯ä½œè€…åº”è¯¥æ˜¯éå¸¸ä¸“ä¸šçš„å£°å­¦å¼€å‘è€….

å…¶å®æŒ‰ç…§æˆ‘ä»¬å¹³å¸¸çš„ç†è§£åº”è¯¥æ˜¯è¿™æ ·å»å®ç°è¿™ä¸ª pan å€¼çš„ä¿®æ”¹


å·¦å£°é“éŸ³é‡ç»™å³å£°é“å£°éŸ³çš„è¡¥å¿ æˆ–è€…å³ä¾§å£°é“ç»™å·¦ä¾§å£°é“çš„è¡¥å¿,é€šè¿‡æ»‘å—çš„ value æ¥å†³å®šä¸¤è¾¹è°åŠ å¤šå°‘å‡å¤šå°‘,ä½†æ˜¯å¤§å®¶çš„æ€è·¯æ˜¯å¯¹çš„,ä½†æ˜¯åšæ³•æ˜¯ä¸æ­£ç¡®çš„,å› ä¸º ä¸¤è¾¹çš„éŸ³é‡æ”¾åœ¨ä¸­é—´å¿…é¡»æ˜¯1.0,ä¹Ÿå°±æ˜¯è¯´ range åœ¨ `-1 ~ 1`ä¹‹é—´. å¦‚æœæŒ‰ç…§è¿™ä¸ªæ»‘åŠ¨æ–¹å¼å›å¯¼è‡´æ»‘åŠ¨è¿‡å¤§. 

å¸¦ç€è¿™ä¸ªé—®é¢˜æˆ‘çš„åŒäº‹æ‰¾åˆ°äº†ä¸€ä¸ªå…¬å¼ æ¥è®¡ç®— è¿™ä¸ªå€¼


![](/assets/images/20171219AudioPan/PanAlgorithm.webp)


* `pan`å°±æ˜¯æˆ‘ä»¬çš„æ»‘å—çš„`value`
* `Vl` ä»£è¡¨å·¦ä¾§éŸ³é‡
* `Vr` ä»£è¡¨å³ä¾§éŸ³é‡


æ ¹æ®è¿™ä¸ªå…¬å¼æˆ‘ä»¬æœ‰å¦‚ä¸‹ ä»£ç 


``` objc

#import <math.h>

typedef NS_ENUM(NSUInteger, KSYMCChannelType) {
    KSYMCChannelTypeLeft = 0,
    KSYMCChannelTypeRight = 1
};

@interface KSYMultiCanvasHelper : NSObject

+ (CGFloat)calculateVolume:(KSYMCChannelType)type
                  panValue:(CGFloat)pan
                    volume:(CGFloat)volume;

@end



@implementation KSYMultiCanvasHelper

+ (CGFloat)calculateVolume:(KSYMCChannelType)type
                  panValue:(CGFloat)pan
                    volume:(CGFloat)volume{
    if (type == KSYMCChannelTypeLeft) {
        CGFloat leftVolumn = sqrt(2) * cos((1 + pan)*M_PI_4) *volume;
        return leftVolumn;
    } else if (type == KSYMCChannelTypeRight) {
        CGFloat rightVolumn = sqrt(2) * sin((1 + pan)*M_PI_4) *volume;
        return rightVolumn;
    }
    
    return 0;
}
@end
```

è¿™é‡Œçš„è®¡ç®—è¿˜æ˜¯æ¯”è¾ƒå‡†ç¡®çš„.

ç»è¿‡æµ‹è¯• å·¦ä¾§ éŸ³é‡ ä¸º 0 æ—¶ å³ä¾§éŸ³é‡åº”è¯¥æ˜¯ 1.41å·¦å³


## æ€»ç»“

ç»è¿‡ä¸Šè¿°æµ‹è¯•éŸ³é¢‘çš„ pan å€¼ä¿®æ”¹ å¦‚æœè‡ªè¡Œå¼€å‘è¿˜æ˜¯æ¯”è¾ƒå¥½æå¾—,åªæ˜¯é„™äººå¯¹éŸ³é¢‘çš„çŸ¥è¯†ç§¯ç´¯çš„å¤ªå°‘äº†.è¿™ç¯‡æ–‡ç« çœ‹èµ·æ¥è™½ç„¶æ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡,å…¨å½“çŸ¥è¯†çš„ç‚¹æ»´ç§¯ç´¯å§. è‡³äºä¸ºå•¥ æ˜¯ `M_PI_4`è¿˜è¯·ä¸“ç ”ä¸€ä¸‹æ–‡ç« çš„æ‰©å±•é“¾æ¥,å› ä¸ºè¦æŠŠä¸€ä¸ªçº¿æ€§çš„æ“ä½œè½¬æ¢æˆä¸€ä¸ªåœ†å‹æ–¹ä¾¿æ•°å­¦çš„è®¡ç®—,ä»¥åŠ **å£°åƒ**å’Œ**å£°å‘**çš„åŒºåˆ«.

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/12/CellAddKVO/index.html.md
Published At: 2017-12-15 17:05:10 +0000

# UICollectionViewCellæ·»åŠ KVO

![](/assets/images/20171215CellAddKVO/UICollectionViewCell.webp)


# å‰è¨€

éƒ½ä¸€ä¸ªå¤šæœˆæ²¡æ›´æ–°åšå®¢äº†,è¿™ä¸€æ®µæ—¶é—´å¤ªå¿™äº†. è¿™ç¯‡å¸¦æ¥çš„åˆ†äº«å†…å®¹æ˜¯**å¦‚ä½•æ­£ç¡®çš„ç»™ä¸€ä¸ª`UICollectionViewCell`æ·»åŠ `KVO`ç›‘å¬**.


## å¼€ç¯‡

ç”±äºç›®å‰åœ¨å¼€å‘[çŸ­è§†é¢‘](https://github.com/ksvc/KSYMediaEditorKit_iOS)ç›¸å…³çš„SDK,é¢å‘çš„å¤šæ•°éƒ½æ˜¯å°ç™½å¼€å‘è€…,ä¸ºäº†èƒ½è®©å°ç™½ä»¥æœ€ä½çš„æˆæœ¬çœ‹æ‡‚ SDK çš„ä»£ç ä»¥åŠç”¨æ³•,è¿™å°±è¦æ±‚æˆ‘ä»¬ä»¥å°ç™½æœ€å®¹æ˜“ç†è§£çš„æ–¹å¼å¼€å‘ä»£ç ,æ¯”å¦‚æœ€ä½çº§çš„`MVC`æ¨¡å¼,æœ€ç›´ç™½çš„`Objective-C`(è€å®è¯´æˆ‘éƒ½çƒ¦é€äº† OC è¿™ç§è¶…çº§é•¿çœ‹ç€éƒ½éš¾å—çš„ç¼–ç¨‹è¯­è¨€,æ—©æƒ³ç”¨ swift æ¥ç©ä¸€æŠŠäº†),æ‰€ä»¥åœ¨å¼€å‘çš„æŠ€æœ¯é€‰å‹å’Œä»£ç ç¼–å†™è¿‡ç¨‹ä¸­éƒ½æ˜¯è¾¾åˆ°å°ç™½æœ€ä½çš„ç†è§£èƒ½åŠ›çš„å¼€å‘æ¨¡å¼,ä½†æœ‰æ—¶å€™ä¸å¾—ä¸é¢å¯¹åœ¨*å°ç™½èƒ½ç†è§£*å’Œ*åŠŸèƒ½çš„é«˜çº§å®ç°*ä¹‹é—´åšå¦¥å.æœ€è¿‘å¼€å‘é‡åˆ°ä¸ªé—®é¢˜,å¦‚ä¸‹:

> PM æœ‰ä¸ªéœ€æ±‚ è¦å®ç°åœ¨ä¸€ä¸ªå±å¹•å†…å¤šä¸ª cell ä¸Šéšæ„åˆ‡æ¢ å½•åˆ¶è§†å›¾å¹¶ä¸”èƒ½éšæ„ç‚¹å‡»å–æ¶ˆ,å†åŠ ä¸Šå½•åˆ¶å®Œæˆçš„è§†é¢‘å¦‚æœä¸åœ¨é€‰ä¸­çŠ¶æ€å°±æ˜¾ç¤ºå°é¢,å¦‚æœåœ¨é€‰ä¸­çŠ¶æ€å°±ç»§ç»­é¢„è§ˆ,å¦‚æœæ²¡æœ‰å½•åˆ¶å®Œçš„è§†é¢‘å¹¶ä¸”ä¸åœ¨é¢„è§ˆçš„ CELLè¦æ˜¾ç¤ºæ·»åŠ åŠŸèƒ½.

å¬å®Œè¿™ä¸ªéœ€æ±‚æ˜¯ä¸æ˜¯éƒ½æ™•äº†,æˆ‘ä»¬æ¥çœ‹å¼ æˆ‘å®ç°å®Œæˆçš„å›¾.

![](/assets/images/20171215CellAddKVO/RecordDemo.gif)

1. å½•åˆ¶å®Œçš„è§†é¢‘å–å‡ºå°é¢
2. æ­£åœ¨é¢„è§ˆçš„éšæ—¶å‡†å¤‡å½•åˆ¶
3. éšæ„èƒ½åˆ‡æ¢ cell ä¸å½±å“å½•åˆ¶è§†å›¾
4. æœªå½•åˆ¶çš„å¹¶ä¸”æ²¡æœ‰å·²å½•åˆ¶å®Œè§†é¢‘æ–‡ä»¶çš„ cell æ˜¾ç¤º æ·»åŠ æŒ‰é’®

ç¬¬ä¸€çœ¼çœ‹ç€æ²¡å•¥æŠ€æœ¯å«é‡éƒ½ UI æ˜¯å§

å¥½æˆ‘ä»¬æ¥ç©ç‚¹æœ‰æŠ€æœ¯å«é‡çš„


#### é—®é¢˜1

å¦‚æœä½¿ç”¨ä¼ ç»ŸMVC æ¨¡å¼çš„è¯`Cell`ä¸Šè¾¹æ˜¾ç¤ºæ•°æ®,é‚£`model`é‡Œé¢æ˜¯ä¸æ˜¯è¦æ”¾ä¸€ä¸ª`record`çš„å®ä¾‹å¯¹è±¡ å‘Šè¯‰å®ƒ å•¥æ—¶å€™å¼€å§‹å•¥æ—¶å€™ç»“æŸ,å½“ç„¶ä½ æœ‰æ›´å¥½çš„æ–¹å¼æˆ‘å°±ä¸è¯´äº†æˆ‘å…¶å®ä¹ŸçŸ¥é“.

#### é—®é¢˜2

å–å‡ºå°é¢å¾ˆç®€å•è®© cellé‡Œé¢å­˜å‚¨ä¸€ä¸‹å½•åˆ¶å®Œçš„ URL å°±å¯ä»¥äº†,ç„¶åæ¯æ¬¡è°ƒç”¨ UICollectonView çš„ `reload:`æ–¹æ³•

#### é—®é¢˜3

æˆ‘ä»¬å®ç°å½•åˆ¶è§†å›¾çš„æ–¹å¼æ˜¯æ”¾åœ¨ cell çš„ä¸€ä¸ª subview ä¸Š, æ­£åœ¨å½•åˆ¶çš„è§†å›¾å¦‚æœ reload çš„è¯ åº”è¯¥ä¼šç¬é—´æ²¡äº†.å°±ç®—å­å“§å­å“§å®ç°å®Œå¼€å§‹å½•åˆ¶ã€æš‚åœå½•åˆ¶ã€æ¢å¤å½•åˆ¶ã€ç»“æŸå½•åˆ¶... è¿™æ´»æˆ‘è§‰å¾—é—®é¢˜å’Œéšæ‚£åº”è¯¥éå¸¸å¤š.åˆ«æƒ³äº† ä¸èƒ½è¿™ä¹ˆç©

#### é—®é¢˜4

cellçš„é€‰ä¸­å’Œéé€‰ä¸­é—®é¢˜,ä½ æœ‰æ²¡æœ‰å‘ç° å¦‚æœæ­£åœ¨å½•åˆ¶çš„ cell ä¸Šçš„ view æ˜¯é€‰ä¸­çš„æœ‰ä¸ªçº¢è‰²çš„æ¡†ä»£è¡¨å½“å‰å±äº ç„¦ç‚¹çŠ¶æ€.
é‚£å½•åˆ¶å®Œæˆå‘¢.æ˜¯ä¸æ˜¯éœ€è¦é‡æ–° reload cell å‘Šè¯‰å®ƒå½“å‰è° é€‰ä¸­ è°å–æ¶ˆ,å¦‚æœç‚¹å‡»çš„æ˜¯åŒä¸€ä¸ª cell è¿˜è¦å–åæ“ä½œ.å¦‚æœæ­£åœ¨é¢„è§ˆæ˜¯ä¸æ˜¯å†æ¬¡é€‰ä¸­è¯´æ˜è¦åœæ­¢é¢„è§ˆæ˜¾ç¤ºåŠ å·æˆ–è€…å°é¢å›¾,æƒ³ç€æƒ³ç€ä½ å‘ç°è¿™ç©æ„æ˜¯ä¸ªçŠ¶æ€æœº.å¿…é¡»è¦æƒ³å¥½ model æ„é€ ,è¦è®©model çš„å‚æ•°è¶³å¤Ÿå¤šå»æ§åˆ¶å½“å‰ cell çš„é€‰ä¸­çŠ¶æ€ã€éé€‰ä¸­çŠ¶æ€ã€é¢„è§ˆçŠ¶æ€ã€éé¢„è§ˆçŠ¶æ€ã€å½•åˆ¶çŠ¶æ€ã€éå½•åˆ¶çŠ¶æ€ã€å½•å®ŒçŠ¶æ€ã€åœæ­¢å½•åˆ¶çŠ¶æ€... æƒ³ç€æƒ³ç€ å¤ªéº»çƒ¦äº† äºæ˜¯æˆ‘æ•´ç†å‡ºä¸€ä¸ªçŠ¶æ€æœºçš„è¡¨æ ¼ å¦‚ä¸‹:


| Cell Status | å½“å‰cellæ˜¾ç¤ºå†…å®¹ |å…¶å®ƒ cell æ˜¾ç¤ºå†…å®¹| ç‚¹å‡»å½“å‰ | ç‚¹å‡»å…¶å®ƒé€‰ä¸­ |
| :------: | :------: | :------: | :------: | :------: |
| æ— é¢„è§ˆçŠ¶æ€ | æ˜¾ç¤ºåŠ å·/å°é¢å›¾ | æ˜¾ç¤ºåŠ å·/æˆ–è€…å°é¢ | å¼€å§‹é¢„è§ˆ | åˆ‡æ¢é¢„è§ˆè§†å›¾ |
| æ­£åœ¨é¢„è§ˆçŠ¶æ€ | é¢„è§ˆè§†é¢‘ | æ˜¾ç¤ºåŠ å·/æˆ–è€…å°é¢ | æ˜¾ç¤ºåŠ å·/æˆ–è€…å°é¢ | åˆ‡æ¢é¢„è§ˆè§†å›¾ |
| æ­£åœ¨å½•åˆ¶çŠ¶æ€ | é¢„è§ˆè§†é¢‘/æ’­æ”¾è§†é¢‘ | (æ˜¾ç¤ºåŠ å·æˆ–æ’­æ”¾è§†é¢‘)/(æ˜¾ç¤ºåŠ å·æˆ–é¢„è§ˆè§†é¢‘) | æ— æ“ä½œ(ä¸Šé”) | æ— æ“ä½œ(ä¸Šé”) |


> _è¿™äº›ä¸é‡è¦,æœ‰è¿™ä¸ªå°è±¡å°±è¡Œäº†ä¸ç”¨ä»”ç»†çœ‹_

å¹¶ä¸æ˜¯æˆ‘æŠŠé—®é¢˜å¤æ‚åŒ–,æ˜¯ PM çš„éœ€æ±‚å¤ªå¤æ‚.ä¸å¾—ä¸å®Œæ•´åˆ—å‡ºæ‰€æœ‰çŠ¶æ€,ç²¾ç®€,å†ç²¾ç®€,è®©å°ç™½å¼€å‘è€…ä¹Ÿèƒ½çœ‹æ‡‚çš„ SDK æ‰æ˜¯å¥½ SDK.


å…¶å® å…¶å®ƒçš„é—®é¢˜è¿˜æœ‰å¥½å¤š æˆ‘å°±ä¸åˆ—å‡ºæ¥äº†,å¥½ ç°åœ¨æˆ‘ä»¬æ¥ä¾æ¬¡è§£å†³é—®é¢˜



**å…¶å®,ç»¼åˆä¸Šè¿°ä¿¡æ¯æ¥çœ‹,å½’æ ¹ç»“åº•çš„åŸå› æ˜¯,å®ç°è¿™ä¸ªå½•åˆ¶éšæ„åˆ‡æ¢åŠŸèƒ½ç­‰ç­‰çš„äº¤äº’å¹¶ä¸é€‚ç”¨äº`MVC`è¿™ç§ä¼ ç»Ÿçš„ç©æ³•.
æ›´åƒæ˜¯ä¸€ä¸ª`MVVM`çš„ææ³•**,äºæ˜¯æˆ‘æƒ³åˆ°äº† MVVM é‡Œé¢çš„ç²¾é«“æ‰€åœ¨.è¦ç”¨**æ•°æ®é©±åŠ¨è§†å›¾**.

ä¸Šé¢çš„4ä¸ªä¸»è¦é—®é¢˜ä¸å°±æ˜¯å› ä¸º model çš„çŠ¶æ€ä¿®æ”¹äº†è¦é€šçŸ¥ cell å˜åŒ–å˜›.é‚£æˆ‘ä»¬ä½¿ç”¨ model çš„çŠ¶æ€æ¥æ§åˆ¶

> æ³¨æ„:_å¦‚æœä½¿ç”¨ MVVM çš„ç©æ³•å°±ä¸è¦å†å»è°ƒç”¨ collectionview çš„ reload:æ–¹æ³•äº†_

ç›®å‰å¼€å‘å®ç°`MVVM`çš„æ–¹å¼ä¸»æµä¸¤ç§

* RAC
* KVO

æ˜¾ç„¶`RAC`å¤ªå¤§å¹¶ä¸é€‚ç”¨äºæˆ‘ä»¬ demo,ç”¨ KVO æä¸€æŠŠ.(ä»£ç æœ‰åˆ å‡)

#### ç¬¬ä¸€æ­¥å®šä¹‰ model

``` objc
typedef void (^CompletionHandler)(UIImage * image); //å–å‡º Image ç»™ Cell æ˜¾ç¤ºçš„å›è°ƒ

typedef NS_ENUM(NSUInteger,KSYMultiCanvasModelStatus){
    KSYMultiCanvasModelStatusNOPreview = 0,//æ— é¢„è§ˆçŠ¶æ€
    KSYMultiCanvasModelStatusINPreview = 1,//æ­£åœ¨é¢„è§ˆçŠ¶æ€
    KSYMultiCanvasModelStatusRecording = 2 //æ­£åœ¨å½•åˆ¶çŠ¶æ€
};

@interface KSYCanvasModel : NSObject 
@property (nonatomic, strong) NSURL  *videoURL; //å­˜æ”¾å½•åˆ¶å®Œè§†é¢‘ URL
@property (nonatomic, assign) BOOL   isSelected;//æ˜¯å¦æ˜¯é€‰ä¸­
@property (nonatomic, assign) KSYMultiCanvasModelStatus modelStatus; //é‡è¦!!!:æ¨¡å‹çŠ¶æ€ç”¨å®ƒæ§åˆ¶ cell æ˜¾ç¤º
- (void)gengrateImageBySize:(CGSize)size
          completionHandler:(CompletionHandler)handler;

@end

@interface KSYCanvasModel ()

@property(nonatomic, strong)AVAssetImageGenerator *imageGenerator;
@end

@implementation KSYCanvasModel

- (void)gengrateImageBySize:(CGSize)size
          completionHandler:(CompletionHandler)handler{
    if (self.videoURL == nil) { handler(nil); }
    
    AVURLAsset *asset = [AVURLAsset assetWithURL:self.videoURL];
    self.imageGenerator = nil;
    self.imageGenerator = [AVAssetImageGenerator assetImageGeneratorWithAsset:asset];
    self.imageGenerator.maximumSize = size;
    
    NSError *error=nil;
    CMTime time= kCMTimeZero;//CMTimeæ˜¯è¡¨ç¤ºç”µå½±æ—¶é—´ä¿¡æ¯çš„ç»“æ„ä½“ï¼Œç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºæ˜¯è§†é¢‘ç¬¬å‡ ç§’ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ¯ç§’å¸§æ•°.(å¦‚æœè¦æ´»çš„æŸä¸€ç§’çš„ç¬¬å‡ å¸§å¯ä»¥ä½¿ç”¨CMTimeMakeæ–¹æ³•)
    CMTime actualTime;
    CGImageRef cgImage= [self.imageGenerator copyCGImageAtTime:time actualTime:&actualTime error:&error];
    if(error){
        NSLog(@"æˆªå–è§†é¢‘ç¼©ç•¥å›¾æ—¶å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ï¼š%@",error.localizedDescription);
        handler(nil);
        return;
    }
    CMTimeShow(actualTime);
    UIImage *image = [UIImage imageWithCGImage:cgImage];//è½¬åŒ–ä¸ºUIImage
    CGImageRelease(cgImage);
    handler(image);
}
@end

```


ok model å¤§æ¦‚æ˜¯è¿™æ · .m æ–‡ä»¶ä¸»è¦æ˜¯ä»è§†é¢‘ä¸­å–å°é¢å›¾


#### ç¬¬äºŒæ­¥å®šä¹‰ cell

``` objc
#import <UIKit/UIKit.h>
#import "KSYCanvasModel.h"

static const NSString *KSYModelKVOStatusContext;
static NSString *KSYKeyPathForModelStatus = @"modelStatus";
static NSString *KSYKeyPathForIsSelected = @"isSelected";

@interface KSYCanvasCell : UICollectionViewCell
@property (weak, nonatomic) IBOutlet UIView *canvasImageView;
@property (weak, nonatomic) IBOutlet UIImageView *addImageView;
@property (weak, nonatomic) IBOutlet UIImageView *boundsView;

@property (nonatomic, strong) KSYCanvasModel *model;

//æ³¨å†Œå’Œç§»é™¤è§‚å¯Ÿæ¥å£
- (void)addObserver:(NSObject *)observer
         forKeyPath:(NSString *)keyPath
            options:(NSKeyValueObservingOptions)options
            context:(void *)context;
- (void)removeObserver:(NSObject *)observer
            forKeyPath:(NSString *)keyPath 
               context:(void *)context;

@end

@interface KSYCanvasCell()
// ä½¿ç”¨ ObservableKeys ä¿å­˜ keyPath è§‚å¯ŸçŠ¶æ€ï¼Œé¿å…é‡å¤æ³¨å†Œå’Œé‡å¤ç§»é™¤ï¼ˆé‡å¤ç§»é™¤ä¼šå¯¼è‡´ crashï¼‰
@property (nonatomic, strong) NSMutableSet *observableKeySets;
@end

@implementation KSYCanvasCell

- (void)awakeFromNib {
    [super awakeFromNib];
    
    //åƒä¸‡åˆ«æŠŠ KOV ç›‘å¬å†™åœ¨è¿™é‡Œ
}

//.,,æ­¤å¤„çœç•¥äº†ä¸å¤ªç›¸å…³çš„ä»£ç 

- (void)addObserver:(NSObject *)observer
         forKeyPath:(NSString *)keyPath
            options:(NSKeyValueObservingOptions)options
            context:(void *)context{
    if ([self.observableKeySets containsObject:keyPath]) { return; }
    
    if (self.observableKeySets == nil) {
        self.observableKeySets = [NSMutableSet set];
    }
    
    [self.observableKeySets addObject:keyPath];
    
    [self.model addObserver:observer
                 forKeyPath:keyPath
                    options:options
                    context:context];
}

- (void)removeObserver:(NSObject *)observer
            forKeyPath:(NSString *)keyPath
               context:(void *)context{
    if (![self.observableKeySets containsObject:keyPath]) { return; }
    
    [self.model removeObserver:observer
                    forKeyPath:keyPath
                       context:context];
    [self.observableKeySets removeObject:keyPath];
}

- (void)observeValueForKeyPath:(NSString *)keyPath
                      ofObject:(id)object
                        change:(NSDictionary<NSKeyValueChangeKey,id> *)change
                       context:(void *)context{
    if ([KSYKeyPathForModelStatus isEqualToString:keyPath]) {
        KSYMultiCanvasModelStatus modelStatus = [[change objectForKey:NSKeyValueChangeNewKey] integerValue];
        NSLog(@"å½“å‰çŠ¶æ€:%zd",modelStatus);
		 //æ‹¿åˆ°æ¨¡å‹çŠ¶æ€ç„¶ååšé€‚å½“çš„å¤„ç†
    } else if([KSYKeyPathForIsSelected isEqualToString:keyPath]){
        //å¤„ç†æ˜¯å¦æ˜¾ç¤ºè¾¹æ¡†
    }
}

@end

```


> è¿™é‡Œè¦åœ¨.h é‡Œé¢å¤å†™ ä¸‹é¢è¿™ä¿©ä¸ªæ–¹æ³• å› ä¸ºè¦å† ViewController é‡Œé¢æ‹¿åˆ° cell è°ƒç”¨è¿™ä¸ªæ–¹æ³•

* `addObserver:forKeyPath:options:context:` è¿™ä¸ªæ–¹æ³•æ˜¯ç³»ç»Ÿæ–¹æ³•éœ€è¦å¤å†™å¹¶å¯¹å¤–æš´éœ²æ¥å£
* `removeObserver:forKeyPath:context:` è¿™ä¸ªæ–¹æ³•æ˜¯ç³»ç»Ÿæ–¹æ³•éœ€è¦å¤å†™å¹¶å¯¹å¤–æš´éœ²æ¥å£


è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ç”¨äºæ‰¾åˆ°è¯†åˆ«è¿™ä¸ªåœ¨ cellçš„ç›‘å¬è¿˜æœ‰ä¸¤ä¸ªè¦ç›‘å¬çš„å±æ€§(KSYCanvasCell.h é¡¶éƒ¨)

``` objc
static const NSString *KSYModelKVOStatusContext;
static NSString *KSYKeyPathForModelStatus = @"modelStatus";
static NSString *KSYKeyPathForIsSelected = @"isSelected";

```

> æ³¨æ„:**ä¸ºäº†é˜²æ­¢ cell é‡å¤æ³¨å†Œå¯¼è‡´å¤ç”¨çš„æ—¶å€™å´©æºƒ,è¿™é‡Œç”¨`NSMutableSet`è®© model çš„è§‚å¯Ÿè€…åªæ³¨å†Œä¸€æ¬¡**

``` objc
@interface KSYCanvasCell()
// ä½¿ç”¨ ObservableKeys ä¿å­˜ keyPath è§‚å¯ŸçŠ¶æ€ï¼Œé¿å…é‡å¤æ³¨å†Œå’Œé‡å¤ç§»é™¤ï¼ˆé‡å¤ç§»é™¤ä¼šå¯¼è‡´ crashï¼‰
@property (nonatomic, strong) NSMutableSet *observableKeySets;
@end
```

æ·»åŠ çš„æ—¶å€™åšä¸€æ¬¡check

``` objc
- (void)addObserver:(NSObject *)observer
         forKeyPath:(NSString *)keyPath
            options:(NSKeyValueObservingOptions)options
            context:(void *)context{
    if ([self.observableKeySets containsObject:keyPath]) { return; }
    
    if (self.observableKeySets == nil) {
        self.observableKeySets = [NSMutableSet set];
    }
    
    [self.observableKeySets addObject:keyPath];
    
    ...
}
```

ç§»é™¤çš„æ—¶å€™è¦åšä¸€æ¬¡ check

``` objc
- (void)removeObserver:(NSObject *)observer
            forKeyPath:(NSString *)keyPath
               context:(void *)context{
    if (![self.observableKeySets containsObject:keyPath]) { return; }
    
    [self.model removeObserver:observer
                    forKeyPath:keyPath
                       context:context];
    [self.observableKeySets removeObject:keyPath];
}
```

ok cell å¤§æ¦‚æ˜¯è¿™ä¸ªæ„æ€

#### ç¬¬ä¸‰æ­¥åœ¨ ViewControlleré‡Œé¢ é€‚å½“çš„ä½ç½® æ³¨å†Œ/ç§»é™¤ç›‘å¬ å¹¶åœ¨ViewControlleræ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸå†…ä¹Ÿåšå¥½ç›¸å…³ç›‘å¬çš„ç§»é™¤å’Œæ·»åŠ 

è¿™é‡Œæˆ‘ä»¬éœ€è¦å®ç°`UICollectionViewDelegate`çš„ä»£ç†åè®®æ¥è°ƒç”¨ cell çš„æ·»åŠ  cell å’Œç§»é™¤ cell

``` objc
- (void)collectionView:(UICollectionView *)collectionView willDisplayCell:(UICollectionViewCell *)cell forItemAtIndexPath:(NSIndexPath *)indexPath{
    KSYCanvasCell *canvasCell = (KSYCanvasCell *)cell;
    [canvasCell addObserver:canvasCell
                 forKeyPath:KSYKeyPathForModelStatus
                    options:NSKeyValueObservingOptionNew
                    context:&KSYModelKVOStatusContext];
    [canvasCell addObserver:canvasCell
                 forKeyPath:KSYKeyPathForIsSelected
                    options:NSKeyValueObservingOptionNew
                    context:&KSYModelKVOStatusContext];

}

- (void)collectionView:(UICollectionView *)collectionView didEndDisplayingCell:(UICollectionViewCell *)cell forItemAtIndexPath:(NSIndexPath *)indexPath{
    KSYCanvasCell *canvasCell = (KSYCanvasCell *)cell;
    //çŠ¶æ€å˜åŒ–
    [canvasCell removeObserver:canvasCell
                    forKeyPath:KSYKeyPathForModelStatus
                       context:&KSYModelKVOStatusContext];
    //é€‰ä¸­å˜åŒ–
    [canvasCell removeObserver:canvasCell
                    forKeyPath:KSYKeyPathForIsSelected
                       context:&KSYModelKVOStatusContext];
}
```

ä½ æ˜¯ä¸æ˜¯ä¼šé—®ä¸ºå•¥å†™è¿™ 

æˆ‘æ¥å‘Šè¯‰æˆ‘æˆ‘é‡åˆ°çš„ä¸€ä¸ªå‘

å¦‚æœä½ åœ¨ ä¸‹é¢çš„æ–¹æ³•é‡Œå†™æ³¨å†Œ åæœä¸å ªè®¾æƒ³,å› ä¸º cell æ˜¯å¤ç”¨çš„,æ¯æ¬¡å¤å†™ KVO éƒ½æ˜¯åœ¨åˆ›å»ºæ–°çš„å¯¹è±¡

``` objc
- (__kindof UICollectionViewCell *)collectionView:(UICollectionView *)collectionView cellForItemAtIndexPath:(NSIndexPath *)indexPath{
    KSYCanvasCell *cell = [collectionView dequeueReusableCellWithReuseIdentifier:[KSYCanvasCell className] forIndexPath:indexPath];
    cell.model = [self.models objectAtIndex:indexPath.row];
    //å¦‚æœå†™åœ¨è¿™é‡Œ
    return cell;
}
```

KVOçš„å®ç°åŸç†å¾ˆç®€å•,å°±æ˜¯æŠŠè¿™ä¸ªå¯¹è±¡çš„ç›‘å¬å±æ€§åœ¨åº•å±‚å¤å†™ä¸€ä¸‹,ç›‘å¬ä¸¤ä¸ªå€¼ä¹‹é—´çš„å˜åŒ–.KVO åŸç†ç›¸å…³çš„å°±ä¸å¤šåºŸè¯äº†,è¿™éƒ½æ˜¯å®¶å¸¸ä¾¿é¥­äº†

æˆ‘ä¸€å¼€å§‹å†™åœ¨äº† cell çš„ awakeFromNib: å› ä¸ºéƒ½æ˜¯ cell æ‹–æ‹½çš„æ§ä»¶,ä½†æ˜¯éº»çƒ¦çœŸæ˜¯æ¥è¸µè€Œè‡³,å„ç§å´©æºƒ

``` objc
- (void)awakeFromNib {
    [super awakeFromNib];
	 //åˆ«å†™åœ¨è¿™é‡Œ    
}
```

å¦‚æœä½ ä¸ä¿¡é‚ªå¯ä»¥è¯•è¯•.


æœ€åæˆ‘ä»¬åœ¨æ§åˆ¶å™¨çš„é€‚å½“ä½ç½®ä¿®æ”¹ model çš„çŠ¶æ€è¿™æ ·å°±åšåˆ°äº†å®æ—¶æ›´æ–° cell



``` objc

- (void)collectionView:(UICollectionView *)collectionView didSelectItemAtIndexPath:(NSIndexPath *)indexPath{
    //------------å¤„ç†ç‚¹å‡»-----------
    KSYCanvasModel *lastModel = [self.models objectAtIndex:self.lastSelectedIndexPath.row];
    KSYCanvasModel *selectedModel = [self.models objectAtIndex:indexPath.row];
    BOOL clickSameCell = (self.lastSelectedIndexPath == indexPath);
    if (clickSameCell) {
        //é€‰æ‹©åŒä¸€ä¸ªcell
        selectedModel.isSelected = !selectedModel.isSelected;
    } else {
        lastModel.isSelected = NO;
        selectedModel.isSelected = YES;   
    }
    selectedModel.modelStatus = KSYMultiCanvasModelStatusRecording; //è¿™å°±ä¼šå‡ºå‘ cellçš„ KVO äº†
}

```


æœ€ååˆ«å¿˜äº†åœ¨ViewControllerçš„ç”Ÿå‘½å‘¨æœŸæ·»åŠ å’Œç§»å‡ºè§‚å¯Ÿè€…

``` objc
- (void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];
    [self.canvasCollectionView.visibleCells enumerateObjectsUsingBlock:^(KSYCanvasCell *cell, NSUInteger idx, BOOL * _Nonnull stop) {
        [cell removeObserver:cell
                  forKeyPath:KSYKeyPathForModelStatus
                     context:&KSYModelKVOStatusContext];
    }];
}

```

è¿™æ ·çš„å®ç°è¿‡ç¨‹å°± è§£å†³äº† ä¸Šè¾¹æåˆ°çš„ é—®é¢˜ 1ã€2ã€3ã€4


è¿™ä¹Ÿæ˜¯æœ€ç²¾ç®€çš„å®ç°æ–¹å¼,ä»¥å°ç™½çš„å¼€å‘è§†è§’ æ¥çœ‹ä¹Ÿéœ€è¦ç†Ÿæ‚‰ä¸€ç‚¹ MVVM äº†.è¿™éƒ½æ˜¯æˆäº† iOS æœ€æ ‡é…äº†.


## æ€»ç»“

è¿™ç§åå‘MVVMæ¨¡å¼å¼€å‘çš„æ–¹å¼ æˆ‘ä¸ªäººè§‰å¾—è¿˜æ˜¯ä¸é”™çš„,è™½ç„¶ç°åœ¨å„ç§MVVMæ ¼å¼æ—©å·²ç»çƒ‚å¤§è¡—äº†,ä½†åªè¦æƒ³èµ·æ¥,ç”¨èµ·æ¥,èƒ½ç”¨ç®€å•ç›´ç™½çš„æ–¹å¼è§£å†³é—®é¢˜,å®ƒå°±æ˜¯å¥½çš„å¼€å‘è®¾è®¡æ¨¡å¼.å½“ç„¶æœ¬ç« ä¹Ÿä¸»è¦è®²äº†ä¸€äº›æŠ€å·§è€Œå·²,ä¸è¶³ä¹‹å¤„è¿˜è¯·å„ä½æŒ‡æ­£.


demoæˆ‘å°±ä¸å†™äº† å¯ä»¥å‚è€ƒ[æˆ‘ä»¬çš„çŸ­è§†é¢‘ demo](https://github.com/ksvc/KSYMediaEditorKit_iOS) multicanvas target


å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/10/ElegantPresentTransition/index.html.md
Published At: 2017-10-31 11:32:17 +0000

# è®ºä¸€ä¸ªä¼˜é›…çš„æ¨¡æ€è½¬åœºçš„è‡ªæˆ‘ä¿®å…»

# å‰è¨€

åœ¨å¼€å‘è¿‡ç¨‹ä¸­è™½ç„¶ UI è¿™ä¸ªæ´»å¾ˆæ²¡æŠ€æœ¯å«é‡,ä½†æœ‰æ—¶å€™è¿˜æ˜¯éœ€è¦åšäº›çš„ç‰¹åˆ«çš„è½¬åœºæ•ˆæœ.æœ¬æ•™ç¨‹å‚è€ƒ[UIPresentationController Tutorial: Getting Started](https://www.raywenderlich.com/139277/uipresentationcontroller-tutorial-getting-started) è¿™ç¯‡åšæ–‡è¿›è¡Œ OC ç‰ˆç¿»è¯‘ ä¹ŸåŠ å…¥äº†ä¸€äº›å°æ”¹åŠ¨

> swift ç‚¹è¿™é‡Œä¸‹è½½[demo](https://koenig-media.raywenderlich.com/uploads/2016/08/Medal_Count_Completed.zip)  
> Objective-C ç‚¹å‡»è¿™é‡Œç›´è¾¾[demo](https://github.com/sunyazhou13/SlideInPresentation)


![](/assets/images/20171031ElegantPresentTransition/ElegantPresentTransition.gif)


### éœ€æ±‚èƒŒæ™¯

è½¬åœºå¯¹ç›®å‰çš„ iOS æ¥è®²å·²ç»ä¸èƒ½å†ç†Ÿæ‚‰äº† ä½†æƒ³æ‰¾ä¸ªé è°±ç‚¹çš„å¸¦é®ç›–çš„è½¬åœº æ²¡æ‰¾åˆ°å‡ ä¸ªé è°±çš„

ä¸æ˜¯è¿™ä¸ªé—®é¢˜ä¸è¡Œå°±é‚£ä¸ªé—®é¢˜ä¸èƒ½æ»¡è¶³ 


![](/assets/images/20171031ElegantPresentTransition/demo1.webp)


æ ¹æ®`Raywenderrich`çš„æ•™ç¨‹ æˆ‘ç¿»è¯‘æˆäº† OC ç‰ˆæœ¬ å¹¶åŠ äº†ä¸€äº›å°æ”¹åŠ¨ 



### å¦‚ä½•ä½¿ç”¨

* å¯¼å…¥å¤´æ–‡ä»¶
 
``` objc
#import "SlideInPresentationManager.h"

```

* å£°æ˜å±æ€§

``` objc
@property (nonatomic, strong) SlideInPresentationManager *slideInTransitioningDelegate;
```

* å¼¹å‡ºæ¨¡æ€æ§åˆ¶å™¨çš„æ—¶å€™å¦‚ä¸‹ä»£ç 

``` objc
- (IBAction)presentAction:(UIButton *)sender {
    PresentationDirection direction;
    if (sender.tag == 100) {
        NSLog(@"å·¦ä¾§å¼¹å‡ºæ¨¡æ€è½¬åœº");
        direction = PresentationDirectionLeft;
    } else if (sender.tag == 101) {
        NSLog(@"ä¸Šå¼¹å‡ºæ¨¡æ€è½¬åœº");
        direction = PresentationDirectionTop;
    } else if (sender.tag == 102) {
        NSLog(@"å³å¼¹å‡ºæ¨¡æ€è½¬åœº");
        direction = PresentationDirectionRight;
    } else {
        NSLog(@"ä¸‹å¼¹å‡ºæ¨¡æ€è½¬åœº");
        direction = PresentationDirectionBottom;
    }
    
    self.slideInTransitioningDelegate = nil;
    //æ§åˆ¶ç°å®é®ç›–çš„è§†å›¾è½¬åœº(core ä»£ç )
    self.slideInTransitioningDelegate = [[SlideInPresentationManager alloc] init];
    self.slideInTransitioningDelegate.direction = direction;
    self.slideInTransitioningDelegate.disableCompactHeight = NO;
    self.slideInTransitioningDelegate.sliderRate = 1.0/3.0;
    
    //åˆ›å»ºæ§åˆ¶å™¨å®ä¾‹
    PresentController *presentVC = [[PresentController alloc] initWithNibName:@"PresentController" bundle:[NSBundle mainBundle]];
    presentVC.transitioningDelegate = self.slideInTransitioningDelegate;
    presentVC.modalPresentationStyle = UIModalPresentationCustom;
    [self presentViewController:presentVC animated:YES completion:nil];
}


``` 


å‰©ä¸‹çš„å°±å¯ä»¥æ„‰å¿«çš„ç©è€äº† 




URL: https://sunyazhou.com/2017/10/MarkdownSkill/index.html.md
Published At: 2017-10-25 16:10:35 +0000

# markdownåµŒå…¥æŠ˜å æ ‡ç­¾

# å‰è¨€

> è¿™å‡ å¤©ä¸€ç›´åœ¨å¼€åä¹å¤§,å¯¼è‡´æˆ‘çš„æ¢¯å­ç¿»å¢™ä¸å¥½ä½¿äº†,å°±åœ¨æ­¤æ—¶[å–µç¥å‘è¡¨äº†ä¸€ç¯‡åšæ–‡ å…³äº Swift Error çš„åˆ†ç±»](https://onevcat.com/2017/10/swift-error-category/)  

æ¯æ¬¡çœ‹å–µç¥çš„æ–‡ç« å°±åƒè¯¸è‘›äº®è·Ÿå‘¨ç‘œèŠå¤©ä¸€æ ·å¦‚é¥®ç¾é…’,æˆ‘ä¸èƒ½è‡ªæ¯”è¯¸è‘›å­”æ˜å’Œå‘¨å…¬ç‘¾.

å½“æˆ‘ä»”ç»†çœ‹å–µç¥åšå®¢çš„æ—¶å€™å‘ç° åŸæ¥`markdown`æ”¯æŒå¾ˆå¤š`html`æ ‡ç­¾çš„å°æŠ€å·§


æ¯”å¦‚:

![å–µç¥æ–‡ç« ä¸­çš„](/assets/images/20171025MarkdownSkill/MarkdownSkill.gif)


ç¬¬ä¸€çœ¼æˆ‘éœ‡æ’¼äº† åŸæ¥ markdown é‡Œé¢è¿˜èƒ½åµŒå…¥è¿™ä¹ˆå¤šå¥½ç©çš„ å°±è¿™ä¸ªé—®é¢˜ é—®äº†ä¸€ä¸‹å–µç¥


![ä¸å–µç¥å¯¹è¯](/assets/images/20171025MarkdownSkill/MarkdownQuestion.webp)


[ç®€å•çš„ summary tag è€Œå·²..](https://www.w3schools.com/tags/tag_summary.asp)

äºæ˜¯æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ä»£ç 


``` html
<details>
  <summary>ç‚¹å‡»æ—¶çš„åŒºåŸŸæ ‡é¢˜</summary>
  <p> - æµ‹è¯• æµ‹è¯•æµ‹è¯•</p>
  <p> æµ‹è¯•äºŒ æµ‹è¯•ä¸‰ ã€‚ã€‚ã€‚ã€‚ã€‚ .</p>
</details>
```


ä¸‹é¢æˆ‘ä»¬æ¥ç©ä¸€ä¸‹è¯•è¯•


<details>
  <summary>è¿™æ˜¯å­™å…ˆç”Ÿçš„åšå®¢ ç‚¹å‡»æŸ¥çœ‹æ›´å¤šå†…å®¹.</summary>
  <p> 666666 æ˜¨å¤©ç¨‹åºå‘˜èŠ‚ æ˜¯ä¸æ˜¯è¢« PM è™äº† QA æä¸ªå¾ˆå¤š bug ä¸æƒ³ fix.</p>
  <p> æ˜¨å¤©ä¸€ä¸å°å¿ƒé©¾ç…§è€ƒä¸‹æ¥äº† è€—æ—¶2ä¸ªæœˆ å¿«ä¸å¿«ã€‚ã€‚ã€‚ã€‚.</p>
</details>


è¿˜å¯ä»¥åµŒå…¥å›¾ç‰‡

<details>
  <summary>ä¹¦æ³•</summary>
  <p><img src="/assets/images/aboutme/about_read_books.webp" alt=""> </p>
  <p> </p>
</details>


``` html
<details>
  <summary>ä¹¦æ³•</summary>
  <p><img src="/assets/images/aboutme/about_read_books.webp" alt=""> </p>
  <p> </p>
</details>
```

OK ä¸Šè¾¹å°±æ˜¯æˆ‘ä»¬ç”¨åˆ°çš„å‡ è¡Œä»£ç  å¾ˆç®€å•ç›´æ¥åµŒå…¥ markdown ç¼–è¾‘å™¨é‡Œé¢å°±é©¬ä¸Šå‡ºæ•ˆæœ

æ„Ÿè°¢[å–µç¥çš„æŒ‡å¯¼](https://onevcat.com/)

æ›´å¤šæ ‡ç­¾ç›¸å…³ å¯å‚è€ƒ[w3schools](https://www.w3schools.com/tags/tag_summary.asp)

markdownå¦‚ä½•æ”¹å­—ä½“é¢œè‰², å¦‚ä¸‹ä»£ç :


<font color=#0099ff size=12 face="é»‘ä½“">é»‘ä½“å¸¦é¢œè‰²</font> 

``` html
<font color=#0099ff size=12 face="é»‘ä½“">é»‘ä½“å¸¦é¢œè‰²</font>  
``` 

20201012æ›´æ–° 



å…¨æ–‡å®Œ 


URL: https://sunyazhou.com/2017/10/UIViewRendering/index.html.md
Published At: 2017-10-16 13:00:30 +0000

# ç†è§£UIViewçš„ç»˜åˆ¶

![UIViewæ¸²æŸ“](/assets/images/20171016UIViewRendering/UIViewRendering.webp)

# å‰è¨€

æœ€è¿‘ç ”ç©¶OpenGL ESç›¸å…³å’Œ GPU ç›¸å…³ å‘ç°è¿™ç¯‡æ–‡ç« å¾ˆå…·æœ‰å‚è€ƒçš„å…¥é—¨ä»·å€¼.


### ç†è§£ UIView çš„ç»˜åˆ¶, UIView æ˜¯å¦‚ä½•æ˜¾ç¤ºåˆ° Screen ä¸Šçš„?

é¦–å…ˆè¦ä»`Runloop`å¼€å§‹è¯´,iOS çš„`MainRunloop` æ˜¯ä¸€ä¸ª60fps çš„å›è°ƒ,ä¹Ÿå°±æ˜¯è¯´16.7ms(æ¯«ç§’)ä¼šç»˜åˆ¶ä¸€æ¬¡å±å¹•,è¿™ä¸ªæ—¶é—´æ®µå†…è¦å®Œæˆ:

* `view`çš„ç¼“å†²åŒºåˆ›å»º
* `view`å†…å®¹çš„ç»˜åˆ¶(å¦‚æœé‡å†™äº† drawRect)  


è¿™äº› `CPU`çš„å·¥ä½œ.

ç„¶åå°†è¿™ä¸ªç¼“å†²åŒºäº¤ç»™`GPU`æ¸²æŸ“, è¿™ä¸ªè¿‡ç¨‹åˆåŒ…å«:

* å¤šä¸ª`view`çš„æ‹¼æ¥(compositing)
* çº¹ç†çš„æ¸²æŸ“(Texture)ç­‰.

æœ€ç»ˆç°å®åœ¨å±å¹•ä¸Š.å› æ­¤,å¦‚æœåœ¨16.7ms å†…å®Œä¸æˆè¿™äº›æ“ä½œ, eg: CPUåšäº†å¤ªå¤šçš„å·¥ä½œ, æˆ–è€…`view`å±‚æ¬¡è¿‡äºå¤š,å›¾ç‰‡è¿‡äºå¤§,å¯¼è‡´`GPU`å‹åŠ›å¤ªå¤§,å°±ä¼šå¯¼è‡´"å¡"çš„ç°è±¡,ä¹Ÿå°±æ˜¯ **ä¸¢å¸§**,**æ‰å¸§**.

è‹¹æœå®˜æ–¹ç»™å‡ºçš„æœ€ä½³å¸§ç‡æ˜¯:__60fps__(60Hz),ä¹Ÿå°±æ˜¯ä¸€å¸§ä¸ä¸¢, å½“ç„¶è¿™æ˜¯ç†æƒ³ä¸­çš„ç»ä½³ä½“éªŒ.

### è¿™ä¸ª`60fps`è¯¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ

ä¸€èˆ¬æ¥è¯´å¦‚æœå¸§ç‡è¾¾åˆ° `60+fps`(fps >= 60å¸§ä»¥ä¸Š,å¦‚æœå¸§ç‡fps > 50,äººçœ¼å°±åŸºæœ¬æ„Ÿè§‰ä¸åˆ°å¡é¡¿äº†,å› æ­¤,å¦‚æœä½ èƒ½è®©ä½ çš„ iOS ç¨‹åº__ç¨³å®š__ä¿æŒåœ¨`60fps`å·²ç»å¾ˆä¸é”™äº†, æ³¨é‡Š,æ˜¯"ç¨³å®š"åœ¨60fps,è€Œä¸æ˜¯, `10fps`,`40fps`,`20fps`è¿™æ ·çš„è·³åŠ¨,å¦‚æœå¸§é¢‘ä¸ç¨³å°±ä¼šæœ‰å¡çš„æ„Ÿè§‰,`60fps`çœŸçš„å¾ˆéš¾è¾¾åˆ°, å°¤å…¶æ˜¯åœ¨ iPhone 4/4sç­‰ 32bit ä½æœºä¸Š,ä¸è¿‡ç°åœ¨è‹¹æœå·²ç»å…¨é¢æ”¾å¼ƒ32ä½,æ”¯æŒæœ€ä½64ä½ä¼šå¥½å¾ˆå¤š.

> fps ä»£è¡¨çš„æ˜¯åˆ·æ–°é¢‘ç‡,å•ä½èµ«å…¹Hz,å› ä¸ºç”µå­å·¥ç¨‹ä¸­è€ƒè™‘åˆ°èƒ½è€—å’Œè§†è§‰ä»¥åŠå…¶å®ƒæ–¹é¢,60Hzæ˜¯ä¸€ä¸ªæ¯”è¾ƒç†æƒ³çš„åˆ·æ–°é¢‘ç‡,æ‰€ä»¥å®¶ç”¨ç”µå™¨ä¹Ÿç»å¸¸ä¼šå‡ºç°60Hzçš„å­—æ ·.
> è§†é¢‘ä¸­å¸§ç‡FPS >= 25 æ‰ä¸ä¼šäººçœ¼å¯Ÿè§‰æœ‰å¡é¡¿,å› ä¸ºè§†é¢‘ä¸­è§†é¢‘æ¨¡ç³Šè§†é¢‘ä¸­çš„i p bå¸§èƒ½å¤Ÿç»™äºˆå‰åå¸§ä¸€äº›éœ€è¦çš„åƒç´ ä¿¡æ¯æ–¹ä¾¿GPUçš„ç¦»å±æ¸²æŸ“,GPUçš„ç´¢å¼•å¯ä»¥èŠ‚çœå¾ˆå¤šæ€§èƒ½.

æ€»çš„æ¥è¯´, UIViewä»ç»˜åˆ¶åˆ°Renderçš„è¿‡ç¨‹æœ‰å¦‚ä¸‹å‡ æ­¥ï¼š

* æ¯ä¸€ä¸ª`UIView`éƒ½æœ‰ä¸€ä¸ª`layer`
* æ¯ä¸€ä¸ª`layer`éƒ½æœ‰ä¸ª`content`,è¿™ä¸ª`content`æŒ‡å‘çš„æ˜¯ä¸€å—ç¼“å­˜,å«åš__`backing store`__.  

`UIView`çš„ç»˜åˆ¶å’Œæ¸²æŸ“æ˜¯ä¸¤ä¸ªè¿‡ç¨‹:

* å½“`UIView`è¢«ç»˜åˆ¶æ—¶,CPUæ‰§è¡Œ`drawRect`ï¼Œé€šè¿‡`context`å°†æ•°æ®å†™å…¥__`backing store`__  
* å½“__`backing store`__å†™å®Œåï¼Œé€šè¿‡render serveräº¤ç»™GPUå»æ¸²æŸ“ï¼Œå°†backing storeä¸­çš„bitmapæ•°æ®æ˜¾ç¤ºåœ¨å±å¹•ä¸Š.

ä¸Šé¢æåˆ°çš„ä»`CPU`åˆ°`GPU`çš„è¿‡ç¨‹å¯ç”¨ä¸‹å›¾è¡¨ç¤º:

![](/assets/images/20171016UIViewRendering/CPUToGPU.webp)


ä¸‹é¢å…·ä½“æ¥è®¨è®ºä¸‹è¿™ä¸ªè¿‡ç¨‹

* CPU bound:

å‡è®¾æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª UILabel

``` objc
UILabel* label = [[UILabel alloc]initWithFrame:CGRectMake(10, 50, 300, 14)];
label.backgroundColor = [UIColor whiteColor];
label.font = [UIFont systemFontOfSize:14.0f];
label.text = @"test";
[self.view addSubview:label];
```

è¿™ä¸ªæ—¶å€™ä¸ä¼šå‘ç”Ÿä»»ä½•æ“ä½œ, ç”±äº UILabel é‡å†™äº†`drawRect`æ–¹æ³•,å› æ­¤,è¿™ä¸ª `View`ä¼šè¢« `marked as "dirty"`:



ç±»ä¼¼è¿™ä¸ªæ ·å­:

![](/assets/images/20171016UIViewRendering/DrawRect.webp)



ç„¶åä¸€ä¸ªæ–°çš„`Runloop`åˆ°æ¥ï¼Œä¸Šé¢è¯´é“åœ¨è¿™ä¸ª`Runloop`ä¸­éœ€è¦å°†ç•Œé¢æ¸²æŸ“ä¸Šå»ï¼Œå¯¹äº`UIKit`çš„æ¸²æŸ“ï¼ŒAppleç”¨çš„æ˜¯å®ƒçš„`Core Animation`ã€‚
åšæ³•æ˜¯åœ¨Runloopå¼€å§‹çš„æ—¶å€™è°ƒç”¨ï¼š

``` objc
[CATransaction begin]
```

åœ¨`Runloop`ç»“æŸçš„æ—¶å€™è°ƒç”¨  

``` objc

[CATransaction commit]

```

åœ¨`begin`å’Œ`commit`ä¹‹é—´åšçš„äº‹æƒ…æ˜¯å°†`view`å¢åŠ åˆ°`view hierarchy`ä¸­ï¼Œè¿™ä¸ªæ—¶å€™ä¹Ÿä¸ä¼šå‘ç”Ÿä»»ä½•ç»˜åˆ¶çš„æ“ä½œã€‚
å½“`[CATransaction commit]`æ‰§è¡Œå®Œåï¼Œ`CPU`å¼€å§‹ç»˜åˆ¶è¿™ä¸ª`view`:

![CPUç»˜åˆ¶å›¾](/assets/images/20171016UIViewRendering/CATransactionCommit.webp)


é¦–å…ˆ`CPU`ä¼šä¸º`layer`åˆ†é…ä¸€å—å†…å­˜ç”¨æ¥ç»˜åˆ¶`bitmap`ï¼Œå«åš__`backing store`__  
åˆ›å»ºæŒ‡å‘è¿™å—`bitmap`ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œå«åš`CGContextRef`  
é€šè¿‡`Core Graphic`çš„`api`ï¼Œä¹Ÿå«`Quartz2D`ï¼Œç»˜åˆ¶`bitmap`  
å°†`layer`çš„`content`æŒ‡å‘ç”Ÿæˆçš„`bitmap`  
æ¸…ç©º`dirty flag`æ ‡è®°  
è¿™æ ·`CPU`çš„ç»˜åˆ¶åŸºæœ¬ä¸Šå°±å®Œæˆäº†.  
é€šè¿‡`time profiler`å¯ä»¥å®Œæ•´çš„çœ‹åˆ°ä¸ªè¿‡ç¨‹ï¼š  

``` sh

Running Time Self Symbol Name
2.0ms 1.2% 0.0 +[CATransaction flush]
2.0ms 1.2% 0.0 CA::Transaction::commit()
2.0ms 1.2% 0.0 CA::Context::commit_transaction(CA::Transaction*)
1.0ms 0.6% 0.0 CA::Layer::layout_and_display_if_needed(CA::Transaction*)
1.0ms 0.6% 0.0 CA::Layer::display_if_needed(CA::Transaction*)
1.0ms 0.6% 0.0 -[CALayer display]
1.0ms 0.6% 0.0 CA::Layer::display()
1.0ms 0.6% 0.0 -[CALayer _display]
1.0ms 0.6% 0.0 CA::Layer::display_()
1.0ms 0.6% 0.0 CABackingStoreUpdate_
1.0ms 0.6% 0.0 backing_callback(CGContext*, void*)
1.0ms 0.6% 0.0 -[CALayer drawInContext:]
1.0ms 0.6% 0.0 -[UIView(CALayerDelegate) drawLayer:inContext:]
1.0ms 0.6% 0.0 -[UILabel drawRect:]
1.0ms 0.6% 0.0 -[UILabel drawTextInRect:]  
```


å‡å¦‚æŸä¸ªæ—¶åˆ»ä¿®æ”¹äº†`label`çš„`text`:  


``` objc
label.text = @"hello world";
```


ç”±äºå†…å®¹å˜äº†,`layer`çš„`content`çš„`bitmap`çš„å°ºå¯¸ä¹Ÿè¦å˜åŒ–ï¼Œå› æ­¤è¿™ä¸ªæ—¶å€™å½“æ–°çš„`Runloop`åˆ°æ¥æ—¶ï¼Œ`CPU`è¦ä¸º`layer`é‡æ–°åˆ›å»ºä¸€ä¸ª`backing store`ï¼Œé‡æ–°ç»˜åˆ¶`bitmap`.  
`CPU`è¿™ä¸€å—æœ€è€—æ—¶çš„åœ°æ–¹å¾€å¾€åœ¨`Core Graphic`çš„ç»˜åˆ¶ä¸Šï¼Œå…³äº`Core Graphic`çš„æ€§èƒ½ä¼˜åŒ–æ˜¯å¦ä¸€ä¸ªè¯é¢˜äº†ï¼Œåˆä¼šç‰µæ‰¯åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œå°±ä¸åœ¨è¿™é‡Œè®¨è®ºäº†.

GPU boundï¼š


`CPU`å®Œæˆäº†å®ƒçš„ä»»åŠ¡ï¼šå°†`view`å˜æˆäº†`bitmap`ï¼Œç„¶åå°±æ˜¯`GPU`çš„å·¥ä½œäº†ï¼Œ`GPU`å¤„ç†çš„å•ä½æ˜¯`Texture`.      
åŸºæœ¬ä¸Šæˆ‘ä»¬æ§åˆ¶`GPU`éƒ½æ˜¯é€šè¿‡`OpenGL`æ¥å®Œæˆçš„ï¼Œä½†æ˜¯ä»`bitmap`åˆ°`Texture`ä¹‹é—´éœ€è¦ä¸€åº§æ¡¥æ¢ï¼Œ`Core Animation`æ­£å¥½å……å½“äº†è¿™ä¸ªè§’è‰²ï¼š  
`Core Animation`å¯¹`OpenGL`çš„`api`æœ‰ä¸€å±‚å°è£…ï¼Œå½“æˆ‘ä»¬è¦æ¸²æŸ“çš„`layer`å·²ç»æœ‰äº†`bitmap content`çš„æ—¶å€™ï¼Œè¿™ä¸ª`content`ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ª`CGImageRef`ï¼Œ`CoreAnimation`ä¼šåˆ›å»ºä¸€ä¸ª`OpenGL`çš„`Texture`å¹¶å°†`CGImageRefï¼ˆbitmapï¼‰`å’Œè¿™ä¸ª`Texture`ç»‘å®šï¼Œé€šè¿‡`TextureID`æ¥æ ‡è¯†ã€‚  
è¿™ä¸ªå¯¹åº”å…³ç³»å»ºç«‹èµ·æ¥ä¹‹åï¼Œå‰©ä¸‹çš„ä»»åŠ¡å°±æ˜¯`GPU`å¦‚ä½•å°†`Texture`æ¸²æŸ“åˆ°å±å¹•ä¸Šäº†ã€‚
`GPU`å¤§è‡´çš„å·¥ä½œæ¨¡å¼å¦‚ä¸‹ï¼š

![](/assets/images/20171016UIViewRendering/GPUWorkflow.webp)

æ•´ä¸ªè¿‡ç¨‹ä¹Ÿå°±æ˜¯ä¸€ä»¶äº‹ï¼š

`CPU`å°†å‡†å¤‡å¥½çš„`bitmap`æ”¾åˆ°`RAM`é‡Œï¼Œ`GPU`å»æ¬è¿™å¿«å†…å­˜åˆ°`VRAM`ä¸­å¤„ç†ã€‚ 
è€Œè¿™ä¸ªè¿‡ç¨‹`GPU`æ‰€èƒ½æ‰¿å—çš„æé™å¤§æ¦‚åœ¨16.7mså®Œæˆä¸€å¸§çš„å¤„ç†ï¼Œæ‰€ä»¥æœ€å¼€å§‹æåˆ°çš„60fpså…¶å®å°±æ˜¯GPUèƒ½å¤„ç†çš„æœ€é«˜é¢‘ç‡.  
å› æ­¤ï¼Œ`GPU`çš„æŒ‘æˆ˜æœ‰ä¸¤ä¸ªï¼š

*  å°†æ•°æ®ä»`RAM`æ¬åˆ°`VRAM`ä¸­
*  å°†`Texture`æ¸²æŸ“åˆ°å±å¹•ä¸Š    

è¿™ä¸¤ä¸ªä¸­ç“¶é¢ˆåŸºæœ¬åœ¨ç¬¬äºŒç‚¹ä¸Šã€‚æ¸²æŸ“`Texture`åŸºæœ¬è¦å¤„ç†è¿™ä¹ˆå‡ ä¸ªé—®é¢˜ï¼š

* Compositing:

`Compositing`æ˜¯æŒ‡å°†å¤šä¸ªçº¹ç†æ‹¼åˆ°ä¸€èµ·çš„è¿‡ç¨‹ï¼Œå¯¹åº”`UIKit`ï¼Œæ˜¯æŒ‡å¤„ç†å¤šä¸ª`view`åˆåˆ°ä¸€èµ·çš„æƒ…å†µï¼Œå¦‚:  

``` objc
[self.view addsubview : subview]ã€‚

```

å¦‚æœ`view`ä¹‹é—´æ²¡æœ‰å åŠ ï¼Œé‚£ä¹ˆ`GPU`åªéœ€è¦åšæ™®é€šæ¸²æŸ“å³å¯.  
å¦‚æœå¤šä¸ª`view`ä¹‹é—´æœ‰å åŠ éƒ¨åˆ†ï¼Œ`GPU`éœ€è¦åš`blending`.  

åŠ å…¥ä¸¤ä¸ª`view`å¤§å°ç›¸åŒï¼Œä¸€ä¸ªå åŠ åœ¨å¦ä¸€ä¸ªä¸Šé¢ï¼Œé‚£ä¹ˆè®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š



`R` = `S`+`D`*(`1`-`Sa`)  

> `R`: ä¸ºæœ€ç»ˆçš„åƒç´ å€¼  
> `S`: ä»£è¡¨ ä¸Šé¢çš„Textureï¼ˆTop Textureï¼‰  
> `D`: ä»£è¡¨ä¸‹é¢çš„Texture(lower Texture)  

å…¶ä¸­`S`,`D`éƒ½å·²ç»`pre-multiplied`å„è‡ªçš„`alpha`å€¼ã€‚  
`Sa`ä»£è¡¨`Texture`çš„`alpha`å€¼ã€‚  

å‡å¦‚`Top Texture`ï¼ˆä¸Šå±‚`view`ï¼‰çš„`alpha`å€¼ä¸º`1`ï¼Œå³ä¸é€æ˜ã€‚é‚£ä¹ˆå®ƒä¼šé®ä½ä¸‹å±‚çš„`Texture`.  
å³,`R` = `S`ã€‚æ˜¯åˆç†çš„ã€‚  

å‡å¦‚`Top Texture`ï¼ˆä¸Šå±‚`view`ï¼‰çš„`alpha`å€¼ä¸º`0.5`ï¼Œ  
`S`ä¸º`(1,0,0)`ï¼Œä¹˜ä»¥`alpha`åä¸º`(0.5,0,0ï¼‰`ã€‚  
`D`ä¸º`(0ï¼Œ0ï¼Œ1)`ã€‚  
å¾—åˆ°çš„`R`ä¸º`ï¼ˆ0.5ï¼Œ0ï¼Œ0.5ï¼‰`ã€‚  

åŸºæœ¬ä¸Šæ¯ä¸ªåƒç´ ç‚¹éƒ½éœ€è¦è¿™ä¹ˆè®¡ç®—ä¸€æ¬¡ã€‚  

å› æ­¤ï¼Œ`view`çš„å±‚çº§å¾ˆå¤æ‚ï¼Œæˆ–è€…`view`éƒ½æ˜¯åŠé€æ˜çš„ï¼ˆ`alpha`å€¼ä¸ä¸º`1`ï¼‰éƒ½ä¼šå¸¦æ¥`GPU`é¢å¤–çš„è®¡ç®—å·¥ä½œã€‚


* Size

è¿™ä¸ªé—®é¢˜ï¼Œä¸»è¦æ˜¯å¤„ç†`image`å¸¦æ¥çš„ï¼Œå‡å¦‚å†…å­˜é‡Œæœ‰ä¸€å¼ `400x400`çš„å›¾ç‰‡ï¼Œè¦æ”¾åˆ°`100x100`çš„`imageview`é‡Œï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œç›´æ¥ä¸¢è¿›å»ï¼Œé—®é¢˜å°±å¤§äº†ï¼Œè¿™æ„å‘³ç€ï¼Œ`GPU`éœ€è¦å¯¹å¤§å›¾è¿›è¡Œç¼©æ”¾åˆ°å°çš„åŒºåŸŸæ˜¾ç¤ºï¼Œéœ€è¦åšåƒç´ ç‚¹çš„`sampling`ï¼Œè¿™ç§`smapling`çš„ä»£ä»·å¾ˆé«˜ï¼Œåˆéœ€è¦å…¼é¡¾`pixel alignment`ã€‚  è®¡ç®—é‡ä¼šé£™å‡ã€‚  

* Offscreen Rendering And Mask

å¦‚æœæˆ‘ä»¬å¯¹`layer`åšè¿™æ ·çš„æ“ä½œï¼š  

``` objc 
label.layer.cornerRadius = 5.0f;
label.layer.masksToBounds = YES;

```

ä¼šäº§ç”Ÿ`offscreen rendering`,å®ƒå¸¦æ¥çš„æœ€å¤§çš„é—®é¢˜æ˜¯ï¼Œå½“æ¸²æŸ“è¿™æ ·çš„`layer`çš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–å¼€è¾Ÿå†…å­˜ï¼Œç»˜åˆ¶å¥½`radiusï¼Œmask`ï¼Œç„¶åå†å°†ç»˜åˆ¶å¥½çš„`bitmap`é‡æ–°èµ‹å€¼ç»™`layer`ã€‚  
å› æ­¤ç»§ç»­æ€§èƒ½çš„è€ƒè™‘ï¼Œ`Quartz`æä¾›äº†ä¼˜åŒ–çš„`api`ï¼š

``` objc
label.layer.cornerRadius = 5.0f;
label.layer.masksToBounds = YES;
label.layer.shouldRasterize = YES;
label.layer.rasterizationScale = label.layer.contentsScale;

```

ç®€å•çš„è¯´ï¼Œè¿™æ˜¯ä¸€ç§`cache`æœºåˆ¶ã€‚  
åŒæ ·`GPU`çš„æ€§èƒ½ä¹Ÿå¯ä»¥é€šè¿‡`instrument`å»è¡¡é‡ï¼š

![](/assets/images/20171016UIViewRendering/RenderingResult.webp)

çº¢è‰²ä»£è¡¨`GPU`éœ€è¦åšé¢å¤–çš„å·¥ä½œæ¥æ¸²æŸ“`View`ï¼Œç»¿è‰²ä»£è¡¨`GPU`æ— éœ€åšé¢å¤–çš„å·¥ä½œæ¥å¤„ç†`bitmap`ã€‚

å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2017/09/DeviceCheck/index.html.md
Published At: 2017-09-30 09:45:25 +0000

# DeviceCheck

![](/assets/images/20170930DeviceCheck/DeviceCheck.webp)

# å‰è¨€



iOS11 è‹¹æœæ”¹åŠ¨äº†ä¸€ä¸ªæ¯”è¾ƒå¼•å¼€å‘è€…å…³æ³¨çš„äº®ç‚¹

**UDIDä¹‹ç±»çš„å†™åˆ°ç³»ç»Ÿ keychain çš„å”¯ä¸€æ ‡è¯†ä¼šéšç€ app åˆ é™¤è€Œåˆ é™¤**

è¿™ä¸ªé—®é¢˜åœ¨å¾®åšä¸Šå·²ç»äº‰è®ºå¥½å‡ å¤©

### iOS11æ–°çš„è®¾å¤‡å”¯ä¸€æ ‡è¯† DCDevice

#### ä»‹ç» API

æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹`DCDevice`ç±»éƒ½æœ‰å•¥

``` objc
#import <DeviceCheck/DeviceCheck.h>

NS_ASSUME_NONNULL_BEGIN

API_AVAILABLE(ios(11.0), tvos(11.0)) API_UNAVAILABLE(watchos, macos)
@interface DCDevice : NSObject
//å½“å‰è®¾å¤‡
@property (class, readonly) DCDevice *currentDevice;

//æ˜¯å¦æ”¯æŒ
@property (getter=isSupported, readonly) BOOL supported;

//ç”Ÿæˆå”¯ä¸€æ ‡è¯†çš„ token æ³¨æ„:æ¯callä¸€æ¬¡å°±ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ token(å’Œå‰è¾¹ä¸åŒ)
- (void)generateTokenWithCompletionHandler:(void(^)(NSData * _Nullable token, NSError * _Nullable error))completion;

@end

NS_ASSUME_NONNULL_END

```
æ¥å£ç®€ç›´ä¸èƒ½å†ç®€å•äº† **åˆ›å»ºå®ä¾‹è°ƒæ–¹æ³•**

#### ä½¿ç”¨ API
ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨`DCDevice`

å¯¼å…¥å¤´æ–‡ä»¶

``` objc
#import <DeviceCheck/DeviceCheck.h>
```

check æ˜¯å¦æ”¯æŒ å¦‚æœæ”¯æŒ çš„è¯ä¼šåœ¨å›è°ƒä»¥åè¿”å› `token`(NSData)

``` objc
- (void)viewDidLoad {
    [super viewDidLoad];
    
    //ä¸‹é¢æ˜¯è°ƒç”¨ä»£ç 
    if([DCDevice currentDevice].supported){
        [[DCDevice currentDevice] generateTokenWithCompletionHandler:^(NSData * _Nullable token, NSError * _Nullable error) {
            NSLog(@"%@",token);
        }];
    }
}

```

token æ˜¯ä¸ª 2188å­—èŠ‚(2k å¤šç‚¹)çš„äºŒè¿›åˆ¶æµ,å¾ˆå°

![](/assets/images/20170930DeviceCheck/DCDeviceCode.webp)

æˆ‘å°è¯•å„ç§å­—ç¬¦ä¸²ç¼–ç æœ€ç»ˆä¹Ÿä¸çŸ¥é“é‡Œé¢æ˜¯å•¥ æ²¡èƒ½æˆåŠŸæ‰“å°å‡ºæ¥

![](/assets/images/20170930DeviceCheck/DCDeviceBinary.webp)

è°è¦æ˜¯æ‰“å°å‡ºæ¥çƒ¦è¯· share ä¸€ä¸‹

#### åˆ é™¤/é‡è£…App å¦‚ä½•å¤„ç†

> DeviceCheck å…è®¸ä½ é€šè¿‡ä½ çš„æœåŠ¡å™¨ä¸ Apple æœåŠ¡å™¨é€šè®¯ï¼Œå¹¶ä¸ºå•ä¸ªè®¾å¤‡è®¾ç½®2kå·¦å³ çš„æ•°æ®ã€‚
åœ¨è®¾å¤‡ä¸Šç”¨ DeviceCheck API ç”Ÿæˆä¸€ä¸ª 2å­—èŠ‚çš„ token (00, 01,10,11)ï¼Œç„¶åå°†è¿™ä¸ª token å‘ç»™è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå†ç”±è‡ªå·±çš„æœåŠ¡å™¨ä¸ Apple çš„ API è¿›è¡Œé€šè®¯ï¼Œæ¥æ›´æ–°æˆ–è€…æŸ¥è¯¢è¯¥è®¾å¤‡çš„å€¼ã€‚è¿™ä¸¤å­—èŠ‚ çš„æ•°æ®ç”¨æ¥è¿½è¸ªç”¨æˆ·ã€‚æ¯”å¦‚ã€‚å€ŸåŠ©ä¸¤ä¸ªè‡ªå·±çš„æ•°æ®ï¼Œä½ å¯ä»¥å¾—çŸ¥ç”¨æˆ·ç©¶ç«Ÿä½¿ç”¨äº†è¯¥ App å¤šä¹…ã€‚
è¯¥ API å¯ä»¥æˆä¸ºï¼šåæ¬ºè¯ˆé¢†åŸŸï¼š 
> è¯•ç”¨7å¤©
Uberã€æ»´æ»´å¸æœºè¢«å°å·åï¼Œé˜²æ­¢é‡æ–°æ³¨å†Œè´¦å·æ¥å•
è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»é¢†å–è¿‡é¦–æ¬¡æ³¨å†Œçº¢åŒ…
APPé˜²å¤šå¼€
å› ä¸ºä¼ è¾“çš„æ˜¯ flag çº§åˆ«çš„æ•°æ®ï¼Œå¹¶ä¸ä¼šå®šä½åˆ°è¯¥è®¾å¤‡çš„ä½¿ç”¨è€…ï¼Œæ‰€ä»¥ç›¸å¯¹å®‰å…¨ã€‚

> ä½†æ˜¯å¯¹äºè´­ä¹°äº†äºŒæ‰‹æ‰‹æœºçš„ä½¿ç”¨åœºæ™¯ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€äº›è¾¹ç•Œæƒ…å†µï¼Œè¿™ä¸ªåœ¨ä¸šåŠ¡ä¸­ä¹Ÿéœ€è¦è€ƒè™‘è¿›å»ã€‚

å¼•è‡ª[iOS11å¼€å‘æ–°ç‰¹æ€§ä¹‹å®ç”¨å°tips](https://github.com/ChenYilong/iOS11AdaptationTips/issues/22)


é¦–å…ˆè¦æ˜ç™½æˆ‘ä»¬ çš„ token éœ€è¦å‘ç»™è°

1. token éœ€è¦å‘é€ç»™æˆ‘ä»¬è‡ªå·±å…¬å¸çš„`server`åšè®°å½•
2. æˆ‘ä»¬å…¬å¸è‡ªå·±çš„`server`å»`Apple`çš„`server`æŸ¥è¯¢`token`æ˜¯å¦æœ‰æ•ˆ,ä»è€Œæ¥æ›´æ–°æˆ–è€…æŸ¥è¯¢è¯¥è®¾å¤‡å€¼. 
3. è¿™`2k å·¦å³çš„ token`ä¸ä¼šå› ä¸ºè®¾å¤‡åˆ é™¤ app è€Œåˆ é™¤ ä¼šä¸€ç›´å­˜åœ¨è‹¹æœçš„ server(å…¶å®æˆ‘è§‰å¾—å°±æ˜¯è‹¹æœè‡ªå·±å»è·å–çš„è®¾å¤‡å”¯ä¸€æ ‡è¯†).

é‚£ä¹ˆ æ€ä¹ˆæŸ¥è¯¢å’Œæ›´æ–°å‘¢ 

##### æŸ¥è¯¢æ¥å£

**https://api.development.devicecheck.apple.com/v1/query_two_bits**

å¯ä»¥ç”¨ç»ˆç«¯è‡ªå·±æ¨¡æ‹Ÿä¸€ä¸‹ å°±å½“ä½œä½ è‡ªå·±æ˜¯è‡ªå·±çš„æœåŠ¡å™¨è®¿é—®Apple çš„æœåŠ¡å™¨

``` sh
curl -i --verbose -H "Authorization: Bearer <GeneratedJWT>" \
-X POST --data-binary @ValidQueryRequest.json \ 
https://api.development.devicecheck.apple.com/v1/query_two_bits 

```

json çš„å®šä¹‰å¦‚ä¸‹:

| å­—æ®µ key | ç±»å‹ | è¯´æ˜ | å¿…é¡» |   
|:------:|:------:| :------:| :------:| 
| device_token | String | è®¾å¤‡å”¯ä¸€æ ‡è¯† token| æ˜¯ |
| transaction_id | String | æœåŠ¡å™¨äº§ç”Ÿçš„ä¸€ä¸ªID| æ˜¯ |
| timestamp | Long | æœåŠ¡å™¨ç”Ÿæˆçš„UTCæ—¶é—´æˆ³| æ˜¯ |

å®ƒä¼š è¿”å› å¦‚ä¸‹æ ¼å¼

``` json
{
   "device_token" : "wlkCDA2Hy/CfrMqVAShs1BAR/0sAiuRIUm5jQg0a..."
   "transaction_id" : "5b737ca6-a4c7-488e-b928-8452960c4be9",
   "timestamp" : 1487716472000 
}
```

##### æ›´æ–°æ¥å£

**https://api.development.devicecheck.apple.com/v1/update_two_bits**

``` sh
curl -i --verbose -H "Authorization: Bearer <GeneratedJWT>" \
-X POST --data-binary @ValidUpdateRequest.json \
https://api.development.devicecheck.apple.com/v1/update_two_bits 
```

json çš„å®šä¹‰å¦‚ä¸‹:

| å­—æ®µ key | ç±»å‹ | è¯´æ˜ | å¿…é¡» |   
|:------:|:------:| :------:| :------:| 
| device_token | String | è®¾å¤‡å”¯ä¸€æ ‡è¯† token| æ˜¯ |
| transaction_id | String | æœåŠ¡å™¨äº§ç”Ÿçš„ä¸€ä¸ªID| æ˜¯ |
| timestamp | Long | æœåŠ¡å™¨ç”Ÿæˆçš„UTCæ—¶é—´æˆ³| æ˜¯ |
| bit0 | Boolean | æ–°çš„å¸ƒå°”å€¼1| å¦ |
| bit1 | Boolean | æ–°çš„å¸ƒå°”å€¼2| å¦ |

json çš„ç¤ºä¾‹:

``` json
{
   "device_token" : "wlkCDA2Hy/CfrMqVAShs1BAR/0sAiuRIUm5jQg0a..."
   "transaction_id" : "5b737ca6-a4c7-488e-b928-8452960c4be9",
   "timestamp" : 1487716472000,
   "bit0" : true,
   "bit1" : false 
}
```


### æœ€ç»ˆçš„æ–¹æ¡ˆ


1. iOS11ä»¥å‰ç‰ˆæœ¬æš‚ä¸”æ‰ç”¨ UUID ç­‰ keychian æ–¹å¼ 
2. iOS11å°½é‡æ‰ç”¨æ–°çš„ api æ¥é€‚é…è§£å†³

å¯¹äº server æ¥è®²å¯ä»¥ æŠŠ token ææˆæ–°çš„é™„å±å­—æ®µ æ¯”å¦‚ä¸€ä¸ªè´¦å·ä¸‹ç™»å½•å¤šå°‘ä¸ªè®¾å¤‡

é‚£ä¹ˆ ä¸€ä¸ª UID ä¸‹é¢ å°±è¦é™„å± iOS ç‰ˆæœ¬+ token 

ç›¸ä¿¡è¿‡ä¸äº†å¤šä¹… å¾ˆæˆç†Ÿçš„ tokenæ–¹æ¡ˆä¼šè„±é¢–è€Œå‡º 

*å¦‚æœæœ¬æ–‡æœ‰è¯¯ä¹‹å¤„è¿˜è¯·å„è·¯å¤§ç¥æŒ‡æ•™*

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/09/MarkdownTable/index.html.md
Published At: 2017-09-29 18:01:08 +0000

# Markdownæ’å…¥è¡¨æ ¼è¯­æ³•

# å‰è¨€

![](/assets/images/20170929MarkdownTable/table.webp)

ä»¥å‰æ€»ç”¨ markdown æ’å…¥è¡¨æ ¼ä¸æˆåŠŸ è¿™ç¯‡åˆ†äº«ä¸€ä¸‹ markdown å¦‚ä½•æ’å…¥è¡¨æ ¼

demo:

* æ™®é€šæ ·å¼

```
| ä¸€ä¸ªæ™®é€šæ ‡é¢˜ | ä¸€ä¸ªæ™®é€šæ ‡é¢˜ | ä¸€ä¸ªæ™®é€šæ ‡é¢˜ |
| ------| ------ | ------ |
| çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ | ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ |
| ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ | çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ |

```

ç°å®æ•ˆæœæ˜¯è¿™æ ·çš„

| ä¸€ä¸ªæ™®é€šæ ‡é¢˜ | ä¸€ä¸ªæ™®é€šæ ‡é¢˜ | ä¸€ä¸ªæ™®é€šæ ‡é¢˜ |
| ------| ------ | ------ |
| çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ | ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ |
| ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ | çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ |


å¯¹é½

``` 
| å·¦å¯¹é½æ ‡é¢˜ | å³å¯¹é½æ ‡é¢˜ | å±…ä¸­å¯¹é½æ ‡é¢˜ |
| :------| ------: | :------: |
| çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ | ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ |
| ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ | çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ |

```

æ•ˆæœæ˜¯è¿™æ ·çš„

| å·¦å¯¹é½æ ‡é¢˜ | å³å¯¹é½æ ‡é¢˜ | å±…ä¸­å¯¹é½æ ‡é¢˜ |
| :------| ------: | :------: |
| çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ | ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ |
| ç¨å¾®é•¿ä¸€ç‚¹çš„æ–‡æœ¬ | çŸ­æ–‡æœ¬ | ä¸­ç­‰æ–‡æœ¬ |


è¯­æ³•è¯´æ˜:

* `|`ã€`-`ã€`:`ã€ ä¹‹é—´å¤šä½™çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥,ä¸å½±å“å¸ƒå±€.
* é»˜è®¤æ ‡é¢˜æ **å±…ä¸­å¯¹é½**, å†…å®¹å±…å·¦å¯¹é½.
* `-:`è¡¨ç¤ºå†…å®¹å’Œæ ‡é¢˜æ å±…å³å¯¹é½.
* `:-`è¡¨ç¤ºå†…å®¹å’Œæ ‡é¢˜æ å±…å·¦å¯¹é½.
* `:-:`è¡¨ç¤ºå†…å®¹å’Œæ ‡é¢˜æ å±…ä¸­å¯¹é½.
* **å†…å®¹**å’Œ`|`ä¹‹é—´çš„å¤šä½™ç©ºæ ¼ä¼šè¢«å¿½ç•¥.
* æ¯è¡Œç¬¬ä¸€ä¸ª`|`å’Œæœ€åä¸€ä¸ª`|`å¯ä»¥çœç•¥.
* `-`çš„æ•°é‡è‡³å°‘æœ‰ä¸€ä¸ª.



æ¯æ¬¡æ€»å¿˜è®° markdown è¡¨æ ¼æ€ä¹ˆå†™

å¦‚æœä½ éœ€è¦ åŠ ä¸€åˆ— å¯ä»¥å¤åˆ¶ç²˜è´´å‰è¾¹`|`å’Œ ä¸‹è¾¹çš„`|:-----:|`

æˆ‘ç”¨çš„æ˜¯å¼€æºå…è´¹çš„ [MacDown](https://github.com/MacDownApp/macdown/releases) å¤§å®¶å¯ä»¥è‡ªè¡Œä¸‹è½½,å¹³å¸¸å‘è¡¨æ–‡ç« éƒ½ç”¨è¿™ä¸ª.

å…¨æ–‡å®Œ






URL: https://sunyazhou.com/2017/09/CharlesCaptureHttps/index.html.md
Published At: 2017-09-01 23:17:09 +0000

# å¦‚ä½•ä½¿ç”¨Charlesæˆªè·httpsè¯·æ±‚

# å‰è¨€

![](/assets/images/20170901CharlesCaptureHttps/CharlesAlbum.webp)

å¦‚ä½•ä½¿ç”¨`charles`åœ¨iOSè®¾å¤‡ä¸Šæˆªè·`https`çš„è¯·æ±‚ 


## 1.å®‰è£…Charles

[å®˜ç½‘ä¸‹è½½](https://www.charlesproxy.com/download/)å°±è¡Œäº† è‡³äºç ´è§£ä¹‹ç±»çš„ è‡ªè¡Œgoogleå§  æˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯Charles 4.1.3ç‰ˆæœ¬ ç›®å‰åº”è¯¥æ˜¯æœ€æ–°çš„ 


## 2.HTTPæŠ“åŒ…é…ç½®

####  (1) æŸ¥çœ‹ç”µè„‘IP

![](/assets/images/20170901CharlesCaptureHttps/WiFiIpmac.webp)

#### (2) è®¾ç½®æ‰‹æœºHTTPä»£ç†

æ‰‹æœºè¿ä¸Šç”µè„‘ï¼Œç‚¹å‡»â€œè®¾ç½®->æ— çº¿å±€åŸŸç½‘->è¿æ¥çš„WiFiâ€ï¼Œè®¾ç½®HTTPä»£ç†ï¼š
æœåŠ¡å™¨ä¸ºç”µè„‘IPåœ°å€ï¼šå¦‚192.168.1.108
ç«¯å£ï¼š8888

![](/assets/images/20170901CharlesCaptureHttps/WiFiIpPortiPhone.webp)


æ³¨æ„:*è¿™é‡Œç”¨æˆ‘è‡ªå·±ç”µè„‘çš„IPä¸¾ä¾‹ çº¢è‰²åŒºåŸŸ è®°å¾—æ›¿æ¢æˆä½ è‡ªå·±çš„ç”µè„‘çš„IP*


è®¾ç½®ä»£ç†åï¼Œéœ€åœ¨åœ¨ç”µè„‘ä¸Šæ‰“å¼€Charles,è¿™ä¸ªæ—¶å€™ å¦‚æœæ‰‹æœºæœ‰è¯·æ±‚å°±ä¼šå¼¹å‡ºå¦‚ä¸‹å›¾:

![](/assets/images/20170901CharlesCaptureHttps/CharlesAllow.webp)

ç‚¹å‡»**Allow** å°±å¯ä»¥äº†

### 3. HTTPSæŠ“åŒ…

å·¦ä¸Šè§’èœå•ä¸­ é€‰æ‹©`SSL Proxying Settings`

![](/assets/images/20170901CharlesCaptureHttps/CharlesStep1.webp)

ç„¶å å‹¾é€‰`Enable SSL Proxying` 

ç´§æ¥ç€ç‚¹å‡» `Add`

![](/assets/images/20170901CharlesCaptureHttps/CharlesStep2.webp)

å†ç„¶ååœ¨

`Host`: è¾“å…¥ `*` ä»£è¡¨é€šé…æ‰€æœ‰ å¦‚æœä½ è¦æˆªè· æ¯”å¦‚ *.baidu.comé‚£å°±å†™ä¸Š

`Port`: 443 é»˜è®¤ç«¯å£ å¡«å®Œ ç‚¹å‡»OK
 
![](/assets/images/20170901CharlesCaptureHttps/CharlesStep3.webp)


ç´§æ¥ç€ ç‚¹å‡»`Help` -> `SSL Proxying` -> å®‰è£…æ ¹è¯ä¹¦

![](/assets/images/20170901CharlesCaptureHttps/CharlesStep4.webp)

å®‰è£…åˆ°é’¥åŒ™ä¸²å ç‚¹å‡»charlesçš„rootè¯ä¹¦ é€‰æ‹© `ä½¿ç”¨ä¿¡ä»»`

![](/assets/images/20170901CharlesCaptureHttps/CharlesCerRootMac.webp)

ä¸‹ä¸€æ­¥ æ˜¯å®‰è£…æ‰‹æœºçš„rootè¯ä¹¦ 

![](/assets/images/20170901CharlesCaptureHttps/CharlesStep6.webp)


è¿™æ—¶ éœ€è¦åœ¨ è®¾ç½® ä»£ç†ipçš„æ‰‹æœºä¸Š (iPhoneä¸Š)ç”¨ Safari ç›´æ¥æ‰“å¼€ç½‘å€: [chls.pro/ssl](chls.pro/ssl)

æ­¤æ—¶æ‰‹æœºä¸€ä¼šå„¿å°±å¼¹å‡ºè¿™æ ·çš„ æç¤º ç‚¹å‡»**å…è®¸**


![](/assets/images/20170901CharlesCaptureHttps/iPhone1.webp)

ç„¶å å®‰è£…è¯ä¹¦

![](/assets/images/20170901CharlesCaptureHttps/iPhone2.webp)

å®‰è£…å®Œ æœ€åä¸€æ­¥**éå¸¸é‡è¦**

__å¿…é¡»åˆ° é€šç”¨->å…³äºæœ¬æœº->è¯ä¹¦ä¿¡ä»»è®¾ç½®__å»ä¿¡ä»» è¯ä¹¦ 

![](/assets/images/20170901CharlesCaptureHttps/iPhone3.webp)


å¦‚æœä¸ä¿¡ä»» å°±ä¼šæŠ“å–çš„æ—¶å€™å‡ºç°ä¸‹å›¾è¿™æ ·çš„é—®é¢˜

![](/assets/images/20170901CharlesCaptureHttps/CharlesRootCerError.webp)

> æ³¨æ„:*iOS10.3ä»¥ä¸Šç‰ˆæœ¬ è²Œä¼¼æ‰éœ€è¦*

æœ€åæ”¾ä¸Šä¸€å¼ æˆªè·æˆåŠŸçš„å›¾ (æ”¯ä»˜å®çš„æ¥å£)

![](/assets/images/20170901CharlesCaptureHttps/Result.webp)





å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2017/08/ARKit/index.html.md
Published At: 2017-08-30 14:50:43 +0000

# ARKit

# å‰è¨€

![](/assets/images/20170830ARKit/ARKitPreview.webp)

æœ¬ç¯‡ä¼šä»å¹¿æ³›ä»‹ç»åˆ°è¯¦ç»†ä»‹ç»,ä¹Ÿå°±æ˜¯ä»ç²—ç²’åº¦å‘ç»†ç²’åº¦é€æ¸è¿‡åº¦è®²è§£.
æœŸé—´æœ‰ä»»ä½•é—®é¢˜è¯·å¤§å®¶é›†æ€å¹¿ç›Š,å¤šå¤šæŒ‡æ•™. 

# ä¸»è¦å†…å®¹

* __ARæŠ€æœ¯ä»‹ç»__ 
* __ARKitå·¥ä½œåŸç†åŠæµç¨‹ä»‹ç»__ 
* __ARKitç®€å•ä»£ç å®ç°__ 
* __ARKitæ¡†æ¶æ‰€æœ‰APIä»‹ç»__ 
* __ARScnViewä»‹ç»__ 
* __ARSessionä»‹ç»__ 
* __ARCameraä»‹ç»__ 
* __ARKitæ•æ‰å¹³åœ°__ 
* __ARä»£ç demoå®ç°__ 

## ARæŠ€æœ¯ä»‹ç»

#### ARæŠ€æœ¯ç®€ä»‹
* å¢å¼ºç°å®æŠ€æœ¯ï¼ˆAugmented Realityï¼Œç®€ç§° ARï¼‰ï¼Œæ˜¯ä¸€ç§å®æ—¶çš„è®¡ç®—æ‘„å½±æœºå½±åƒçš„ä½ç½®åŠè§’åº¦å¹¶åŠ ä¸Šç›¸åº”å›¾åƒã€è§†é¢‘ã€3Dæ¨¡å‹çš„æŠ€æœ¯ï¼Œè¿™ç§æŠ€æœ¯çš„ç›®æ ‡æ˜¯åœ¨å±å¹•ä¸ŠæŠŠè™šæ‹Ÿä¸–ç•Œå¥—åœ¨ç°å®ä¸–ç•Œå¹¶è¿›è¡Œäº’åŠ¨
* ARåœºæ™¯å®ç°æŠ€æœ¯è¦ç´ 
	1. å¤šåª’ä½“æ•æ‰ç°å®å›¾åƒï¼šå¦‚æ‘„åƒå¤´
	2. ä¸‰ç»´å»ºæ¨¡:3Dç«‹ä½“æ¨¡å‹
	3. ä¼ æ„Ÿå™¨è¿½è¸ª:ä¸»è¦è¿½è¸ªç°å®ä¸–ç•ŒåŠ¨æ€ç‰©ä½“çš„å…­è½´å˜åŒ–ï¼Œè¿™å…­è½´åˆ†åˆ«æ˜¯Xã€Yã€Zè½´ä½ç§»åŠæ—‹è½¬ã€‚å…¶ä¸­ä½ç§»ä¸‰è½´å†³å®šç‰©ä½“çš„æ–¹ä½å’Œå¤§å°ï¼Œæ—‹è½¬ä¸‰è½´å†³å®šç‰©ä½“æ˜¾ç¤ºçš„åŒºåŸŸ
	4. åæ ‡è¯†åˆ«åŠè½¬æ¢ï¼š3Dæ¨¡å‹æ˜¾ç¤ºåœ¨ç°å®å›¾åƒä¸­ä¸æ˜¯å•çº¯çš„frameåæ ‡ç‚¹ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸‰ç»´çš„çŸ©é˜µåæ ‡
	5. ARè¿˜å¯ä»¥ä¸è™šæ‹Ÿç‰©ä½“è¿›è¡Œä¸€äº›äº¤äº’(optional)  
![](/assets/images/20170830ARKit/ARDirection.webp)



#### ARKitæ¦‚è¿°åŠç‰¹ç‚¹
	
* `ARKit` æ¡†æ¶(framework)æä¾› ä¸¤ç§ AR æŠ€æœ¯
	* __åŸºäº3D åœºæ™¯(`SceneKit`) å®ç°çš„å¢å¼ºç°å®__
	* __åŸºäº2D åœºæ™¯(`SpriktKit`) å®ç°çš„å¢å¼ºç°å®__  
	
	>  ä¸€èˆ¬ä¸»æµéƒ½æ˜¯åŸºäº3D å®ç°,`ARkit`å…¼å®¹ `SceneKit`å’Œ `SpriktKit` (è‹¹æœæ¨å‡ºæ¸¸æˆå¼•æ“)framework 

* æ˜¾ç¤ºAR æ•ˆæœä¸ºä»€ä¹ˆä¾èµ– __3Då¼•æ“`SceneKit`å’Œ 2D å¼•æ“`SpriktKit` è‹¹æœçš„æ¸¸æˆå¼•æ“æ¡†æ¶? åŸå› æ˜¯æ¸¸æˆå¼•æ“æ‰å¯ä»¥åŠ è½½ç‰©ä½“æ¨¡å‹ã€‚__
>  è™½ç„¶`ARKit`ä¸­çš„è§†å›¾**(`ARSCNView`)ç»§æ‰¿è‡ª`SCNView`,`SCNView`ç»§æ‰¿è‡ª`UIView`**,
> ä½†æ˜¯ç›®å‰`ARKit `æ¡†æ¶æœ¬èº«åªåŒ…å«ç›¸æœºè¿½è¸ª, ä¸èƒ½ç›´æ¥åŠ è½½ç‰©ä½“æ¨¡å‹, æ‰€ä»¥åªèƒ½ä¾èµ–æ¸¸æˆå¼•æ“åŠ è½½ ARKit (æˆ‘è§‰å¾—è‹¹æœæ˜¯åœ¨å……åˆ†åˆ©ç”¨å’Œæ•´åˆç°æœ‰èµ„æºå¹¶æ¨å¹¿è‡ªå·±çš„ framework ä¸€çŸ³äºŒé¸Ÿ) å› ä¸ºå°±ç›®å‰æˆ‘æ²¡æœ‰çœ‹åˆ° ä»»ä½•`ARKit`æ”¯æŒ `Unity3D`æˆ–è€… `Cocoas2D`


#### iOS11 å¦‚ä½•æ”¯æŒ`ARKit`
	
iOS11è™½ç„¶æ¨å‡ºäº† `ARKit` ä½†ä¸æ˜¯æ‰€æœ‰ iOS11ç³»ç»Ÿéƒ½æ”¯æŒ  
  
* å¿…é¡» CPU  A9ä»¥ä¸Š(iPhone 6s ä»¥ä¸Š è¿˜æœ‰ iPhone SE)

å¼€å‘ç¯å¢ƒ
	
* Xcodeç‰ˆæœ¬:Xcode9åŠä»¥ä¸Š
* ç³»ç»Ÿ: iOS11åŠä»¥ä¸Š
* iOSè®¾å¤‡ï¼šå¤„ç†å™¨A9åŠ ä»¥ä¸Šï¼ˆ6Sæœºå‹åŠä»¥ä¸Š)
* macOSç³»ç»Ÿ: 10.12.4åŠä»¥ä¸Š
	

#### Xcode è‡ªå¸¦åˆ›å»ºæ¨¡æ¿(å¤šæ•°éƒ½ä¸ç”¨)

![](/assets/images/20170830ARKit/ARKitModel.webp)

demo æ¼”ç¤º

``` objc
@interface ViewController () <ARSCNViewDelegate>
//ARè§†å›¾ï¼šå±•ç¤º3Dç•Œé¢
@property (nonatomic, strong) IBOutlet ARSCNView *sceneView;

@end

    
@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];

    //åœºæ™¯ä»£ç†
    self.sceneView.delegate = self;
    
    // æ˜¾ç¤ºå¸§ç‡
    self.sceneView.showsStatistics = YES;
    
    // åˆ›å»ºä¸€ä¸ªåœºæ™¯
    SCNScene *scene = [SCNScene sceneNamed:@"art.scnassets/ship.scn"];
    
    // Set the scene to the view
    self.sceneView.scene = scene;
}

- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    
    // ä¸–ç•Œåæ ‡ç³»é…ç½®
    ARWorldTrackingSessionConfiguration *configuration = [ARWorldTrackingSessionConfiguration new];
    
    // è¿è¡Œ3D åœºæ™¯çš„ ä¼šè¯
    [self.sceneView.session runWithConfiguration:configuration];
}

- (void)viewWillDisappear:(BOOL)animated {
    [super viewWillDisappear:animated];
    
    // æš‚åœ
    [self.sceneView.session pause];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Release any cached data, images, etc that aren't in use.
}

#pragma mark - ARSCNViewDelegate


//ç»™å½“å‰é”šç‚¹åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ (node å¯ä»¥ç†è§£æˆ UIView)
/*
// Override to create and configure nodes for anchors added to the view's session.
- (SCNNode *)renderer:(id<SCNSceneRenderer>)renderer nodeForAnchor:(ARAnchor *)anchor {
    SCNNode *node = [SCNNode new];
 
    // Add geometry to the node...
 
    return node;
}
*/

//ä¼šè¯æœ‰é”™è¯¯
- (void)session:(ARSession *)session didFailWithError:(NSError *)error {
    // Present an error message to the user
    
}

//è¢«æ‰“æ–­  ç±»ä¼¼éŸ³é¢‘æ’­æ”¾çš„æ—¶å€™è¢«æ‰“æ–­ eg:å‰åå°åˆ‡æ¢ æ¥ç”µè¯  siri
- (void)sessionWasInterrupted:(ARSession *)session {
    // Inform the user that the session has been interrupted, for example, by presenting an overlay
    
}

//ä¼šè¯ç»“æŸ
- (void)sessionInterruptionEnded:(ARSession *)session {
    // Reset tracking and/or remove existing anchors if consistent tracking is required
    
}
```

## ARKitå·¥ä½œåŸç†åŠæµç¨‹ä»‹ç»


### ä¸»è¦å†…å®¹

![](/assets/images/20170830ARKit/RenderingARKit.webp)

`ARKit` å¹¶ä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹è¿è¡Œçš„æ¡†æ¶ å¿…é¡»è¦é…åˆ`SceneKit`,æ²¡æœ‰`SceneKit` `ARKit`å’Œæ™®é€šç›¸æœºæ²¡æœ‰ä»»ä½•åŒºåˆ«
 
>  _éš¾ç‚¹:3Dåæ ‡çš„çŸ©é˜µè½¬æ¢_	 (3D X/Y/Z, 4x4åæ ‡) 

ä¸‹é¢æ˜¯ä¸€å¼ å›¾ ARKit çš„æ‰€æœ‰.h å¤´æ–‡ä»¶ (æ²¡æœ‰åˆ—å‡ºæ´¾ç”Ÿçš„å­ç±»)

![](/assets/images/20170830ARKit/ARDefines.webp)

* ARKitæ¡†æ¶ä¸­çš„æ ¸å¿ƒç±»
 * __`ARScnView`__
 * __`ARSession`__
 * __`ARCamera`__
 
* `ARKit`demo ç¤ºä¾‹ å®ç°

  * æ•æ‰å¹³é¢ æ·»åŠ ç‰©ä½“

* ARè™šæ‹Ÿå¢å¼ºç°å®å°±æ˜¯æŒ‡åœ¨ç›¸æœºæ•æ‰åˆ°çš„ç°å®ä¸–ç•Œå›¾åƒä¸­æ˜¾ç¤ºä¸€ä¸ªè™šæ‹Ÿçš„3Dæ¨¡å‹,è¿™ä¸ªè¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤
	1. ç›¸æœºæ•æ‰ç°å®ä¸–ç•Œå›¾åƒ (ç”±ARKit å®ç°)  
	2. åœ¨å›¾åƒä¸­ç°å®è™šæ‹Ÿ3D æ¨¡å‹(ç”±SceneKit å®ç°)

* `ARKit`ä¸`SceneKit`æ¡†æ¶å…³ç³»å›¾

![](/assets/images/20170830ARKit/ARKitUML.webp)

1. `ARSCNView` --> `SCNView`(SceneKit.framework)-->`UIView`(UIKit.framework)
2. ARSCNViewè§†å›¾å®¹å™¨,å®ƒç®¡ç†ä¸€ä¸ª `ARSession`
3. åœ¨ä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿå¢å¼ºç°å®ä½“éªŒä¸­,`ARKit`åªè´Ÿè´£æŠŠçœŸå®ä¸–ç•Œç”»é¢è½¬å˜ä¸ºä¸€ä¸ª3D åœºæ™¯, è¿™ä¸ªè¿‡ç¨‹ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªç¯èŠ‚ï¼š
	* ARCamera è´Ÿè´£æ•æ‰æ‘„åƒå¤´ç”»é¢
	* ARSession è´Ÿè´£æ­å»º3D åœºæ™¯
4. åœ¨ä¸€ä¸ªå®Œæ•´çš„è™šæ‹Ÿå¢å¼ºç°å®ä½“éªŒä¸­,å°†è™šæ‹Ÿç‰©ä½“å±•ç°åœ¨3Dåœºæ™¯ä¸­æ˜¯ç”±`SceneKit`æ¡†æ¶æ¥å®Œæˆçš„ 
 
	>  æ¯ä¸€ä¸ªè™šæ‹Ÿçš„ç‰©ä½“éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹SCNNode,æ¯ä¸€ä¸ªèŠ‚ç‚¹æ„æˆäº†ä¸€ä¸ªåœºæ™¯SCNScene,æ— æ•°ä¸ªåœºæ™¯æ„æˆäº†3Dä¸–ç•Œ
	
	> å¯ä»¥ç†è§£UIViewController çš„[view addSubview:xxxView];
	
	
### ARKitå·¥ä½œåŸç†

#### ARSCNViewä¸ ARSessionå…³ç³»

è¯´ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹è¿™ä¸ª`Session` å’Œ`Context`å‘½åä»¥åŠå«ä¹‰

`Session` ç›´è¯‘: ä¼šè¯  
`Context` ç›´è¯‘: ä¸Šä¸‹æ–‡

_åœ¨iOSæ¡†æ¶ä¸­ï¼Œå‡¡æ˜¯å¸¦sessionæˆ–è€…contextåç¼€çš„ï¼Œè¿™ç§ç±»ä¸€èˆ¬è‡ªå·±ä¸å¹²æ´»ï¼Œä½œç”¨ä¸€èˆ¬éƒ½æ˜¯ä¸¤ä¸ª_:

* __ç®¡ç†å…¶ä»–ç±»ï¼Œå¸®åŠ©ä»–ä»¬æ­å»ºæ²Ÿé€šæ¡¥æ¢ï¼Œå¥½å¤„å°±æ˜¯è§£è€¦__ 
* __è´Ÿè´£å¸®åŠ©æˆ‘ä»¬ç®¡ç†å¤æ‚ç¯å¢ƒä¸‹çš„å†…å­˜__

_`Session` å’Œ`Context`ä¸åŒç‚¹_

* session æœ‰ç¡¬ä»¶å‚ä¸çš„(ä¸€èˆ¬ä¸ç¡¬ä»¶æ‰“äº¤é“), eg: æ‘„åƒå¤´æ•æ‰ `ARSession`ã€éŸ³é¢‘ `AVAudioSession`, ç½‘å¡ç›¸å…³çš„`NSURLSession` .... ç­‰ç­‰.
* context ä¸€èˆ¬æ²¡æœ‰ç¡¬ä»¶å‚ä¸çš„, eg: `CGGraphicContext`ã€`EAGLContext` ç»˜å›¾ä¸Šä¸‹æ–‡, ä»¥åŠè‡ªå®šä¹‰è½¬åœºé‡Œé¢çš„é‚£ä¸ª Context å°±ä¸è¯¦ç»†åˆ—ä¸¾äº†.


å›åˆ°æ­£é¢˜, å¦‚ä¸Šæ‰€è¯´ æˆ‘ä»¬è¦æƒ³å®ç°ä¸€ä¸ª

`ARSCNView` ä¸`ARCamera` ä¹‹é—´ç›¸äº’ååŒé…åˆ
(`ARSCNView` ä¸`ARCamera` ä¸¤è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥å…³ç³»)

* __ARSCNView -----> ARCamera æˆ–__   
* __ARSCNView <----- ARCamera__

> __ARSCNViewé‡Œæœ‰ä¸ª ARFrame(å±æ€§ æˆå‘˜å˜é‡), ARFrame é‡Œé¢åŒ…å« ARCamera(å±æ€§ æˆå‘˜å˜é‡)__

å°±éœ€è¦ä¸€ä¸ªæ²Ÿé€šçš„æ¡¥æ¢ è¿›è¡Œè°ƒåº¦é…åˆåä½œå®Œæˆ å›¾åƒæ•æ‰åˆ°è§†è§‰æ¸²æŸ“çš„è¿‡ç¨‹__è¿™ä¸ªæ¡¥æ¢ å°±æ˜¯ `ARSession`__

![](/assets/images/20170830ARKit/ARKitSession.webp)


å¦‚æœæƒ³è¿è¡Œä¸€ä¸ª `ARSession`ä¼šè¯,å¿…é¡»æŒ‡å®šä¸€ä¸ªå«`ä¼šè¯è¿½è¸ªé…ç½®`çš„å¯¹è±¡`ARConfiguration`,`ARConfiguration`ä¸»è¦ç›®çš„è´Ÿè´£è¿½è¸ªç›¸æœºåœ¨3D ä¸–ç•Œä¸­çš„ä½ç½®ä»¥åŠä¸€äº›ç‰¹å¾åœºæ™¯çš„æ•æ‰,__æ¯”å¦‚æ•æ‰å¹³é¢__,è¿™ä¸ªç±» ä½œç”¨å¾ˆå¤§

* `ARConfiguration`æ˜¯ä¸ªçˆ¶ç±»,ä¸ºäº†æ›´å¥½å®ç°å¢å¼ºç°å®çš„æ•ˆæœ,è‹¹æœå»ºè®®æˆ‘ä»¬ä½¿ç”¨æ´¾ç”Ÿè‡ªå®ƒçš„å­ç±»`ARWorldTrackingConfiguration `(è¿™ä¸ªç±»ä»…æ”¯æŒ`A9`èŠ¯ç‰‡ä¹‹åçš„æœºå‹). 

æ³¨æ„: _åŸæ¥æ˜¯è¿™ä¸ª`ARWorldTrackingSessionConfiguration`ç°åœ¨è¢«å¼ƒç”¨äº†._


![](/assets/images/20170830ARKit/ARWorldTrackingConfiguration.webp)

#### ARFrame ä¸ ARWorldTrackingConfiguration

`ARSession` æ­å»ºæ²Ÿé€šçš„æ¡¥æ¢çš„å‚ä¸è€…æœ‰ä¸¤ä¸ª

1. ARFrame
2. ARWorldTrackingConfiguration

`ARWorldTrackingConfiguration` ï¼ˆ3Dä¸–ç•Œè¿½è¸ªé…ç½®) çš„ä½œç”¨æ˜¯è·Ÿè¸ªè®¾å¤‡çš„__æ–¹å‘ã€ä½ç½®ã€æ£€æµ‹æ‘„åƒå¤´æ•æ‰åˆ°çš„å†…å®¹__.

å®ƒçš„å†…éƒ¨å®ç°äº†ä¸€ç³»åˆ—åºå¤§çš„ç®—æ³•å’Œè°ƒç”¨iPhone ä¸Šå¿…è¦çš„ä¼ æ„Ÿå™¨æ¥æ£€æµ‹æ‰‹æœºçš„ __ç§»åŠ¨ã€æ—‹è½¬ã€å¹³ç§»__(å…­è½´ä½ç½®æ–¹å‘å˜åŒ–) 

å½“`ARWorldTrackingConfiguration`è®¡ç®—å‡ºç›¸æœºåœ¨3D ä¸–ç•Œä¸­çš„ä½ç½®æ—¶,ä¼šæŠŠè¿™ä¸ª**ä½ç½®æ•°æ®** äº¤ä¸ª`ARSession`å»ç®¡ç†, è€Œç›¸æœºçš„**ä½ç½®æ•°æ®**å¯¹åº”çš„ç±»å°±æ˜¯`ARFrame` 

> `ARSession`ç±»ä¸€ä¸ªå±æ€§å«`currentFrame` å°±æ˜¯ ARFrame çš„å®ä¾‹å˜é‡

`ARCamera`åªè´Ÿè´£æ•æ‰å›¾åƒ,ä¸å‚ä¸æ•°æ®çš„å¤„ç†. å®ƒå±äº3D åœºæ™¯ä¸­çš„ä¸€ä¸ªç¯èŠ‚,
æ¯ä¸ª3D Scene éƒ½ä¼šæœ‰ä¸€ä¸ª Camera, è¿™ä¸ª Camera å†³å®šäº†æˆ‘ä»¬çœ‹åˆ°ç‰©ä½“çš„è§†é‡.

è¿™ä¸‰è€…å…³ç³»å¦‚ä¸‹:

![](/assets/images/20170830ARKit/RelationshipARFrame.webp)


> `ARFrame`é‡Œé¢æœ‰æˆ‘ä»¬éœ€è¦çš„`CVPixelBufferRef`(capturedImage) å’Œ `ARCamera` ä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å›¾åƒçš„åŸå§‹æ•°æ®

__ARCameraåœ¨3Dä¸–ç•Œçš„ä½ç½®__

![](/assets/images/20170830ARKit/Coordinate.webp)


### ARKit å·¥ä½œæµç¨‹


![](/assets/images/20170830ARKit/ARWorkflow.webp) å›¾ç‰‡æ¥è‡ª:[å¤å°](http://www.jianshu.com/p/0492c7122d2f)

1. `ARSCNView`åŠ è½½åœºæ™¯`SCNScene`
2. `SCNScene` å¯åŠ¨ç›¸æœº`ARCamera`å¼€å§‹æ•æ‰åœºæ™¯
3. `ARCamera` æ•æ‰åœºæ™¯å `ARSCNView`å¼€å§‹å°†åœºæ™¯æ•°æ®ç»™`ARSession`
4. `ARSession` é€šè¿‡`ARConfiguration`(æˆ–è€…å®ƒçš„æ´¾ç”Ÿå­ç±») å®ç°åœºæ™¯çš„è¿½è¸ªå¹¶è¿”å›ä¸€ä¸ª`ARFrame`.
5. ç»™`ARSCNView`çš„ scene æ·»åŠ ä¸€ä¸ªå­èŠ‚ç‚¹(3Dç‰©ä½“æ¨¡å‹)

> `ARConfiguration` æ•æ‰ç›¸æœºçš„ä½ç½®çš„ç›®çš„æ˜¯__èƒ½å¤Ÿåœ¨æ·»åŠ çš„3D ç‰©ä½“æ¨¡å‹çš„æ—¶å€™è®¡ç®—å‡º3D ç‰©ä½“æ¨¡å‹ç›¸å¯¹äºç›¸æœºçš„çœŸå®çŸ©é˜µä½ç½®__

æ³¨æ„:__åœ¨3Dåæ ‡ç³»ç»Ÿä¸­__
 
 * ä¸–ç•Œåæ ‡ç³» ç›¸å½“äº UIView çš„ `Frame`
 * æœ¬åœ°åæ ‡ç³» ç›¸å½“äº UIView çš„ `bounds`

> åæ ‡ç³»çš„è½¬æ¢åœ¨ ARKit ä¸­æ˜¯æ¯”è¾ƒéš¾éƒ¨åˆ† 


## ARKitç®€å•ä»£ç å®ç°

[ä»£ç ARKitDemo1](https://github.com/sunyazhou13/ARDemos/blob/master/ARDemo1.zip)

``` objc
- (void)touchesBegan:(NSSet<UITouch *> *)touches withEvent:(UIEvent *)event{
    //1. ä½¿ç”¨åœºæ™¯åŠ è½½ scn æ–‡ä»¶
    
    SCNScene *scene = [SCNScene sceneNamed:@"Models.scnassets/vase/vase.scn"];
    SCNNode *plantNode = scene.rootNode.childNodes[0];
    
    //2. è°ƒæ•´ä½ç½® å°†èŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰å±å¹•ä¸­
    plantNode.position = SCNVector3Make(0, -1, -1);
    
    
    //3. å°†é£æœºèŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰å±å¹•
    [self.arSceneView.scene.rootNode addChildNode:plantNode];
    
}
```

è¿™é‡Œéœ€è¦è¡¥å……ä¸€ç‚¹ 

> æˆ‘ä»¬å…ˆæŠ›å¼€`ARSCNView`å’Œ `UIViewController` ä»¥åŠ`UIView`çš„å…³ç³»

__æˆ‘ä»¬åªè¯´ä¸€ä¸‹`ARSCNView`,`scene`,`node`å•¥å…³ç³»__

`ARSCNView` æ˜¯ä¸ªé›†æˆè‡ª UIView çš„è§†å›¾

`ARSCNView` æœ‰ä¸ªå±æ€§(æˆå‘˜å˜é‡)å«`scene` è¿™å°±ç›¸å½“äº VC

`scene`æœ‰ `rootNode` ç›¸å½“äº VC æœ‰`self.view`

__å¯ä»¥æŠŠ`scene`ç†è§£ä¸º VC__  
__æŠŠ`rootNode`ç†è§£ä¸º `self.view`__

æˆ‘ä»¬çŸ¥é“ self.view å¯ä»¥æ·»åŠ  å­ view é€šè¿‡ 

``` objc
[self.view addSubview:xxx];
```

 é‚£ä¹ˆ node ä¹Ÿå°±æœ‰äº†ç›¸åº”çš„æ–¹æ³•
 
 ``` objc
[scene.rootNode addChildNode:xxxNode];
 ```

> æ³¨æ„:*__æ‰€æœ‰çš„åœºæ™¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹__*


## ARKitæ¡†æ¶æ‰€æœ‰APIä»‹ç»


![](/assets/images/20170830ARKit/ARDefines.webp)

è¿˜æ˜¯æ‹¿ä¸Šè¾¹è¿™å¼ å›¾è¯´ä¸€ä¸‹ è¿™é‡Œæˆ‘ä»¬è¯‰æ±‚å‰–ææ‰€æœ‰ API ä»è€Œè¾¾åˆ°å¤§å®¶éƒ½äº†è§£ ARKitçš„å†…å®¹

#### ARAnchor

`ARAnchor`è¡¨ç¤ºä¸€ä¸ªç‰©ä½“åœ¨3D ç©ºé—´çš„ä½ç½®å’Œæ–¹å‘(ARAnchor ä¿—ç§° 3D é”šç‚¹, ç±»ä¼¼ UIKit æ¡†æ¶ä¸­ CALayerçš„ Anchor)

``` objc
@interface ARAnchor : NSObject <NSCopying>

//é”šç‚¹å”¯ä¸€æ ‡è¯†
@property (nonatomic, readonly) NSUUID *identifier;

//é”šç‚¹çš„æ—‹è½¬å˜æ¢çŸ©é˜µï¼Œå®šä¹‰äº†é”šç‚¹çš„æ—‹è½¬ã€ä½ç½®ã€ç¼©æ”¾ã€‚æ˜¯ä¸€ä¸ª4x4çš„çŸ©é˜µ
@property (nonatomic, readonly) matrix_float4x4 transform;

//æ„é€ æ–¹æ³•,ä¸€èˆ¬æˆ‘ä»¬æ— éœ€æ„é€ ã€‚å› ä¸ºæ·»åŠ ä¸€ä¸ª3Dç‰©ä½“æ—¶ARKitä¼šæœ‰ä»£ç†å‘ŠçŸ¥æˆ‘ä»¬ç‰©ä½“çš„é”šç‚¹
- (instancetype)initWithTransform:(matrix_float4x4)transform;

```

> `ARFrame`è¡¨ç¤ºçš„ä¹Ÿæ˜¯ç‰©ä½“çš„ä½ç½®å’Œæ–¹å‘,ä½†æ˜¯`ARFrame`é€šå¸¸æ ‡è¯†çš„æ˜¯ AR ç›¸æœºçš„**ä½ç½®**å’Œ**æ–¹å‘**ä»¥åŠè¿½è¸ªç›¸æœºçš„æ—¶é—´æˆ³,è¿˜æœ‰æ•æ‰åˆ°ç›¸æœºçš„å›¾ç‰‡å¸§(CVPixelBufferRef)

#### ARError

`ARError` é”™è¯¯æè¿°ç±», eg: è®¾å¤‡ä¸æ”¯æŒ, å¸¸é©»åå°çš„ä¼šè¯ä¸­æ–­...ç­‰


``` objc
FOUNDATION_EXTERN NSString *const ARErrorDomain;

typedef NS_ERROR_ENUM(ARErrorDomain, ARErrorCode) {
    /** Unsupported session configuration. */
    ARErrorCodeUnsupportedConfiguration   = 100,
    
    /** A sensor required to run the session is not available. */
    ARErrorCodeSensorUnavailable          = 101,
    
    /** A sensor failed to provide the required input. */
    ARErrorCodeSensorFailed               = 102,
    
    /** App does not have permission to use the camera. The user may change this in settings. */
    ARErrorCodeCameraUnauthorized         = 103,
    
    /** World tracking has encountered a fatal error. */
    ARErrorCodeWorldTrackingFailed        = 200,
};
```

#### ARFrame

`ARFrame` ä¸»è¦æ˜¯è¿½è¸ªå½“å‰çš„çŠ¶æ€ eg: å›¾ç‰‡å¸§, æ—¶é—´æˆ³,ä½ç½®æ–¹å‘ç­‰å‚æ•°.

``` objc
@interface ARFrame : NSObject <NSCopying>

//æ—¶é—´æˆ³
@property (nonatomic, readonly) NSTimeInterval timestamp;

//å›¾ç‰‡å¸§
@property (nonatomic, readonly) CVPixelBufferRef capturedImage;

//ç›¸æœºï¼ˆè¡¨ç¤ºè¿™ä¸ªARFrameæ˜¯å“ªä¸€ä¸ªç›¸æœºçš„ï¼ŒiPhone7plusæœ‰ä¸¤ä¸ªæ‘„åƒæœºï¼‰
@property (nonatomic, copy, readonly) ARCamera *camera;

//è¿”å›å½“å‰ç›¸æœºæ•æ‰åˆ°çš„é”šç‚¹æ•°æ®ï¼ˆå½“ä¸€ä¸ª3Dè™šæ‹Ÿæ¨¡å‹åŠ å…¥åˆ°ARKitä¸­æ—¶ï¼Œé”šç‚¹å€¼å¾—å°±æ˜¯è¿™ä¸ªæ¨¡å‹åœ¨ARä¸­çš„ä½ç½®ï¼‰
@property (nonatomic, copy, readonly) NSArray<ARAnchor *> *anchors;

//ç¯å…‰ æŒ‡çš„æ˜¯ç¯å…‰å¼ºåº¦ ä¸€èˆ¬æ˜¯0-2000ï¼Œç³»ç»Ÿé»˜è®¤1000
@property (nonatomic, strong, nullable, readonly) ARLightEstimate *lightEstimate;

//ç‰¹å¾ç‚¹ï¼ˆåº”è¯¥æ˜¯æ•æ‰å¹³åœ°æˆ–è€…äººè„¸çš„ï¼Œæ¯”è¾ƒè‹¹æœæœ‰è‡ªå¸¦çš„äººè„¸è¯†åˆ«åŠŸèƒ½ï¼‰ ä»…é™ world çš„è¿½è¸ªé…ç½®å¯ç”¨
@property (nonatomic, strong, nullable, readonly) ARPointCloud *rawFeaturePoints;

//æ ¹æ®2Dåæ ‡ç‚¹æœç´¢3Dæ¨¡å‹ï¼Œè¿™ä¸ªæ–¹æ³•é€šå¸¸ç”¨äºï¼Œå½“æˆ‘ä»¬åœ¨æ‰‹æœºå±å¹•ç‚¹å‡»æŸä¸€ä¸ªç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥æ•æ‰åˆ°è¿™ä¸€ä¸ªç‚¹æ‰€åœ¨çš„3Dæ¨¡å‹çš„ä½ç½®ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªæ•°ç»„éå¸¸å¥½ç†è§£ã€‚æ‰‹æœºå±å¹•ä¸€ä¸ªæ˜¯é•¿æ–¹å½¢ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒç»´ç©ºé—´ã€‚è€Œç›¸æœºæ•æ‰åˆ°çš„æ˜¯ä¸€ä¸ªç”±è¿™ä¸ªäºŒç»´ç©ºé—´å°„å‡ºå»çš„é•¿æ–¹ä½“ï¼Œæˆ‘ä»¬ç‚¹å‡»å±å¹•ä¸€ä¸ªç‚¹å¯ä»¥ç†è§£ä¸ºåœ¨è¿™ä¸ªé•¿æ–¹ä½“çš„è¾¹ç¼˜å°„å‡ºä¸€æ¡çº¿ï¼Œè¿™ä¸€æ¡çº¿ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ª3Dç‰©ä½“æ¨¡å‹
pointï¼š2Dåæ ‡ç‚¹ï¼ˆæ‰‹æœºå±å¹•æŸä¸€ç‚¹ï¼‰
ARHitTestResultTypeï¼šæ•æ‰ç±»å‹  ç‚¹è¿˜æ˜¯é¢
(NSArray<ARHitTestResult *> *)ï¼šè¿½è¸ªç»“æœæ•°ç»„

- (NSArray<ARHitTestResult *> *)hitTest:(CGPoint)point types:(ARHitTestResultType)types;

//ç›¸æœºçª—å£çš„çš„åæ ‡å˜æ¢ï¼ˆå¯ç”¨äºç›¸æœºæ¨ªç«–å±çš„æ—‹è½¬é€‚é…ï¼‰
-(CGAffineTransform)displayTransformWithViewportSize:(CGSize)viewportSize orientation:(UIInterfaceOrientation)orientation;

@end
```

è¿™é‡Œè¯´ä¸€ä¸‹ä¸€ä¸ªæŠ€å·§ å¦‚æœåœ¨ä¸€ä¸ªç±»é‡Œé¢æˆ‘ä»¬ä¸æƒ³æä¾›`init:`æ–¹æ³•çš„è¯ è¯¥å¦‚ä½•å†™ï¼Ÿ

æˆ‘ä»¬éƒ½çŸ¥é“`OC`é‡Œé¢æ‰€æœ‰çš„`class`éƒ½æ˜¯ç»§æ‰¿ è‡ª`NSObject`,`NSObject`é‡Œé¢æœ‰`init:`ã€`dealloc:`ç­‰æ–¹æ³•.


``` objc
@interface ARAnchor (Unavailable)

- (instancetype)init NS_UNAVAILABLE;
+ (instancetype)new NS_UNAVAILABLE;
@end
```

> è¿™é‡Œç”¨åˆ°çš„æŠ€å·§å°±æ˜¯ å†™ä¸ª Category å¹¶å¤å†™è¯¥æ–¹æ³•åè¾¹æ ‡æ³¨ä¸º`NS_UNAVAILABLE`


#### ARHitTestResult

`ARHitTestResult` ç‚¹å‡»å›è°ƒç»“æœ,è¿™ä¸ªç±»ä¸»è¦ç”¨äºAR æŠ€æœ¯ä¸­ __ç°å®ä¸–ç•Œä¸3D åœºæ™¯ä¸­è™šæ‹Ÿç‰©ä½“çš„äº¤äº’.__ eg:åœ¨ç›¸æœºä¸­ç§»åŠ¨ã€æ‹–æ‹½3D è™šæ‹Ÿç‰©ä½“,éƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç±»æ¥è·å– ARKit æ‰€æ•æ‰çš„ç»“æœ.

``` objc
typedef NS_OPTIONS(NSUInteger, ARHitTestResultType) {
    //ç‚¹
    ARHitTestResultTypeFeaturePoint              = (1 << 0),
	//æ°´å¹³é¢ yä¸º0.    
    ARHitTestResultTypeEstimatedHorizontalPlane  = (1 << 1),
    
    //å·²ç»“å­˜åœ¨çš„å¹³é¢
    ARHitTestResultTypeExistingPlane             = (1 << 3),
    
    //å·²ç»“å­˜åœ¨çš„é”šç‚¹å’Œå¹³é¢
    ARHitTestResultTypeExistingPlaneUsingExtent  = (1 << 4),
} NS_SWIFT_NAME(ARHitTestResult.ResultType);

@interface ARHitTestResult : NSObject

//æ•æ‰ç±»å‹
@property (nonatomic, readonly) ARHitTestResultType type;

//3Dè™šæ‹Ÿç‰©ä½“ä¸ç›¸æœºçš„è·ç¦»ï¼ˆå•ä½ï¼šç±³ï¼‰
@property (nonatomic, readonly) CGFloat distance;

//æœ¬åœ°åæ ‡çŸ©é˜µï¼ˆä¸–ç•Œåæ ‡æŒ‡çš„æ˜¯ç›¸æœºä¸ºåœºæ™¯åŸç‚¹çš„åæ ‡ï¼Œè€Œæ¯ä¸€ä¸ª3Dç‰©ä½“è‡ªèº«æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæœ¬åœ°åæ ‡å°±æ˜¯ç›¸å¯¹äºè¿™ä¸ªåœºæ™¯çš„åæ ‡ï¼‰ç±»ä¼¼äºframeå’Œboundsçš„åŒºåˆ«
@property (nonatomic, readonly) matrix_float4x4 localTransform;

//ä¸–ç•Œåæ ‡çŸ©é˜µ
@property (nonatomic, readonly) matrix_float4x4 worldTransform;

//é”šç‚¹ï¼ˆ3Dè™šæ‹Ÿç‰©ä½“ï¼Œåœ¨è™šæ‹Ÿä¸–ç•Œæœ‰ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªä½ç½®å‚æ•°æ˜¯SceneKitä¸­çš„SCNVector3ï¼šä¸‰ç»´çŸ¢é‡ï¼‰ï¼Œè€Œé”šç‚¹anchoræ˜¯è¿™ä¸ªç‰©ä½“åœ¨ARç°å®åœºæ™¯ä¸­çš„ä½ç½®ï¼Œæ˜¯ä¸€ä¸ª4x4çš„çŸ©é˜µ
@property (nonatomic, strong, nullable, readonly) ARAnchor *anchor;

@end
```

è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹:

* **matrix_float4x4** __worldTransform__; ä¸–ç•Œåæ ‡ç³» __ä»¥ç›¸æœºä¸ºåœºæ™¯çš„åŸç‚¹å¼€å§‹(0,0,0,0)__ ä¹Ÿå°±æ˜¯ä»¥ç›¸æœºä¸ºåœ†å¿ƒå‘å¤–,å‚ç…§è¿™ä¸ªåŸç‚¹ 3D ç‰©ä½“çš„ä½ç½®ä¿¡æ¯. è¿™å°±ç›¸å½“äº2D çš„ UIView çš„ frame (ç»å¯¹åæ ‡)

* **matrix_float4x4**  __localTransform__; æœ¬åœ°åæ ‡ç³» ä»¥ä¸€ä¸ª node ä¸ºçˆ¶èŠ‚ç‚¹ä¸ºå‚ç…§,ç›¸å½“äºè·ç¦»è¿™ä¸ªçˆ¶åœºæ™¯çš„åæ ‡.

* **matrix_float4x4** [4x4 çŸ©é˜µè¯·å‚è€ƒè¿™é‡Œ](http://www.opengl-tutorial.org/cn/beginners-tutorials/tutorial-3-matrices/) 

#### ARLightEstimate

`ARLightEstimate`

``` objc
@interface ARLightEstimate : NSObject

//ç¯å¢ƒç¯å…‰å¼ºåº¦  èŒƒå›´0-2000 é»˜è®¤1000
@property (nonatomic, readonly) CGFloat ambientIntensity;

//ç¯å¢ƒå…‰æ¸©åº¦
@property (nonatomic, readonly) CGFloat ambientColorTemperature;

@end

```

#### ARPlaneAnchor

`ARPlaneAnchor`æ´¾ç”Ÿè‡ª`ARAnchor`çš„å­ç±», å¹³é¢é”šç‚¹.`ARKit`èƒ½è‡ªåŠ¨è¯†åˆ«å¹³åœ°,å¹¶ä¸”æ·»åŠ ä¸€ä¸ªé”šç‚¹åˆ°åœºæ™¯ä¸­,å½“ç„¶è¦æƒ³çœ‹åˆ°çœŸå®ä¸–ç•Œä¸­çš„å¹³åœ°æ•ˆæœéœ€è¦æˆ‘ä»¬è‡ªå·±ä½¿ç”¨ `SCNNode`æ¸²æŸ“ä¸€ä¸ªé”šç‚¹.
> é”šç‚¹åªæ˜¯ä¸€ä¸ªä½ç½®

``` objc
@interface ARPlaneAnchor : ARAnchor

//å¹³åœ°ç±»å‹ï¼Œç›®å‰åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯æ°´å¹³é¢ 
@property (nonatomic, readonly) ARPlaneAnchorAlignment alignment;

//3è½´çŸ¢é‡ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¹³åœ°çš„ä¸­å¿ƒç‚¹  x/y/z
@property (nonatomic, readonly) vector_float3 center;

//3è½´çŸ¢é‡ç»“æ„ä½“ï¼Œè¡¨ç¤ºå¹³åœ°çš„å¤§å°ï¼ˆå®½åº¦å’Œé«˜åº¦ï¼‰  x/y/z
@property (nonatomic, readonly) vector_float3 extent;

@end
```


#### ARPointCloud

`ARPointCloud` ç‚¹çŠ¶æ¸²æŸ“  

``` objc
@interface ARPointCloud : NSObject <NSCopying>

//ç‚¹æ•°
@property (nonatomic, readonly) NSUInteger count;

//æ¯ä¸€ä¸ªç‚¹çš„ä½ç½®çš„é›†åˆï¼ˆç»“æ„ä½“å¸¦*è¡¨ç¤ºçš„æ˜¯ç»“æ„ä½“æ•°ç»„ï¼‰
@property (nonatomic, readonly) const vector_float3 *points;

@end
```


#### ARConfiguration

`ARConfiguration` ä¼šè¯è¿½è¸ªé…ç½®

``` objc
//è¿½è¸ªå¯¹å…¶æ–¹å¼
typedef NS_ENUM(NSInteger, ARWorldAlignment) {
    /* ç›¸æœºä½ç½® vector (0, -1, 0) /
    ARWorldAlignmentGravity,
    /* ç›¸æœºä½ç½®åŠæ–¹å‘. vector (0, -1, 0)    heading ï¼š(0, 0, -1) */
    ARWorldAlignmentGravityAndHeading,
    /* ç›¸æœºæ–¹å‘. */
    ARWorldAlignmentCamera
} ;

typedef NS_OPTIONS(NSUInteger, ARPlaneDetection) {
    ARPlaneDetectionNone        = 0,
    ARPlaneDetectionHorizontal  = (1 << 0), //æ¢æµ‹å¹³é¢æ˜¯æ°´å¹³æ¨ªå‘
} ;


@interface ARConfiguration : NSObject <NSCopying>

//å½“å‰è®¾å¤‡æ˜¯å¦æ”¯æŒï¼Œä¸€èˆ¬A9èŠ¯ç‰‡ä»¥ä¸‹è®¾å¤‡ä¸æ”¯æŒ
@property(class, nonatomic, readonly) BOOL isSupported;

//ä¸–ç•Œåæ ‡çš„å¯¹é½æ–¹å¼ 
@property (nonatomic, readwrite) ARWorldAlignment worldAlignment;

//æ˜¯å¦éœ€è¦è‡ªé€‚åº”ç¯å…‰æ•ˆæœï¼Œé»˜è®¤æ˜¯YES
@property (nonatomic, readwrite, getter=isLightEstimationEnabled) BOOL lightEstimationEnabled;

@end

//ä¸–ç•Œä¼šè¯è¿½è¸ªé…ç½®ï¼Œè‹¹æœå»ºè®®æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªç±»ï¼Œè¿™ä¸ªå­ç±»åªæœ‰ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿½è¸ªç›¸æœºæ•æ‰åˆ°çš„å¹³åœ°
@interface ARWorldTrackingSessionConfiguration : ARConfiguration

//æ¢æµ‹çš„ç±»å‹
@property (nonatomic, readwrite) ARPlaneDetection planeDetection;

@end
```

> ä¼šè¯é…ç½®çš„æ©å­ç±»:ARWorldTrackingSessionConfigurationï¼Œå®ƒä»¬åœ¨åŒä¸€ä¸ªAPIæ–‡ä»¶ä¸­


#### ARSKView

`ARSKView`æ˜¯2D çš„ AR è§†å›¾ è¿™ä¸ªåŸºæœ¬å°±ä¸éœ€è¦è®²äº† å’Œ `ARSCNView`ä¸€æ ·,å°±ä¸é‡å¤ä»‹ç»äº†

#### ARScnView é‡ç‚¹ä»‹ç»

``` objc
@interface ARSCNView : SCNView

//ä»£ç†
@property (nonatomic, weak, nullable) id<ARSCNViewDelegate> delegate;

//AR ä¼šè¯
@property (nonatomic, strong) ARSession *session;

//åœºæ™¯
@property(nonatomic, strong) SCNScene *scene;

//æ˜¯å¦è‡ªåŠ¨é€‚åº”ç¯å…‰
@property(nonatomic) BOOL automaticallyUpdatesLighting;

//è¿”å›å¯¹åº”èŠ‚ç‚¹çš„é”šç‚¹ï¼ŒèŠ‚ç‚¹æ˜¯ä¸€ä¸ª3Dè™šæ‹Ÿç‰©ä½“ï¼Œå®ƒçš„åæ ‡æ˜¯è™šæ‹Ÿåœºæ™¯ä¸­çš„åæ ‡ï¼Œè€Œé”šç‚¹ARAnchoræ˜¯ARKitä¸­ç°å®ä¸–ç•Œçš„åæ ‡
- (nullable ARAnchor *)anchorForNode:(SCNNode *)node;

//è¿”å›å¯¹åº”é”šç‚¹çš„ç‰©ä½“
- (nullable SCNNode *)nodeForAnchor:(ARAnchor *)anchor;

/**


 */
- (NSArray<ARHitTestResult *> *)hitTest:(CGPoint)point types:(ARHitTestResultType)types;

@end

```
> æ ¹æ®2Dåæ ‡ç‚¹æœç´¢3Dæ¨¡å‹ï¼Œè¿™ä¸ªæ–¹æ³•é€šå¸¸ç”¨äºï¼Œå½“æˆ‘ä»¬åœ¨æ‰‹æœºå±å¹•ç‚¹å‡»æŸä¸€ä¸ªç‚¹çš„æ—¶å€™ï¼Œå¯ä»¥æ•æ‰åˆ°è¿™ä¸€ä¸ªç‚¹æ‰€åœ¨çš„3Dæ¨¡å‹çš„ä½ç½®ï¼Œè‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸€ä¸ªæ•°ç»„éå¸¸å¥½ç†è§£ã€‚æ‰‹æœºå±å¹•ä¸€ä¸ªæ˜¯é•¿æ–¹å½¢ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒç»´ç©ºé—´ã€‚è€Œç›¸æœºæ•æ‰åˆ°çš„æ˜¯ä¸€ä¸ªç”±è¿™ä¸ªäºŒç»´ç©ºé—´å°„å‡ºå»çš„é•¿æ–¹ä½“ï¼Œæˆ‘ä»¬ç‚¹å‡»å±å¹•ä¸€ä¸ªç‚¹å¯ä»¥ç†è§£ä¸ºåœ¨è¿™ä¸ªé•¿æ–¹ä½“çš„è¾¹ç¼˜å°„å‡ºä¸€æ¡çº¿ï¼Œè¿™ä¸€æ¡çº¿ä¸Šå¯èƒ½ä¼šæœ‰å¤šä¸ª3Dç‰©ä½“æ¨¡å‹,pointï¼š2Dåæ ‡ç‚¹ï¼ˆæ‰‹æœºå±å¹•æŸä¸€ç‚¹ï¼‰
ARHitTestResultTypeï¼šæ•æ‰ç±»å‹  ç‚¹è¿˜æ˜¯é¢
(NSArray<ARHitTestResult *> *)ï¼šè¿½è¸ªç»“æœæ•°ç»„  è¯¦æƒ…è§æœ¬ç« èŠ‚ARHitTestResultç±»ä»‹ç»
æ•°ç»„çš„ç»“æœæ’åºæ˜¯ç”±è¿‘åˆ°è¿œ

ä»£ç†æ–¹æ³•

``` objc
//ä»£ç†çš„å†…éƒ¨å®ç°äº†SCNSceneRendererDelegateï¼šscenekitä»£ç† å’ŒARSessionObserverï¼šARSessionç›‘å¬ï¼ˆKVOæœºåˆ¶ï¼‰
#pragma mark - ARSCNViewDelegate
@protocol ARSCNViewDelegate <SCNSceneRendererDelegate, ARSessionObserver>
@optional

//è‡ªå®šä¹‰èŠ‚ç‚¹çš„é”šç‚¹
- (nullable SCNNode *)renderer:(id <SCNSceneRenderer>)renderer nodeForAnchor:(ARAnchor *)anchor;

//å½“æ·»åŠ èŠ‚ç‚¹æ˜¯ä¼šè°ƒç”¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªä»£ç†æ–¹æ³•å¾—çŸ¥æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªè™šæ‹Ÿç‰©ä½“åˆ°ARåœºæ™¯ä¸‹çš„é”šç‚¹ï¼ˆARç°å®ä¸–ç•Œä¸­çš„åæ ‡ï¼‰
- (void)renderer:(id <SCNSceneRenderer>)renderer didAddNode:(SCNNode *)node forAnchor:(ARAnchor *)anchor;

//å°†è¦åˆ·æ–°èŠ‚ç‚¹
- (void)renderer:(id <SCNSceneRenderer>)renderer willUpdateNode:(SCNNode *)node forAnchor:(ARAnchor *)anchor;

//å·²ç»åˆ·æ–°èŠ‚ç‚¹
- (void)renderer:(id <SCNSceneRenderer>)renderer didUpdateNode:(SCNNode *)node forAnchor:(ARAnchor *)anchor;

//ç§»é™¤èŠ‚ç‚¹
- (void)renderer:(id <SCNSceneRenderer>)renderer didRemoveNode:(SCNNode *)node forAnchor:(ARAnchor *)anchor;

@end
```

#### ARSesson é‡ç‚¹ä»‹ç»

![](/assets/images/20170830ARKit/SessionBridge.webp)

`ARSesson` æ˜¯ä¸€ä¸ªè¿æ¥åº•å±‚ä¸ AR è§†å›¾ä¹‹é—´çš„æ¡¥æ¢, `ARSCNView`é‡Œçš„æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯åˆ`ARSession`æä¾›çš„


__`ARSesson`è·å–ç›¸æœºä½ç½®æ•°æ®ä¸»è¦ç”±ä¸¤ç§æ–¹å¼__

* push é€šè¿‡å®ç° Session çš„ä»£ç†`session:didUpdateFrame:`å‘ŠçŸ¥ç”¨æˆ·
* pull ç”¨æˆ·æƒ³è¦å¯ä¸»åŠ¨å»å– `ARSession`çš„`currentFrame`å±æ€§

``` objc
@interface ARSession : NSObject

//ä»£ç†
@property (nonatomic, weak) id <ARSessionDelegate> delegate;

//æŒ‡å®šä»£ç†æ‰§è¡Œçš„çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ä¸ä¼šæœ‰å»¶è¿Ÿï¼Œå­çº¿ç¨‹ä¼šæœ‰å»¶è¿Ÿï¼‰ï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤ä¸»çº¿ç¨‹
@property (nonatomic, strong, nullable) dispatch_queue_t delegateQueue;

//ç›¸æœºå½“å‰çš„ä½ç½®ï¼ˆæ˜¯ç”±ä¼šè¯è¿½è¸ªé…ç½®è®¡ç®—å‡ºæ¥çš„ï¼‰
@property (nonatomic, copy, nullable, readonly) ARFrame *currentFrame;

//ä¼šè¯é…ç½®
@property (nonatomic, copy, nullable, readonly) ARConfiguration *configuration;

//è¿è¡Œä¼šè¯ï¼ˆè¿™è¡Œä»£ç å°±æ˜¯å¼€å¯ARçš„å…³é”®æ‰€åœ¨ï¼‰
- (void)runWithConfiguration:(ARConfiguration *)configuration NS_SWIFT_UNAVAILABLE("Use run(_:options:) instead");

//è¿è¡Œä¼šè¯ï¼Œåªæ˜¯å¤šäº†ä¸€ä¸ªå‚æ•°ARSessionRunOptionsï¼šä½œç”¨å°±æ˜¯ä¼šè¯æ–­å¼€é‡è¿æ—¶çš„è¡Œä¸ºã€‚
- (void)runWithConfiguration:(ARConfiguration *)configuration options:(ARSessionRunOptions)options NS_SWIFT_NAME(run(_:options:));

//æš‚åœä¼šè¯
- (void)pause;

//æ·»åŠ é”šç‚¹
- (void)addAnchor:(ARAnchor *)anchor NS_SWIFT_NAME(add(anchor:));

//ç§»é™¤é”šç‚¹
- (void)removeAnchor:(ARAnchor *)anchor NS_SWIFT_NAME(remove(anchor:));

@end

```

> è¿è¡Œä¼šè¯__runWithConfiguration:options:__ options æ˜¯ä¸ª`ARSessionRunOptions`æšä¸¾  
> è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ä¼šè¯æ–­å¼€é‡è¿æ—¶çš„è¡Œä¸º

``` objc
typedef NS_OPTIONS(NSUInteger, ARSessionRunOptions) {
	 //è¡¨ç¤ºé‡ç½®è¿½è¸ª
    ARSessionRunOptionResetTracking           = (1 << 0),
    
    //ç§»é™¤ç°æœ‰é”šç‚¹
    ARSessionRunOptionRemoveExistingAnchors   = (1 << 1)
};
```

ä¸‹é¢æ¥çœ‹ä¸‹`ARSession`çš„ä»£ç†

`ARSession` åˆ† ä¸¤ç§

* KVO è§‚å¯Ÿè€… ARSessionObserver
* delegate å§”æ‰˜ä»£ç† ARSessionDelegate

> çœ‹åˆ°è¿™æˆ‘ä¹Ÿå¾ˆå¥‡æ€ªè¿™ä¸ªç©æ³• 

ARSessionObserverå¦‚ä¸‹

``` objc
@protocol ARSessionObserver <NSObject>

@optional

//session å¤±è´¥
- (void)session:(ARSession *)session didFailWithError:(NSError *)error;

//ç›¸æœºè¿½è¸ªçŠ¶æ€å‘ç”Ÿæ”¹å˜
- (void)session:(ARSession *)session cameraDidChangeTrackingState:(ARCamera *)camera;

//session æ„å¤–æ–­å¼€ï¼ˆå¦‚æœå¼€å¯ARSessionä¹‹åï¼ŒAPPé€€åˆ°åå°å°±æœ‰å¯èƒ½å¯¼è‡´ä¼šè¯æ–­å¼€ï¼‰
- (void)sessionWasInterrupted:(ARSession *)session;

//session ä¼šè¯æ–­å¼€å æ¢å¤(çŸ­æ—¶é—´é€€åˆ°åå°å†è¿›å…¥APPä¼šè‡ªåŠ¨æ¢å¤ï¼‰
- (void)sessionInterruptionEnded:(ARSession *)session;

//session å·²ç»è¾“å‡ºäº†ä¸€ä¸ª éŸ³é¢‘æ•°æ® `CMSampleBufferRef` 
- (void)session:(ARSession *)session didOutputAudioSampleBuffer:(CMSampleBufferRef)audioSampleBuffer;

@end
```

ARSessionDelegate å¦‚ä¸‹

``` objc
ç›¸æœºä½ç½®å‘ç”Ÿæ”¹å˜ å°±æ˜¯ç›¸æœºçš„ä½ç½®æœ‰å˜åŠ¨
- (void)session:(ARSession *)session didUpdateFrame:(ARFrame *)frame;

// å·²æ·»åŠ é”šç‚¹
- (void)session:(ARSession *)session didAddAnchors:(NSArray<ARAnchor*>*)anchors;

//åˆ·æ–°é”šç‚¹
- (void)session:(ARSession *)session didUpdateAnchors:(NSArray<ARAnchor*>*)anchors;

//ç§»é™¤é”šç‚¹
- (void)session:(ARSession *)session didRemoveAnchors:(NSArray<ARAnchor*>*)anchors;

@end
```

ä»¥ä¸Šæ˜¯ `ARSession`

#### ARCamera é‡ç‚¹ä»‹ç»

`ARCamera`æ˜¯ä¸ªç›¸æœº, å®ƒæ˜¯é“¾æ¥è™šæ‹Ÿåœºæ™¯å’Œç°å®åœºæ™¯çš„ä¹‹é—´çš„æ¢çº½. 

åœ¨`ARKit`ä¸­,å®ƒæ˜¯æ•æ‰ç°å®å›¾åƒçš„ç›¸æœº,åœ¨ SceneKit ä¸­å®ƒæ˜¯3D è™šæ‹Ÿä¸–ç•Œä¸­çš„ç›¸æœº

> æ¸¸æˆé‡Œä¸€èˆ¬ç¬¬ä¸€äººç§°3D æ¸¸æˆ, è‹±é›„å°±æ˜¯ä¸€ä¸ª3D ç›¸æœº, æˆ‘ä»¬ç”µè„‘å±å¹•çœ‹åˆ°çš„ç”»é¢å°±æ˜¯è¿™ä¸ªç›¸æœºæ•æ‰åˆ°çš„ç”»é¢

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å»åˆ›å»ºä¸€ä¸ª`ARCamera`å®ä¾‹, å› ä¸ºæ¯æ¬¡åˆå§‹åŒ–ä¸€ä¸ª `ARSCNView`çš„æ—¶å€™,å®ƒä¼šé»˜è®¤ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`ARCamera`å®ä¾‹,è€Œä¸”è¿™ä¸ªç›¸æœºå°±æ˜¯æ‘„åƒå¤´çš„ä½ç½®,åŒæ—¶ä¹Ÿæ˜¯3D ä¸–ç•Œä¸­çš„åŸç‚¹æ‰€åœ¨ __(0,0,0)__ 

è‡³äº`ARCamera` çš„ api ä¸€èˆ¬æˆ‘ä»¬ä¹Ÿä¸ç”¨ care,`ARKit`é»˜è®¤ä¼šé…ç½®å¥½.

``` objc
@interface ARCamera : NSObject <NSCopying>

//4x4çŸ©é˜µè¡¨ç¤ºç›¸æœºä½ç½® è·Ÿé”šç‚¹ç±»ä¼¼
@property (nonatomic, readonly) matrix_float4x4 transform;

//ç›¸æœºæ–¹å‘ï¼ˆæ—‹è½¬ï¼‰çš„çŸ¢é‡æ¬§æ‹‰è§’ åˆ†åˆ«æ˜¯x/y/z
@property (nonatomic, readonly) vector_float3 eulerAngles;

//ç›¸æœºè¿½è¸ªçŠ¶æ€ï¼ˆåœ¨ä¸‹æ–¹ä¼šæœ‰æšä¸¾å€¼ä»‹ç»ï¼‰
@property (nonatomic, readonly) ARTrackingState trackingState NS_REFINED_FOR_SWIFT;

//è¿½è¸ªè¿åŠ¨ç±»å‹
@property (nonatomic, readonly) ARTrackingStateReason trackingStateReason NS_REFINED_FOR_SWIFT;

//ç›¸æœºæ›²ç‡ 3x3çŸ©é˜µ  
@property (nonatomic, readonly) matrix_float3x3 intrinsics;

//æ‘„åƒå¤´åˆ†è¾¨ç‡
@property (nonatomic, readonly) CGSize imageResolution;

//æŠ•å½±çŸ©é˜µ
@property (nonatomic, readonly) matrix_float4x4 projectionMatrix;


//åˆ›å»ºç›¸æœº ä½¿ç”¨x,y,z ä½ç½® 
- (CGPoint)projectPoint:(vector_float3)point orientation:(UIInterfaceOrientation)orientation viewportSize:(CGSize)viewportSize;
 
//åˆ›å»ºç›¸æœºæŠ•å½±çŸ©é˜µ è¿‘é¢è·ç¦»  è¿œé¢è·ç¦»
- (matrix_float4x4)projectionMatrixForOrientation:(UIInterfaceOrientation)orientation viewportSize:(CGSize)viewportSize zNear:(CGFloat)zNear zFar:(CGFloat)zFar;

//åˆ›å»ºç›¸æœºæŠ•å½±çŸ©é˜µ
- (matrix_float4x4)viewMatrixForOrientation:(UIInterfaceOrientation)orientation;

@end
```

> ä¸Šè¾¹æåˆ°çš„è¿œé¢å’Œè¿‘é¢è·ç¦» ![](/assets/images/20170830ARKit/distance.webp)  å¯ä»¥å‚è€ƒè¿™å¼ å›¾ æ‘˜è‡ª[æŠ•å½±å˜æ¢](http://www.jianshu.com/p/bc151ff65cef)
> ![](/assets/images/20170830ARKit/distance2.webp)
>  è¿™å±äº OpenGLçš„å­¦ä¹ èŒƒç•´.æœ‰å…´è¶£å¯ä»¥å­¦ä¹ ä¸€ä¸‹

``` objc
//ç›¸æœºè¿½è¸ªçŠ¶æ€æšä¸¾
typedef NS_ENUM(NSInteger, ARTrackingState) {
	 /* ä¸è¢«å…è®¸ */
    ARTrackingStateNotAvailable,
    
    /* æœ€å° */
    ARTrackingStateLimited,
    
    /* æ­£å¸¸. */
    ARTrackingStateNormal,
};

//è¿½è¸ªè¿åŠ¨ç±»å‹
typedef NS_ENUM(NSInteger, ARTrackingStateReason) {
    /* æ— . */
    ARTrackingStateReasonNone,
    
    //åˆå§‹åŒ–
    ARTrackingStateReasonInitializing,
    
    /* è¿åŠ¨. */
    ARTrackingStateReasonExcessiveMotion,
    
    /** è„¸éƒ¨æ•æ‰. */
    ARTrackingStateReasonInsufficientFeatures,
}
```

> è¿™é‡Œé¢æ¶‰åŠåˆ°çš„ ä¸€ä¸ªå«åš`eulerAngles`[æ¬§æ‹‰è§’](https://zh.wikipedia.org/wiki/%E6%AC%A7%E6%8B%89%E8%A7%92) 
> ![](/assets/images/20170830ARKit/EulerAngles.webp)
> è¿™ä¸ªæ¬§æ‹‰è§’æ˜¯è§£å†³3Dç‰©ä½“çš„ æ—‹è½¬çŸ©é˜µ ç­‰å–å‘é—®é¢˜, å°±æœ‰æœ‰ä¸€ä¸ªå¹³é¢ æ˜¯é™æ­¢ä¸åŠ¨çš„ ä¸€ä¸ªå¹³é¢æ˜¯åŠ¨çš„ æ ¹æ®åœ†å¿ƒè·ç¦»ä¸¤ä¸ªå¹³é¢ç›¸äº¤çš„ è§’åº¦æˆ–è€… sin cos æ¥è§£å†³ä¸€äº›å¤¹è§’æ ‡è®°ã€æ—‹è½¬çŸ©é˜µç­‰é—®é¢˜ å…·ä½“å¯ä»¥å‚è€ƒç»´åŸºç™¾ç§‘çš„è§£é‡Š (æˆ‘ç ”ç©¶äº†ä¸€é˜µ è¿˜æ˜¯äº‘é‡Œé›¾é‡Œ è§ç¬‘è§ç¬‘) 


#### ARKitæ•æ‰å¹³åœ°

![](/assets/images/20170830ARKit/PlaneDetective.gif)

[æ¢æµ‹å¹³åœ°demo](https://github.com/sunyazhou13/ARDemos/blob/master/ARDemoPlaneDetective.zip)

è´´ä¸€ä¸‹æ ¸å¿ƒä»£ç 

æ·»åŠ èŠ‚ç‚¹æ—¶å€™è°ƒç”¨ï¼ˆå½“å¼€å¯å¹³åœ°æ•æ‰æ¨¡å¼ä¹‹åï¼Œå¦‚æœæ•æ‰åˆ°å¹³åœ°ï¼ŒARKitä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªå¹³åœ°èŠ‚ç‚¹ï¼‰

``` objc
#pragma mark -
#pragma mark - ARSCNViewDelegate ä»£ç†

- (void)renderer:(id <SCNSceneRenderer>)renderer didAddNode:(SCNNode *)node forAnchor:(ARAnchor *)anchor{
    if ([anchor isMemberOfClass:[ARPlaneAnchor class]]) {
        NSLog(@"æ•æ‰åˆ°å¹³åœ°");
        //æ·»åŠ ä¸€ä¸ª3D å¹³é¢æ¨¡å‹,ARKit åªæœ‰æ•æ‰èƒ½åŠ›,é”šç‚¹æ˜¯ä¸€ä¸ªç©ºé—´ä½ç½®,è¦æƒ³æ›´åŠ æ¸…æ¥šçš„çœ‹åˆ°è¿™ä¸ªç©ºé—´,æˆ‘ä»¬éœ€è¦ç»™ç©ºé—´æ·»åŠ ä¸€ä¸ªå¹³åœ°çš„3Dæ¨¡å‹æ¥æ¸²æŸ“ä»–
        //1. è·å–æ‰‘æ‰åˆ°çš„å¹³åœ°é”šç‚¹
        ARPlaneAnchor *planeAnchor = (ARPlaneAnchor *)anchor;
        //2. åˆ›å»ºä¸€ä¸ª3Dç‰©ä½“æ¨¡å‹ (ç³»ç»Ÿæ•æ‰åˆ°çš„å¹³åœ°æ˜¯ä¸€ä¸ªä¸è§„åˆ™å¤§å°çš„é•¿æ–¹å½¢ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å…¶å˜æˆä¸€ä¸ªé•¿æ–¹å½¢ï¼Œå¹¶ä¸”å¯¹å¹³åœ°åšä¸€æ¬¡ç¼©æ”¾ï¼‰
        //åˆ›å»ºé•¿æ–¹å½¢  å‚æ•°:é•¿,å®½,é«˜,åœ†è§’
        SCNBox *plane = [SCNBox boxWithWidth:planeAnchor.extent.x * 0.3 height:0 length:planeAnchor.extent.x * 0.3 chamferRadius:0];
        //3. ä½¿ç”¨Materialæ¸²æŸ“3Dæ¨¡å‹ é»˜è®¤æ¨¡å‹æ˜¯ç™½è‰²çš„
        plane.firstMaterial.diffuse.contents = [UIColor cyanColor];
        
        //4. åˆ›å»ºä¸€ä¸ªåŸºäº3D ç‰©ä½“æ¨¡å‹çš„èŠ‚ç‚¹
        SCNNode *planeNode = [SCNNode nodeWithGeometry:plane];
        //5. è®¾ç½®èŠ‚ç‚¹çš„ä½ç½®ä¸ºæ•æ‰åˆ°çš„å¹³åœ°çš„é”šç‚¹å’Œä¸­å¿ƒä½ç½® SceneKitæ¡†æ¶ä¸­èŠ‚ç‚¹çš„ä½ç½®positionæ˜¯ä¸€ä¸ªåŸºäº3Dåæ ‡ç³»çš„çŸ¢é‡åæ ‡SCNVector3Make
        planeNode.position = SCNVector3Make(planeAnchor.center.x, 0, planeAnchor.center.z);
        
        [node addChildNode:planeNode];
        
        //6. å½“æ•æ‰åˆ°å¹³åœ°æ—¶ï¼Œ2sä¹‹åå¼€å§‹åœ¨å¹³åœ°ä¸Šæ·»åŠ ä¸€ä¸ª3Dæ¨¡å‹
        
        dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^{
            //1.åˆ›å»ºä¸€ä¸ªèŠ±ç“¶åœºæ™¯
            SCNScene *scene = [SCNScene sceneNamed:@"Models.scnassets/vase/vase.scn"];
            //2.è·å–èŠ±ç“¶èŠ‚ç‚¹ï¼ˆä¸€ä¸ªåœºæ™¯ä¼šæœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæ­¤å¤„æˆ‘ä»¬åªå†™ï¼ŒèŠ±ç“¶èŠ‚ç‚¹åˆ™é»˜è®¤æ˜¯åœºæ™¯å­èŠ‚ç‚¹çš„ç¬¬ä¸€ä¸ªï¼‰
            //æ‰€æœ‰çš„åœºæ™¯æœ‰ä¸”åªæœ‰ä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯æ ¹èŠ‚ç‚¹çš„å­èŠ‚ç‚¹
            SCNNode *vaseNode = scene.rootNode.childNodes[0];
            
            //4.è®¾ç½®èŠ±ç“¶èŠ‚ç‚¹çš„ä½ç½®ä¸ºæ•æ‰åˆ°çš„å¹³åœ°çš„ä½ç½®ï¼Œå¦‚æœä¸è®¾ç½®ï¼Œåˆ™é»˜è®¤ä¸ºåŸç‚¹ä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç›¸æœºä½ç½®
            vaseNode.position = SCNVector3Make(planeAnchor.center.x, 0, planeAnchor.center.z);
            
            //5.å°†èŠ±ç“¶èŠ‚ç‚¹æ·»åŠ åˆ°å½“å‰å±å¹•ä¸­
            //!!!æ­¤å¤„ä¸€å®šè¦æ³¨æ„ï¼šèŠ±ç“¶èŠ‚ç‚¹æ˜¯æ·»åŠ åˆ°ä»£ç†æ•æ‰åˆ°çš„èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸æ˜¯ARè¯•å›¾çš„æ ¹èŠ‚ç‚¹ã€‚å› ä¸ºæ•æ‰åˆ°çš„å¹³åœ°é”šç‚¹æ˜¯ä¸€ä¸ªæœ¬åœ°åæ ‡ç³»ï¼Œè€Œä¸æ˜¯ä¸–ç•Œåæ ‡ç³»
            [node addChildNode:vaseNode];
        });
    }
}

```

#### ARä»£ç demoå®ç°



[æ‰€æœ‰ç›¸å…³çš„ demos ä»“åº“](https://github.com/sunyazhou13/ARDemos)


å‚è€ƒæ–‡çŒ® 

[Using ARKit with Metal](http://metalkit.org/2017/07/29/using-arkit-with-metal.html)  

[å¤å°1~10ç¯‡](http://www.jianshu.com/p/c97b230fa391)



URL: https://sunyazhou.com/2017/08/LearningAVFoundationAVAssetSenior/index.html.md
Published At: 2017-08-07 20:36:46 +0000

# Learning AV Foundation(å››)AVAssetå…ƒæ•°æ®(é«˜çº§ç¯‡)

![](/assets/images/20170807LearningAVFoundationAVAssetSenior/AudioArtwork.webp)

# å‰è¨€

å…ˆä¸Šå›¾ 

![](/assets/images/20170807LearningAVFoundationAVAssetSenior/metadata.gif)

è¿™ä¸€ç¯‡ **æˆ‘ä»¬å°†å­¦ä¹ è§£å†³å¦‚ä½•ä¸€å¥—ä»£ç è§£æå¤§éƒ¨åˆ† å¤šåª’ä½“æ ¼å¼çš„æ–‡ä»¶ç„¶åå½¢æˆé€šç”¨çš„ model - å…ƒæ•°æ®é”®å€¼ç©ºé—´æ ‡å‡†åŒ–**

## å†…å®¹ä»‹ç»

ç»“æ„å›¾
![](/assets/images/20170807LearningAVFoundationAVAssetSenior/MetaDataModel.webp)
 
--- 

class ä»£ç  

* __MediaItem (ä¸€ä¸ªç›´æ¥å¯¹å¤–çš„æ¥å£)__
* __MetaData (å…ƒæ•°æ®model)__
* __Genre (é£æ ¼)__
* __AVMetadataItem+Additions__
* __MetadataDefines__
* __MetadataKit__
* __Converters (æ–‡ä»¶å¤¹åŒ…å«å¦‚ä¸‹:)__
	* __MetadataConverter  (Protocol å­˜å– `AVMetadataItem`)__
	* __MetadataConverterFactory__
	* __DefaultMetadataConverter__
	* __ArtworkMetadataConverter__
	* __CommentMetadataConverter__
	* __TrackMetadataConverter__
	* __DiscMetadataConverter__
	* __GenreMetadataConverter__

---

 
### MediaItem

è¿™ä¸ªç±»ä¸»è¦å¯¹å¤–ç›´æ¥æš´éœ²æ¥å£ å¦‚ä¸‹ä»£ç å³å¯è°ƒç”¨ä½¿ç”¨

``` objc
__weak typeof(self) weakSelf = self;
MediaItem *item = [[MediaItem alloc] initWithURL:self.url];
[item prepareWithCompletionHandler:^(BOOL complete) {
    __strong typeof(weakSelf) strongSelf = weakSelf;
    [strongSelf refreshDataByItem:item];
    NSLog(@"%@",[item modelDescription]);
}];


```

ä»£ç å®ç°éƒ¨åˆ†  

``` objc
#import <Foundation/Foundation.h>
#import <AVFoundation/AVFoundation.h>
#import "MetaData.h"
typedef void(^CompletionHandler)(BOOL complete);
@interface MediaItem : NSObject
@property (strong, readonly) NSString *filename;
@property (strong, readonly) NSString *filetype;
@property (strong, readonly) MetaData *metadata;
@property (readonly, getter = isEditable) BOOL editable;
- (id)initWithURL:(NSURL *)url;
/**
 æ­¤æ–¹æ³•å®Œæˆä¹‹åå¦‚æœæˆåŠŸå³å¯å–metadata

 @param handler å›è°ƒ block
 */
- (void)prepareWithCompletionHandler:(CompletionHandler)handler;
- (void)saveWithCompletionHandler:(CompletionHandler)handler;
@end
@end
```

`.m`å¯å‚è€ƒæºç  æ¯”è¾ƒå¤šå°±ä¸èµ˜è¿°äº†

å½“ block å®Œæˆæ—¶ä½¿ç”¨ 
ç›®å‰æ”¯æŒè·å–å…ƒæ•°æ®ä¿¡æ¯çš„åª’ä½“æ ¼å¼å¦‚ä¸‹:  

* m4a
* mov
* mp4
* mp3

> æ³¨æ„:_**mp3æ–‡ä»¶æ˜¯ä¸å¯ç¼–è¾‘çš„æ–‡ä»¶æ•…è€Œä¸èƒ½è¿›è¡Œç¼–è¾‘ æ¯”å¦‚æ”¹å˜æ­Œæ‰‹åç§°ä¹‹ç±» å¦‚æœè¦ç¼–è¾‘å¯ä½¿ç”¨å…¶å®ƒä¸“ä¸šè½¯ä»¶å°è¯•**_  




æˆ‘å°è¯•äº† mac ç‰ˆæœ¬çš„ demo ç¼–è¾‘ æ–‡ä»¶ æ˜¯ OK çš„ ä½†æ˜¯åœ¨ iOS ä¸Š æˆ‘æ›´æ”¹å…¶å®ƒæ ¼å¼ä¹Ÿæ²¡èƒ½ä¿å­˜æˆåŠŸ å¦‚æœä½ çœ‹åˆ°æœ‰è§£å†³åŠæ³• å¯ä»¥ç•™è¨€ç»™æˆ‘æˆ–è€…å‘é‚®ä»¶ç»™æˆ‘ éå¸¸æ„Ÿè°¢.

### MetaData

``` objc
#import <Foundation/Foundation.h>
#import <AVFoundation/AVFoundation.h>
@class Genre; //é£æ ¼  eg: è“è°ƒã€ å¤å…¸ ....
@interface MetaData : NSObject
@property (copy) NSString *name;
@property (copy) NSString *artist;
@property (copy) NSString *albumArtist;
@property (copy) NSString *album;
@property (copy) NSString *grouping;
@property (copy) NSString *composer;
@property (copy) NSString *comments;
@property (strong) UIImage *artwork;
@property (strong) Genre *genre;
@property NSString *year;
@property id bpm;
@property NSNumber *trackNumber;
@property NSNumber *trackCount;
@property NSNumber *discNumber;
@property NSNumber *discCount;
- (void)addMetadataItem:(AVMetadataItem *)item withKey:(id)key;
- (NSArray *)metadataItems;
@end


```
çœ‹åˆ°ä¸Šè¾¹çš„ä»£ç ä¼°è®¡ä½ ä¹ŸçŒœåˆ°äº† è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ æ¯”å¦‚ mp3æ–‡ä»¶è§£æå‡ºæ¥çš„çœŸæ­£ model  

è¿™é‡Œä¸œè¥¿æ¯”è¾ƒå¤š æœ‰äº›å€¼æœ‰å¯èƒ½æ²¡æœ‰ è¯·è‡ªè¡Œåšå¥½ check

### MetadataConverter
è¿™ä¸ªåè®®æ˜¯ä¸ºäº†æ”¯æŒæ‰€æœ‰å¤šåª’ä½“æ–‡ä»¶ç»Ÿä¸€è§£æä½¿ç”¨,æ¯”å¦‚:mp3æ–‡ä»¶å’Œmp4æ–‡ä»¶ä¸¤ä¸ªæ˜¯ä¸ä¸€æ ·çš„æ–‡ä»¶æ ¼å¼,è™½ç„¶é‡Œé¢æœ‰å¾ˆå¤šç›¸åŒçš„key,ä½†æ˜¯è‚¯å®šæ•°æ®ç»“æ„æ˜¯ä¸ä¸€æ ·çš„,è¿™æ ·å°±è¦æ±‚,æä¸€ä¸ªç»Ÿä¸€çš„åè®®,æ¯”å¦‚è¾“å…¥çš„æ˜¯ä¸€ä¸ªURLè¿”å›ä¸€ä¸ª modelé‚£ä¹ˆä¸ºäº†è§£å†³key valueå‚å·®ä¸é½é—®é¢˜ å°±æäº†è¿™ä¸ªåè®®.

``` objc
@protocol zh <NSObject>
@optional
/**
 AVMetadataItem to Model è½¬æ¢ ç”¨äºUIæ˜¾ç¤ºçš„model

 @param item AVMetadataItem
 @return model
 */
- (id)displayValueFromMetadataItem:(AVMetadataItem *)item;
/**
 AVMetadataItemæ˜ å°„é€šç”¨å­—æ®µ
 
 @param value é€šè¿‡åª’ä½“å…ƒæ•°æ®å–å‡ºçš„æŸä¸ªkeyçš„value
 @param item AVMetadataItem
 @return AVMetadataItem
 */
- (AVMetadataItem *)metadataItemFromDisplayValue:(id)value
                                withMetadataItem:(AVMetadataItem *)item;
@end
```



### MetadataConverterFactory

è¿™ä¸ªç±»ç”¨äºç»Ÿä¸€è¾“å‡ºéµå®ˆ`MetadataConverter`åè®®çš„modelå¹¶ä¸”æ‰¾åˆ°é€‚å½“çš„è½¬æ¢å™¨å»è½¬æ¢å“åº”çš„æ ¼å¼

``` objc
@interface MetadataConverterFactory : DefaultMetadataConverter
- (id <MetadataConverter>)converterForKey:(NSString *)key;
@end

@implementation MetadataConverterFactory
- (id <MetadataConverter>)converterForKey:(NSString *)key{
    id <MetadataConverter> converter = nil;
    if ([key isEqualToString:MetadataKeyArtwork]) {
        converter = [[ArtworkMetadataConverter alloc] init];
    } else if ([key isEqualToString:MetadataKeyTrackNumber]) {
        converter = [[TrackMetadataConverter alloc] init];
    } else if ([key isEqualToString:MetadataKeyDiscNumber]) {
        converter = [[DiscMetadataConverter alloc] init];
    } else if ([key isEqualToString:MetadataKeyComments]) {
        converter = [[CommentMetadataConverter alloc] init];
    } else if ([key isEqualToString:MetadataKeyGenre]) {
        converter = [[GenreMetadataConverter alloc] init];
    } else {
        converter = [[DefaultMetadataConverter alloc] init];
    }
    return converter;
}
@end
```


### DefaultMetadataConverter

ç®€å•å®ç°`MetadataConverter`åè®®


``` objc
@interface DefaultMetadataConverter : NSObject <MetadataConverter>

@end

@implementation DefaultMetadataConverter

- (id)displayValueFromMetadataItem:(AVMetadataItem *)item {
    return item.value;
}

- (AVMetadataItem *)metadataItemFromDisplayValue:(id)value
                                withMetadataItem:(AVMetadataItem *)item {    
    AVMutableMetadataItem *metadataItem = [item mutableCopy];
    metadataItem.value = value;
    return metadataItem;
}


```


### ArtworkMetadataConverter
å®ç°`MetadataConverter`åè®® å–å‡ºä¸“è¾‘å°é¢

æ­¤å¤„çœç•¥ .h æ–‡ä»¶åªè´´å‡º.m ( .hé‡Œé¢å•¥ä¹Ÿæ²¡æœ‰ å¤§å®¶å¯å‚è€ƒ demo)

``` objc
@implementation ArtworkMetadataConverter
- (id)displayValueFromMetadataItem:(AVMetadataItem *)item {
    UIImage *image = nil;  //ä¸‹é¢æ˜¯æ ¸å¿ƒä»£ç å–å‡ºå›¾ç‰‡ 
    if ([item.value isKindOfClass:[NSData class]]) {                        // 1
        image = [[UIImage alloc] initWithData:item.dataValue];
    }
    else if ([item.value isKindOfClass:[NSDictionary class]]) {             // 2
        NSDictionary *dict = (NSDictionary *)item.value;
        image = [[UIImage alloc] initWithData:dict[@"data"]];
    }
    return image;
}

- (AVMetadataItem *)metadataItemFromDisplayValue:(id)value
                                withMetadataItem:(AVMetadataItem *)item {
    
    AVMutableMetadataItem *metadataItem = [item mutableCopy];
    
    UIImage *image = (UIImage *)value;
    metadataItem.value = UIImagePNGRepresentation(image);                          // 3
    
    return metadataItem;
}

@end

```

è¿™é‡Œ mp3 (id3v2æ ¼å¼ï¼‰å–å›¾ç‰‡çš„æ–¹å¼å¯èƒ½æœ‰ä¸ä¸€æ ·çš„åœ°æ–¹ 1å‡ºåˆ¤æ–­ å±äºå“ªç§æ ¼å¼ 3å¤„æŠŠ UIImage è½¬ NSData å†æ”¾å›å»

éœ€è¦æ³¨æ„ä¸€ä¸ªåœ°æ–¹æ˜¯ è¿”å›`AVMetadataItem`çš„ç±»å‹
ç”±äº`AV Foundation`æ— æ³•å†™å…¥ ID3å…ƒæ•°æ® æ‰€ä»¥è¿™é‡Œä½¿ç”¨äº† `AVMutableMetadataItem`æ¥å­˜å‚¨å°é¢å›¾

`AVMutableMetadataItem` æ˜¯ `AVMetadataItem`çš„å­ç±»

### CommentMetadataConverter æ³¨é‡Šè½¬æ¢

``` objc
@implementation CommentMetadataConverter

- (id)displayValueFromMetadataItem:(AVMetadataItem *)item {
    
    NSString *value = nil;
    if ([item.value isKindOfClass:[NSString class]]) {                      // 1
        value = item.stringValue;
    }
    else if ([item.value isKindOfClass:[NSDictionary class]]) {             // 2
        NSDictionary *dict = (NSDictionary *) item.value;
        if ([dict[@"identifier"] isEqualToString:@""]) {
            value = dict[@"text"];
        }
    }
    return value;
}

- (AVMetadataItem *)metadataItemFromDisplayValue:(id)value
                                withMetadataItem:(AVMetadataItem *)item {
    
    AVMutableMetadataItem *metadataItem = [item mutableCopy];               // 3
    metadataItem.value = value;
    return metadataItem;
}
@end
```

1. `MPEG-4`å’Œ`QuickTime`åª’ä½“çš„ value ä¸º `NSString`  
2. `MP3`çš„æ³¨é‡Šä¿å­˜åœ¨ä¸€ä¸ªå®šä¹‰`ID3 COMMå¸§`çš„`NSDictionary`ä¸­(å¦‚æœå¤„ç†çš„æ˜¯`ID3V2.2`,åˆ™ä¸º`COM`),æ‰€æœ‰ç±»å‹çš„å€¼éƒ½ä¿å­˜åœ¨è¿™ä¸ªå¸§ä¸­. egï¼š iTune åœ¨è¿™ä¸ªå¸§ä¸­ä¿å­˜éŸ³é¢‘æ ‡å‡†åŒ–å’Œæ— ç¼æ’­æ”¾è®¾ç½®ç­‰,æ„å‘³ç€å½“è¯·æ±‚ `ID3`å…ƒæ•°æ®æ—¶éœ€è¦å¤šæ¥æ”¶å¤šä¸ª`COMMå¸§`.åŒ…å«å®é™…æ³¨é‡Šå†…å®¹çš„ç‰¹å®š`COMMå¸§`è¢«å­˜å‚¨åœ¨ä¸€ä¸ªå¸¦æœ‰ç©ºå­—ç¬¦ä¸²æ ‡è¯†çš„å¸§ä¸­.æ‰¾åˆ°éœ€è¦çš„æ¡ç›®å é€šè¿‡è¯·æ±‚`text` key æ¥æ£€ç´¢å‡ºæ³¨é‡Šå†…å®¹

### TrackMetadataConverter éŸ³è½¨æ•°æ®è½¬æ¢

éŸ³è½¨: é€šå¸¸åŒ…å«ä¸€é¦–æ­Œæ›²åœ¨æ•´ä¸ªå”±ç‰‡ä¸­çš„ç¼–å·ä½ç½®ä¿¡æ¯(eg: 12é¦–æ­Œä¸­çš„ç¬¬4é¦–  4/12)ç­‰ä¿¡æ¯.

``` objc
@implementation TrackMetadataConverter
- (id)displayValueFromMetadataItem:(AVMetadataItem *)item {
    
    NSNumber *number = nil;
    NSNumber *count = nil;
    
    if ([item.value isKindOfClass:[NSString class]]) {                      // 1
        NSArray *components =
        [item.stringValue componentsSeparatedByString:@"/"];
        if (components.count > 0) {
            number = @([components[0] integerValue]);
        }
        if (components.count > 1) {
            count = @([components[1] integerValue]);
        }
    }
    else if ([item.value isKindOfClass:[NSData class]]) {                   // 2
        NSData *data = item.dataValue;
        if (data.length == 8) {
            uint16_t *values = (uint16_t *) [data bytes];
            if (values[1] > 0) {
                number = @(CFSwapInt16BigToHost(values[1]));                // 3
            }
            if (values[2] > 0) {
                count = @(CFSwapInt16BigToHost(values[2]));                 // 4
            }
        }
    }
    
    NSMutableDictionary *dict = [NSMutableDictionary dictionary];           // 5
    [dict setObject:number ?: [NSNull null] forKey:MetadataKeyTrackNumber];
    [dict setObject:count ?: [NSNull null] forKey:MetadataKeyTrackCount];
    
    return dict;
}
- (AVMetadataItem *)metadataItemFromDisplayValue:(id)value
                                withMetadataItem:(AVMetadataItem *)item {
    AVMutableMetadataItem *metadataItem = [item mutableCopy];
    
    NSDictionary *trackData = (NSDictionary *)value;
    NSNumber *trackNumber = trackData[MetadataKeyTrackNumber];
    NSNumber *trackCount = trackData[MetadataKeyTrackCount];
    
    uint16_t values[4] = {0};                                                // 6
    
    if (trackNumber && ![trackNumber isKindOfClass:[NSNull class]]) {
        values[1] = CFSwapInt16HostToBig([trackNumber unsignedIntValue]);   // 7
    }
    
    if (trackCount && ![trackCount isKindOfClass:[NSNull class]]) {
        values[2] = CFSwapInt16HostToBig([trackCount unsignedIntValue]);    // 8
    }
    size_t length = sizeof(values);
    metadataItem.value = [NSData dataWithBytes:values length:length];       // 9
    
    return metadataItem;
}
@end
```

1. åˆšæ‰æ‰€è¯´ `mp3`æ ¼å¼å·² `xx/xx` æ ¼å¼çš„å­—ç¬¦ä¸²æ ‡è¯†ä¸€ä¸ªæ­Œæ›² åœ¨æ•´ä¸ªå”±ç‰‡ä¸­çš„ç¬¬å‡ é¦– æ‰€ä»¥æˆ‘ä»¬ç”¨`/`åˆ†å‰²
2. iTunes `M4A`æ–‡ä»¶çš„å”±ç‰‡ä¿¡æ¯ä¿å­˜åœ¨ä¸€ä¸ª `NSData` ä¸­,`NSData`åŒ…å«3ä¸ª16ä½çš„`big encoding`æ•°å­—,å¦‚æœç›´æ¥åœ¨æ§åˆ¶å°æ‰“å° NSData ä¼šè¾“å‡º**`<00000008 000a0000>`è¿™æ˜¯4ä¸ª16ä½çš„`big endian`æ•°å­—æ•°ç»„çš„åå…­è¿›åˆ¶è¡¨ç°å½¢å¼**. æ•°ç»„ä¸­ç¬¬2ä¸ªå’Œç¬¬3ä¸ªå…ƒç´ åˆ†åˆ«ä¿å­˜å”±ç‰‡ç¼–å·å’Œå”±ç‰‡è®¡æ•°å€¼
3. å¦‚æœå”±ç‰‡ç¼–å· != 0, åˆ™è·å–è¯¥å€¼å¹¶ä½¿ç”¨[`CFSwapInt16BigToHost()`](https://developer.apple.com/documentation/corefoundation/1425282-cfswapint16bigtohost?language=objc)å‡½æ•°æ‰§è¡Œ`endian`è½¬æ¢,è½¬æ¢æˆä¸€ä¸ª`little endian` å¹¶æ‰“åŒ…æˆ`NSNumber`
4. åŒæ ·å¦‚æœéŸ³è½¨è®¡æ•°å€¼ä¸ä¸º0, åˆ™è·å–è¯¥å€¼å¹¶åœ¨å­—èŠ‚ä¸Šæ‰§è¡Œ`endian`è½¬æ¢å¹¶æ‰“åŒ…æˆ`NSNumber`
5. 
6. æ­¥éª¤åè¿‡æ¥æ¢æˆ3ä¸ª`uint16_t` ä¿å­˜éŸ³è½¨ç¼–å·å’Œè®¡æ•°å€¼.
7. å¦‚æœéŸ³è½¨ç¼–å·æœ‰æ•ˆ, å°†å­—èŠ‚è½¬æ¢ä¸º`big endian`æ ¼å¼å¹¶ä¿å­˜åˆ°æ•°ç»„ç¬¬2ä¸ªä½ç½®
8. å¦‚æœéŸ³è½¨è®¡æ•°å€¼æœ‰æ•ˆ, å°†å­—èŠ‚è½¬æ¢ä¸º`big endian`æ ¼å¼å¹¶ä¿å­˜åˆ°æ•°ç»„ç¬¬3ä¸ªä½ç½®
9. æ‰“æˆ NSData ä¿å­˜å°†å…¶è®¾ç½®ä¸ºå…ƒæ•°æ®é¡¹çš„ value

### DiscMetadataConverter å”±ç‰‡æ•°æ®è½¬æ¢

å”±ç‰‡è®¡æ•°ä¿¡æ¯ç”¨äºè¡¨ç¤ºä¸€é¦–æ­Œæ›²æ‰€åœ¨çš„CDæ˜¯æ‰€æœ‰å”±ç‰‡ä¸­çš„ç¬¬å‡ å¼  é€šå¸¸éƒ½æ˜¯ 1/1 (é€šå¸¸éƒ½æ˜¯ä¸€ä¸ª cd ä¸€é¦–)

ä¸Šä¸‹çš„å’ŒéŸ³è½¨ éå¸¸ç±»ä¼¼äº† å¦‚æœæ˜¯4/10å°±æ˜¯ 10é¦–é‡Œé¢çš„ç¬¬4é¦– 
ç”±äºå”±ç‰‡è¿™ç©æ„éƒ½è¿‡æ—¶äº† ä½ ç°åœ¨åº”è¯¥å¾ˆå°‘çœ‹åˆ° å±Œä¸ å¸¦ç€ walkman åœ¨å¤§è¡—ä¸Šå‹é©¬è·¯äº†éƒ½çœ‹ä¸åˆ°äº† 

ä½†æ˜¯é€»è¾‘è¿˜æ˜¯åœ¨çš„ è¿™é‡Œé€»è¾‘çœ‹ä»£ç å§ å’Œ éŸ³è½¨ åŸºæœ¬ä¸€æ¨¡ä¸€æ ·

### GenreMetadataConverter é£æ ¼è½¬æ¢

æ•°å­—éŸ³é¢‘ä½¿ç”¨çš„æ ‡å‡†é£æ ¼æœ€åˆæ¥è‡ª MP3. ID3 è§„èŒƒå®šä¹‰äº†80ä¸ªé»˜è®¤çš„é£æ ¼ç±»å‹åŠ å¦å¤–46ä¸ª WinAmp æ‰©å±•,å…±è®¡ 126ä¸ªé£æ ¼. ä¸è¿‡è¿™äº›éƒ½ä¸å±äºæ­£å¼æ ¼å¼. ç”±äº mp3é£æ ¼çš„ä¸»å¯¼åœ°ä½æ¯”è¾ƒæ˜æ˜¾, iTunes æ²¡æœ‰å¦é€ è½®å­,è€Œæ˜¯åŸºæœ¬éµå¾ª ID3 çš„é£æ ¼åˆ†ç±»,ä¸è¿‡åšäº†ç‚¹å°å˜åŒ–ã€‚**iTunes éŸ³ä¹é£æ ¼çš„æ ‡å·æ¯”å“åº”çš„ ID3æ ‡è¯†ç¬¦å¤§ `1` .**

![](/assets/images/20170807LearningAVFoundationAVAssetSenior/gener.webp)


è™½ç„¶ iTunes ä½¿ç”¨äº† ID3é›†åˆä¸­çš„é¢„å®šä¹‰éŸ³ä¹é£æ ¼, ä¸è¿‡ iTunes å¯¹ç”µè§†ã€ç”µå½±å’Œæœ‰å£°è¯»ç‰©ç­‰å®šä¹‰äº†è‡ªå·±çš„é£æ ¼é›†. [Apple's Genre IDs Appendix](https://affiliate.itunes.apple.com/resources/documentation/genre-mapping/)

ç¤ºä¾‹ä»£ç å·²ç»åŒ…å«äº†è¿™äº›ç±»å‹ è™½ä¸åœ¨èµ˜è¿° è¯·å‚è€ƒ demo

### ä¿å­˜å…ƒæ•°æ®

`AVAsset`æ˜¯ä¸€ä¸ªä¸å¯å˜ç±»å‹ æˆ‘ä»¬ä¸èƒ½ç›´æ¥ä¿®æ”¹ `AVAsset` è€Œæ˜¯ä½¿ç”¨`AVAssetExportSession`ç±»æ¥å¯¼å‡ºæ–°çš„èµ„æºå‰¯æœ¬ä»¥åŠå…ƒæ•°æ®çš„æ”¹åŠ¨.

#### ä½¿ç”¨`AVAssetExportSession`

``` objc
- (void)saveWithCompletionHandler:(CompletionHandler)handler {
    
    NSString *presetName = AVAssetExportPresetPassthrough;                  // 1
    AVAssetExportSession *session =
    [[AVAssetExportSession alloc] initWithAsset:self.asset
                                     presetName:presetName];
    
    NSURL *outputURL = [self tempURL];                                      // 2
    session.outputURL = outputURL;
    session.outputFileType = self.filetype;
    session.metadata = [self.metadata metadataItems];                       // 3
    
    [session exportAsynchronouslyWithCompletionHandler:^{
        AVAssetExportSessionStatus status = session.status;
        BOOL success = (status == AVAssetExportSessionStatusCompleted);
        if (success) {                                                      // 4
            NSURL *sourceURL = self.url;
            NSFileManager *manager = [NSFileManager defaultManager];
            [manager removeItemAtURL:sourceURL error:nil];
            [manager moveItemAtURL:outputURL toURL:sourceURL error:nil];
            [self reset];                                                   // 5
        }
        
        if (handler) {
            dispatch_async(dispatch_get_main_queue(), ^{
                handler(success);
            });
        }
        NSLog(@"sessionError:%@",session.error);
    }];
}


- (NSURL *)tempURL {
    // è·å–Cachesç›®å½•è·¯å¾„
    NSString *cachesDir = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) firstObject];
    NSString *tempDir = cachesDir;
    NSString *ext = [[self.url lastPathComponent] pathExtension];
    NSString *tempName = [NSString stringWithFormat:@"temp.%@", ext];
    NSString *tempPath = [tempDir stringByAppendingPathComponent:tempName];
    return [NSURL fileURLWithPath:tempPath];
}
```

> æ³¨æ„: __**`AVAssetExportPresetPassthrough` è¿™ä¸ªé¢„è®¾å€¼ ç¡®å®å…è®¸ä¿®æ”¹`MPEG-4`å’Œ`QuickTime`å®¹å™¨ä¸­çš„å­˜åœ¨çš„å…ƒæ•°æ®ä¿¡æ¯, ä¸è¿‡å®ƒä¸å¯ä»¥æ·»åŠ æ–°çš„å…ƒæ•°æ®,æ·»åŠ å…ƒæ•°æ®çš„å”¯ä¸€æ–¹æ³•æ˜¯ä½¿ç”¨è½¬ç é¢„è®¾å€¼, æ­¤å¤–ä¸èƒ½ä¿®æ”¹ `ID3`(mp3)æ ‡ç­¾ã€‚ æ¡†æ¶ä¸æ”¯æŒå†™å…¥ MP3æ•°æ®.**__

## æ€»ç»“

ç»è¿‡äº†ä»£ç å®ç°å’Œè§£æå¤šåª’ä½“å…ƒæ•°æ® `AVAsset`,æˆ‘ä»¬ä¹Ÿç†Ÿæ‚‰äº†å¤šåª’ä½“æ–‡ä»¶çš„æ„é€ , ID3(MP3)æ ¼å¼çš„æ–‡ä»¶è§£æ arkwork åŠŸèƒ½. ä»è€Œåœ¨åç»­å¼€å‘è¿‡ç¨‹ä¸­ æå‡å¼€å‘æ•ˆç‡. æœ€åæ”¾å‡º ä»£ç çš„ demo è¯·å¤§å®¶å¤šå¤šæŒ‡æ•™

**[ç¤ºä¾‹ demo](https://github.com/sunyazhou13/MetaDemo)**




URL: https://sunyazhou.com/2017/07/ios11NewSkills/index.html.md
Published At: 2017-07-13 10:55:15 +0000

# iOS 11 æ–°æŠ€èƒ½

![](/assets/images/20170713ios11NewSkills/whatisnewsinios11.webp)


## å¯ç”¨æ€§æ£€æŸ¥API

åœ¨swiftä»£ç ä¸­ç»å¸¸å¯ä»¥çœ‹åˆ° æŸä¸ªAPI é€‚ç”¨äº iOS10.0 

å¦‚ä¸‹ä»£ç 

``` swift
	if (@available(iOS 11, *)) {
		//iOS 11å¯ç”¨ 
	} else {
		//è€ç‰ˆæœ¬API
	}

```
åœ¨Xcode9 ä¸­, ç¼–è¯‘å™¨å¢åŠ äº† Objective-C ç‰ˆæœ¬çš„ API å¯ç”¨æ€§æ£€æŸ¥

##### é€šè¿‡`API_AVAILABLE`å®æ¥æ ‡æ³¨æ–¹æ³•çš„å¯ç”¨æ€§


``` objc
@interface ViewController : UIViewController
- (void)xxxMethodA API_AVAILABLE(ios(11.0));
- (void)xxxMethodB API_AVAILABLE(ios(8.0), macos(10.10), watchos(2.0), tvos(9.0));
@end

```

> åˆ‡è®° `macos`ã€`ios`ã€`watchos`ã€`tvos`éƒ½æ˜¯å°å†™

é€šè¿‡è¿™ç§å†™æ³•è¿›è¡Œå¯ç”¨æ€§åˆ¤æ–­, ç¼–è¾‘å™¨å°±ä¸ä¼šäº§ç”Ÿè­¦å‘Šäº†, å¹¶ä¸”åœ¨`è¿è¡Œæ—¶`å°±æ ¹æ®iOSç³»ç»Ÿç‰ˆæœ¬æ‰§è¡Œç›¸åº”ä»£ç .

##### é€šè¿‡`API_AVAILABLE`å®æ¥æ ‡æ³¨æ•´ä¸ª`class`çš„å¯ç”¨æ€§

``` objc
API_AVAILABLE(ios(11.0))
@interface A : NSObject
- (void)xxxMothod;
@end
```

çœ‹äº†å¤§å®¶ä¼šå‘ç° è¿™ä¸ª éƒ½æ˜¯ç”¨äºOCçš„ä»£ç  é‚£C/C++ æœ‰å—? å¿…é¡»æœ‰

##### C/C++ ä»£ç  å¯ä»¥ä½¿ç”¨ ``

åˆ¤æ–­æ˜¯å¦å¯ç”¨

``` c++

if (__builtin_available(iOS 11, macOS 10.13, *)) {
     xxxxFunc();
}
```

``` c++
//å¯¼å…¥å¤´æ–‡ä»¶
#include <os/availability.h> 

//å¯ç”¨æ€§åˆ¤æ–­ç”¨äº å£°æ˜å‡½æ•° 
void myFunctionForiOS11OrNewer(int i) API_AVAILABLE(ios(11.0), macos(10.13));  

//å¯ç”¨æ€§åˆ¤æ–­ ç”¨äºç±» XXXClassA
class API_AVAILABLE(ios(11.0), macos(10.13)) XXXClassA;  
```

é»˜è®¤ `API_AVAILABLE()` åªèƒ½ç”¨äº `iOS 11` / `tvOS 11` / `macOS 10.13` / `watchOS 4` ä»¥ä¸Šçš„ API ç”Ÿæ•ˆ

å¦‚æœå°±å·¥ç¨‹æƒ³ä½¿ç”¨è¿™ç§llvmæ–°ç‰ˆç‰¹æ€§çš„è¯ éœ€è¦ä¿®æ”¹ `buid setting`é‡Œé¢çš„ `Unguarded availability`  å¦‚ä¸‹å›¾:

![](/assets/images/20170713ios11NewSkills/availability.webp)


## é™æ€åˆ†æ

å‰é¢çš„æ–‡ç« æˆ‘åˆè®²è¿‡[é™æ€åˆ†æ](http://www.sunyazhou.com/2017/06/20/enable-static-analyer/)

è¿™é‡Œè¯´ä¸€ä¸‹å˜åŒ–

### NSNumber/CFNumberRed é™æ€åˆ†æ å»¶æ—¶

å½“æˆ‘ä»¬é”™è¯¯çš„åˆ¤æ–­ NSNumberæ—¶  é™æ€åˆ†æ åˆ™ç»™å‡ºäº†æç¤º 

![](/assets/images/20170713ios11NewSkills/error.webp)
 

åœ¨Xcode9 ä¸­å¯ä»¥ç›´æ¥æŠŠè¿™ç§å€å¿½è§† çš„é—®é¢˜æ”¹æˆ å½“é”™è¯¯å¤„ç†

![](/assets/images/20170713ios11NewSkills/static.webp)


## å¼€å¯ LTO å¹¶è®¾ç½®ä¸º Incremental æ¨¡å¼ 

é“¾æ¥æ—¶ä¼˜åŒ–ï¼ˆä»¥ä¸‹ç®€ç§° `LTO`ï¼‰æ˜¯ LLVM çš„ä¸€é¡¹ä¼˜åŒ–ç‰¹æ€§ï¼Œå…¶ä¸»è¦åŸç†æ˜¯:

*åˆ©ç”¨å¯¹è±¡æ–‡ä»¶ç»è¿‡ä¸€äº›ä¼˜åŒ–å¾—åˆ°çš„ä¸­é—´æ ¼å¼åœ¨é“¾æ¥é˜¶æ®µå†è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼ŒåŒ…å«ä»£ç é€»è¾‘å±‚é¢çš„åˆ†æï¼Œå»é™¤å®é™…æœªç”¨åˆ°çš„å‡½æ•°ã€å˜é‡ã€ç”šè‡³å±€éƒ¨ä»£ç ç‰‡æ®µï¼Œç»§è€Œå‡å°å®‰è£…åŒ…å¤§å°ï¼ŒåŒæ—¶æé«˜äº†è¿è¡Œæ—¶çš„æ•ˆç‡ã€‚*

å¯¹äº LTOï¼ŒXcode 9 åšå‡ºçš„æ”¹è¿›ä¸»è¦æ˜¯åœ¨è¿›ä¸€æ­¥ä¼˜åŒ–äº†ç¼–è¯‘é€Ÿåº¦ã€‚ è‹¹æœæ¼”ç¤ºçš„ä¾‹å­æ˜¯ä»¥æŸä¸ªå¤§å‹ C++ å·¥ç¨‹ä¸ºå‚è€ƒï¼Œå¯¹äºä¸€æ¬¡å®Œæ•´é“¾æ¥ï¼ŒXcode 9 æ¯” Xcode 8 æå‡äº† 35%ï¼›å¯¹äºä¸€æ¬¡å¢é‡é“¾æ¥ï¼ŒXcode 9 æ¯” Xcode 8 æå‡äº†è¿‘ 60%ã€‚

![](/assets/images/20170713ios11NewSkills/lto1.webp)

![](/assets/images/20170713ios11NewSkills/lto2.webp)

å¼€å¯LTO

![](/assets/images/20170713ios11NewSkills/LTO.webp)

æ®è¯´å¯¹åŒ…å¤§å°å’Œè¿è¡Œæ—¶é€Ÿåº¦æœ‰ 10% å·¦å³çš„ä¼˜åŒ–


## GCD ç»Ÿä¸€é˜Ÿåˆ—æ ‡è¯†


ç»Ÿä¸€é˜Ÿåˆ—æ ‡è¯†æ˜¯æŒ‡æˆ‘ä»¬åœ¨å·¥ç¨‹ä¸­æ•£è½åœ¨å„å¤„çš„åˆ›å»ºé˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—æ ‡è¯†æ˜¯ä¸€æ ·çš„ï¼Œä»–ä»¬åœ¨å†…æ ¸ä¸­ä¼šè¢« bind åœ¨ä¸€èµ·ï¼Œå…¶æ•ˆç‡å¯ä»¥æé«˜ 30%ã€‚Apple æ²¡æœ‰å‘Šè¯‰æˆ‘ä»¬å…¶å†…æ ¸æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œå®ƒæä¾›äº†è¿™æ ·çš„å»ºè®®ï¼Œå¦‚æœä¸€ç±»æ“ä½œé‡è¦æ€§ç¨‹åº¦æˆ–å…¶ä»–å±æ€§æ¥è¿‘ï¼Œäº¦æˆ–å¼€å‘è€…å¸Œæœ›æ•£è½åœ¨å·¥ç¨‹å„å¤„çš„ä»£ç å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—é‡Œå»æ§åˆ¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨åˆ›å»ºé˜Ÿåˆ—çš„æ—¶å€™å°±å¯ä»¥æŒ‡å®šä¸€ä¸ªå…±åŒçš„æ ‡è¯†ç¬¦ã€‚ ç„¶åç³»ç»Ÿåœ¨å†…æ ¸ä¸­ä¼šæŠŠè¿™äº›æ ‡è¯†ç›¸åŒçš„é˜Ÿåˆ— bind åˆ°ä¸€èµ·æ¥ç®¡ç†

å¦‚ä¸‹ä»£ç  å¦‚æœappé‡Œé¢éƒ½ä½¿ç”¨åŒä¸€ä¸ªå­—ç¬¦ä¸² çš„è¯ æ•ˆç‡å¯ä»¥æé«˜30%

``` objc
	dispatch_queue_t queue = dispatch_queue_create("com.sunyazhou.demo.queue", DISPATCH_QUEUE_CONCURRENT);
    dispatch_async(queue, ^{
       //å¼‚æ­¥æ‰§è¡Œä»£ç å†™åœ¨è¿™é‡Œ
    });
```

> è€å®è¯´ å·¥ç¨‹é‡Œé¢ é¿å…ä¸äº†æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ æˆ–è€…è€—æ—¶ä»»åŠ¡å¤„ç†  å¦‚æœ æ•´ä½“ææˆä¸€ä¸ªqueueæ˜¾ç„¶ ä¸å¤ªç¬¦åˆä¸šåŠ¡éœ€æ±‚ å¦‚æœå°½é‡ä¿æŒ ä¸€ä¸ªæ ‡è¯†çš„Queueçš„è¯ ä¹Ÿåªèƒ½æ ¹æ® ä¸šåŠ¡åˆ†ç±»æ¥åšåˆ°  å¯ä»¥æœ‰æœºä¼šå°è¯•ä¸€ä¸‹


å…¨æ–‡å®Œ

[å‚è€ƒ](https://techblog.toutiao.com/2017/07/05/session0-2/)



URL: https://sunyazhou.com/2017/07/Arc4RandomColor/index.html.md
Published At: 2017-07-04 17:45:28 +0000

# iOSç”ŸæˆéšæœºUIColoré¢œè‰²ä»£ç 

``` objc
- (UIColor *)randomColor
{
    CGFloat hue = ( arc4random() % 256 / 256.0 );  //  0.0 to 1.0
    CGFloat saturation = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from white
    CGFloat brightness = ( arc4random() % 128 / 256.0 ) + 0.5;  //  0.5 to 1.0, away from black
    UIColor *color = [UIColor colorWithHue:hue saturation:saturation brightness:brightness alpha:1];
    return color;
}
```

æˆ‘ä»¬é€šå¸¸æ¥è§¦åˆ°çš„é¢œè‰²ç©ºé—´æ˜¯RGBï¼Œå…¶å®å¸¸ç”¨çš„è¿˜æœ‰HSVåˆå«HSBã€‚
HSVå³Hue, Saturation, Value.
ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ
å…ˆçœ‹ä¸€å¼ å›¾

![](/assets/images/20170704Arc4RandomColor/hsv.webp)

HSVè¿™ä¸ªcolor spaceå¯ä»¥ç”¨ä¸Šå›¾çš„åœ†æŸ±ä½“æ¥è¡¨ç¤ºã€‚
Hueä»£è¡¨ä»0Â°åˆ°360Â°çš„ä¸åŒé¢œè‰².
SaturationæŒ‡çš„æ˜¯è‰²å½©çš„é¥±å’Œåº¦ï¼Œå®ƒç”¨0%è‡³100%çš„å€¼æè¿°äº†ç›¸åŒè‰²ç›¸ã€æ˜åº¦ä¸‹è‰²å½©çº¯åº¦çš„å˜åŒ–ã€‚æ•°å€¼è¶Šå¤§ï¼Œé¢œè‰²ä¸­çš„ç°è‰²è¶Šå°‘ï¼Œé¢œè‰²è¶Šé²œè‰³ï¼Œå‘ˆç°ä¸€ç§ä»ç†æ€§(ç°åº¦)åˆ°æ„Ÿæ€§(çº¯è‰²)çš„å˜åŒ–
ValueæŒ‡çš„æ˜¯è‰²å½©çš„æ˜åº¦ï¼Œä½œç”¨æ˜¯æ§åˆ¶è‰²å½©çš„æ˜æš—å˜åŒ–ã€‚å®ƒåŒæ ·ä½¿ç”¨äº†0%è‡³100%çš„å–å€¼èŒƒå›´ã€‚æ•°å€¼è¶Šå°ï¼Œè‰²å½©è¶Šæš—ï¼Œè¶Šæ¥è¿‘äºé»‘è‰²ï¼›æ•°å€¼è¶Šå¤§ï¼Œè‰²å½©è¶Šäº®ï¼Œè¶Šæ¥è¿‘äºç™½è‰²ã€‚

[è‰²å½©å¼•ç”¨](https://zhuanlan.zhihu.com/p/31202175)


URL: https://sunyazhou.com/2017/06/GetSandboxPathios/index.html.md
Published At: 2017-06-26 16:44:22 +0000

# iOSè·å–å„ç§æ–‡ä»¶ç›®å½•çš„è·¯å¾„

``` objc
// è·å–æ²™ç›’ä¸»ç›®å½•è·¯å¾„
NSString *homeDir = NSHomeDirectory();
// è·å–Documentsç›®å½•è·¯å¾„
NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
// è·å–Libraryçš„ç›®å½•è·¯å¾„
NSString *libDir = [NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES) lastObject];
// è·å–Cachesç›®å½•è·¯å¾„
NSString *cachesDir = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) firstObject];
// è·å–tmpç›®å½•è·¯å¾„
NSString *tmpDir =  NSTemporaryDirectory();
```




URL: https://sunyazhou.com/2017/06/RsaUniversalCrossPlatformiOSAndroidPhp/index.html.md
Published At: 2017-06-26 10:42:47 +0000

# iOS Android Php RSAåŠ å¯†è§£å¯†é€šé…æ–¹æ¡ˆ

![](/assets/images/20170626RsaUniversalCrossPlatformiOSAndroidPhp/RSALogo.webp)

# å‰è¨€

å…ˆè†œæ‹œä¸€ä¸‹ RSAçš„ä½œè€…

![](/assets/images/20170626RsaUniversalCrossPlatformiOSAndroidPhp/RSATeam.webp)

RSAéå¯¹ç§°åŠ å¯† åŸç† å„ç§ã€‚ã€‚ã€‚ è¯·è‡ªè¡Œç™¾åº¦ 


## å¼¯è·¯

æœ€è¿‘å¼€å‘æ¶‰åŠåˆ°å¦‚ä½•ä½¿ç”¨RSAè¿›è¡Œé‰´æƒ ç­‰æŠ€æœ¯ã€‚ã€‚ã€‚è€å®è¯´ æˆ‘æ‰¾äº†ä¸€åœˆæ ¹æœ¬å°±æ‰¾åˆ°ä¸€ä¸ªçœŸæ­£èƒ½åœ¨ iOSã€Androidã€webè·‘é€šçš„ä»£ç .
 æµªè´¹äº†å¥½å‡ å¤©å¼€å‘æ—¶é—´ å°±æ²¡æœ‰ä¸€ä¸ªé è°±èƒ½å¥½ä½¿çš„ æ‰€ä»¥æˆ‘å¿…é¡»å‘ä¸€ç¯‡åšå®¢
æŠŠçœŸæ­£ å¥½ä½¿çš„ä»£ç æ‹¿å‡ºæ¥ shareä¸€ä¸‹ (å½“æ—¶æˆ‘çœŸçš„ æƒ³éª‚å¨˜äº† æˆ‘æ“¦ ç™¾åº¦æœå‡ºæ¥çš„ ä¸€å †åƒåœ¾) 


# ä»£ç å®ç°

## ç¬¬ä¸€æ­¥ ç”Ÿæˆå…¬ç§é’¥å¯¹


### å‘½ä»¤ç”ŸæˆåŸå§‹ RSAç§é’¥æ–‡ä»¶ rsa_private_key.pem

``` sh
openssl genrsa -out rsa_private_key.pem 1024
```

### å‘½ä»¤å°†åŸå§‹ RSAç§é’¥è½¬æ¢ä¸º pkcs8æ ¼å¼

``` sh
openssl pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt -out private_key.pem
```

### ç”ŸæˆRSAå…¬é’¥ rsa_public_key.pem

``` sh
openssl rsa -in rsa_private_key.pem -pubout -out rsa_public_key.pem
```

> ä»ä¸Šé¢çœ‹å‡ºé€šè¿‡ç§é’¥èƒ½ç”Ÿæˆå¯¹åº”çš„å…¬é’¥ï¼Œå› æ­¤æˆ‘ä»¬å°†ç§é’¥`private_key.pem`ç”¨åœ¨*æœåŠ¡å™¨ç«¯*ï¼Œ*å…¬é’¥*å‘æ”¾ç»™`android`è·Ÿ`ios`ç­‰å‰ç«¯
> 


## ç¬¬äºŒæ­¥ phpä»£ç å®ç°

``` php
<?php
/**
 * @author sunyazhou (http://www.sunyazhou.com/)
 * @version 1.0
 * @created 2017-6-25
 */
 
class Rsa
{
private static $PRIVATE_KEY = '-----BEGIN PRIVATE KEY-----
xxxxxxxxxxxxxxxxxxxxx
/xxxxxxxxxxxxxxxxxxxxx
y4dDpCOn
A4tBsIdpMMoT+w==
-----END PRIVATE KEY-----';
    /**
    *è¿”å›å¯¹åº”çš„ç§é’¥
    */
    private static function getPrivateKey(){
    
        $privKey = self::$PRIVATE_KEY;
         
        return openssl_pkey_get_private($privKey);      
    }
 
    /**
     * ç§é’¥åŠ å¯†
     */
    public static function privEncrypt($data)
    {
        if(!is_string($data)){
                return null;
        }           
        return openssl_private_encrypt($data,$encrypted,self::getPrivateKey())? base64_encode($encrypted) : null;
    }
    
    
    /**
     * ç§é’¥è§£å¯†
     */
    public static function privDecrypt($encrypted)
    {
        if(!is_string($encrypted)){
                return null;
        }
        return (openssl_private_decrypt(base64_decode($encrypted), $decrypted, self::getPrivateKey()))? $decrypted : null;
    }
}
 
?>

```

æ‰“å¼€`private_key.pem`ï¼Œå°†ä¸Šé¢çš„$PRIVATE_KEYï¼Œæ›¿æ¢æˆprivate_key.pemçš„å†…å®¹å³å¯ï¼ŒæœåŠ¡å™¨ç«¯æˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ç§é’¥æ¥åŠ å¯†è§£å¯†ã€‚

## ç¬¬ä¸‰æ­¥ androidç«¯ ä»£ç å®ç°

ä½¿ç”¨javaçš„Cipherç±»æ¥å®ç°åŠ å¯†è§£å¯†ç±»ï¼Œä»£ç å¦‚ä¸‹:

``` java
import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.security.KeyFactory;
import java.security.NoSuchAlgorithmException;
import java.security.PublicKey;
import java.security.spec.X509EncodedKeySpec;
import javax.crypto.Cipher;
 
import android.util.Base64;
 
/**
 * @author alun (http://alunblog.duapp.com)
 * @version 1.0
 * @created 2013-5-17
 */
public class Rsa {
    private static final String RSA_PUBLICE =
            "xxxxxxxxxxxxxxxxC" + "\r" +
            "Qf/xxxxxxxhVuwdNH6aRFE0ms3bkpp/WL4cfVDgnCO" + "\r" +
            "+W9J6vRVpuTuD/xxxxxxxxbJeO74fYnYqo/mmyJSeLE5iZg4I" + "\r" +
            "Zm5LPWBZWUp3ULCAZQIDAQAB";
    private static final String ALGORITHM = "RSA";
 
    /**
     * å¾—åˆ°å…¬é’¥
     * @param algorithm
     * @param bysKey
     * @return
     */
    private static PublicKey getPublicKeyFromX509(String algorithm,
            String bysKey) throws NoSuchAlgorithmException, Exception {
        byte[] decodedKey = Base64.decode(bysKey,Base64.DEFAULT);
        X509EncodedKeySpec x509 = new X509EncodedKeySpec(decodedKey);
 
        KeyFactory keyFactory = KeyFactory.getInstance(algorithm);
        return keyFactory.generatePublic(x509);
    }
 
    /**
     * ä½¿ç”¨å…¬é’¥åŠ å¯†
     * @param content
     * @param key
     * @return
     */
    public static String encryptByPublic(String content) {
        try {
            PublicKey pubkey = getPublicKeyFromX509(ALGORITHM, RSA_PUBLICE);
 
            Cipher cipher = Cipher.getInstance("RSA/ECB/PKCS1Padding");
            cipher.init(Cipher.ENCRYPT_MODE, pubkey);
 
            byte plaintext[] = content.getBytes("UTF-8");
            byte[] output = cipher.doFinal(plaintext);
 
            String s = new String(Base64.encode(output,Base64.DEFAULT));
 
            return s;
 
        } catch (Exception e) {
            return null;
        }
    }
 
    /**
    * ä½¿ç”¨å…¬é’¥è§£å¯†
    * @param content å¯†æ–‡
    * @param key å•†æˆ·ç§é’¥
    * @return è§£å¯†åçš„å­—ç¬¦ä¸²
    */
    public static String decryptByPublic(String content) {
        try {
            PublicKey pubkey = getPublicKeyFromX509(ALGORITHM, RSA_PUBLICE);
            Cipher cipher = Cipher.getInstance("RSA/ECB/PKCS1Padding");
            cipher.init(Cipher.DECRYPT_MODE, pubkey);
            InputStream ins = new ByteArrayInputStream(Base64.decode(content,Base64.DEFAULT));
            ByteArrayOutputStream writer = new ByteArrayOutputStream();
            byte[] buf = new byte[128];
            int bufl;
            while ((bufl = ins.read(buf)) != -1) {
                byte[] block = null;
                if (buf.length == bufl) {
                block = buf;
                } else {
                block = new byte[bufl];
                for (int i = 0; i < bufl; i++) {
                    block[i] = buf[i];
                }
                }
                writer.write(cipher.doFinal(block));
            }
            return new String(writer.toByteArray(), "utf-8");
        } catch (Exception e) {
            return null;
        }
    }
 
}

```

__*æ³¨æ„:*__åœ¨åˆå§‹åŒ–`Cipher`å¯¹è±¡æ—¶ï¼Œä¸€å®šè¦æŒ‡æ˜ä½¿ç”¨`"RSA/ECB/PKCS1Padding"`æ ¼å¼å¦‚`Cipher.getInstance("RSA/ECB/PKCS1Padding");`
æ‰“å¼€`rsa_public_key.pem`æ–‡ä»¶ï¼Œå°†ä¸Šé¢ä»£ç çš„`RSA_PUBLICE`æ›¿æ¢æˆå…¶ä¸­å†…å®¹å³å¯.


## ç¬¬å››æ­¥ iOSç«¯ä»£ç å®ç°

iOSä¸Šæ²¡æœ‰ç›´æ¥å¤„ç†RSAåŠ å¯†çš„APIï¼Œç½‘ä¸Šè¯´çš„å¤§å¤šæ•°ä¹Ÿæ˜¯å¤„ç†X.509çš„è¯ä¹¦çš„æ–¹æ³•æ¥å®ç°ï¼Œä¸è¿‡X.509è¯ä¹¦æ˜¯å¸¦ç­¾åçš„ï¼Œåœ¨phpç«¯`openssl_pkey_get_private`æ–¹æ³•è·å–å¯†é’¥æ—¶ï¼Œç¬¬äºŒä¸ªå‚æ•°éœ€è¦ä¼ ç­¾åï¼Œè€Œandroidç«¯å®ç°X.509è¯ä¹¦åŠ å¯†è§£å¯†è¾ƒä¸ºä¸æ˜“ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ioså…¼å®¹cç¨‹åºçš„ç‰¹ç‚¹ï¼Œåˆ©ç”¨opensslçš„apiå®ç°rsaçš„åŠ å¯†è§£å¯†ï¼Œä»£ç å¦‚ä¸‹ï¼š

CRSA.hä»£ç 

``` objc
//
//  CRSA.h
//  RSA_C_demo
//
//  Created by sunyazhou on 2017/6/25.
//  Copyright Â© 2017å¹´ Kingsoft, Inc. All rights reserved.
//

#import <Foundation/Foundation.h>

#import <openssl/rsa.h>
#import <openssl/pem.h>
#import <openssl/err.h>


typedef enum {
    KeyTypePublic,
    KeyTypePrivate
}KeyType;

typedef enum {
    RSA_PADDING_TYPE_NONE       = RSA_NO_PADDING,
    RSA_PADDING_TYPE_PKCS1      = RSA_PKCS1_PADDING,
    RSA_PADDING_TYPE_SSLV23     = RSA_SSLV23_PADDING
}RSA_PADDING_TYPE;

@interface CRSA : NSObject{
    RSA *_rsa;
}

@property(nonatomic, copy)NSString *rsaKeyPath; //è¯ä¹¦è·¯å¾„

+ (id)shareInstance;
- (BOOL)importRSAKeyFromeStringWithType:(KeyType)type andKey:(NSString *)keyPath;
- (BOOL)importRSAKeyWithType:(KeyType)type;
- (int)getBlockSizeWithRSA_PADDING_TYPE:(RSA_PADDING_TYPE)padding_type;
- (NSString *)encryptByRsa:(NSString*)content withKeyType:(KeyType)keyType;
- (NSString *)decryptByRsa:(NSString*)content withKeyType:(KeyType)keyType;

@end


```

CRSA.m

``` obj

//  CRSA.m
//  RSA_C_demo
//
//  Created by sunyazhou on 2017/6/25.
//  Copyright Â© 2017å¹´ Kingsoft, Inc. All rights reserved.
//

#import "CRSA.h"

#define BUFFSIZE  1024
//#import "NSString+Base64.h"
//#import "NSData+Base64.h"

#define PADDING RSA_PADDING_TYPE_PKCS1
@implementation CRSA

+ (id)shareInstance
{
    static KSYCRSA *_crsa = nil;
    static dispatch_once_t onceToken;
    dispatch_once(&onceToken, ^{
        _crsa = [[self alloc] init];
    });
    return _crsa;
}
- (BOOL)importRSAKeyWithType:(KeyType)type
{
    FILE *file;
    NSString *keyName = type == KeyTypePublic ? @"public_key" : @"private_key";
    NSString *keyPath = [[NSBundle mainBundle] pathForResource:keyName ofType:@"pem"];
    
    file = fopen([keyPath UTF8String], "rb");
    
    if (NULL != file)
    {
        if (type == KeyTypePublic)
        {
            _rsa = PEM_read_RSA_PUBKEY(file, NULL, NULL, NULL);
            assert(_rsa != NULL);
        }
        else
        {
            _rsa = PEM_read_RSAPrivateKey(file, NULL, NULL, NULL);
            assert(_rsa != NULL);
        }
        
        fclose(file);
        
        return (_rsa != NULL) ? YES : NO;
    }
    
    return NO;
}

- (BOOL)importRSAKeyWithPath:(KeyType)type
{
    FILE *file;
    NSString *keyName = type == KeyTypePublic ? @"public_key.pem" : @"private_key.pem";
    NSString *keyPath = [self.rsaKeyPath stringByAppendingPathComponent:keyName];
    file = fopen([keyPath UTF8String], "rb");
    
    if (NULL != file)
    {
        if (type == KeyTypePublic)
        {
            _rsa = PEM_read_RSA_PUBKEY(file, NULL, NULL, NULL);
            assert(_rsa != NULL);
        }
        else
        {
            _rsa = PEM_read_RSAPrivateKey(file, NULL, NULL, NULL);
            assert(_rsa != NULL);
        }
        
        fclose(file);
        
        return (_rsa != NULL) ? YES : NO;
    }
    
    return NO;
}


- (BOOL)importRSAKeyFromeStringWithType:(KeyType)type andKey:(NSString *)key{
    if (key.length == 0) { return NO; }
    
    
    BIO *keybio ;
    keybio = BIO_new_mem_buf((__bridge void *)(key), -1);
    if (keybio==NULL)
    {
        printf( "Failed to create key BIO");
        return 0;
    }
    if(type == KeyTypePublic)
    {
        _rsa = PEM_read_bio_RSA_PUBKEY(keybio, &_rsa,NULL, NULL);
    }
    else
    {
        _rsa = PEM_read_bio_RSAPrivateKey(keybio, &_rsa,NULL, NULL);
    }
    BIO_free(keybio);
    return (_rsa != NULL) ? YES : NO;
}

- (NSString *) encryptByRsa:(NSString*)content withKeyType:(KeyType)keyType
{
    if (![self importRSAKeyWithPath:keyType])
        return nil;
//    if (![self importRSAKeyWithType:keyType])
//        return nil;
    
    int status;
    NSUInteger length  = [content length];
    unsigned char input[length + 1];
    bzero(input, length + 1);
    int i = 0;
    for (; i < length; i++)
    {
        input[i] = [content characterAtIndex:i];
    }
    
    NSInteger  flen = [self getBlockSizeWithRSA_PADDING_TYPE:PADDING];
    
    char *encData = (char*)malloc(flen);
    bzero(encData, flen);
    
    switch (keyType) {
        case KeyTypePublic:
            status = RSA_public_encrypt(length, (unsigned char*)input, (unsigned char*)encData, _rsa, PADDING);
            break;
            
        default:
            status = RSA_private_encrypt(length, (unsigned char*)input, (unsigned char*)encData, _rsa, PADDING);
            break;
    }
    
    if (status)
    {
        NSData *returnData = [NSData dataWithBytes:encData length:status];
        free(encData);
        encData = NULL;
        
        NSString *ret = [self base64EncodedStringForData:returnData ];
        return ret;
    }
    
    free(encData);
    encData = NULL;
    
    return nil;
}

- (NSString *) decryptByRsa:(NSString*)content withKeyType:(KeyType)keyType
{
    if (![self importRSAKeyWithPath:keyType])
        return nil;
//    if (![self importRSAKeyWithType:keyType])
//        return nil;
    
    int status;
    
    NSData *data = [self base64DecodedDataForString:content];
    NSUInteger length = [data length];
    
    NSInteger flen = [self getBlockSizeWithRSA_PADDING_TYPE:PADDING];
    char *decData = (char*)malloc(flen);
    bzero(decData, flen);
    
    switch (keyType) {
        case KeyTypePublic:
            status = RSA_public_decrypt(length, (unsigned char*)[data bytes], (unsigned char*)decData, _rsa, PADDING);
            break;
            
        default:
            status = RSA_private_decrypt(length, (unsigned char*)[data bytes], (unsigned char*)decData, _rsa, PADDING);
            break;
    }
    
    if (status)
    {
        NSMutableString *decryptString = [[NSMutableString alloc] initWithBytes:decData length:strlen(decData) encoding:NSASCIIStringEncoding];
        free(decData);
        decData = NULL;
        
        return decryptString;
    }
    
    free(decData);
    decData = NULL;
    
    return nil;
}

- (int)getBlockSizeWithRSA_PADDING_TYPE:(RSA_PADDING_TYPE)padding_type
{
    int len = RSA_size(_rsa);
    
    if (padding_type == RSA_PADDING_TYPE_PKCS1 || padding_type == RSA_PADDING_TYPE_SSLV23) {
        len -= 11;
    }
    
    return len;
}


//---------------åŠ å¯†å·¥å…·æ–¹æ³•
- (NSString *)base64EncodedStringForData:(NSData *)data
{
    return [self base64EncodedStringWithWrapWidth:0 data:data];
}

- (NSString *)base64EncodedStringWithWrapWidth:(NSUInteger)wrapWidth data:(NSData *)data
{
    //ensure wrapWidth is a multiple of 4
    wrapWidth = (wrapWidth / 4) * 4;
    
    const char lookup[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    
    long long inputLength = [data length];
    const unsigned char *inputBytes = [data bytes];
    
    long long maxOutputLength = (inputLength / 3 + 1) * 4;
    maxOutputLength += wrapWidth? (maxOutputLength / wrapWidth) * 2: 0;
    unsigned char *outputBytes = (unsigned char *)malloc(maxOutputLength);
    
    long long i;
    long long outputLength = 0;
    for (i = 0; i < inputLength - 2; i += 3)
    {
        outputBytes[outputLength++] = lookup[(inputBytes[i] & 0xFC) >> 2];
        outputBytes[outputLength++] = lookup[((inputBytes[i] & 0x03) << 4) | ((inputBytes[i + 1] & 0xF0) >> 4)];
        outputBytes[outputLength++] = lookup[((inputBytes[i + 1] & 0x0F) << 2) | ((inputBytes[i + 2] & 0xC0) >> 6)];
        outputBytes[outputLength++] = lookup[inputBytes[i + 2] & 0x3F];
        
        //add line break
        if (wrapWidth && (outputLength + 2) % (wrapWidth + 2) == 0)
        {
            outputBytes[outputLength++] = '\r';
            outputBytes[outputLength++] = '\n';
        }
    }
    
    //handle left-over data
    if (i == inputLength - 2)
    {
        // = terminator
        outputBytes[outputLength++] = lookup[(inputBytes[i] & 0xFC) >> 2];
        outputBytes[outputLength++] = lookup[((inputBytes[i] & 0x03) << 4) | ((inputBytes[i + 1] & 0xF0) >> 4)];
        outputBytes[outputLength++] = lookup[(inputBytes[i + 1] & 0x0F) << 2];
        outputBytes[outputLength++] =   '=';
    }
    else if (i == inputLength - 1)
    {
        // == terminator
        outputBytes[outputLength++] = lookup[(inputBytes[i] & 0xFC) >> 2];
        outputBytes[outputLength++] = lookup[(inputBytes[i] & 0x03) << 4];
        outputBytes[outputLength++] = '=';
        outputBytes[outputLength++] = '=';
    }
    
    //truncate data to match actual output length
    outputBytes = realloc(outputBytes, outputLength);
    NSString *result = [[NSString alloc] initWithBytesNoCopy:outputBytes length:outputLength encoding:NSASCIIStringEncoding freeWhenDone:YES];
    
#if !__has_feature(objc_arc)
    [result autorelease];
#endif
    
    return (outputLength >= 4)? result: nil;
}


- (NSData *)base64DecodedDataForString:(NSString *)string
{
    return [self dataWithBase64EncodedString:string];
}


- (NSData *)dataWithBase64EncodedString:(NSString *)string
{
    const char lookup[] =
    {
        99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99,
        99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99,
        99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 99, 62, 99, 99, 99, 63,
        52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 99, 99, 99, 99, 99, 99,
        99,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,
        15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 99, 99, 99, 99, 99,
        99, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
        41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 99, 99, 99, 99, 99
    };
    
    NSData *inputData = [string dataUsingEncoding:NSASCIIStringEncoding allowLossyConversion:YES];
    long long inputLength = [inputData length];
    const unsigned char *inputBytes = [inputData bytes];
    
    long long maxOutputLength = (inputLength / 4 + 1) * 3;
    NSMutableData *outputData = [NSMutableData dataWithLength:maxOutputLength];
    unsigned char *outputBytes = (unsigned char *)[outputData mutableBytes];
    
    int accumulator = 0;
    long long outputLength = 0;
    unsigned char accumulated[] = {0, 0, 0, 0};
    for (long long i = 0; i < inputLength; i++)
    {
        unsigned char decoded = lookup[inputBytes[i] & 0x7F];
        if (decoded != 99)
        {
            accumulated[accumulator] = decoded;
            if (accumulator == 3)
            {
                outputBytes[outputLength++] = (accumulated[0] << 2) | (accumulated[1] >> 4);
                outputBytes[outputLength++] = (accumulated[1] << 4) | (accumulated[2] >> 2);
                outputBytes[outputLength++] = (accumulated[2] << 6) | accumulated[3];
            }
            accumulator = (accumulator + 1) % 4;
        }
    }
    
    //handle left-over data
    if (accumulator > 0) outputBytes[outputLength] = (accumulated[0] << 2) | (accumulated[1] >> 4);
    if (accumulator > 1) outputBytes[++outputLength] = (accumulated[1] << 4) | (accumulated[2] >> 2);
    if (accumulator > 2) outputLength++;
    
    //truncate data to match actual output length
    outputData.length = outputLength;
    return outputLength? outputData: nil;
}

```
> è¿™é‡Œé¢æˆ‘å¢åŠ äº† å¯†é’¥ç›´æ¥ä»å­—ç¬¦ä¸²è¯»å–çš„æ–¹æ³• åŸæ¥æ–¹æ³•æ˜¯ ä»`NSBundle`è¯»å–private_key.pemå’Œ public_key.pem ä½†æ˜¯è€ƒè™‘åˆ°è¢«ç¯¡æ”¹ æˆ‘å¢åŠ äº† å¯†é’¥ç›´æ¥ææˆå­—ç¬¦ä¸²(æŠŠå­—ç¬¦ä¸²å†™åˆ°æœ¬åœ°æ²™ç›’ç„¶ååŠ è½½æ–‡ä»¶çš„æ–¹å¼) è¿™æ ·ä»£ç  å®‰å…¨å°±æé«˜äº†ä¸€äº› å¦‚æœèƒ½ç ´è¯‘.mçš„è¯ æ‹¿åˆ°çš„ä¹Ÿåªèƒ½æ˜¯ publicKey(å…¬é’¥) åªè¦ä¸èƒ½ç¯¡æ”¹ å°±æ˜¯å®‰å…¨çš„ 

### å¤–éƒ¨è°ƒç”¨

``` objc
NSString *publicKey = @"-----BEGIN PUBLIC KEY-----\næ­¤å¤„æ›¿æ¢ç”Ÿæˆçš„å…¬é’¥ è®°å¾—æ¢è¡Œ æŒ‰ç…§ä¸€å®šè§„åˆ™åŠ '\n'  \n-----END PUBLIC KEY-----";
    
    NSString *privateKey = @"-----BEGIN PRIVATE KEY-----\n  æ­¤å¤„æ›¿æ¢ç”Ÿæˆçš„ç§é’¥ \n-----END PRIVATE KEY-----";
    
    NSFileManager *fm = [NSFileManager defaultManager];
    
    // è·å–Documentsç›®å½•è·¯å¾„
    NSString *docDir = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];
    NSString *bundleIdentifier = [[NSBundle mainBundle] bundleIdentifier];
    NSString *path = [docDir stringByAppendingFormat:@"/%@",bundleIdentifier];
    NSString *publicKeyPath = [path stringByAppendingPathComponent:@"public_key.pem"];
    NSString *privateKeyPath = [path stringByAppendingPathComponent:@"private_key.pem"];
    
    BOOL isDir;
    BOOL exists = [fm fileExistsAtPath:path isDirectory:&isDir];
    if (exists) {
        /* file exists */
        if (isDir) {
            NSError *error = nil;
            BOOL pubResult = [publicKey writeToFile:publicKeyPath atomically:YES encoding:NSUTF8StringEncoding error:&error];
            if (error) {
                NSLog(@"%@",[error localizedDescription]);
            }
            BOOL privateResult = [privateKey writeToFile:privateKeyPath atomically:YES encoding:NSUTF8StringEncoding error:&error];
            if (error) {
                NSLog(@"%@",[error localizedDescription]);
            }
        }
    }else {
        [fm createDirectoryAtPath:path withIntermediateDirectories:YES attributes:nil error:nil];
        NSError *error = nil;
        BOOL pubResult = [publicKey writeToFile:publicKeyPath atomically:YES encoding:NSUTF8StringEncoding error:&error];
        if (error) {
            NSLog(@"%@",[error localizedDescription]);
        }
        BOOL privateResult = [privateKey writeToFile:privateKeyPath atomically:YES encoding:NSUTF8StringEncoding error:&error];
        if (error) {
            NSLog(@"%@",[error localizedDescription]);
        }
    }
    
    rsa.rsaKeyPath = path;
    [rsa importRSAKeyFromeStringWithType:KeyTypePublic andKey:publicKeyPath];
    
    [rsa importRSAKeyFromeStringWithType:KeyTypePrivate andKey:privateKeyPath];
    
    
    NSString *pubDesc = [rsa encryptByRsa:@"éœ€è¦åŠ å¯†çš„å­—ç¬¦ä¸²" withKeyType:KeyTypePrivate];
    NSLog(@"åŠ å¯†å†…å®¹:%@\n--------\n",encryptString);
    NSLog(@"æ‘˜è¦:\n---------\n%@\n--------\n",pubDesc);
    
    //å‰©ä¸‹çš„å¤§å®¶è‡ªå·±æ¢ç´¢ä¸€ä¸‹ æ²¡ä»€ä¹ˆéš¾åº¦  
```


å…¶ä¸­openssl apiåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç¬¬ä¸€æ­¥RSAå¯†é’¥ç”Ÿæˆå·¥å…·opensslçš„includeæ–‡ä»¶å¤¹ä¸­å¾—åˆ°


ä¸‹é¢æˆ‘è¯´ä¸€ä¸‹å¦‚ä½•é›†æˆopensslåˆ° iOSå·¥ç¨‹ 

### 1.ä¸‹è½½ openssl library
[openssl iosä¸‹è½½](https://github.com/st3fan/ios-openssl)

### 2.å¯¼å…¥åˆ°å·¥ç¨‹ä¸­

æ‹–æ‹½ opensslçš„åº“ _(åŒ…å« `include` & `lib` çš„æ–‡ä»¶å¤¹ )_åˆ°å·¥ç¨‹ä¸­ 

ç„¶å å» project targets -> `Build Settings`


* æ‰¾åˆ° **Header Search Paths**, æ·»åŠ  `"${SRCROOT}/Libraries/openssl/include"` ä¸ºä½ çš„å·¥ç¨‹
* æ‰¾åˆ° **Library Search Paths**, æ·»åŠ  `"${SRCROOT}/Libraries/openssl/lib"` 

ç„¶åå°±å¯ä»¥äº†å¦‚æœä¸­é—´å‡ºé—®é¢˜ è¯·æ£€æŸ¥ä¸€ä¸‹ç›®å½•æ˜¯å¦æ­£ç¡®ç†è®ºä¸Šåº”è¯¥æ˜¯OKçš„

--


## æœ€åè¯´ä¸€ä¸‹æˆ‘é‡åˆ°RSAåŠ å¯†çš„å‘


åœ¨iOSç«¯åŠ å¯† ç”Ÿæˆæ‘˜è¦åˆ°androidçš„æ—¶å€™ androidè§£æä¸å‡ºæ¥(æœ‰æ—¶å€™è§£æå‡ºç»“æœå‰é¢ ä¸€å †ä¹±ç ) è¿™æ˜¯base64æœ‰é—®é¢˜  å»ºè®® androidä½¿ç”¨åŸç”Ÿçš„æ©

``` java
import android.util.Base64;
```

å¦‚æœæ˜¯iOS è¯·ä½¿ç”¨ å¦‚ä¸‹ Base64
[base64æ¥æº](https://github.com/nicklockwood/Base64)

ä¸Šè¾¹çš„ios çš„base64å’Œandroidä¸€ä¸€å¯¹åº” ä¸è¦ç†è§£é”™äº† éšä¾¿æä¸ªBase64å°±è¡Œäº†  ä¸ä¿¡æˆ‘ ä½ å¯ä»¥è¯•è¯•

base64çš„ä»£ç æˆ‘å·²ç»æŠŠä»£ç å®ç°å†™åˆ°`CRSA.m`äº† å¦‚æœåƒå‰¥ç¦»å¾ˆç®€å•

å¥½ demoæˆ‘å°±ä¸å†™äº† å·²ç»æŠŠæ‰€æœ‰å®ç°éƒ½æä¸Šå»äº† 

å¸Œæœ›å¤§å®¶æ‰¾åˆ° å¥½ä½¿çš„RSAæ–¹æ³•å®ç° å¦‚æœæœ‰é—®é¢˜ éšæ—¶ç•™è¨€ 

æœ€åæˆ‘è¯´ä¸€å¥ å¾ˆç®€å•çš„ä¸€ä¸ªRSAè·¨å¹³å°æ–¹æ¡ˆ é‚£äº›æŠ„è¢­CSDNçš„æ–‡ç« å°ä¼™ä¼´ å°‘å‘ç‚¹äºº è¿æœç´¢å¼•æ“éƒ½ä¸ä¼šæ”¾è¿‡ä½ 

å…¨æ–‡å®Œ 

[å‚è€ƒ](https://www.lvtao.net/dev/android_ios_php_openssl.html)




URL: https://sunyazhou.com/2017/06/EnableStaticAnalyer/index.html.md
Published At: 2017-06-20 15:07:33 +0000

# Xcodeå¼€å¯é™æ€åˆ†æå™¨

![](/assets/images/20170620EnableStaticAnalyer/static.webp)



## Clang é™æ€åˆ†æå™¨

Clang ç¼–è¯‘å™¨ï¼ˆä¹Ÿå°±æ˜¯ XCode ä½¿ç”¨çš„ç¼–è¯‘å™¨ï¼‰æœ‰ä¸€ä¸ª é™æ€åˆ†æå™¨(static analyer) ï¼Œç”¨æ¥æ‰§è¡Œä»£ç æ§åˆ¶æµå’Œæ•°æ®æµçš„åˆ†æï¼Œå¯ä»¥å‘ç°è®¸å¤šç¼–è¯‘å™¨æ£€æŸ¥ä¸å‡ºçš„é—®é¢˜ã€‚

ä½ å¯ä»¥åœ¨ Xcode çš„ Product â†’ Analyze é‡Œæ‰‹åŠ¨è¿è¡Œåˆ†æå™¨ã€‚

åˆ†æå™¨å¯ä»¥è¿è¡Œâ€œ`shallow`â€å’Œâ€œ`deep`â€ä¸¤ç§æ¨¡å¼ã€‚åè€…è¦æ…¢å¾—å¤šï¼Œä½†æ˜¯æœ‰è·¨æ–¹æ³•çš„æ§åˆ¶æµåˆ†æä»¥åŠæ•°æ®æµåˆ†æï¼Œå› æ­¤èƒ½å‘ç°æ›´å¤šé—®é¢˜ã€‚

## å»ºè®®ï¼š

å¼€å¯åˆ†æå™¨çš„ å…¨éƒ¨ æ£€æŸ¥ï¼ˆæ–¹æ³•æ˜¯åœ¨ `build setting` çš„â€œ`Static Analyzer`â€éƒ¨åˆ†å¼€å¯æ‰€æœ‰é€‰é¡¹ï¼‰

åœ¨ `build setting` é‡Œï¼Œå¯¹ `release` çš„ `build` é…ç½®å¼€å¯ â€œ`Analyze during` `â€˜Buildâ€™`â€ ã€‚ï¼ˆçœŸçš„ï¼Œä¸€å®šè¦è¿™æ ·åšâ€”â€”ä½ ä¸ä¼šè®°å¾—æ‰‹åŠ¨è·‘åˆ†æå™¨çš„ã€‚ï¼‰

æŠŠ `build setting` é‡Œçš„ â€œMode of Analysis for `â€˜Analyzeâ€™`â€ è®¾ä¸º  `Deep`

æŠŠ `build setting` é‡Œçš„ â€œMode of Analysis for `â€˜Buildâ€™`â€ è®¾ä¸º `Shallow` (faster)

![](/assets/images/20170620EnableStaticAnalyer/EnableSStaticAnalyer.webp)

å…¨æ–‡å®Œ

[å‚è€ƒ](http://mp.weixin.qq.com/s/x6XSQ_rrYCOXi2EVeiMfCg)




URL: https://sunyazhou.com/2017/06/HowToDeprecatedAMothodInObjC/index.html.md
Published At: 2017-06-16 16:40:26 +0000

# å¦‚ä½•åœ¨Objective-Cä¸­åºŸå¼ƒä¸€ä¸ªæ–¹æ³•

# å‰è¨€
![](/assets/images/20170616HowToDeprecatedAMothodInObjC/deprecated.webp)


æœ€æ–°åœ¨ä»äº‹SDKæ–¹å‘çš„å¼€å‘ æœ‰çš„æ—¶å€™ ä¸èƒ½è½»æ˜“çš„æŠŠæŸä¸ªAPIå»æ‰ å› ä¸ºæœ‰äº›äººè¿˜åœ¨ä½¿ç”¨ äºæ˜¯ä¸ºäº†ä¿ç•™ ç›¸å…³æ–¹æ³• å¹¶æ ‡è¯†ä¸ºå¼ƒç”¨ çš„æ–¹å¼ æˆ‘é‡‡ç”¨å¦‚ä¸‹ä»£ç 

``` objc
__attribute__((deprecated("æ­¤æ–¹æ³•å·²å¼ƒç”¨,è¯·ä½¿ç”¨xxxxx:æ–¹æ³•")));
```

### åœºæ™¯1

æˆ‘æƒ³æ ‡è¯†ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨å…¶å®ƒæ–¹å¼ä¼ å…¥æŸä¸ªå‚æ•° 

ä¾‹å¦‚:æ§åˆ¶å™¨ä¸­æˆ‘æƒ³æ ‡è¯†è®¾ç½®URLçš„æ–¹æ³•ç›´æ¥ä½¿ç”¨setteræ–¹æ³•å°±å¯ä»¥äº†


``` objc
@interface VideoEditorViewController : UIViewController

@property(nonatomic, strong)NSURL *videoPath;

-(instancetype)initWithUrl:(NSURL *)path __attribute__((deprecated("ä½¿ç”¨setVideoPath:æ–¹æ³•ä¼ å…¥")));

@end
```

è¿™æ ·è°ƒç”¨çš„æ—¶å€™å°±ç›´æ¥æ˜¾ç¤ºè­¦å‘Šäº† å‘Šè¯‰å½“å‰æ–¹æ³•ä¼ å…¥URLè¢«å¼ƒç”¨

![](/assets/images/20170616HowToDeprecatedAMothodInObjC/code.webp)



ç›¸å…³`__attribute__`æ›´å¤šç”¨æ³• è¯·å‚è€ƒè‹¹æœå®˜æ–¹æ–‡æ¡£å’Œå…¶å®ƒåšå®¢ 
åç»­ä¼šæŒç»­æ›´æ–°æ›´å¤šç”¨æ³•

å…¨æ–‡å®Œ



[å‚è€ƒ](http://www.jianshu.com/p/0237c34158f0)



URL: https://sunyazhou.com/2017/06/XcodeDebugViaWireless/index.html.md
Published At: 2017-06-16 11:07:46 +0000

# Xcode9æ–°åŠŸèƒ½ æ— çº¿çœŸæœºè°ƒè¯•

### æ•ˆæœ
 
ä»Šå¤©å°ä¼™ä¼´(ç‹å¯æˆ)å‘ç°Xcodeæœ‰ä¸ªå¾ˆæ–¹ä¾¿çš„åŠŸèƒ½ å¯ä»¥çœŸæœºæ— çº¿è°ƒè¯•è¿è¡Œ

çœ‹ä¸€å¼ å›¾  
![](/assets/images/20170616XcodeDebugViaWireless/debug.gif)


### é…ç½®

ç¬¬ä¸€æ­¥ é€‰æ‹©è®¾å¤‡é€‰é¡¹

![](/assets/images/20170616XcodeDebugViaWireless/setting1.webp)

ç¬¬äºŒæ­¥ ç‚¹å‹¾é€‰ via network

![](/assets/images/20170616XcodeDebugViaWireless/setting2.webp)

å‰©ä¸‹çš„å·¥ä½œå°±æ˜¯æ‹”æ‰é‚£ä¸ªæˆ‘ä»¬éå¸¸è®¨åŒè€Œä¸”æœ‰ä¸å¾—ä¸ç”¨è¿˜æ­»è´µä¸”æ€»æŠ˜å¤´å¤„çš„ç™½è‰²æ•°æ®çº¿äº†



*æ³¨æ„:ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ—¶å€™æ¯”è¾ƒæ…¢  å¯ä»¥é€šè¿‡æ•°æ®çº¿æ’ä¸Šå…ˆè¿è¡Œä¸€æ¬¡*
*è¿è¡Œç¯å¢ƒ: Xcode9 beta*
*è¿è¡Œè®¾å¤‡æ“ä½œç³»ç»Ÿ: iOS11 beta*
*Macbook+iPhone æœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘*

æˆ‘ä¼°è®¡è‹¹æœå‘å¸ƒæ­£å¼ç‰ˆæœ¬çš„æ—¶å€™è¿™ä¸ªåº”è¯¥æ¯”è¾ƒå¥½ç”¨äº† 

å¥½äº† ç°åœ¨å¯ä»¥æ„‰å¿«çš„ç©è€ äº†




URL: https://sunyazhou.com/2017/06/LearningAVFoundationAVAssetBasic/index.html.md
Published At: 2017-06-16 10:11:19 +0000

# Learning AV Foundation(å››)AVAssetå…ƒæ•°æ®(åŸºç¡€ç¯‡)

![](/assets/images/20170616LearningAVFoundationAVAssetBasic/AlbumDetail.webp)


# å‰è¨€
æœ¬ç¯‡è®²è¿°çš„`AVAsset`å…ƒæ•°æ®(å¯ä»¥ç®€å•ç†è§£æˆ æ¯”å¦‚ä¸€ä¸ªmp3éŸ³é¢‘æ ¼å¼çš„modelä¿¡æ¯. title:xxxx, art:åˆ˜å¾·å, album:ä¸“è¾‘ çˆ±ä½ ä¸€ä¸‡å¹´.... ç­‰è¿™äº›æ•°æ®çš„æ¥æº). å½“ç„¶è¿™ç§æ„ä¹‰ä¸Šçš„å­—æ®µä¿¡æ¯ å±äº`AVAsset`çš„ä¸€ä¸ªå±æ€§ã€‚`AV Foundation`é€šè¿‡`AVAsset`å°è£…æ¥å¤„ç†å„ç§éŸ³é¢‘çš„å…ƒæ•°æ®, __æ¯”å¦‚ä»mp3æ–‡ä»¶ä¸­è§£æå‡ºæ¥å°é¢å›¾(artwork)__ç­‰ã€‚ æœ¬ç« çš„å…·ä½“å†…å®¹å¦‚ä¸‹:

### __ç†è§£èµ„æºå«ä¹‰__
### __åˆ›å»ºèµ„æº__
  * iOS Assetåº“
  * iOS iPodåº“
  * macOS iTunesåº“
  
### __å¼‚æ­¥è½½å…¥__
### __åª’ä½“å…ƒæ•°æ®__
  * å…ƒæ•°æ®æ ¼å¼  
     1. QuickTime  
     2. MPEG-4éŸ³é¢‘å’Œè§†é¢‘(mp4)  
     3. MP3  
     
### __ä½¿ç”¨å…ƒæ•°æ®__
  * æŸ¥è¯¢å…ƒæ•°æ®
  * ä½¿ç”¨`AVMetadataItem`

### __åˆ›å»ºMetaManager Demo__
  * MediaItem(ç›¸å½“äºModel)
  * MediaItemå®ç°
  * æ•°æ®è½¬æ¢å™¨(model to AVMetadataItem || AVMetadataItem to mode)
  * DefaultMetadataé»˜è®¤è½¬æ¢
  * è½¬æ¢Artwork(å”±ç‰‡çš„å°é¢æˆ–è€…ä¸“è¾‘å›¾é‚£ç§)
  * è½¬æ¢æ³¨é‡Š
  * è½¬æ¢éŸ³è½¨æ•°æ®(track)
  * è½¬æ¢å”±ç‰‡æ•°æ®
  * è½¬æ¢é£æ ¼æ•°æ®(genre, eg: blueè“è°ƒ, classicå¤å…¸,popæµè¡Œç­‰126ç§..)
  * å®Œæˆæœ€ç»ˆdemo  
  
#### __ä¿å­˜å…ƒæ•°æ®__
---



### __ç†è§£`AVAsset`èµ„æºå«ä¹‰__  
`AVAsset`æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æŠ½è±¡ç±»,å®šä¹‰åª’ä½“èµ„æºæ··åˆå‘ˆç°æ–¹å¼.é‡Œé¢åŒ…å«éŸ³è§†é¢‘çš„**æ›²ç›®**ã€**æ ¼å¼**ã€**æ—¶é•¿**, ä»¥åŠ**å…ƒæ•°æ®NSData**(äºŒè¿›åˆ¶çš„bytes).

`AVAsset`ä¸ç”¨è€ƒè™‘åª’ä½“èµ„æºå…·æœ‰çš„ä¸¤ä¸ªèŒƒç•´: 
 
* æä¾›å¯¹åŸºæœ¬åª’ä½“æ ¼å¼çš„æŠ½è±¡å±‚  
* ä¸ç”¨è€ƒè™‘å¤„ç†å› ä¸ºä¸åŒæ ¼å¼è·å–å†…å®¹æ–¹å¼ä¸ä¸€æ ·

è¿™æ„å‘³ç€æ— è®ºæ˜¯å¤„ç†`Quick Time`å½±ç‰‡ã€`MPEG-4`è§†é¢‘è¿˜æ˜¯`MP3`éŸ³é¢‘ï¼Œæ¡†æ¶æä¾›ç»Ÿä¸€çš„æ¥å£ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£åªæœ‰èµ„æºè¿™ä¸ªæ¦‚å¿µã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†__å¼€å‘è€…åœ¨é¢å¯¹ä¸åŒæ ¼å¼çš„å†…å®¹æ—¶æœ‰ä¸€ä¸ªç»Ÿä¸€çš„å¤„ç†æ–¹æ³•ã€‚ä¸éœ€è¦careå¤šç§ç¼–ç å™¨å’Œå®¹å™¨æ ¼å¼å› ä¸ºç»†èŠ‚ä¸åŒè€Œå¸¦æ¥çš„å›°æ‰°__. å½“ç„¶è·å–è¿™äº›å…¶ä½™ä¿¡æ¯å¯ä»¥é€šè¿‡å…¶å®ƒæ–¹å¼å®ç°. `AVAsset`è¿˜éšè—äº†èµ„æºä½ç½®(GPSå®šä½)ä¿¡æ¯,å½“å¤„ç†ä¸€ä¸ªåª’ä½“å¯¹è±¡æ—¶ï¼Œé€šè¿‡URLæ¥åˆå§‹åŒ–init. URLå¯ä»¥æ˜¯Bundleé‡Œé¢ ä¹Ÿå¯ä»¥æ˜¯æ²™ç›’çš„æœ¬åœ°æ–‡ä»¶ç³»ç»ŸURL.ä¹Ÿå¯ä»¥ä»iPodåº“ä¸­å–åˆ°çš„URLã€‚è¿˜å¯ä»¥æ˜¯è¿œç¨‹æœåŠ¡å™¨çš„éŸ³é¢‘æµæˆ–è§†é¢‘æµçš„URLã€‚
    
`AVAsset`å±äºä½è€¦åˆç»„ä»¶æ–¹å¼çš„å°è£… è®©æ¡†æ¶æ¥å¤„ç†é‚£äº›ç¹é‡çš„å·¥ä½œ, æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ç”¨è€ƒè™‘æ–‡ä»¶ä½ç½®çš„å‰æä¸‹è·å–æˆ–è€…è½½å…¥åª’ä½“ã€‚ç”±äºä¸ç”¨careæ–‡ä»¶åˆé€‚å’Œæ–‡ä»¶ä½ç½®ç­‰å¤æ‚çš„é—®é¢˜ã€‚`AVAsset`ä¸ºå¼€å‘è€…å¤„ç†`timed media(æ—¶åŸºåª’ä½“)`æä¾›äº†ä¸€ç§ç®€å•ç»Ÿä¸€çš„æ–¹å¼.

`AVAsset`æœ¬èº«ä¸æ˜¯åª’ä½“èµ„æº. å¯ä»¥æŠŠå®ƒç†è§£æˆæ‰¿è½½`timed media(æ—¶åŸºåª’ä½“)`çš„å®¹å™¨ç±»ã€‚å®ƒæœ‰å¾ˆå¤šæè¿°è‡ªèº«å…ƒæ•°æ®çš„åª’ä½“ç»„æˆ. `AVAssetTrack`æ‰æ˜¯æˆ‘ä»¬çœŸæ­£å­˜å‚¨åª’ä½“èµ„æºçš„ç»Ÿä¸€åª’ä½“ç±»å‹ã€‚å¹¶å¯¹æ¯ä¸ªèµ„æºå»ºç«‹ç›¸åº”çš„model.  `AVAssetTrack`æœ€å¸¸è§çš„å½¢å¼å°±æ˜¯ éŸ³é¢‘æµå’Œè§†é¢‘æµ, ä½†æ˜¯ä»–è¿˜å¯ä»¥ç”¨äºè¡¨ç¤ºè¯¸å¦‚__æ–‡æœ¬__ã€__å‰¯æ ‡é¢˜__ã€__éšè—å­—å¹•__ç­‰åª’ä½“ç±»å‹. å¦‚ä¸‹ç¤ºæ„å›¾ç†è§£`AVAsset` å’Œ `AVAssetTrack`

![](/assets/images/20170616LearningAVFoundationAVAssetBasic/AVAssetTrack.webp)

_**`AVAsset.tracks`**_ å¦‚ä¸‹

``` objc 
@property (nonatomic, readonly) NSArray<AVAssetTrack *> *tracks;

```

 èµ„æºæ›²ç›®å¯é€šè¿‡trackså±æ€§è®¿é—®åˆ°. è¯¥å±æ€§è¿”å›ä¸€ä¸ªNSArrayçš„æ•°ç»„,è¿™ä¸ªæ•°ç»„ä¸­çš„å…ƒç´ å°±æ˜¯ä¸“è¾‘åŒ…å«çš„æ‰€æœ‰æ›²ç›®. æ­¤å¤–ï¼Œ`AVAsset`è¿˜å¯ä»¥é€šè¿‡æ ‡è¯†ç¬¦ã€åª’ä½“ç±»å‹æˆ–åª’ä½“ç‰¹å¾ç­‰ä¿¡æ¯æ‰¾åˆ°ç›¸åº”çš„æ›²ç›®.è¿™ä½¿å¾—åœ¨æœªæ¥æ›´é«˜çº§çš„å¤„ç†ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“è·å–ä¸€ç»„éœ€è¦çš„æ›²ç›®
 
 
 
#### __åˆ›å»ºèµ„æº__
    
å½“ä¸ºä¸€ä¸ªç°æœ‰çš„åª’ä½“èµ„æºåˆ›å»º`AVAsset`å¯¹è±¡æ—¶, å¯ä»¥é€šè¿‡URLå¯¹å®ƒçš„è¿›è¡Œçš„åˆå§‹åŒ–æ¥å®ç°. ä¸€èˆ¬æ¥è¯´æ˜¯ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶URL, ä¹Ÿå¯ä»¥æ˜¯è¿œç¨‹çš„èµ„æºURL  

    
``` objc
    NSURL *assetURL = //....
    AVAsset *asset = [AVAsset assetWithURL: assetURL];
```

> ....

`AVAsset`æ˜¯ä¸ªæŠ½è±¡ç±», å®ƒä¸èƒ½ç›´æ¥è¢«å®ä¾‹åŒ–. å½“ä½¿ç”¨`assetWithURL:`æ–¹æ³•åˆ›å»ºå®ä¾‹æ—¶,å®é™…ä¸Šæ˜¯åˆ›å»ºäº†`AVAsset`çš„å­ç±»`AVURLAsset` æœ‰æ—¶å€™ä¼šç›´æ¥ä½¿ç”¨è¿™ä¸ªç±», å› ä¸ºå®ƒå…è®¸é€šè¿‡ä¼ é€’é€‰é¡¹å­—å…¸æ¥ç²¾ç»†è°ƒæ•´èµ„æºçš„åˆ›å»ºæ–¹å¼, ä¸¾ä¸ªä¾‹å­,æ¯”å¦‚åˆ›å»º ç”¨åœ¨éŸ³é¢‘æˆ–è§†é¢‘ç¼–è¾‘åœºæ™¯ä¸­çš„èµ„æº, å¯èƒ½å¸Œæœ›ä¼ é€’ä¸€ä¸ªé€‰é¡¹(option)çš„å­—å…¸æ¥å‘Šè¯‰ç¨‹åºæä¾›æ›´ç²¾ç¡®çš„æ—¶é•¿å’Œè®¡æ—¶ç­‰ä¿¡æ¯ ä¾‹å¦‚:


``` objc

    NSURL *assetURL = //....
    NSDictionary *options = @{AVURLAssetPreferPreciseDurationAndTimingKey:@YES};
    AVAsset *asset = [AVAsset assetWithURL: assetURL];
    
```
  
> ...

è¿™é‡Œä¼ é€’çš„æ˜¯å¸Œæœ›å¾—åˆ°ç¨é•¿ä¸€ç‚¹çš„åŠ è½½äº‹ä»¶,æ¥è·å–æ›´ç²¾ç¡®çš„æ—¶é•¿åŠæ—¶é—´ä¿¡æ¯.å¾ˆå¤šå¸¸è§çš„ä½ç½®æ˜¯å¼€å‘æ—¶å¤§å®¶æƒ³åˆ›å»ºèµ„æºå¯¹è±¡çš„åœ°æ–¹. åœ¨iOSè®¾å¤‡ä¸Šæˆ‘ä»¬å¸Œæœ›åœ¨ç”¨æˆ·çš„ç…§ç‰‡åº“ä¸­è®¿é—®è§†é¢‘æ–‡ä»¶, æˆ–è€…åœ¨iPodåº“ä¸­è®¿é—®æ­Œæ›². åœ¨Macä¸Š æˆ‘ä»¬å¸Œæœ›ä»ç”¨æˆ·çš„iTunesåº“ä¸­æ‰¾åˆ°åª’ä½“é¡¹. å€ŸåŠ©iOSå’ŒmacOSä¸­çš„è¿™äº›è¾…åŠ©frameworkæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šè¾¹çš„åª’ä½“èµ„æºã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹è¿™äº›è¦ç”¨åˆ°çš„frameworkçš„ä¾‹å­

##### iOS Assetsåº“

åœ¨iOSä¸Šæ‹ç…§æˆ–è€…é€šè¿‡å‰ç½®å’Œåç½®ç›¸æœºæ•æ‰åˆ°çš„éŸ³è§†é¢‘,å®ƒä»¬ä¿å­˜åœ¨ç”¨æˆ·çš„ç…§ç‰‡åº“ä¸­.iOSæä¾›çš„Assetsåº“æ¡†æ¶å¯ä»¥å®ç°ä»ç…§ç‰‡åº“ä¸­è¯»å†™çš„åŠŸèƒ½, ä¸‹ä¾‹ä»ç”¨æˆ·èµ„æºåº“ä¸­çš„è§†é¢‘åˆ›å»ºä¸€ä¸ªAVAsset:

``` objc
ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];
    [library enumerateGroupsWithTypes:ALAssetsGroupSavedPhotos usingBlock:^(ALAssetsGroup *group, BOOL *stop) {
        //Filter down to only videos
        [group setAssetsFilter:[ALAssetsFilter allVideos]];
        
        //Grab the first video returned
        [group enumerateAssetsAtIndexes:[NSIndexSet indexSetWithIndex:0] options:0 usingBlock:^(ALAsset *result, NSUInteger index, BOOL *stop) {
            if (result) {
                id representation = [result defaultRepresentation];
                NSURL *url = [representation url];
                AVAsset *asset = [AVAsset assetWithURL:url];
                //åˆ›å»º è°ƒç”¨ä¸€äº›å…¶å®ƒAPI
            }
        }];
        
    } failureBlock:^(NSError *error) {
        NSLog(@"%@", [error localizedDescription]);
    }];
```

ä¸Šé¢æ˜¯å¦‚ä½•è·å–ä¿å­˜åœ¨ ç›¸å†Œä¸­çš„è§†é¢‘èµ„æº(iOS10.10ä»¥åå°±åºŸå¼ƒäº†ä¸Šè¿°æ–¹å¼) è·å–å‡ºç­›é€‰ç»“æœçš„ç¬¬ä¸€ä¸ªè§†é¢‘, åº“ä¸­çš„æ¡ç›®å…¨éƒ¨è¢«å»ºæ¨¡ä¸º`ALAsset`å¯¹è±¡, ä¸ºé»˜è®¤çš„å‘ˆç°æ–¹å¼é€‰ç”¨`ALAsset`ç±»å‹è¿”å›ä¸€ä¸ª`ALAssetRepresentation`å¯¹è±¡,å®ƒæä¾›äº†ä¸€ä¸ªé€‚ç”¨äºåˆ›å»º`AVAset`çš„URL.

##### iOS iPodåº“

æˆ‘ä»¬è·å–åª’ä½“çš„ä¸€ä¸ªå¸¸è§ä½ç½®å°±æ˜¯ç”¨æˆ·çš„iPodåº“. `MediaPlayer` framework æ¡†æ¶æä¾›äº†API, ç”¨äºåœ¨iPodåº“ä¸­æŸ¥è¯¢å’Œè·å–æ¡ç›®. å½“æ‰¾åˆ°æƒ³è·å–çš„itemæ—¶, å¯ä»¥å¾—åˆ°ä¸€ä¸ªå­˜å‚¨çš„URLå¹¶ä½¿ç”¨è¿™ä¸ªå¾—åˆ°çš„URLåˆå§‹åŒ–ä¸€ä¸ªèµ„æº, å¦‚ä¸‹ä¾‹æ‰€ç¤º:  


``` objc
    //è‰ºæœ¯å®¶
    MPMediaPropertyPredicate *artistPredicate = [MPMediaPropertyPredicate predicateWithValue:@"åˆ˜å¾·å" forProperty:MPMediaItemPropertyArtist];
    //ä¸“è¾‘
    MPMediaPropertyPredicate *albumPredicate = [MPMediaPropertyPredicate predicateWithValue:@"çœŸæ°¸è¿œ" forProperty:MPMediaItemPropertyAlbumTitle];
    //æ­Œæ›²åç§°
    MPMediaPropertyPredicate *songPredicate = [MPMediaPropertyPredicate predicateWithValue:@"çˆ±ä½ ä¸€ä¸‡å¹´" forProperty:MPMediaItemPropertyTitle];
    //æŸ¥è¯¢
    MPMediaQuery *query = [[MPMediaQuery alloc] init];
    [query addFilterPredicate:artistPredicate];
    [query addFilterPredicate:albumPredicate];
    [query addFilterPredicate:songPredicate];
    
    NSArray *result = [query items];
    if (result.count > 0) {
        MPMediaItem *item = result[0];
        NSURL *assetURL = [item valueForProperty:MPMediaItemPropertyAssetURL];
        AVAsset *asset = [AVAsset assetWithURL:assetURL];
        // Asset ä¿¡æ¯
    }
```


`MediaPlayer`frameworkæä¾›äº†ä¸€ä¸ªä¸º`MPMediaPropertyPredicate`çš„ç±»,ç”¨æˆ·å¸®åŠ©ç”¨æˆ·åœ¨iPodåº“ä¸­æŸ¥æ‰¾åˆ°å…·ä½“å†…å®¹æ‰€ç”¨çš„æŸ¥è¯¢è¯­å¥
ä¸Šè¾¹ä¸¾ä¾‹ä¸€ä¸ªä¾‹å­: åœ¨`åˆ˜å¾·å`çš„`çœŸæ°¸è¿œ`(çœŸæ°¸è¿œä¸“è¾‘)  å”±ç‰‡ä¸­æŸ¥æ‰¾`çˆ±ä½ ä¸€ä¸‡å¹´`è¿™é¦–æ­Œ, æ‰§è¡Œå®ŒæŸ¥è¯¢ ä¼šè¿”å›è¿™ä¸ªåª’ä½“ æ¡ç›®çš„èµ„æºURLå±æ€§(`MPMediaItemPropertyAssetURL`). å¹¶ä½¿ç”¨è¿™ä¸ªå±æ€§åˆ›å»º`AVAsset`

##### macOS iTunesåº“

åœ¨ macOS(ä»¥å‰å« OS X)ä¸Š, iTunesæ˜¯ç”¨æˆ·çš„åª’ä½“èµ„æºä¸­å¿ƒ. è¦è¯†åˆ«è¿™ä¸ªåº“ä¸­çš„èµ„æº, æˆ‘ä»¬é€šå¸¸è¦å¯¹iTuneséŸ³ä¹ç›®å½•ä¸­çš„iTunes Music Library.xml æ–‡ä»¶è¿›è¡Œè§£æ, ä»è€Œå¾—åˆ°ç›¸å…³æ•°æ®. ä¸è¿‡åœ¨ Mac OS X 10.8å±±ç‹®ä¹‹å æœ‰äº†æ¯”è¾ƒç®€å•çš„æ–¹æ³•--`iTunesLibrary`framework.



``` objc 
ITLibrary *library = [ITLibrary libraryWithAPIVersion:@"1.0" error:nil];
    NSArray *items = library.allMediaItems;
    
    NSString *query = @"artist.name == 'åˆ˜å¾·å'"
                      "album.title == 'çœŸæ°¸è¿œ'"
                      "title == 'çˆ±ä½ ä¸€ä¸‡å¹´'";
    NSPredicate *predicate = [NSPredicate predicateWithFormat:query];
    
    NSArray *songs = [items filteredArrayUsingPredicate:predicate];
    if (songs.count > 0) {
        ITLibMediaItem *item = songs[0];
        AVAsset *asset = [AVAsset assetWithURL:item.location];
        // asset info
    }
    
```


`iTunesLibrary`æ¡†æ¶å¹¶æ²¡æœ‰åƒMediaPlayeræ¡†æ¶é‚£æ ·ç»™å‡ºå…·ä½“çš„æŸ¥è¯¢API. ä¸è¿‡å¼€å‘è€…å¯ä½¿ç”¨æ ‡å‡†çš„Cocoa NSPredicate(è°“è¯)ç±»æ¥æ„å»ºä¸€ä¸ªå¤æ‚çš„æŸ¥è¯¢,å½“ç­›å‡ºéœ€è¦çš„media itemé›†åˆåï¼Œå¯ä½¿ç”¨`ITLibMediaItem`çš„`location`å±æ€§å¾—åˆ°ä¸€ä¸ªURLå¹¶åˆ›å»º`AVAsset`.

#### å¼‚æ­¥è½½å…¥

`AVAsset`å…·æœ‰å¤šç§æœ‰ç”¨çš„æ–¹æ³•å’Œå±æ€§, å¯ä»¥æä¾›æœ‰å…³èµ„æºçš„ä¿¡æ¯, æ¯”å¦‚æ—¶é•¿ã€åˆ›å»ºæ—¥æœŸã€å…ƒæ•°æ®ç­‰.
`AVAsset`è¿˜åŒ…å«ä¸€äº›ç”¨äºè·å–å’Œä½¿ç”¨æ›²ç›®é›†åˆçš„æ–¹æ³•. ä¸è¿‡æœ‰ä¸€ç‚¹å¾ˆé‡è¦, å°±æ˜¯å½“åˆ›å»ºæ—¶èµ„æºå°±æ˜¯å¯¹åŸºç¡€æ–‡ä»¶çš„å¤„ç†, `AVAsset` é‡‡ç”¨ä¸€ç§lazy loadçš„åŠ è½½æ–¹å¼, æå‡äº†å¿«é€Ÿåˆ›å»ºèµ„æºå’Œç«‹å³è½½å…¥çš„é€Ÿåº¦. 
__*æ³¨æ„`AVAsset`çš„å±æ€§è®¿é—®æ˜¯åŒæ­¥çš„,å¦‚æœæ­£åœ¨è¯·æ±‚çš„å±æ€§æ²¡æœ‰é¢„å…ˆè½½å…¥,ç¨‹åºå°±ä¼šé˜»å¡,ç›´åˆ°å®ƒåšå‡ºå“åº”ä¸ºæ­¢*__è¿™ä¸ªææ³•ä¸æ˜¯å¾ˆå¥½,eg: avasset.duration å¯èƒ½æ˜¯ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œ,å¦‚æœä½¿ç”¨MP3æ–‡ä»¶æ—¶æ²¡æœ‰åœ¨å¤´æ–‡ä»¶ä¸­è®¾ç½®`TLEN`æ ‡ç­¾,è¿™ä¸ªæ ‡ç­¾ç”¨äºå®šä¹‰durationå€¼,åˆ™æ•´ä¸ªéŸ³é¢‘æ›²ç›®éƒ½éœ€è¦è¿›è¡Œè§£ææ¥å‡†ç¡®çš„çŸ¥é“å®ƒçš„duration, å¦‚æœåœ¨ä¸»çº¿ç¨‹åšè¿™æ ·çš„è®¿é—®æ“ä½œå°±ä¼šé˜»å¡ä¸»çº¿ç¨‹,ç›´åˆ°ç›¸å…³æ“ä½œå®Œæˆä¸ºæ­¢, APPå¯èƒ½ä¼šå‡ºç°å¡é¡¿,å¯¼è‡´ç³»ç»Ÿç›‘è§†å™¨ä»‹å…¥,å¹¶ç»ˆæ­¢APPè¿è¡Œ,å¦‚æœè§£å†³è¿™ç§é—®é¢˜,æˆ‘ä»¬åº”è¯¥ä½¿ç”¨å¼‚æ­¥çš„ æ–¹å¼æ¥æŸ¥è¯¢èµ„æºå±æ€§.

``` objc
- (AVKeyValueStatus)statusOfValueForKey:(NSString *)key error:(NSError * _Nullable *)outError;

- (void)loadValuesAsynchronouslyForKeys:(NSArray<NSString *> *)keys completionHandler:(void (^)(void))handler;

```

å¯ä»¥ä½¿ç”¨statusOfValueForKey:error:æ–¹æ³•æŸ¥è¯¢ä¸€ä¸ªç»™å®šçš„å±æ€§çŠ¶æ€,è¿”å›ä¸€ä¸ª`AVKeyValueStatus`çš„æšä¸¾å€¼

``` objc
typedef enum AVKeyValueStatus : NSInteger {
    AVKeyValueStatusUnknown,
    AVKeyValueStatusLoading,
    AVKeyValueStatusLoaded,
    AVKeyValueStatusFailed,
    AVKeyValueStatusCancelled
} AVKeyValueStatus;
```

ç”¨äºè¡¨ç¤ºå½“å‰æ‰€è¯·æ±‚çš„å±æ€§çš„çŠ¶æ€, å¦‚æœçŠ¶æ€ä¸æ˜¯`AVKeyValueStatusLoaded`è¯´æ˜æ­¤æ—¶è¿™ä¸ªå±æ€§å¯èƒ½å¯¼è‡´ç¨‹åºå¡é¡¿,è¦å¼‚æ­¥è½½å…¥ä¸€ä¸ªç»™å®šçš„å±æ€§loadValuesAsynchronouslyForKeys:completionHandler:æ–¹æ³•,å‚æ•°keys æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª`èµ„æºå±æ€§å`çš„æ•°ç»„å’Œä¸€ä¸ªcallback,å½“èµ„æºå¤„äºå›åº”çŠ¶æ€æ—¶,å°±ä¼šè°ƒç”¨è¿™ä¸ª`completionHandler`

``` objc
	NSURL *assetURL = [[NSBundle mainBundle] URLForResource:@"384551_1438267683" withExtension:@"mov"];
    AVAsset *asset = [AVAsset assetWithURL:assetURL];
    //å¼‚æ­¥åŠ åœ¨ tracks property
    NSArray *keys = @[@"tracks"];
    [asset loadValuesAsynchronouslyForKeys:keys completionHandler:^{
        //æŸ¥è¯¢tracksçš„å±æ€§çŠ¶æ€
        NSError *error = nil;
        AVKeyValueStatus status = [asset statusOfValueForKey:@"tracks" error:&error];
        switch (status) {
            case AVKeyValueStatusLoaded:
                //ç»§ç»­å¤„ç†åç»­é€»è¾‘
                break;
            case AVKeyValueStatusFailed:
                //æœ‰error
                break;
            case AVKeyValueStatusCancelled:
                // å¤„ç†æ„å¤–å–æ¶ˆç­‰æƒ…å†µçš„é€»è¾‘
                break;
            
            default:
                break;
        }
    }];

```

è¿™é‡Œç”¨bundleä¸­çš„`QuickTime`ç”µå½±åˆ›å»ºä¸€ä¸ªAVAsset, å¹¶å¼‚æ­¥è½½å…¥è¯¥å¯¹è±¡çš„`tracks`å±æ€§.åœ¨`completionHandler` blockä¸­,æˆ‘ä»¬å¸Œæœ›é€šè¿‡è°ƒç”¨èµ„æºçš„statusOfValueForKey:error:æ–¹æ³•æ¥æ‹¿å‡ºè¯·æ±‚å±æ€§çš„çŠ¶æ€,NSErrorç”¨äºåˆ¤æ–­èµ„æºåŒ…å«é”™è¯¯ä¿¡æ¯. _*æ³¨æ„:`completionHandler:`blockå¯èƒ½åœ¨ä»»æ„ä¸€ä¸ªé˜Ÿåˆ—ä¸­è°ƒç”¨,åœ¨å¯¹UIç•Œé¢åšå‡ºç›¸åº”æ›´æ–°ä¹‹å‰,å¿…é¡»å…ˆå›åˆ°ä¸»çº¿ç¨‹é˜Ÿåˆ—,å¦åˆ™å¿…è¢«å‘ï¼ï¼ï¼*_

> _*æ³¨æ„:ä¸Šé¢çš„demoè½½å…¥äº†ä¸€ä¸ªtrackså±æ€§,å…¶å®å¯ä»¥åœ¨ä¸€ä¸ªåŠç”¨ä¸­è¯·æ±‚å¤šä¸ªå±æ€§,å¦‚æœè¯·æ±‚å¤šä¸ªå±æ€§çš„æ—¶å€™éœ€è¦æ³¨æ„ä»¥ä¸‹ä¸¤ç‚¹:*_
> (1) æ¯æ¬¡è°ƒç”¨ `loadValuesAsynchronouslyForKeys:completionHandler:`æ–¹æ³•æ—¶åªä¼šè°ƒç”¨ä¸€æ¬¡`completionHandler`block, è°ƒç”¨è¿™ä¸ªcallbackçš„æ¬¡æ•°ä¸æ˜¯æ ¹æ®ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³•çš„keyä¸ªæ•°å†³å®šçš„.
> (2) éœ€è¦ä¸ºæ¯ä¸ªè¯·æ±‚çš„å±æ€§è°ƒç”¨`statusOfValueForKey:error:`,ä¸èƒ½å‡è®¾æ‰€æœ‰å±æ€§éƒ½è¿”å›ç›¸åŒçš„çŠ¶æ€å€¼.


### __åª’ä½“å…ƒæ•°æ®__
	
å½“åˆ›å»ºä¸€ä¸ªåª’ä½“åº”ç”¨ç¨‹åºæ—¶,äº†è§£è¯¥åª’ä½“çš„ç»„ç»‡æ ¼å¼éå¸¸é‡è¦, ç®€å•çš„å±•ç¤ºä¸€å †æ–‡ä»¶åä¹Ÿè®¸åœ¨æ–‡ä»¶ä¸å¤šçš„æ—¶å€™è¿˜èƒ½æ¥å—, å¦‚æœå¤§è§„æ¨¡æ‰¹é‡çš„æ–‡ä»¶éœ€è¦å±•ç¤ºå°±æ¯”è¾ƒè›‹ç–¼äº†, æˆ‘ä»¬çœŸæ­£éœ€è¦çš„æ˜¯ _æ‰¾åˆ°ä¸€ç§æ–¹æ³•å¯¹åª’ä½“è¿›è¡Œæè¿°,å½“ç”¨æˆ·å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°ã€è¯†åˆ«å’Œç»„ç»‡è¿™äº›åª’ä½“._ æˆ‘ä»¬æ‰€ä½¿ç”¨çš„`AV Foundation`ä¸­çš„ä¸»è¦åª’ä½“æ ¼å¼(*.mp4ã€*.mp3ã€*.movã€*.mkv.....)éƒ½å¯ä»¥åµŒå…¥æè¿°å…¶å†…å®¹çš„å…ƒæ•°æ®.å› ä¸ºå„ç§åª’ä½“æ ¼å¼çš„æè¿°ä¸å°½ç›¸åŒ,è¦æä¸€å¥—é€šç”¨çš„ç­–ç•¥å»è§£æå„ç§åª’ä½“çš„æ ¼å¼æ–‡ä»¶,è¿™è¦æ±‚æˆ‘ä»¬å¯¹åº•å±‚æŠ€æœ¯æœ‰ä¸€äº›äº†è§£.ä¸è¿‡`AV Foundation`è®©è¿™äº›å˜å¾—ç®€å•,å› ä¸ºå®ƒä½¿å¼€å‘è€…ä¸éœ€è¦è€ƒè™‘å¤§å¤šæ•°ç‰¹å®šæ ¼å¼çš„ç»†èŠ‚; åœ¨å¤„ç†åª’ä½“å…ƒæ•°æ®æ–¹é¢, AV Foundation`æä¾›äº†ä¸€å¥—ç»Ÿä¸€çš„æ–¹æ³•.

#### å…ƒæ•°æ®æ ¼å¼

è™½ç„¶å­˜åœ¨å¤šç§æ ¼å¼çš„åª’ä½“èµ„æº,ä½†æ˜¯æˆ‘ä»¬åœ¨Appleç¯å¢ƒä¸‹é‡åˆ°çš„åª’ä½“ç±»å‹ä¸»è¦æœ‰4ç§, åˆ†åˆ«æ˜¯:`QuickTime(mov)`ã€`MPEG-4 video(mp4å’Œm4v)`ã€`MPEG-4 audio(m4a)`å’Œ`MPEG-Layer â…¢ audio(mp3)`. è™½ç„¶`AV Foundation`å¤„ç†è¿™äº›æ–‡ä»¶ä¸­åµŒå…¥çš„å…ƒæ•°æ®æ—¶éƒ½ä½¿ç”¨ä¸€ä¸ªæ¥å£, ä½†æ˜¯ç†è§£è¿™äº›ä¸åŒç±»å‹èµ„æºçš„å…ƒæ•°æ®å¦‚ä½•å­˜å‚¨åŠå­˜å‚¨ä½ç½®ä»ç„¶å¾ˆæœ‰ä»·å€¼. è¿™é‡Œåªåšæ¦‚è¿°, ä½†æ˜¯å¦‚æœæ·±å…¥ç ”ç©¶è¿™äº›éƒ½æ˜¯å¿…å­¦çš„åŸºç¡€.

1. __QuickTime__
	`QuickTime`æ˜¯è‹¹æœè‡ªå·±å¼€å‘çš„ä¸€ç§è·¨å¹³å°åª’ä½“æ¶æ„, å…¶ä¸­ä¸€éƒ¨åˆ†æ˜¯Quick File Formatè§„èŒƒ, å®šä¹‰äº† .movæ–‡ä»¶çš„å†…éƒ¨ç»“æ„.`QuickTime`æ–‡ä»¶ç”±ä¸€ç§ç§°ä¸º`atom`çš„æ•°æ®ç»“æ„ç»„æˆ. ä¸€èˆ¬è§„åˆ™æ˜¯è¿™æ ·çš„:
	ä¸€ä¸ª`atom`åŒ…å«äº†æè¿°åª’ä½“èµ„æºçš„æŸä¸€æ–¹é¢çš„æ•°æ®, æˆ–è€…åµŒå¥—åŒ…å«å…¶å®ƒ`atom`,ä½†ä¸èƒ½ä¸¤è€…éƒ½åŒ…å«.æœ‰æ—¶å€™è‹¹æœè‡ªå·±çš„æ–¹æ³•å®ç°å¯èƒ½ä¼šè¿èƒŒè¿™ä¸€è§„åˆ™.`atom`ä»¥ä¸€ç§å¤æ‚çš„æ ‘çŠ¶ç»“æ„ç»„åˆåœ¨ä¸€èµ·, è¯¦ç»†çš„å¯¹å¸ƒå±€ã€éŸ³é¢‘æ ·æœ¬æ ¼å¼ã€è§†é¢‘å¸§ä¿¡æ¯ä¹ƒè‡³éœ€è¦å‘ˆç°çš„å…ƒæ•°æ®ä¿¡æ¯(ä½œè€…,ç‰ˆæƒç­‰)åšäº†æè¿°.   

	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/atom.webp)
	*ä¸ºäº†èƒ½è®°ä½`atom`æˆ‘æŠŠå®ƒæˆç§°ä¸º`é˜¿ç«¥æœ¨`å“ˆå“ˆ-è·Ÿé˜¿ç«¥æœ¨å‹æ ¹æ²¡å•¥å…³ç³»*.  
	
	äº†è§£`QuickTime`çš„ä¸€ä¸ªå¥½åŠæ³•æ˜¯ç”¨åå…­è¿›åˆ¶ç¼–è¾‘å™¨ä¸­æ‰“å¼€ä¸€ä¸ª.movæ ¼å¼çš„æ–‡ä»¶.(å¸¸è§çš„åå…­è¿›åˆ¶ç¼–è¾‘å™¨æœ‰Hex Fiendæˆ–Synalyze It! Pro).å…¸å‹çš„åå…­è¿›åˆ¶å·¥å…·ä¼šå°†ä¸€ä¸ªçœŸå®çš„`QuickTime`æ–‡ä»¶çš„æ•°æ®æ˜¾ç¤ºå‡ºæ¥,ä½†å…¶ä¸­çš„ç»“æ„å’Œ`atom`é—´çš„å…³ç³»ä¸æ˜¯å¾ˆç›´è§‚èƒ½ç†è§£,æ¨èè‹¹æœæœ‰ä¸€ä¸ª`Atom Inspector`å·¥å…·.è¿™ä¸ªå·¥å…·å°†atomç»“æ„ä»¥`NSOutlineView`(æ ‘å½¢UIæ§ä»¶ç±»ä¼¼UITableView)æ–¹å¼æ˜¾ç¤º.æ‰€ä»¥`atom`çš„æ ‘å½¢ç“œè¥¿ä¼šå¾ˆæ¸…æ™°çš„çœ‹åˆ°,è¿™ä¸ªå·¥å…·è¿˜æä¾›ä¸€ä¸ªå°å‹çš„åå…­è¿›åˆ¶æŸ¥çœ‹å™¨,å¯ä»¥ä»ä¸­æŸ¥çœ‹åˆ°__å®é™…å­—èŠ‚å¸ƒå±€__.
	
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/AtomInspector.webp)
	
	ä¸‹è½½åœ°å€:[Atom Inspector çŒ›å‡»è¿™é‡Œ](http://adcdownload.apple.com/QuickTime/atom_inspector/atom_inspector.dmg)  è²Œä¼¼éœ€è¦ç™»å½•å¼€å‘è€…å¸å·
	ä¸‹è½½ä¸­å¿ƒ:[è‹¹æœå®˜æ–¹è½¯ä»¶ä¸‹è½½ä¸­å¿ƒ](https://developer.apple.com/download/more/)  è²Œä¼¼éœ€è¦ç™»å½•å¼€å‘è€…å¸å· 
	
	ä¸‹å›¾å°±æ˜¯atomæ ¼å¼
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/QuickTimeAtomStructureNew.webp)
	
	*atomæ ¼å¼*
	
	__`QuickTime`æ–‡ä»¶æœ€å°‘åŒ…å«ä¸‰ä¸ªé«˜çº§çš„`atom`__
	
	* __ç”¨äºæè¿°æ–‡ä»¶ç±»å‹å’Œå…¼å®¹ç±»å‹çš„`fypy`__
	* __åŒ…å«å®é™…éŸ³é¢‘å’Œè§†é¢‘åª’ä½“çš„`mdat`__
	* __moov atom(moo-vee) åª’ä½“èµ„æºçš„æ‰€æœ‰ç»†èŠ‚åšäº†å®Œæ•´æè¿°åŒ…æ‹¬åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®__
	
	ä¸‹å›¾æ˜¯æˆ‘å®é™…æµ‹è¯•ä¸€ä¸ªmovæ–‡ä»¶çš„atom
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/QuickTimeAtomStructureReal.webp)
	*å®æµ‹*
	
	å½“å¤„ç†QuickTimeç”µå½±æ—¶ä¼šé‡åˆ°ä¸¤ç§ç±»å‹çš„å…ƒæ•°æ®. æ ‡å‡†çš„`QuickTime`å…ƒæ•°æ®ç”±`Final Cut Pro X`è¿™æ ·çš„å·¥å…·ç¼–å†™, ä½äº/moov/meta/plistä¸­, å®ƒçš„keyå‡ ä¹éƒ½å…·æœ‰com.apple.quicktimeå‰ç¼€. å…¶å®ƒç±»å‹çš„æ•°æ®è¢«è®¤ä¸ºæ˜¯`QuickTime`ç”¨æˆ·æ•°æ®, ä¿å­˜åœ¨/moov/udta/ä¸­.`QuickTime`ç”¨æˆ·æ•°æ®å¯ä»¥åŒ…å«æ’­æ”¾å™¨éœ€è¦æŸ¥æ‰¾çš„æ ‡å‡†æ•°æ®,eg: æ­Œæ›²çš„æ¼”å”±è€…æˆ–ç‰ˆæƒä¿¡æ¯, é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥åŒ…å«ä»»ä½•å¯¹åº”ç”¨ç¨‹åºæœ‰å¸®åŠ©çš„ä¿¡æ¯.  ä¸Šè¿°ä¸¤ç§å…ƒæ•°æ®ç±»å‹åœ¨	`AV Foundation`ä¸­éƒ½æ˜¯å¯ä»¥è¯»å†™çš„.  
	å¦‚æœæƒ³äº†è§£æ›´å¤š`QuickTime`ç»†èŠ‚å¯ä»¥æŸ¥çœ‹[Quick Time Format Specification](https://developer.apple.com/library/content/documentation/QuickTime/QTFF/QTFFPreface/qtffPreface.html)å®˜æ–¹æ–‡æ¡£(400å¤šé¡µ).  
	æŒæ¡moov atomçš„æ ¸å¿ƒçŸ¥è¯†å¾ˆé‡è¦,æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„äº†è§£`AV Foundation`æ˜¯å¦‚ä½•ä½¿ç”¨è¿™äº›æ•°æ®çš„.
	
2. __MPEG-4 (MP4)éŸ³é¢‘å’Œè§†é¢‘__

	MPEG-4 Part 14æ˜¯å®šä¹‰MP4æ–‡ä»¶æ ¼å¼çš„è§„èŒƒ. `MP4`ç›´æ¥æ´¾ç”Ÿè‡ª`QuickTime`æ–‡ä»¶æ ¼å¼,æ‰€ä»¥`MP4`æ–‡ä»¶æ ¼å¼ä¸`QuickTime`æ–‡ä»¶ç»“æ„å¾ˆç±»ä¼¼. å…¶å®æœ‰æ—¶å€™èƒ½è§£æä¸€ç§æ–‡ä»¶ç±»å‹çš„å·¥å…·ä¹Ÿé€‚ç”¨äºå…¶å®ƒæ–‡ä»¶ç±»å‹.`MP4`æ–‡ä»¶ä¹Ÿç”±æˆä¸º`atom`çš„æ•°æ®ç»“æ„ç»„æˆ.æŠ€æœ¯ä¸Šè®²,`MPEG-4`è§„èŒƒå°†è¿™äº›ç§°ä¸º`boxes`,å› ä¸ºå…¶å¤§éƒ¨åˆ†æ¥è‡ªäº`QuickTime`æ‰€ä»¥å¤§å®¶éƒ½è¿˜æ˜¯æŠŠå®ƒæˆä¸º`atom`.  
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/mp4AtomBook.webp)
	*MPEG-4 atomç»“æ„*
	
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/mp4Atom.webp)
	*MPEG-4 atomç»“æ„ å®æµ‹ç»“æœ*
	
	`MPEG-4`æ–‡ä»¶çš„å…ƒæ•°æ®ä¿å­˜åœ¨`/moov/udat/meta/ilst`ä¸­. å¯¹äº`atom`ä¸­ä½¿ç”¨keyæ²¡æœ‰æ ‡å‡†, å¤§å®¶éƒ½å¢¨å®ˆæˆè§„çš„éµå¾ªè‹¹æœå°šæœªå‘å¸ƒçš„iTuneså…ƒæ•°æ®è§„èŒƒä¸­å¯¹keyçš„å®šä¹‰. è™½ç„¶æ²¡æœ‰æ­£å¼çš„å‘å¸ƒ,ä½†iTuneså…ƒæ•°æ®æ ¼å¼çš„ç›¸å…³æ–‡æ¡£å·²ç»åœ¨ç½‘ä¸Šå¹¿ä¸ºäººçŸ¥äº†(æˆ‘å°±å¾ˆçº³é—· è¿™ç®—æ˜¯å‘äº†ç‰ˆæœ¬è¿˜æ˜¯æ²¡å‘,å‘äº†æ€ä¹ˆè¿˜æ˜¯å°šæœªå…¬å¸ƒ,æ²¡å‘æ€ä¹ˆåˆå¹¿ä¸ºäººçŸ¥...). å¯ä»¥å‚è€ƒ[mp4v2åº“](https://code.google.com/archive/p/mp4v2/wikis/iTunesMetadata.wiki)æ–‡æ¡£äº†è§£æ›´å¤šmp4å†…å®¹.
	
	`mp4`æ˜¯å¯¹MPEG-4åª’ä½“çš„æ ‡å‡†æ‰©å±•.eg: `.m4v`ã€`.m4a`ã€`.m4p`ã€`.m4b`.è¿™äº›å˜ä½“ä½¿ç”¨çš„éƒ½æ˜¯`MPEG-4`å®¹å™¨æ ¼å¼,ä¹Ÿæœ‰äº›åŒ…å«äº†é™„åŠ çš„æ‰©å±•åŠŸèƒ½.  
	å¤§å®¶åªéœ€è¦è®°ä½å‡ ç‚¹:
	* __`M4V`__ æ–‡ä»¶æ˜¯å¸¦æœ‰è‹¹æœå…¬å¸é’ˆå¯¹__`FairPlay`__åŠ å¯†åŠ__`AC3-audio`__æ‰©å±•çš„`MPEG-4`è§†é¢‘æ ¼å¼
	* __`MP4`__ å¦‚æœä¸æ¶‰åŠ`FairPlay`åŠ å¯†åŠ`AC3-audio`æ‰©å±•,`M4V`å°±ä»…ä»…æ˜¯æ‰©å±•åä¸ä¸€æ ·è€Œå·²
	* __`M4A`__ ä¸“é—¨é’ˆå¯¹éŸ³é¢‘,ä½¿ç”¨è¿™ç§æ‰©å±•åçš„ç›®çš„æ˜¯è®©å¤§å®¶çŸ¥é“è¿™ç§æ ¼å¼çš„æ–‡ä»¶åªå¸¦æœ‰éŸ³é¢‘èµ„æº
	* __`M4P`__ è‹¹æœå¾ˆå¤è€çš„iTunesæ ¼å¼,ä½¿ç”¨å…¶`FairPlay`æ‰©å±•
	* __`M4B`__ ç”¨äºæœ‰å£°è¯»ç‰©,åŒçª—åŒ…å«ç« èŠ‚æ ‡ç­¾ä»¥åŠæä¾›ä¹¦ç­¾åŠŸèƒ½,è®©è¯»è€…å¯ä»¥è¿”å›åˆ°æŒ‡å®šä½ç½®å¼€å§‹é˜…è¯»(ç±»ä¼¼æœ‰å£°å°è¯´)
	
3. __MP3__
	
	`MP3`æ–‡ä»¶å’Œ`MPEG-4 (.mp4)`ã€`QuickTime(.mov)`æœ‰æ˜¾è‘—åŒºåˆ«,`MP3`ä¸ä½¿ç”¨å®¹å™¨æ ¼å¼,è€Œä½¿ç”¨__ç¼–ç éŸ³é¢‘æ•°æ®__,æ–‡ä»¶å¼€å¤´é€šå¸¸åŒ…å«å¯é€‰å…ƒæ•°æ®çš„ç»“æ„å—.`mp3`æ–‡ä»¶ä½¿ç”¨ä¸€ç§ç§°ä¸ºID3v2çš„æ ¼å¼æ¥ä¿å­˜å…³äºéŸ³é¢‘å†…å®¹çš„æè¿°ä¿¡æ¯,åŒ…å«: artist(è‰ºæœ¯å®¶)ã€æ¼”å”±è€…ã€album(æ‰€å±ä¸“è¾‘)ã€éŸ³ä¹é£æ ¼ç­‰.  
	`ID3`æ•°æ®å¾ˆeasy,`mp3`å‰10ä¸ªå­—èŠ‚å¸¦æœ‰åµŒå…¥çš„å…ƒæ•°æ®, è¿™10ä¸ªå­—èŠ‚å®šä¹‰äº†`ID3`å—çš„å¤´éƒ¨.10ä¸ªå­—èŠ‚ä¸­çš„å‰ä¸‰ä¸ªå­—èŠ‚å§‹ç»ˆä¸º'49 44 33'(ID3,ç”¨äºè¡¨ç¤ºä¸€ä¸ª`ID3v2æ ‡ç­¾`,åé¢ä¸¤ä¸ªå­—å§ç”¨äºå®šä¹‰ä¸»ç‰ˆæœ¬ä¿¡æ¯,æ—¢`2ã€3ã€4`å’Œç‰ˆæœ¬å·.å‰©ä½™å­—èŠ‚ç”¨äºå®šä¹‰æ ‡å¿—é›†åˆåŠID3å¿«çš„å¤§å°.
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/ID3Header.webp)
	*ID3 header*
	
	`ID3`å—ä¸­å‰©ä¸‹çš„æ•°æ®éƒ½æ˜¯ç”¨äºæè¿°ä¸åŒå…ƒæ•°æ®çš„çš„key-valueé”®å€¼å¯¹çš„å¸§.æ¯ä¸€å¸§éƒ½æœ‰ä¸€ä¸ª__å®é™…æ ‡ç­¾åç§°çš„10å­—èŠ‚çš„å¤´__,ä¹‹åçš„4å­—èŠ‚è¡¨ç¤ºå°ºå¯¸,å†ä¹‹åçš„ä¸¤ä¸ªå­—èŠ‚ç”¨æ¥å®šä¹‰é€‰é¡¹æ ‡å¿—.

	
	 id3 | version(2å­—èŠ‚) | revision (å‰©ä½™å­—èŠ‚)| flag(2å­—èŠ‚)| size(4å­—èŠ‚) |
	
	å¸§å‰©ä¸‹çš„å­—èŠ‚åŒ…å«äº†å®é™…çš„å…ƒæ•°æ®å€¼.å¦‚æœå€¼æ˜¯æ–‡æœ¬ç±»å‹tagä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚åŒ…å«äº†å®é™…çš„å…ƒæ•°æ®å€¼.å¦‚æœå€¼æ˜¯æ–‡æœ¬ç±»å‹,tagä¸­çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ç”¨æ¥å®šä¹‰ç¼–ç ç±»å‹. eg:Ox00, ä»£è¡¨:`ISO-8859=1`,ä¹Ÿæ”¯æŒå…¶å®ƒç±»å‹çš„ç¼–ç ã€‚å¦‚ä¸‹å›¾ID3ç»“æ„ç¤ºæ„å›¾.
	__`AV Foundation`æ”¯æŒè¯»å–`ID3v2`æ ‡ç­¾çš„çš„æ‰€æœ‰ç‰ˆæœ¬, ä½†ä¸æ”¯æŒå†™å…¥.MP3æ ¼å¼æ”¶åˆ°ä¸“åˆ©é™åˆ¶.æ‰€ä»¥`AV Foundation`æ— æ³•æ”¯æŒå¯¹MP3æˆ–ID3æ•°æ®è¿›è¡Œç¼–ç .__ ä¸è¿‡æœ€è¿‘å¬è¯´å¾·å›½çš„MP3ä¸“åˆ©ç ”ç©¶æ‰€è¯´ä¸“åˆ©æ‰“ç®—æ’¤é”€å› ä¸º`AAC`æ ¼å¼å°†æœ‰æ›´å¥½çš„æ•ˆæœç›¸å¯¹äºMP3è€Œè¨€.çœ‹çœ‹åç»­è‹¹æœAPIå˜åŠ¨ä¼šä¸ä¼šå¢åŠ ä¿®æ”¹MP3çš„æ•°æ®å§.
	
	![](/assets/images/20170616LearningAVFoundationAVAssetBasic/ID3Structure.webp)
	*ID3v2 ç»“æ„å›¾*
	
> `AV Foundation`æ”¯æŒæ‰€æœ‰`ID3v2`æ ‡ç­¾æ ¼å¼çš„è¯»å–æ“ä½œ,ä½†æ˜¯`ID3v2`æ˜¯è¦åŠ æ˜Ÿå·çš„.`ID3v2.2`çš„å¸ƒå±€å’Œ`ID3v2.3`åŠä¹‹åç‰ˆæœ¬çš„å¸ƒå±€ä¸åŒ. éœ€è¦æ³¨æ„:æœ‰äº›æ ‡ç­¾ç”±3ä¸ªå­—ç¬¦ç»„æˆ,è€Œä¸æ˜¯4ä¸ªå­—ç¬¦, æ¯”å¦‚ä¸€é¦–æ­Œæ›²çš„æ ‡æ³¨ä¿¡æ¯, å½“æ ‡ç­¾ä¸º`ID3v2.2`æ—¶,æ˜¯è¢«ä¿å­˜åˆ°COMå¸§ä¸­,ä½†å½“åŒä¸€é¦–æ­Œä½¿ç”¨`ID3v2.3`æ ‡ç­¾æˆ–æ›´æ–°ç‰ˆæœ¬çš„æ ‡ç­¾æ—¶,æ­Œæ›²çš„æ ‡æ³¨ä¿¡æ¯ä¼šè¢«ä¿å­˜åœ¨COMMå¸§ä¸­,æ¡†æ¶å®šä¹‰çš„å­—ç¬¦å¸¸é‡åªé€‚ç”¨äº`ID3v2.3`åŠä»¥åç‰ˆæœ¬,åç»­demoä¸­æˆ‘ä»¬é€šè¿‡ä»£ç æ¼”ç¤ºå¦‚ä½•å‘å‰å…¼å®¹`ID3v2.2`.


### __ä½¿ç”¨å…ƒæ•°æ®__


`AVAsset`å’Œ`AVAssetTrack`å¯ä»¥å®ç°æŸ¥è¯¢å…ƒæ•°æ®åŠŸèƒ½  

* `AVAsset` å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šä½¿ç”¨
* `AVAssetTrack` è·å–æ›²ç›®ä¸€çº§å…ƒæ•°æ®

è¯»å–å…·ä½“èµ„æºå…ƒæ•°æ®çš„æ¥å£å¯ä»¥ä½¿ç”¨`AVMetadataItem`ç±»æä¾›çš„æ–¹æ³•è®¿é—®`QuickTime`ã€`MPEG-4 atom`å’Œ`ID3`å¸§ä¸­çš„å…ƒæ•°æ®è¿›è¡Œè®¿é—®. 
`AVAsset`å’Œ`AVAssetTrack`æä¾›äº†ä¸¤ç§æ–¹æ³•å¯ä»¥è·å–ç›¸å…³å…ƒæ•°æ®.ä½†æ˜¯æœ‰å„è‡ªçš„é€‚ç”¨èŒƒå›´.äº†è§£é€‚ç”¨èŒƒå›´ä¹‹å‰é¦–å…ˆè¦çŸ¥é“ __é”®ç©ºé—´__(key space)çš„å«ä¹‰. `AV Foundation`ä½¿ç”¨__é”®ç©ºé—´(key space)__ä½œä¸ºå°†ç›¸å…³é”®ç»„åˆåœ¨ä¸€èµ·çš„æ–¹æ³•, å¯ä»¥å®ç°å¯¹`AVMetadataItem`å®ä¾‹é›†åˆçš„ç­›é€‰.æ¯ä¸ªèµ„æºè‡³å°‘åŒ…å«ä¸¤ä¸ªé”®ç©ºé—´,ä»¥ä¾¿ä»ä¸­è·å–å…ƒæ•°æ®.
![](/assets/images/20170616LearningAVFoundationAVAssetBasic/keyspace.webp)

`Common`é”®ç©ºé—´ç”¨æ¥å®šä¹‰æ‰€æœ‰æ”¯æŒåª’ä½“ç±»å‹çš„é”®, åŒ…æ‹¬: æ›²åã€æ­Œæ‰‹ã€æ’å›¾ä¿¡æ¯ç­‰å¸¸è§å…ƒç´ . è¿™æä¾›äº†ä¸€ç§å¯¹æ‰€æœ‰æ”¯æŒçš„åª’ä½“æ ¼å¼è¿›è¡Œä¸€å®šçº§åˆ«çš„å…ƒæ•°æ®æ ‡å‡†åŒ–è¿‡ç¨‹.æˆ‘ä»¬å¯ä»¥ä»`Common`é”®ç©ºé—´æŸ¥è¯¢ èµ„æºæˆ–è€…æ›²ç›®çš„`commonMetadata`å±æ€§æ¥è·å–å…ƒæ•°æ® è¿™ä¸ªå±æ€§ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å¯ç”¨å…ƒæ•°æ®çš„æ•°ç»„

è®¿é—®æŒ‡å®šæ ¼å¼çš„å…ƒæ•°æ®éœ€è¦åœ¨èµ„æºæˆ–æ›²ç›®ä¸Šè°ƒç”¨`metadataForFormat:`æ–¹æ³•.è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›¸å…³å…ƒæ•°æ®ä¿¡æ¯çš„æ•°ç»„.`AVMetadataFormat.h`ä¸ºä¸åŒçš„å…ƒæ•°æ®æ ¼å¼æä¾›å¯¹åº”çš„å­—ç¬¦ä¸²å¸¸é‡. ç”±äºä¸åŒæ ¼å¼çš„å…ƒæ•°æ®å¯¼è‡´key valueå¯¹åº”ç±»å‹ä¸ä¸€è‡´,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨
`availableMetadataFormats`(AVAssetçš„å±æ€§)è·å–åˆ°ä¿¡æ¯.å¦‚ä¸‹ä»£ç :

``` objc

	NSURL *url = [NSURL fileURLWithPath:@"xxx.mp4"];//ç»™ä¸ªè·¯å¾„åœ°å€
    //åˆ›å»ºå…ƒæ•°æ®
    AVAset *asset = [AVAsset assetWithURL:url];
    NSArray *keys = @[@"availableMetadataFormats"];
    [asset loadValuesAsynchronouslyForKeys:keys completionHandler:^{
        NSMutableArray *metadata = [NSMutableArray array];
        for (NSString *format in asset.availableMetadataFormats){
            [metadata addObjectsFromArray:[asset metadataForFormat:format]];
        }
        
        //å¤„ç†metadata (AVMetadataItems)
    }];


```


### __æŸ¥æ‰¾å…ƒæ•°æ®__

å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªåŒ…å«å…ƒæ•°æ®é¡¹çš„æ•°ç»„(ä¸Šæ–‡ä¸­çš„metadata (AVMetadataItems))æ—¶,æˆ‘ä»¬é€šå¸¸é€šè¿‡éå†å–å‡ºé‡Œé¢çš„æ•°æ®å€¼. å…ƒæ•°æ®(AVAsset)æä¾›ä¸€ä¸ªAVMetadataItemçš„éå†æ–¹æ³•, ä¾‹å¦‚æˆ‘ä»¬ç›¸å¾—åˆ°ä¸€ä¸ªM4Açš„éŸ³é¢‘æ–‡ä»¶æ¼”å¥è€…å’Œå”±ç‰‡çš„å…ƒæ•°æ®. å¦‚ä¸‹:

``` objc

	NSArray *metaData = //AVMetadataItemsæ•°ç»„
    NSString *keySpace = AVMetadataKeySpaceiTunes;
    NSString *artistKey= AVMetadataiTunesMetadataKeyArtist;
    NSString *albumKey = AVMetadataiTunesMetadataKeyAlbum;
    
    NSArray *artistMetadata = [AVMetadataItem metadataItemsFromArray:metaData withKey:artistKey keySpace:keySpace];
    NSArray *albumMetadata = [AVMetadataItem  metadataItemsFromArray:metaData withKey:albumKey keySpace:keySpace];
    
    AVMetadataItem *artistItem, *albumItem;
    
    if (artistMetadata.count > 0) {
        artistItem = artistMetadata[0];
    }
    
    if (albumMetadata.count > 0) {
        albumItem = albumMetadata[0];
    }

```

è¿™é‡Œé€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥æ‹¿å‡ºåŒ¹é…key å’Œ keySpaceçš„æ ‡å‡†å¯¹è±¡ é€šå¸¸æƒ…å†µä¸‹è¿™ä¸ªæ•°ç»„å°±åªæœ‰ä¸€ä¸ªå®ä¾‹å¯¹è±¡

``` objc
+ (NSArray<AVMetadataItem *> *)metadataItemsFromArray:(NSArray<AVMetadataItem *> *)metadataItems withKey:(id)key keySpace:(AVMetadataKeySpace)keySpace;
```


### ä½¿ç”¨AVMetadataItem

AVMetadataItem å¯ä»¥ç†è§£æˆå®ƒæ˜¯ä¸€ä¸ª ä¸“ç”¨äºå…ƒæ•°æ®çš„ å­—å…¸(key: value) ç±»å‹, å”¯ä¸€çš„åŒºåˆ«æ˜¯ å®ƒçš„key æœ‰å¯èƒ½æ˜¯ æ•°å­—(NSNumber), å®ƒæä¾›äº† è½¬ å­—ç¬¦ä¸²(stringValue) å’ŒnumberValueä»¥åŠ dataValue çš„è½¬æ¢  

ä¸¾ä¸ªä¾‹å­ï¼š å¦‚æœè¾“å‡ºçš„keyæ˜¯  145238391  .... æˆ‘è§‰å¾—å¤§å®¶è‚¯å®šä¸çŸ¥é“è¿™ä»£è¡¨å•¥æ„æ€

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ éœ€è¦å¯¹`AVMetadataItem`è¿›è¡Œcategoryæ‰©å±• æŠŠè¿™ç§è¯­ä¹‰ä¸æ¸…æ¥šçš„æ•´å½¢keyæ¢æˆå­—ç¬¦ä¸²çš„keyå°±å¥½ç†è§£äº† ä»£ç å¦‚ä¸‹:

``` objc
#import "AVMetadataItem+Additions.h"

@implementation AVMetadataItem (Additions)

- (NSString *)keyString {
    if ([self.key isKindOfClass:[NSString class]]) {                        // 1
        return (NSString *)self.key;
    }
    else if ([self.key isKindOfClass:[NSNumber class]]) {

        UInt32 keyValue = [(NSNumber *) self.key unsignedIntValue];         // 2
        
        // Most, but not all, keys are 4 characters ID3v2.2 keys are
        // only be 3 characters long.  Adjust the length if necessary.
        
        size_t length = sizeof(UInt32);                                     // 3
        if ((keyValue >> 24) == 0) --length;
        if ((keyValue >> 16) == 0) --length;
        if ((keyValue >> 8) == 0) --length;
        if ((keyValue >> 0) == 0) --length;
        
        long address = (unsigned long)&keyValue;
        address += (sizeof(UInt32) - length);

        // keys are stored in big-endian format, swap
        keyValue = CFSwapInt32BigToHost(keyValue);                          // 4

        char cstring[length];                                               // 5
        strncpy(cstring, (char *) address, length);
        cstring[length] = '\0';

        // Replace 'Â©' with '@' to match constants in AVMetadataFormat.h
        if (cstring[0] == '\xA9') {                                         // 6
            cstring[0] = '@';
        }

        return [NSString stringWithCString:(char *) cstring                 // 7
                                  encoding:NSUTF8StringEncoding];

    }
    else {
        return @"<<unknown>>";
    }
}

@end

```

åŸºç¡€ç¯‡éƒ¨åˆ†è®²è§£åˆ°è¿™é‡Œ ä¸‹ä¸€ç¯‡ ä¼šå†™ä¸ªdemoæ¼”ç¤ºä¸€ä¸‹å…ƒæ•°æ®çš„å„ç§ä¸åŒæ ¼å¼å¦‚ä½•ç»Ÿä¸€è§£æ


å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2017/05/OpenGLglslLanguage/index.html.md
Published At: 2017-05-30 20:32:33 +0000

# OpenGLç¼–ç¨‹è¯­è¨€-glslåŸºç¡€

# å‰è¨€  
![](/assets/images/20170530OpenGLglslLanguage/OpenglVboShaderGlslVaoGPU.webp)

æœ€è¿‘åœ¨ç ”ç©¶OpenGL è¢«å„ç§é™Œç”Ÿçš„åè¯è™æˆç‹—,æ‰€ä»¥è®°å½•ä¸‹æ¥ä¸€äº›å­¦ä¹ çŸ¥è¯†ç‚¹ä¾›å­¦ä¹ å’Œå‚è€ƒ.

## GLSLæ˜¯ä»€ä¹ˆ?

GLSL(OpenGL Shading Language) æ˜¯OpenGLçš„ç€è‰²å™¨è¯­è¨€,çº¯ç²¹çš„å’ŒGPUæ‰“äº¤é“çš„è®¡ç®—æœºè¯­è¨€.å¯ä»¥ç†è§£ä¸ºCçš„å˜ç§ä¸“é—¨é’ˆå¯¹OpenGLç¼–ç¨‹,ä¸æ”¯æŒæŒ‡é’ˆç­‰ç­‰ä¸€äº›Cçš„ç‰¹æ€§ç­‰. (åè¯è§£é‡Š:ç€è‰²å™¨(Shader))  
  
**GPUæ˜¯å¤šçº¿ç¨‹å¹¶è¡Œå¤„ç†å™¨**ï¼ŒGLSLç›´æ¥é¢å‘[å•æŒ‡ä»¤æµå¤šæ•°æ®æµ(SIMD)](https://zh.wikipedia.org/wiki/%E5%8D%95%E6%8C%87%E4%BB%A4%E6%B5%81%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%B5%81)æ¨¡å‹çš„å¤šçº¿ç¨‹è®¡ç®—ã€‚
GLSLç¼–å†™çš„ç€è‰²å™¨å‡½æ•°æ˜¯å¯¹æ¯ä¸ªæ•°æ®åŒæ—¶æ‰§è¡Œçš„ã€‚
æ¯ä¸ªé¡¶ç‚¹éƒ½ä¼šç”±é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„ç®—æ³•å¤„ç†ï¼Œæ¯ä¸ªåƒç´ ä¹Ÿéƒ½ä¼šç”± **ç‰‡æ®µç€è‰²å™¨(ä¹Ÿæœ‰å«ç‰‡å…ƒç€è‰²å™¨)**ä¸­çš„ç®—æ³•å¤„ç†ã€‚
åˆå­¦è€…åœ¨ç¼–å†™è‡ªå·±çš„ç€è‰²å™¨æ—¶ï¼Œéœ€è¦è€ƒè™‘åˆ°SIMDçš„å¹¶å‘ç‰¹æ€§ï¼Œå¹¶ç”¨å¹¶è¡Œè®¡ç®—çš„æ€è·¯æ¥æ€è€ƒé—®é¢˜ è¿™å°±æ˜¯GLSL.

æˆ‘ä»¬æœ€å¸¸è§çš„ç”¨æ³•æ˜¯åœ¨ **é¡¶ç‚¹ç€è‰²å™¨**é‡Œç”Ÿæˆæ‰€éœ€è¦çš„å€¼ï¼Œç„¶åä¼ ç»™ **ç‰‡æ–­ç€è‰²å™¨**ç”¨.

## GLSLèƒ½åšä»€ä¹ˆ

* æ—¥ä»¥é€¼çœŸçš„æè´¨ -- é‡‘å±ï¼Œå²©çŸ³ï¼Œæœ¨å¤´ï¼Œæ²¹æ¼†ç­‰
* æ—¥ç›Šé€¼çœŸçš„å…‰ç…§æ•ˆæœ -- åŒºåŸŸå…‰å’Œè½¯é˜´å½±
* éç°å®æè´¨ -- ç¾æœ¯æ•ˆæœï¼Œé’¢ç¬”ç”»ï¼Œæ°´å¢¨ç”»å’Œå¯¹æ’ç”»æŠ€æœ¯çš„æ¨¡æ‹Ÿ
* é’ˆå¯¹çº¹ç†å†…å­˜çš„æ–°ç”¨é€”
* æ›´å°‘çš„çº¹ç†è®¿é—® 
* å›¾å½¢å¤„ç† -- é€‰æ‹©ï¼Œè¾¹ç¼˜é’åŒ–é®è”½å’Œå¤æ‚æ··åˆ
* åŠ¨ç”»æ•ˆæœ -- å…³é”®å¸§æ’å€¼ï¼Œç²’å­ç³»ç»Ÿ
* ç”¨æˆ·å¯ç¼–ç¨‹çš„åèµ°æ ·æ–¹æ³•


## GLSLæ³¨æ„

* **GLSLæ”¯æŒå‡½æ•°é‡è½½**(å°±æ˜¯çˆ¶ç±»å®šä¹‰æ–¹æ³•,å­ç±»å¤å†™è¯¥æ–¹æ³•å«é‡è½½)
* **GLSLä¸å­˜åœ¨æ•°æ®ç±»å‹çš„è‡ªåŠ¨æå‡(å°±æ˜¯ä¸æ”¯æŒç±»å‹è‡ªåŠ¨å‘ä¸Šè½¬æ¢ eg:float è½¬ double)ï¼Œç±»å‹å¿…é¡»ä¸¥æ ¼ä¿æŒä¸€è‡´.**
* **GLSLä¸æ”¯æŒæŒ‡é’ˆï¼Œå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ï¼Œå®ƒåŸºæœ¬ä¸Šæ˜¯ä¸€ç§å¤„ç†æ•°å­—æ•°æ®çš„è¯­è¨€**
* **GLSLä¸æ”¯æŒè”åˆ(union)ã€æšä¸¾ç±»å‹(enum)ã€ç»“æ„ä½“(stuct)ä½å­—æ®µ(>> or << å·¦å³ç§»)åŠæŒ‰ä½è¿ç®—ç¬¦(| or &è¿™ç§æŒ‰ä½ä¸)**(å°±æ˜¯å¹²æ‰éº»çƒ¦çš„Cæ“ä½œ è®©è¿™ä¸ªæ›´å•çº¯çš„å¤„ç†å›¾å½¢æ•°æ®ä½¿ç”¨)

## GLSLçš„æ•°æ®ç±»å‹

GLSLæœ‰ä¸‰ç§åŸºæœ¬æ•°æ®ç±»å‹: 

* float
* int
* double
* ç”±floatã€intã€doubleç»„æˆçš„array[]æˆ–è€…ç»“æ„ä½“  

``` glsl
42   // åè¿›åˆ¶  
042  // å…«è¿›åˆ¶  
0x2A // åå…­è¿›åˆ¶

```

__**æ³¨æ„:GLSLä¸æ”¯æŒæŒ‡é’ˆ,GLSLæŠŠå‘é‡å’ŒçŸ©é˜µä½œä¸ºåŸºæœ¬æ•°æ®ç±»å‹**__  
[å‘é‡(vector)](http://baike.baidu.com/link?url=XKZL51jLByIFnqrj3vaZ-4cnL-AedjBKiVBcD7pEGQG26Jmb9RYl7QOrX4Mwck-mT0nNlzD8UtzXi4ueVYNGkdO1b2uARr59UAih7ulWRvO):æœ‰èµ·å§‹ä½ç½®æœ‰æ–¹å‘çš„çº¿æ®µ,ä¹Ÿç§°ä½œ **çŸ¢é‡**(ä¸è¦è¢«è¿™äº›åè¯å“åˆ°,æˆ‘è®°å¾—è¿™ä¸ªå‘é‡æ˜¯æˆ‘é«˜äºŒçš„æ—¶å€™æ•°å­¦å­¦çš„ä¸œè¥¿).

## çŸ¢é‡

çŸ¢é‡å¯ä»¥å’Œæ ‡é‡ç”šè‡³çŸ©é˜µåšåŠ å‡ä¹˜é™¤(å¿…é¡»éµå®ˆä¸€å®šè§„åˆ™æ‰å¯ä»¥ å¦åˆ™æŠ¥é”™)

```
vec2,  vec3,  vec4  //åŒ…å«2/3/4ä¸ªæµ®ç‚¹æ•°çš„çŸ¢é‡(æµ®ç‚¹å‹)
ivec2, ivec3, ivec4 //åŒ…å«2/3/4ä¸ªæ•´æ•°çš„çŸ¢é‡(æ•´å½¢æ•° å‰è¾¹å¸¦i ä»£è¡¨integer)
bvec2, bvec3, bvec4 //åŒ…å«2/3/4ä¸ªå¸ƒå°”å€¼çš„çŸ¢é‡(boolä¸ç”¨è§£é‡Š)
```

ä¸Šè¾¹è¿™äº›æ˜¯ä¸€ç§GLSLçš„æ•°æ®ç±»å‹, å¯ä»¥ç®€å•ç†è§£ä¸º `vec+æ•°å­—` å°±ä»£è¡¨ æ˜¯ä¸€ä¸ªæ•°ç»„é‡Œé¢æ”¾å‡ ä¸ªå…ƒç´ (åº”è¯¥éƒ½æ˜¯ vec2~vec4ä¹‹é—´,æ²¡è§è¿‡ vec5ä»¥ä¸Šå’Œvec2ä»¥ä¸‹,å¥½åƒè¿™å°±ä»£è¡¨å‡ ç»´åæ ‡ç³»),é»˜è®¤å…ƒç´ æ˜¯floatæµ®ç‚¹ç±»å‹,å‰è¾¹å¸¦`i`ä»£è¡¨`integer`æ•´å½¢,`b`ä»£è¡¨`bool`.

### vecå¦‚ä½•å£°æ˜ä½¿ç”¨ï¼Ÿ

``` 
vec3 v; 	 //å£°æ˜ä¸‰ç»´æµ®ç‚¹å‹å‘é‡v
v[1] = 3.0;  //ç»™å‘é‡vçš„ç¬¬äºŒä¸ªå…ƒç´ èµ‹å€¼(æ•°ç»„ä»0å¼€å§‹,ä¸‹æ ‡ä¸º1å°±æ˜¯ç¬¬äºŒä¸ªå…ƒç´ )

//ä¸‹é¢ä¸¤ç§ç­‰ä»·
vec3 v = vec3(0.6); //æ•°ç»„æ˜¯è¿ç»­çš„å­˜å‚¨ç©ºé—´ ç›¸å½“äºå…¶å®ƒå…ƒç´ é»˜è®¤è¢«è¿™ä¸ª0.6å€¼å¡«å……
vec3 v = vec3(0.6,0.6,0.6); 
```
> _æ³¨æ„: é™¤äº†ç”¨ç´¢å¼•æ–¹å¼å¤–,è¿˜èƒ½ç”¨é€‰æ‹©è¿ç®—ç¬¦çš„æ–¹å¼æ¥ä½¿ç”¨å‘é‡.æ‹©è¿ç®—ç¬¦æ˜¯å¯¹äºå‘é‡çš„å„ä¸ªå…ƒç´ ï¼ˆæœ€å¤šä¸º4ä¸ªï¼‰çº¦å®šä¿—æˆçš„åç§°ï¼Œç”¨ä¸€ä¸ªå°å†™æ‹‰ä¸å­—æ¯æ¥è¡¨ç¤ºã€‚æ ¹æ®å‘é‡è¡¨ç¤ºå¯¹è±¡çš„æ„ä¹‰ä¸åŒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€‰æ‹©è¿ç®—ç¬¦:_  
 
* è¡¨ç¤ºé¡¶ç‚¹å¯ä»¥ç”¨ (xã€yã€zã€w)  (åæ ‡ç³»)
* è¡¨ç¤ºé¢œè‰²å¯ä»¥ç”¨ (rã€gã€bã€a)  (é¢œè‰²å€¼å¸¦é€æ˜)
* è¡¨ç¤ºçº¹ç†åæ ‡ç”¨ (sã€tã€pã€q)    
ä¸‰ç§ä»»é€‰ä¸€ç§éƒ½ä¸€æ ·,ä½œç”¨éƒ½æ˜¯ç­‰æ•ˆçš„. ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœ`v`æ˜¯ä¸€ä¸ªå‘é‡ï¼Œé‚£ä¹ˆ:  
* `v[0]`
* `v.x`
* `v.r`
* `v.s`  
éƒ½æŒ‡çš„æ˜¯å‘é‡vçš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚  
ä¾‹å¦‚:

``` glsl
//ç”¨æ„é€ å‡½æ•°çš„æ–¹å¼å£°æ˜å¹¶åˆå§‹åŒ–å››ç»´æµ®ç‚¹å‹
vec4 v1 = vec4(1.0, 2.0, 3.0, 4.0); 
vec4 v2;  
v2.xy=v1.yz;  //å°†v1çš„ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå…ƒç´ å¤åˆ¶åˆ°v2çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå…ƒç´ 
v2.z=2.0;  	  //ç»™v2çš„ç¬¬ä¸‰ä¸ªå…ƒç´ èµ‹å€¼  
v2.xy=v1.yx;  //å°†v1çš„å¤´ä¸¤ä¸ªå…ƒç´ äº’æ¢ï¼Œå†å¤åˆ¶åˆ°v2çš„å¤´ä¸¤ä¸ªå…ƒç´ ä¸­
```

## çŸ©é˜µ(matrix) 
	
çŸ©é˜µ(matrix)ä»¥ä¸‹ç±»å‹éƒ½ä»¥matå¼€å¤´

* `mat2` ä»£è¡¨2x2çš„çŸ©é˜µ
* `mat3` ä»£è¡¨3x3çš„çŸ©é˜µ
* `mat4` ä»£è¡¨4x4çš„çŸ©é˜µ  
_**æ³¨æ„:çŸ©é˜µæ˜¯æŒ‰åˆ—é¡ºåºç»„ç»‡çš„ï¼Œå…ˆåˆ—åè¡Œ**_

å¦‚ä¸‹ä»£ç :

``` glsl
mat4 m;		 //å£°æ˜å››ç»´æµ®ç‚¹å‹æ–¹é˜µm  
m[2][3]=2.0; //ç»™æ–¹é˜µçš„ç¬¬ä¸‰åˆ—ã€ç¬¬å››è¡Œå…ƒç´ èµ‹å€¼ 

// ä¸‹é¢ä¸¤ç§ç­‰ä»·ï¼Œåˆå§‹åŒ–çŸ©é˜µå¯¹è§’
mat2 m = mat2(1.0)
mat2 m = mat2(1.0, 0.0, 0.0, 1.0);

```

## å–æ ·å™¨(Sampler)

çº¹ç†æŸ¥æ‰¾éœ€è¦åˆ¶å®šå“ªä¸ªçº¹ç†æˆ–è€…çº¹ç†å•å…ƒå°†åˆ¶å®šæŸ¥æ‰¾.

``` glsl
sampler1D        // è®¿é—®ä¸€ä¸ªä¸€ç»´çº¹ç†
sampler2D        // è®¿é—®ä¸€ä¸ªäºŒç»´çº¹ç†           
sampler3D        // è®¿é—®ä¸€ä¸ªä¸‰ç»´çº¹ç†
samplerCube      // è®¿é—®ä¸€ä¸ªç«‹æ–¹è´´å›¾çº¹ç†
sampler1DShadow  // è®¿é—®ä¸€ä¸ªå¸¦å¯¹æ¯”çš„ä¸€ç»´æ·±åº¦çº¹ç†
sampler2DShadow  // è®¿é—®ä¸€ä¸ªå¸¦å¯¹æ¯”çš„äºŒç»´æ·±åº¦çº¹ç†
```

``` glsl
uniform sampler2D grass;

vcc2 coord = vec2(100, 100);
vec4 color = texture2D(grass, coord);
```

å¦‚æœä¸€ä¸ªç€è‰²å™¨åœ¨ç¨‹åºé‡Œç»“åˆå¤šä¸ªæ–‡ç†, å¯ä»¥ä½¿ç”¨å–æ ·å™¨æ•°ç»„.

``` glsl
const int tex_nums = 4;
uniform sampler2D textures[tex_nums];

for(int i = 0; i < tex_nums; ++i) {
    sampler2D tex = textures[i];
    // todo ...
}
```

## ç»“æ„ä½“

è¿™æ˜¯å”¯ä¸€çš„ç”¨æˆ·èƒ½ç”¨çš„è‡ªå®šä¹‰ç±»å‹  

``` glsl
struct light  
{  
    vec3 position;  
    vec3 color;  
};  

light ceiling_light;
```

## æ•°ç»„

æ•°ç»„ç´¢å¼•æ˜¯ä»0å¼€å§‹çš„ï¼Œè€Œä¸”æ²¡æœ‰æŒ‡é’ˆæ¦‚å¿µ

``` glsl
// åˆ›å»ºä¸€ä¸ª10ä¸ªå…ƒç´ çš„æ•°ç»„  
vec4 points[10];  

// åˆ›å»ºä¸€ä¸ªä¸æŒ‡å®šå¤§å°çš„æ•°ç»„
vec4 points[]; 
points[2] = vec4(1.0);  // pointsç°åœ¨å¤§å°ä¸º3
points[7] = vec4(2.0);  // pointsç°åœ¨å¤§å°ä¸º8

```

## void

åªèƒ½ç”¨äºå£°æ˜å‡½æ•°è¿”å›å€¼

## ç±»å‹è½¬æ¢

å¿…é¡»æ˜ç¡®åœ°è¿›è¡Œç±»å‹è½¬æ¢ï¼Œä¸ä¼šè‡ªåŠ¨ç±»å‹æå‡

``` glsl
float f = 2.3; 
bool b = bool(f); // b is true
```

## é™å®šç¬¦

**GLSLä¸­æœ‰4ä¸ªé™å®šç¬¦ï¼ˆvariable qualifiersï¼‰å¯ä¾›ä½¿ç”¨ï¼Œå®ƒä»¬é™å®šäº†è¢«æ ‡è®°çš„å˜é‡ä¸èƒ½è¢«æ›´æ”¹çš„"èŒƒå›´".**

* `const`
* `attribute`
* `uniform`
* `varying`  

`const`: å’ŒC++é‡Œå·®ä¸å¤šï¼Œå®šä¹‰ä¸å¯å˜å¸¸é‡
è¡¨ç¤ºé™å®šçš„å˜é‡åœ¨ç¼–è¯‘æ—¶ä¸å¯è¢«ä¿®æ”¹.

`attribute`:æ˜¯åº”ç”¨ç¨‹åºä¼ ç»™é¡¶ç‚¹ç€è‰²å™¨ç”¨çš„  
ä¸å…è®¸å£°æ˜æ—¶åˆå§‹åŒ–  

`attribute`é™å®šç¬¦æ ‡è®°çš„æ˜¯ä¸€ç§å…¨å±€å˜é‡,è¯¥å˜é‡åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­æ˜¯åªè¯»ï¼ˆread-onlyï¼‰çš„ï¼Œè¯¥å˜é‡è¢«ç”¨ä½œä»OpenGLåº”ç”¨ç¨‹åºå‘é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¼ é€’å‚æ•°ï¼Œå› æ­¤è¯¥é™å®šç¬¦ä»…èƒ½ç”¨äºé¡¶ç‚¹ç€è‰²å™¨. 

```
attributeå˜é‡æ˜¯åªèƒ½åœ¨vertex shaderä¸­ä½¿ç”¨çš„å˜é‡
å®ƒä¸èƒ½åœ¨fragment shaderä¸­å£°æ˜attributeå˜é‡ï¼Œ
ä¹Ÿä¸èƒ½è¢«fragment shaderä¸­ä½¿ç”¨ï¼‰
åœ¨applicationä¸­ï¼Œä¸€èˆ¬ç”¨å‡½æ•°glBindAttribLocationï¼ˆï¼‰æ¥ç»‘å®šæ¯ä¸ªattributeå˜é‡çš„ä½ç½®ï¼Œç„¶åç”¨å‡½æ•°
glVertexAttribPointerï¼ˆï¼‰ä¸ºæ¯ä¸ªattributeå˜é‡èµ‹å€¼ã€‚
ä»¥ä¸‹æ˜¯ä¾‹å­ï¼š
uniform mat4 u_matViewProjection;
attribute vec4 a_position;
attribute vec2 a_texCoord0;
varying vec2 v_texCoord;
void main(void)
{
  gl_Position = u_matViewProjection * a_position;
  v_texCoord = a_texCoord0;
}


```


`uniform`:ä¸€èˆ¬æ˜¯åº”ç”¨ç¨‹åºç”¨äºè®¾å®šé¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ–­ç€è‰²å™¨ç›¸å…³åˆå§‹åŒ–å€¼.ä¸å…è®¸å£°æ˜æ—¶åˆå§‹åŒ–.`uniform`é™å®šç¬¦æ ‡è®°çš„æ˜¯ä¸€ç§å…¨å±€å˜é‡,è¯¥å˜é‡å¯¹äºä¸€ä¸ªå›¾å…ƒï¼ˆ`primitive`ï¼‰æ¥è¯´æ˜¯ä¸å¯æ›´æ”¹çš„ å®ƒå¯ä»¥ä»`OpenGL`åº”ç”¨ç¨‹åºä¸­æ¥æ”¶ä¼ é€’æ¥çš„å‚æ•°  

``` 
uniformå˜é‡ å¤–éƒ¨ç¨‹åºä¼ é€’ç»™shaderçš„å˜é‡.
å‡½æ•°glUniform**ï¼ˆï¼‰å‡½æ•°èµ‹å€¼çš„.
shader ä¸­æ˜¯åªè¯»å˜é‡,ä¸èƒ½è¢« shader ä¿®æ”¹.
uniformå˜é‡ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºï¼šå˜æ¢çŸ©é˜µï¼Œæè´¨ï¼Œå…‰ç…§å‚æ•°å’Œé¢œè‰²ç­‰ä¿¡æ¯ã€‚
uniform mat4 viewProjMatrix; //æŠ•å½±+è§†å›¾çŸ©é˜µ
uniform mat4 viewMatrix;        //è§†å›¾çŸ©é˜µ
uniform vec3 lightPosition;     //å…‰æºä½ç½®

```

`varying`:ç”¨äºä¼ é€’é¡¶ç‚¹ç€è‰²å™¨çš„å€¼ç»™ç‰‡æ–­ç€è‰²å™¨.å®ƒæä¾›äº†ä»é¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡æ®µç€è‰²å™¨ä¼ é€’æ•°æ®çš„æ–¹æ³•ï¼Œvaryingé™å®šç¬¦å¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®šä¹‰å˜é‡ï¼Œç„¶åå†ä¼ é€’ç»™å…‰æ …åŒ–å™¨ï¼Œå…‰æ …åŒ–å™¨å¯¹æ•°æ®æ’å€¼åï¼Œå†å°†æ¯ä¸ªç‰‡æ®µçš„å€¼äº¤ç»™ç‰‡æ®µç€è‰²å™¨.

``` 
varyingå˜é‡æ˜¯vertexå’Œfragment shaderä¹‹é—´åšæ•°æ®ä¼ é€’ç”¨çš„ã€‚
ä¸€èˆ¬vertex shaderä¿®æ”¹varyingå˜é‡çš„å€¼ï¼Œ
ç„¶åfragment shaderä½¿ç”¨è¯¥varyingå˜é‡çš„å€¼ã€‚
å› æ­¤varyingå˜é‡åœ¨vertexå’Œfragment shaderäºŒè€…ä¹‹é—´çš„å£°
æ˜å¿…é¡»æ˜¯ä¸€è‡´çš„ã€‚
applicationä¸èƒ½ä½¿ç”¨æ­¤å˜é‡ã€‚
ä»¥ä¸‹æ˜¯ä¾‹å­ï¼š
// Vertex shaderuniform 
mat4 u_matViewProjection;
attribute vec4 a_position;
attribute vec2 a_texCoord0;
varying vec2 v_texCoord; // Varying in vertex shader
void main(void)
{  
  gl_Position = u_matViewProjection * a_position;
  v_texCoord = a_texCoord0;
}
// Fragment shaderprecision 
mediump float;
varying vec2 v_texCoord; // Varying in fragment shader
uniform sampler2D s_baseMap;
uniform sampler2D s_lightMap;
void main()
{
  vec4 baseColor;
  vec4 lightColor;
  baseColor = texture2D(s_baseMap, v_texCoord);
  lightColor = texture2D(s_lightMap, v_texCoord);
  gl_FragColor = baseColor * (lightColor + 0.25);
}


```

_**æ³¨æ„:ä»¥ä¸Šè¿™å‡ ç§é™å®šç¬¦å¾ˆé‡è¦**_

## é™åˆ¶æ€§

* ä¸èƒ½åœ¨if-elseä¸­å£°æ˜å˜é‡
* ç”¨äºåˆ¤æ–­çš„æ¡ä»¶å¿…é¡»æ˜¯boolç±»å‹(if,while,for...)
* (?:)æ“ä½œç¬¦åä¸¤ä¸ªå‚æ•°å¿…é¡»ç±»å‹ç›¸åŒ
* ä¸æ”¯æŒswitchè¯­å¥  

``` glsl
vec4 toonify(in float intensify) 
{
    vec4 color;
    color = vec4(0.8,0.8,0.8,0.8)
    return color;
}
```

## discard

`discard`å…³é”®å­—å¯ä»¥é¿å…ç‰‡æ®µæ›´æ–°å¸§ç¼“å†²åŒºï¼Œå½“æµæ§åˆ¶é‡åˆ°è¿™ä¸ªå…³é”®å­—æ—¶ï¼Œæ­£åœ¨å¤„ç†çš„ç‰‡æ®µå°±ä¼šè¢«æ ‡è®°ä¸ºä¸¢.

å¦‚æœä¸ç†è§£ä»€ä¹ˆå«æ ‡è®°ä¸ºä¸¢ å¯ä»¥å‚è€ƒä¸€ä¸‹[UIViewçš„ç»˜åˆ¶è¿‡ç¨‹](ç†è§£UIViewçš„ç»˜åˆ¶)

## å‡½æ•°

* å‡½æ•°åå¯ä»¥é€šè¿‡å‚æ•°ç±»å‹é‡è½½ï¼Œä½†æ˜¯å’Œè¿”å›å€¼ç±»å‹æ— å…³
* æ‰€æœ‰å‚æ•°å¿…é¡»å®Œå…¨åŒ¹é…ï¼Œå‚æ•°ä¸ä¼šè‡ªåŠ¨
* å‡½æ•°ä¸èƒ½è¢«é€’å½’è°ƒç”¨
* å‡½æ•°è¿”å›å€¼ä¸èƒ½æ˜¯æ•°ç»„

å‡½æ•°å‚æ•°æ ‡è¯†ç¬¦  

* `in`: è¿›å¤åˆ¶åˆ°å‡½æ•°ä¸­ï¼Œä½†ä¸è¿”å›çš„å‚æ•°(é»˜è®¤)
* `out`: ä¸å°†å‚æ•°å¤åˆ¶åˆ°å‡½æ•°ä¸­ï¼Œä½†è¿”å›å‚æ•°
* `inout`: å¤åˆ¶åˆ°å‡½æ•°ä¸­å¹¶è¿”å› 

## æ··åˆæ“ä½œ

é€šè¿‡åœ¨é€‰æ‹©å™¨(.)ååˆ—å‡ºå„åˆ†é‡åï¼Œå°±å¯ä»¥é€‰æ‹©è¿™äº›åˆ†é‡

``` glsl
vec4 v4;
v4.rgba;    // å¾—åˆ°vec4
v4.rgb;     // å¾—åˆ°vec3
v4.b;       // å¾—åˆ°float
v4.xy;      // å¾—åˆ°vec2
v4.xgba;    // é”™è¯¯ï¼åˆ†é‡åä¸æ˜¯åŒä¸€ç±»

v4.wxyz;    // æ‰“ä¹±åŸæœ‰åˆ†é‡é¡ºåº
v4.xxyy;    // é‡å¤åˆ†é‡
```

æœ€åæ¨èä¸€ä¸ªGLSLç¼–è¾‘è°ƒè¯•å·¥å…·[OpenGL Shader Builder(Graphics Tools.dmg)](http://adcdownload.apple.com/Developer_Tools/Graphics_Tools_for_Xcode_7.2/Graphics_Tools_for_Xcode_7.2.dmg)


# æ€»ç»“:

ç”±äºæœ¬äººè®°æ€§ä¸å¥½ä½¿ æ‰¾ä¸œè¥¿æœ‰æ—¶å€™æ€»æ‰¾ä¸åˆ° æŠŠä¸€äº› åè¯çŸ¥è¯†ç‚¹æ”¶å½•å‡ºæ¥å¹¶åŠ ä»¥è§£é‡Š æ–¹ä¾¿åæ¥çš„å­¦ä¹ è€…å­¦ä¹ .


å‚è€ƒ:  
[GLSLåŸºç¡€](http://www.cnblogs.com/luweimy/p/4208570.html?utm_source=tuicool&utm_medium=referral)

[iOSå¼€å‘-OpenGL ESå…¥é—¨æ•™ç¨‹2](http://www.jianshu.com/p/ee597b2bd399)  

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/05/NSTableRowViewMouseTrackColor/index.html.md
Published At: 2017-05-10 15:24:20 +0000

# è‡ªå®šä¹‰NSTableRowViewå®ç°é¼ æ ‡è·Ÿè¸ªåŠ¨æ€æ˜¾ç¤ºé€‰ä¸­/éé€‰ä¸­é¢œè‰²

``` objc
#import "BDRowView.h"


#define k_NORMAL_COLOR [NSColor colorFromInt:0xfcfdfe]
#define k_SELECTED_COLOR [NSColor colorFromInt:0xeff1f3]

@interface BDRowView ()
@property(strong) NSTrackingArea *trackingArea;
@property(assign) BOOL isHovering;
@end

@implementation BDRowView

- (void)drawRect:(NSRect)dirtyRect {
    [super drawRect:dirtyRect];
}


- (void)drawSelectionInRect:(NSRect)dirtyRect {
    if (self.selectionHighlightStyle != NSTableViewSelectionHighlightStyleNone) {
        NSRect selectionRect = NSInsetRect(self.bounds, 0, 0);
        [k_SELECTED_COLOR setStroke];
        [k_SELECTED_COLOR setFill];
        NSBezierPath *selectionPath = [NSBezierPath bezierPathWithRoundedRect:selectionRect xRadius:0 yRadius:0];
        [selectionPath fill];
        [selectionPath stroke];
    }
}

-(void)updateTrackingAreas
{
    if(self.trackingArea != nil) {
        [self removeTrackingArea:self.trackingArea];
    }
    
    int opts = (NSTrackingMouseEnteredAndExited | NSTrackingMouseMoved | NSTrackingActiveAlways);
    self.trackingArea = [ [NSTrackingArea alloc] initWithRect:[self bounds]
                                                      options:opts
                                                        owner:self
                                                     userInfo:nil];
    [self addTrackingArea:self.trackingArea];
}

- (void)mouseEntered:(NSEvent *)theEvent {
    self.isHovering = YES;
    [self setBackgroundColor:[self getBackgroundColor:YES]];
}

- (void)mouseExited:(NSEvent *)theEvent {
    self.isHovering = NO;
    [self setBackgroundColor:[self getBackgroundColor:NO]];
}

-(NSColor*)getBackgroundColor:(BOOL)isSelected
{
    if(isSelected) {
        return k_SELECTED_COLOR;
    }else{
        return k_NORMAL_COLOR;
    }
}

@end
```



URL: https://sunyazhou.com/2017/05/HowToCreateSymbolicLinkOnMacosInCode/index.html.md
Published At: 2017-05-09 17:41:17 +0000

# å¦‚ä½•åœ¨macOS/MAC OS Xä¸Šåˆ›å»ºæ›¿èº«æ–‡ä»¶

![](/assets/images/20170509HowToCreateSymbolicLinkOnMacosInCode/symboliclink.webp)

### å‰è¨€

ç†Ÿæ‚‰WIN å¼€å‘çš„åŒå­¦ä¸€å®šå¾ˆç†Ÿæ‚‰å¿«æ·æ–¹å¼,åœ¨macOSä¸Šå«åšæ›¿èº« æœ€è¿‘å¼€å‘æ’ä»¶ç›¸å…³é€»è¾‘ å‘ç°éœ€è¦æŠŠæ’ä»¶å¤åˆ¶åˆ°æŒ‡å®šç›®å½•æ‰€ä»¥æœ‰äº†æ­¤æ–‡


### è½¯è¿æ¥

å¦‚æœä½ æ·±åˆ»çš„ç†è§£äº†å†…å­˜ç®¡ç†çš„åŸç†ï¼Œè½¯è¿æ¥å°±å¦‚åŒå†…å­˜ç®¡ç†ä¸­çš„â€œæŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆâ€ï¼Œè½¯è¿æ¥æœ¬è´¨å°±æ˜¯æŒ‡å‘ç¡¬è¿æ¥çš„ä¸€ä¸ªåœ°å€ï¼Œè‡ªç„¶å®ƒä¹Ÿåªä¼šå¯¹è¿™ä¸€ä¸ªç¡¬è¿æ¥æœ‰æ•ˆï¼Œä¸€æ—¦è½¯è¿æ¥æ‰€æŒ‡å‘çš„ç¡¬è¿æ¥è¢«åˆ é™¤ï¼Œè½¯è¿æ¥ä¹Ÿå°±å¤±æ•ˆäº†ã€‚å½“ç„¶è¿™ä¸â€æŒ‡é’ˆçš„æŒ‡é’ˆâ€ä¹Ÿæœ‰ä¸€ä¸ªå¾ˆå¾®å¦™çš„å·®åˆ«ï¼Œé‚£å°±æ˜¯ä½ å¯¹è½¯é“¾æ¥çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è·³è½¬åˆ°ç¡¬è¿æ¥å†æ˜ å°„åˆ°äº†å¯¹èŠ‚ç‚¹çš„æ“ä½œ


åˆ›å»ºè½¯é“¾æ¥å¯ä»¥ä½¿ç”¨`NSFileManager`ä¸­çš„ä¸¤ä¸ªæ–¹æ³•:

``` objc
- (BOOL)createSymbolicLinkAtPath:(NSString *)path withDestinationPath:(NSString *)destPath error:(NSError **)error ;
- (BOOL)createSymbolicLinkAtURL:(NSURL *)url withDestinationURL:(NSURL *)destURL error:(NSError **)error;

```

### ä½¿ç”¨åœºæ™¯ 

æœ€è¿‘åœ¨å¼€å‘æ’ä»¶ éœ€è¦æŠŠæ’ä»¶ä»å·¥ç¨‹ç›®å½• copyåˆ° ç³»ç»Ÿçš„æ’ä»¶ç›®å½•`~/Library/Internet Plug-Ins/` ([è¿™é‡Œç”¨äº†è€è°­çš„æ’ä»¶ä¸¾ä¾‹](http://www.tanhao.me/pieces/1084.html/))


å¦‚ä¸‹å›¾:
![](/assets/images/20170509HowToCreateSymbolicLinkOnMacosInCode/step1.webp)

æœ¬æƒ³æŠŠå®ƒç›´æ¥copyè¿‡å», ä½†å¯èƒ½å­˜åœ¨ä»¥åå‡çº§é—®é¢˜,åç»­åˆ¤æ–­å„ç§ç‰ˆæœ¬ åˆ é™¤æ—§çš„ç‰ˆæœ¬é€»è¾‘å¤„ç†æ¯”è¾ƒéº»çƒ¦,äºæ˜¯æƒ³åˆ°ç”¨æ›¿èº«çš„æ–¹å¼å®ç°

![](/assets/images/20170509HowToCreateSymbolicLinkOnMacosInCode/step2.webp)

ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºæ›¿èº«:

``` objc
    //å·¥ç¨‹ç›®å½•æ–‡ä»¶
    NSString *homePath = [[NSBundle mainBundle] pathForResource:@"NPAPI_Download_Plugin" ofType:@"plugin"];
    //æ’ä»¶åœ¨ç³»ç»Ÿçš„ç›®å½•ä½ç½®
    NSString *strHome = [NSString stringWithUTF8String:getenv("HOME")];
    NSString *desc = [NSString stringWithFormat:@"%@/Library/Internet Plug-Ins/NPAPI_Download_Plugin.plugin",strHome];
    NSFileManager *fm = [NSFileManager defaultManager];
    //åˆ›å»ºæ›¿èº«ä»£ç 
    [fm createSymbolicLinkAtPath:desc withDestinationPath:homePath error:nil];  
    
```

*æ³¨æ„:`createSymbolicLinkAtPath:withDestinationPath:error:`æ–¹æ³• ç¬¬ä¸€ä¸ªå‚æ•°`LinkAtPath`æ˜¯`desc`,å®ƒæ˜¯æ”¾æ›¿èº«æ–‡ä»¶çš„ä½ç½®. ç¬¬äºŒä¸ªå‚æ•°`DestinationPath`æ˜¯`homePath`ä»£è¡¨æœ¬åœ°æ–‡ä»¶çš„åŸå§‹è·¯å¾„,è¿™é‡Œç”¨å·¥ç¨‹ç›®å½•çš„æ–‡ä»¶æ˜¯ä¸ºäº†æ–¹ä¾¿,åˆ‡è®°ä¸è¦å’Œ copyItemæ–¹æ³•ææ··*


![](/assets/images/20170509HowToCreateSymbolicLinkOnMacosInCode/step3.webp)


### æ€»ç»“

ä¸»è¦æ¶‰åŠçš„ä¸€äº›macOSå¼€å‘æŠ€å·§, å¸Œæœ›ä¸è¶³ä¹‹å¤„å¤§å®¶å¤šå¤šæŒ‡æ•™.

å‚è€ƒ:[è¯¦è§£OSX(Unix)ä¸­çš„Hard Linkä¸Symbolic Link(ç¡¬è¿æ¥ä¸è½¯è¿æ¥)](http://www.tanhao.me/pieces/597.html/)

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/04/CmputerScienceAndTechnologyClassic/index.html.md
Published At: 2017-04-29 09:15:21 +0000

# å‘å¾€è®¡ç®—æœºç§‘å­¦ç›¸å…³ä¸“ä¸šçš„å¿…å­¦ç»å…¸

![](/assets/images/20170429CmputerScienceAndTechnologyClassic/album.webp)

# å‰è¨€
> æ— è®ºæ˜¯ä½•æ—¶æ¯•ä¸š,ä½•æ—¶å‚åŠ å·¥ä½œ,æˆ‘çš„è¿™ç¯‡æ–‡ç« å°†æ˜¯å¤§å®¶è¿ˆè¿›å¤§å­¦æ ¡é—¨ä¹‹å‰æˆ–è€…è¿‡ç¨‹ä¸­èä¸¾ä¹‹ç« . __å­¦ä¹ å¥½ä¸€å®šè¦åšæŒä¸‹å»,å­¦ä¹ ä¸å¥½å¹¶ä¸ä»£è¡¨ä»¥åæ²¡æœ‰æœºä¼š__, å¦‚æœä½ å¤§å­¦æƒ³å­¦çš„æ˜¯è®¡ç®—æœºç›¸å…³ä¸“ä¸š,æˆ‘å¯ä»¥æŠŠæˆ‘ä¹‹æ‰€å­¦å’Œå¿…å¤‡çš„ä¸€äº›å­¦ä¹ è£…å¤‡åˆç›˜æ‰˜å‡ºæ¯«æ— ä¿ç•™çš„å‘Šè¯‰ä½ , å¹¶åˆ‡èƒ½èŠ‚çœå¤§éƒ¨åˆ†å­¦ä¹ å¼€æ”¯.


# è®¡ç®—æœºä¸“ä¸šå­¦ä¹ è·¯çº¿


[è®¡ç®—æœºä¸“ä¸šå­¦ä¹ è·¯çº¿](https://hackway.org/docs/cs/intro)  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/learnCSLine.webp)


æ®è¯´ç«™é•¿æ˜¯åŒ—å¤§å­¦ç”Ÿï¼Œå‚è€ƒç¾å›½åæ ¡çš„è®¡ç®—æœºåŸ¹å…»æ–¹æ¡ˆï¼Œæ•´ç†çš„è®¡ç®—æœºä¸“ä¸šå­¦ä¹ è·¯çº¿ã€‚

ä¸Šè¾¹çš„æ‰æ˜¯æœ€è¿‘æ›´æ–°å­¦ä¹ è®¡ç®—æœºè¯¾ç¨‹çš„æ­£è§£,2023/06/30æ›´æ–°â†‘â†‘â†‘.



## ä¸»è¦åˆ†3ä¸ªæ–¹é¢

* ä¹¦ç±
* æŠ€æ³•
* è£…å¤‡


### ä¹¦ç±
é¦–å…ˆæ¥è¯´ ä¹¦ç± å¤§å­¦è®¡ç®—æœºå¿…é¡»çš„åŸºæœ¬ç»å…¸ä¹¦ç±

* [Cè¯­è¨€ç¨‹åºè®¾è®¡ è°­æµ©å¼º](http://baike.baidu.com/link?url=rVNBy5FqKGq6YBb22T6Sj0IrRCeFj_SKf9QLjV7avP1cXIelBdhMza-y9Xu4fBHk0ynNI-RiFxbGySk68agqb1zrrQ2xPBZO9-WiqQe3AJy8IHEtHGBWGnxcwJlf77xiVaN3VdvdSn9_OaHodVRmuSl8MbPLBh5e0JzEhE0ikuNIGivWRklNzsL2WTD6WOJT) __å¿…å­¦__  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/CLanguage.webp)

* [æ¸…åå¤§å­¦è®¡ç®—æœºç³»åˆ—æ•™æï¼šæ•°æ®ç»“æ„ï¼ˆCè¯­è¨€ç‰ˆï¼‰](https://item.jd.com/11076338.html) __å¿…å­¦__  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/DataStructure.webp)

* [é¸Ÿå“¥çš„Linuxç§æˆ¿èœ ï¼ˆåŸºç¡€å­¦ä¹ ç¯‡ ç¬¬ä¸‰ç‰ˆï¼‰](https://item.jd.com/10064429.html) __å¿…å­¦__  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/linux.webp) 

*[Linux Torvaldsåšå®¢](https://github.com/torvalds)*

* [C++](https://item.jd.com/11017238.html)  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/Cplusplus.webp)

* Git   
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/git.webp)

* æ•°æ®åº“  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/sqlite.webp)  

> è¿™ä¸ªå¾ˆé‡è¦å¯ä»¥ç®€å•ç†è§£æˆexcelè¡¨æ ¼åªä¸è¿‡æ˜¯ä»¥æ–‡ä»¶å­˜å‚¨æ•°æ®çš„æ–‡ä»¶. eg:sqlite sql server

ä»¥ä¸Šçš„ä¹¦å¯ä»¥ä¹°çº¸è´¨çš„,è‡³äº pythonã€javaã€jsã€nodejsã€æœºå™¨å­¦ä¹ ç›¸å…³çš„å¤§å®¶å¯ä»¥ä¸å¿…ä¹°ä¹¦.ä½†è€ƒè™‘å¤§å®¶è¿˜æ˜¯å¾ˆæ½¦å€’çš„ å¯ä»¥ä»ç½‘ä¸Šä¸‹è½½ç”µå­ç‰ˆå­¦ä¹ æ˜¯ä¸€æ ·çš„. æ¯”å¦‚ibook(è‹¹æœç”µè„‘ä¸Šçš„epubæ ¼å¼) kindle(moboæ ¼å¼) è¿˜æœ‰pdfå¸¸ç”¨çš„æ ¼å¼. __ä½†æˆ‘è¿˜æ˜¯å»ºè®®ä¸ç”¨ä¹°,è€å¿ƒå¾€ä¸‹çœ‹__ 

### æŠ€æ³•

* [å…è´¹çš„ç¼–ç¨‹ä¸­æ–‡ä¹¦ç±ç´¢å¼•](https://github.com/sunyazhou13/free-programming-books-zh_CN) è¿™å°±æ˜¯ä¸éœ€è¦å¤§å®¶ä¹°ä¹¦çš„åŸå› ,æ‰€æœ‰è®¡ç®—æœºç›¸å…³çš„æŠ€æœ¯ä¹¦ç±å’Œè§†é¢‘æ•™ç¨‹åšå®¢ç­‰å…¨éƒ¨èµ„æ–™éƒ½åœ¨è¿™,æ˜¯çš„ä½ ç¡®å®æ²¡çœ‹é”™å°±æ˜¯ä¸€ä¸ªé“¾æ¥æå®š.
* å­¦ä¹ ä¸€ä¸‹å¦‚ä½•æ­å»ºè‡ªå·±åšå®¢è¿™æ ·å°±å¯ä»¥æŠŠæ‰€å­¦çš„çŸ¥è¯†ç‚¹è®°å½•ä¸‹æ¥è¿˜èƒ½æé«˜å½±å“åŠ›
è¯¦æƒ…å¯ä»¥å‚è€ƒæˆ‘çš„æ–‡ç« [å¦‚ä½•æ­å»ºHEXOåšå®¢](http://localhost:4000/2017/02/10/build-hexo-blog-Tutorial/)
* æ¯å¤©å°½é‡æ—©èµ·ä¸€ä¸ªå°æ—¶çœ‹ä¹¦,é¢„ä¹ ä»Šå¤©è¦è®²çš„å†…å®¹.
* çœ‹å¤§ç¥çš„åšå®¢
* è®¢é˜…å„ç§åšå®¢å‘å¸ƒæ–‡ç« (æ¨èä¸€ä¸ªè½¯ä»¶å«[Reeder](http://www.0daydown.com/12/436535.html))   
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/Reeder.webp)

(ä¼°è®¡åˆå­¦è€…è¿˜ä¸çŸ¥é“è°æ˜¯åœ¨æŸä¸ªé¢†åŸŸçš„å¤§ç¥,è¿™ä¸ªå¯ä»¥æ…¢æ…¢æ‘¸ç´¢)  
æˆ‘æ˜¯ä¸ªå­¦ä¹ iOSæ–¹å‘çš„æ‰€ä»¥æˆ‘ç»™å‡ºçš„ä¸€ä¸ªå­¦ä¹ èµ„æ–™çš„githubé“¾æ¥å’Œå¤§ç¥åˆ—è¡¨  

* [ä¸­æ–‡ iOS/Mac å¼€å‘åšå®¢åˆ—è¡¨](https://github.com/tangqiaoboy/iOSBlogCN)æ˜¯çš„ä½ åˆæ²¡çœ‹é”™å°±æ˜¯ä¸€ä¸ªé“¾æ¥ è¿™é‡Œæœ‰å¦‚ä½•æŠŠåšå®¢çš„RSSæåˆ°Reederè½¯ä»¶é‡Œ  
* [å”å·§åšå®¢](http://blog.devtang.com/2014/07/27/ios-levelup-tips/)

ä¸‹å›¾æ˜¯æˆ‘çš„reeder  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/ReederDetail.webp)

 
### è£…å¤‡

è¿™ä¸ªæ˜¯å¤§å®¶æœ€å…³å¿ƒçš„ä¹Ÿæ˜¯çˆ¶æ¯æœ€å¿ƒçƒ¦çš„äº‹äº†.

å¤§å­¦è£…å¤‡çœŸçš„å¾ˆé‡è¦æ²¡é”™ é‚£æˆ‘å…ˆä»ç”µè„‘è¯´èµ·æŠŠ

* Macç”µè„‘(è‹¹æœç”µè„‘ macbook)  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/macbook.webp)  
å› ä¸ºå®ƒå®Œç¾ç»“åˆäº† Unix ç³»çš„ Shell å’Œä¼˜ç§€çš„å›¾å½¢ç•Œé¢(è·Ÿwindow PCè¯´å†è§å§ è¿™å°ç”µè„‘ä¸€ç›´èƒ½ç”¨åˆ°ä½ å‚åŠ å·¥ä½œ)

#### __æ–¹æ¡ˆ1(é«˜è´µè½»å¥¢å‹)__  
å¦‚æœè¦æ±‚æ¯”è¾ƒé«˜çš„å¯ä»¥ä¹°[MacBook Pro MF839CH](https://detail.tmall.com/item.htm?spm=a220m.1000858.1000725.9.7HDqEB&id=44131265268&skuId=79231665633&areaId=110100&standard=1&user_id=1669409267&cat_id=2&is_b=1&rn=892765ac3efe1f5cd3df8f0d2eb48f87) `ï¿¥7988`

840å‹å· è²Œä¼¼è´µäº› å½“ç„¶è¿™äº›é’ˆå¯¹äºå®¶åº­æ¡ä»¶æ¯”è¾ƒå¥½çš„åŒå­¦  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/macbookPRO.webp)  

#### __æ–¹æ¡ˆ2(è½»å·§å®ç”¨å‹)__

å¦‚æœè¦æ±‚ä¸€èˆ¬ä¹Ÿå¯ä»¥çœé’±ä¹°ä¸ª13.3å‹ çš„
[MacBook Air13.3](https://detail.tmall.com/item.htm?spm=a220m.1000858.1000725.1.7HDqEB&id=530945296812&skuId=3163301283248&areaId=110100&standard=1&user_id=2616970884&cat_id=2&is_b=1&rn=892765ac3efe1f5cd3df8f0d2eb48f87) è¶³å¤Ÿç”¨äº† æˆ‘åŒäº‹å°±æœ‰ä¸€ä¸ªç”¨äº†5å¹´å¤š `ï¿¥6488`  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/macbookair.webp)

å¤§å®¶æ˜¯ä¸æ˜¯ä¼šè§‰å¾—è¿™ä¸ªå¾ˆè´µã€æˆ‘æ—¢ç„¶è¯´è®©ä½ çœé’±å°±èƒ½è®©ä½ çœé’±  å¾€ä¸‹çœ‹

#### __æ–¹æ¡ˆ3(ç©·å›°æ½¦å€’å‹)__

æœ‰ä¸€ä¸ªè‹¹æœç”µè„‘å®ƒå¾ˆä¾¿å®œå«[mac mini](https://www.apple.com/cn/mac-mini/) æ¸¯ç‰ˆæ·˜å®`ï¿¥3300`å·¦å³ 

![](/assets/images/20170429CmputerScienceAndTechnologyClassic/macmini.webp)

æ³¨æ„: __*æ²¡æœ‰æ˜¾ç¤ºå™¨å’Œé¼ æ ‡é”®ç›˜*__  éœ€è¦è‡ªå·±ä¹°é¼ æ ‡é”®ç›˜ å¯ä»¥ä¹°ä¸ªäºŒæ‰‹çš„æ˜¾ç¤ºå™¨å¯ä»¥ä½†æ˜¯æˆ‘è®°å¾—ä¸€èˆ¬å¤§å­¦éƒ½å¯ä»¥æä¾›ç§Ÿå€Ÿç»™åŒå­¦ä½¿ç”¨ æ˜¾ç¤ºå™¨+é¼ æ ‡é”®ç›˜ 1500æ–°çš„ä¹Ÿå¤Ÿäº†

è¿™ä¸ªå­¦ä¹ å’Œä½¿ç”¨å®Œå…¨èƒ½æ»¡è¶³ åªæ˜¯å¤§å®¶å¾ˆä¸ä¹ æƒ¯ è‹¹æœé”®ç›˜å’Œpcé”®ç›˜æŒ‰é”®æœ‰ç‚¹ç¨ç¨åŒºåˆ«
ä¸è¿‡æ²¡å…³ç³» æ·˜å® 50å—é’±èƒ½ä¹°ä¸ª è“ç‰™çš„è‹¹æœèƒ½ç”¨çš„é”®ç›˜

è¿™ä¸ªæ˜¯æˆ‘è®¤ä¸ºæœ€å¥½çš„æ–¹æ¡ˆäº† å³ç»æµåˆå®æƒ  

å¥½è¯´å®Œç”µè„‘ æˆ‘ä»¬ç»§ç»­å¾€ä¸‹è¯´

* æ ‘è“æ´¾  
  é¦–å…ˆä»‹ç»ä¸€ä¸‹è¿™ä¸ªæ˜¯æˆ‘æ‰€è§è¿‡è¿„ä»Šä¸ºæ­¢ æœ€ä¾¿å®œçš„æœ€å°çš„ç”µè„‘ å¹¶ä¸”èƒ½è¿è¡Œlinuxå„ç§æ“ä½œç³»ç»Ÿ åªä¸è¿‡æ˜¯armçº§åˆ«çš„ ä½†æ˜¯å¯¹äºå­¦ç”Ÿæ¥è¯´ éå¸¸é€‚åˆå­¦ä¹  å› ä¸ºç®€å•ä¸€ä¸ªTFå¡å°±å¯ä»¥å½“ç¡¬ç›˜ é”®ç›˜é¼ æ ‡ wifi è“ç‰™ ç½‘å¡ å…¨å¸¦ è€Œä¸”åªéœ€è¦ `ï¿¥275`å·¦å³
æ˜¯çš„å°±æ˜¯è¿™ä¹ˆä¾¿å®œ è¿˜æ˜¯è¿›å£è‹±å›½äº§çš„ å¦‚æœå›½äº§çš„ åªéœ€è¦`ï¿¥230`  
![](/assets/images/20170429CmputerScienceAndTechnologyClassic/raspberry.webp)

ä¸ºå•¥æ ‘è“æ´¾æ˜¯å¿…å¤‡çš„æ˜¯å› ä¸ºå­¦ä¹ linuxè¿‡ç¨‹ä¸­ ä½ æ€»ä¸èƒ½æ¥å›æŠ˜è…¾ç”µè„‘å®‰è£…å„ç§æ“ä½œç³»ç»Ÿå§  å…¶å®è¿™ä¸ªä¹Ÿä¸æ˜¯å¿…è¦çš„ ä½†æ˜¯ä¸ºäº†å­¦ä¹  shellå»ºè®® è¿˜æ˜¯ ç”¨è¿™ä¸ª æ¯”è¾ƒæ–¹ä¾¿
è¿™ä¸ªé€‚åˆè®¡ç®—æœºç›¸å…³ä¸“ä¸šçš„åŒå­¦çˆ±æŠ˜è…¾ çˆ±å­¦ä¹ æŠ€æœ¯ ç©æŠ€æœ¯ çš„å¿…å¤‡

å½“æˆ‘ä»¥åè€å» æˆ‘ä¸€å®šæŠŠè¿™ä¸ªæ”¾åœ¨æˆ‘çš„åšç‰©é¦†é‡Œ

*æ³¨æ„:è¿™ä¸ªéœ€è¦æ˜¾ç¤ºå™¨å’Œé¼ æ ‡é”®ç›˜ å¦‚æœä¸Šè¾¹é€‰æ‹©æ–¹æ¡ˆ3 è¿™ä¸ªéå¸¸é€‚åˆ*

* æ™ºèƒ½æ‰‹æœº  
  è¿™ä¸ªæˆ‘åªèƒ½æ¨èå¤§å®¶ä¹°iPhone æˆ–è€…ä¾¿å®œç‚¹çš„Android  
  iPhone 5s/SE `ï¿¥3288`å·¦å³  
  ![](/assets/images/20170429CmputerScienceAndTechnologyClassic/iPhone.webp)
  æ‰‹æœºå¦‚æœæiOSå¼€å‘å½“ç„¶è¦ä¹°ä¸ªiPhone ç°åœ¨ä¸æ˜¯é’±çš„é—®é¢˜æ˜¯ç§»åŠ¨äº’è”ç½‘å‘å±•ç«çˆ†çš„æ—¶ä»£,å¾—æœ‰ä¸ªåƒæ ·çš„è£…å¤‡ä»¥å¤‡ä¸æ—¶ä¹‹éœ€.
  
* Kindle
 	
  è¿™ä¸ªä¸œè¥¿æ˜¯ä¸ªçœ‹ä¹¦çš„å¥½ä¸œè¥¿ ä¸Šè¾¹è¯´çš„é‚£äº›å›¾ä¹¦ éƒ½å¯ä»¥é€šè¿‡ å…³æ³¨ä¸€äº›å¾®ä¿¡çš„å…¬ä¼—å·æ¨é€åˆ°è¿™å°è®¾å¤‡å…è´¹è·å¾—, ä¸€ä¸ªå¾ˆå°çš„è®¾å¤‡èƒ½è£…ä¸‹å¾ˆå¤šä¹¦ å¾ˆé€‚åˆå¤§å®¶è½»æ¾å­¦ä¹ ä¸å¿…å¸¦ä¸€å †æ²¡ç”¨æ²‰é‡çš„ä¹¦ç±.  `ï¿¥558`
  ![](/assets/images/20170429CmputerScienceAndTechnologyClassic/kindle.webp)
  
  
  

### æ€»ç»“

å¯ä»¥è¿™æ ·è¯´ çœ‹å®Œä¸Šè¿°æ–‡ç«  ä½ è‡³å°‘çŸ¥é“å¦‚ä½•å­¦ä¹ å¹¶ä¸”æ–¹ä¾¿çš„æ‰¾åˆ°å­¦ä¹ èµ„æ–™

ä¸‹é¢æˆ‘ä»¬å¼€å§‹ç®—ä¸€ç¬”å…¥å­¦è£…å¤‡çš„å¸  

`ç”µè„‘ + æ ‘è“æ´¾ + æ™ºèƒ½æ‰‹æœº + Kindle = å¤§å­¦å­¦ä¹ ä¿éšœ`  

`æ–¹æ¡ˆ1 + æ ‘è“æ´¾ + æ™ºèƒ½æ‰‹æœº + Kindle `	= ?  
`ï¿¥7988` + `ï¿¥275` + `ï¿¥3288` +  `ï¿¥558` = `ï¿¥12109` è¿™ä¸ªä¼°è®¡å®¶é•¿å¾ˆéš¾æ¥å— é€‚åˆ é«˜è´µè½»å¥¢å‹

`æ–¹æ¡ˆ2 + æ ‘è“æ´¾ + æ™ºèƒ½æ‰‹æœº + Kindle `	= ?    
`ï¿¥6488` + `ï¿¥275` + `ï¿¥3288` +  `ï¿¥558` = `ï¿¥10609` è¿™ä¸ªä¹Ÿå¾—1wå¤š ä¸»è¦è´¹é’±çš„æ˜¯æ‰‹æœº å¦‚æœæ‰‹æœº èƒ½çœä¸€äº› ä¼°è®¡ ä¸åˆ°1wå¤Ÿäº†

`æ–¹æ¡ˆ3 + æ ‘è“æ´¾ + æ™ºèƒ½æ‰‹æœº + Kindle `	= ?    
`ï¿¥3300` + `ï¿¥275` + `ï¿¥3288` +  `ï¿¥558` = `ï¿¥7421` 

è¿™ä¸ªæ˜¯åŒ…å«ä¸»è®¾å¤‡ è€ƒè™‘åˆ°è¿˜è¦ ç§Ÿå€Ÿæ˜¾ç¤ºå™¨ å’Œé”®ç›˜ æˆ‘ä»¬ æš‚ä¸” åŠ  ï¿¥1000

`ï¿¥3300` + `ï¿¥275` + `ï¿¥3288` +  `ï¿¥558` + `ï¿¥1000` = `ï¿¥8421`

æœ€ç»ˆè¿˜æ˜¯ éœ€è¦8Kå¤š ä¸è¿‡è¿™å·²ç» æ¯”è¾ƒçœäº† å¦‚æœæ‰‹æœºä¹°ä¸ªAndroidé‚£ä¹ˆ ä¸‹é¢æ˜¯è¿™æ ·çš„

`ï¿¥3300` + `ï¿¥275` + `ï¿¥699` +  `ï¿¥558` + `ï¿¥1000` = `ï¿¥4832`

æ˜¯çš„ 5kè¶³å¤Ÿäº† å…¶å®è¿™æ‰æ˜¯æœ€ç»æµçš„æ–¹æ¡ˆ å¦‚æœ æ‰‹æœºä¸ç”¨ä¹° é¼ æ ‡é”®ç›˜ä¹Ÿä¸ç”¨ä¹°çš„èŠ± ä¹Ÿå°± 4kå¤šä¸€ç‚¹ æ— è®ºæ˜¯æ¯•ä¸šç”Ÿè¿˜æ˜¯å¤§å­¦ç”Ÿ åˆ‡è®°è¦è®©é’±èŠ±åœ¨åˆ€åˆƒä¸Š ä¸œè¥¿è¦ç‰©å°½å…¶ç”¨ å°¤å…¶æ˜¯å¤§å­¦æœŸé—´ æ ¹æœ¬ä¸éœ€è¦å¤šå¥½ èƒ½ç”¨å°±è¡Œäº† å‚åŠ å·¥ä½œ è‡ªå·±è‡ªè¶³ä¹‹å æƒ³ä¹°ä»€ä¹ˆå°±ä¸æ˜¯é—®é¢˜äº† 


**è®©è‡ªå·±çš„å¤§å­¦ç”Ÿæ´»è¿‡å¾—æœ‰ç« æ³•ä¸€ç‚¹.**

å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2017/04/UniqueFilenameInSystem/index.html.md
Published At: 2017-04-20 16:35:42 +0000

# å¦‚ä½•åœ¨iOS/macOSç³»ç»Ÿä¸­åˆ›å»ºæ–‡ä»¶æ—¶åˆ›å»ºå”¯ä¸€çš„æ–‡ä»¶å

![](/assets/images/20170420UniqueFilenameInSystem/StockPhoto.webp)

## å‰è¨€

å½“æˆ‘æ— æ•°æ¬¡çœ‹åˆ°å¤§å®¶å†™ä»£ç çš„æ—¶å€™æ€»æ˜¯ä»¥ä¸€ä¸ª`æ—¶é—´æˆ³+arc4random()`åˆ›å»ºæŸæ–‡ä»¶çš„æ—¶å€™ æ·±æ„Ÿå¿ƒç¢,éš¾é“æ“ä½œç³»ç»Ÿå°±æ²¡æœ‰æä¾›ç›¸å…³çš„å‡½æ•°ä¹ˆ äºæ˜¯ æˆ‘æ‰¾åˆ°äº†å¦‚ä¸‹ä»£ç  è§£å†³å¤§å®¶å› ä¸ºåˆ›å»ºæ–‡ä»¶é‡åé—®é¢˜.


``` objc
/* Create a recording file */
    NSString *filePath = [@"~/Movies/AVScreenShackRecording_XXXXXX" stringByStandardizingPath];
    char *screenRecordingFileName = strdup([filePath fileSystemRepresentation]);
    if (screenRecordingFileName)
    {
        int fileDescriptor = mkstemp(screenRecordingFileName);
        if (fileDescriptor != -1)
        {
            NSString *filenameStr = [[NSFileManager defaultManager] stringWithFileSystemRepresentation:screenRecordingFileName length:strlen(screenRecordingFileName)];
            
            NSLog(@"å”¯ä¸€çš„æ–‡ä»¶å:%@",filenameStr);
            
        }
        remove(screenRecordingFileName);
        free(screenRecordingFileName);
    }
```  

ä½¿ç”¨å‰
![](/assets/images/20170420UniqueFilenameInSystem/before.webp)

è¿‡ç¨‹ä¸­
![](/assets/images/20170420UniqueFilenameInSystem/after.webp)

å®Œæˆä¹‹å
![](/assets/images/20170420UniqueFilenameInSystem/done.webp)



*__åˆ‡è®°æ–‡ä»¶åç¼€éœ€è¦ åŠ ä¸Š `XXXXXX`__* å‡ ä¸ª`X`å°±ä»£è¡¨å‡ ä½`æ•°å­—+å­—æ¯`æ··åˆ 
*æ³¨æ„*:æœ€å¥½æ˜¯6ä¸ªXæˆ–è€…6ä¸ªä»¥ä¸Š [å‚è€ƒLinux](http://man7.org/linux/man-pages/man3/mkstemp.3.html)

ä¸»è¦çš„æ˜¯è¦æ˜ç™½ä¸‹é¢è¿™ä¸¤ä¸ªå‡½æ•°

[strdup()ç”¨äºcè¯­è¨€ä¸­å¸¸ç”¨çš„ä¸€ç§å­—ç¬¦ä¸²æ‹·è´](http://baike.baidu.com/item/strdup/5522525)

[mkstemp()å‡½æ•°åœ¨ç³»ç»Ÿä¸­ä»¥å”¯ä¸€çš„æ–‡ä»¶ååˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¹¶æ‰“å¼€](http://baike.baidu.com/link?url=wFhfkOVXafm15-4vGfxEQiQynIG7BG2yYAurwzS4uHKmby2C2lfhiO2T6WAqbdc3nOP9mEOVTMaBqxOc2eZps7_JIAsIWI0p11pEIl7Vku_)


OK å¸Œæœ›å¤§å®¶æœ‰æ”¶è·

å…¨æ–‡å®Œ




URL: https://sunyazhou.com/2017/04/XcodeShortcuts/index.html.md
Published At: 2017-04-06 10:36:30 +0000

# Xcodeå¿«æ·é”®

![shortcuts](/assets/images/20170406XcodeShortcuts/cover.webp)


å‰è¨€
    åœ¨iOSå’ŒmacOSå¼€å‘è€…ä¸­ç§¯ç´¯äº†ä¸€äº›å¿«æ·æ“ä½œè®°å½•ä¸‹æ¥
    

éšè—å·¦ä¾§é¢æ¿
--

![](/assets/images/20170406XcodeShortcuts/Command0.webp)

> **command+0**=æ˜¾ç¤º/éšè—å·¦ä¾§é¢æ¿

éšè—å³ä¾§é¢æ¿
--

![](/assets/images/20170406XcodeShortcuts/CommondOption0.webp)

> **command+option+0**=æ˜¾ç¤º/éšè—å³ä¾§é¢æ¿

éšè—debugåŒºåŸŸ
--

![](/assets/images/20170406XcodeShortcuts/CommandShiftY.webp)

> **command+shift+y**=æ˜¾ç¤º/éšè—åº•éƒ¨æ§åˆ¶ç­‰è°ƒè¯•åŒºåŸŸ


è·³è½¬åˆ°ä»£ç å¤šå°‘è¡Œ 
--

![](/assets/images/20170406XcodeShortcuts/CommandLine.webp)

> **command + l (L)**=è·³è½¬åˆ°ä»£ç å¤šå°‘è¡Œ æ³¨æ„çœ‹æ¸…æ˜¯l ä¸æ˜¯i 


éšè—/æ˜¾ç¤ºå‡½æ•°ä½“ 
--

![](/assets/images/20170406XcodeShortcuts/CommondOptionLeft.webp)

> **command+option+â¬…ï¸**=éšè—å‡½æ•° `â¬…ï¸`ä»£è¡¨å·¦ç®­å¤´   iOS, macOS, Objective-C
> **command+option+â¡ï¸**=æ˜¾ç¤ºå‡½æ•°  `â¡ï¸`ä»£è¡¨å³ç®­å¤´ 



ä¸Šä¸‹ç§»åŠ¨ä»£ç è¡Œ
--

![](/assets/images/20170406XcodeShortcuts/CommondOptionMove.webp)

> **command + option + {**=å‘ä¸Šç§»åŠ¨ä»£ç è¡Œ
> **command + option + }**=å‘ä¸‹ç§»åŠ¨ä»£ç è¡Œ

å‰åç§»åŠ¨ä»£ç è¡Œ
--

![](/assets/images/20170406XcodeShortcuts/CommondMove.webp)

> **command + {**=å‘å‰ç§»åŠ¨ä»£ç è¡Œ
> **command + }**=å‘åç§»åŠ¨ä»£ç è¡Œ



å…¨å·¥ç¨‹æŸ¥æ‰¾æ–‡ä»¶
--

![](/assets/images/20170406XcodeShortcuts/CommandShiftO.webp)

> **command + shift + o**=å‘å‰ç§»åŠ¨ä»£ç è¡Œ oå¤§å†™å­—æ¯


æ·»åŠ ä»£ç è¡Œæ³¨é‡Š
--

![](/assets/images/20170406XcodeShortcuts/CommondOptionQ.webp)

> **command + option + ?**=è‡ªåŠ¨æ·»åŠ å‡½æ•°æè¿°å£°æ˜


æ’¤é”€/åæ’¤é”€ ä¿®æ”¹
--

> **command + z**=æ’¤é”€
> **command + shift + z**=åæ’¤é”€


åç»­æœ‰æ—¶é—´ä¼šæŒç»­æ›´æ–°

å…¨æ–‡å®Œ 



URL: https://sunyazhou.com/2017/03/AccessPrivacySensitive/index.html.md
Published At: 2017-03-29 10:54:40 +0000

# éšç§åŠæ•æ„Ÿæ•°æ®è®¿é—®æƒé™(Access privacy-sensitive data)

åœ¨ä½ è®¿é—®ç…§ç›¸æœºã€é€šè®¯å½•ã€ç­‰ç­‰éšç§ä»¥åŠæ•æ„Ÿæ•°æ®ä¹‹å‰ï¼Œä½ å¿…é¡»è¯·æ±‚æˆæƒã€‚å¦åˆ™ä½ çš„appä¼šåœ¨ä½ å°è¯•è®¿é—®è¿™äº›éšç§æ—¶å´©æºƒã€‚Xcodeä¼šlogè¿™äº›ï¼š
> This app has crashed because it attempted to access privacy-sensitive data without a usage description. The app's Info.plist must contain an NSContactsUsageDescription key with a string value explaining to the user how the app uses this data.

æ‰“å¼€ä½ å·¥ç¨‹ä¸­åå« `info.plist` çš„æ–‡ä»¶ï¼Œå³é”®ç‚¹å‡»é€‰æ‹© `opening as Source Code`ï¼ŒæŠŠä¸‹é¢çš„ä»£ç ç²˜è´´è¿›å»ã€‚æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨é»˜è®¤çš„ `Property List` æ‰“å¼€ `info.plist`ï¼Œç‚¹å‡»addæŒ‰é’®ï¼Œå½“ä½ è¾“å…¥ `Privacy` - Xcodeä¼šç»™ä½ è‡ªåŠ¨è¡¥å…¨çš„å»ºè®®ï¼Œç”¨ä¸Šä¸‹é”®å»é€‰æ‹©å§ã€‚

ç§æœ‰æ•°æ®çš„æ¡†æ¶åˆ—è¡¨å¯æ˜¯ä¸ªä¸å°çš„ä¸œè¥¿:  
> é€šè®¯å½• æ—¥å† æé†’ ç…§ç‰‡ è“ç‰™å…±äº« è€³æœº ç›¸æœº å®šä½ å¥åº· homeKit å¤šåª’ä½“åº“ è¿åŠ¨ callKit è¯­éŸ³è¯†åˆ« SiriKit TV Provider

å‚è€ƒ [è¿™ä¸ªå¤§ç¥](https://github.com/ChenYilong/iOS10AdaptationTips)

``` sh
	<!-- ğŸ“· Camera -->
	<key>NSCameraUsageDescription</key>
	<string>ç”¨äºæ‹ç…§æ•æ‰è§†é¢‘å†…å®¹,åŠæ‹æ‘„çŸ­è§†é¢‘æ—¶è®¿é—®ç›¸æœº</string>
	<!-- ğŸ¤ Microphone -->
	<key>NSMicrophoneUsageDescription</key>
	<string>ç”¨äºæ‹æ‘„çŸ­è§†é¢‘æ—¶è®¿é—®éº¦å…‹é£æ”¶å½•è§†é¢‘å£°éŸ³</string>
	<!-- ğŸ Photo Library iOS11 new -->
	<key>NSPhotoLibraryAddUsageDescription</key>
	<string>ç”¨äºä¿å­˜æ‹æ‘„å®Œæˆçš„è§†é¢‘å†…å®¹åˆ°ç›¸å†Œ,åŠé€‰æ‹©ç›¸å†Œå†…è§†é¢‘ä¸Šä¼ </string>
	<!-- ğŸ–¼ Photo Library -->
	<key>NSPhotoLibraryUsageDescription</key>
	<string>ç”¨äºä¿å­˜æ‹æ‘„å®Œæˆçš„è§†é¢‘å†…å®¹åˆ°ç›¸å†Œ,åŠé€‰æ‹©ç›¸å†Œå†…è§†é¢‘ä¸Šä¼ </string> 

```
ä»¥ä¸Šæ˜¯å¸¸ç”¨çš„å¹¶ä¸”é€šè¿‡ App Store å®¡æ ¸çš„æ–‡æœ¬

ä¸‹é¢æ˜¯æ–¹ä¾¿è°ƒè¯•ä½¿ç”¨çš„éšç§æ–‡æ¡ˆæé†’

``` objc
    <!-- ğŸ–¼ Photo Library -->
    <key>NSPhotoLibraryUsageDescription</key>
    <string>$(PRODUCT_NAME) photo use</string>
    
    <!-- ğŸ Photo Library iOS11 new -->
    <key>NSPhotoLibraryAddUsageDescription</key>
    <string>$(PRODUCT_NAME) photo album use</string>

    <!-- ğŸ“· Camera -->
    <key>NSCameraUsageDescription</key>
    <string>$(PRODUCT_NAME) camera use</string>

    <!-- ğŸ¤ Microphone -->
    <key>NSMicrophoneUsageDescription</key>
    <string>$(PRODUCT_NAME) microphone use</string>

    <!-- ğŸ“ Location -->
    <key>NSLocationUsageDescription</key>
    <string>$(PRODUCT_NAME) location use</string>

    <!-- ğŸ“ Location When In Use -->
    <key>NSLocationWhenInUseUsageDescription</key>
    <string>$(PRODUCT_NAME) location use</string>

    <!-- ğŸ“ Location Always -->
    <key>NSLocationAlwaysUsageDescription</key>
    <string>$(PRODUCT_NAME) always uses location </string>

    <!-- ğŸ“† Calendars -->
    <key>NSCalendarsUsageDescription</key>
    <string>$(PRODUCT_NAME) calendar events</string>

    <!-- â° Reminders -->
    <key>NSRemindersUsageDescription</key>
    <string>$(PRODUCT_NAME) reminder use</string>

    <!-- ğŸ“’ Contacts -->
    <key>NSContactsUsageDescription</key>
    <string>$(PRODUCT_NAME) contact use</string>

    <!-- ğŸŠ Motion -->
    <key>NSMotionUsageDescription</key>
    <string>$(PRODUCT_NAME) motion use</string>

    <!-- ğŸ’Š Health Update -->
    <key>NSHealthUpdateUsageDescription</key>
    <string>$(PRODUCT_NAME) heath update use</string>

    <!-- ğŸ’Š Health Share -->
    <key>NSHealthShareUsageDescription</key>
    <string>$(PRODUCT_NAME) heath share use</string>

    <!-- á›’ğŸ”µ Bluetooth Peripheral -->
    <key>NSBluetoothPeripheralUsageDescription</key>
    <string>$(PRODUCT_NAME) Bluetooth Peripheral use</string>

    <!-- ğŸµ Media Library -->
    <key>NSAppleMusicUsageDescription</key>
    <string>$(PRODUCT_NAME) media library use</string>

    <!-- ğŸ“± Siri -->
    <key>NSSiriUsageDescription</key>
    <string>$(PRODUCT_NAME) siri use</string>

    <!-- ğŸ¡ HomeKit -->
    <key>NSHomeKitUsageDescription</key>
    <string>$(PRODUCT_NAME) home kit use</string>

    <!-- ğŸ“» SpeechRecognition -->
    <key>NSSpeechRecognitionUsageDescription</key>
    <string>$(PRODUCT_NAME) speech use</string>

    <!-- ğŸ“º VideoSubscriber -->
    <key>NSVideoSubscriberAccountUsageDescription</key>
    <string>$(PRODUCT_NAME) tvProvider use</string>
    
    <!-- ğŸ“Ÿ NFC reader iOS11  -->
    <key>NFCReaderUsageDescription</key>
    <string>$(PRODUCT_NAME) use the deviceâ€™s NFC reader</string>
    
```

> æ³¨æ„:_ä¸Šçº¿å‰åŠ¡å¿…æ¢æˆå‹å¥½çš„æé†’æ–‡æ¡ˆ._


URL: https://sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/index.html.md
Published At: 2017-03-28 09:40:18 +0000

# Learning AV Foundation(ä¸‰)AVAudioRecorder

![](/assets/images/20170328LearningAVFoundationAVAudioRecorder/cover.webp)

å‰è¨€
--

åœ¨`AV Foundation`ä¸­ä½¿ç”¨`AVAudioRecorder`ç±»æ·»åŠ éŸ³é¢‘å½•åˆ¶åŠŸèƒ½å’Œä½¿ç”¨`AVAudioPlayer`ä¸€æ ·ç®€å•, éƒ½æ˜¯åœ¨`Audio Queue Server`ä¸Šå±‚æ„å»ºçš„.åŒæ—¶æ”¯æŒ`macOS`å’Œ`iOS`å¹³å°.å¯ä»¥ä»å†…ç½®éº¦å…‹é£å½•åˆ¶éŸ³é¢‘,ä¹Ÿå¯ä»¥æ”¯æŒæ•°å­—éŸ³é¢‘æ¥å£æˆ–USBå¤–æ¥éº¦å…‹é£å½•åˆ¶.


ä¸»è¦å†…å®¹å¦‚ä¸‹:
--
    å¦‚ä½•åˆ›å»ºAVAudioRecorder  
        1. éŸ³é¢‘æ ¼å¼
        2. é‡‡æ ·ç‡
        3. é€šé“æ•°
    åˆ›å»ºDemo
        1. é…ç½®éŸ³é¢‘ä¼šè¯
        2. å®ç°å½•éŸ³åŠŸèƒ½
        3. ä½¿ç”¨Audio Meteringå®ç°å£°æ³¢è§†è§‰æ˜¾ç¤º
    

åˆ›å»º`AVAudioRecorder`ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„æ–¹æ³•å’Œæˆå‘˜å˜é‡

``` objc
@property (readonly, getter=isRecording) BOOL recording;//æ˜¯å¦æ­£åœ¨å½•éŸ³
@property (readonly) NSDictionary<NSString *, id> *settings;//å½•éŸ³é…ç½®ï¼šé‡‡æ ·ç‡ã€éŸ³é¢‘æ ¼å¼ã€é€šé“æ•°...
@property (readonly) NSURL *url;//å½•éŸ³æ–‡ä»¶å­˜æ”¾URL
@property (readonly) NSTimeInterval currentTime;//å½•éŸ³æ—¶é•¿
@property (getter=isMeteringEnabled) BOOL meteringEnabled;//æ˜¯å¦ç›‘æ§å£°æ³¢
```

`AVAudioRecorder`çš„å®ä¾‹æ–¹æ³•:

``` objc
- (BOOL)prepareToRecord;//ä¸ºå½•éŸ³å‡†å¤‡ç¼“å†²åŒº
- (BOOL)record;//å½•éŸ³å¼€å§‹ï¼Œæš‚åœåè°ƒç”¨ä¼šæ¢å¤å½•éŸ³
- (BOOL)recordAtTime:(NSTimeInterval)time;//åœ¨æŒ‡å®šæ—¶é—´åå¼€å§‹å½•éŸ³
- (BOOL)recordForDuration:(NSTimeInterval) duration;//æŒ‰æŒ‡å®šæ—¶é•¿å½•éŸ³
- (BOOL)recordAtTime:(NSTimeInterval)time 
         forDuration:(NSTimeInterval)duration;//ä¸Šé¢2ä¸ªçš„åˆä½“
- (void)pause; //æš‚åœå½•éŸ³
- (void)stop; //åœæ­¢å½•éŸ³
- (BOOL)deleteRecording;//åˆ é™¤å½•éŸ³ï¼Œå¿…é¡»å…ˆåœæ­¢å½•éŸ³å†åˆ é™¤
```

`AVAudioRecorder`çš„ä»£ç†æ–¹æ³•:

``` objc
//å½•éŸ³å®Œæˆåè°ƒç”¨
- (void)audioRecorderDidFinishRecording:(AVAudioRecorder *)recorder 
                           successfully:(BOOL)flag;
//å½•éŸ³ç¼–ç å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨
- (void)audioRecorderEncodeErrorDidOccur:(AVAudioRecorder *)recorder 
                                   error:(NSError *)error;
```

å¦‚ä½•åˆ›å»º`AVAudioRecorder`
--

åˆ›å»º`AVAudioRecorder`å¯¹è±¡æ‰€éœ€è¦çš„å‚æ•°å¦‚ä¸‹:  

* éŸ³é¢‘æµå½•åˆ¶æ—¶å†™å…¥åˆ°æœ¬åœ°çš„è·¯å¾„URL
* `settings`å½•éŸ³é…ç½®ï¼šé‡‡æ ·ç‡ã€éŸ³é¢‘æ ¼å¼ã€é€šé“æ•°...ç­‰é”®å€¼å‚æ•°å­—å…¸
* å‘ç”Ÿé”™è¯¯çš„`NSError`æŒ‡é’ˆ

å¦‚ä¸‹ä»£ç :
  
``` objc
/**
 åˆ›å»ºå½•éŸ³å™¨
 */
- (void)createRecorder {
    NSString *directory = NSTemporaryDirectory();
    NSString *filePath = [directory stringByAppendingPathComponent:@"voice1.m4a"];
    NSURL *url = [NSURL fileURLWithPath:filePath];
    
    NSDictionary *setting = @{AVFormatIDKey : @(kAudioFormatMPEG4AAC),
                              AVSampleRateKey: @22050.0f,
                              AVNumberOfChannelsKey: @1};
    NSError *error;
    self.recorder = [[AVAudioRecorder alloc] initWithURL:url
                                                settings:setting
                                                   error:&error];
    if (self.recorder) {
        [self.recorder prepareToRecord];
    } else {
        NSLog(@"Recorder Create Error: %@", [error localizedDescription]);
    }
}
```

è¿™é‡Œçš„å»ºè®®è°ƒç”¨`[self.recorder prepareToRecord]`æ–¹æ³•å¯¹å½•éŸ³å®ä¾‹è¿›è¡Œé¢„è®¾å°±åƒ[ä¸Šä¸€ç« ](http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/)åˆ›å»º`AVAudioPlayer`ç±»ä¼¼.éƒ½æ˜¯ä¸ºäº†æ‰§è¡Œåº•å±‚`Audio Queue`åˆå§‹åŒ–çš„å¿…è¦è¿‡ç¨‹.è¿™ä¸ª`prepareToRecord`æ–¹æ³•è¿˜åœ¨ç»™å®šçš„URLå‚æ•°æŒ‡å®šçš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å°±å‡å°‘äº†å½•åˆ¶å¯åŠ¨æ—¶çš„å»¶æ—¶

éŸ³é¢‘æ ¼å¼
--
`AVFormatIDKey`keyæŒ‡å®šå½•åˆ¶æ ¼å¼,è¿™é‡Œçš„é™¤äº†`kAudioFormatMPEG4AAC`æ ¼å¼è¿˜æœ‰ä¸‹é¢è¿™äº›:
  
``` objc
CF_ENUM(AudioFormatID)
{
    kAudioFormatLinearPCM               = 'lpcm',
    kAudioFormatAC3                     = 'ac-3',
    kAudioFormat60958AC3                = 'cac3',
    kAudioFormatAppleIMA4               = 'ima4',
    kAudioFormatMPEG4AAC                = 'aac ',
    kAudioFormatMPEG4CELP               = 'celp',
    kAudioFormatMPEG4HVXC               = 'hvxc',
    kAudioFormatMPEG4TwinVQ             = 'twvq',
    kAudioFormatMACE3                   = 'MAC3',
    kAudioFormatMACE6                   = 'MAC6',
    kAudioFormatULaw                    = 'ulaw',
    kAudioFormatALaw                    = 'alaw',
    kAudioFormatQDesign                 = 'QDMC',
    kAudioFormatQDesign2                = 'QDM2',
    kAudioFormatQUALCOMM                = 'Qclp',
    kAudioFormatMPEGLayer1              = '.mp1',
    kAudioFormatMPEGLayer2              = '.mp2',
    kAudioFormatMPEGLayer3              = '.mp3',
    kAudioFormatTimeCode                = 'time',
    kAudioFormatMIDIStream              = 'midi',
    kAudioFormatParameterValueStream    = 'apvs',
    kAudioFormatAppleLossless           = 'alac',
    kAudioFormatMPEG4AAC_HE             = 'aach',
    kAudioFormatMPEG4AAC_LD             = 'aacl',
    kAudioFormatMPEG4AAC_ELD            = 'aace',
    kAudioFormatMPEG4AAC_ELD_SBR        = 'aacf',
    kAudioFormatMPEG4AAC_ELD_V2         = 'aacg',    
    kAudioFormatMPEG4AAC_HE_V2          = 'aacp',
    kAudioFormatMPEG4AAC_Spatial        = 'aacs',
    kAudioFormatAMR                     = 'samr',
    kAudioFormatAMR_WB                  = 'sawb',
    kAudioFormatAudible                 = 'AUDB',
    kAudioFormatiLBC                    = 'ilbc',
    kAudioFormatDVIIntelIMA             = 0x6D730011,
    kAudioFormatMicrosoftGSM            = 0x6D730031,
    kAudioFormatAES3                    = 'aes3',
    kAudioFormatEnhancedAC3             = 'ec-3'
};

```
è¿™é‡Œçš„`kAudioFormatLinearPCM`ä¼šå°†ä¸ºå‹ç¼©çš„éŸ³é¢‘æµå†™å…¥åˆ°æ–‡ä»¶ä¸­,è¿™å°±æ˜¯åŸå§‹æ•°æ®,ä¿çœŸåº¦æœ€é«˜,å½“ç„¶æ–‡ä»¶ä¹Ÿæœ€å¤§, é€‰æ‹©ACC`kAudioFormatMPEG4AAC`æˆ–è€…AppleIMA4`kAudioFormatAppleLossless`ç­‰æ ¼å¼ä¼šæ˜¾è‘—ç¼©å°æ–‡ä»¶ï¼Œè¿˜èƒ½ä¿è¯éŸ³é¢‘è´¨é‡.
> *æ³¨æ„:*
> *æŒ‡å®šçš„éŸ³é¢‘æ ¼å¼ä¸€å®šè¦å’Œæ–‡ä»¶å†™å…¥çš„URLæ–‡ä»¶ç±»å‹ä¿æŒä¸€è‡´ã€‚å¦‚æœå½•åˆ¶xxx.wavæ–‡ä»¶æ ¼å¼ æ˜¯ Waveform Audio File Format(WAVE)çš„æ ¼å¼è¦æ±‚,å³ ä½å­—èŠ‚åºã€ LinePCMã€‚ å¦‚æœ`AVFormatIDKey`æŒ‡å®šçš„å€¼ä¸æ˜¯`kAudioFormatLinearPCM`åˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚NSError ä¼šè¿”å›å¦‚ä¸‹é”™è¯¯*
> *The operation couldn't be completed. (OSState error 1718449215.)*

é‡‡æ ·ç‡
--

ä¸Šè¾¹çš„ä»£ç é‡Œ`AVSampleRateKey`ç”¨äºå®šä¹‰å½•éŸ³å™¨çš„é‡‡æ ·ç‡. **é‡‡æ ·ç‡å®šä¹‰äº†å¯¹è¾“å…¥çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·æ¯ä¸€ç§’å†…çš„é‡‡æ ·æ•°**. å¦‚æœä½¿ç”¨**ä½é‡‡æ ·ç‡** æ¯”å¦‚8kHz,ä¼šå¯¼è‡´ç²—ç²’åº¦ã€AMå¹¿æ’­ç±»å‹çš„å½•åˆ¶æ•ˆæœ, ä¸è¿‡æ–‡ä»¶ä¼šæ¯”è¾ƒå°; ä½¿ç”¨**44.1kHzçš„é‡‡æ ·ç‡(CDè´¨é‡çš„é‡‡æ ·ç‡)**ä¼šå¾—åˆ°éå¸¸é«˜è´¨é‡çš„å†…å®¹, ä¸è¿‡æ–‡ä»¶æ¯”è¾ƒå¤§. è‡³äºä½¿ç”¨ä»€ä¹ˆæ ·çš„é‡‡æ ·ç‡æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰. ä¸è¿‡å¼€å‘è€…åº”è¯¥å°½é‡ä½¿ç”¨**æ ‡å‡†çš„é‡‡æ ·ç‡ï¼Œæ¯”å¦‚: 8000Hzã€16 000Hz(16kHz)ã€22050Hz(22.05kHz)æˆ– 44100Hz(44.1kHz)ã€å½“ç„¶è¿˜æœ‰48000Hzå’Œ96000Hz** ,(kHzä»£è¡¨åƒèµ«),è¶…è¿‡48000æˆ–96000çš„é‡‡æ ·å¯¹äººè€³å·²ç»æ²¡æœ‰æ„ä¹‰.æœ€ç»ˆæ˜¯æˆ‘ä»¬çš„è€³æœµåœ¨è¿›è¡Œåˆ¤æ–­.ï¼ˆ[ä¸Šä¸€ç« ](http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/)è¯´äº† **äººè€³æ‰€èƒ½å¬åˆ°çš„å£°éŸ³ï¼Œæœ€ä½çš„é¢‘ç‡æ˜¯ä»20Hzèµ·ä¸€ç›´åˆ°æœ€é«˜é¢‘ç‡20kHz**,å½•éŸ³æœ€å¥½é‡‡ç”¨ x 2 å€çš„é¢‘ç‡ï¼‰


é€šé“æ•°
--

`AVNumberOfChannelsKey`ç”¨äºå®šä¹‰è®°å½•éŸ³é¢‘å†…å®¹çš„é€šé“æ•°ã€‚**æŒ‡å®šé»˜è®¤å€¼1 æ„å‘³ç€ä½¿ç”¨å•å£°é“å½•åˆ¶**ã€**è®¾ç½®2æ„å‘³ç€ä½¿ç”¨ç«‹ä½“å£°å½•åˆ¶**ã€‚é™¤éä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶è¿›è¡Œå½•åˆ¶ï¼Œå¦åˆ™åŒçª—åº”è¯¥åˆ›å»ºå•å£°é“å½•éŸ³ã€‚ è¿™é‡Œçš„é€šé“æ•°æ˜¯æŒ‡ å½•åˆ¶è®¾å¤‡çš„è¾“å…¥æ•°é‡ å¯ä»¥ç†è§£ä¸º éº¦å…‹é£ å†…ç½® æˆ–è€…å¤–æ¥éº¦å…‹é£å½•åˆ¶æ¯”å¦‚ æ’å…¥Appleè€³æœº é‡Œé¢çš„éº¦å…‹é£ã€‚


> ä»¥ä¸Šæ˜¯å…¨é¢`AVAudioRecorder`çš„éƒ¨åˆ†æ¦‚å¿µ,`AVAudioRecorder`æ”¯æŒ**æ— é™æ—¶é•¿å½•åˆ¶**,è¿˜å¯ä»¥è®¾ç½®ä»**æœªæ¥æŸä¸€æ—¶é—´ç‚¹å¼€å§‹å½•åˆ¶**æˆ–**æŒ‡å®šæ—¶é•¿å½•åˆ¶**


ç½‘ç»œæµåª’ä½“å¤„ç†
--
    
`AVAudioPlayer`éŸ³é¢‘æ’­æ”¾å™¨åªèƒ½æ’­æ”¾æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„éŸ³é¢‘æ•°æ®ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦è¾¹ä¸‹è½½è¾¹å¬æ€ä¹ˆåŠï¼Ÿ
`AVAudioPlayer`æ˜¯ä¸æ”¯æŒè¿™ç§ç½‘ç»œæµåª’ä½“å½¢å¼çš„éŸ³é¢‘æ’­æ”¾ï¼Œè¦æ’­æ”¾è¿™ç§ç½‘ç»œæµåª’ä½“ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨`AudioToolbox`æ¡†æ¶çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡`Audio Queue Services`ã€‚

__éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡åˆ†ä¸º3ä¸ªéƒ¨åˆ†:__
> * 3ä¸ªç¼“å†²å™¨
> * 1ä¸ªç¼“å†²é˜Ÿåˆ—
> * 1ä¸ªå›è°ƒ

**1. ä¸‹é¢æ˜¯å½•éŸ³çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡çš„å·¥ä½œåŸç†:**

![](/assets/images/20170328LearningAVFoundationAVAudioRecorder/QueueServiceRecord.webp)

**2. ä¸‹é¢æ˜¯æ’­æ”¾éŸ³é¢‘çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡çš„å·¥ä½œåŸç†;**

![](/assets/images/20170328LearningAVFoundationAVAudioRecorder/QueueServicePlay.webp)

å½“ç„¶å¤„ç†è¿™äº›ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»å†™Cè¯­è¨€å‡½æ•°å®ç° æœ‰ä¸ªå¼€æºåº“[FreeStreamer](https://github.com/sunyazhou13/FreeStreamer)

FreeStreamerä½¿ç”¨ 

``` objc 
#import <FreeStreamer/FreeStreamer.h>

- (void)viewDidLoad {
    [super viewDidLoad];
    [self initAudioStream];
    //æ’­æ”¾ç½‘ç»œæµåª’ä½“éŸ³é¢‘
    [self.audioStream play];
}
/* åˆå§‹åŒ–ç½‘ç»œæµåª’ä½“å¯¹è±¡ */
- (void)initAudioStream{
    NSString *urlStr = @"http://sc1.111ttt.com/2016/1/02/24/195242042236.mp3";
    NSURL *url = [NSURL URLWithString:urlStr];
    //åˆ›å»ºFSAudioStreamå¯¹è±¡
    self.audioStream = [[FSAudioStream alloc] initWithUrl:url];
    //è®¾ç½®æ’­æ”¾é”™è¯¯å›è°ƒBlock
    self.audioStream.onFailure = ^(FSAudioStreamError error, NSString *description){
          NSLog(@"æ’­æ”¾è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ï¼š%@",description);
    };
    //è®¾ç½®æ’­æ”¾å®Œæˆå›è°ƒBlock
    self.audioStream.onCompletion = ^(){
          NSLog(@"æ’­æ”¾å®Œæˆ!");
    };
    [self.audioStream setVolume:0.5];//è®¾ç½®å£°éŸ³å¤§å°
}
```
æœ‰ç‚¹è·‘è¿œäº† å›åˆ°æ­£é¢˜ æœ¬ç« å°†ä¸ä¼šæŠŠè¿™ä¸ªå†™åˆ°demoä¸­ è¯·è°…è§£


ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸ª`AVAudioRecorder`çš„Demo å®Œæˆä¸Šè¿°åŠŸèƒ½
==

é…ç½®ä¼šè¯
--

é¦–å…ˆåˆ›å»ºä»¥ä¸€ä¸ªAVAudioRecorderDemoå·¥ç¨‹iOSå¹³å°è¿™äº›ç›¸ä¿¡å¤§å®¶éå¸¸ç†Ÿç»ƒäº†.


åœ¨`AppDelegate`é‡Œé¢å¯¼å…¥`#import <AVFoundation/AVFoundation.h>` 
å†™ä¸Šè®¾ç½®å¦‚ä¸‹ä»£ç 

``` objc
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    
    AVAudioSession *session = [AVAudioSession sharedInstance];
    NSError *error;
    if (![session setCategory:AVAudioSessionCategoryPlayAndRecord error:&error]) {
        NSLog(@"Category Error: %@",[error localizedDescription]);
    }
    
    //æ¿€æ´»ä¼šè¯
    if (![session setActive:YES error:&error]) {
        NSLog(@"Activation Error: %@",[error localizedDescription]);
    }
    
    return YES;
}
```


è¿™`AVAudioSessionCategoryPlayAndRecord`æ˜¯[ä¸Šä¸€ç« ](http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/)è¯´çš„é‚£å‡ ç§Category,æˆ‘ä»¬éœ€è¦__å½•éŸ³+æ’­æ”¾__åŠŸèƒ½

ä¸‹ä¸€æ­¥ é…ç½® plistæ–‡ä»¶è®¿é—®æƒé™ä¿¡æ¯ å¯ä»¥å‚è€ƒ[Access privacy-sensitive data](http://localhost:4000/2017/03/20/Access-privacy-sensitive-data-private-access-permission/)è¿™ç¯‡æ–‡ç« æŠŠè®¿é—®æƒé™éœ€è¦çš„ ä¿¡æ¯å¡«å……ä¸Š.

![plist1](/assets/images/20170328LearningAVFoundationAVAudioRecorder/FillInfo.webp)

ç„¶åé€‰æ‹©SourceCode 
![plist2](/assets/images/20170328LearningAVFoundationAVAudioRecorder/SourceCode.webp)

å¡«å†™ä¸Š

``` xml
<!-- ğŸ¤ Microphone -->
<key>NSMicrophoneUsageDescription</key>
<string>$(PRODUCT_NAME) microphone use</string>
```
ä¸Šè¾¹è¿™äº›æ˜¯ä¸ºäº†è®¿é—®æœ¬åœ°æˆæƒ, è®°å¾—æˆæƒå¦‚æœç¬¬ä¸€æ¬¡è¢«æ‹’å°±å¿…é¡»è®©ç”¨æˆ·æ‰‹åŠ¨ åˆ°é€šç”¨-è®¾ç½®é‡Œé¢å»é…ç½®å¦åˆ™å°†æ°¸è¿œä¸å¥½ä½¿å“ˆã€‚å¦‚æœä¸å†™è¿™ç§æœ¬åœ°æˆæƒ ç¨‹åºåº”è¯¥ä¼š crash   

å½•éŸ³ä»£ç å®ç°
--

é¦–å…ˆæˆ‘ä»¬æ¥å°è£…ä¸€ä¸ªç±»èµ·åå«`BDRecoder`å§. è¿™é‡Œç±»æˆ‘ä»¬è®©å®ƒè´Ÿè´£æ‰€æœ‰ éŸ³é¢‘å½•åˆ¶ã€æš‚åœå½•åˆ¶ã€ä¿å­˜å½•åˆ¶æ–‡ä»¶ç­‰åŠŸèƒ½ å¹¶æœ‰å›è°ƒå‡½æ•°ç­‰block.  `BDRecoder.h`çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·, è¿™é‡Œåç»­å®Œå–„çš„è¯å¯ä»¥åŠ ä¸ªä»£ç† è¡¨ç¤ºå½•åˆ¶è¿‡ç¨‹ä¸­æ„å¤–ä¸­æ–­æˆ–è€…çº¿è·¯åˆ‡æ¢ç­‰é€»è¾‘.

``` objc
//
//  BDRecorder.h
//  AVAudioRecorderDemo
//
//  Created by sunyazhou on 2017/3/29.
//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.
//

#import <Foundation/Foundation.h>
#import <AVFoundation/AVFoundation.h>

@class MemoModel;
//å½•éŸ³åœæ­¢çš„å›è°ƒ
typedef void (^BDRecordingStopCompletionHanlder)(BOOL);
//ä¿å­˜å½•éŸ³æ–‡ä»¶å®Œæˆçš„å›è°ƒ
typedef void (^BDRecordingSaveCompletionHanlder)(BOOL, id);

@interface BDRecorder : NSObject

/**
 * å¤–éƒ¨è·å–å½“å‰å½•åˆ¶çš„æ—¶é—´
 * å°æ—¶:åˆ†é’Ÿ:ç§’  å½“ç„¶åç»­å¯ä»¥åŠ å¾®ç§’å’Œæ¯«ç§’å“ˆå°±æ˜¯æ ¼å¼å­—ç¬¦ä¸² 00:03:02 è¿™æ ·
 */
@property (nonatomic, readonly) NSString *formattedCurrentTime;

- (BOOL)record; //å¼€å§‹å½•éŸ³

- (void)pause;  //æš‚åœå½•éŸ³

- (void)stopWithCompletionHandler:(BDRecordingStopCompletionHanlder)handler;

- (void)saveRecordingWithName:(NSString *)name
            completionHandler:(BDRecordingSaveCompletionHanlder)handler;

/**
 å›æ”¾å½•åˆ¶çš„æ–‡ä»¶

 @param memo å¤‡å¿˜å½•æ–‡ä»¶model æ”¾ç€å½“å‰æ’­æ”¾çš„model
 @return æ˜¯å¦æ’­æ”¾æˆåŠŸ
 */
- (BOOL)playbackURL:(MemoModel *)memo;
@end

```

`BDRecoder.m`

``` objc
//
//  BDRecorder.m
//  AVAudioRecorderDemo
//
//  Created by sunyazhou on 2017/3/29.
//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.
//

#import "BDRecorder.h"

#import "MemoModel.h"

@interface BDRecorder () <AVAudioRecorderDelegate>

@property (nonatomic, strong) AVAudioPlayer *player;
@property (nonatomic, strong) AVAudioRecorder *recorder;
@property (nonatomic, strong) BDRecordingStopCompletionHanlder completionHandler;

@end

@implementation BDRecorder

- (instancetype)init {
    self = [super init];
    if (self) {
        NSString *temDir = NSTemporaryDirectory();
        NSString *filePath = [temDir stringByAppendingPathComponent:@"test1.caf"];
        NSURL *fileURL = [NSURL fileURLWithPath:filePath];
        
        NSDictionary *setting = @{AVFormatIDKey: @(kAudioFormatAppleIMA4),
                                  AVSampleRateKey: @44100.0f,
                                  AVNumberOfChannelsKey: @1,
                                  AVEncoderBitDepthHintKey: @16,
                                  AVEncoderAudioQualityKey: @(AVAudioQualityMedium)
                                  };
        NSError *error;
        self.recorder = [[AVAudioRecorder alloc] initWithURL:fileURL settings:setting error:&error];
        if (self.recorder) {
            self.recorder.delegate = self;
            [self.recorder prepareToRecord];
        } else {
            NSLog(@"Create Recorder Error: %@",[error localizedDescription]);
        } 
    }
    return self;
}

- (BOOL)record {
    return [self.recorder record];
}

- (void)pause {
    [self.recorder pause];
}

- (void)stopWithCompletionHandler:(BDRecordingStopCompletionHanlder)handler {
    self.completionHandler = handler;
    [self.recorder stop];
}

- (void)saveRecordingWithName:(NSString *)name
            completionHandler:(BDRecordingSaveCompletionHanlder)handler {
    NSTimeInterval timestamp = [NSDate timeIntervalSinceReferenceDate];
    NSString *filename = [NSString stringWithFormat:@"%@-%f.caf", name, timestamp];
    NSString *docDir = [self documentsDirectory];
    NSString *destPath = [docDir stringByAppendingPathComponent:filename];
    NSURL *srcURL = self.recorder.url;
    NSURL *destURL = [NSURL fileURLWithPath:destPath];
    NSError *error;
    BOOL success = [[NSFileManager defaultManager] copyItemAtURL:srcURL toURL:destURL error:&error];
    if (success) {
        MemoModel *model = [MemoModel memoWithTitle:name url:destURL];
        handler(YES, model);
    }
    
    
}

- (NSString *)documentsDirectory {
    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    return [paths objectAtIndex:0];
}

- (void)audioRecorderDidFinishRecording:(AVAudioRecorder *)recorder
                           successfully:(BOOL)flag {
    if (self.completionHandler) { self.completionHandler(flag); }
}

@end

```
è¿™é‡Œçš„`self.completionHandler`å½“å¤–éƒ¨è°ƒç”¨`stopWithCompletionHandler`çš„æ—¶å€™æš‚å­˜ä¸€ä¸‹blockæ˜¯ä¸ºäº†å½•éŸ³å®Œæˆæ—¶å‘Šè¯‰å¤–éƒ¨é€šçŸ¥ä¸€ä¸‹ä»¥ä¾¿äºå¯ä»¥å¼¹å‡ºä¸€ä¸ªUIAlertViewå»æ˜¾ç¤ºä¿å­˜ç­‰æ“ä½œ


å½“åœæ­¢å½•éŸ³, è¿›å…¥è¯­éŸ³å¤‡å¿˜é˜¶æ®µå‘½åé˜¶æ®µæ—¶ è®©å¤–éƒ¨è°ƒç”¨`saveRecordingWithName:completionHandler `ä¼ å…¥æ–‡ä»¶çš„å‘½å,ç„¶åæˆ‘ä»¬é€šè¿‡`self.recorder.url`è·å–åˆ°URLå¹¶ä¸”copyåˆ°tmpé‡Œé¢æ˜¯ç›®å½•å¹¶å‘½å


ä¸‹ä¸€æ­¥è¦å®ç°`playbackURL:` è¿™é‡Œé¢æœ‰ä¸ª`MemoModel`å‚æ•°çš„å¯¹è±¡,
è¿™ä¸ª`MemoModel`æ˜¯ä¸€ä¸ªå¯¹è±¡modelæ”¾ç€ æ–‡ä»¶nameã€url...

``` objc
#import <Foundation/Foundation.h>

@interface MemoModel : NSObject <NSCopying>
@property (copy, nonatomic, readonly) NSString *title;
@property (strong, nonatomic, readonly) NSURL *url;
@property (copy, nonatomic, readonly) NSString *dateString;
@property (copy, nonatomic, readonly) NSString *timeString;

+ (instancetype)memoWithTitle:(NSString *)title url:(NSURL *)url;

- (BOOL)deleteMemo;
@end
//å…·ä½“å®ç°è¯·å‚è€ƒæˆ‘çš„æœ€ç»ˆdemo
```

å®ç°æ’­æ”¾éƒ¨åˆ†éœ€è¦åˆ›å»ºæ’­æ”¾å™¨ è¿™é‡Œå°±ç®€å•åˆ›å»ºä¸€ä¸‹`AVAudioPlayer`

``` objc 
/**
 å›æ”¾å½•åˆ¶çš„æ–‡ä»¶
 
 @param memo å¤‡å¿˜å½•æ–‡ä»¶model æ”¾ç€å½“å‰æ’­æ”¾çš„model
 @return æ˜¯å¦æ’­æ”¾æˆåŠŸ
 */
- (BOOL)playbackURL:(MemoModel *)memo {
    [self.player stop];
    self.player = [[AVAudioPlayer alloc] initWithContentsOfURL:memo.url error:nil];
    if (self.player) {
        [self.player prepareToPlay];
        return YES;
    }
    return NO;
}
```

è¿™é‡Œé€šè¿‡memo.url ç»™å½“å‰æ’­æ”¾å™¨æ’­æ”¾, è¿™é‡Œå°±ç®€å•å®ç°ä¸€ä¸‹ å¦‚æœéœ€è¦å¤æ‚å®ç°å¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç« è®²è§£çš„`AVAudioPlayer` 

æœ€åæŠŠæ˜¾ç¤ºäº‹ä»¶éƒ¨åˆ†çš„ä»£ç åŠ ä¸Š

``` objc 
/**
 * å¤–éƒ¨è·å–å½“å‰å½•åˆ¶çš„æ—¶é—´
 * å°æ—¶:åˆ†é’Ÿ:ç§’  å½“ç„¶åç»­å¯ä»¥åŠ å¾®ç§’å’Œæ¯«ç§’å“ˆå°±æ˜¯æ ¼å¼å­—ç¬¦ä¸² 00:03:02 è¿™æ ·
 */
@property (nonatomic, readonly) NSString *formattedCurrentTime;

```

è¿™é‡Œæˆ‘ä»¬éœ€è¦å¤å†™`formattedCurrentTime`getæ–¹æ³•è·å–æ—¶é—´æ ¼å¼ä¾‹å¦‚: 00:00:00


``` objc
/**
 è¿”å›å½“å‰å½•åˆ¶çš„æ—¶é—´æ ¼å¼ HH:mm:ss

 @return è¿”å›ç»„è£…å¥½çš„å­—ç¬¦ä¸²
 */
- (NSString *)formattedCurrentTime {
    NSUInteger time = (NSUInteger)self.recorder.currentTime;
    NSInteger hours = (time / 3600);
    NSInteger minutes = (time / 60) % 60;
    NSInteger seconds = time % 60;
    
    NSString *format = @"%02i:%02i:%02i";
    return [NSString stringWithFormat:format, hours, minutes, seconds];
}
```
ä¸Šè¾¹å¤§è‡´æ˜¯å°è£…`BDRecorder`çš„è¿‡ç¨‹

ä¸‹é¢æ˜¯å¯¹`ViewController`UIçš„è®¾ç½®, è®¾ç½®å¥½æ—¶é—´æ ¼å¼ æˆ‘ä»¬éœ€è¦åœ¨`ViewController`é‡Œ è‡ªå·±æä¸ªå®šæ—¶å™¨å»æ›´æ–°å½•åˆ¶çš„æ—¶é—´åœ¨UIä¸Šçš„æ˜¾ç¤º, å› ä¸º`self.recorder.currentTime`æ˜¯åªè¯»ç†Ÿæ‚‰ æ²¡æä¾›setæ–¹æ³• æ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ— æ³•ç”¨KVOç›‘å¬recorderçš„å±æ€§å˜åŒ–. 

ä»£ç å¦‚ä¸‹:

``` objc
//
//  ViewController.m
//  AVAudioRecorderDemo
//
//  Created by sunyazhou on 2017/3/28.
//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.
//

#import "ViewController.h"

#import <Masonry/Masonry.h>
#import <AVFoundation/AVFoundation.h>

#import "BDRecorder.h"
#import "LevelMeterView.h"
#import "MemoModel.h"
#import "MemoCell.h"
#import "LevelPair.h"

#define MEMOS_ARCHIVE    @"memos.archive"

@interface ViewController () <UITableViewDelegate, UITableViewDataSource>

@property (nonatomic, strong) NSMutableArray <MemoModel *>*memos;
@property (nonatomic, strong) BDRecorder *recorder;

@property (nonatomic, strong) NSTimer *timer;
@property (nonatomic, strong) CADisplayLink *levelTimer;


@property (weak, nonatomic) IBOutlet UIView *containerView;
@property (weak, nonatomic) IBOutlet UIButton *recordButton;
@property (weak, nonatomic) IBOutlet UIButton *stopButton;
@property (weak, nonatomic) IBOutlet UILabel *timeLabel;
@property (weak, nonatomic) IBOutlet LevelMeterView *levelMeterView;
@property (weak, nonatomic) IBOutlet UITableView *tableview;



@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    self.recorder = [[BDRecorder alloc] init];
    self.memos = [NSMutableArray array];
    self.stopButton.enabled = NO;
    
    UIImage *recordImage = [[UIImage imageNamed:@"record"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];
    UIImage *pauseImage = [[UIImage imageNamed:@"pause"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];
    UIImage *stopImage = [[UIImage imageNamed:@"stop"] imageWithRenderingMode:UIImageRenderingModeAlwaysOriginal];
    [self.recordButton setImage:recordImage forState:UIControlStateNormal];
    [self.recordButton setImage:pauseImage forState:UIControlStateSelected];
    [self.stopButton setImage:stopImage forState:UIControlStateNormal];
    
    NSData *data = [NSData dataWithContentsOfURL:[self archiveURL]];
    if (!data) {
        _memos = [NSMutableArray array];
    } else {
        _memos = [NSKeyedUnarchiver unarchiveObjectWithData:data];
    }
    
    
    [self.tableview registerNib:[UINib nibWithNibName:@"MemoCell" bundle:[NSBundle mainBundle]] forCellReuseIdentifier:@"MemoCell"];
    
    
    [self layoutSubveiws];
}

- (void)layoutSubveiws{
    [self.containerView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.view.mas_top).offset(30);
        make.left.equalTo(self.view.mas_left).offset(20);
        make.right.equalTo(self.view.mas_right).offset(-20);
        make.centerX.equalTo(self.view.mas_centerX);
        make.bottom.equalTo(self.tableview.mas_top).offset(-50);
    }];
    
    [self.tableview mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.bottom.equalTo(self.view);
        make.top.equalTo(self.view.mas_top).offset(200);
    }];
    
    
    [self.timeLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.left.right.equalTo(self.containerView);
        make.centerX.equalTo(self.containerView.mas_centerX);
        make.height.equalTo(@25);
    }];
    
    [self.recordButton mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.equalTo(self.containerView.mas_left);
        make.bottom.equalTo(self.containerView.mas_bottom);
        make.width.height.equalTo(@71);
    }];
    
    [self.stopButton mas_makeConstraints:^(MASConstraintMaker *make) {
        make.right.equalTo(self.containerView.mas_right);
        make.bottom.equalTo(self.containerView.mas_bottom);
        make.width.height.equalTo(@71);
    }];
    
    [self.levelMeterView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.left.right.equalTo(self.view);
        make.height.equalTo(@30);
        make.bottom.equalTo(self.tableview.mas_top);
    }];
}


- (void)startTimer {
    [self.timer invalidate];
    self.timer = [NSTimer timerWithTimeInterval:0.5
                                         target:self
                                       selector:@selector(updateTimeDisplay)
                                       userInfo:nil
                                        repeats:YES];
    [[NSRunLoop mainRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];
}

- (void)stopTimer {
    [self.timer invalidate];
    self.timer = nil;
}

- (void)updateTimeDisplay {
    self.timeLabel.text = self.recorder.formattedCurrentTime;
}

- (void)startMeterTimer {
    [self.levelTimer invalidate];
    self.levelTimer = [CADisplayLink displayLinkWithTarget:self selector:@selector(updateMeter)];
//    if ([self.levelTimer respondsToSelector:@selector(setPreferredFramesPerSecond:)]) {
//        self.levelTimer.preferredFramesPerSecond = 5;
//    } else {
    self.levelTimer.frameInterval = 5;
//    }
    [self.levelTimer addToRunLoop:[NSRunLoop currentRunLoop]
                          forMode:NSRunLoopCommonModes];
    
}


- (void)stopMeterTimer {
    [self.levelTimer invalidate];
    self.levelTimer = nil;
    [self.levelMeterView resetLevelMeter];
}

- (void)updateMeter {
    LevelPair *levels = [self.recorder levels];
    self.levelMeterView.level = levels.level;
    self.levelMeterView.peakLevel = levels.peakLevel;
    [self.levelMeterView setNeedsDisplay];
    
}

#pragma mark -
#pragma mark - UITableViewDelegate
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return self.memos.count;
}


- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    MemoCell *cell = [tableView dequeueReusableCellWithIdentifier:@"MemoCell"];
    cell.model = self.memos[indexPath.row];
    return cell;
}

- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{
    MemoModel *model = self.memos[indexPath.row];
    [self.recorder playbackURL:model];
}

- (BOOL)tableView:(UITableView *)tableView canEditRowAtIndexPath:(NSIndexPath *)indexPath {
    return YES;
}

- (void)tableView:(UITableView *)tableView commitEditingStyle:(UITableViewCellEditingStyle)editingStyle forRowAtIndexPath:(NSIndexPath *)indexPath {
    if (editingStyle == UITableViewCellEditingStyleDelete) {
        MemoModel *memo = self.memos[indexPath.row];
        [memo deleteMemo];
        [self.memos removeObjectAtIndex:indexPath.row];
        [self saveMemos];
        [tableView deleteRowsAtIndexPaths:@[indexPath] withRowAnimation:UITableViewRowAnimationAutomatic];
    }
}

- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath {
    return 80;
}
#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
- (IBAction)record:(UIButton *)sender {
    self.stopButton.enabled = YES;
    if ([sender isSelected]) {
        [self stopMeterTimer];
        [self stopTimer];
        [self.recorder pause];
    } else {
        [self startMeterTimer];
        [self startTimer];
        [self.recorder record];
    }
    [sender setSelected:![sender isSelected]];
}

- (IBAction)stopRecording:(UIButton *)sender {
    [self stopMeterTimer];
    self.recordButton.selected = NO;
    self.stopButton.enabled = NO;
    [self.recorder stopWithCompletionHandler:^(BOOL result) {
        double delayInSeconds = 0.01;
        dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * NSEC_PER_SEC));
        dispatch_after(popTime, dispatch_get_main_queue(), ^{
            [self showSaveDialog];
        });
    }];
}


- (void)showSaveDialog {
    UIAlertController *alertController = [UIAlertController alertControllerWithTitle:@"ä¿å­˜å½•éŸ³" message:@"è¾“å…¥åç§°" preferredStyle:UIAlertControllerStyleAlert];
    [alertController addTextFieldWithConfigurationHandler:^(UITextField * _Nonnull textField) {
       textField.placeholder = @"æˆ‘çš„å½•éŸ³";
    }];
    UIAlertAction *cancelAction = [UIAlertAction actionWithTitle:@"Cancel" style:UIAlertActionStyleCancel handler:nil];
    UIAlertAction *okAction = [UIAlertAction actionWithTitle:@"OK" style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) {
        NSString *filename = [alertController.textFields.firstObject text];
        [self.recorder saveRecordingWithName:filename completionHandler:^(BOOL success, id object) {
            if (success) {
                [self.memos insertObject:object atIndex:0];
                [self saveMemos];
                [self.tableview reloadData];
            } else {
                NSLog(@"Error saving file: %@", [object localizedDescription]);
            }
        }];
    }];
    [alertController addAction:cancelAction];
    [alertController addAction:okAction];
    
    [self presentViewController:alertController animated:YES completion:nil];
}

#pragma mark - Memo Archiving
//ä¿å­˜å¤‡å¿˜å½•model  è¿™é‡Œç®€å•ç”¨å½’æ¡£çš„æ–¹å¼å­˜å‚¨ä¸€ä¸‹

- (void)saveMemos {
    NSData *fileData = [NSKeyedArchiver archivedDataWithRootObject:self.memos];
    [fileData writeToURL:[self archiveURL] atomically:YES];
}

//å­˜å‚¨å½’æ¡£çš„è·¯å¾„
- (NSURL *)archiveURL {
    NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
    NSString *docsDir = [paths objectAtIndex:0];
    NSString *archivePath = [docsDir stringByAppendingPathComponent:MEMOS_ARCHIVE];
    return [NSURL fileURLWithPath:archivePath];
}



- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


@end

```


ä»£ç ç¨ç¨æœ‰ç‚¹é•¿  æˆ‘ç®€å•è¯´ä¸€ä¸‹ å¤§å®¶å¯ä»¥å‚ç…§æœ€ç»ˆçš„demo

``` objc 
@property (nonatomic, strong) NSMutableArray <MemoModel *>*memos;
@property (nonatomic, strong) BDRecorder *recorder;

```
å£°æ˜ä¸€ä¸ªæ•°ç»„ å­˜æ”¾éœ€è¦æ’­æ”¾çš„modelå¯¹è±¡ä¿¡æ¯ åç§° æ–‡ä»¶urlã€æ—¥æœŸç­‰

``` objc
@property (nonatomic, strong) NSTimer *timer;
@property (nonatomic, strong) CADisplayLink *levelTimer;
```

ä¸€ä¸ªtimerç”¨äº åˆ·æ–°å½•åˆ¶æ—¶é—´ 
`levelTimer`ç”¨äºåˆ·æ–°å½•åˆ¶çš„è§†æ³¢å›¾ä¹Ÿå«`Audio Metering`å¯¹éŸ³é¢‘è¿›è¡Œè®¡é‡

åœ¨`BDRecorder`ä¸­å¢åŠ äº†

``` objc
- (LevelPair *)levels {
    [self.recorder updateMeters];
    float avgPower = [self.recorder averagePowerForChannel:0];
    float peakPower = [self.recorder peakPowerForChannel:0];
    float linearLevel = [self.meterTable valueForPower:avgPower];
    float linearPeak = [self.meterTable valueForPower:peakPower];
    return [LevelPair levelsWithLevel:linearLevel peakLevel:linearPeak];
}
```
è¿™ä¸¤ä¸ªæ–¹æ³•
       1. averagePowerForChannelå–å‡ºæ³¢è°·å¹³å‡å€¼
       2. peakPowerForChannelå–å‡ºæ³¢å³° 
ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºå£°éŸ³åˆ†è´(dB)ç­‰çº§çš„æµ®ç‚¹å€¼. è¿™ä¸ªå€¼çš„è¡¨ç¤ºèŒƒå›´`0dB(fullscale) ~ -160dB` 0dBæœ€å¤§  -160dBæœ€å°

**å¼€å¯éŸ³é¢‘è®¡é‡ (éœ€è¦åœ¨`BDRecorder`ä¸­å¼€å¯, å¦‚ä¸‹ä»£ç ) ä¼šå¸¦æ¥å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œä½†æˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆåˆ’ç®—çš„ æ¯•ç«Ÿè¦æ˜¾ç¤ºè§†è§‰æ•ˆæœæ‰æ˜¯ç‹é“. 
å¦‚æœ`meteringEnabled`å¼€å¯åˆ™éŸ³é¢‘å½•éŸ³å™¨å°±ä¼šå¯¹æ•æ‰åˆ°çš„éŸ³é¢‘æ ·æœ¬è¿›è¡Œåˆ†è´è®¡ç®—ã€‚**

**å¼€å¯éŸ³é¢‘è®¡é‡(Audio Metering)æ–¹æ³•:**

``` objc
self.recorder.meteringEnabled = YES;
```

æ›´æ–°å‰è°ƒç”¨äº†å¦‚ä¸‹ä»£ç 

``` objc 
- (LevelPair *)levels {
    [self.recorder updateMeters];
    ...
}
```

æ¯å½“è¯»å–å€¼ä¹‹å‰éœ€è¦è°ƒç”¨`[self.recorder updateMeters]`æ–¹æ³•æ‰èƒ½è·å–åˆ°æœ€æ–°å€¼ï¼Œå¦åˆ™å¯èƒ½è·å–çš„ä¸å¤Ÿç²¾ç¡®

ç„¶å ä½¿ç”¨`MeterTable`ç±» å£°æ˜çš„å‡½æ•°`valueForPower:` æŠŠä¸Šè¾¹ä¸¤ä¸ªé˜€å€¼ è½¬æˆçº¿æ€§è¿ç®—

**å°±æ˜¯åˆ†è´å€¼ä»å¯¹æ•°å½¢å¼çš„`-160 ~ 0`èŒƒå›´è½¬æ¢ä¸ºçº¿æ€§0åˆ°1çš„å½¢å¼.**

``` objc 
//
//  MeterTable.m
//  AVAudioRecorderDemo
//
//  Created by sunyazhou on 2017/4/5.
//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.
//

#import "MeterTable.h"


#define MIN_DB -60.0f
#define TABLE_SIZE 300

@implementation MeterTable {
    float _scaleFactor;
    NSMutableArray *_meterTable;
}

- (id)init {
    self = [super init];
    if (self) {
        float dbResolution = MIN_DB / (TABLE_SIZE - 1);
        
        _meterTable = [NSMutableArray arrayWithCapacity:TABLE_SIZE];
        _scaleFactor = 1.0f / dbResolution;
        
        float minAmp = dbToAmp(MIN_DB);
        float ampRange = 1.0 - minAmp;
        float invAmpRange = 1.0 / ampRange;
        
        for (int i = 0; i < TABLE_SIZE; i++) {
            float decibels = i * dbResolution;
            float amp = dbToAmp(decibels);
            float adjAmp = (amp - minAmp) * invAmpRange;
            _meterTable[i] = @(adjAmp);
        }
    }
    return self;
}

float dbToAmp(float dB) {
    return powf(10.0f, 0.05f * dB);
}

- (float)valueForPower:(float)power {
    if (power < MIN_DB) {
        return 0.0f;
    } else if (power >= 0.0f) {
        return 1.0f;
    } else {
        int index = (int) (power * _scaleFactor);
        return [_meterTable[index] floatValue];
    }
}

@end

```

> **è¿™ä¸ªç±»åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„`_meterTable`ä¿å­˜ä»è®¡ç®—å‰çš„åˆ†è´æ•°åˆ°ä½¿ç”¨ä¸€å®šçº§åˆ«åˆ†è´è§£æä¹‹åçš„è½¬æ¢ç»“æœ, è¿™é‡Œä½¿ç”¨çš„è§£æç‡`-0.2dB`, è§£æç­‰çº§å¯ä»¥é€šè¿‡`MIN_DB` `TABLE_SIZE`è¿™ä¸¤ä¸ªå®çš„å€¼æ¥ä¿®æ”¹,æ¯ä¸ªåˆ†è´å€¼éƒ½è°ƒç”¨`dbToAmp:`å‡½æ•°è½¬æ¢ä¸ºçº¿æ€§èŒƒå›´å†…çš„å€¼,ä½¿å…¶å¤„äº`0(-60dB) ~ 1()`èŒƒå›´å†…, ä¹‹åç”±è¿™äº›èŒƒå›´å†…çš„å€¼æ„æˆå¹³è¡Œæ›²çº¿,å¼€å¹³æ–¹è®¡ç®—å¹¶ä¿å­˜åˆ°å†…éƒ¨æŸ¥æ‰¾è¡¨æ ¼ä¸­. ç„¶åå¦‚æœå¤–éƒ¨éœ€è¦å¯ä»¥è°ƒç”¨`valueForPower:`æ¥è·å–.**



ç„¶åä¿å­˜åˆ°`LevelPair`çš„å®ä¾‹å¯¹è±¡è¿”å› è¿™ä¸ªå®ä¾‹å¾ˆç®€å•å­˜æ”¾ä¸¤ä¸ªå€¼ä¸€ä¸ª`level`ä¸€ä¸ª`peakLevel`

``` objc 
@interface LevelPair : NSObject
@property (nonatomic, readonly) float level;
@property (nonatomic, readonly) float peakLevel;

+ (instancetype)levelsWithLevel:(float)level peakLevel:(float)peakLevel;

- (instancetype)initWithLevel:(float)level peakLevel:(float)peakLevel;

@end
```

åœ¨`ViewController`ä¸­æ˜¾ç¤ºç›¸å…³çš„UI 

``` objc
- (void)startTimer {
    [self.timer invalidate];
    self.timer = [NSTimer timerWithTimeInterval:0.5
                                         target:self
                                       selector:@selector(updateTimeDisplay)
                                       userInfo:nil
                                        repeats:YES];
    [[NSRunLoop mainRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];
}

- (void)stopTimer {
    [self.timer invalidate];
    self.timer = nil;
}

- (void)updateTimeDisplay {
    self.timeLabel.text = self.recorder.formattedCurrentTime;
}

- (void)startMeterTimer {
    [self.levelTimer invalidate];
    self.levelTimer = [CADisplayLink displayLinkWithTarget:self selector:@selector(updateMeter)];
//    if ([self.levelTimer respondsToSelector:@selector(setPreferredFramesPerSecond:)]) {
//        self.levelTimer.preferredFramesPerSecond = 5;
//    } else {
    self.levelTimer.frameInterval = 5;
//    }
    [self.levelTimer addToRunLoop:[NSRunLoop currentRunLoop]
                          forMode:NSRunLoopCommonModes];
    
}


- (void)stopMeterTimer {
    [self.levelTimer invalidate];
    self.levelTimer = nil;
    [self.levelMeterView resetLevelMeter];
}

- (void)updateMeter {
    LevelPair *levels = [self.recorder levels];
    self.levelMeterView.level = levels.level;
    self.levelMeterView.peakLevel = levels.peakLevel;
    [self.levelMeterView setNeedsDisplay];
    
}

```
ç”¨äºå®šæ—¶å™¨çš„å¤„ç†

äº‹ä»¶çš„ç›¸å…³å“åº”

``` objc
#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
- (IBAction)record:(UIButton *)sender {
    self.stopButton.enabled = YES;
    if ([sender isSelected]) {
        [self stopMeterTimer];
        [self stopTimer];
        [self.recorder pause];
    } else {
        [self startMeterTimer];
        [self startTimer];
        [self.recorder record];
    }
    [sender setSelected:![sender isSelected]];
}

- (IBAction)stopRecording:(UIButton *)sender {
    [self stopMeterTimer];
    self.recordButton.selected = NO;
    self.stopButton.enabled = NO;
    [self.recorder stopWithCompletionHandler:^(BOOL result) {
        double delayInSeconds = 0.01;
        dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * NSEC_PER_SEC));
        dispatch_after(popTime, dispatch_get_main_queue(), ^{
            [self showSaveDialog];
        });
    }];
}

```

è¿™é‡Œä¿å­˜æ•°æ®ä½¿ç”¨çš„æ˜¯å½’æ¡£æ–¹å¼




`BDRecorder`æ²¡æœ‰ å¤„ç†æ„å¤–ä¸­æ–­ç­‰æƒ…å†µ æ¯”å¦‚å¤–æ¥éº¦å…‹é£ å’ŒéŸ³é¢‘æ„å¤–æ¥ç”µç­‰ï¼Œå¦‚æœéœ€è¦å¤„ç† å°±å¯ä»¥åœ¨`BDRecorder`ä¸­å£°æ˜å‡ ä¸ªä»£ç†ç›‘å¬éŸ³é¢‘å›è¯çš„é‚£å‡ ä¸ªé€šçŸ¥å°±å¯ä»¥äº† è¿™é‡Œå‡ºäºå­¦ä¹ ä¸ºç›®çš„å°±ç®€å•å†™åˆ°è¿™é‡Œå§ï¼Œå¦‚æœå¤§å®¶éœ€æ±‚å¼ºçƒˆæˆ‘å¯ä»¥å›å¤´è¡¥ä¸Šå¹¶å¼€æºã€‚



å¾ˆå¤šäººçº ç»“å¦‚ä½•æ ¹æ®æ³¢å½¢ç»˜åˆ¶æ›´å¥½çš„å›¾ æˆ‘è¿™é‡Œæ˜¯å€ŸåŠ©æœ¬ä¹¦ä½œè€…çš„demoå®Œæˆç›¸å…³æ³¢å½¢å¤„ç†çš„è§†å›¾ã€‚

``` objc 
#import "LevelMeterView.h"

#import "LevelMeterColorThreshold.h"

@interface LevelMeterView ()

@property (nonatomic) NSUInteger ledCount;
@property (strong, nonatomic) UIColor *ledBackgroundColor;
@property (strong, nonatomic) UIColor *ledBorderColor;
@property (nonatomic, strong) NSArray *colorThresholds;

@end

@implementation LevelMeterView

- (id)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self setupView];
    }
    return self;
}

- (id)initWithCoder:(NSCoder *)coder {
    self = [super initWithCoder:coder];
    if (self) {
        [self setupView];
    }
    return self;
}

- (void)setupView {
    
    self.backgroundColor = [UIColor clearColor];
    
    _ledCount = 20;
    
    _ledBackgroundColor = [UIColor colorWithWhite:0.0f alpha:0.35f];
    _ledBorderColor = [UIColor blackColor];
    
    UIColor *greenColor = [UIColor colorWithRed:0.458 green:1.000 blue:0.396 alpha:1.000];
    UIColor *yellowColor = [UIColor colorWithRed:1.000 green:0.930 blue:0.315 alpha:1.000];
    UIColor *redColor = [UIColor colorWithRed:1.000 green:0.325 blue:0.329 alpha:1.000];
    
    _colorThresholds = @[[LevelMeterColorThreshold colorThresholdWithMaxValue:0.5 color:greenColor name:@"green"],
                         [LevelMeterColorThreshold colorThresholdWithMaxValue:0.8 color:yellowColor name:@"yellow"],
                         [LevelMeterColorThreshold colorThresholdWithMaxValue:1.0 color:redColor name:@"red"]];
}

- (void)drawRect:(CGRect)rect {
    
    CGContextRef context = UIGraphicsGetCurrentContext();
    
    CGContextTranslateCTM(context, 0, CGRectGetHeight(self.bounds));
    CGContextRotateCTM(context, (CGFloat) -M_PI_2);
    CGRect bounds = CGRectMake(0., 0., [self bounds].size.height, [self bounds].size.width);
    
    
    CGFloat lightMinValue = 0.0f;
    
    NSInteger peakLED = -1;
    
    if (self.peakLevel > 0.0f) {
        peakLED = self.peakLevel * self.ledCount;
        if (peakLED >= self.ledCount) {
            peakLED = self.ledCount - 1;
        }
    }
    
    for (int ledIndex = 0; ledIndex < self.ledCount; ledIndex++) {
        
        UIColor *ledColor = [self.colorThresholds[0] color];
        
        CGFloat ledMaxValue = (CGFloat) (ledIndex + 1) / self.ledCount;
        
        for (int colorIndex = 0; colorIndex < self.colorThresholds.count - 1; colorIndex++) {
            LevelMeterColorThreshold *currThreshold = self.colorThresholds[colorIndex];
            LevelMeterColorThreshold *nextThreshold = self.colorThresholds[colorIndex + 1];
            if (currThreshold.maxValue <= ledMaxValue) {
                ledColor = nextThreshold.color;
            }
        }
        
        CGFloat height = CGRectGetHeight(bounds);
        CGFloat width = CGRectGetWidth(bounds);
        
        CGRect ledRect = CGRectMake(0.0f, height * ((CGFloat) ledIndex / self.ledCount), width, height * (1.0f / self.ledCount));
        
        // Fill background color
        CGContextSetFillColorWithColor(context, self.ledBackgroundColor.CGColor);
        CGContextFillRect(context, ledRect);
        
        // Draw Light
        CGFloat lightIntensity;
        if (ledIndex == peakLED) {
            lightIntensity = 1.0f;
        } else {
            lightIntensity = clamp((self.level - lightMinValue) / (ledMaxValue - lightMinValue));
        }
        
        UIColor *fillColor = nil;
        if (lightIntensity == 1.0f) {
            fillColor = ledColor;
        } else if (lightIntensity > 0.0f) {
            CGColorRef color = CGColorCreateCopyWithAlpha([ledColor CGColor], lightIntensity);
            fillColor = [UIColor colorWithCGColor:color];
            CGColorRelease(color);
        }
        
        CGContextSetFillColorWithColor(context, fillColor.CGColor);
        UIBezierPath *fillPath = [UIBezierPath bezierPathWithRoundedRect:ledRect cornerRadius:2.0f];
        CGContextAddPath(context, fillPath.CGPath);
        
        // Stroke border
        CGContextSetStrokeColorWithColor(context, self.ledBorderColor.CGColor);
        UIBezierPath *strokePath = [UIBezierPath bezierPathWithRoundedRect:CGRectInset(ledRect, 0.5, 0.5) cornerRadius:2.0f];
        CGContextAddPath(context, strokePath.CGPath);
        
        CGContextDrawPath(context, kCGPathFillStroke);
        
        lightMinValue = ledMaxValue;
    }
}

CGFloat clamp(CGFloat intensity) {
    if (intensity < 0.0f) {
        return 0.0f;
    } else if (intensity >= 1.0) {
        return 1.0f;
    } else {
        return intensity;
    }
}

- (void)resetLevelMeter {
    self.level = 0.0f;
    self.peakLevel = 0.0f;
    [self setNeedsDisplay];
}


@end
```
è¿™é‡Œç»™å‡ºäº†levelå’Œpeakçš„é˜€å€¼ æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å¼€æºçš„viewå¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ å¾ˆç®€å• å°±æ˜¯æŠŠç›¸å…³é˜€å€¼é‡åŒ–çš„è¿‡ç¨‹ã€‚



æ€»ç»“
--
`AVAudioRecorder` çš„å­¦ä¹ è¿˜ç®—å®Œæ•´çš„æå®Œäº†,éšæ—¶è®°å½•ä¸€ä¸‹å­¦ä¹ å†…å®¹å’ŒæŠ€æœ¯çŸ¥è¯†ã€‚

![](/assets/images/20170328LearningAVFoundationAVAudioRecorder/FinalDemo.webp)

__æœ€ç»ˆ[Demo](https://github.com/sunyazhou13/AVAudioRecorderDemo)__

æ¬¢è¿å¤§å®¶æŒ‡æ­£é”™è¯¯ å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2017/03/CheckNSWindowisFullScreen/index.html.md
Published At: 2017-03-23 14:03:32 +0000

# åˆ¤æ–­NSWindowæ˜¯å¦å…¨å±

``` objc
@interface NSWindow (FullScreen)

- (BOOL)mn_isFullScreen;

@end

@implementation NSWindow (FullScreen)

- (BOOL)mn_isFullScreen
{
    return (([self styleMask] & NSFullScreenWindowMask) == NSFullScreenWindowMask);
}

@end
```

refs:[How to know if a NSWindow is fullscreen in Mac OS X Lion?](http://stackoverflow.com/questions/6815917/how-to-know-if-a-nswindow-is-fullscreen-in-mac-os-x-lion)


URL: https://sunyazhou.com/2017/03/LearningAVFoundationAVAudioPlayer/index.html.md
Published At: 2017-03-17 10:26:06 +0000

# Learning AV Foundation(äºŒ)AVAudioPlayer

![AVAudioPlayer](/assets/images/20170317LearningAVFoundationAVAudioPlayer/cover.webp)

å¼€ç¯‡
--
æœ€è¿‘åœ¨å­¦ä¹ `AV Foundation` è¯•å›¾æŠŠå­¦ä¹ å†…å®¹è®°å½•ä¸‹æ¥ å¹¶å‚è€ƒä¸€äº›åšå®¢æ–‡ç« 
æœ¬æœŸçš„å†…å®¹æ˜¯`AVAudioPlayer`


éŸ³é¢‘çŸ¥è¯†åŸºç¡€  
--

> éŸ³é¢‘æ–‡ä»¶çš„ç”Ÿæˆè¿‡ç¨‹æ˜¯å°†å£°éŸ³ä¿¡æ¯__é‡‡æ ·__ã€__é‡åŒ–__å’Œ__ç¼–ç __äº§ç”Ÿçš„æ•°å­—ä¿¡å·çš„è¿‡ç¨‹ï¼Œ__äººè€³æ‰€èƒ½å¬åˆ°çš„å£°éŸ³ï¼Œæœ€ä½çš„é¢‘ç‡æ˜¯ä»20Hzèµ·ä¸€ç›´åˆ°æœ€é«˜é¢‘ç‡20KHZ__ï¼Œå› æ­¤éŸ³é¢‘æ–‡ä»¶æ ¼å¼çš„æœ€å¤§å¸¦å®½æ˜¯20KHZã€‚æ ¹æ®[å¥ˆå¥æ–¯ç‰¹](https://zh.wikipedia.org/wiki/%E5%A5%88%E5%A5%8E%E6%96%AF%E7%89%B9%E9%A2%91%E7%8E%87)çš„ç†è®ºï¼Œåªæœ‰é‡‡æ ·é¢‘ç‡é«˜äºå£°éŸ³ä¿¡å·æœ€é«˜é¢‘ç‡çš„ä¸¤å€æ—¶ï¼Œæ‰èƒ½æŠŠæ•°å­—ä¿¡å·è¡¨ç¤ºçš„å£°éŸ³è¿˜åŸæˆä¸ºåŸæ¥çš„å£°éŸ³ï¼Œæ‰€ä»¥éŸ³é¢‘æ–‡ä»¶çš„é‡‡æ ·ç‡ä¸€èˆ¬åœ¨__40~50KHZ__ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„CDéŸ³è´¨é‡‡æ ·ç‡__44.1KHZ__ã€‚ (æ‰€ä»¥ä¸€èˆ¬å¤§å®¶éƒ½è§‰å¾—CDéŸ³è´¨æ˜¯æœ€å¥½çš„.) å¯¹å£°éŸ³è¿›è¡Œé‡‡æ ·ã€é‡åŒ–è¿‡ç¨‹è¢«ç§°ä¸º[è„‰å†²ç¼–ç è°ƒåˆ¶](https://zh.wikipedia.org/wiki/%E8%84%88%E8%A1%9D%E7%B7%A8%E8%99%9F%E8%AA%BF%E8%AE%8A)ï¼ˆPulse Code Modulationï¼‰ï¼Œç®€ç§°PCMã€‚PCMæ•°æ®æ˜¯æœ€åŸå§‹çš„éŸ³é¢‘æ•°æ®å®Œå…¨æ— æŸï¼Œæ‰€ä»¥PCMæ•°æ®è™½ç„¶éŸ³è´¨ä¼˜ç§€ä½†ä½“ç§¯åºå¤§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å…ˆåè¯ç”Ÿäº†ä¸€ç³»åˆ—çš„éŸ³é¢‘æ ¼å¼ï¼Œè¿™äº›éŸ³é¢‘æ ¼å¼è¿ç”¨ä¸åŒçš„æ–¹æ³•å¯¹éŸ³é¢‘æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå…¶ä¸­æœ‰æ— æŸå‹ç¼©ï¼ˆALACã€APEã€FLACï¼‰å’Œæœ‰æŸå‹ç¼©ï¼ˆMP3ã€AACã€OGGã€WMAï¼‰ä¸¤ç§ æ¥æº:[iOSéŸ³é¢‘æ’­æ”¾ (ä¸€)ï¼šæ¦‚è¿°](http://msching.github.io/blog/2014/07/07/audio-in-ios/) by [ç å†œäººç”Ÿ](http://msching.github.io/)

--

æˆ‘è§‰å¾—ç¨‹å¯…å¤§ç‰›çš„å¤„ç†éŸ³é¢‘è¯´çš„å¾ˆæ˜ç™½
å¤§ç¥åˆ—å‡ºä¸€ä¸ªç»å…¸çš„éŸ³é¢‘æ’­æ”¾æµç¨‹ï¼ˆä»¥MP3ä¸ºä¾‹ï¼‰

1. è¯»å–MP3æ–‡ä»¶
2. è§£æé‡‡æ ·ç‡ã€ç ç‡ã€æ—¶é•¿ç­‰ä¿¡æ¯ï¼Œåˆ†ç¦»MP3ä¸­çš„éŸ³é¢‘å¸§
3. å¯¹åˆ†ç¦»å‡ºæ¥çš„éŸ³é¢‘å¸§è§£ç å¾—åˆ°PCMæ•°æ®
4. å¯¹PCMæ•°æ®è¿›è¡ŒéŸ³æ•ˆå¤„ç†ï¼ˆå‡è¡¡å™¨ã€æ··å“å™¨ç­‰ï¼Œéå¿…é¡»ï¼‰
5. æŠŠPCMæ•°æ®è§£ç æˆéŸ³é¢‘ä¿¡å·
6. æŠŠéŸ³é¢‘ä¿¡å·äº¤ç»™ç¡¬ä»¶æ’­æ”¾
7. é‡å¤1-6æ­¥ç›´åˆ°æ’­æ”¾å®Œæˆ

åœ¨iOSç³»ç»Ÿä¸­appleå¯¹ä¸Šè¿°çš„æµç¨‹è¿›è¡Œäº†å°è£…å¹¶æä¾›äº†ä¸åŒå±‚æ¬¡çš„æ¥å£ 
![](https://developer.apple.com/library/content/documentation/MusicAudio/Conceptual/CoreAudioOverview/Art/core_audio_layers_2x.webp)  
> è¿™æ˜¯CoreAudioçš„æ¥å£å±‚æ¬¡  

ä¸‹é¢å¯¹å…¶ä¸­çš„ä¸­é«˜å±‚æ¥å£è¿›è¡ŒåŠŸèƒ½è¯´æ˜ï¼š

* Audio File Servicesï¼šè¯»å†™éŸ³é¢‘æ•°æ®ï¼Œå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬2æ­¥ï¼›
* Audio File Stream Servicesï¼šå¯¹éŸ³é¢‘è¿›è¡Œè§£ç ï¼Œå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬2æ­¥ï¼›
* Audio Converter servicesï¼šéŸ³é¢‘æ•°æ®è½¬æ¢ï¼Œå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬3æ­¥ï¼›
* Audio Processing Graph Servicesï¼šéŸ³æ•ˆå¤„ç†æ¨¡å—ï¼Œå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬4æ­¥ï¼›
* Audio Unit Servicesï¼šæ’­æ”¾éŸ³é¢‘æ•°æ®ï¼šå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬5æ­¥ã€ç¬¬6æ­¥ï¼›
* Extended Audio File Servicesï¼šAudio File Serviceså’ŒAudio   
* Converter servicesçš„ç»“åˆä½“ï¼›
* AVAudioPlayer/AVPlayer(AVFoundation)ï¼šé«˜çº§æ¥å£ï¼Œå¯ä»¥å®Œæˆæ•´ä¸ªéŸ³é¢‘æ’­æ”¾çš„è¿‡ç¨‹ï¼ˆåŒ…æ‹¬æœ¬åœ°æ–‡ä»¶å’Œç½‘ç»œæµæ’­æ”¾ï¼Œç¬¬4æ­¥é™¤å¤–ï¼‰ï¼›
* Audio Queue Servicesï¼šé«˜çº§æ¥å£ï¼Œå¯ä»¥è¿›è¡Œå½•éŸ³å’Œæ’­æ”¾ï¼Œå¯ä»¥å®Œæˆæ’­æ”¾æµç¨‹ä¸­çš„ç¬¬3ã€5ã€6æ­¥ï¼›
* OpenALï¼šç”¨äºæ¸¸æˆéŸ³é¢‘æ’­æ”¾ï¼Œæš‚ä¸è®¨è®º

å¯ä»¥çœ‹åˆ°appleæä¾›çš„æ¥å£ç±»å‹éå¸¸ä¸°å¯Œï¼Œå¯ä»¥æ»¡è¶³å„ç§ç±»åˆ«ç±»éœ€æ±‚ï¼š  

* å¦‚æœä½ åªæ˜¯æƒ³å®ç°éŸ³é¢‘çš„æ’­æ”¾ï¼Œæ²¡æœ‰å…¶ä»–éœ€æ±‚AVFoundationä¼šå¾ˆå¥½çš„æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚å®ƒçš„æ¥å£ä½¿ç”¨ç®€å•ã€ä¸ç”¨å…³å¿ƒå…¶ä¸­çš„ç»†èŠ‚ï¼›

* å¦‚æœä½ çš„appéœ€è¦å¯¹éŸ³é¢‘è¿›è¡Œæµæ’­æ”¾å¹¶ä¸”åŒæ—¶å­˜å‚¨ï¼Œé‚£ä¹ˆAudioFileStreameråŠ AudioQueueèƒ½å¤Ÿå¸®åˆ°ä½ ï¼Œä½ å¯ä»¥å…ˆæŠŠéŸ³é¢‘æ•°æ®ä¸‹è½½åˆ°æœ¬åœ°ï¼Œä¸€è¾¹ä¸‹è½½ä¸€è¾¹ç”¨NSFileHandlerç­‰æ¥å£è¯»å–æœ¬åœ°éŸ³é¢‘æ–‡ä»¶å¹¶äº¤ç»™AudioFileStreameræˆ–è€…AudioFileè§£æåˆ†ç¦»éŸ³é¢‘å¸§ï¼Œåˆ†ç¦»å‡ºæ¥çš„éŸ³é¢‘å¸§å¯ä»¥é€ç»™AudioQueueè¿›è¡Œè§£ç å’Œæ’­æ”¾ã€‚å¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ç›´æ¥è¯»å–æ–‡ä»¶è§£æå³å¯ã€‚ï¼ˆè¿™ä¸¤ä¸ªéƒ½æ˜¯æ¯”è¾ƒç›´æ¥çš„åšæ³•ï¼Œè¿™ç±»éœ€æ±‚ä¹Ÿå¯ä»¥ç”¨AVFoundation+æœ¬åœ°serverçš„æ–¹å¼å®ç°ï¼ŒAVAudioPlayerä¼šæŠŠè¯·æ±‚å‘é€ç»™æœ¬åœ°serverï¼Œç”±æœ¬åœ°serverè½¬å‘å‡ºå»ï¼Œè·å–æ•°æ®ååœ¨æœ¬åœ°serverä¸­å­˜å‚¨å¹¶è½¬é€ç»™AVAudioPlayerã€‚å¦ä¸€ä¸ªæ¯”è¾ƒtrickçš„åšæ³•æ˜¯å…ˆæŠŠéŸ³é¢‘ä¸‹è½½åˆ°æ–‡ä»¶ä¸­ï¼Œåœ¨ä¸‹è½½åˆ°ä¸€å®šé‡çš„æ•°æ®åæŠŠæ–‡ä»¶è·¯å¾„ç»™AVAudioPlayeræ’­æ”¾ï¼Œå½“ç„¶è¿™ç§åšæ³•åœ¨éŸ³é¢‘seekåå°±å›æœ‰é—®é¢˜äº†ã€‚ï¼‰
* å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªä¸“ä¸šçš„éŸ³ä¹æ’­æ”¾è½¯ä»¶ï¼Œéœ€è¦å¯¹éŸ³é¢‘æ–½åŠ éŸ³æ•ˆï¼ˆå‡è¡¡å™¨ã€æ··å“å™¨ï¼‰ï¼Œé‚£ä¹ˆé™¤äº†æ•°æ®çš„è¯»å–å’Œè§£æä»¥å¤–è¿˜éœ€è¦ç”¨åˆ°AudioConverteræ¥æŠŠéŸ³é¢‘æ•°æ®è½¬æ¢æˆPCMæ•°æ®ï¼Œå†ç”±AudioUnit+AUGraphæ¥è¿›è¡ŒéŸ³æ•ˆå¤„ç†å’Œæ’­æ”¾ï¼ˆä½†ç›®å‰å¤šæ•°å¸¦éŸ³æ•ˆçš„appéƒ½æ˜¯è‡ªå·±å¼€å‘éŸ³æ•ˆæ¨¡å—æ¥åPCMæ•°æ®çš„å¤„ç†ï¼Œè¿™éƒ¨åˆ†åŠŸèƒ½è‡ªè¡Œå¼€å‘åœ¨è‡ªå®šä¹‰æ€§å’Œæ‰©å±•æ€§ä¸Šä¼šæ¯”è¾ƒå¼ºä¸€äº›ã€‚PCMæ•°æ®é€šè¿‡éŸ³æ•ˆå™¨å¤„ç†å®Œæˆåå°±å¯ä»¥ä½¿ç”¨AudioUnitæ’­æ”¾äº†ï¼Œå½“ç„¶AudioQueueä¹Ÿæ”¯æŒç›´æ¥ä½¿å¯¹PCMæ•°æ®è¿›è¡Œæ’­æ”¾ã€‚ï¼‰ã€‚ä¸‹å›¾æè¿°çš„å°±æ˜¯ä½¿ç”¨AudioFile + AudioConverter + AudioUnitè¿›è¡ŒéŸ³é¢‘æ’­æ”¾çš„æµç¨‹

![](http://msching.github.io/images/iOS-audio/audioUnitPlay.webp)

ä»¥ä¸Šå†…å®¹å‡è½¬è‡ª[ç å†œäººç”Ÿ](http://msching.github.io/blog/2014/07/07/audio-in-ios/) å¸Œæœ›å¤§ç¥ä¸è¦ä»‹æ„ å¦‚æœæœ‰é—®é¢˜ æˆ‘å¯ç«‹å³æ¸…é™¤


   

ä½¿ç”¨`AVAudioPlayer `ä¹‹å‰å¯¹AudioSessionç®€ä»‹
--
> `AVAudioSession`è´Ÿè´£ç®¡ç†éŸ³é¢‘ä¼šè¯ å®ƒæ˜¯ä¸ªå•ä¾‹ åœ¨åº”ç”¨ç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´è´Ÿè´£ä¸­é—´äººçš„è§’è‰² [AudioSessionå‚è€ƒ](http://msching.github.io/blog/2014/07/08/audio-in-ios-2/) 

`AVAudioSession`ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

* appæ˜¯å¦‚ä½•ä½¿ç”¨çš„éŸ³é¢‘æœåŠ¡ æ’­æ”¾ è¿˜æ˜¯å½•åˆ¶ ä¹‹ç±»çš„
* æ§åˆ¶åè°ƒappè¾“å…¥è¾“å‡ºè®¾å¤‡ï¼ˆæ¯”å¦‚ éº¦å…‹é£ï¼Œè€³æœºã€æ‰‹æœºå¤–æ”¾æ¯”å¦‚è“ç‰™è¿æ¥ä¸€ä¸ªå¤–ç½®éŸ³å“ æˆ–airplayï¼‰
* åè°ƒä½ çš„appçš„éŸ³é¢‘æ’­æ”¾å’Œç³»ç»Ÿä»¥åŠå…¶ä»–appè¡Œä¸ºï¼ˆä¾‹å¦‚æœ‰ç”µè¯æ—¶éœ€è¦æ‰“æ–­ï¼Œç”µè¯ç»“æŸæ—¶éœ€è¦æ¢å¤ï¼ŒæŒ‰ä¸‹é™éŸ³æŒ‰é’®æ—¶æ˜¯å¦æ­Œæ›²ä¹Ÿè¦é™éŸ³ç­‰ï¼‰

![](https://developer.apple.com/library/content/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Art/aspg_intro_2x.webp)

*æ³¨ï¼šAVAudioSession iOS6ä»¥åä½¿ç”¨ ä»¥å‰å«AudioSession*

å¦‚ä½•ä½¿ç”¨`AVAudioPlayer`
--

åœ¨æˆ‘çš„åšå®¢é‡Œé¢æˆ‘å°½é‡ä½¿ç”¨codeèƒœè¿‡åƒè¨€ä¸‡è¯­
ä½¿ç”¨`AVAudioPlayer`ä¹‹å‰éœ€è¦åœ¨`AppDelegate`é‡Œé¢å¯¼å…¥`#import <AVFoundation/AVFoundation.h>`  
å¹¶ä¸”å¯åŠ¨éŸ³é¢‘ä¼šè¯


``` objc  

- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    
    AVAudioSession *session = [AVAudioSession sharedInstance];
    NSError *error;
    if (![session setCategory:AVAudioSessionCategoryPlayback error:&error]) {
        NSLog(@"Category Error: %@", [error localizedDescription]);
    }
    
    if (![session setActive:YES error:&error]) {
        NSLog(@"Activation Error: %@", [error localizedDescription]);
    }
    
    return YES;
}
```

ä¸Šè¾¹å·²ç»ä»‹ç»äº†`AVAudioSession`  

è¿™é‡Œé¢è¯´ä¸€ä¸‹`[session setCategory:AVAudioSessionCategoryPlayback error:&error]` é‡Œé¢çš„`AVAudioSessionCategoryPlayback`

![éŸ³é¢‘ä¼šè¯åˆ†ç±»](/assets/images/20170317LearningAVFoundationAVAudioPlayer/AVAudioPlayerCategory.webp)

è¿™æ˜¯è¿™å‡ ç§åˆ†ç±»çš„åˆ—è¡¨å¤§å®¶å¯ä»¥çœ‹ä¸‹

è®°å¾—å¼€å¯åå°æ’­æ”¾
![](/assets/images/20170317LearningAVFoundationAVAudioPlayer/BackgounrdPlay.webp)  
æˆ–è€…åœ¨plisté‡Œé¢ä¿®æ”¹
![](/assets/images/20170317LearningAVFoundationAVAudioPlayer/PlistModify.webp)  


ä¸‹é¢å°±æ˜¯åˆ›å»ºéŸ³é¢‘æ’­æ”¾å™¨ä»£ç 

``` objc

#import "ViewController.h"
#import <Masonry/Masonry.h>

#import "THControlKnob.h"
#import "THPlayButton.h"
#import <AVFoundation/AVFoundation.h>

@interface ViewController ()

//ä¸‰ä¸ªæ§åˆ¶æ¨å­
@property (weak, nonatomic) IBOutlet THOrangeControlKnob *panKnob;
@property (weak, nonatomic) IBOutlet THOrangeControlKnob *volumnKnob;
@property (weak, nonatomic) IBOutlet THGreenControlKnob *rateKnob;
@property (weak, nonatomic) IBOutlet THPlayButton *playButton;

//éŸ³ä¹æ’­æ”¾å™¨
@property (nonatomic, strong) AVAudioPlayer *musicPlayer;
@property (nonatomic, getter = isPlaying) BOOL playing; //æ’­æ”¾çŠ¶æ€

//æ— å…³ä»£ç 
@property (weak, nonatomic) IBOutlet UILabel *LeftRightRoundDec;
@property (weak, nonatomic) IBOutlet UILabel *voiceDec;
@property (weak, nonatomic) IBOutlet UILabel *rateDec;
@property (weak, nonatomic) IBOutlet UILabel *trackDescrption;

@end  

```

> å¯¼å…¥å‡ ä¸ªç¬¬ä¸‰æ–¹æ§ä»¶çš„ç±»ç”¨äºéŸ³ä¹æ’­æ”¾

![](/assets/images/20170317LearningAVFoundationAVAudioPlayer/Buttons.webp)

è¿™ä¸Šè¾¹çš„ä¸‰ä¸ªæ—‹é’®å°±æ˜¯å¯¼å…¥çš„å¼€æºåº“

ä¸‹é¢åˆ›å»ºæ’­æ”¾å™¨`AVAudioPlayer`  
åˆ›å»ºæ—¶éœ€è¦ä¸€ä¸ª`NSURL`ä»£è¡¨è¦æ’­æ”¾çš„æ–‡ä»¶è·¯å¾„ è¿™é‡Œç®€å•ä»bundleä¸­æ‹–äº†ä¸€é¦–æ­Œè¿›å»äº†
 
  
``` objc

#pragma mark -
#pragma mark - åˆ›å»ºAVAudioPlayerä¸æ’­æ”¾çŠ¶æ€æ§åˆ¶
/**
 åˆ›å»ºéŸ³ä¹æ’­æ”¾å™¨
 
 @param fileName æ–‡ä»¶å
 @param fileExtension æ–‡ä»¶æ‰©å±•å
 @return æ’­æ”¾å™¨å®ä¾‹
 */
- (AVAudioPlayer *)createPlayForFile:(NSString *)fileName
                       withExtension:(NSString *)fileExtension{
    NSURL *url = [[NSBundle mainBundle] URLForResource:fileName withExtension:fileExtension];
    NSError *error = nil;
    AVAudioPlayer *audioPlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:url error:&error];
    if (audioPlayer) {
        audioPlayer.numberOfLoops = -1; //-1æ— é™å¾ªç¯
        audioPlayer.enableRate = YES; //å¯åŠ¨å€é€Ÿæ§åˆ¶
        [audioPlayer prepareToPlay];
    } else {
        NSLog(@"Error creating player: %@",[error localizedDescription]);
    }
    return audioPlayer;
}

```

`numberOfLoops` = -1; ä»£è¡¨æœ¬é¦–æ­Œ æ— é™å¾ªç¯ å…¶å®ƒå¸¸æ•°ä»£è¡¨å¾ªç¯æ¬¡æ•°     
`enableRate` ä»£è¡¨æ˜¯å¦å¯ç”¨å€é€Ÿè°ƒèŠ‚ 0.5x 1.0x 2.0x ç­‰å€é€Ÿ 1.0ä»£è¡¨æ­£å¸¸é€Ÿåº¦

è¿™é‡Œè¯´ä¸€ä¸‹`[audioPlayer prepareToPlay]`
__è°ƒç”¨è¿™ä¸ªå‡½æ•°æ˜¯ä¸ºäº†å–å¾—éœ€è¦çš„éŸ³é¢‘ç¡¬ä»¶å¹¶é¢„åŠ è½½`Audio Queue`çš„ç¼“å†²åŒº.__ å½“ç„¶ä¹Ÿå¯ä»¥ä¸è°ƒç”¨è¿™ä¸ªæ–¹æ³•ç›´æ¥è°ƒç”¨ `[audioPlayer play]`ï¼Œä½†å½“  __è°ƒç”¨`play`æ–¹æ³•æ—¶ä¹Ÿä¼šéšæ€§æ¿€æ´»__,è°ƒç”¨`prepareToPlay`æ˜¯ä¸ºäº†å‡å°‘ åˆ›å»ºæ’­æ”¾å™¨æ—¶é¢„è®¾åŠ è½½å’Œå¬åˆ°å£°éŸ³è¾“å‡ºä¹‹é—´çš„å»¶æ—¶ 


``` objc

@implementation ViewController

- (instancetype)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        if (self.musicPlayer == nil) {
            self.musicPlayer = [self createPlayForFile:@"384551_1438267683" withExtension:@"mp3"];
        }
        [self setupNotifications];
    }
    return self;
}

- (void)awakeFromNib{
    [super awakeFromNib];
    if (self.musicPlayer == nil) {
        self.musicPlayer = [self createPlayForFile:@"384551_1438267683" withExtension:@"mp3"];
    }
    [self setupNotifications];
    
}


```

> åœ¨`initWithNibName`æˆ–`awakeFromNib`æ—¶å€™è°ƒç”¨ä¸€ä¸‹åˆ›å»ºæ’­æ”¾å™¨çš„ä»£ç   
è¿™ä¸ª`[self setupNotifications];`åé¢è¯´  


å…ˆæ·»åŠ ä¸€äº›å¸¸è§çš„æ–¹æ³•å°è£… æ¯”å¦‚ __æ’­æ”¾ã€æš‚åœã€åœæ­¢__
``` objc 

- (void)play {
    if (self.musicPlayer == nil) { return; }
    
    if (!self.playing) {
        NSTimeInterval delayTime = [self.musicPlayer deviceCurrentTime] + 0.01;
        [self.musicPlayer playAtTime:delayTime];
        self.playing = YES;
    }
    
    self.trackDescrption.text = [self.musicPlayer.url absoluteString];
    [self configNowPlayingInfoCenter]; //é…ç½®åå°æ’­æ”¾çš„é¡µé¢ä¿¡æ¯
}
- (void)stop {
    if (self.musicPlayer == nil) { return; }
    if (self.playing) {
        [self.musicPlayer stop];
        self.musicPlayer.currentTime = 0.0f;
        self.playing = NO;
    }
}

- (void)pause {
    if (self.musicPlayer == nil) { return; }
    if (self.playing) {
        [self.musicPlayer pause];
        self.playing = NO;
    }
}

```
è¿™é‡Œçœ‹åˆ°`[self.musicPlayer deviceCurrentTime] + 0.01` åŠ äº† -0.01çš„å»¶æ—¶, æ˜¯ä¸ºäº†ä»¥åå¤§å®¶åšæ’­æ”¾å™¨çš„æ—¶å€™ æœ‰å¯èƒ½æš‚åœæˆ–è€…æ­Œæ›²åˆ‡æ¢æ—¶ æœ‰å¯èƒ½ å‘å‰å‘ååšç‰‡æ®µè¡”æ¥, ä¹Ÿæ˜¯ä¸ºäº†ä½¿ç”¨ `playAtTime`å»æ’­æ”¾ æŒ‡å®šä½ç½®çš„éŸ³ä¹ç”¨äº æ„å¤–æš‚åœæˆ–è€…æ’­æ”¾ä¸Šæ¬¡æ’­æ”¾çš„é…ç½®ä¿¡æ¯ä½¿ç”¨ è¿™é‡Œçœ‹åˆ°æˆ‘å†™äº†ä¸€ä¸ª  
`[self configNowPlayingInfoCenter];`é…ç½®åå°æ’­æ”¾çš„é¡µé¢ä¿¡æ¯
è¿™ä¸ªä¸»è¦ç”¨äºæ’­æ”¾éŸ³ä¹åœ¨åå°æ—¶ é”å±æ˜¾ç¤ºçš„å±å¹•ä¿¡æ¯  è¯·çœ‹ä¸‹é¢ä»£ç 

``` objc
//è®¾ç½®é”å±çŠ¶æ€ï¼Œæ˜¾ç¤ºçš„æ­Œæ›²ä¿¡æ¯
-(void)configNowPlayingInfoCenter{
    if (NSClassFromString(@"MPNowPlayingInfoCenter")) {
        NSMutableDictionary *dict = [[NSMutableDictionary alloc] init];
        
        //æ­Œæ›²åç§°
        [dict setObject:@"æ­Œæ›²åç§°" forKey:MPMediaItemPropertyTitle];
        
        //æ¼”å”±è€…
        [dict setObject:@"æ¼”å”±è€…" forKey:MPMediaItemPropertyArtist];
        
        //ä¸“è¾‘å
        [dict setObject:@"ä¸“è¾‘å" forKey:MPMediaItemPropertyAlbumTitle];
        
        //ä¸“è¾‘ç¼©ç•¥å›¾
        UIImage *image = [UIImage imageNamed:@"sunyazhou"];
        MPMediaItemArtwork *artwork = [[MPMediaItemArtwork alloc] initWithImage:image];
        [dict setObject:artwork forKey:MPMediaItemPropertyArtwork];
        
        //éŸ³ä¹å‰©ä½™æ—¶é•¿
        [dict setObject:@20 forKey:MPMediaItemPropertyPlaybackDuration];
        
        //éŸ³ä¹å½“å‰æ’­æ”¾æ—¶é—´ åœ¨è®¡æ—¶å™¨ä¸­ä¿®æ”¹
       // [dict setObject:[NSNumber numberWithDouble:100.0] forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime];
        
        //è®¾ç½®é”å±çŠ¶æ€ä¸‹å±å¹•æ˜¾ç¤ºæ’­æ”¾éŸ³ä¹ä¿¡æ¯
        [[MPNowPlayingInfoCenter defaultCenter] setNowPlayingInfo:dict];
    }
}

```

å¦‚æœéœ€è¦åœ¨è®¡æ—¶å™¨ä¸­ä¸æ–­åˆ·æ–°é”å±çŠ¶æ€ä¸‹çš„æ’­æ”¾è¿›åº¦æ¡è¯·å†™å¦‚ä¸‹ä»£ç 

``` objc 
//è®¡æ—¶å™¨ä¿®æ”¹è¿›åº¦
- (void)changeProgress:(NSTimer *)sender{
    if(self.player){
        //å½“å‰æ’­æ”¾æ—¶é—´
        NSMutableDictionary *dict = [NSMutableDictionary dictionaryWithDictionary:[[MPNowPlayingInfoCenter defaultCenter] nowPlayingInfo]];
        [dict setObject:[NSNumber numberWithDouble:self.player.currentTime] forKey:MPNowPlayingInfoPropertyElapsedPlaybackTime]; //éŸ³ä¹å½“å‰å·²ç»è¿‡æ—¶é—´
        [[MPNowPlayingInfoCenter defaultCenter] setNowPlayingInfo:dict];
 
    }
}
```

> å‚è€ƒ[IOSåå°è¿è¡Œ ä¹‹ åå°æ’­æ”¾éŸ³ä¹](http://www.iliunian.com/2831.html) 

ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸‹
`[self setupNotifications];`æ³¨å†Œç›‘å¬ éŸ³é¢‘æ„å¤–ä¸­æ–­å’Œè€³æœºæ‹”å‡ºæ—¶è¦æš‚åœéŸ³ä¹æ’­æ”¾
å®ç°ä»£ç å¦‚ä¸‹

``` objc 
/**
 æ’­æ”¾çš„é€šçŸ¥å¤„ç†
 */
- (void)setupNotifications {
    NSNotificationCenter *nsnc = [NSNotificationCenter defaultCenter];
    
    //æ·»åŠ æ„å¤–ä¸­æ–­éŸ³é¢‘æ’­æ”¾çš„é€šçŸ¥
    [nsnc addObserver:self
             selector:@selector(handleInterruption:)
                 name:AVAudioSessionInterruptionNotification
               object:[AVAudioSession sharedInstance]];
    
    //æ·»åŠ çº¿è·¯å˜åŒ–é€šçŸ¥
    [nsnc addObserver:self
             selector:@selector(hanldeRouteChange:)
                 name:AVAudioSessionRouteChangeNotification
               object:[AVAudioSession sharedInstance]];
}


```

*æ³¨ï¼šè®°å¾—åœ¨dellocé‡Œé¢`[[NSNotificationCenter defaultCenter] removeObserver:self]`*


æ„å¤–ä¸­æ–­éŸ³é¢‘å‘ç”Ÿçš„åœºæ™¯ ä¾‹å¦‚ å¬æ­Œè¿‡ç¨‹ä¸­æ¥ç”µè¯æˆ–è€… æŒ‰ä½homeé”®ä½¿ç”¨siri 

ä¸‹é¢æ˜¯å…·ä½“æ–¹æ³•å®ç°

``` objc 
/**
 éŸ³é¢‘æ„å¤–æ‰“æ–­å¤„ç†

 @param notification é€šçŸ¥ä¿¡æ¯
 */
- (void)handleInterruption:(NSNotification *)notification {
    NSDictionary *info = notification.userInfo;
    AVAudioSessionInterruptionType type = [info[AVAudioSessionInterruptionTypeKey] unsignedIntegerValue];
    if (type == AVAudioSessionInterruptionTypeBegan) {
        //Handle AVAudioSessionInterruptionTypeBegan
        [self pause];
    } else {
        //Handle AVAudioSessionInterruptionTypeEnded
        AVAudioSessionInterruptionOptions options = [info[AVAudioSessionInterruptionTypeKey] unsignedIntegerValue];
        NSError *error = nil;
        //æ¿€æ´»éŸ³é¢‘ä¼šè¯ å…è®¸å¤–æ¥éŸ³å“
        [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback
                                         withOptions:AVAudioSessionCategoryOptionAllowBluetooth error:nil];
        [[AVAudioSession sharedInstance] setActive:YES withOptions:AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation error:&error];
        if (options == AVAudioSessionInterruptionOptionShouldResume) {
            [self play];
        } else {
            [self play];
        }
        
        
        self.playButton.selected = YES;
        
        if (error) {
            NSLog(@"AVAudioSessionInterruptionOptionShouldResumeå¤±è´¥:%@",[error localizedDescription]);
        }
    }
}



```

å…ˆè¯´`handleInterruption`æ„å¤–æƒ…å†µä¸‹ä¸­æ–­æ¯”å¦‚æˆ‘æŒ‰ä½homeé”®ä½¿ç”¨siri
æˆ‘ä¼šæ”¶åˆ°æ„å¤–æ‰“æ–­çš„é€šçŸ¥å½“ type == `AVAudioSessionInterruptionTypeBegan`æ—¶ æˆ‘ä»¬åœæ­¢éŸ³ä¹æ’­æ”¾æˆ–è€…æš‚åœ.
å½“type != `AVAudioSessionInterruptionTypeBegan`çš„æ—¶å€™ä¸€å®šæ˜¯`AVAudioSessionInterruptionTypeEnded`è¿™ä¸ªæ—¶å€™`notification.userInfo`é‡Œé¢åŒ…å«ä¸€ä¸ª`AVAudioSessionInterruptionOptions`å€¼æ¥è¡¨æ˜éŸ³é¢‘ä¼šè¯æ˜¯å¦å·²ç»é‡æ–°æ¿€æ´»ä»¥åŠæ˜¯å¦å¯ä»¥å†æ¬¡æ’­æ”¾

__*æ³¨:è¿™ä¸ªåœ°æ–¹é‡åˆ°ä¸ªå‘*__ å½“æ„å¤–ä¸­æ–­æ—¶å€™æœ‰æ—¶éŸ³é¢‘ä¼šè¯ä¼šå¾ˆä¸çµæ• åæ¥å‘ç°è¿™ç§æƒ…å†µä¸‹éœ€è¦é‡æ–°æ¿€æ´»ä¼šè¯ å¦‚ä¸‹ä»£ç :
  
``` objc
[[AVAudioSession sharedInstance] setActive:YES withOptions:AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation error:&error];
```
è¿™é‡Œ`AVAudioSessionSetActiveOptionNotifyOthersOnDeactivation`æ˜¯ä¸ºäº†é€šçŸ¥å…¶å®ƒåº”ç”¨ä¼šè¯è¢«æˆ‘æ¿€æ´»äº† å¾ˆå¤šæ’­æ”¾å™¨å¼€å‘è€…å¾ˆä¸è®²ç©¶ æ¯æ¬¡ä»æ¥ä¸ç”¨è¿™ä¸ªæ–¹æ³•å¯¼è‡´æ¯æ¬¡åˆ«äººæ’­æ”¾å®ŒéŸ³é¢‘ è‡ªå·±éƒ½æ”¶ä¸åˆ°éŸ³é¢‘é‡æ–°æ’­æ”¾çš„ä¿¡æ¯ å»ºè®®å¤§å®¶ä»¥å’Œä¸ºè´µ, å†™è‰¯å¿ƒä»£ç .

å› ä¸ºæˆ‘å¤–æ¥çš„å°ç±³è“ç‰™éŸ³å“å‘ç°è¿˜æ˜¯ä¸å¥½ä½¿ æœ€ååˆè¡¥ä¸Šäº†`AVAudioSessionCategoryOptionAllowBluetooth`è¿™ä¸ª  
  
__æ¿€æ´»éŸ³é¢‘ä¼šè¯ å…è®¸å¤–æ¥éŸ³å“__

``` objc
[[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback withOptions:AVAudioSessionCategoryOptionAllowBluetooth error:nil];

```

å°±å¥½ä½¿äº†

ä¸‹é¢è¯´ä¸€ä¸‹è€³æœºæ’æ‹”æˆ–è€…USBéº¦å…‹é£æ–­å¼€ Appleæœ‰ä¸ªä»€ä¹ˆ`Human Interface Guidelines(HIG)`ç›¸å…³å®šä¹‰ æ„æ€æ˜¯è¯´å½“ç¡¬ä»¶è€³æœºæ‹”å‡ºæ—¶å»ºè®® æš‚åœæ’­æ”¾éŸ³ä¹æˆ–è€…éº¦å…‹é£æ–­å¼€æ—¶ã€‚å°±æ˜¯å¤„äºé™éŸ³çŠ¶æ€ã€‚æ˜¯ä¸ºäº†ä¿å¯†æ’­æ”¾å†…å®¹ä¸è¢«å¤–ç•Œå¬åˆ°,ä¸ç®¡è‹¹æœå•¥è§„å®š æˆ‘ä»¬éƒ½å¾—ç…§åŠ å¦åˆ™å°±å¾—è¢«æ‹’ã€‚

``` objc
- (void)hanldeRouteChange:(NSNotification *)notification {
    NSDictionary *info = notification.userInfo;
    AVAudioSessionRouteChangeReason reason = [info[AVAudioSessionRouteChangeReasonKey] unsignedIntegerValue];
    //è€è®¾å¤‡ä¸å¯ç”¨
    if (reason == AVAudioSessionRouteChangeReasonOldDeviceUnavailable) {
        AVAudioSessionRouteDescription *previousRoute = info[AVAudioSessionRouteChangePreviousRouteKey];
        AVAudioSessionPortDescription *previousOutput = previousRoute.outputs[0];
        NSString *portType = previousOutput.portType;
        if ([portType isEqualToString:AVAudioSessionPortHeadphones]) {
            [self stop];
            self.playButton.selected = NO;
        }
        
    }
    
}
```

è¿™éœ€è¦ç”¨`AVAudioSessionRouteChangeReasonKey`å–å‡ºçº¿è·¯åˆ‡æ¢çš„åŸå› `AVAudioSessionRouteChangeReason` åŸå› æœ‰è¿™ä¹ˆå¤š

``` objc 
typedef NS_ENUM(NSUInteger, AVAudioSessionRouteChangeReason)
{
	AVAudioSessionRouteChangeReasonUnknown = 0,
	AVAudioSessionRouteChangeReasonNewDeviceAvailable = 1,
	AVAudioSessionRouteChangeReasonOldDeviceUnavailable = 2,
	AVAudioSessionRouteChangeReasonCategoryChange = 3,
	AVAudioSessionRouteChangeReasonOverride = 4,
	AVAudioSessionRouteChangeReasonWakeFromSleep = 6,
	AVAudioSessionRouteChangeReasonNoSuitableRouteForCategory = 7,
	AVAudioSessionRouteChangeReasonRouteConfigurationChange NS_ENUM_AVAILABLE_IOS(7_0) = 8
} NS_AVAILABLE_IOS(6_0);

```
æˆ‘ä»¬éœ€è¦è¿™ä¸ª`AVAudioSessionRouteChangeReasonOldDeviceUnavailable` åˆ¤æ–­æ˜¯å¦æ˜¯æ—§è®¾å¤‡
é€šè¿‡`AVAudioSessionRouteChangePreviousRouteKey`æ‹¿å‡º

`AVAudioSessionRouteDescription`æè¿°ä¿¡æ¯  
`previousRoute` åœ¨é€šè¿‡  
`previousRoute.outputs[0]`æ‹¿å‡º`AVAudioSessionPortDescription`

æ‹¿å‡º`NSString *portType = previousOutput.portType`

å¦‚æœ`[portType isEqualToString:AVAudioSessionPortHeadphones]`

å¦‚æœæ˜¯è€³æœº`AVAudioSessionPortHeadphones`åˆ™æš‚åœæ’­æ”¾


ä»¥ä¸Šå°±æ˜¯ä¸­æ–­å’Œçº¿è·¯åˆ‡æ¢çš„ä¸€äº›ä»£ç é€»è¾‘

ä¸‹é¢æˆ‘ä»‹ç»ä¸€äº›å¥½ç©çš„

![](/assets/images/20170317LearningAVFoundationAVAudioPlayer/demo.webp)

å‰é¢è¯´çš„ä¸€äº›åå°è®¾ç½®ä¿¡æ¯æ˜¾ç¤ºçš„å†…å®¹å°±æ˜¯ä¸Šå›¾æ‰€ç¤º åœ¨é”å±çš„æ—¶å€™æ˜¾ç¤º

ä½†æ˜¯å¤§å®¶ä¸€å®šå¾ˆå¥‡æ€ªçš„æ˜¯æ€ä¹ˆå®ç°æ¥æ”¶ __é”å±çŠ¶æ€ä¸‹ ç‚¹å‡» ä¸Šä¸€æ›² æš‚åœ/æ’­æ”¾ ä¸‹ä¸€æ›²ç­‰æ“ä½œ__

éœ€è¦åœ¨AppDelegateé‡Œé¢å†™ä¸Š

``` objc
- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions {
    
    AVAudioSession *session = [AVAudioSession sharedInstance];
    NSError *error;
    if (![session setCategory:AVAudioSessionCategoryPlayback error:&error]) {
        NSLog(@"Category Error: %@", [error localizedDescription]);
    }
    
    if (![session setActive:YES error:&error]) {
        NSLog(@"Activation Error: %@", [error localizedDescription]);
    }
    
    [[UIApplication sharedApplication] beginReceivingRemoteControlEvents];
    [self becomeFirstResponder];
    return YES;
}

```

è¿™`[[UIApplication sharedApplication] beginReceivingRemoteControlEvents];`
è¡Œä»£ç  ä»¥åŠè°ƒç”¨è‡ªå·±ä¸º `[self becomeFirstResponder];`ç¬¬ä¸€å“åº”è€… è¿™æ ·å†™æ˜¯ä¸ºäº†åº”ç”¨å“åº”éŸ³é¢‘æ’­æ”¾ åå°åˆ‡æ¢æˆ–è€…ä¸­æ–­çš„æ—¶å€™æ›´çµæ•.

``` objc 
- (BOOL)canBecomeFirstResponder {
    return YES;
}
```

ç„¶å å†™ä¸Šå¦‚ä¸‹ä»£ç  å¤„ç†__é”å±çŠ¶æ€ä¸‹ ç‚¹å‡» ä¸Šä¸€æ›² æš‚åœ/æ’­æ”¾ ä¸‹ä¸€æ›²ç­‰æ“ä½œ__

``` objc
- (void)remoteControlReceivedWithEvent:(UIEvent *)event {
    if (event.type == UIEventTypeRemoteControl) {
        switch (event.subtype) {
            case UIEventSubtypeRemoteControlPlay:
                NSLog(@"æš‚åœæ’­æ”¾");
                break;
            case UIEventSubtypeRemoteControlPause:
                
                NSLog(@"ç»§ç»­æ’­æ”¾");
                break;
            case UIEventSubtypeRemoteControlNextTrack:
                NSLog(@"ä¸‹ä¸€æ›²");
                break;
            case UIEventSubtypeRemoteControlPreviousTrack:
                NSLog(@"ä¸Šä¸€æ›²");
                break;
            default:
                break;
        }
    }
}

```

å‰©ä½™é€»è¾‘å¤§å®¶è‡ªå·±å¡«å……å§æˆ‘å°±ä¸ä»‹ç»äº†. 

å¥½äº†AVAudioPlayerå°±åˆ°è¿™å§ï¼æœ‰å•¥ç–‘é—®å¤§å®¶å¯ä»¥è¯„è®ºç•™è¨€éƒ½èƒ½çœ‹åˆ°æˆ–è€…æŒ‡æ­£æˆ‘çš„é”™è¯¯ã€‚æˆ‘ä¼šåŠæ—¶æ”¹æ­£.

å…¨æ–‡å®Œ

__æ–‡ç« çš„æœ€ç»ˆ[demo](https://github.com/sunyazhou13/AVAudioPlayerDemo)__



URL: https://sunyazhou.com/2017/03/LearningAVFoundationAVSpeechSynthesizer/index.html.md
Published At: 2017-03-11 12:38:53 +0000

# Learning AV Foundation(ä¸€)æ±‰å­—è¯­éŸ³æœ—è¯»

![AVSpeechSynthesizer](/assets/images/20170311LearningAVFoundationAVSpeechSynthesizer/Cover.webp)

å‰è¨€

> æœ€è¿‘åœ¨ç ”ç©¶`AV Foundation` æ¡†æ¶ å‘ç°æœ‰ä¸€æœ¬ä¹¦å«åš  
[AV Foundationå¼€å‘ç§˜ç±ï¼šå®è·µæŒæ¡iOS & OS X åº”ç”¨çš„è§†å¬å¤„ç†æŠ€æœ¯](http://item.jd.com/11742630.html)  
ç„¶ågoogleæŸ¥äº†ä¸€ä¸‹è‹±æ–‡ç‰ˆå«  
[Learning AV Foundation: A Hands-on Guide to Mastering the AV Foundation Framework](http://www.informit.com/store/learning-av-foundation-a-hands-on-guide-to-mastering-9780321961808)  
çœ‹ç€å›½äººçš„ç¿»è¯‘ä¸ä»…æ…¨å¹çš„æƒ³è¯´ä¸€å¥è¯: ä¸ºå•¥ä¸è‡ªå·±å†™ä¸€æœ¬ä¹¦ ä½•å¿…è¿™ä¹ˆè´¹åŠ²ç¿»è¯‘å®ƒæå¾—åŸæ¥å¾ˆæœ‰æŠ€æœ¯å«é‡ è¿™ä¹ˆç›´è¯‘å°±æ²¡æŠ€æœ¯å«é‡äº†ã€‚çœ‹ç€å¼€å‘ç§˜ç±è¿™åå­—ä¸ç¦æƒ³èµ·å¤§å­¦æ—¶é‚£äº›ä¹¦ ä»å¼€å‘åˆ°å…¥é—¨... 21å¤©å­¦ä¼šxxx... å¼€å‘æŒ‡å—... å¼€å‘ç§˜ç±... æˆ‘å¤§å­¦è¯»çš„éƒ½æ˜¯`å‡ä¹¦`

ä»Šå¤©ç»™å¤§å®¶åˆ†äº«çš„æ˜¯ iOSä¸Šå¦‚ä½• æŠŠæ±‰å­—è½¬æ¢æˆè¯­éŸ³æœ—è¯», å½“ç„¶è¿™ä¸ªæ²¡ä»€ä¹ˆæŠ€æœ¯å«é‡(å¤§ç¥å¯ä»¥é£è¿‡).

AVFoundationæ•´ä½“æ¶æ„
--

ç ”ç©¶è¿™ä¸ªåŠŸèƒ½ä¹‹å‰å…ˆä»‹ç»ä¸€ä¸‹`AV Foundation`æ•´ä½“æ¶æ„

![iOS](/assets/images/20170311LearningAVFoundationAVSpeechSynthesizer/frameworksBlockDiagram.webp)  
è¿™æ˜¯iOSä¸Šçš„æ¶æ„è®¾è®¡ (ä¸Šå›¾)  

![iOS](/assets/images/20170311LearningAVFoundationAVSpeechSynthesizer/frameworksBlockDiagramOSX.webp)  
è¿™æ˜¯macOSä¸Šçš„æ¶æ„è®¾è®¡(ä¸Šå›¾)


çœ‹å®Œä¹‹åæˆ‘ä»¬å°±æ¥ç”¨ä»£ç å®ç°è¿™ä¸ªdemo  
é¦–å…ˆå¯¼å…¥`<AVFoundation/AVFoundation.h>`

è¿™æˆ‘éœ€è¦ä½¿ç”¨çš„æ˜¯iOSä¸Šçš„`AVSpeechSynthesizer`,macOSä¸Šå«`NSSpeechSynthesizer `

``` objc
@property (strong, nonatomic) AVSpeechSynthesizer *synthesizer;
```

`AVSpeechSynthesizer` å®ƒçš„åŠŸèƒ½
  	
* __å°†æ–‡å­—æ·»åŠ åˆ°è¯­éŸ³, å°±æ˜¯ç”¨è¯­éŸ³æ’­æ”¾ä¸€æ®µæ–‡å­—__

åˆå§‹åŒ–

``` objc
- (void)awakeFromNib {
    [super awakeFromNib];
    //åˆ›å»ºè¯­éŸ³åˆæˆå™¨
    self.synthesizer = [[AVSpeechSynthesizer alloc] init];
    self.synthesizer.delegate = self;
    //æ’­æ”¾çš„å›½å®¶çš„è¯­è¨€
    self.voices = @[[AVSpeechSynthesisVoice voiceWithLanguage:@"zh-CN"],[AVSpeechSynthesisVoice voiceWithLanguage:@"en-US"]
                    ];
    self.speechStrings = [[NSMutableArray alloc] init];
    
}
```

è¿™é‡Œçš„`[AVSpeechSynthesisVoice voiceWithLanguage:@"zh-CN"]`
è®¾ç½®çš„æ˜¯ç®€ä½“ä¸­æ–‡è¯­éŸ³ æ–‡ç« æœ«å°¾ä¼šåˆ—å‡ºæ‰€æœ‰è¯­éŸ³æ’­æ”¾ä¿¡æ¯ä¸ç”¨æ‹…å¿ƒå†™é”™.



`AVSpeechSynthesizer`çš„delegateæ–¹æ³•å¦‚ä¸‹ ä¸»è¦æ˜¯å¯¹è¯­éŸ³æ’­æ”¾çŠ¶æ€çš„ç›‘å¬


``` objc
@protocol AVSpeechSynthesizerDelegate <NSObject>
// ä»£ç†æ–¹æ³•
@optional
// å¼€å§‹æ’­æ”¾ è¯­éŸ³å•å…ƒ
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer didStartSpeechUtterance:(AVSpeechUtterance *)utterance;
// å®Œæˆæ’­æ”¾ è¯­éŸ³å•å…ƒ
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer didFinishSpeechUtterance:(AVSpeechUtterance *)utterance;
// æš‚åœæ’­æ”¾ è¯­éŸ³å•å…ƒ
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer didPauseSpeechUtterance:(AVSpeechUtterance *)utterance;
// ç»§ç»­æ’­æ”¾ è¯­éŸ³å•å…ƒ
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer didContinueSpeechUtterance:(AVSpeechUtterance *)utterance;
// å–æ¶ˆæ’­æ”¾ è¯­éŸ³å•å…ƒ
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer didCancelSpeechUtterance:(AVSpeechUtterance *)utterance;
// è¿™é‡Œ æŒ‡çš„æ˜¯ åˆæ¥ç›‘å¬ æ’­æ”¾ å­—ç¬¦èŒƒå›´
- (void)speechSynthesizer:(AVSpeechSynthesizer *)synthesizer willSpeakRangeOfSpeechString:(NSRange)characterRange utterance:(AVSpeechUtterance *)utterance;
@end
```

__è¿™é‡Œçš„`AVSpeechSynthesizer`ä¸»è¦çš„æ–¹æ³•æœ‰__  


``` objc
/* æ·»åŠ  æ’­æ”¾è¯è¯­ åˆ° æ’­æ”¾è¯­éŸ³ é˜Ÿåˆ—, å¯ä»¥è®¾ç½®utteranceçš„å±æ€§æ¥æ§åˆ¶æ’­æ”¾ */
- (void)speakUtterance:(AVSpeechUtterance *)utterance;

// å¯¹äº stopSpeakingAtBoundary: è¯­éŸ³å•å…ƒçš„æ“ä½œ, å¦‚æœä¸­æ–­, ä¼šæ¸…ç©ºé˜Ÿåˆ—
// ä¸­æ–­
- (BOOL)stopSpeakingAtBoundary:(AVSpeechBoundary)boundary;
// æš‚åœ
- (BOOL)pauseSpeakingAtBoundary:(AVSpeechBoundary)boundary;
// ç»§ç»­
- (BOOL)continueSpeaking;  
```

> è¿™é‡Œæˆ‘ä»¬ç”¨çš„`speakUtterance`æ–¹æ³•æ¥æ’­æ”¾æ–‡å­—
speakUtterance:(AVSpeechUtterance *)utterance  
1. `AVSpeechUtterance`æ˜¯å¯¹æ–‡å­—æœ—è¯»çš„å°è£…
2. è¢«æ’­æ”¾çš„è¯­éŸ³æ–‡å­—, å¯ä»¥ç†è§£ä¸ºä¸€æ®µéœ€è¦æ’­æ”¾çš„æ–‡å­—  
è¿™é‡Œæˆ‘ä»¬è®¾ç½®`AVSpeechUtterance`æœ—è¯»æ’­æ”¾çš„ä¿¡æ¯  


``` objc  
	//æ’­æ”¾è¯­éŸ³
	NSArray *speechStringsArray = [self buildSpeechStrings]; //buildSpeechStringsæ’­æ”¾å­—ç¬¦ä¸²çš„æ•°ç»„
    for (NSUInteger i = 0; i < speechStringsArray.count; i++) {
        //åˆ›å»ºAVSpeechUtterance å¯¹è±¡ ç”¨äºæ’­æ”¾çš„è¯­éŸ³æ–‡å­—
        AVSpeechUtterance *utterance = [[AVSpeechUtterance alloc] initWithString:speechStringsArray[i]];
        //è®¾ç½®ä½¿ç”¨å“ªä¸€ä¸ªå›½å®¶çš„è¯­è¨€æ’­æ”¾
        utterance.voice = self.voices[0];
        //æœ¬æ®µæ–‡å­—æ’­æ”¾æ—¶çš„ è¯­é€Ÿ, åº”ä»‹äºAVSpeechUtteranceMinimumSpeechRate å’Œ AVSpeechUtteranceMaximumSpeechRate ä¹‹é—´
        utterance.rate = 0.5;
        //åœ¨æ’­æ”¾ç‰¹å®šè¯­å¥æ—¶æ”¹å˜å£°éŸ³çš„å£°è°ƒ, ä¸€èˆ¬å–å€¼ä»‹äº0.5(åº•éŸ³è°ƒ)~2.0(é«˜éŸ³è°ƒ)ä¹‹é—´
        utterance.pitchMultiplier = 0.8f;
        //å£°éŸ³å¤§å°, 0.0 ~ 1.0 ä¹‹é—´
        utterance.volume = 1.0f;
        //æ’­æ”¾åçš„å»¶è¿Ÿ, å°±æ˜¯æœ¬æ¬¡æ–‡å­—æ’­æ”¾å®Œä¹‹åçš„åœé¡¿æ—¶é—´, é»˜è®¤æ˜¯0
        utterance.preUtteranceDelay = 0;
        //æ’­æ”¾å‰çš„å»¶è¿Ÿ, å°±æ˜¯æœ¬æ¬¡æ–‡å­—æ’­æ”¾å‰åœé¡¿çš„æ—¶é—´, ç„¶åæ’­æ”¾æœ¬æ®µæ–‡å­—, é»˜è®¤æ˜¯0
        utterance.postUtteranceDelay = 0.1f;
        [self.synthesizer speakUtterance:utterance];
    }
```

`AVSpeechUtterance`çš„å±æ€§å¦‚ä¸‹

``` objc
// è®¾ç½®ä½¿ç”¨å“ªä¸€ä¸ªå›½å®¶çš„è¯­è¨€æ’­æ”¾
@property(nonatomic, retain, nullable) AVSpeechSynthesisVoice *voice;
// è·å–å½“å‰éœ€è¦æ’­æ”¾çš„æ–‡å­—, åªè¯»å±æ€§
@property(nonatomic, readonly) NSString *speechString;
// è·å–å½“å‰éœ€è¦æ’­æ”¾çš„æ–‡å­— - å¯Œæ–‡æœ¬, åªè¯»å±æ€§, iOS10ä»¥åå¯ç”¨
@property(nonatomic, readonly) NSAttributedString *attributedSpeechString;
// æœ¬æ®µæ–‡å­—æ’­æ”¾æ—¶çš„ è¯­é€Ÿ, åº”ä»‹äºAVSpeechUtteranceMinimumSpeechRate å’Œ AVSpeechUtteranceMaximumSpeechRate ä¹‹é—´
@property(nonatomic) float rate;           
// åœ¨æ’­æ”¾ç‰¹å®šè¯­å¥æ—¶æ”¹å˜å£°éŸ³çš„å£°è°ƒ, ä¸€èˆ¬å–å€¼ä»‹äº0.5(åº•éŸ³è°ƒ)~2.0(é«˜éŸ³è°ƒ)ä¹‹é—´
@property(nonatomic) float pitchMultiplier; 
// å£°éŸ³å¤§å°, 0.0 ~ 1.0 ä¹‹é—´
@property(nonatomic) float volume;
// æ’­æ”¾åçš„å»¶è¿Ÿ, å°±æ˜¯æœ¬æ¬¡æ–‡å­—æ’­æ”¾å®Œä¹‹åçš„åœé¡¿æ—¶é—´, é»˜è®¤æ˜¯0
@property(nonatomic) NSTimeInterval preUtteranceDelay; 
// æ’­æ”¾å‰çš„å»¶è¿Ÿ, å°±æ˜¯æœ¬æ¬¡æ–‡å­—æ’­æ”¾å‰åœé¡¿çš„æ—¶é—´, ç„¶åæ’­æ”¾æœ¬æ®µæ–‡å­—, é»˜è®¤æ˜¯0
@property(nonatomic) NSTimeInterval postUtteranceDelay;
```

`AVSpeechUtterance`çš„æ–¹æ³•å¦‚ä¸‹  

ä»¥ä¸‹å…¨éƒ¨éƒ½æ˜¯åˆå§‹åŒ–æ–¹æ³•, åˆ†ä¸º ç±»æ–¹æ³• å’Œ å¯¹è±¡æ–¹æ³•, å¯Œæ–‡æœ¬çš„åˆå§‹åŒ–æ–¹æ³•è¦åœ¨iOS10ä»¥åæ‰å¯ä»¥ç”¨  


``` objc
+ (instancetype)speechUtteranceWithString:(NSString *)string;
+ (instancetype)speechUtteranceWithAttributedString:(NSAttributedString *)string NS_AVAILABLE_IOS(10_0);
- (instancetype)initWithString:(NSString *)string;
- (instancetype)initWithAttributedString:(NSAttributedString *)string  

```
  

å¯ä»¥ä½¿ç”¨__`[AVSpeechSynthesisVoice speechVoices]`__ä»£ç æ‰“å°å‡ºæ”¯æŒæœ—è¯»è¯­è¨€çš„å›½å®¶  

```
ar-SA  æ²™ç‰¹é˜¿æ‹‰ä¼¯ï¼ˆé˜¿æ‹‰ä¼¯æ–‡ï¼‰

en-ZA, å—éï¼ˆè‹±æ–‡ï¼‰

nl-BE, æ¯”åˆ©æ—¶ï¼ˆè·å…°æ–‡ï¼‰

en-AU, æ¾³å¤§åˆ©äºšï¼ˆè‹±æ–‡ï¼‰

th-TH, æ³°å›½ï¼ˆæ³°æ–‡ï¼‰

de-DE, å¾·å›½ï¼ˆå¾·æ–‡ï¼‰

en-US, ç¾å›½ï¼ˆè‹±æ–‡ï¼‰

pt-BR, å·´è¥¿ï¼ˆè‘¡è„ç‰™æ–‡ï¼‰

pl-PL, æ³¢å…°ï¼ˆæ³¢å…°æ–‡ï¼‰

en-IE, çˆ±å°”å…°ï¼ˆè‹±æ–‡ï¼‰

el-GR, å¸Œè…Šï¼ˆå¸Œè…Šæ–‡ï¼‰

id-ID, å°åº¦å°¼è¥¿äºšï¼ˆå°åº¦å°¼è¥¿äºšæ–‡ï¼‰

sv-SE, ç‘å…¸ï¼ˆç‘å…¸æ–‡ï¼‰

tr-TR, åœŸè€³å…¶ï¼ˆåœŸè€³å…¶æ–‡ï¼‰

pt-PT, è‘¡è„ç‰™ï¼ˆè‘¡è„ç‰™æ–‡ï¼‰

ja-JP, æ—¥æœ¬ï¼ˆæ—¥æ–‡ï¼‰

ko-KR, å—æœé²œï¼ˆæœé²œæ–‡ï¼‰

hu-HU, åŒˆç‰™åˆ©ï¼ˆåŒˆç‰™åˆ©æ–‡ï¼‰

cs-CZ, æ·å…‹å…±å’Œå›½ï¼ˆæ·å…‹æ–‡ï¼‰

da-DK, ä¸¹éº¦ï¼ˆä¸¹éº¦æ–‡ï¼‰

es-MX, å¢¨è¥¿å“¥ï¼ˆè¥¿ç­ç‰™æ–‡ï¼‰

fr-CA, åŠ æ‹¿å¤§ï¼ˆæ³•æ–‡ï¼‰

nl-NL, è·å…°ï¼ˆè·å…°æ–‡ï¼‰

fi-FI, èŠ¬å…°ï¼ˆèŠ¬å…°æ–‡ï¼‰

es-ES, è¥¿ç­ç‰™ï¼ˆè¥¿ç­ç‰™æ–‡ï¼‰

it-IT, æ„å¤§åˆ©ï¼ˆæ„å¤§åˆ©æ–‡ï¼‰

he-IL, ä»¥è‰²åˆ—ï¼ˆå¸Œä¼¯è±æ–‡ï¼Œé˜¿æ‹‰ä¼¯æ–‡ï¼‰

no-NO, æŒªå¨ï¼ˆæŒªå¨æ–‡ï¼‰

ro-RO, ç½—é©¬å°¼äºšï¼ˆç½—é©¬å°¼äºšæ–‡ï¼‰

zh-HK, é¦™æ¸¯ï¼ˆä¸­æ–‡ï¼‰

zh-TW, å°æ¹¾ï¼ˆä¸­æ–‡ï¼‰

sk-SK, æ–¯æ´›ä¼å…‹ï¼ˆæ–¯æ´›ä¼å…‹æ–‡ï¼‰

zh-CN, ä¸­å›½ï¼ˆä¸­æ–‡ï¼‰

ru-RU, ä¿„ç½—æ–¯ï¼ˆä¿„æ–‡ï¼‰

en-GB, è‹±å›½ï¼ˆè‹±æ–‡ï¼‰

fr-FR, æ³•å›½ï¼ˆæ³•æ–‡ï¼‰

hi-IN  å°åº¦ï¼ˆå°åº¦æ–‡ï¼‰
```

> æ€»ç»“
ä¸ºäº†å­¦ä¹ __`AVFoundation`__æˆ‘å…ˆä»ä¸€ä¸ªç®€å•çš„çŸ¥è¯†ç‚¹å…¥æ‰‹,å”¯ä¸€è§‰å¾—é—æ†¾çš„æ˜¯æˆ‘ä¸å¤ªç¡®å®šæ˜¯å¦è¿™ä¸ªåˆæˆå™¨æ”¯æŒè‡ªå®šä¹‰è¯­éŸ³æœ—è¯»,è¿™ä¸ªåç»­ç ”ç©¶ä¸€ä¸‹,æŠŠç›¸å…³å­¦ä¹ å†…å®¹å¡«è¡¥ä¸Š.

__æœ€ç»ˆçš„demo æ”¯æŒiOSå’ŒmacOS:[Learning-AV-Foundation(ä¸€)æ±‰å­—è¯­éŸ³æœ—è¯»](https://github.com/sunyazhou13/AVSpeechSynthesizerDemo)__


å‚è€ƒ:  
[AV Foundation Apple å®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/content/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188)  
[AVSpeechSynthesizer å’Œ AVSpeechUtterance](http://www.jianshu.com/p/acd57725ba4d)  
[AVSpeechSynthesizerè¯¦è§£](http://www.jianshu.com/p/a41cb018f0b5)  
[AVFoundation](http://www.jianshu.com/p/cc79c45b4ccf)









URL: https://sunyazhou.com/2017/02/macOSsimulateKeyboradNSEvent/index.html.md
Published At: 2017-02-22 16:17:00 +0000

# macOSä¸Šæ¨¡æ‹Ÿå‘é€é”®ç›˜äº‹ä»¶

![](/assets/images/20170222macOSsimulateKeyboradNSEvent/Cover.webp)



æœ€è¿‘åœ¨å¼€å‘macOSè¿œç¨‹ååŠ©åŠŸèƒ½, éœ€è¦æ¨¡æ‹Ÿä»windowsä¼ è¿‡æ¥çš„é”®ç›˜äº‹ä»¶æ˜ å°„æˆmacOS `NSEvent`, macOSä¸Šæ¨¡æ‹Ÿäº‹ä»¶éƒ½æ˜¯åº•å±‚çš„`CoreGraphic`çš„`class`,ä¸‹é¢è¯´ä¸‹å®ç°çš„ç‰‡æ–­ä»£ç .


1. å¯¼å…¥`#import <Carbon/Carbon.h>`
2. åˆ›å»º`CGEventSourceRef` äº‹ä»¶æºå¯¹è±¡**(æ³¨æ„å®ƒä¸æ˜¯OCå¯¹è±¡,å£°æ˜çš„æ—¶å€™å¯¹è±¡å‰è¾¹æ²¡æœ‰`*`,è€Œä¸”éœ€è¦ç”¨`CFRelease()`é‡Šæ”¾å†…å­˜)**.
3. åˆ›å»º`CGEventRef`ä½¿ç”¨`CGEventCreateKeyboardEvent`, ç¬¬ä¸‰ä¸ªå‚æ•°`true`ä»£è¡¨`keydown`å°±æ˜¯é”®ç›˜æŒ‰é”®çš„æŒ‰ä¸‹çŠ¶æ€,å¦‚æœæ˜¯`false`åˆ™ä»£è¡¨`keyup`. è¿™é‡Œç”¨äº†ä¸€ä¸ªé”®ç›˜`kVK_ANSI_A ` Aé”®ä½œä¸ºä¾‹å­
4. `CGEventTapLocation` è¿™ä¸ªæ˜¯ä¸‹ä¸€ä¸ªå‡½æ•°éœ€è¦çš„å‚æ•° åº”è¯¥æ˜¯é”®ç›˜ç¡¬ä»¶æŒ‰ä¸‹çš„é”®ä½ä¿¡æ¯(å¦‚æœæé”™äº†æ¬¢è¿æŒ‡æ­£,é©¬ä¸Šä¿®æ”¹)  
5. `CGEventPost()`å‘é€`NSEvent`äº‹ä»¶ 
6. é‡Šæ”¾å†…å­˜

> *talk is cheap, show me the code --LINUS TORVALDS*  

ä¸‹é¢æ˜¯æ¼”ç¤ºä»£ç 

``` objc 
#import <Carbon/Carbon.h>

int main(int argc, const char * argv[]) {
    @autoreleasepool {
       CGEventSourceRef source = CGEventSourceCreate(kCGEventSourceStatePrivate);
	    CGEventRef A = CGEventCreateKeyboardEvent(source, kVK_ANSI_A, true);
	    CGEventTapLocation location = kCGHIDEventTap;
	    //å‘é€äº‹ä»¶
	    CGEventPost(location, A);
	    CFRelease(A);
	    CFRelease(source);
    }
    return 0;
}
```

`CGEventSourceCreate()`é‡Œå®šä¹‰äº†ä¸‰ä¸ª**æšä¸¾**

``` objc 
typedef CF_ENUM(int32_t, CGEventSourceStateID) {
  kCGEventSourceStatePrivate = -1,
  kCGEventSourceStateCombinedSessionState = 0,
  kCGEventSourceStateHIDSystemState = 1
};
```

> `kCGEventSourceStatePrivate` ä»£è¡¨ ä¸“é—¨çš„åº”ç”¨,å¦‚è¿œç¨‹æ§åˆ¶ç¨‹åºå¯ä»¥ç”Ÿæˆå’Œè·Ÿè¸ªäº‹ä»¶æºçŠ¶æ€ç‹¬ç«‹äºå…¶ä»–è¿›ç¨‹ã€‚è¿™äº›ç¨‹åºåº”è¯¥ä½¿ç”¨kCGEventSourceStatePrivateå€¼åœ¨åˆ›å»ºä»–ä»¬çš„äº‹ä»¶æºã€‚  
> `kCGEventSourceStateCombinedSessionState` è¯¥çŠ¶æ€è¡¨åæ˜ äº†æ‰€æœ‰äº‹ä»¶æºçš„ç»„åˆçŠ¶æ€å‘å¸ƒåˆ°å½“å‰ç”¨æˆ·çš„ç™»å½•ä¼šè¯ã€‚å¦‚æœæ‚¨çš„ç¨‹åºå‘å¸ƒçš„äº‹ä»¶åœ¨ä¸€ä¸ªç™»å½•ä¼šè¯,æ‚¨åº”è¯¥ä½¿ç”¨è¿™ä¸ªæºçŠ¶æ€å½“ä½ åˆ›å»ºä¸€ä¸ªäº‹ä»¶æºã€‚

> `kCGEventSourceStateHIDSystemState` è¯¥çŠ¶æ€è¡¨åæ˜ äº† ç»„åˆç¡¬ä»¶è¾“å…¥æºä»HIDç³»ç»Ÿç¡¬ä»¶å±‚é¢å‘é€çš„äº‹ä»¶æºã€‚ç”Ÿæˆçš„äº‹ä»¶ã€‚ å°±æ˜¯å¤–æ¥é”®ç›˜æˆ–è€…macbookæœ¬æœºé”®ç›˜ä»¥åŠä¸€äº›ç³»ç»Ÿå®šä¹‰çš„æŒ‰é”®ç‚¹å‡»äº‹ä»¶ 

è¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªæ°å·§å®ƒæœ‰è¯´æ˜`remote control`

ä¸Šé¢å°±æ˜¯ä»Šå¤©è¦åˆ†äº«çš„æ¨¡æ‹Ÿå‘é€ç³»ç»Ÿé”®ç›˜äº‹ä»¶å…¨éƒ¨é€»è¾‘, å¦‚æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£, é„™äººå®šå½“å’¨è¯¹å–„é“å¯Ÿçº³é›…è¨€.


**é™„* macOS ANSIç  **æšä¸¾**

``` objc
/*
 *  Summary:
 *    Virtual keycodes
 *  
 *  Discussion:
 *    These constants are the virtual keycodes defined originally in
 *    Inside Mac Volume V, pg. V-191. They identify physical keys on a
 *    keyboard. Those constants with "ANSI" in the name are labeled
 *    according to the key position on an ANSI-standard US keyboard.
 *    For example, kVK_ANSI_A indicates the virtual keycode for the key
 *    with the letter 'A' in the US keyboard layout. Other keyboard
 *    layouts may have the 'A' key label on a different physical key;
 *    in this case, pressing 'A' will generate a different virtual
 *    keycode.
 */
enum {
  kVK_ANSI_A                    = 0x00,
  kVK_ANSI_S                    = 0x01,
  kVK_ANSI_D                    = 0x02,
  kVK_ANSI_F                    = 0x03,
  kVK_ANSI_H                    = 0x04,
  kVK_ANSI_G                    = 0x05,
  kVK_ANSI_Z                    = 0x06,
  kVK_ANSI_X                    = 0x07,
  kVK_ANSI_C                    = 0x08,
  kVK_ANSI_V                    = 0x09,
  kVK_ANSI_B                    = 0x0B,
  kVK_ANSI_Q                    = 0x0C,
  kVK_ANSI_W                    = 0x0D,
  kVK_ANSI_E                    = 0x0E,
  kVK_ANSI_R                    = 0x0F,
  kVK_ANSI_Y                    = 0x10,
  kVK_ANSI_T                    = 0x11,
  kVK_ANSI_1                    = 0x12,
  kVK_ANSI_2                    = 0x13,
  kVK_ANSI_3                    = 0x14,
  kVK_ANSI_4                    = 0x15,
  kVK_ANSI_6                    = 0x16,
  kVK_ANSI_5                    = 0x17,
  kVK_ANSI_Equal                = 0x18,
  kVK_ANSI_9                    = 0x19,
  kVK_ANSI_7                    = 0x1A,
  kVK_ANSI_Minus                = 0x1B,
  kVK_ANSI_8                    = 0x1C,
  kVK_ANSI_0                    = 0x1D,
  kVK_ANSI_RightBracket         = 0x1E,
  kVK_ANSI_O                    = 0x1F,
  kVK_ANSI_U                    = 0x20,
  kVK_ANSI_LeftBracket          = 0x21,
  kVK_ANSI_I                    = 0x22,
  kVK_ANSI_P                    = 0x23,
  kVK_ANSI_L                    = 0x25,
  kVK_ANSI_J                    = 0x26,
  kVK_ANSI_Quote                = 0x27,
  kVK_ANSI_K                    = 0x28,
  kVK_ANSI_Semicolon            = 0x29,
  kVK_ANSI_Backslash            = 0x2A,
  kVK_ANSI_Comma                = 0x2B,
  kVK_ANSI_Slash                = 0x2C,
  kVK_ANSI_N                    = 0x2D,
  kVK_ANSI_M                    = 0x2E,
  kVK_ANSI_Period               = 0x2F,
  kVK_ANSI_Grave                = 0x32,
  kVK_ANSI_KeypadDecimal        = 0x41,
  kVK_ANSI_KeypadMultiply       = 0x43,
  kVK_ANSI_KeypadPlus           = 0x45,
  kVK_ANSI_KeypadClear          = 0x47,
  kVK_ANSI_KeypadDivide         = 0x4B,
  kVK_ANSI_KeypadEnter          = 0x4C,
  kVK_ANSI_KeypadMinus          = 0x4E,
  kVK_ANSI_KeypadEquals         = 0x51,
  kVK_ANSI_Keypad0              = 0x52,
  kVK_ANSI_Keypad1              = 0x53,
  kVK_ANSI_Keypad2              = 0x54,
  kVK_ANSI_Keypad3              = 0x55,
  kVK_ANSI_Keypad4              = 0x56,
  kVK_ANSI_Keypad5              = 0x57,
  kVK_ANSI_Keypad6              = 0x58,
  kVK_ANSI_Keypad7              = 0x59,
  kVK_ANSI_Keypad8              = 0x5B,
  kVK_ANSI_Keypad9              = 0x5C
};

/* keycodes for keys that are independent of keyboard layout*/
enum {
  kVK_Return                    = 0x24,
  kVK_Tab                       = 0x30,
  kVK_Space                     = 0x31,
  kVK_Delete                    = 0x33,
  kVK_Escape                    = 0x35,
  kVK_Command                   = 0x37,
  kVK_Shift                     = 0x38,
  kVK_CapsLock                  = 0x39,
  kVK_Option                    = 0x3A,
  kVK_Control                   = 0x3B,
  kVK_RightCommand              = 0x36,
  kVK_RightShift                = 0x3C,
  kVK_RightOption               = 0x3D,
  kVK_RightControl              = 0x3E,
  kVK_Function                  = 0x3F,
  kVK_F17                       = 0x40,
  kVK_VolumeUp                  = 0x48,
  kVK_VolumeDown                = 0x49,
  kVK_Mute                      = 0x4A,
  kVK_F18                       = 0x4F,
  kVK_F19                       = 0x50,
  kVK_F20                       = 0x5A,
  kVK_F5                        = 0x60,
  kVK_F6                        = 0x61,
  kVK_F7                        = 0x62,
  kVK_F3                        = 0x63,
  kVK_F8                        = 0x64,
  kVK_F9                        = 0x65,
  kVK_F11                       = 0x67,
  kVK_F13                       = 0x69,
  kVK_F16                       = 0x6A,
  kVK_F14                       = 0x6B,
  kVK_F10                       = 0x6D,
  kVK_F12                       = 0x6F,
  kVK_F15                       = 0x71,
  kVK_Help                      = 0x72,
  kVK_Home                      = 0x73,
  kVK_PageUp                    = 0x74,
  kVK_ForwardDelete             = 0x75,
  kVK_F4                        = 0x76,
  kVK_End                       = 0x77,
  kVK_F2                        = 0x78,
  kVK_PageDown                  = 0x79,
  kVK_F1                        = 0x7A,
  kVK_LeftArrow                 = 0x7B,
  kVK_RightArrow                = 0x7C,
  kVK_DownArrow                 = 0x7D,
  kVK_UpArrow                   = 0x7E
};


```  

å…¨æ–‡å®Œ



URL: https://sunyazhou.com/2017/02/ClearNSUserDefaultCcontent/index.html.md
Published At: 2017-02-20 19:05:01 +0000

# ä½¿ç”¨ç»ˆç«¯åˆ é™¤NSUserDefaultçš„å†…å®¹

å‰è¨€
--
> å¤§å®¶å¯¹`NSUserDefaults`éå¸¸ç†Ÿæ‚‰ ä»Šå¤©ç»™å¤§å®¶è®²ä¸€ä¸‹å¦‚ä½•ç”¨ç»ˆç«¯æ¸…ç†`NSUserDefaults`çš„ä¿¡æ¯  

`NSUserDefaults`å’Œ`win`å¼€å‘çš„æ³¨å†Œè¡¨ä¸€æ · ç”¨äºå­˜å‚¨ä¸€äº›æ ‡è®°ä½
æœ€è¿‘å¼€å‘ç”¨åˆ°çš„æ¯”è¾ƒå¤šæ˜¯å¦‚ä½•ä¸è¿è¡Œä»£ç çš„æƒ…å†µä¸‹æ¸…ç†`NSUserDefaults `ä¿¡æ¯

**$ defaults delete + åŒ…å**  eg: com.baidu.demo 

ä¸‹é¢è¿™æ ·ä¼šåˆ é™¤æ‰€æœ‰ä»¥`com.baidu.demo`ä¸ºåŒ…åçš„æ–‡ä»¶  

``` shell
$ defaults delete com.baidu.demo
```  

> å®é™…çš„çš„è·¯å¾„(æŠŠ my appå’Œå‰åå‰ªå¤´ æ¢æˆè‡ªå·±çš„åº”ç”¨çš„åŒ…å)

macOSåº”ç”¨éæ²™ç›’æƒé™(å¦‚ä¸‹å›¾) `~/Library/Preferences/<my app>.plist  <my app>`  eg:QQ
![éæ²™ç›’è·¯å¾„](/assets/images/20170220ClearNSUserDefaultCcontent/NonSandBoxPermission.webp)

macOSåº”ç”¨æ²™ç›’æƒé™(å¦‚ä¸‹å›¾)  `~/Library/Containers/<my app>/Data/Library/Preferences/<my app>.plist` eg:qq  

![](/assets/images/20170220ClearNSUserDefaultCcontent/SandBoxPermission.webp)


æ€»ç»“
--

> defaults è¿˜æœ‰å…¶å®ƒæŒ‡ä»¤è¿˜å¯ä»¥ä¸ºæŸä¸ª`key`è®¾ç½®`value` å¤§å®¶å¯è‡ªè¡Œgoogle  

è°¢è°¢å¤§å®¶

å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2017/02/ScanBoundsTracking/index.html.md
Published At: 2017-02-18 19:08:56 +0000

# iOSå¦‚ä½•è®©äºŒç»´ç /æ¡å½¢ç æ‰«ææ¡†è·ŸéšäºŒç»´ç ç§»åŠ¨

å‰è¨€
--

> å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šé‡åˆ°äºŒç»´ç æ¡å½¢ç ,ä½†æ€»ä¼šæœ‰ä¸€ä¸ªæ¯”è¾ƒè›‹ç–¼çš„é—®é¢˜
å¦‚ä½•è®©äºŒç»´ç çš„æ‰«ææ¡†è·Ÿéšæ‰«ç åˆ°çš„äºŒç»´ç ç§»åŠ¨è·Ÿè¸ªå‘¢(å°±æ˜¯æ™ºèƒ½æ¢æµ‹æ‰«æçš„layer.bounds)ï¼Ÿ  

![](http://www.appcoda.com/wp-content/uploads/2016/11/qrcode-reader-5-1024x637.webp)



è¿™é‡Œæœ‰ä¸€ç¯‡æ–‡å­—è®²è¿°äº†å¼€å‘è¿‡ç¨‹æˆ‘è¿™é‡Œå°±ä¸èµ˜è¿°äº†, å¦‚æœæœ‰å°ä¼™ä¼´è§‰å¾—éœ€è¦æˆ‘ç¿»è¯‘çš„è¯è¯·åœ¨åº•éƒ¨ç•™è¨€ æˆ‘ä¼šåŠæ—¶æ›´æ–°ä»£ç   
> [Building a Barcode and QR Code Reader in Swift 3 and Xcode 8](http://www.appcoda.com/barcode-reader-swift/)



*è¿™é‡Œæ¯”è¾ƒæ ¸å¿ƒçš„ä»£ç å¦‚ä¸‹* `AVCaptureMetadataOutputObjectsDelegate`ä»£ç†
    
```swift  

func captureOutput(_ captureOutput: AVCaptureOutput!, didOutputMetadataObjects metadataObjects: [Any]!, from connection: AVCaptureConnection!) {  
    
    // Check if the metadataObjects array is not nil and it contains at least one object.
    if metadataObjects == nil || metadataObjects.count == 0 {
        qrCodeFrameView?.frame = CGRect.zero
        messageLabel.text = "No QR code is detected"
        return
    }
    
    // Get the metadata object.
    let metadataObj = metadataObjects[0] as! AVMetadataMachineReadableCodeObject
    
    if metadataObj.type == AVMetadataObjectTypeQRCode {
        // If the found metadata is equal to the QR code metadata then update the status label's text and set the bounds
        let barCodeObject = videoPreviewLayer?.transformedMetadataObject(for: metadataObj)
        //æ ¸å¿ƒä»£ç åœ¨è¿™
        qrCodeFrameView?.frame = barCodeObject!.bounds
        
        if metadataObj.stringValue != nil {
            messageLabel.text = metadataObj.stringValue
        }
    }
}}
	
```  
`qrCodeFrameView?.frame = barCodeObject!.bounds`
è¿™è¡Œä»£ç æœ€æ ¸å¿ƒ å°±æ˜¯æ‹¿åˆ°barCodeObject.bounds ç»™æˆ‘ä»¬è‡ªå·±åˆ›å»ºé€æ˜çš„é‚£ä¸ªviewå°±è¡Œäº† **[æœ€ç»ˆé¡¹ç›®](https://github.com/sunyazhou13/QRCodeReader)**

![QRCode è·Ÿè¸ª](/assets/images/20170218ScanBoundsTracking/ScanBoundsTracking.gif)




å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2017/02/iOSInternationalizationLanguageSkills/index.html.md
Published At: 2017-02-17 10:01:19 +0000

# iOSè¯­è¨€æœ¬åœ°åŒ–/å›½é™…åŒ–ä¸€äº›æŠ€å·§

ä»£ç è·å–å›½é™…åŒ–è¯­è¨€æ•°ç»„  
--  
è·å–å½“å‰appä½¿ç”¨çš„è¯­è¨€
``` objc
    NSArray *langArr1 = [[NSUserDefaults standardUserDefaults] valueForKey:@"AppleLanguages"];
    NSString *language1 = langArr1.firstObject;
    NSLog(@"æ¨¡æ‹Ÿå™¨è¯­è¨€ï¼š%@",language1);
```

åˆ‡æ¢è¯­è¨€ `en`ä»£è¡¨ è‹±è¯­, `zh-Hans` ç®€ä½“ä¸­æ–‡, `zh-Hant` ç¹ä½“ä¸­æ–‡.  

``` objc
    NSArray *lans = @[@"en"];
    [[NSUserDefaults standardUserDefaults] setObject:lans forKey:@"AppleLanguages"];
```
ä¿®æ”¹schemeåˆ‡æ¢å¯åŠ¨è¯­è¨€
--

![å›¾1](/assets/images/20170217iOSInternationalizationLanguageSkills/AppleLanguages1.webp)

![å›¾2](/assets/images/20170217iOSInternationalizationLanguageSkills/AppleLanguages2.webp)

> `-AppleLanguages (zh-Hans)` ä»£è¡¨ç®€ä½“ä¸­æ–‡  
> `-AppleLanguages (zh-Hant)` ä»£è¡¨ç¹ä½“ä¸­æ–‡  
> `-AppleLanguages (en)` ä»£è¡¨è‹±æ–‡  
> å…¶å®ƒå°ä¼™ä¼´ä»¬è‡ªå·±æ€»ç»“ä¸€ä¸‹ä¹Ÿå¯ä»¥ æ³¨æ„ **ç©ºæ ¼** 

å›½é™…åŒ–å–ä¸åŒå›¾ç‰‡ä»£ç 
--

``` objc
#import "ViewController.h"

@interface ViewController ()
@property (weak, nonatomic) IBOutlet UIImageView *imageView;

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    //xxx æ˜¯å›½é™…åŒ– å›¾ç‰‡çš„åå­— ä¾‹å¦‚xxx.png 
    //å¦‚æœæ˜¯ xxx.jpg å¿…é¡»å†™æŠŠxxx æ›¿æ¢æˆxxx.jpg
    NSString *imageName = NSLocalizedString(@"xxx", nil); 
    self.imageView.image = [UIImage imageNamed:imageName];
}

@end
```

ä¸‹é¢æ˜¯æˆ‘å†™çš„ä¸€ä¸ª[demo](https://github.com/sunyazhou13/LocalizedDemo/tree/master)  
ä¸»è¦å®Œæˆ å¦‚ä¸‹å†…å®¹ 
1. å·¥ç¨‹åç§°é…ç½®plist å›½é™…åŒ–  
2. å­—ç¬¦ä¸²å›½é™…åŒ–  
3. è‡ªå®šä¹‰å­—ç¬¦ä¸²å›½é™…åŒ–  
4. å›¾ç‰‡å›½é™…åŒ–  

å‚è€ƒ [VVæœ¨å…¬å­](http://www.jianshu.com/p/88c1b65e3ddb) 

å…¨æ–‡å®Œ


URL: https://sunyazhou.com/2017/02/BuildHexoBlogTutorial/index.html.md
Published At: 2017-02-10 10:24:25 +0000

# æ­å»ºhexoåšå®¢æ•™ç¨‹

> [Jekyllè¿ç§»åˆ°Hexoæ­å»ºä¸ªäººåšå®¢](http://www.ezlippi.com/blog/2016/02/jekyll-to-hexo.html)  

> [HEXO + Github æ­å»ºè‡ªå·±çš„åšå®¢ç³»ç»Ÿ](http://www.czhzero.com/2016/06/25/hexoblog/)

> [åˆ©ç”¨Hexoå’ŒGithub Pagesæ­å»ºä¸ªäººåšå®¢](http://skx926.com/2016/01/26/build-hexo/)

### 1 åˆçº§åŠŸèƒ½

github pages  é…ç½® å¤§å®¶è‡ªè¡Œgoogleå§ çœŸçš„å¾ˆç®€å•

ä¸Šè¾¹æ˜¯æˆ‘å‚è€ƒçš„æ–‡ç«   
ä¸»è¦æ˜¯ç¯å¢ƒæ¯”è¾ƒè´¹åŠ²  
	1. nodejs  
	2. npmåŒ…ç®¡ç†å·¥å…·  
	3. hexo  
	4. nvmç®¡ç†node  
	5. æœ¬åœ°é…ç½®é‡å¯shellåˆè¢«reverse  
	6. ...å…¶å®ƒ
	
### 2 é«˜çº§åŠŸèƒ½éƒ¨åˆ†

æ‰“èµ è‡ªè¡Œ æœç´¢ç®€ä¹¦å§ å¾ˆå¤š ä¸»é¢˜ä¸å¤ªä¸€æ · å¥—è·¯éƒ½æ˜¯ä¸€æ ·çš„æ©

### 3 SSL(è‡ªå®šä¹‰åŸŸåæ”¯æŒHTTPS)

[æ”¯æŒhttps](https://gbin.me/2017/08/03/Hexo-deployed-in-github-and-coding/)


URL: https://sunyazhou.com/2017/02/DFSAlgorithm/index.html.md
Published At: 2017-02-10 10:07:55 +0000

# DFSç®—æ³•æ‰«æä¸Šä¼ æ–‡ä»¶/æ–‡ä»¶å¤¹

DFSéœ€æ±‚èƒŒæ™¯
--
> åœ¨å¼€å‘è¿‡ç¨‹ä¸­éš¾å…ä¼šé‡åˆ°ç±»ä¼¼ ä¸Šä¼ æ–‡ä»¶å¤¹çš„åŠŸèƒ½,ä½†æ˜¯ä¸Šä¼ æ–‡ä»¶å¤¹ä¼šé‡åˆ°ä¸€ç§æƒ…å†µ
	
	1. å¦‚æœæ–‡ä»¶é‡Œé¢åŒ…å«å­æ–‡ä»¶å¤¹çš„Nå±‚åµŒå¥—
	2. å¦‚ä½•è¿‡æ»¤éç©ºæ–‡ä»¶å¤¹
	3. å¦‚ä½•å¤„ç†æ ¹å±‚æ–‡ä»¶å¤¹æ²¡æœ‰æ–‡ä»¶é‚£ä¹ˆæ–‡ä»¶ç›®å½•ä¹Ÿéœ€è¦åˆ›å»º
	
ä¸¾ä¾‹ä¾‹å­
![](/assets/images/20170210DFSAlgorithm/DFS1.webp)

è¿™ç§æ–‡ä»¶å¤¹å¦‚ä½• `æ­¤æ–‡ä»¶å¤¹ä¸ºç©ºä¸”æ˜¯å¶å­ç»“ç‚¹` èµ°ä¸Šä¼ é€»è¾‘(å°±æ˜¯å‘ä¸ª httpè¯·æ±‚ createä¸€ä¸‹ dirå°±è¡Œäº†) æˆ‘ä»¬è¦çš„ç»“æœæ˜¯ è¿‡æ»¤å‡ºè¿™ä¸ªè·¯å¾„èµ°ä¸Šä¼ é€»è¾‘ åˆ›å»ºä¸€ä¸‹è¿™ä¸ªæœ€æ·±å¤„ç›®å½• é‚£ä¹ˆä¸‹æ¬¡å†é‡åˆ°å®ƒçš„çˆ¶ç›®å½• `/1/` çš„è¯åº”è¯¥å°±ä¸ç”¨åˆ›å»ºäº†.

è¿˜æœ‰ä¸€ç§æƒ…å†µ  
> eg: ~/Downloads/A/B/C/ é‡Œé¢æœ‰ä¸ª 1.txt    
> è·¯å¾„æ˜¯: ~/Downloads/A/B/C/1.txt

ä¸€èˆ¬å¦‚æœå¹¿åº¦ä¼˜å…ˆåšä¸Šä¼ çš„è¯ Downloadsã€Aã€Bã€Cåˆ†åˆ«è¦å‘4ä¸ªhttpè¯·æ±‚
å¦‚æœæ·±åº¦ä¼˜å…ˆå‘ä¸€ä¸ªä¸Šä¼ è¿™ä¸ªæ–‡ä»¶~/Downloads/A/B/C//A/B/C/1.txtå°±å¯ä»¥äº†ï¼Œå› ä¸ºä¸€èˆ¬serveréƒ½ä¼šåš å®¹é”™å¤„ç†å‘ç°çˆ¶ç›®å½•æœ‰æ²¡æœ‰æ²¡æœ‰å°±åˆ›å»ºä¹‹ç±»çš„é€»è¾‘ã€‚


ç®—æ³•
--
> ä¸è¦å®³æ€•, å¾ˆç®€å•
ä¸€èˆ¬æˆ‘ä»¬å¤„ç†è¿™ç§é—®é¢˜éƒ½æ˜¯é‡‡ç”¨è‡ªå·±å†™çš„é€’å½’ç®—æ³•, ä¼°è®¡æ˜¯é„™äººç®—æ³•ä¸å’‹å¥½æ²¡æå‡ºæ¥ä»€ä¹ˆå¥½çš„é€’å½’,æœ€åæ‰¾åˆ°äº† è‹¹æœè‡ªå¸¦çš„é€’å½’æ–¹æ³•

```objc
//æä¸ªç‚¹å‡»äº‹ä»¶ åœ¨è¿™é‡Œæˆ‘æ‹¿macOSä¸Šçš„ æ–‡ä»¶é€‰æ‹©é¢æ¿åšä¸€ä¸‹æµ‹è¯•
- (IBAction)dfsAction:(NSButton *)sender
{
    NSOpenPanel *panelPath = [NSOpenPanel openPanel];
    [panelPath setCanChooseFiles:YES];
    [panelPath setCanChooseDirectories:YES];
    [panelPath setTitle:@"ä¸Šä¼ æ–‡ä»¶é€‰æ‹©"];
    [panelPath setCanCreateDirectories:YES];
    [panelPath setPrompt:@"ä¸Šä¼ "];
    [panelPath setMessage:@"è¿™å°±æ˜¯message"];
    panelPath.allowsMultipleSelection = YES;
    [panelPath beginSheetModalForWindow:self.window completionHandler:^(NSInteger result) {
        if (result == NSFileHandlingPanelOKButton) {
            [self dfsUrls:panelPath.URLs];
        }
    }];
}
```
![](/assets/images/20170210DFSAlgorithm/DFS2.webp)

ç„¶å  

```objc
/**
 é€‰æ‹©æ–‡ä»¶å¤¹çš„ç›®å½•

 @param urls æ‰€æœ‰é€‰ä¸­çš„ç›®å½•/æ–‡ä»¶URL
 */
- (void)dfsUrls:(NSArray *)urls
{
	//å¼€ä¸€ä¸ªçº¿ç¨‹åœ¨å¼‚æ­¥å¤„ç†è¿™äº›è€—æ—¶ä»»åŠ¡
	dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
        NSLog(@"æ‰€æœ‰URLs%@",urls);
        if (urls.count == 0) { return; }
        
        NSTimeInterval currentTime = [[NSDate date] timeIntervalSince1970];
        //æ·±åº¦éå†
        NSFileManager *fileManager = [NSFileManager defaultManager];
        NSMutableArray *urlDirFiles = [[NSMutableArray alloc] initWithCapacity:0];
        NSArray *keys = [NSArray arrayWithObjects:NSURLIsDirectoryKey,NSURLParentDirectoryURLKey, nil];
        NSUInteger *total = 0;
        for (NSURL *localUrl in urls) {
            NSDirectoryEnumerator *enumerator = [self enumeratorPathByFileManager:fileManager atURL:localUrl propertiesForKeys:keys options:0];
            
            //è¿™é‡ŒåŒ…å«çš„å…ƒç´ æ˜¯ æœ‰å­æ–‡ä»¶çš„å¿½ç•¥çˆ¶è·¯å¾„ç»“ç‚¹
            //eg: /A/1/2/ (è¿™ä¸ªå°±éœ€è¦ç§»é™¤)   /A/1/2/sun.txt(ä¿ç•™è¿™ä¸ªæ–‡ä»¶å³å¯ï¼‰
            for (NSURL *url in enumerator) {
                total++;
                NSError *error;
                NSNumber *isDirectory = nil;
                if (![url getResourceValue:&isDirectory forKey:NSURLIsDirectoryKey error:&error]) {
                    // handle error
                }
                
                //æ˜¯å¦ä¸ºæ–‡ä»¶å¤¹
                if ([isDirectory boolValue]) {
                    //æ–¹æ¡ˆ1
//                    NSDirectoryEnumerator *dirEnumerator = [self enumeratorPathByFileManager:fileManager atURL:url propertiesForKeys:@[NSURLIsDirectoryKey] options:NSDirectoryEnumerationSkipsSubdirectoryDescendants];
//                    if (dirEnumerator.allObjects.count > 0) {
//                        NSLog(@"æ–‡ä»¶å¤¹å†…æœ‰æ–‡ä»¶,å¿½ç•¥æ­¤æ¡è·¯å¾„ %@",[url path]);
//                    } else {
//                        [urlDirFiles addObject:[url path]];
//                    }
                    
                    //æ–¹æ¡ˆ2
                    NSError *error = nil;
                    NSArray *listOfFiles = [fileManager contentsOfDirectoryAtPath:[url path] error:nil];
                    if (listOfFiles != nil && listOfFiles.count == 0) {
                        [urlDirFiles addObject:[url path]];
                    } else if (error == nil){
                        NSLog(@"æ–‡ä»¶å¤¹å†…æœ‰æ–‡ä»¶,å¿½ç•¥æ­¤æ¡è·¯å¾„ %@",[url path]);
                    } else {
                        NSLog(@"æ–‡ä»¶éå†è¯¥å±‚å‡ºé”™:%@",error);
                    }
                } else {
                    [urlDirFiles addObject:[url path]];
                }
            }
            NSLog(@"æ‰€æœ‰å¯ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨:\n%@",urlDirFiles);
        }
        NSTimeInterval nowTime = [[NSDate date] timeIntervalSince1970];
        NSLog(@"\næ–‡ä»¶æ•°é‡:%zd éå†æ€»æ•°:%zd\nè€—æ—¶:%.2f ç§’",urlDirFiles.count,total,(nowTime - currentTime));
        total = 0;
        
        dispatch_async(dispatch_get_main_queue(), ^{
            NSLog(@"scan end");
        });
    });
}


```



æ¥ä¸‹æ¥å°±æ˜¯æœ€æ ¸å¿ƒçš„ä»£ç å—  

```objc
- (NSDirectoryEnumerator *)enumeratorPathByFileManager:(NSFileManager *)fileManager
                                                 atURL:(NSURL *)url
                                     propertiesForKeys:(nullable NSArray<NSString *> *)keys
                                               options:(NSDirectoryEnumerationOptions)mask
{
    NSDirectoryEnumerator *enumerator = [fileManager
                                         enumeratorAtURL:url
                                         includingPropertiesForKeys:keys
                                         options:mask
                                         errorHandler:^(NSURL *url, NSError *error) {
                                             // Handle the error.
                                             // Return YES if the enumeration should continue after the error.
                                             NSLog(@"æ·±åº¦éå†å‡ºé”™%@",error);
                                             return YES;
                                         }];
    return enumerator;
}
			

```

`NSDirectoryEnumerator` æ˜¯ä¸€ä¸ªè·¯å¾„æšä¸¾è¿­ä»£å™¨ 


> talk is cheap, show me the result.  

ä¸‹é¢æ˜¯æˆ‘æ‰«ææœ¬åœ°`ä¸‹è½½`ç›®å½•çš„ç»“æœ
![](/assets/images/20170210DFSAlgorithm/DFS3.webp)

![](/assets/images/20170210DFSAlgorithm/Result.webp)

ç»“æœè¿˜æ˜¯æ¯”è¾ƒå¿«çš„ 

å•ä»æ•°æ®ä¸Šæ¥è®² æ¯”å¹¿åº¦ä¼˜å…ˆèŠ‚çœè‡³å°‘7ä¸‡æ¬¡Httpè¯·æ±‚

æˆ‘æ€€ç–‘æ˜¯macOSå¯¹ç³»ç»Ÿç›®å½•æœ‰ç´¢å¼•æˆ–è€…ç¼“å­˜ ç¬¬äºŒæ¬¡æ‰«ç é€Ÿåº¦æ¯”è¾ƒå¿«

æ€»ç»“
--
æ€»ä½“æ¥çœ‹ï¼Œæ•ˆæœè¿˜å¯ä»¥ï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„ç®—æ³•æ¥è§£å†³è¿™ç§é—®é¢˜ æ¬¢è¿@æˆ‘ æˆ–è€…å‘é‚®ä»¶æˆ‘ä¹Ÿå­¦ä¹ ä¸€ä¸‹. 
> [æœ€ç»ˆDFSdemo](https://github.com/sunyazhou13/DFSDemo)


ä¹Ÿå¯å­¦ä¸€ä¸‹:[Swift Depth First Search](https://www.raywenderlich.com/157949/swift-algorithm-club-depth-first-search)


URL: https://sunyazhou.com/2017/02/HowToUseGitManageCode/index.html.md
Published At: 2017-02-09 19:35:45 +0000

# å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç 

![](/assets/images/20170209HowToUseGitManageCode/guide.webp)


# å…¨å±€é…ç½®git

--

``` sh
$ git config --global user.name "username"  
$ git config --global user.email "email@you.com"
```
> `username` ä¸€èˆ¬ä»£è¡¨æäº¤çš„æœ¬æœºç”¨æˆ·å  
> `email@you.com` ä¸€èˆ¬æ˜¯é‚®ç®±åœ°å€ 


åˆ›å»ºæœ¬åœ°ä»“åº“è¿›è¡Œåˆå§‹åŒ–  
--

``` sh
$ git init  
```
> æ‰§è¡Œå®Œæˆä¹‹ååœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ª .git çš„éšè—æ–‡ä»¶å¤¹åŒ…å«gitçš„ä¿¡æ¯åœ¨é‡Œé¢

å…‹éš†è¿œç¨‹ç‰ˆæœ¬åº“
--

``` sh
$ git clone git@github.com:sunyazhou13/sunyazhou13.github.io.git
```

æŸ¥çœ‹å½“å‰ä»£ç åº“çŠ¶å†µ
--

``` sh
$ git status
```
> `git status` å‘½ä»¤ä¼šæ˜¾ç¤ºå½“å‰ä»£ç åº“çš„çŠ¶å†µï¼ŒåŒ…æ‹¬æ·»åŠ ï¼Œä¿®æ”¹ï¼ˆmodifiedï¼‰ï¼Œåˆ é™¤ï¼ˆdeletedï¼‰


ç‰ˆæœ¬ç®¡ç†
--

æŒ‡å‘gitå½“å‰æœ€æ–°ç‰ˆæœ¬ä¸º`HEAD`ï¼Œ`HEAD^`è¡¨ç¤ºä¸Šä¸€ç‰ˆæœ¬ï¼Œ`HEAD^^`ä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œ`HEAD~100`è¡¨ç¤ºå¾€ä¸Š100ä¸ªç‰ˆæœ¬

æ·»åŠ æœ¬åœ°ä¿®æ”¹ä»£ç 
--

``` sh
//æ·»åŠ å½“å‰ç›®å½•çš„æ‰€æœ‰ä¿®æ”¹
$ git add .  

```
> //å¦‚æœéœ€è¦æ·»åŠ æŒ‡å®šæ–‡ä»¶å¯ä»¥è¿™æ ·  
> `$ git add  A B  C `  // ä¸­é—´ç”¨ç©ºæ ¼éš”å¼€  
> //å¦‚æœæœ‰äº›æ–‡ä»¶æ ‡çº¢ ä»£è¡¨æœªçº³å…¥git ç®¡ç† å¯ä»¥ `rm -rf xxx`åˆ é™¤è¯¥æ–‡ä»¶  
> //å¦‚æœæœ‰äº›æ–‡ä»¶æ ‡é»„ ä»£è¡¨æœ‰ä¿®æ”¹  
> //å¦‚æœæœ‰äº›æ–‡ä»¶æ ‡ç»¿ ä»£è¡¨æœ‰æ–‡ä»¶å·²ç»çº³å…¥ `git` ç®¡ç†


æäº¤
--

``` sh 
$ git commit -am "[äº§å“åç§°][è¿­ä»£åç§°] 1.ä¿®æ”¹ç‚¹ 2.ä¿®æ”¹ç‚¹xxx"
	
```

pushåˆ°`git`ä»£ç ä»“åº“
--

``` sh 
$ git push origin HEAD:refs/for/master
	
```
> å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡æäº¤ ä½¿ç”¨ `git push -u origin master`

push çš„æ—¶å€™è¿›è¡Œä»£ç è¿½è¸ª
--
``` sh
$ git push --set-upstream origin + åˆ†æ”¯å
```


å¦‚æœæäº¤è¢«åºŸå¼ƒ
--

``` sh
$ git fetch origin master
$ git reset --soft origin/master
$ git add .
$ git commit -m "some comments"
$ git push origin HEAD:refs/for/master
```
> å›åˆ°æœ¬åœ°ä»£ç åº“åº“ä¸­ï¼Œæ‰§è¡Œ


åˆ†æ”¯ç®¡ç†
--

åˆ›å»ºåˆ†æ”¯å¹¶åˆ‡æ¢è¿‡å»
``` sh 
$ git branch -b åˆ†æ”¯å
```

åˆ‡æ¢åˆ†æ”¯

``` sh 
$ git checkout åˆ†æ”¯å
```
> æŸ¥çœ‹è¿œç¨‹åˆ†æ”¯ `git branch -r` r ä»£è¡¨remote

åˆå¹¶åˆ†æ”¯
--

`$ git merge br-name`å°†`br-name`åˆ†æ”¯åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ä¸‹ 
åŠ å…¥`--no-ff`åˆ™è¡¨ç¤ºç¦ç”¨Fast forwardæ¨¡å¼ã€‚å³æ–°å»ºcommitè€Œä¸æ˜¯åˆ‡æ¢HEADæŒ‡é’ˆæ¥å®ç° 
`$ git merge --no-ff -m "merge with no-ff" dev` 
åˆå¹¶åˆ†æ”¯å‰å¯ä»¥é€šè¿‡`git diff <source_branch> <target_branch>`æ¥æŸ¥çœ‹ä¸¤è€…ä¸åŒ

åˆå¹¶å†²çª
--
mergeåˆ†æ”¯æ—¶ï¼Œå¦‚æœä¸¤åˆ†æ”¯å¯¹åŒä¸€åœ°æ–¹åšäº†ä¸åŒçš„ä¿®æ”¹ï¼Œåˆ™ä¸ºå†²çªï¼Œå†²çªçš„æ–‡ä»¶gitä¼šç”Ÿæˆå¦‚ä¸‹å†…å®¹

```
<<<<<<< HEAD 
Creating a new branch is quick & simple. 
======= 
Creating a new branch is quick AND simple. 
>>>>>>> feature1

```

è§£å†³å®Œå†²çª åˆå¹¶ä¹‹å è®°å¾—æ‰§è¡Œ

``` sh
$ git rebase --continue
```

å¼ºåˆ¶æ›´æ–° tag åˆ°æŒ‡å®šçš„ commit

``` sh
git tag --force v1.0.0 bc63359
git push --tags -f
```

> git ll å¯ä»¥çœ‹åˆ°çŸ­ç‰ˆæœ¬å·,å¦‚æœä¸å¥½ä½¿ è¯·æ‰§è¡Œå¦‚ä¸‹è„šæœ¬ç„¶åé‡è¯•


ä¸‹é¢æ˜¯å¸¸ç”¨çš„ git åˆ«å


``` sh
git config --global alias.ll "log --graph --all --pretty=format:'%Cred%h %Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative" 
git config --global alias.co checkout 
git config --global alias.br branch 
git config --global alias.ci commit 
git config --global alias.st status 
git config --global alias.last 'log -1 HEAD' 
git config --global alias.df diff
git config --global alias.co checkout
```

[è¯¦ç»†èµ„æ–™å‚è€ƒ](https://www.zybuluo.com/ValenW/note/364756)


æ‰¹é‡åˆ é™¤ æœ¬åœ°åˆ†æ”¯

```
git branch | grep 'branchName' |xargs git branch -D
```
è¿™ä¸ªæ˜¯é€šè¿‡ shell ç®¡é“å‘½ä»¤æ¥å®ç°çš„æ‰¹é‡åˆ é™¤åˆ†æ”¯çš„åŠŸèƒ½ã€‚
**grep**æ˜¯å¯¹**git branch**çš„è¾“å‡ºç»“æœè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…å€¼ä¸º**branchName**ã€‚
**xargs**çš„ä½œç”¨æ˜¯å°†å‚æ•°åˆ—è¡¨è½¬æ¢æˆå°å—åˆ†æ®µä¼ é€’ç»™å…¶ä»–å‘½ä»¤ã€‚
æ‰€ä»¥è¿™ä¸ªå‘½ä»¤çš„æ„æ€å°±æ˜¯
ä»åˆ†æ”¯åˆ—è¡¨ä¸­åŒ¹é…åˆ°æŒ‡å®šçš„åˆ†æ”¯ï¼Œç„¶åä¸€ä¸ªä¸€ä¸ªï¼ˆåˆ†æˆå°å—ï¼‰ä¼ é€’ç»™åˆ é™¤åˆ†æ”¯çš„å‘½ä»¤ï¼Œæœ€åè¿›è¡Œåˆ é™¤ã€‚
ä»è€Œè¾¾åˆ°æ‰¹é‡åˆ é™¤åˆ†æ”¯çš„ç›®çš„

ä¾‹å¦‚:æˆ‘æƒ³åˆ é™¤æœ¬åœ° ä»¥ 5.8.å¼€å¤´çš„åˆ†æ”¯ æˆ‘å¯ä»¥è¿™æ ·å†™

``` sh

git branch | grep '5.8.*' |xargs git branch -D

```

é€šè¿‡é€šé…ç¬¦å³å¯

> 2018å¹´9æœˆ30æ—¥æ›´æ–°

æŒç»­æ›´æ–°

git clean æ¸…ç†æ‰ä¸åœ¨gitç‰ˆæœ¬æ§åˆ¶ä¹‹å†…çš„æ–‡ä»¶  
--

``` sh
git clean -dfx  
```

> 2020.1.7 update


åˆ é™¤å·¥ç¨‹ä¸­æ€»æ˜¯æ”¾åˆ°ignoreä¸­è·Ÿè¸ªä¸ä¸Šå°çš„xcode userdata

æœ€è¿‘å·¥ç¨‹ä¸­æ€»æ˜¯å‡ºç°ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ æ— è®ºå¦‚ä½•æ”¾gitignoreæ€»æ˜¯ä¸ç”Ÿæ•ˆ

``` sh
Crown.xcworkspace/xcuserdata/sunyazhou.xcuserdatad/UserInterfaceState.xcuserstate

```

ä¸‹é¢çœ‹ä¸‹æ­£ç¡®çš„æ“ä½œ

` [project] `æ›¿æ¢æˆä½ çš„å·¥ç¨‹ ` [username]  `æ›¿æ¢æˆä½ çš„ç”¨æˆ·å

``` sh
git rm --cached [project].xcodeproj/project.xcworkspace/xcuserdata/[username].xcuserdatad/UserInterfaceState.xcuserstate
git commit -m "Removed file that shouldn't be tracked"
```
> 2022.12.2 æ›´æ–°è‡ª[Can't ignore UserInterfaceState.xcuserstate](https://stackoverflow.com/questions/6564257/cant-ignore-userinterfacestate-xcuserstate)


å¦‚æœéœ€è¦å„ç§è¯­è¨€çš„ignoreå¯ä»¥å‚è€ƒ[A collection of useful .gitignore templates](https://github.com/github/gitignore)


# åˆå¹¶å¤šæ¬¡æäº¤

åœ¨ Git ä¸­ï¼Œ`rebase` å‘½ä»¤ç”¨äºå°†ä¸€ç³»åˆ—æäº¤ä»ä¸€ä¸ªåˆ†æ”¯ä¸Šç§»åŠ¨åˆ°å¦ä¸€ä¸ªåˆ†æ”¯ä¸Šï¼ŒåŒæ—¶ä¿æŒæäº¤çš„é¡ºåºå’Œå†…å®¹ä¸å˜ã€‚`git rebase -i` æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„å˜ä½“ï¼Œå…è®¸ä½ å¯¹æäº¤è¿›è¡Œç¼–è¾‘ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ `git rebase -i HEAD~N` æ¥åˆå¹¶å¤šæ¬¡æäº¤ä¸ºä¸€æ¬¡æäº¤çš„æ­¥éª¤ï¼š

1. **ç¡®å®šéœ€è¦åˆå¹¶çš„æäº¤æ•°é‡**ï¼š
   - `HEAD~N` è¡¨ç¤ºä»å½“å‰æäº¤å‘å‰æ•° N ä¸ªæäº¤ã€‚ä½ éœ€è¦ç¡®å®š N çš„å€¼ï¼Œå³ä½ æƒ³è¦åˆå¹¶çš„æäº¤çš„æ•°é‡ã€‚

2. **å¯åŠ¨äº¤äº’å¼å˜åŸº**ï¼š
   - æ‰“å¼€ç»ˆç«¯æˆ– Git Bashï¼Œå¹¶åˆ‡æ¢åˆ°ä½ çš„ Git ä»“åº“ç›®å½•ã€‚
   - è¾“å…¥ `git rebase -i HEAD~N` å¹¶æ›¿æ¢ N ä¸ºä½ ç¡®å®šçš„æäº¤æ•°é‡ã€‚

``` bash
git rebase -i HEAD~3
```
> åˆå¹¶æœ€è¿‘3æ¬¡æäº¤

3. **ç¼–è¾‘æäº¤åˆ—è¡¨**ï¼š
   - è¿™å°†æ‰“å¼€ä¸€ä¸ªæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œåˆ—å‡ºäº†ä» `HEAD~N` åˆ°å½“å‰ HEAD çš„æ‰€æœ‰æäº¤ã€‚
   - ä½ å°†çœ‹åˆ°æ¯ä¸ªæäº¤å‰é¢éƒ½æœ‰ä¸€ä¸ª `pick` å‘½ä»¤ã€‚ä½ å¯ä»¥é€šè¿‡ç¼–è¾‘è¿™äº›å‘½ä»¤æ¥å†³å®šå¦‚ä½•å¤„ç†æ¯ä¸ªæäº¤ã€‚

4. **åˆå¹¶æäº¤**ï¼š
   - è¦åˆå¹¶æäº¤ï¼Œä½ éœ€è¦å°†é™¤äº†ç¬¬ä¸€ä¸ªæäº¤ä¹‹å¤–çš„æ‰€æœ‰æäº¤çš„ `pick` æ”¹ä¸º `squash` æˆ– `s`ï¼ˆ`squash` çš„ç®€å†™ï¼‰ã€‚è¿™æ ·ï¼Œé™¤äº†ç¬¬ä¸€ä¸ªæäº¤å¤–ï¼Œå…¶ä»–æ‰€æœ‰æäº¤éƒ½ä¼šè¢«åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªæäº¤ä¸­ã€‚
   - ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä»¥ä¸‹æäº¤åˆ—è¡¨ï¼š
   
     ``` bash
     pick 3f3f3f3 ç¬¬ä¸€ä¸ªæäº¤ä¿¡æ¯
     pick 4b4b4b4 ç¬¬äºŒä¸ªæäº¤ä¿¡æ¯
     pick 5c5c5c5 ç¬¬ä¸‰ä¸ªæäº¤ä¿¡æ¯
     ```
   
     ä½ åº”è¯¥å°†å®ƒä»¬ä¿®æ”¹ä¸ºï¼š
     
     ``` bash
     pick 3f3f3f3 ç¬¬ä¸€ä¸ªæäº¤ä¿¡æ¯
     squash 4b4b4b4 ç¬¬äºŒä¸ªæäº¤ä¿¡æ¯
     squash 5c5c5c5 ç¬¬ä¸‰ä¸ªæäº¤ä¿¡æ¯
     ```
	> pickä½œä¸ºæœ€å¼€å§‹çš„åŸºç‚¹

5. **ç¼–è¾‘æäº¤ä¿¡æ¯**ï¼š
   - ä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨åï¼ŒGit ä¼šåˆå¹¶ä½ é€‰æ‹©çš„æäº¤ï¼Œå¹¶æ‰“å¼€å¦ä¸€ä¸ªç¼–è¾‘å™¨è®©ä½ ç¼–è¾‘æ–°çš„æäº¤ä¿¡æ¯ã€‚
   - ä½ å¯ä»¥é€‰æ‹©ä¿ç•™ç¬¬ä¸€ä¸ªæäº¤çš„ä¿¡æ¯ï¼Œæˆ–è€…ç¼–è¾‘ä¸€ä¸ªæ–°çš„æäº¤ä¿¡æ¯æ¥æ€»ç»“æ‰€æœ‰åˆå¹¶çš„æäº¤ã€‚

6. **å®Œæˆå˜åŸº**ï¼š
   - ä¿å­˜å¹¶å…³é—­æäº¤ä¿¡æ¯ç¼–è¾‘å™¨ï¼ŒGit å°†å®Œæˆå˜åŸºæ“ä½œï¼Œå¹¶å°†ä½ çš„æäº¤å†å²æ›´æ–°ä¸ºä¸€ä¸ªæ–°çš„çº¿æ€§å†å²ã€‚

è¯·æ³¨æ„ï¼Œå˜åŸºæ˜¯ä¸€ä¸ªç ´åæ€§æ“ä½œï¼Œå®ƒä¼šæ”¹å˜å†å²æäº¤çš„å“ˆå¸Œå€¼ã€‚å› æ­¤ï¼Œåªæœ‰åœ¨ä½ ç¡®å®šä¸ä¼šå½±å“å…¶ä»–äººçš„å·¥ä½œæ—¶æ‰åº”è¯¥ä½¿ç”¨å®ƒï¼Œç‰¹åˆ«æ˜¯åœ¨å…¬å…±åˆ†æ”¯ä¸Šã€‚å¦‚æœä½ åœ¨å›¢é˜Ÿä¸­å·¥ä½œï¼Œæœ€å¥½åœ¨è¿›è¡Œè¿™æ ·çš„æ“ä½œä¹‹å‰ä¸å›¢é˜Ÿæˆå‘˜æ²Ÿé€šã€‚

# å¤§æ–‡ä»¶å¤„ç†

``` sh
brew install git-lfs                                 # install via homebrew
git lfs install                                      # initialize lfs for yor repo
git lfs track ios-app/Frameworks/*.framework/**/*    # track all frameworks in your project.  *.xcframework
git add --all                                        # stage
git commit -m "Added files to git lfs"               # commit
git lfs ls-files
git push
```


URL: https://sunyazhou.com/2017/02/HowtToDisableWebviewNSScrollViewScroll/index.html.md
Published At: 2017-02-09 13:37:28 +0000

# Webviewçš„NSScrollViewç¦ç”¨æ»‘åŠ¨åŠŸèƒ½

åœ¨`webview`çš„`WebFrameLoadDelegate`ä»£ç†é‡Œé¢å®ç°å¦‚ä¸‹ä»£ç 

``` objc

#pragma mark -
#pragma mark - WebViewDelegate
- (void)webView:(WebView *)sender didFinishLoadForFrame:(WebFrame *)frame
{
    [sender stringByEvaluatingJavaScriptFromString:@"document.documentElement.style.overflow='hidden'"];
}
```


ä»¥ä¸Šä»£ç å±äº`macOS`ä¸Šçš„å¼€å‘å†…å®¹.



URL: https://sunyazhou.com/2017/01/SpringFestival/index.html.md
Published At: 2017-01-28 13:42:34 +0000

# 2017å›å®¶è¿‡å¹´

![](http://p1.bqimg.com/584350/7df258f2ecddcf81.webp)
> ç»ƒä¹ äº†ä¸€å¹´çš„å°æ¥·, æ„Ÿè°¢è€ä¹¡**æ½˜æ—­**çš„å¸®åŠ©ï¼Œæˆ‘çš„ä¹¦æ³•æœ‰å¾ˆå¤šæå‡.


å‡ºå‘
--

å½“æˆ‘æ‹¿ç€è¡Œæç®±ç­‰å¾…è¿‡å¹´å›å®¶åœ°é“é‚£ä¸€åˆ» åˆæ˜¯ä¸€å¹´è¿‡å»äº† 
![](http://p1.bqimg.com/584350/035a303723a4b623.webp)
è¿™ä¹ˆå¤šå¹´æ€»è§‰å¾—è‡ªå·±å’Œå†œæ°‘å·¥ä¸€æ ·ï¼Œæ— éå°±æ˜¯ç©¿ç€ä½“é¢ä¸€äº›,ä½†å†…å¿ƒè¿˜æ˜¯å†œæ°‘å·¥çš„å†…å¿ƒ.



é«˜é“
--

çå¼€çœ¼ç›çœ‹åˆ°è¿™ç¯‡é»‘åœŸåœ°ç›–ç€ä¸€å±‚é›ª, æˆ‘åº”è¯¥å¿«åˆ°å®¶äº†ã€‚
![Markdown](http://p1.bpimg.com/584350/5addde1fe4d65611.webp)
æˆ‘å°±æ˜¯ä»è¿™ç‰‡é»‘åœŸåœ°èµ°å‡ºå»çš„å¹´è½»äºº, æˆ‘23å¹´æ²¡æœ‰ç¦»å¼€è¿‡è¿™ç‰‡é»‘åœŸåœ°ï¼Œå¦‚ä»Šåœ¨äº¬ç ç –å¥½å‡ å¹´ã€‚ä¹°æˆ¿æ²¡èµ„æ ¼,ä¹°è½¦æ²¡ç‰Œç…§,åªèƒ½æ¯å¤©éª‘è½¦æˆ‘å¿ƒçˆ±çš„å°ç‰›M1ä¸Šç­ã€‚(å…¶å®æˆ‘å†…å¿ƒæ˜¯å´©æºƒçš„),åªæœ‰é›¾éœ¾é™ªç€å“¥,æœ‰äº‹æ²¡äº‹æ¥åŒ—äº¬çœ‹çœ‹æˆ‘å’ŒåŒ—äº¬çš„åœŸè‘—ã€‚

24å²å…¥èŒç™¾åº¦å¦‚ä»Šå·²ç»å¿«3å¹´äº†, æƒ³æƒ³å·²ç»å¾ˆä¹…æ²¡æ¢å·¥ä½œäº†.å·¥èµ„å°‘çš„å¯æ€œ,æƒ³èµ·é‚£ä¸ªæ¯å¤©éƒ½ä¸€é—¨å¿ƒæ€ç ”ç©¶äººå·¥æ™ºèƒ½çš„å‚é•¿ï¼Œæˆ‘çœŸæƒ³æ‹’ç»å†ç»™ä»–æ‰“å·¥äº†.


ä¸­è½¬ç«™
--

æ“¦ è½¦åˆ°ç«™äº† (æˆ‘æ‰“ç®—ä»¥ååœ¨è¿™ä¹°ä¸ªæ¥¼)
![Markdown](http://i1.piimg.com/584350/698eb97cae2b2dea.webp)  
åˆšä¸‹ç«è½¦ å·²ç»è¢«è¿™ç§ç†Ÿæ‚‰çš„å†·ç¬é—´æ‰“é€.è¿™ç§å†·æ˜¯å¤šä¹ˆçš„ç†Ÿæ‚‰, æˆ‘æ—©ç©¿ä¸Šäº†
[æ—ç”¸é‹](https://item.taobao.com/item.htm?spm=a230r.1.14.9.pmOPas&id=36777946060&ns=1&abbucket=15#detail),åªæœ‰ç†Ÿæ‚‰ä¸œåŒ—çš„å°ä¼™ä¼´æ‰çŸ¥é“å•¥å«æ—ç”¸é‹
> å¤§åº†å¸‚æ—ç”¸å¿åˆ¶é€  çš„æ—ç”¸é‹ ä¿—ç§°**è€å¤´é‹** æˆ‘å°±ä¸ä¸Šç…§ç‰‡äº†,æˆ‘è§‰å¾—è¿™æ˜¯ä¸œåŒ—äººå€¼å¾—éª„å‚²çš„æ–‡åŒ–é—äº§,éƒ½å¯ä»¥ç”³è¯·ä¸–ç•Œæ–‡åŒ–é—äº§äº†,åœ¨å†°åŸæ²¡æœ‰è¿™é‹æˆ‘ä¼°è®¡ä½ å¾ˆéš¾åº¦è¿‡æ¼«é•¿ä¸¥å¯’çš„å†¬å¤©ã€‚ä¸€åŒé‹å”®ä»·ä»…ä»… 33 å…ƒ é€ä¸€åŒç¾Šæ¯›é‹å«, è¯´å¥å®è¯è¿™ç»å¯¹æ˜¯ä¸œåŒ—äººçš„ä¸šç•Œè‰¯å¿ƒï¼Œè¿™é‹ä¸€å¹´éƒ½ä¸æ–­å¸®æ–­åº•ï¼Œä¸€ä¸ªå†¬å¤©ç©¿è¿™é‹å¾ˆæš–å’Œ,ä¸ä¿¡ä½ å¯ä»¥é—®é—®ä½ èº«è¾¹çš„ä¸œåŒ—äººã€‚
> å½“ç„¶ä¸ç†Ÿæ‚‰å¥—è·¯çš„ä¼°è®¡ä¸çŸ¥é“ä¹°å•¥ç‰Œå­å¥½, æˆ‘å°è±¡ä¸­åªæœ‰ æ—å˜‰ç‰Œ åŒä¸½ç‰Œæ¯”è¾ƒå¥½ ä½†æ˜¯å·¥å‚ä¼°è®¡æ—©ç ´äº§äº†,33å…ƒæ¯åŒä¸Šå“ªæŒ£é’±å»å•Šã€‚æƒ³ä¹°çš„å°ä¼™ä¼´æˆ–è€…æƒ³å»ä¸œåŒ—æ—…æ¸¸çš„å°ä¼™ä¼´ å»ºè®®éšä¾¿ä¹°ä¸€åŒçš„å°±è¡Œäº† éƒ½ä¸€æ · åæ­£ä¸è´µã€‚
![Markdown](http://p1.bqimg.com/584350/fb737f626882c66b.webp)

å°åƒ
--


å¤äº‘äºº:"ä¸Šè½¦é¥ºå­ä¸‹è½¦é¢" è¿™å¥è¯è¯´çš„å¾ˆæœ‰å“²ç†æˆ‘ç‰¹æ„åœ¨ç™¾åº¦æœäº†ä¸€ä¸‹
ä¸è¿‡æˆ‘è¿˜æ˜¯æƒ³å»åƒå“ˆå°”æ»¨çš„å–œå®¶å¾·æ°´é¥º
![Markdown](http://p1.bqimg.com/584350/042feb2337732f5e.webp) 
> trust meå¦‚æœåˆ°å“ˆå°”æ»¨å¿…é¡»è¦å°å°**å–œå®¶å¾·æ°´é¥º**å’Œ**ä¸œæ–¹é¥ºå­ç‹**  
> ä¸å»å°å°æ°¸è¿œä¸çŸ¥é“å•¥å«åœ°é“çš„é¥ºå­, åšé¥ºå­èƒ½åšåˆ°æ·‹æ¼“å°½è‡´ä¹Ÿæ²¡è°äº†,é¥ºå­çš®ã€å¤§å°ã€åšåº¦ã€å¼§åº¦ã€éƒ½æœ‰ä¸“é—¨çš„è®¡é‡å·¥å…·, å¦‚æœæŠŠ**åšé¥ºå­**å½“åšä¸€ä¸ªappçš„è¯,æˆ‘è§‰å¾—å–œå®¶å¾·åº”è¯¥æ˜¯ app ä¸­çš„æ”¯ä»˜å®, ä½†æ˜¯æ¯”è¾ƒè›‹ç–¼çš„æ˜¯è¿™äº›ä¼ ç»Ÿçš„æ°‘æ—ä¼ä¸šéƒ½ä¸å‘å±•äº’è”ç½‘, ä¸æ”¯æŒä»»ä½•ç½‘ç»œæ”¯ä»˜ã€æ”¯ä»˜å®ã€å¾®ä¿¡ã€ç™¾åº¦é’±åŒ…éƒ½ç”¨ä¸äº†ã€æˆ‘çœŸè§‰çš„å–œå®¶å¾·CEOåº”è¯¥è˜è¯·å“¥ç»™ä»–å½“äº’è”ç½‘æ€»è£ã€ç”¨äº’è”ç½‘å‘å±•ä¸€ä¸‹ä¼ ç»Ÿä¼ä¸šã€è¿™ç§å°é—­çš„ç»è¥æ¨¡å¼æˆ‘æŒæ‰¹è¯„çš„æ€åº¦.è¿™æ˜¯æ–°æ—¶ä»£çš„ä¸­å›½ã€æƒ³å‘å±•å¿…é¡»è¦ä¸æ—¶ä¿±è¿›ã€è·Ÿä¸Šæ—¶ä»£çš„å‘å±•ä¸èƒ½é—­å…³é”å›½ã€æˆ‘æ€€ç–‘å–œå®¶å¾·çš„ è€å¤§ä¸å¤ªç›¸ä¿¡äº’è”ç½‘ç»™ä»–å¸¦æ¥çš„ä»»ä½•æ”¹å˜ã€è¿™ä¸€ç‚¹æˆ‘å¿…é¡»æ‰¹è¯„ä¸€ä¸‹ä»–ã€è¦æ‹¿å‡ºæé¸¿ç« å¤§äººä»¥ä¸€äººæŠµä¸€å›½çš„èƒ½åŠ›. ä¸æ–­å­¦ä¹ ,ä¸æ—¶ä¿±è¿›



å†°é›ªå¤§ä¸–ç•Œ
--

è¯´æ¥æƒ­æ„§åœ¨å“ˆå°”æ»¨å¥½å‡ å¹´éƒ½æ²¡å»è¿‡**å†°é›ªå¤§ä¸–ç•Œ**(ä¸Šå­¦æ—¶æ¯”è¾ƒç©·)é—¨ç¥¨åœ¨ç³¯ç±³ä¸Šè‡³å°‘éœ€è¦360å·¦å³/äºº,è¿™ç»å¯¹æœ‰ç‚¹è´µ.

å‚åŠ å·¥ä½œä»¥åæŒ£é’±äº†å¿…é¡»æƒ³åœ†äº†å­¦ç”Ÿæ—¶ä»£çš„æ¢¦æƒ³,äºæ˜¯ è®©æˆ‘å¤§å§è¯·æˆ‘å»äº†å“ˆå“ˆ

![Markdown](http://p1.bqimg.com/584350/d449b5d2f5debbed.webp)

![Markdown](http://i1.piimg.com/584350/f894381b5bd3aaee.webp)
![Markdown](http://i1.piimg.com/584350/d1115c4e6d7981ab.webp)


> è¿™ä¸ªä¸–ç•Œç©çš„éƒ½æ˜¯äººçš„æƒ³è±¡åŠ›,æˆ‘ä»æ¥æ²¡æƒ³è¿‡å†°å’Œé›ªèƒ½ç©å‡ºä»€ä¹ˆèŠ±æ ·,å»äº†æ‰çŸ¥é“åªè¦æœ‰æƒ³è±¡åŠ›å’Œåˆ›é€ åŠ› ä¸€ä»¶æ™®é€šä¸œè¥¿èƒ½è¿™ä¹ˆæœ‰æ„æ€ã€‚è®°å¾—ä¸€ç‚¹è¦æœ‰è½¦å»å¤§ä¸–ç•Œæœ€å¥½, æˆ‘å»ºè®®ç§Ÿä¸ªè½¦æˆ–è€…äº²æˆšæœ‰è½¦,ä¸ç„¶å¿…é¡»åé»‘è½¦å›æ¥,è¿™ä¸ªå¾ˆè›‹ç–¼,ä»€ä¹ˆæ»´æ»´æ‰“è½¦ ç”¨å¸æœºçš„è¯ **"å•¥æ»´éƒ½ä¸å¥½ä½¿"** è¿™ä¸ªç¡®å®å¾ˆæ— å¥ˆ,å¤§å®¶ç©å®Œå›ä¸å»å¾ˆæ˜¯è›‹ç–¼.æ”¿åºœå¾—åŠ å¤§åŠ›åº¦ç®¡åˆ¶è¿™äº›å‡ºç§Ÿè½¦å¸æœº.


ç¾ä¸½å†°åŸ
--
![Markdown](http://i1.piimg.com/584350/a9abec8d1c2c56e0.webp)  
![Markdown](http://i1.piimg.com/584350/7bf35db34b720d2a.webp)  
![Markdown](http://i1.piimg.com/584350/dc97959821ac8fa2.webp)  
![Markdown](http://i1.piimg.com/584350/a260c895027dd64c.webp)
> åœ¨å“ˆå°”æ»¨ä¿„ç½—æ–¯çš„å»ºç­‘éšå¤„å¯è§, å“ˆç«™å‰è¾¹(å‰ä¸¤å¼ ç…§ç‰‡)å§‹äº1907å¹´æœ‰ä¸ªä»€ä¹ˆæ–¯åŸºå¼€ä¸ªèŒ¶é¦†, å»ºçš„æ¥¼ç¾¤ä¾ç„¶è¿˜çŸ—ç«‹åœ¨æœæˆˆé‡Œå¤§è¡—é™„è¿‘, æ²¡å»çš„å°ä¼™ä¼´å¯ä»¥å»çœ‹çœ‹, æœ€åä¸€å¼ æ–­å£æ®‹å£åœ¨æŠ¢æ•‘æ€§ä¿®å¤ä¸­ã€‚


çº¢è‚ 
--
å“ˆå°”æ»¨æœ‰ä¸ªæ¯”è¾ƒå‡ºåçš„ä¸œè¥¿è²Œä¼¼å«çº¢è‚ ,ä½†æ˜¯ ä¸æ˜¯æœ¬åœ°äººå¾ˆéš¾çŸ¥é“å“ªé‡Œä¹°çš„æ‰ç®—åœ°é“ æˆ‘ä»Šå¤©å¯ä»¥å‘Šè¯‰å¤§å®¶å•¥å«åœ°é“çš„å“ˆå°”æ»¨çº¢è‚ 
![Markdown](http://i1.piimg.com/584350/1736e20ba1e625f5.webp)  

![Markdown](http://p1.bpimg.com/584350/40a9d97bdeee2b05.webp)

> å¤§å®¶ä¸€å®šå¬è¿‡ç§‹æ—çº¢è‚ ,éƒ½ä»¥ä¸ºçº¢è‚ åº”è¯¥æ˜¯ç§‹æ—ç‰Œå­,å…¶å®å¥½åƒå«ç§‹æ—é‡Œé“æ–¯ç³»åˆ—çš„é£Ÿå“
> å¦‚æœæƒ³ä¹°æ­£å®—çš„çº¢è‚ æˆ‘æ¨è2ä¸ªå“ç‰Œä¸ªä¸¤ä¸ªåœ°ç‚¹
  
  * **å•†å§”çº¢è‚ **  
  
  è¿™ä¸ªå•†å§”åœ¨ é“å¤–çº¢æ——å¤§è¡—514å·ï¼ˆé»‘é¾™æ±Ÿå·¥ç¨‹å­¦é™¢å¯¹é¢ï¼‰å‰åº—åå‚,ä¹‹æ‰€ä»¥è¿™ä¹ˆå‡ºåæ˜¯å› ä¸ºå•†å§”çº¢è‚ å…¨ç¨‹çº¯æ‰‹å·¥åˆ¶ä½œ,æ·±å¾—é¾™æ±Ÿäººå–œçˆ±.å¾ˆå¤šäººå–œæ¬¢åƒå®ƒé‚£ä¸ªä¸“æœ‰çš„å‘³é“.ä¹Ÿæœ‰å¾ˆå¤šäººä¸å–œæ¬¢å®ƒçš„å‘³é“å«Œå®ƒå¤§è’œæ”¾çš„å¤šå“ˆå“ˆ.åæ­£æˆ‘åƒéƒ½ä¸€æ ·æ²¡å•¥ç‰¹åˆ«çš„.å¦‚æœæˆ‘å›å“ˆå°”æ»¨å‘å±•æˆ‘ä¸€å®šå­¦å­¦çº¢è‚ æ€ä¹ˆåˆ¶ä½œçš„è‡ªå·±åšçš„æ‰æ”¾å¿ƒå“ˆå“ˆ. è¿™ä¸ªçº¢è‚ ç«çˆ†çš„ç¨‹åº¦å¾—æ—©æ™¨5ç‚¹å»æ’é˜Ÿ æ¯å¤©å‡ ç™¾æ–¤,å–æ²¡äº†å°±å”®ç½„äº†,å°¤å…¶è¿‡èŠ‚æœŸé—´
  * **ç§‹æ—é‡Œé“æ–¯çº¢è‚ **  
   
    è¿™ä¸ªå°±åœ¨ä¸Šè¾¹é‚£ç»¿è‰²å›¾ç‰‡çš„åœ°æ–¹åœ°ä¸‹ä¸€å±‚,çœ‹å“ªé‡Œæ’é˜Ÿäººå¤šå°±åœ¨é‚£é‡Œä¹°å°±æ˜¯ç§‹æ—çº¢è‚ æœ€æ­£å®—çš„å–ç‚¹,ä¸€å®šä¸è¦ç›¸ä¿¡ä»»ä½•äººè¯´ç§‹æ—çº¢è‚ æ¢åœ°æ–¹äº†,å¥½å‡ åå¹´äº†éƒ½æ²¡æ¢åœ°æ–¹æ€ä¹ˆå¯èƒ½è¯´æ¢å°±æ¢.éƒ½æ˜¯å•†ä¸šç«äº‰æå¾—é¬¼æŠŠæˆ,å²‚èƒ½æ¬ºéª—æˆ‘è¿™ä¸ªç¨‹åºçŒ¿. (ä¸œå¤§ç›´è¡—319å·(è¿‘ç§‹æ—å›½é™…è´­ç‰©ä¸­å¿ƒ)
15245082279,(0451)58938888)  
å°±ä¸‹å›¾è¿™åœ°æ–¹
![Markdown](http://p1.bqimg.com/584350/b4c23a2cdd0e057b.webp)

ä»¥åä¸è¦é—®è°å“ªé‡Œä¹°çº¢è‚ æœ€å¥½äº†,ä¸Šè¾¹çš„å°±æ˜¯æœ€æ­£å®—çš„ä¹°çº¢è‚ çš„åœ°æ–¹äº†.

å›å®¶
--
![Markdown](http://p1.bpimg.com/584350/8f60e12618c08949.webp)
çœ‹ç€å®¶ä¹¡çš„å¤•é˜³,æˆ‘çœŸçš„å¿«åˆ°å®¶äº†-æµ·ä¼¦å¸‚
















URL: https://sunyazhou.com/2017/01/iOSDevelopmentKnowledgePointAccumulate/index.html.md
Published At: 2017-01-18 13:44:57 +0000

# iOSå¼€å‘çŸ¥è¯†ç‚¹ç§¯ç´¯

> æäº†å¾ˆä¹…iOSå¼€å‘, ä»¥å‰éƒ½æ˜¯ç”¨è„‘å­è®°æŸç§æŠ€æœ¯æ–‡ç« å’ŒæŠ€æœ¯å®ç°çš„ä»£ç ,ä½†æ˜¯å½“ä¸€ä¸ªäººçš„å¤§è„‘è¶…è¿‡ä¸€å®šå­˜å‚¨æé™çš„æ—¶å€™å°±ä¼šå‡ºç°æ ˆæº¢å‡º(å…¶å®æˆ‘æ¯”è¾ƒç¬¨)ï¼Œåæ¥å¼€å§‹é€æ¸è®°æŸåšå®¢çš„æ˜¯è°å†™çš„ï¼Œæˆ–è€…æŠ€å·§å®ç°çš„ä»£ç ã€‚ã€‚ã€‚åæ¥å‘ç°ä¸ä½†æ ˆæº¢å‡ºï¼Œå †ä¹Ÿå¿«å­˜ä¸ä½æµ·é‡çš„iOSæŠ€æœ¯æ–‡ç« äº†ã€‚ã€‚ã€‚å”‰äºæ˜¯æˆ‘çš„chromeä¸Šä¿ç•™äº†æ‰€æœ‰ç»å…¸çš„æ–‡ç« æ ‡ç­¾å’Œæµè§ˆå™¨ç½‘é¡µåœ°å€ï¼Œç°åœ¨æˆ‘æƒ³æŠŠå®ƒæ•´ç†å‡ºæ¥æ”¾åœ¨åšå®¢é‡Œï¼Œæ–¹ä¾¿æŸ¥æ‰¾æŸæŠ€æœ¯å®ç°çš„ä»£ç (å…¶å®æˆ‘çš„åŸç™¾åº¦äº‘å°ä¼™ä¼´å®ä¹ ç”Ÿéƒ½è§‰å¾—æˆ‘èƒ½å¯¹æŸç§æŠ€æœ¯å­˜å‚¨å¦‚æ­¤è¯¦ç»†èµ¶åˆ°æƒŠå¹).å¥½äº† æˆ‘ä»¬å¼€å§‹iOSçŸ¥è¯†ç‚¹æŠ€æœ¯å¯¼èˆª

iOSæŠ€æœ¯åˆ†ç±»å¦‚ä¸‹

* éŸ³é¢‘
* ç›¸æœºä¸ç…§ç‰‡
* å›¾å½¢å›¾åƒ
* åŠ¨ç”»
* UIè½¬åœº
* ASDK(AsyncDisplayKit)
* swiftç›¸å…³
* æ•°å­¦å›¾å½¢
* æ¶æ„
* Masonry
* Cocoapods
* æ–‡ä»¶ç›¸å…³


éŸ³é¢‘
--

__[iOSéŸ³é¢‘æ’­æ”¾ (ä¸€)ï¼šæ¦‚è¿°](http://msching.github.io/blog/2014/07/07/audio-in-ios/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (äºŒ)ï¼šAudioSession](http://msching.github.io/blog/2014/07/08/audio-in-ios-2/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (ä¸‰)ï¼šAudioFileStream](http://msching.github.io/blog/2014/07/09/audio-in-ios-3/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (å››)ï¼šAudioFile](http://msching.github.io/blog/2014/07/19/audio-in-ios-4/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (äº”)ï¼šAudioQueue](http://msching.github.io/blog/2014/08/02/audio-in-ios-5/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (å…­)ï¼šç®€å•çš„éŸ³é¢‘æ’­æ”¾å™¨å®ç°](http://msching.github.io/blog/2014/08/09/audio-in-ios-6/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (ä¸ƒ)ï¼šæ’­æ”¾iPod Libraryä¸­çš„æ­Œæ›²](http://msching.github.io/blog/2014/09/07/audio-in-ios-7/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (å…«)ï¼šNowPlayingCenterå’ŒRemoteControl](http://msching.github.io/blog/2014/11/06/audio-in-ios-8/)__  
__[iOSéŸ³é¢‘æ’­æ”¾ (ä¹)ï¼šè¾¹æ’­è¾¹ç¼“å­˜](http://msching.github.io/blog/2016/05/24/audio-in-ios-9/)__

> ä»¥ä¸Šå†…å®¹æ¥è‡ª[ç å†œäººç”Ÿ](http://msching.github.io/) è¿™ä¸ªå“¥ä»¬æˆ‘æœ‰è¿‡äº¤æµï¼Œæ„Ÿè§‰åº•å±‚éŸ³é¢‘æŠ€æœ¯æ¯”è¾ƒé€å½»ï¼Œé€‚åˆåˆå­¦è€…ä»¥åŠä¸­çº§å¼€å‘è€…ç ”ç©¶å­¦ä¹ å’Œä½¿ç”¨ã€‚


å›¾å½¢å¤„ç†
--

__[åŸºç¡€çŸ¥è¯†](https://objccn.io/issue-21-1/)__ä¸€äº›åˆ—æ•™ç¨‹å¯ä»¥è¿ç»­çœ‹å®Œ  
__[GPUImage](https://github.com/BradLarson/GPUImage)__åº“   
__[iOS GPUImageæºç è§£è¯»ï¼ˆä¸€ï¼‰](http://mp.weixin.qq.com/s/pg2vPYftkfghoQswxJFIvw)__
__[å¼€æºä¸€ä¸ªä¸Šæ¶ App Store çš„ç›¸æœº App](http://hawk0620.github.io/blog/2017/02/17/zpcamera-opensource-share/)__


å›¾å½¢å›¾åƒ
--
__[åŸºäº OpenCV çš„äººè„¸è¯†åˆ«](https://www.objccn.io/issue-21-9/)__  
__[å›¾ç‰‡ç¼–è¾‘](https://github.com/3tinkers/TKImageView)__


åŠ¨ç”»
--

__[QQä¸­æœªè¯»æ°”æ³¡æ‹–æ‹½æ¶ˆå¤±çš„å®ç°åˆ†æ](http://kittenyang.com/drawablebubble/)__  
__[iOS è‡ªå®šä¹‰ä¸‹æ‹‰çº¿æ¡åŠ¨ç”»](http://kittenyang.com/curvelineanimation/)__  
__[ä¸€ä¸ªåº“æ¶µç›–äº†æ‰€æœ‰iOSåŠ¨ç”»æ•ˆæœ](https://github.com/sunyazhou13/Animations)__
__[pop](https://github.com/facebook/pop)__

> å­¦åŠ¨ç”»å…ˆä»[éª‘æ»”(Kitten)](http://kittenyang.com/)çš„åŠ¨ç”»æèµ·æœ€é è°±  
> ä»¥ä¸Šæ˜¯æ™®é€šåŠ¨ç”»å†…å®¹2ç¯‡æ¥è‡ªKitten  
> æŒç»­æ›´æ–°ä¸­


è½¬åœºåŠ¨ç”»
--


__[WWDC 2013 Sessionç¬”è®° - iOS7ä¸­çš„ViewControlleråˆ‡æ¢]()__ å–µç¥çš„è¿™ç¯‡å¿…çœ‹  

__[UIPresentationController Tutorial: Getting Started](https://www.raywenderlich.com/139277/uipresentationcontroller-tutorial-getting-started)__ éœ€è¦ç¿»å¢™  
*(è¯è¯´æˆ‘è§£é‡Šä¸€ä¸‹è¿™ä¸ªè¯"ç¿»å¢™",ç¿»å¢™åè¯å«ç§‘å­¦ä¸Šç½‘,é»‘è¯å«è‡ªå¤‡æ¢¯å­,å› ä¸ºå¤§å®¶ä¸€å¼€å§‹éƒ½ç”¨[äº‘æ¢¯VPN](https://www.yuntipub.com/)è®¿é—®å›½å¤–ç½‘ç«™,å› ä¸ºæˆ‘å›½æäº†ä¸ªåƒåœ¾é˜²ç«å¢™çš„å¤§å‹å±€åŸŸç½‘,è™½ç„¶é˜»ç¢äº†ä¸–ç•Œæ–‡æ˜å’ŒæŠ€æœ¯ç§‘æŠ€çš„å‘å±•ä½†ä¹Ÿé˜²èŒƒäº†ä¸€äº›ä¸å¥åº·å†…å®¹ï¼Œæ¯”å¦‚ä¸‡ä¸€æœ‰ä¸€å¤©ä½ æä¸ªè½¦åºŠï¼Œåˆ¶é€ ä¸ªå¾®å†²å‡ºæ¥æ€ä¹ˆåŠå“ˆå“ˆ,æ‰€ä»¥è¦ç¿»è¶Šé‚£ä¸ªé˜²ç«å¢™å°±ä¿—ç§°ç¿»å¢™)*  

__[è‡ªå®šä¹‰æ§åˆ¶å™¨è½¬åœºåŠ¨ç”»åŠä¸‹æ‹‰èœå•çš„å°Demo | AppCodaç¿»è¯‘ç³»åˆ—](http://wxgbridgeq.github.io/blog/2015/08/10/custom-transition-animation/)__

>è¿˜æœ‰å¯ä»¥githubæœç´¢__[Transition](https://github.com/search?l=Objective-C&o=desc&q=Transition&s=stars&type=Repositories&utf8=%E2%9C%93)__  
>å¾ˆå¤šè¿™ç§è½¬åœºåŠ¨ç”»ä¸ä¸€ä¸€ä»‹ç»


ASDK(AsyncDisplayKit)
--

__[å®˜æ–¹æ–‡æ¡£](http://asyncdisplaykit.org/)__ (éœ€è¦ç¿»å¢™)  
__[ä¸­æ–‡ç¿»è¯‘](http://reactnative.cn/docs/0.46/getting-started.html)__  
__[AsyncDisplayKit 2.0 Tutorial: Getting Started](https://www.raywenderlich.com/124311/asyncdisplaykit-2-0-tutorial-getting-started)__  
__[AsyncDisplayKit 2.0 Tutorial: Automatic Layout](https://www.raywenderlich.com/124696/asyncdisplaykit-2-0-tutorial-automatic-layout)__  
__[AsyncDisplayKitå®˜æ–¹æ–‡æ¡£ç¿»è¯‘](http://awhisper.github.io/2016/05/04/AsyncDisplayKit%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E7%BF%BB%E8%AF%91/)__  
__[AsyncDisplayKitæºç åˆ†æ(ä¸€)è½®å»“æ¢³ç†](http://awhisper.github.io/2016/05/06/AsyncDisplayKit%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/)__  
__[AsyncDisplayKitæºç åˆ†æ(äºŒ) å¼‚æ­¥æ¸²æŸ“](http://awhisper.github.io/2016/12/16/AysncDisplayKit%E5%88%86%E6%9E%90-%E4%BA%8C/)__  
__[ä½¿ç”¨ASDKæ€§èƒ½è°ƒä¼˜-æå‡iOSç•Œé¢çš„æ¸²æŸ“æ€§èƒ½](http://draveness.me/asdk-rendering/)__


> ä»¥ä¸Šå‡ ç¯‡åˆ†åˆ«æ¥è‡ª __[raywenderlich](https://www.raywenderlich.com/)__  
> æºç åˆ†ææ¥è‡ªäº __[æŠ˜è…¾èŒƒå„¿ã®å‘³ç²¾
> ](http://awhisper.github.io/)__ ä¸€ä¸ªç™¾åº¦é˜…è¯»å›¢é˜ŸåŒäº‹çš„åšå®¢  
> åœ¨è¿™é‡Œæˆ‘è¯´ä¸€ä¸‹æˆ‘å¯¹ASDKçš„çœ‹æ³•ï¼Œæˆ‘è§†å›¾è¯»è¿‡æºç å’Œå®˜æ–¹æ–‡æ¡£ï¼Œæˆ‘å‘ç°è¿™ä¸ªä¸æ˜¯ä½ æƒ³ç”¨æƒ³ç”¨å°±èƒ½é©¬ä¸Šç”¨çš„ä¸œè¥¿ï¼Œç®€ç›´å¯ä»¥è®©ä¸€ä¸ªåˆå­¦è€…å­¦ä¹ ä¸€é **UIKit** ä¸€æ ·é›†æˆèµ·æ¥å€’æ˜¯å¾ˆç®€å•ï¼Œä½†æ˜¯å°±é‚£æ˜¯é‚£ä¸ªå¸ƒå±€å°±è¶³å¤Ÿä¸€ä¸ªå¼€å‘äººå‘˜ç ”ç©¶ä¸€é˜µå­ï¼Œç”¨ä¸äº†masonry,ä½†æ˜¯åŠŸèƒ½å•ä¸€çš„é¡µé¢éœ€è¦è°ƒä¼˜å¯ä»¥è€ƒè™‘ä¸€ä¸‹ã€‚




swiftç›¸å…³
--
__[å–µç¥çš„ç½‘ç«™](http://swifter.tips/)__ ç›®å‰å¥½åƒåœæ­¢äº†æ›´æ–° iOSå¼€å‘é¢†åŸŸå–µç¥ çœŸæ˜¯ç¥ä¸€èˆ¬çš„å­˜åœ¨  
__[swiftéšæœºæ•°](http://southpeak.github.io/2015/09/26/ios-techset-5/)__ æ¥è‡ª__[å—å³°å­ è€é©´](http://southpeak.github.io/)__ ä¸€ä¸ªç™¾åº¦å‰åŒäº‹ç°åœ¨åœ¨äº¬ä¸œé‡‘èè²Œä¼¼ï¼Œ æœ‰è¿‡æŠ€æœ¯äº¤æµå¾ˆNBçš„ä¸€ä¸ªäºº.  
__[Swift 3å¿…çœ‹ï¼šä»ä½¿ç”¨åœºæ™¯äº†è§£GCDæ–°API](http://www.jianshu.com/p/fc78dab5736f)__ è¿™ä¸ªå“¥ä»¬æˆ‘æ²¡æœ‰äº†è§£è¿‡ ä¸è¿‡å¾ˆå¤šæ–‡ç« å†™çš„å¾ˆå¥½å¸Œæœ›ä»¥åæœ‰æœºä¼šäº¤æµä¸€ä¸‹

> æŒç»­æ›´æ–°ä¸­æ›´æ–°...


æ•°å­¦å›¾å½¢
--
__[å›¾å½¢æ•°å­¦](https://jackschaedler.github.io/)__ eg:å‚…é‡Œå¶å˜æ¢


æ¶æ„
--
__[Casaåšå®¢](http://casatwy.com/)__

> æˆ‘å¿…é¡»è¯„ä»·ä¸€ä¸‹è¿™ä¸ªCasaå“¥ä»¬,iOSæ¶æ„å¸ˆæˆ‘å”¯ä¸€ä½©æœçš„äºº,ç”¨æˆ‘çš„è¯å°±æ˜¯ï¼Œè¿™æ‰æ˜¯çœŸæ­£ç¨‹åºå‘˜å¿ƒä¸­çš„æ¶æ„å¸ˆï¼Œè€Œä¸æ˜¯å“ªäº›æ‰€è°“çš„å¬èµ·æ¥å¾ˆNBçš„æ¶æ„å¸ˆ,æˆ‘åœ¨ç™¾åº¦ä¸ªäººäº‘(ä½ ä»¬çœ‹åˆ°çš„æ˜¯ç™¾åº¦ç½‘ç›˜)å·¥ä½œæ—¶æœ‰ä¸ªT8æ¶æ„å¸ˆå°±ååœ¨æˆ‘å¯¹é¢ï¼Œé‚£ä¸ªæ¶æ„å¸ˆæ¯å¤©é—²çš„æˆ‘çœŸæƒ³æ’…ä»–ï¼Œæ”¹iOSç¨‹åº xibçš„å¼•ç”¨æ²¡å»æ‰éƒ½ä¸çŸ¥é“ æœ€å¥½å¯¼è‡´çº¿ä¸Šå´©æºƒï¼Œæˆ‘å…¶å®éå¸¸æƒ³é€ä»–ä¸€å¥è¯ï¼Œä¸ç®¡æŠ€æœ¯å¤šNB æ¯å¤©éƒ½è¦ä¿æŒå†™ä»£ç ï¼Œè®°å¾—å­”å­çš„è¯ï¼šã€å¾å°ç»ˆæ—¥è€Œæ€çŸ£ï¼Œä¸å¦‚é¡»è‡¾ä¹‹æ‰€å­¦ä¹Ÿã€ã€‚  
> è¿™ä¸ªCasaçš„å“¥ä»¬è®©æˆ‘çœ‹åˆ°äº†ä»€ä¹ˆå« æ¶æ„å·¥ç¨‹å¸ˆ å’Œä¸šåŠ¡å·¥ç¨‹å¸ˆï¼Œè¿™æ˜¯ä¸€ä¸ªèƒ½çœŸæ­£å»å†™æ¶æ„ä»£ç ç„¶åæ‰”ç»™ä¸šåŠ¡å·¥ç¨‹å¸ˆè¯´ï¼šæŒ‰ç…§è¿™ä¸ªææ³•


Masonry
--
__[](http://tutuge.me/2015/05/23/autolayout-example-with-masonry/)__  
__[æœ‰è¶£çš„Autolayoutç¤ºä¾‹-Masonryå®ç°](http://tutuge.me/2015/05/23/autolayout-example-with-masonry/)__  
__[æœ‰è¶£çš„Autolayoutç¤ºä¾‹2-Masonryå®ç°](http://tutuge.me/2015/08/08/autolayout-example-with-masonry2/)__ 
__[æœ‰è¶£çš„Autolayoutç¤ºä¾‹3-Masonryå®ç°](http://tutuge.me/2015/12/14/autolayout-example-with-masonry3/)__ 
__[æœ‰è¶£çš„Autolayoutç¤ºä¾‹4-Masonryå®ç°](http://tutuge.me/2016/08/06/autolayout-example-with-masonry4/)__  
__[æœ‰è¶£çš„Autolayoutç¤ºä¾‹5-Masonryå®ç°](http://tutuge.me/2017/03/12/autolayout-example-with-masonry5/)__  

__[iOSè‡ªåŠ¨å¸ƒå±€æ¡†æ¶-Masonryè¯¦è§£](http://www.jianshu.com/p/ea74b230c70d)__  
__[Masonry â€” ä½¿ç”¨çº¯ä»£ç è¿›è¡ŒiOSåº”ç”¨çš„autolayoutè‡ªé€‚åº”å¸ƒå±€](http://www.ios122.com/2015/09/masonry/)__ ä¸­æ–‡ç¿»è¯‘

> è¯è¯´ æˆ‘ä¸ªäººè®¤ä¸ºå­¦ä¹ masonryåªéœ€è¦çœ‹çœ‹ ä¸­æ–‡ç¿»è¯‘ä¹‹å å†å»çœ‹çœ‹åœŸåœŸå“¥çš„æ•™ç¨‹å°±ä¼šäº†ã€‚åœŸåœŸå“¥çš„masonryæ•™ç¨‹ç®€ç›´å°±æ˜¯ä¸­æ–‡æ–‡æ¡£ã€‚å†™çš„éå¸¸å¥½


Cocoapods
--

__[ç”¨CocoaPodsåšiOSç¨‹åºçš„ä¾èµ–ç®¡ç†](http://blog.devtang.com/2014/05/25/use-cocoapod-to-manage-ios-lib-dependency/)__ å·§ç¥çš„æ–‡ç« å¿…çœ‹


æ–‡ä»¶ç›¸å…³
--

__[æ–‡ä»¶åˆ—è¡¨](https://github.com/sunyazhou13/FileExplorer)__  
__[HYFileManager](https://github.com/sunyazhou13/HYFileManager)__  




åšå®¢åˆ—è¡¨
--

| åšå®¢åœ°å€                                     | RSSåœ°å€                                    |
| ---------------------------------------- | :--------------------------------------- |
| [OneV's Den](http://onevcat.com)         | <http://onevcat.com/atom.xml>            |
| [ç ´èˆ¹ä¹‹å®¶](http://beyondvincent.com)         | <http://beyondvincent.com/atom.xml>      |
| [NSHipster](http://nshipster.cn)         | <http://nshipster.cn/feed.xml>           |
| [Limboy æ— ç½‘ä¸å‰©](http://blog.leezhong.com/) | <http://feeds.feedburner.com/lzyy>       |
| [å”å·§çš„æŠ€æœ¯åšå®¢](http://blog.devtang.com)       | <http://blog.devtang.com/atom.xml>       |
| [Lex iOS notes](http://ios.lextang.com)  | <http://ios.lextang.com/rss>             |
| [å¿µèŒœçš„åšå®¢](http://nianxi.net)               | <http://nianxi.net/feed.xml>             |
| [Xcode Dev](http://blog.xcodev.com)      | <http://blog.xcodev.com/atom.xml>        |
| [Ted's Homepage](http://wufawei.com/)    | <http://wufawei.com/feed>                |
| [txx's blog](http://blog.t-xx.me)        | <http://blog.t-xx.me/atom.xml>           |
| [KEVIN BLOG](http://imkevin.me)          | <http://imkevin.me/rss>                  |
| [é˜¿æ¯›çš„è›‹ç–¼åœ°](http://www.xiangwangfeng.com)   | <http://www.xiangwangfeng.com/atom.xml>  |
| [äºšåº†çš„ Blog](http://billwang1990.github.io) | <http://billwang1990.github.io/atom.xml> |
| [Nonomori](http://nonomori.farbox.com)   | <http://nonomori.farbox.com/feed>        |
| [è¨€æ— ä¸å°½](http://tang3w.com)                | <http://tang3w.com/atom.xml>             |
| [Wonderffee's Blog](http://wonderffee.github.io) | <http://wonderffee.github.io/atom.xml>   |
| [I'm TualatriX](http://imtx.me)          | <http://imtx.me/feed/latest/>            |
| [vclwei](http://vclwei.com)              | <http://vclwei.com/posts.rss>            |
| [Cocoabit](http://blog.cocoabit.com)     | <http://blog.cocoabit.com/atom.xml>      |
| [nixzhu on scriptogr.am](http://nixzhu.me) | <http://nixzhu.me/feed>                  |
| [ä¸ä¼šå¼€æœºçš„ç”·å­©](http://studentdeng.github.io)  | <http://studentdeng.github.io/atom.xml>  |
| [Nico](http://www.taofengping.com)       | <http://www.taofengping.com/rss.xml>     |
| [é˜¿å³°çš„æŠ€æœ¯çªçª](http://hufeng825.github.io)    | <http://hufeng825.github.io/atom.xml>    |
| [answer_huang](http://answerhuang.duapp.com) | <http://answerhuang.duapp.com/index.php/feed/> |
| [webfrogs](http://webfrogs.me)           | <http://webfrogs.me/feed/>               |
| [ä»£ç æ‰‹å·¥è‰ºäºº](http://joeyio.com)              | <http://joeyio.com/atom.xml>             |
| [Lancy's Blog](http://gracelancy.com)    | <http://gracelancy.com/atom.xml>         |
| [I'm Allen](http://www.imallen.com)      | <http://www.imallen.com/atom.xml>        |
| [Travis' Blog](http://imi.im/)           | <http://imi.im/feed>                     |
| [ç‹ä¸­å‘¨çš„æŠ€æœ¯åšå®¢](http://wangzz.github.io/)     | <http://wangzz.github.io/atom.xml>       |
| [ä¼šå†™ä»£ç çš„çŒª](http://jiajun.org/)             | <http://gaosboy.com/feed/atom/>          |
| [å…‹ä¼Ÿçš„åšå®¢](http://wangkewei.cnblogs.com/)   | <http://feed.cnblogs.com/blog/u/23857/rss> |
| [æ‘‡æ»šè¯—äºº](http://cnblogs.com/biosli)        | <http://feed.cnblogs.com/blog/u/35410/rss> |
| [Luke's Homepage](http://geeklu.com/)    | <http://geeklu.com/feed/>                |
| [è§å®¸å®‡](http://iiiyu.com/)                 | <http://iiiyu.com/atom.xml>              |
| [Yuanåšå®¢](http://www.heyuan110.com/)      | <http://www.heyuan110.com/?feed=rss2>    |
| [Shining IO](http://shiningio.com/)      | <http://shiningio.com/atom.xml>          |
| [YIFEIYANG--æ˜“é£æ‰¬çš„åšå®¢](http://www.yifeiyang.net/) | <http://www.yifeiyang.net/feed>          |
| [KooFrank's Blog](http://koofrank.com/)  | <http://koofrank.com/rss>                |
| [hello it works](http://helloitworks.com) | <http://helloitworks.com/feed>           |
| [ç å†œäººç”Ÿ](http://msching.github.io/)        | <http://msching.github.io/atom.xml>      |
| [ç‰ä»¤å¤©ä¸‹çš„Blog](http://yulingtianxia.com)    | <http://yulingtianxia.com/atom.xml>      |
| [ä¸æèœ‚çªçš„ç†Š](http://www.hotobear.com/)       | <http://www.hotobear.com/?feed=rss2>     |
| [çŒ«Â·ä»æ³¢åˆ‡](https://andelf.github.io/)       | <https://andelf.github.io/atom.xml>      |
| [ç…²ä»”é¥­](http://ivoryxiong.org/)            | <http://ivoryxiong.org/feed.xml>         |
| [é‡Œè„Šä¸²çš„å¼€å‘éšç¬”](http://adad184.com)           | <http://adad184.com/atom.xml>            |
| [Chun Tips](http://chun.tips/)           | <http://chun.tips/atom.xml>              |
| [Why's blog - æ±ªæµ·çš„å®éªŒå®¤](http://blog.callmewhy.com/) | <http://blog.callmewhy.com/atom.xml>     |




URL: https://sunyazhou.com/2017/01/LearningmacOSdevelopmentShortcut/index.html.md
Published At: 2017-01-13 11:38:30 +0000

# å­¦ä¹ macOSå¼€å‘çš„è·¯çº¿

## å¼€å‘æ€»ç»“

![macOS icon](/assets/images/20170113LearningmacOSdevelopmentShortcut/CocoaProgrammingForOSX.webp)

1. å­¦ä¹ å®Œæ‰€æœ‰__[raywenderlich](https://www.raywenderlich.com/category/macos)__çš„__macOS__å¼€å‘æ•™ç¨‹
2. __[Cocoa Programming for OS X (5th Edition)](https://pan.baidu.com/s/1nuMnePj)__å¿…çœ‹(è‹±æ–‡ç‰ˆæ²¡æœ‰ä¸­æ–‡)
3. __[[Advanced.Mac.OS.X.Programming(3rd.2011)].Mark.Dalrymple.æ–‡å­—ç‰ˆ](https://pan.baidu.com/s/1i493Zpz)__å¿…çœ‹

ä»¥ä¸Šè¿™äº›å¿…é¡»çœ‹ä¸€é åŒ…æ‹¬é‚£ä¸¤æœ¬epubçš„ä¹¦ç± è™½ç„¶éƒ½æ˜¯è‹±æ–‡çš„(æˆ‘æœ¬äººè‹±è¯­åº”è¯¥ä¸ç®—å¤ªå¥½ä½†ä¹Ÿä¸å·®)çœ‹è¿™ä¸ªå¾ˆeasy


__åšå®¢__
__[è€è°­ç¬”è®°](http://www.tanhao.me/)__ è¿™ä¸ªå¤§ç‰›æ˜¯åŸæ–°æµªç½‘ç›˜macç«¯çš„æŠ€æœ¯å¼€å‘ä»–çš„æ¯ä¸€ç¯‡æ–‡ç« æˆ‘éƒ½çœ‹è¿‡å¹¶å®è·µè¿‡ï¼Œå¤§å®¶å¦‚æœå­¦ä¹ macOSå¼€å‘æˆ‘å»ºè®®å…ˆè®¤çœŸæ‰«ä¸€éä»–çš„åšå®¢
__[å–µç¥](https://onevcat.com/)__ 
__[å·§ç¥](http://blog.devtang.com/)__
è¿™äº›åšå®¢éƒ½æ˜¯æ¯ä¸ªiOS&macOSå¼€å‘å¿…çœ‹çš„
å‰©ä¸‹çš„å°±æ˜¯ä¸€å †åšå®¢äº†å¤ªå¤š æˆ‘å°±ä¸åˆ—äº† å¤§å®¶githubæœä¸€ä¸‹ 

æ¬¢è¿å¤§å®¶æå‡ºé—®é¢˜ ä¸€èµ·äº¤æµå’Œå­¦ä¹ ï¼Œæœ¬äººå¼€å‘å¹´å¤´ä¹Ÿä¸ç®—å¤ªçŸ­äº†ï¼Œä»¥å‰æä¸æ˜ç™½åšå®¢å’‹ç©çš„ï¼Œ2017å¹´å¼€å§‹å†³å®šå…ˆè®¢ä¸ªå°ç›®æ ‡ æŠŠåšå®¢æå¥½æ¬¢è¿å„ä½æ‰¹è¯„æŒ‡æ•™ï¼Œé„™äººå®šå½“å’¨è¯¹å–„é“å¯Ÿçº³é›…è¨€ï¼Œå¤šè°¢ï¼








URL: https://sunyazhou.com/2017/01/UIViewControllerCodeStandard/index.html.md
Published At: 2017-01-13 11:18:07 +0000

# UIViewControllerä»£ç è§„èŒƒ

# pragma æ ‡å‡†å†™æ³•

## Objective-C

```objc
#pragma mark -
#pragma mark - private methods ç§æœ‰æ–¹æ³•

#pragma mark -
#pragma mark - public methods å…¬æœ‰æ–¹æ³•

#pragma mark -
#pragma mark - override methods å¤å†™æ–¹æ³•

#pragma mark -
#pragma mark - getters and setters è®¾ç½®å™¨å’Œè®¿é—®å™¨

#pragma mark -
#pragma mark - UITableViewDelegate

#pragma mark -
#pragma mark - CustomDelegate è‡ªå®šä¹‰çš„ä»£ç†

#pragma mark -
#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰

#pragma mark -
#pragma mark - life cycle è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸ

#pragma mark -
#pragma mark - StatisticsLog å„ç§é¡µé¢ç»Ÿè®¡Log
```


## Swift

```swift


// MARK: -
// MARK: - override methods å¤å†™æ–¹æ³•

// MARK: -
// MARK: - getters and setters è®¾ç½®å™¨å’Œè®¿é—®å™¨

// MARK: -
// MARK: - UITableViewDelegate ä»£ç†

// MARK: -
// MARK: - CustomDelegate è‡ªå®šä¹‰çš„ä»£ç†

// MARK: -
// MARK: - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰

// MARK: -
// MARK: - private methods ç§æœ‰æ–¹æ³•

// MARK: -
// MARK: - public methods å…¬æœ‰æ–¹æ³•

// MARK: -
// MARK: - life cycle è§†å›¾çš„ç”Ÿå‘½å‘¨æœŸ

// MARK: -
// MARK: - StatisticsLog å„ç§é¡µé¢ç»Ÿè®¡Log


```

---

# UIViewControllerç”Ÿå‘½å‘¨æœŸæ–¹æ³•

åœ¨ Objective-C ä¸­ï¼Œ`UIViewController` çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ¶µç›–äº†è§†å›¾æ§åˆ¶å™¨ä»åˆ›å»ºåˆ°é”€æ¯çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯è¿™äº›æ–¹æ³•çš„å…¨é¢åˆ—è¡¨ï¼ŒåŒ…æ‹¬å®ƒä»¬è¢«è°ƒç”¨çš„æ—¶æœºå’Œä¸€äº›ç»†èŠ‚ï¼š

1. **åˆå§‹åŒ–å’ŒåŠ è½½è§†å›¾**
   - `initWithNibName:bundle:`ï¼šä½¿ç”¨ nib æ–‡ä»¶åˆå§‹åŒ–è§†å›¾æ§åˆ¶å™¨ã€‚
   - `initWithCoder:`ï¼šä½¿ç”¨ storyboard åˆå§‹åŒ–è§†å›¾æ§åˆ¶å™¨ã€‚
   - `loadView`ï¼šåŠ è½½è§†å›¾æ§åˆ¶å™¨çš„è§†å›¾ï¼Œå¦‚æœæœªè®¾ç½® `view` å±æ€§ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚
   - `viewDidLoad`ï¼šè§†å›¾åŠ è½½å®Œæˆåè°ƒç”¨ï¼Œå¸¸ç”¨äºåˆå§‹åŒ–ä»£ç ã€‚

2. **è§†å›¾å°†è¦å‡ºç°**
   - `viewWillAppear:`ï¼šè§†å›¾å°†è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šä¹‹å‰è°ƒç”¨ï¼Œå¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡Œç•Œé¢æ›´æ–°ã€‚
   - `viewWillLayoutSubviews`ï¼šåœ¨è§†å›¾çš„å¸ƒå±€å°†è¦å‘ç”Ÿä¹‹å‰è°ƒç”¨ï¼Œå¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡Œå­è§†å›¾çš„å¸ƒå±€ã€‚
   - `viewDidLayoutSubviews`ï¼šåœ¨è§†å›¾çš„å¸ƒå±€å·²ç»å®Œæˆåè°ƒç”¨ã€‚

3. **è§†å›¾å·²ç»å‡ºç°**
   - `viewDidAppear:`ï¼šè§†å›¾å·²ç»æ˜¾ç¤ºåœ¨å±å¹•ä¸Šåè°ƒç”¨ï¼Œå¯ä»¥åœ¨æ­¤æ–¹æ³•ä¸­è¿›è¡Œç•Œé¢æ›´æ–°ã€‚
   - `viewDidDisappear:`ï¼šè§†å›¾ä»å±å¹•ä¸Šæ¶ˆå¤±åè°ƒç”¨ã€‚

4. **å†…å­˜è­¦å‘Š**
   - `didReceiveMemoryWarning`ï¼šå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶è°ƒç”¨ï¼Œè§†å›¾æ§åˆ¶å™¨å¯ä»¥é‡Šæ”¾ä¸€äº›èµ„æºã€‚

5. **æ—‹è½¬å’Œå¤§å°å˜åŒ–**
   - `willRotateToInterfaceOrientation:duration:`ï¼šè®¾å¤‡å°†è¦æ—‹è½¬åˆ°æŒ‡å®šæ–¹å‘ä¹‹å‰è°ƒç”¨ï¼ˆiOS 6 åŠä¹‹å‰ç‰ˆæœ¬ï¼‰ã€‚
   - `willAnimateRotationToInterfaceOrientation:duration:`ï¼šè®¾å¤‡å°†è¦æ—‹è½¬åˆ°æŒ‡å®šæ–¹å‘æ—¶è°ƒç”¨ï¼Œå¯ä»¥è¿›è¡ŒåŠ¨ç”»ï¼ˆiOS 6 åŠä¹‹å‰ç‰ˆæœ¬ï¼‰ã€‚
   - `didRotateFromInterfaceOrientation:`ï¼šè®¾å¤‡ä»æŒ‡å®šæ–¹å‘æ—‹è½¬å®Œæˆåè°ƒç”¨ï¼ˆiOS 6 åŠä¹‹å‰ç‰ˆæœ¬ï¼‰ã€‚
   - `viewWillTransitionToSize:withTransitionCoordinator:`ï¼šè®¾å¤‡å°†è¦æ—‹è½¬æˆ–è§†å›¾æ§åˆ¶å™¨çš„å°ºå¯¸å°†è¦å˜åŒ–æ—¶è°ƒç”¨ï¼ˆiOS 8 åŠä»¥åç‰ˆæœ¬ï¼‰ã€‚
   - `viewDidTransitionFromSize:withTransitioningCoordinator:`ï¼šè®¾å¤‡æ—‹è½¬å®Œæˆæˆ–è§†å›¾æ§åˆ¶å™¨å°ºå¯¸å˜åŒ–å®Œæˆåè°ƒç”¨ï¼ˆiOS 8 åŠä»¥åç‰ˆæœ¬ï¼‰ã€‚

6. **äº¤äº’**
   - `shouldAutorotate`ï¼šè¯¢é—®è§†å›¾æ§åˆ¶å™¨æ˜¯å¦æ”¯æŒè‡ªåŠ¨æ—‹è½¬ï¼ˆiOS 6 åŠä¹‹å‰ç‰ˆæœ¬ï¼‰ã€‚
   - `supportedInterfaceOrientations`ï¼šè¿”å›è§†å›¾æ§åˆ¶å™¨æ”¯æŒçš„ç•Œé¢æ–¹å‘ã€‚
   - `preferredInterfaceOrientationForPresentation`ï¼šè¿”å›è§†å›¾æ§åˆ¶å™¨çš„é¦–é€‰æ˜¾ç¤ºæ–¹å‘ã€‚

7. **äº¤äº’æ¶ˆå¤±**
   - `viewWillDisappear:`ï¼šè§†å›¾å°†è¦æ¶ˆå¤±æ—¶è°ƒç”¨ã€‚
   - `viewWillUnload`ï¼šè§†å›¾å°†è¦è¢«é”€æ¯æ—¶è°ƒç”¨ï¼ŒiOS 6 ä»¥åç‰ˆæœ¬ä¸­ä¸å†æ¨èä½¿ç”¨ã€‚

8. **ç»ˆæ­¢**
   - `dealloc`ï¼šè§†å›¾æ§åˆ¶å™¨è¢«é”€æ¯æ—¶è°ƒç”¨ã€‚

è¯·æ³¨æ„ï¼Œä» iOS 6 å¼€å§‹ï¼Œè‹¹æœæ¨èä½¿ç”¨è‡ªåŠ¨æ—‹è½¬æ”¯æŒæ–¹æ³•ï¼ˆ`shouldAutorotate`ã€`supportedInterfaceOrientations` å’Œ `preferredInterfaceOrientationForPresentation`ï¼‰æ¥å¤„ç†è®¾å¤‡æ–¹å‘å˜åŒ–ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ `willRotateToInterfaceOrientation:duration:` ç­‰æ–¹æ³•ã€‚æ­¤å¤–ï¼Œ`viewWillUnload` æ–¹æ³•åœ¨ iOS 6 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ä¸å†è¢«è°ƒç”¨ï¼Œè‹¹æœæ¨èä½¿ç”¨ `viewDidDisappear:` æ¥æ›¿ä»£ã€‚

è¿™äº›æ–¹æ³•ä¸ºè§†å›¾æ§åˆ¶å™¨çš„ç”Ÿå‘½å‘¨æœŸæä¾›äº†ä¸°å¯Œçš„æ§åˆ¶ç‚¹ï¼Œå…è®¸å¼€å‘è€…åœ¨é€‚å½“çš„æ—¶æœºè¿›è¡Œèµ„æºç®¡ç†ã€ç•Œé¢æ›´æ–°å’ŒçŠ¶æ€ä¿å­˜ã€‚

### UIViewControllerçš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹:

ä»¥ä¸‹æ˜¯ä¸€äº›ç¤ºä¾‹ä»£ç ï¼Œå±•ç¤ºäº†åœ¨ Objective-C ä¸­å¦‚ä½•å®ç° `UIViewController` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼š

```objc
// ViewController.h
#import <UIKit/UIKit.h>

@interface ViewController : UIViewController

@end

// ViewController.m
#import "ViewController.h"

@implementation ViewController

// åˆå§‹åŒ–å’ŒåŠ è½½è§†å›¾
- (instancetype)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (instancetype)initWithCoder:(NSCoder *)aDecoder {
    self = [super initWithCoder:aDecoder];
    if (self) {
        // Custom initialization
    }
    return self;
}

- (void)loadView {
    [super loadView];
    // Create your custom view here if not using a nib or storyboard
}

- (void)viewDidLoad {
    [super viewDidLoad];
    // Perform additional setup after loading the view, typically from a nib.
}

// è§†å›¾å°†è¦å‡ºç°
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    // Prepare your view for display
}

- (void)viewWillLayoutSubviews {
    [super viewWillLayoutSubviews];
    // Layout your subviews here
}

- (void)viewDidLayoutSubviews {
    [super viewDidLayoutSubviews];
    // Perform any additional layout here
}

// è§†å›¾å·²ç»å‡ºç°
- (void)viewDidAppear:(BOOL)animated {
    [super viewDidAppear:animated];
    // Update your UI here
}

- (void)viewWillDisappear:(BOOL)animated {
    [super viewWillDisappear:animated];
    // Prepare your view for disappearance
}

- (void)viewDidDisappear:(BOOL)animated {
    [super viewDidDisappear:animated];
    // Clean up after your view disappears
}

// å†…å­˜è­¦å‘Š
- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Release any cached data, images, etc. that aren't in use
}

// æ—‹è½¬å’Œå¤§å°å˜åŒ–
- (BOOL)shouldAutorotate {
    return YES;
}

- (NSUInteger)supportedInterfaceOrientations {
    return UIInterfaceOrientationMaskAll;
}

- (UIInterfaceOrientation)preferredInterfaceOrientationForPresentation {
    return UIInterfaceOrientationPortrait;
}

- (void)viewWillTransitionToSize:(CGSize)size withTransitionCoordinator:(id<UIViewControllerTransitionCoordinator>)coordinator {
    [super viewWillTransitionToSize:size withTransitionCoordinator:coordinator];
    // Handle the transition to a different size
}

- (void)viewDidTransitionFromSize:(CGSize)fromSize withTransitioningCoordinator:(id<UIViewControllerTransitionCoordinator>)coordinator {
    [super viewDidTransitionFromSize:fromSize withTransitioningCoordinator:coordinator];
    // Handle the transition completion
}

@end
```

è¿™æ®µä»£ç å±•ç¤ºäº† `UIViewController` ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çš„åŸºæœ¬å®ç°ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚åœ¨è¿™äº›æ–¹æ³•ä¸­æ·»åŠ ç›¸åº”çš„é€»è¾‘ã€‚ä¾‹å¦‚ï¼Œåœ¨ `viewDidLoad` ä¸­åˆå§‹åŒ–è§†å›¾ï¼Œåœ¨ `viewWillAppear:` ä¸­æ›´æ–° UIï¼Œåœ¨ `viewWillDisappear:` ä¸­ä¿å­˜çŠ¶æ€ç­‰ã€‚


