<!DOCTYPE html><html lang="zh-Hans" ><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Learning AV Foundation(ä¸‰)AVAudioRecorder" /><meta name="author" content="å­™äºšæ´²" /><meta property="og:locale" content="zh_Hans" /><meta name="description" content="å—¨,æˆ‘æ˜¯å­™äºšæ´²(@sunyazhou13),ä¸€åæ¥è‡ªç¥–å›½åŒ—å›½å†°åŸçš„iOSå¼€å‘è€…." /><meta property="og:description" content="å—¨,æˆ‘æ˜¯å­™äºšæ´²(@sunyazhou13),ä¸€åæ¥è‡ªç¥–å›½åŒ—å›½å†°åŸçš„iOSå¼€å‘è€…." /><link rel="canonical" href="https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" /><meta property="og:url" content="https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" /><meta property="og:site_name" content="è¿ˆè…¾å¤§é˜Ÿé•¿" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2017-03-28T09:40:18+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning AV Foundation(ä¸‰)AVAudioRecorder" /><meta name="twitter:site" content="@sunyazhou" /><meta name="twitter:creator" content="@å­™äºšæ´²" /><meta name="google-site-verification" content="Xo29j227HYVdC-vDA_-qJwvDP3PIo-lC78CFeBvhrDA" /> <script type="application/ld+json"> {"datePublished":"2017-03-28T09:40:18+00:00","@type":"BlogPosting","dateModified":"2017-03-28T09:40:18+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/"},"author":{"@type":"Person","name":"å­™äºšæ´²"},"url":"https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/","description":"å—¨,æˆ‘æ˜¯å­™äºšæ´²(@sunyazhou13),ä¸€åæ¥è‡ªç¥–å›½åŒ—å›½å†°åŸçš„iOSå¼€å‘è€….","headline":"Learning AV Foundation(ä¸‰)AVAudioRecorder","@context":"https://schema.org"}</script><title>Learning AV Foundation(ä¸‰)AVAudioRecorder | è¿ˆè…¾å¤§é˜Ÿé•¿</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/images/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">è¿ˆè…¾å¤§é˜Ÿé•¿</a></div><div class="site-subtitle font-italic">ä¸æ–·å­¸ç¿’,èˆ‡æ™‚ä¿±é€².æ±‚çœŸå‹™å¯¦,å¯¦äº‹æ±‚æ˜¯.</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3"></i> <span>ä¸»é¡µ</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3"></i> <span>å½’æ¡£</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3"></i> <span>åˆ†ç±»</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3"></i> <span>æ ‡ç­¾</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/projects/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-paint-brush ml-xl-3 mr-xl-3"></i> <span>ä½œå“</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3"></i> <span>å…³äº</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } get isResolvedDarkMode() { if (this.isLightMode) { return false; } return this.isSysDarkPrefer; } updateCommentStyle() { var theme = "github-light"; if (this.isResolvedDarkMode) { theme = "photon-dark"; } let comment = document.querySelector("iframe.utterances-frame"); if (comment == null) { return; } comment.contentWindow.postMessage( { type: "set-theme", theme: theme }, "https://utteranc.es/" ); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateCommentStyle(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/sunyazhou13" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/sunyazhou" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.weibo.com/sunyazhou13" aria-label="" target="_blank" rel="noopener"> <i class="fab fa-weibo"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sunyazhou','111.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> ä¸»é¡µ </a> </span> <span>Learning AV Foundation(ä¸‰)AVAudioRecorder</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="æœç´¢..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Learning AV Foundation(ä¸‰)AVAudioRecorder</h1><div class="post-meta text-muted d-flex flex-column"><div> ã€€ç”± <span class="author"> å­™äºšæ´² </span> å‘å¸ƒäº <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Tue, Mar 28, 2017, 9:40 AM +0000" > 2017-03-28 <i class="unloaded">2017-03-28T09:40:18+00:00</i> </span></div><div> æœ€åæ›´æ–°: <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Apr 2, 2023, 4:42 PM +0800" > 2023-04-02 <i class="unloaded">2023-04-02T08:42:51+00:00</i> </span></div></div><div class="post-content"><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/cover.webp" alt="" /></p><h2 id="å‰è¨€">å‰è¨€</h2><p>åœ¨<code class="language-plaintext highlighter-rouge">AV Foundation</code>ä¸­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>ç±»æ·»åŠ éŸ³é¢‘å½•åˆ¶åŠŸèƒ½å’Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>ä¸€æ ·ç®€å•, éƒ½æ˜¯åœ¨<code class="language-plaintext highlighter-rouge">Audio Queue Server</code>ä¸Šå±‚æ„å»ºçš„.åŒæ—¶æ”¯æŒ<code class="language-plaintext highlighter-rouge">macOS</code>å’Œ<code class="language-plaintext highlighter-rouge">iOS</code>å¹³å°.å¯ä»¥ä»å†…ç½®éº¦å…‹é£å½•åˆ¶éŸ³é¢‘,ä¹Ÿå¯ä»¥æ”¯æŒæ•°å­—éŸ³é¢‘æ¥å£æˆ–USBå¤–æ¥éº¦å…‹é£å½•åˆ¶.</p><h2 id="ä¸»è¦å†…å®¹å¦‚ä¸‹">ä¸»è¦å†…å®¹å¦‚ä¸‹:</h2><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>å¦‚ä½•åˆ›å»ºAVAudioRecorder  
    1. éŸ³é¢‘æ ¼å¼
    2. é‡‡æ ·ç‡
    3. é€šé“æ•°
åˆ›å»ºDemo
    1. é…ç½®éŸ³é¢‘ä¼šè¯
    2. å®ç°å½•éŸ³åŠŸèƒ½
    3. ä½¿ç”¨Audio Meteringå®ç°å£°æ³¢è§†è§‰æ˜¾ç¤º
</pre></table></code></div></div><p>åˆ›å»º<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>ä¹‹å‰å…ˆäº†è§£ä¸€ä¸‹å®ƒçš„æ–¹æ³•å’Œæˆå‘˜å˜é‡</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">,</span> <span class="n">getter</span><span class="o">=</span><span class="n">isRecording</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">recording</span><span class="p">;</span><span class="c1">//æ˜¯å¦æ­£åœ¨å½•éŸ³</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSDictionary</span><span class="o">&lt;</span><span class="n">NSString</span> <span class="o">*</span><span class="p">,</span> <span class="n">id</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">settings</span><span class="p">;</span><span class="c1">//å½•éŸ³é…ç½®ï¼šé‡‡æ ·ç‡ã€éŸ³é¢‘æ ¼å¼ã€é€šé“æ•°...</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span><span class="p">;</span><span class="c1">//å½•éŸ³æ–‡ä»¶å­˜æ”¾URL</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">readonly</span><span class="p">)</span> <span class="n">NSTimeInterval</span> <span class="n">currentTime</span><span class="p">;</span><span class="c1">//å½•éŸ³æ—¶é•¿</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">getter</span><span class="o">=</span><span class="n">isMeteringEnabled</span><span class="p">)</span> <span class="n">BOOL</span> <span class="n">meteringEnabled</span><span class="p">;</span><span class="c1">//æ˜¯å¦ç›‘æ§å£°æ³¢</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>çš„å®ä¾‹æ–¹æ³•:</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">prepareToRecord</span><span class="p">;</span><span class="c1">//ä¸ºå½•éŸ³å‡†å¤‡ç¼“å†²åŒº</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">record</span><span class="p">;</span><span class="c1">//å½•éŸ³å¼€å§‹ï¼Œæš‚åœåè°ƒç”¨ä¼šæ¢å¤å½•éŸ³</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">recordAtTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span><span class="p">;</span><span class="c1">//åœ¨æŒ‡å®šæ—¶é—´åå¼€å§‹å½•éŸ³</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">recordForDuration</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span> <span class="n">duration</span><span class="p">;</span><span class="c1">//æŒ‰æŒ‡å®šæ—¶é•¿å½•éŸ³</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">recordAtTime</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">time</span> 
         <span class="nf">forDuration</span><span class="p">:(</span><span class="n">NSTimeInterval</span><span class="p">)</span><span class="nv">duration</span><span class="p">;</span><span class="c1">//ä¸Šé¢2ä¸ªçš„åˆä½“</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pause</span><span class="p">;</span> <span class="c1">//æš‚åœå½•éŸ³</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stop</span><span class="p">;</span> <span class="c1">//åœæ­¢å½•éŸ³</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">deleteRecording</span><span class="p">;</span><span class="c1">//åˆ é™¤å½•éŸ³ï¼Œå¿…é¡»å…ˆåœæ­¢å½•éŸ³å†åˆ é™¤</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>çš„ä»£ç†æ–¹æ³•:</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="c1">//å½•éŸ³å®Œæˆåè°ƒç”¨</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">audioRecorderDidFinishRecording</span><span class="p">:(</span><span class="n">AVAudioRecorder</span> <span class="o">*</span><span class="p">)</span><span class="nv">recorder</span> 
                           <span class="nf">successfully</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">flag</span><span class="p">;</span>
<span class="c1">//å½•éŸ³ç¼–ç å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">audioRecorderEncodeErrorDidOccur</span><span class="p">:(</span><span class="n">AVAudioRecorder</span> <span class="o">*</span><span class="p">)</span><span class="nv">recorder</span> 
                                   <span class="nf">error</span><span class="p">:(</span><span class="n">NSError</span> <span class="o">*</span><span class="p">)</span><span class="nv">error</span><span class="p">;</span>
</pre></table></code></div></div><h2 id="å¦‚ä½•åˆ›å»ºavaudiorecorder">å¦‚ä½•åˆ›å»º<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code></h2><p>åˆ›å»º<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>å¯¹è±¡æ‰€éœ€è¦çš„å‚æ•°å¦‚ä¸‹:</p><ul><li>éŸ³é¢‘æµå½•åˆ¶æ—¶å†™å…¥åˆ°æœ¬åœ°çš„è·¯å¾„URL<li><code class="language-plaintext highlighter-rouge">settings</code>å½•éŸ³é…ç½®ï¼šé‡‡æ ·ç‡ã€éŸ³é¢‘æ ¼å¼ã€é€šé“æ•°â€¦ç­‰é”®å€¼å‚æ•°å­—å…¸<li>å‘ç”Ÿé”™è¯¯çš„<code class="language-plaintext highlighter-rouge">NSError</code>æŒ‡é’ˆ</ul><p>å¦‚ä¸‹ä»£ç :</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cm">/**
 åˆ›å»ºå½•éŸ³å™¨
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">createRecorder</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">directory</span> <span class="o">=</span> <span class="n">NSTemporaryDirectory</span><span class="p">();</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">directory</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"voice1.m4a"</span><span class="p">];</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">fileURLWithPath</span><span class="p">:</span><span class="n">filePath</span><span class="p">];</span>
    
    <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">setting</span> <span class="o">=</span> <span class="p">@{</span><span class="n">AVFormatIDKey</span> <span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">kAudioFormatMPEG4AAC</span><span class="p">),</span>
                              <span class="nl">AVSampleRateKey:</span> <span class="mf">@22050.0f</span><span class="p">,</span>
                              <span class="nl">AVNumberOfChannelsKey:</span> <span class="mi">@1</span><span class="p">};</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioRecorder</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithURL</span><span class="p">:</span><span class="n">url</span>
                                                <span class="nl">settings:</span><span class="n">setting</span>
                                                   <span class="nl">error:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">prepareToRecord</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Recorder Create Error: %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>è¿™é‡Œçš„å»ºè®®è°ƒç”¨<code class="language-plaintext highlighter-rouge">[self.recorder prepareToRecord]</code>æ–¹æ³•å¯¹å½•éŸ³å®ä¾‹è¿›è¡Œé¢„è®¾å°±åƒ<a href="http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/">ä¸Šä¸€ç« </a>åˆ›å»º<code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>ç±»ä¼¼.éƒ½æ˜¯ä¸ºäº†æ‰§è¡Œåº•å±‚<code class="language-plaintext highlighter-rouge">Audio Queue</code>åˆå§‹åŒ–çš„å¿…è¦è¿‡ç¨‹.è¿™ä¸ª<code class="language-plaintext highlighter-rouge">prepareToRecord</code>æ–¹æ³•è¿˜åœ¨ç»™å®šçš„URLå‚æ•°æŒ‡å®šçš„ä½ç½®åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™æ ·å°±å‡å°‘äº†å½•åˆ¶å¯åŠ¨æ—¶çš„å»¶æ—¶</p><h2 id="éŸ³é¢‘æ ¼å¼">éŸ³é¢‘æ ¼å¼</h2><p><code class="language-plaintext highlighter-rouge">AVFormatIDKey</code>keyæŒ‡å®šå½•åˆ¶æ ¼å¼,è¿™é‡Œçš„é™¤äº†<code class="language-plaintext highlighter-rouge">kAudioFormatMPEG4AAC</code>æ ¼å¼è¿˜æœ‰ä¸‹é¢è¿™äº›:</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="n">CF_ENUM</span><span class="p">(</span><span class="n">AudioFormatID</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">kAudioFormatLinearPCM</span>               <span class="o">=</span> <span class="err">'</span><span class="n">lpcm</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAC3</span>                     <span class="o">=</span> <span class="err">'</span><span class="n">ac</span><span class="o">-</span><span class="mi">3</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormat60958AC3</span>                <span class="o">=</span> <span class="err">'</span><span class="n">cac3</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAppleIMA4</span>               <span class="o">=</span> <span class="err">'</span><span class="n">ima4</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC</span>                <span class="o">=</span> <span class="err">'</span><span class="n">aac</span> <span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4CELP</span>               <span class="o">=</span> <span class="err">'</span><span class="n">celp</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4HVXC</span>               <span class="o">=</span> <span class="err">'</span><span class="n">hvxc</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4TwinVQ</span>             <span class="o">=</span> <span class="err">'</span><span class="n">twvq</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMACE3</span>                   <span class="o">=</span> <span class="err">'</span><span class="n">MAC3</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMACE6</span>                   <span class="o">=</span> <span class="err">'</span><span class="n">MAC6</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatULaw</span>                    <span class="o">=</span> <span class="err">'</span><span class="n">ulaw</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatALaw</span>                    <span class="o">=</span> <span class="err">'</span><span class="n">alaw</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatQDesign</span>                 <span class="o">=</span> <span class="err">'</span><span class="n">QDMC</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatQDesign2</span>                <span class="o">=</span> <span class="err">'</span><span class="n">QDM2</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatQUALCOMM</span>                <span class="o">=</span> <span class="err">'</span><span class="n">Qclp</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEGLayer1</span>              <span class="o">=</span> <span class="err">'</span><span class="p">.</span><span class="n">mp1</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEGLayer2</span>              <span class="o">=</span> <span class="err">'</span><span class="p">.</span><span class="n">mp2</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEGLayer3</span>              <span class="o">=</span> <span class="err">'</span><span class="p">.</span><span class="n">mp3</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatTimeCode</span>                <span class="o">=</span> <span class="err">'</span><span class="n">time</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMIDIStream</span>              <span class="o">=</span> <span class="err">'</span><span class="n">midi</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatParameterValueStream</span>    <span class="o">=</span> <span class="err">'</span><span class="n">apvs</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAppleLossless</span>           <span class="o">=</span> <span class="err">'</span><span class="n">alac</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_HE</span>             <span class="o">=</span> <span class="err">'</span><span class="n">aach</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_LD</span>             <span class="o">=</span> <span class="err">'</span><span class="n">aacl</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_ELD</span>            <span class="o">=</span> <span class="err">'</span><span class="n">aace</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_ELD_SBR</span>        <span class="o">=</span> <span class="err">'</span><span class="n">aacf</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_ELD_V2</span>         <span class="o">=</span> <span class="err">'</span><span class="n">aacg</span><span class="err">'</span><span class="p">,</span>    
    <span class="n">kAudioFormatMPEG4AAC_HE_V2</span>          <span class="o">=</span> <span class="err">'</span><span class="n">aacp</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatMPEG4AAC_Spatial</span>        <span class="o">=</span> <span class="err">'</span><span class="n">aacs</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAMR</span>                     <span class="o">=</span> <span class="err">'</span><span class="n">samr</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAMR_WB</span>                  <span class="o">=</span> <span class="err">'</span><span class="n">sawb</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatAudible</span>                 <span class="o">=</span> <span class="err">'</span><span class="n">AUDB</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatiLBC</span>                    <span class="o">=</span> <span class="err">'</span><span class="n">ilbc</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatDVIIntelIMA</span>             <span class="o">=</span> <span class="mh">0x6D730011</span><span class="p">,</span>
    <span class="n">kAudioFormatMicrosoftGSM</span>            <span class="o">=</span> <span class="mh">0x6D730031</span><span class="p">,</span>
    <span class="n">kAudioFormatAES3</span>                    <span class="o">=</span> <span class="err">'</span><span class="n">aes3</span><span class="err">'</span><span class="p">,</span>
    <span class="n">kAudioFormatEnhancedAC3</span>             <span class="o">=</span> <span class="err">'</span><span class="n">ec</span><span class="o">-</span><span class="mi">3</span><span class="err">'</span>
<span class="p">};</span>

</pre></table></code></div></div><p>è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">kAudioFormatLinearPCM</code>ä¼šå°†ä¸ºå‹ç¼©çš„éŸ³é¢‘æµå†™å…¥åˆ°æ–‡ä»¶ä¸­,è¿™å°±æ˜¯åŸå§‹æ•°æ®,ä¿çœŸåº¦æœ€é«˜,å½“ç„¶æ–‡ä»¶ä¹Ÿæœ€å¤§, é€‰æ‹©ACC<code class="language-plaintext highlighter-rouge">kAudioFormatMPEG4AAC</code>æˆ–è€…AppleIMA4<code class="language-plaintext highlighter-rouge">kAudioFormatAppleLossless</code>ç­‰æ ¼å¼ä¼šæ˜¾è‘—ç¼©å°æ–‡ä»¶ï¼Œè¿˜èƒ½ä¿è¯éŸ³é¢‘è´¨é‡.</p><blockquote><p><em>æ³¨æ„:</em> <em>æŒ‡å®šçš„éŸ³é¢‘æ ¼å¼ä¸€å®šè¦å’Œæ–‡ä»¶å†™å…¥çš„URLæ–‡ä»¶ç±»å‹ä¿æŒä¸€è‡´ã€‚å¦‚æœå½•åˆ¶xxx.wavæ–‡ä»¶æ ¼å¼ æ˜¯ Waveform Audio File Format(WAVE)çš„æ ¼å¼è¦æ±‚,å³ ä½å­—èŠ‚åºã€ LinePCMã€‚ å¦‚æœ<code class="language-plaintext highlighter-rouge">AVFormatIDKey</code>æŒ‡å®šçš„å€¼ä¸æ˜¯<code class="language-plaintext highlighter-rouge">kAudioFormatLinearPCM</code>åˆ™ä¼šå‘ç”Ÿé”™è¯¯ã€‚NSError ä¼šè¿”å›å¦‚ä¸‹é”™è¯¯</em> <em>The operation couldnâ€™t be completed. (OSState error 1718449215.)</em></p></blockquote><h2 id="é‡‡æ ·ç‡">é‡‡æ ·ç‡</h2><p>ä¸Šè¾¹çš„ä»£ç é‡Œ<code class="language-plaintext highlighter-rouge">AVSampleRateKey</code>ç”¨äºå®šä¹‰å½•éŸ³å™¨çš„é‡‡æ ·ç‡. <strong>é‡‡æ ·ç‡å®šä¹‰äº†å¯¹è¾“å…¥çš„æ¨¡æ‹ŸéŸ³é¢‘ä¿¡å·æ¯ä¸€ç§’å†…çš„é‡‡æ ·æ•°</strong>. å¦‚æœä½¿ç”¨<strong>ä½é‡‡æ ·ç‡</strong> æ¯”å¦‚8kHz,ä¼šå¯¼è‡´ç²—ç²’åº¦ã€AMå¹¿æ’­ç±»å‹çš„å½•åˆ¶æ•ˆæœ, ä¸è¿‡æ–‡ä»¶ä¼šæ¯”è¾ƒå°; ä½¿ç”¨<strong>44.1kHzçš„é‡‡æ ·ç‡(CDè´¨é‡çš„é‡‡æ ·ç‡)</strong>ä¼šå¾—åˆ°éå¸¸é«˜è´¨é‡çš„å†…å®¹, ä¸è¿‡æ–‡ä»¶æ¯”è¾ƒå¤§. è‡³äºä½¿ç”¨ä»€ä¹ˆæ ·çš„é‡‡æ ·ç‡æ²¡æœ‰æ˜ç¡®çš„å®šä¹‰. ä¸è¿‡å¼€å‘è€…åº”è¯¥å°½é‡ä½¿ç”¨<strong>æ ‡å‡†çš„é‡‡æ ·ç‡ï¼Œæ¯”å¦‚: 8000Hzã€16 000Hz(16kHz)ã€22050Hz(22.05kHz)æˆ– 44100Hz(44.1kHz)ã€å½“ç„¶è¿˜æœ‰48000Hzå’Œ96000Hz</strong> ,(kHzä»£è¡¨åƒèµ«),è¶…è¿‡48000æˆ–96000çš„é‡‡æ ·å¯¹äººè€³å·²ç»æ²¡æœ‰æ„ä¹‰.æœ€ç»ˆæ˜¯æˆ‘ä»¬çš„è€³æœµåœ¨è¿›è¡Œåˆ¤æ–­.ï¼ˆ<a href="http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/">ä¸Šä¸€ç« </a>è¯´äº† <strong>äººè€³æ‰€èƒ½å¬åˆ°çš„å£°éŸ³ï¼Œæœ€ä½çš„é¢‘ç‡æ˜¯ä»20Hzèµ·ä¸€ç›´åˆ°æœ€é«˜é¢‘ç‡20kHz</strong>,å½•éŸ³æœ€å¥½é‡‡ç”¨ x 2 å€çš„é¢‘ç‡ï¼‰</p><h2 id="é€šé“æ•°">é€šé“æ•°</h2><p><code class="language-plaintext highlighter-rouge">AVNumberOfChannelsKey</code>ç”¨äºå®šä¹‰è®°å½•éŸ³é¢‘å†…å®¹çš„é€šé“æ•°ã€‚<strong>æŒ‡å®šé»˜è®¤å€¼1 æ„å‘³ç€ä½¿ç”¨å•å£°é“å½•åˆ¶</strong>ã€<strong>è®¾ç½®2æ„å‘³ç€ä½¿ç”¨ç«‹ä½“å£°å½•åˆ¶</strong>ã€‚é™¤éä½¿ç”¨å¤–éƒ¨ç¡¬ä»¶è¿›è¡Œå½•åˆ¶ï¼Œå¦åˆ™åŒçª—åº”è¯¥åˆ›å»ºå•å£°é“å½•éŸ³ã€‚ è¿™é‡Œçš„é€šé“æ•°æ˜¯æŒ‡ å½•åˆ¶è®¾å¤‡çš„è¾“å…¥æ•°é‡ å¯ä»¥ç†è§£ä¸º éº¦å…‹é£ å†…ç½® æˆ–è€…å¤–æ¥éº¦å…‹é£å½•åˆ¶æ¯”å¦‚ æ’å…¥Appleè€³æœº é‡Œé¢çš„éº¦å…‹é£ã€‚</p><blockquote><p>ä»¥ä¸Šæ˜¯å…¨é¢<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>çš„éƒ¨åˆ†æ¦‚å¿µ,<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>æ”¯æŒ<strong>æ— é™æ—¶é•¿å½•åˆ¶</strong>,è¿˜å¯ä»¥è®¾ç½®ä»<strong>æœªæ¥æŸä¸€æ—¶é—´ç‚¹å¼€å§‹å½•åˆ¶</strong>æˆ–<strong>æŒ‡å®šæ—¶é•¿å½•åˆ¶</strong></p></blockquote><h2 id="ç½‘ç»œæµåª’ä½“å¤„ç†">ç½‘ç»œæµåª’ä½“å¤„ç†</h2><p><code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>éŸ³é¢‘æ’­æ”¾å™¨åªèƒ½æ’­æ”¾æœ¬åœ°æ–‡ä»¶ï¼Œå¹¶ä¸”æ˜¯ä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„éŸ³é¢‘æ•°æ®ï¼Œä½†æˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦è¾¹ä¸‹è½½è¾¹å¬æ€ä¹ˆåŠï¼Ÿ <code class="language-plaintext highlighter-rouge">AVAudioPlayer</code>æ˜¯ä¸æ”¯æŒè¿™ç§ç½‘ç»œæµåª’ä½“å½¢å¼çš„éŸ³é¢‘æ’­æ”¾ï¼Œè¦æ’­æ”¾è¿™ç§ç½‘ç»œæµåª’ä½“ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">AudioToolbox</code>æ¡†æ¶çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡<code class="language-plaintext highlighter-rouge">Audio Queue Services</code>ã€‚</p><p><strong>éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡åˆ†ä¸º3ä¸ªéƒ¨åˆ†:</strong></p><blockquote><ul><li>3ä¸ªç¼“å†²å™¨<li>1ä¸ªç¼“å†²é˜Ÿåˆ—<li>1ä¸ªå›è°ƒ</ul></blockquote><p><strong>1. ä¸‹é¢æ˜¯å½•éŸ³çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡çš„å·¥ä½œåŸç†:</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/QueueServiceRecord.webp" alt="" /></p><p><strong>2. ä¸‹é¢æ˜¯æ’­æ”¾éŸ³é¢‘çš„éŸ³é¢‘é˜Ÿåˆ—æœåŠ¡çš„å·¥ä½œåŸç†;</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/QueueServicePlay.webp" alt="" /></p><p>å½“ç„¶å¤„ç†è¿™äº›ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»å†™Cè¯­è¨€å‡½æ•°å®ç° æœ‰ä¸ªå¼€æºåº“<a href="https://github.com/sunyazhou13/FreeStreamer">FreeStreamer</a></p><p>FreeStreamerä½¿ç”¨</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="cp">#import &lt;FreeStreamer/FreeStreamer.h&gt;
</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">initAudioStream</span><span class="p">];</span>
    <span class="c1">//æ’­æ”¾ç½‘ç»œæµåª’ä½“éŸ³é¢‘</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">audioStream</span> <span class="nf">play</span><span class="p">];</span>
<span class="p">}</span>
<span class="cm">/* åˆå§‹åŒ–ç½‘ç»œæµåª’ä½“å¯¹è±¡ */</span>
<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">initAudioStream</span><span class="p">{</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">urlStr</span> <span class="o">=</span> <span class="s">@"http://sc1.111ttt.com/2016/1/02/24/195242042236.mp3"</span><span class="p">;</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">URLWithString</span><span class="p">:</span><span class="n">urlStr</span><span class="p">];</span>
    <span class="c1">//åˆ›å»ºFSAudioStreamå¯¹è±¡</span>
    <span class="n">self</span><span class="p">.</span><span class="n">audioStream</span> <span class="o">=</span> <span class="p">[[</span><span class="n">FSAudioStream</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithUrl</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
    <span class="c1">//è®¾ç½®æ’­æ”¾é”™è¯¯å›è°ƒBlock</span>
    <span class="n">self</span><span class="p">.</span><span class="n">audioStream</span><span class="p">.</span><span class="n">onFailure</span> <span class="o">=</span> <span class="o">^</span><span class="p">(</span><span class="n">FSAudioStreamError</span> <span class="n">error</span><span class="p">,</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">description</span><span class="p">){</span>
          <span class="n">NSLog</span><span class="p">(</span><span class="s">@"æ’­æ”¾è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯ï¼š%@"</span><span class="p">,</span><span class="n">description</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="c1">//è®¾ç½®æ’­æ”¾å®Œæˆå›è°ƒBlock</span>
    <span class="n">self</span><span class="p">.</span><span class="n">audioStream</span><span class="p">.</span><span class="n">onCompletion</span> <span class="o">=</span> <span class="o">^</span><span class="p">(){</span>
          <span class="n">NSLog</span><span class="p">(</span><span class="s">@"æ’­æ”¾å®Œæˆ!"</span><span class="p">);</span>
    <span class="p">};</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">audioStream</span> <span class="nf">setVolume</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">];</span><span class="c1">//è®¾ç½®å£°éŸ³å¤§å°</span>
<span class="p">}</span>
</pre></table></code></div></div><p>æœ‰ç‚¹è·‘è¿œäº† å›åˆ°æ­£é¢˜ æœ¬ç« å°†ä¸ä¼šæŠŠè¿™ä¸ªå†™åˆ°demoä¸­ è¯·è°…è§£</p><h1 id="ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸ªavaudiorecorderçš„demo-å®Œæˆä¸Šè¿°åŠŸèƒ½">ä¸‹é¢æˆ‘ä»¬æ¥å†™ä¸ª<code class="language-plaintext highlighter-rouge">AVAudioRecorder</code>çš„Demo å®Œæˆä¸Šè¿°åŠŸèƒ½</h1><h2 id="é…ç½®ä¼šè¯">é…ç½®ä¼šè¯</h2><p>é¦–å…ˆåˆ›å»ºä»¥ä¸€ä¸ªAVAudioRecorderDemoå·¥ç¨‹iOSå¹³å°è¿™äº›ç›¸ä¿¡å¤§å®¶éå¸¸ç†Ÿç»ƒäº†.</p><p>åœ¨<code class="language-plaintext highlighter-rouge">AppDelegate</code>é‡Œé¢å¯¼å…¥<code class="language-plaintext highlighter-rouge">#import &lt;AVFoundation/AVFoundation.h&gt;</code> å†™ä¸Šè®¾ç½®å¦‚ä¸‹ä»£ç </p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">application</span><span class="p">:(</span><span class="n">UIApplication</span> <span class="o">*</span><span class="p">)</span><span class="nv">application</span> <span class="nf">didFinishLaunchingWithOptions</span><span class="p">:(</span><span class="n">NSDictionary</span> <span class="o">*</span><span class="p">)</span><span class="nv">launchOptions</span> <span class="p">{</span>
    
    <span class="n">AVAudioSession</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="p">[</span><span class="n">AVAudioSession</span> <span class="nf">sharedInstance</span><span class="p">];</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">session</span> <span class="nf">setCategory</span><span class="p">:</span><span class="n">AVAudioSessionCategoryPlayAndRecord</span> <span class="nf">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Category Error: %@"</span><span class="p">,[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
    <span class="p">}</span>
    
    <span class="c1">//æ¿€æ´»ä¼šè¯</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">[</span><span class="n">session</span> <span class="nf">setActive</span><span class="p">:</span><span class="nb">YES</span> <span class="nf">error</span><span class="p">:</span><span class="o">&amp;</span><span class="n">error</span><span class="p">])</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Activation Error: %@"</span><span class="p">,[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>è¿™<code class="language-plaintext highlighter-rouge">AVAudioSessionCategoryPlayAndRecord</code>æ˜¯<a href="http://sunyazhou.com/2017/03/17/Learning-AV-Foundation-AVAudioPlayer/">ä¸Šä¸€ç« </a>è¯´çš„é‚£å‡ ç§Category,æˆ‘ä»¬éœ€è¦__å½•éŸ³+æ’­æ”¾__åŠŸèƒ½</p><p>ä¸‹ä¸€æ­¥ é…ç½® plistæ–‡ä»¶è®¿é—®æƒé™ä¿¡æ¯ å¯ä»¥å‚è€ƒ<a href="http://localhost:4000/2017/03/20/Access-privacy-sensitive-data-private-access-permission/">Access privacy-sensitive data</a>è¿™ç¯‡æ–‡ç« æŠŠè®¿é—®æƒé™éœ€è¦çš„ ä¿¡æ¯å¡«å……ä¸Š.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/FillInfo.webp" alt="plist1" /></p><p>ç„¶åé€‰æ‹©SourceCode <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/SourceCode.webp" alt="plist2" /></p><p>å¡«å†™ä¸Š</p><div class="language-xml highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- ğŸ¤ Microphone --&gt;</span>
<span class="nt">&lt;key&gt;</span>NSMicrophoneUsageDescription<span class="nt">&lt;/key&gt;</span>
<span class="nt">&lt;string&gt;</span>$(PRODUCT_NAME) microphone use<span class="nt">&lt;/string&gt;</span>
</pre></table></code></div></div><p>ä¸Šè¾¹è¿™äº›æ˜¯ä¸ºäº†è®¿é—®æœ¬åœ°æˆæƒ, è®°å¾—æˆæƒå¦‚æœç¬¬ä¸€æ¬¡è¢«æ‹’å°±å¿…é¡»è®©ç”¨æˆ·æ‰‹åŠ¨ åˆ°é€šç”¨-è®¾ç½®é‡Œé¢å»é…ç½®å¦åˆ™å°†æ°¸è¿œä¸å¥½ä½¿å“ˆã€‚å¦‚æœä¸å†™è¿™ç§æœ¬åœ°æˆæƒ ç¨‹åºåº”è¯¥ä¼š crash</p><h2 id="å½•éŸ³ä»£ç å®ç°">å½•éŸ³ä»£ç å®ç°</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥å°è£…ä¸€ä¸ªç±»èµ·åå«<code class="language-plaintext highlighter-rouge">BDRecoder</code>å§. è¿™é‡Œç±»æˆ‘ä»¬è®©å®ƒè´Ÿè´£æ‰€æœ‰ éŸ³é¢‘å½•åˆ¶ã€æš‚åœå½•åˆ¶ã€ä¿å­˜å½•åˆ¶æ–‡ä»¶ç­‰åŠŸèƒ½ å¹¶æœ‰å›è°ƒå‡½æ•°ç­‰block. <code class="language-plaintext highlighter-rouge">BDRecoder.h</code>çœ‹èµ·æ¥åƒä¸‹é¢è¿™æ ·, è¿™é‡Œåç»­å®Œå–„çš„è¯å¯ä»¥åŠ ä¸ªä»£ç† è¡¨ç¤ºå½•åˆ¶è¿‡ç¨‹ä¸­æ„å¤–ä¸­æ–­æˆ–è€…çº¿è·¯åˆ‡æ¢ç­‰é€»è¾‘.</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="c1">//</span>
<span class="c1">//  BDRecorder.h</span>
<span class="c1">//  AVAudioRecorderDemo</span>
<span class="c1">//</span>
<span class="c1">//  Created by sunyazhou on 2017/3/29.</span>
<span class="c1">//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import &lt;Foundation/Foundation.h&gt;
#import &lt;AVFoundation/AVFoundation.h&gt;
</span>
<span class="k">@class</span> <span class="nc">MemoModel</span><span class="p">;</span>
<span class="c1">//å½•éŸ³åœæ­¢çš„å›è°ƒ</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">^</span><span class="n">BDRecordingStopCompletionHanlder</span><span class="p">)(</span><span class="n">BOOL</span><span class="p">);</span>
<span class="c1">//ä¿å­˜å½•éŸ³æ–‡ä»¶å®Œæˆçš„å›è°ƒ</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">^</span><span class="n">BDRecordingSaveCompletionHanlder</span><span class="p">)(</span><span class="n">BOOL</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

<span class="k">@interface</span> <span class="nc">BDRecorder</span> <span class="p">:</span> <span class="nc">NSObject</span>

<span class="cm">/**
 * å¤–éƒ¨è·å–å½“å‰å½•åˆ¶çš„æ—¶é—´
 * å°æ—¶:åˆ†é’Ÿ:ç§’  å½“ç„¶åç»­å¯ä»¥åŠ å¾®ç§’å’Œæ¯«ç§’å“ˆå°±æ˜¯æ ¼å¼å­—ç¬¦ä¸² 00:03:02 è¿™æ ·
 */</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">formattedCurrentTime</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">record</span><span class="p">;</span> <span class="c1">//å¼€å§‹å½•éŸ³</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pause</span><span class="p">;</span>  <span class="c1">//æš‚åœå½•éŸ³</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopWithCompletionHandler</span><span class="p">:(</span><span class="n">BDRecordingStopCompletionHanlder</span><span class="p">)</span><span class="nv">handler</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">saveRecordingWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span>
            <span class="nf">completionHandler</span><span class="p">:(</span><span class="n">BDRecordingSaveCompletionHanlder</span><span class="p">)</span><span class="nv">handler</span><span class="p">;</span>

<span class="cm">/**
 å›æ”¾å½•åˆ¶çš„æ–‡ä»¶

 @param memo å¤‡å¿˜å½•æ–‡ä»¶model æ”¾ç€å½“å‰æ’­æ”¾çš„model
 @return æ˜¯å¦æ’­æ”¾æˆåŠŸ
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">playbackURL</span><span class="p">:(</span><span class="n">MemoModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">memo</span><span class="p">;</span>
<span class="k">@end</span>

</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">BDRecoder.m</code></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
</pre><td class="rouge-code"><pre><span class="c1">//</span>
<span class="c1">//  BDRecorder.m</span>
<span class="c1">//  AVAudioRecorderDemo</span>
<span class="c1">//</span>
<span class="c1">//  Created by sunyazhou on 2017/3/29.</span>
<span class="c1">//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import "BDRecorder.h"
</span>
<span class="cp">#import "MemoModel.h"
</span>
<span class="k">@interface</span> <span class="nc">BDRecorder</span> <span class="p">()</span> <span class="o">&lt;</span><span class="n">AVAudioRecorderDelegate</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">AVAudioPlayer</span> <span class="o">*</span><span class="n">player</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">AVAudioRecorder</span> <span class="o">*</span><span class="n">recorder</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">BDRecordingStopCompletionHanlder</span> <span class="n">completionHandler</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">BDRecorder</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">temDir</span> <span class="o">=</span> <span class="n">NSTemporaryDirectory</span><span class="p">();</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">filePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">temDir</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="s">@"test1.caf"</span><span class="p">];</span>
        <span class="n">NSURL</span> <span class="o">*</span><span class="n">fileURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">fileURLWithPath</span><span class="p">:</span><span class="n">filePath</span><span class="p">];</span>
        
        <span class="n">NSDictionary</span> <span class="o">*</span><span class="n">setting</span> <span class="o">=</span> <span class="p">@{</span><span class="n">AVFormatIDKey</span><span class="o">:</span> <span class="err">@</span><span class="p">(</span><span class="n">kAudioFormatAppleIMA4</span><span class="p">),</span>
                                  <span class="nl">AVSampleRateKey:</span> <span class="mf">@44100.0f</span><span class="p">,</span>
                                  <span class="nl">AVNumberOfChannelsKey:</span> <span class="mi">@1</span><span class="p">,</span>
                                  <span class="nl">AVEncoderBitDepthHintKey:</span> <span class="mi">@16</span><span class="p">,</span>
                                  <span class="nl">AVEncoderAudioQualityKey:</span> <span class="err">@</span><span class="p">(</span><span class="n">AVAudioQualityMedium</span><span class="p">)</span>
                                  <span class="p">};</span>
        <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioRecorder</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithURL</span><span class="p">:</span><span class="n">fileURL</span> <span class="nf">settings</span><span class="p">:</span><span class="n">setting</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>
            <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">prepareToRecord</span><span class="p">];</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Create Recorder Error: %@"</span><span class="p">,[</span><span class="n">error</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
        <span class="p">}</span> 
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">record</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">record</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">pause</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">pause</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">stopWithCompletionHandler</span><span class="p">:(</span><span class="n">BDRecordingStopCompletionHanlder</span><span class="p">)</span><span class="nv">handler</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">completionHandler</span> <span class="o">=</span> <span class="n">handler</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">stop</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">saveRecordingWithName</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">name</span>
            <span class="nf">completionHandler</span><span class="p">:(</span><span class="n">BDRecordingSaveCompletionHanlder</span><span class="p">)</span><span class="nv">handler</span> <span class="p">{</span>
    <span class="n">NSTimeInterval</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSDate</span> <span class="nf">timeIntervalSinceReferenceDate</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">filename</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="s">@"%@-%f.caf"</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">docDir</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span> <span class="nf">documentsDirectory</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">destPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">docDir</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="n">filename</span><span class="p">];</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">srcURL</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">url</span><span class="p">;</span>
    <span class="n">NSURL</span> <span class="o">*</span><span class="n">destURL</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">fileURLWithPath</span><span class="p">:</span><span class="n">destPath</span><span class="p">];</span>
    <span class="n">NSError</span> <span class="o">*</span><span class="n">error</span><span class="p">;</span>
    <span class="n">BOOL</span> <span class="n">success</span> <span class="o">=</span> <span class="p">[[</span><span class="n">NSFileManager</span> <span class="nf">defaultManager</span><span class="p">]</span> <span class="nf">copyItemAtURL</span><span class="p">:</span><span class="n">srcURL</span> <span class="nf">toURL</span><span class="p">:</span><span class="n">destURL</span> <span class="n">error</span><span class="o">:&amp;</span><span class="n">error</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">MemoModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="p">[</span><span class="n">MemoModel</span> <span class="nf">memoWithTitle</span><span class="p">:</span><span class="n">name</span> <span class="nf">url</span><span class="p">:</span><span class="n">destURL</span><span class="p">];</span>
        <span class="n">handler</span><span class="p">(</span><span class="nb">YES</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
    <span class="p">}</span>
    
    
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">documentsDirectory</span> <span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">paths</span> <span class="o">=</span> <span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">paths</span> <span class="nf">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">audioRecorderDidFinishRecording</span><span class="p">:(</span><span class="n">AVAudioRecorder</span> <span class="o">*</span><span class="p">)</span><span class="nv">recorder</span>
                           <span class="nf">successfully</span><span class="p">:(</span><span class="n">BOOL</span><span class="p">)</span><span class="nv">flag</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">completionHandler</span><span class="p">)</span> <span class="p">{</span> <span class="n">self</span><span class="p">.</span><span class="n">completionHandler</span><span class="p">(</span><span class="n">flag</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>

</pre></table></code></div></div><p>è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">self.completionHandler</code>å½“å¤–éƒ¨è°ƒç”¨<code class="language-plaintext highlighter-rouge">stopWithCompletionHandler</code>çš„æ—¶å€™æš‚å­˜ä¸€ä¸‹blockæ˜¯ä¸ºäº†å½•éŸ³å®Œæˆæ—¶å‘Šè¯‰å¤–éƒ¨é€šçŸ¥ä¸€ä¸‹ä»¥ä¾¿äºå¯ä»¥å¼¹å‡ºä¸€ä¸ªUIAlertViewå»æ˜¾ç¤ºä¿å­˜ç­‰æ“ä½œ</p><p>å½“åœæ­¢å½•éŸ³, è¿›å…¥è¯­éŸ³å¤‡å¿˜é˜¶æ®µå‘½åé˜¶æ®µæ—¶ è®©å¤–éƒ¨è°ƒç”¨<code class="language-plaintext highlighter-rouge">saveRecordingWithName:completionHandler </code>ä¼ å…¥æ–‡ä»¶çš„å‘½å,ç„¶åæˆ‘ä»¬é€šè¿‡<code class="language-plaintext highlighter-rouge">self.recorder.url</code>è·å–åˆ°URLå¹¶ä¸”copyåˆ°tmpé‡Œé¢æ˜¯ç›®å½•å¹¶å‘½å</p><p>ä¸‹ä¸€æ­¥è¦å®ç°<code class="language-plaintext highlighter-rouge">playbackURL:</code> è¿™é‡Œé¢æœ‰ä¸ª<code class="language-plaintext highlighter-rouge">MemoModel</code>å‚æ•°çš„å¯¹è±¡, è¿™ä¸ª<code class="language-plaintext highlighter-rouge">MemoModel</code>æ˜¯ä¸€ä¸ªå¯¹è±¡modelæ”¾ç€ æ–‡ä»¶nameã€urlâ€¦</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="cp">#import &lt;Foundation/Foundation.h&gt;
</span>
<span class="k">@interface</span> <span class="nc">MemoModel</span> <span class="p">:</span> <span class="nc">NSObject</span> <span class="o">&lt;</span><span class="n">NSCopying</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">title</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSURL</span> <span class="o">*</span><span class="n">url</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">dateString</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">copy</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">timeString</span><span class="p">;</span>

<span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">memoWithTitle</span><span class="p">:(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">title</span> <span class="nf">url</span><span class="p">:(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="nv">url</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="n">deleteMemo</span><span class="p">;</span>
<span class="k">@end</span>
<span class="c1">//å…·ä½“å®ç°è¯·å‚è€ƒæˆ‘çš„æœ€ç»ˆdemo</span>
</pre></table></code></div></div><p>å®ç°æ’­æ”¾éƒ¨åˆ†éœ€è¦åˆ›å»ºæ’­æ”¾å™¨ è¿™é‡Œå°±ç®€å•åˆ›å»ºä¸€ä¸‹<code class="language-plaintext highlighter-rouge">AVAudioPlayer</code></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="cm">/**
 å›æ”¾å½•åˆ¶çš„æ–‡ä»¶
 
 @param memo å¤‡å¿˜å½•æ–‡ä»¶model æ”¾ç€å½“å‰æ’­æ”¾çš„model
 @return æ˜¯å¦æ’­æ”¾æˆåŠŸ
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">playbackURL</span><span class="p">:(</span><span class="n">MemoModel</span> <span class="o">*</span><span class="p">)</span><span class="nv">memo</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">stop</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="o">=</span> <span class="p">[[</span><span class="n">AVAudioPlayer</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">initWithContentsOfURL</span><span class="p">:</span><span class="n">memo</span><span class="p">.</span><span class="n">url</span> <span class="nf">error</span><span class="p">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">player</span> <span class="nf">prepareToPlay</span><span class="p">];</span>
        <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nb">NO</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>è¿™é‡Œé€šè¿‡memo.url ç»™å½“å‰æ’­æ”¾å™¨æ’­æ”¾, è¿™é‡Œå°±ç®€å•å®ç°ä¸€ä¸‹ å¦‚æœéœ€è¦å¤æ‚å®ç°å¯ä»¥å‚è€ƒæˆ‘ä¸Šä¸€ç« è®²è§£çš„<code class="language-plaintext highlighter-rouge">AVAudioPlayer</code></p><p>æœ€åæŠŠæ˜¾ç¤ºäº‹ä»¶éƒ¨åˆ†çš„ä»£ç åŠ ä¸Š</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="cm">/**
 * å¤–éƒ¨è·å–å½“å‰å½•åˆ¶çš„æ—¶é—´
 * å°æ—¶:åˆ†é’Ÿ:ç§’  å½“ç„¶åç»­å¯ä»¥åŠ å¾®ç§’å’Œæ¯«ç§’å“ˆå°±æ˜¯æ ¼å¼å­—ç¬¦ä¸² 00:03:02 è¿™æ ·
 */</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">formattedCurrentTime</span><span class="p">;</span>

</pre></table></code></div></div><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å¤å†™<code class="language-plaintext highlighter-rouge">formattedCurrentTime</code>getæ–¹æ³•è·å–æ—¶é—´æ ¼å¼ä¾‹å¦‚: 00:00:00</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="cm">/**
 è¿”å›å½“å‰å½•åˆ¶çš„æ—¶é—´æ ¼å¼ HH:mm:ss

 @return è¿”å›ç»„è£…å¥½çš„å­—ç¬¦ä¸²
 */</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSString</span> <span class="o">*</span><span class="p">)</span><span class="n">formattedCurrentTime</span> <span class="p">{</span>
    <span class="n">NSUInteger</span> <span class="n">time</span> <span class="o">=</span> <span class="p">(</span><span class="n">NSUInteger</span><span class="p">)</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">currentTime</span><span class="p">;</span>
    <span class="n">NSInteger</span> <span class="n">hours</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">);</span>
    <span class="n">NSInteger</span> <span class="n">minutes</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span> <span class="o">/</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
    <span class="n">NSInteger</span> <span class="n">seconds</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="mi">60</span><span class="p">;</span>
    
    <span class="n">NSString</span> <span class="o">*</span><span class="n">format</span> <span class="o">=</span> <span class="s">@"%02i:%02i:%02i"</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NSString</span> <span class="nf">stringWithFormat</span><span class="p">:</span><span class="n">format</span><span class="p">,</span> <span class="n">hours</span><span class="p">,</span> <span class="n">minutes</span><span class="p">,</span> <span class="n">seconds</span><span class="p">];</span>
<span class="p">}</span>
</pre></table></code></div></div><p>ä¸Šè¾¹å¤§è‡´æ˜¯å°è£…<code class="language-plaintext highlighter-rouge">BDRecorder</code>çš„è¿‡ç¨‹</p><p>ä¸‹é¢æ˜¯å¯¹<code class="language-plaintext highlighter-rouge">ViewController</code>UIçš„è®¾ç½®, è®¾ç½®å¥½æ—¶é—´æ ¼å¼ æˆ‘ä»¬éœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">ViewController</code>é‡Œ è‡ªå·±æä¸ªå®šæ—¶å™¨å»æ›´æ–°å½•åˆ¶çš„æ—¶é—´åœ¨UIä¸Šçš„æ˜¾ç¤º, å› ä¸º<code class="language-plaintext highlighter-rouge">self.recorder.currentTime</code>æ˜¯åªè¯»ç†Ÿæ‚‰ æ²¡æä¾›setæ–¹æ³• æ‰€ä»¥æˆ‘ä»¬ä¹Ÿæ— æ³•ç”¨KVOç›‘å¬recorderçš„å±æ€§å˜åŒ–.</p><p>ä»£ç å¦‚ä¸‹:</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
</pre><td class="rouge-code"><pre><span class="c1">//</span>
<span class="c1">//  ViewController.m</span>
<span class="c1">//  AVAudioRecorderDemo</span>
<span class="c1">//</span>
<span class="c1">//  Created by sunyazhou on 2017/3/28.</span>
<span class="c1">//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import "ViewController.h"
</span>
<span class="cp">#import &lt;Masonry/Masonry.h&gt;
#import &lt;AVFoundation/AVFoundation.h&gt;
</span>
<span class="cp">#import "BDRecorder.h"
#import "LevelMeterView.h"
#import "MemoModel.h"
#import "MemoCell.h"
#import "LevelPair.h"
</span>
<span class="cp">#define MEMOS_ARCHIVE    @"memos.archive"
</span>
<span class="k">@interface</span> <span class="nc">ViewController</span> <span class="p">()</span> <span class="o">&lt;</span><span class="n">UITableViewDelegate</span><span class="p">,</span> <span class="n">UITableViewDataSource</span><span class="o">&gt;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSMutableArray</span> <span class="o">&lt;</span><span class="n">MemoModel</span> <span class="o">*&gt;*</span><span class="n">memos</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">BDRecorder</span> <span class="o">*</span><span class="n">recorder</span><span class="p">;</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSTimer</span> <span class="o">*</span><span class="n">timer</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">CADisplayLink</span> <span class="o">*</span><span class="n">levelTimer</span><span class="p">;</span>


<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIView</span> <span class="o">*</span><span class="n">containerView</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">recordButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UIButton</span> <span class="o">*</span><span class="n">stopButton</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UILabel</span> <span class="o">*</span><span class="n">timeLabel</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">LevelMeterView</span> <span class="o">*</span><span class="n">levelMeterView</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">weak</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">IBOutlet</span> <span class="n">UITableView</span> <span class="o">*</span><span class="n">tableview</span><span class="p">;</span>



<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">ViewController</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">viewDidLoad</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">viewDidLoad</span><span class="p">];</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="o">=</span> <span class="p">[[</span><span class="n">BDRecorder</span> <span class="nf">alloc</span><span class="p">]</span> <span class="nf">init</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">memos</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">stopButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">recordImage</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImage</span> <span class="nf">imageNamed</span><span class="p">:</span><span class="s">@"record"</span><span class="p">]</span> <span class="nf">imageWithRenderingMode</span><span class="p">:</span><span class="n">UIImageRenderingModeAlwaysOriginal</span><span class="p">];</span>
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">pauseImage</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImage</span> <span class="nf">imageNamed</span><span class="p">:</span><span class="s">@"pause"</span><span class="p">]</span> <span class="nf">imageWithRenderingMode</span><span class="p">:</span><span class="n">UIImageRenderingModeAlwaysOriginal</span><span class="p">];</span>
    <span class="n">UIImage</span> <span class="o">*</span><span class="n">stopImage</span> <span class="o">=</span> <span class="p">[[</span><span class="n">UIImage</span> <span class="nf">imageNamed</span><span class="p">:</span><span class="s">@"stop"</span><span class="p">]</span> <span class="nf">imageWithRenderingMode</span><span class="p">:</span><span class="n">UIImageRenderingModeAlwaysOriginal</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recordButton</span> <span class="nf">setImage</span><span class="p">:</span><span class="n">recordImage</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recordButton</span> <span class="nf">setImage</span><span class="p">:</span><span class="n">pauseImage</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateSelected</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">stopButton</span> <span class="nf">setImage</span><span class="p">:</span><span class="n">stopImage</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
    
    <span class="n">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSData</span> <span class="nf">dataWithContentsOfURL</span><span class="p">:[</span><span class="n">self</span> <span class="nf">archiveURL</span><span class="p">]];</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_memos</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">array</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">_memos</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSKeyedUnarchiver</span> <span class="nf">unarchiveObjectWithData</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
    <span class="p">}</span>
    
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableview</span> <span class="nf">registerNib</span><span class="p">:[</span><span class="n">UINib</span> <span class="nf">nibWithNibName</span><span class="p">:</span><span class="s">@"MemoCell"</span> <span class="nf">bundle</span><span class="p">:[</span><span class="n">NSBundle</span> <span class="nf">mainBundle</span><span class="p">]]</span> <span class="n">forCellReuseIdentifier</span><span class="o">:</span><span class="s">@"MemoCell"</span><span class="p">];</span>
    
    
    <span class="p">[</span><span class="n">self</span> <span class="nf">layoutSubveiws</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">layoutSubveiws</span><span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_top</span><span class="p">).</span><span class="n">offset</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_left</span><span class="p">).</span><span class="n">offset</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_right</span><span class="p">).</span><span class="n">offset</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">centerX</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_centerX</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tableview</span><span class="p">.</span><span class="n">mas_top</span><span class="p">).</span><span class="n">offset</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableview</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">mas_top</span><span class="p">).</span><span class="n">offset</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
    <span class="p">}];</span>
    
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">timeLabel</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">top</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">centerX</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">mas_centerX</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">height</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="mi">@25</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recordButton</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">mas_left</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">mas_bottom</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">width</span><span class="p">.</span><span class="n">height</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="mi">@71</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">stopButton</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">mas_right</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">containerView</span><span class="p">.</span><span class="n">mas_bottom</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">width</span><span class="p">.</span><span class="n">height</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="mi">@71</span><span class="p">);</span>
    <span class="p">}];</span>
    
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span> <span class="nf">mas_makeConstraints</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">MASConstraintMaker</span> <span class="o">*</span><span class="n">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">make</span><span class="p">.</span><span class="n">left</span><span class="p">.</span><span class="n">right</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">view</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">height</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="mi">@30</span><span class="p">);</span>
        <span class="n">make</span><span class="p">.</span><span class="n">bottom</span><span class="p">.</span><span class="n">equalTo</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">tableview</span><span class="p">.</span><span class="n">mas_top</span><span class="p">);</span>
    <span class="p">}];</span>
<span class="p">}</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">startTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nf">timerWithTimeInterval</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span>
                                         <span class="nl">target:</span><span class="n">self</span>
                                       <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="n">updateTimeDisplay</span><span class="p">)</span>
                                       <span class="nl">userInfo:</span><span class="nb">nil</span>
                                        <span class="nl">repeats:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">NSRunLoop</span> <span class="nf">mainRunLoop</span><span class="p">]</span> <span class="nf">addTimer</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">forMode</span><span class="p">:</span><span class="n">NSRunLoopCommonModes</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stopTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateTimeDisplay</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timeLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">formattedCurrentTime</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">startMeterTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CADisplayLink</span> <span class="nf">displayLinkWithTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">updateMeter</span><span class="p">)];</span>
<span class="c1">//    if ([self.levelTimer respondsToSelector:@selector(setPreferredFramesPerSecond:)]) {</span>
<span class="c1">//        self.levelTimer.preferredFramesPerSecond = 5;</span>
<span class="c1">//    } else {</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span><span class="p">.</span><span class="n">frameInterval</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="c1">//    }</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">addToRunLoop</span><span class="p">:[</span><span class="n">NSRunLoop</span> <span class="nf">currentRunLoop</span><span class="p">]</span>
                          <span class="nl">forMode:</span><span class="n">NSRunLoopCommonModes</span><span class="p">];</span>
    
<span class="p">}</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stopMeterTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span> <span class="nf">resetLevelMeter</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateMeter</span> <span class="p">{</span>
    <span class="n">LevelPair</span> <span class="o">*</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">levels</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">levels</span><span class="p">.</span><span class="n">level</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span><span class="p">.</span><span class="n">peakLevel</span> <span class="o">=</span> <span class="n">levels</span><span class="p">.</span><span class="n">peakLevel</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span> <span class="nf">setNeedsDisplay</span><span class="p">];</span>
    
<span class="p">}</span>

<span class="cp">#pragma mark -
#pragma mark - UITableViewDelegate
</span><span class="k">-</span> <span class="p">(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">numberOfRowsInSection</span><span class="p">:(</span><span class="n">NSInteger</span><span class="p">)</span><span class="nv">section</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">memos</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">-</span> <span class="p">(</span><span class="n">UITableViewCell</span> <span class="o">*</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">cellForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="n">MemoCell</span> <span class="o">*</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="n">tableView</span> <span class="nf">dequeueReusableCellWithIdentifier</span><span class="p">:</span><span class="s">@"MemoCell"</span><span class="p">];</span>
    <span class="n">cell</span><span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">memos</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">cell</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">didSelectRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span><span class="p">{</span>
    <span class="n">MemoModel</span> <span class="o">*</span><span class="n">model</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">memos</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">playbackURL</span><span class="p">:</span><span class="n">model</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">BOOL</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">canEditRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">YES</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">commitEditingStyle</span><span class="p">:(</span><span class="n">UITableViewCellEditingStyle</span><span class="p">)</span><span class="nv">editingStyle</span> <span class="nf">forRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">editingStyle</span> <span class="o">==</span> <span class="n">UITableViewCellEditingStyleDelete</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">MemoModel</span> <span class="o">*</span><span class="n">memo</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">memos</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="nf">row</span><span class="p">];</span>
        <span class="p">[</span><span class="n">memo</span> <span class="nf">deleteMemo</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">memos</span> <span class="nf">removeObjectAtIndex</span><span class="p">:</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">saveMemos</span><span class="p">];</span>
        <span class="p">[</span><span class="n">tableView</span> <span class="nf">deleteRowsAtIndexPaths</span><span class="p">:@[</span><span class="n">indexPath</span><span class="p">]</span> <span class="nf">withRowAnimation</span><span class="p">:</span><span class="n">UITableViewRowAnimationAutomatic</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span><span class="nf">tableView</span><span class="p">:(</span><span class="n">UITableView</span> <span class="o">*</span><span class="p">)</span><span class="nv">tableView</span> <span class="nf">heightForRowAtIndexPath</span><span class="p">:(</span><span class="n">NSIndexPath</span> <span class="o">*</span><span class="p">)</span><span class="nv">indexPath</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">80</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
</span><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">record</span><span class="p">:(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">stopButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">sender</span> <span class="nf">isSelected</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">stopMeterTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">stopTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">pause</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">startMeterTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">startTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">record</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">sender</span> <span class="nf">setSelected</span><span class="p">:</span><span class="o">!</span><span class="p">[</span><span class="n">sender</span> <span class="nf">isSelected</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">stopRecording</span><span class="p">:(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">stopMeterTimer</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">recordButton</span><span class="p">.</span><span class="n">selected</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">stopButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">stopWithCompletionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">delayInSeconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
        <span class="n">dispatch_time_t</span> <span class="n">popTime</span> <span class="o">=</span> <span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span> <span class="p">(</span><span class="n">delayInSeconds</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">));</span>
        <span class="n">dispatch_after</span><span class="p">(</span><span class="n">popTime</span><span class="p">,</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">showSaveDialog</span><span class="p">];</span>
        <span class="p">});</span>
    <span class="p">}];</span>
<span class="p">}</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">showSaveDialog</span> <span class="p">{</span>
    <span class="n">UIAlertController</span> <span class="o">*</span><span class="n">alertController</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIAlertController</span> <span class="nf">alertControllerWithTitle</span><span class="p">:</span><span class="s">@"ä¿å­˜å½•éŸ³"</span> <span class="nf">message</span><span class="p">:</span><span class="s">@"è¾“å…¥åç§°"</span> <span class="n">preferredStyle</span><span class="o">:</span><span class="n">UIAlertControllerStyleAlert</span><span class="p">];</span>
    <span class="p">[</span><span class="n">alertController</span> <span class="nf">addTextFieldWithConfigurationHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">UITextField</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">textField</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">textField</span><span class="p">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="s">@"æˆ‘çš„å½•éŸ³"</span><span class="p">;</span>
    <span class="p">}];</span>
    <span class="n">UIAlertAction</span> <span class="o">*</span><span class="n">cancelAction</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIAlertAction</span> <span class="nf">actionWithTitle</span><span class="p">:</span><span class="s">@"Cancel"</span> <span class="nf">style</span><span class="p">:</span><span class="n">UIAlertActionStyleCancel</span> <span class="n">handler</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
    <span class="n">UIAlertAction</span> <span class="o">*</span><span class="n">okAction</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIAlertAction</span> <span class="nf">actionWithTitle</span><span class="p">:</span><span class="s">@"OK"</span> <span class="nf">style</span><span class="p">:</span><span class="n">UIAlertActionStyleDefault</span> <span class="n">handler</span><span class="o">:^</span><span class="p">(</span><span class="n">UIAlertAction</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">action</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">NSString</span> <span class="o">*</span><span class="n">filename</span> <span class="o">=</span> <span class="p">[</span><span class="n">alertController</span><span class="p">.</span><span class="n">textFields</span><span class="p">.</span><span class="n">firstObject</span> <span class="nf">text</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">saveRecordingWithName</span><span class="p">:</span><span class="n">filename</span> <span class="nf">completionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">success</span><span class="p">,</span> <span class="n">id</span> <span class="n">object</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">success</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">memos</span> <span class="nf">insertObject</span><span class="p">:</span><span class="n">object</span> <span class="nf">atIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
                <span class="p">[</span><span class="n">self</span> <span class="nf">saveMemos</span><span class="p">];</span>
                <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">tableview</span> <span class="nf">reloadData</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error saving file: %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">object</span> <span class="nf">localizedDescription</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}];</span>
    <span class="p">}];</span>
    <span class="p">[</span><span class="n">alertController</span> <span class="nf">addAction</span><span class="p">:</span><span class="n">cancelAction</span><span class="p">];</span>
    <span class="p">[</span><span class="n">alertController</span> <span class="nf">addAction</span><span class="p">:</span><span class="n">okAction</span><span class="p">];</span>
    
    <span class="p">[</span><span class="n">self</span> <span class="nf">presentViewController</span><span class="p">:</span><span class="n">alertController</span> <span class="nf">animated</span><span class="p">:</span><span class="nb">YES</span> <span class="n">completion</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#pragma mark - Memo Archiving
</span><span class="c1">//ä¿å­˜å¤‡å¿˜å½•model  è¿™é‡Œç®€å•ç”¨å½’æ¡£çš„æ–¹å¼å­˜å‚¨ä¸€ä¸‹</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">saveMemos</span> <span class="p">{</span>
    <span class="n">NSData</span> <span class="o">*</span><span class="n">fileData</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSKeyedArchiver</span> <span class="nf">archivedDataWithRootObject</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">memos</span><span class="p">];</span>
    <span class="p">[</span><span class="n">fileData</span> <span class="nf">writeToURL</span><span class="p">:[</span><span class="n">self</span> <span class="nf">archiveURL</span><span class="p">]</span> <span class="nf">atomically</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">//å­˜å‚¨å½’æ¡£çš„è·¯å¾„</span>
<span class="k">-</span> <span class="p">(</span><span class="n">NSURL</span> <span class="o">*</span><span class="p">)</span><span class="n">archiveURL</span> <span class="p">{</span>
    <span class="n">NSArray</span> <span class="o">*</span><span class="n">paths</span> <span class="o">=</span> <span class="n">NSSearchPathForDirectoriesInDomains</span><span class="p">(</span><span class="n">NSDocumentDirectory</span><span class="p">,</span> <span class="n">NSUserDomainMask</span><span class="p">,</span> <span class="nb">YES</span><span class="p">);</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">docsDir</span> <span class="o">=</span> <span class="p">[</span><span class="n">paths</span> <span class="nf">objectAtIndex</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">NSString</span> <span class="o">*</span><span class="n">archivePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">docsDir</span> <span class="nf">stringByAppendingPathComponent</span><span class="p">:</span><span class="n">MEMOS_ARCHIVE</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NSURL</span> <span class="nf">fileURLWithPath</span><span class="p">:</span><span class="n">archivePath</span><span class="p">];</span>
<span class="p">}</span>



<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">didReceiveMemoryWarning</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">didReceiveMemoryWarning</span><span class="p">];</span>
    <span class="c1">// Dispose of any resources that can be recreated.</span>
<span class="p">}</span>


<span class="k">@end</span>

</pre></table></code></div></div><p>ä»£ç ç¨ç¨æœ‰ç‚¹é•¿ æˆ‘ç®€å•è¯´ä¸€ä¸‹ å¤§å®¶å¯ä»¥å‚ç…§æœ€ç»ˆçš„demo</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSMutableArray</span> <span class="o">&lt;</span><span class="n">MemoModel</span> <span class="o">*&gt;*</span><span class="n">memos</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">BDRecorder</span> <span class="o">*</span><span class="n">recorder</span><span class="p">;</span>

</pre></table></code></div></div><p>å£°æ˜ä¸€ä¸ªæ•°ç»„ å­˜æ”¾éœ€è¦æ’­æ”¾çš„modelå¯¹è±¡ä¿¡æ¯ åç§° æ–‡ä»¶urlã€æ—¥æœŸç­‰</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSTimer</span> <span class="o">*</span><span class="n">timer</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">CADisplayLink</span> <span class="o">*</span><span class="n">levelTimer</span><span class="p">;</span>
</pre></table></code></div></div><p>ä¸€ä¸ªtimerç”¨äº åˆ·æ–°å½•åˆ¶æ—¶é—´ <code class="language-plaintext highlighter-rouge">levelTimer</code>ç”¨äºåˆ·æ–°å½•åˆ¶çš„è§†æ³¢å›¾ä¹Ÿå«<code class="language-plaintext highlighter-rouge">Audio Metering</code>å¯¹éŸ³é¢‘è¿›è¡Œè®¡é‡</p><p>åœ¨<code class="language-plaintext highlighter-rouge">BDRecorder</code>ä¸­å¢åŠ äº†</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">LevelPair</span> <span class="o">*</span><span class="p">)</span><span class="n">levels</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">updateMeters</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">avgPower</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">averagePowerForChannel</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">peakPower</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">peakPowerForChannel</span><span class="p">:</span><span class="mi">0</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">linearLevel</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">meterTable</span> <span class="nf">valueForPower</span><span class="p">:</span><span class="n">avgPower</span><span class="p">];</span>
    <span class="kt">float</span> <span class="n">linearPeak</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">meterTable</span> <span class="nf">valueForPower</span><span class="p">:</span><span class="n">peakPower</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">LevelPair</span> <span class="nf">levelsWithLevel</span><span class="p">:</span><span class="n">linearLevel</span> <span class="nf">peakLevel</span><span class="p">:</span><span class="n">linearPeak</span><span class="p">];</span>
<span class="p">}</span>
</pre></table></code></div></div><p>è¿™ä¸¤ä¸ªæ–¹æ³• 1. averagePowerForChannelå–å‡ºæ³¢è°·å¹³å‡å€¼ 2. peakPowerForChannelå–å‡ºæ³¢å³° ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ªç”¨äºè¡¨ç¤ºå£°éŸ³åˆ†è´(dB)ç­‰çº§çš„æµ®ç‚¹å€¼. è¿™ä¸ªå€¼çš„è¡¨ç¤ºèŒƒå›´<code class="language-plaintext highlighter-rouge">0dB(fullscale) ~ -160dB</code> 0dBæœ€å¤§ -160dBæœ€å°</p><p><strong>å¼€å¯éŸ³é¢‘è®¡é‡ (éœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">BDRecorder</code>ä¸­å¼€å¯, å¦‚ä¸‹ä»£ç ) ä¼šå¸¦æ¥å¾ˆå¤šé¢å¤–çš„å¼€é”€ï¼Œä½†æˆ‘è§‰å¾—è¿˜æ˜¯å¾ˆåˆ’ç®—çš„ æ¯•ç«Ÿè¦æ˜¾ç¤ºè§†è§‰æ•ˆæœæ‰æ˜¯ç‹é“. å¦‚æœ<code class="language-plaintext highlighter-rouge">meteringEnabled</code>å¼€å¯åˆ™éŸ³é¢‘å½•éŸ³å™¨å°±ä¼šå¯¹æ•æ‰åˆ°çš„éŸ³é¢‘æ ·æœ¬è¿›è¡Œåˆ†è´è®¡ç®—ã€‚</strong></p><p><strong>å¼€å¯éŸ³é¢‘è®¡é‡(Audio Metering)æ–¹æ³•:</strong></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">meteringEnabled</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
</pre></table></code></div></div><p>æ›´æ–°å‰è°ƒç”¨äº†å¦‚ä¸‹ä»£ç </p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="n">LevelPair</span> <span class="o">*</span><span class="p">)</span><span class="n">levels</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">updateMeters</span><span class="p">];</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>æ¯å½“è¯»å–å€¼ä¹‹å‰éœ€è¦è°ƒç”¨<code class="language-plaintext highlighter-rouge">[self.recorder updateMeters]</code>æ–¹æ³•æ‰èƒ½è·å–åˆ°æœ€æ–°å€¼ï¼Œå¦åˆ™å¯èƒ½è·å–çš„ä¸å¤Ÿç²¾ç¡®</p><p>ç„¶å ä½¿ç”¨<code class="language-plaintext highlighter-rouge">MeterTable</code>ç±» å£°æ˜çš„å‡½æ•°<code class="language-plaintext highlighter-rouge">valueForPower:</code> æŠŠä¸Šè¾¹ä¸¤ä¸ªé˜€å€¼ è½¬æˆçº¿æ€§è¿ç®—</p><p><strong>å°±æ˜¯åˆ†è´å€¼ä»å¯¹æ•°å½¢å¼çš„<code class="language-plaintext highlighter-rouge">-160 ~ 0</code>èŒƒå›´è½¬æ¢ä¸ºçº¿æ€§0åˆ°1çš„å½¢å¼.</strong></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre><td class="rouge-code"><pre><span class="c1">//</span>
<span class="c1">//  MeterTable.m</span>
<span class="c1">//  AVAudioRecorderDemo</span>
<span class="c1">//</span>
<span class="c1">//  Created by sunyazhou on 2017/4/5.</span>
<span class="c1">//  Copyright Â© 2017å¹´ Baidu, Inc. All rights reserved.</span>
<span class="c1">//</span>

<span class="cp">#import "MeterTable.h"
</span>

<span class="cp">#define MIN_DB -60.0f
#define TABLE_SIZE 300
</span>
<span class="k">@implementation</span> <span class="nc">MeterTable</span> <span class="p">{</span>
    <span class="kt">float</span> <span class="n">_scaleFactor</span><span class="p">;</span>
    <span class="n">NSMutableArray</span> <span class="o">*</span><span class="n">_meterTable</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="n">init</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">init</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">float</span> <span class="n">dbResolution</span> <span class="o">=</span> <span class="n">MIN_DB</span> <span class="o">/</span> <span class="p">(</span><span class="n">TABLE_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        
        <span class="n">_meterTable</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableArray</span> <span class="nf">arrayWithCapacity</span><span class="p">:</span><span class="n">TABLE_SIZE</span><span class="p">];</span>
        <span class="n">_scaleFactor</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">/</span> <span class="n">dbResolution</span><span class="p">;</span>
        
        <span class="kt">float</span> <span class="n">minAmp</span> <span class="o">=</span> <span class="n">dbToAmp</span><span class="p">(</span><span class="n">MIN_DB</span><span class="p">);</span>
        <span class="kt">float</span> <span class="n">ampRange</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">-</span> <span class="n">minAmp</span><span class="p">;</span>
        <span class="kt">float</span> <span class="n">invAmpRange</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">ampRange</span><span class="p">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">TABLE_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="kt">float</span> <span class="n">decibels</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dbResolution</span><span class="p">;</span>
            <span class="kt">float</span> <span class="n">amp</span> <span class="o">=</span> <span class="n">dbToAmp</span><span class="p">(</span><span class="n">decibels</span><span class="p">);</span>
            <span class="kt">float</span> <span class="n">adjAmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">amp</span> <span class="o">-</span> <span class="n">minAmp</span><span class="p">)</span> <span class="o">*</span> <span class="n">invAmpRange</span><span class="p">;</span>
            <span class="n">_meterTable</span><span class="p">[</span><span class="nf">i</span><span class="p">]</span> <span class="o">=</span> <span class="err">@</span><span class="p">(</span><span class="n">adjAmp</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">dbToAmp</span><span class="p">(</span><span class="kt">float</span> <span class="n">dB</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">powf</span><span class="p">(</span><span class="mi">10</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mo">05</span><span class="n">f</span> <span class="o">*</span> <span class="n">dB</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">float</span><span class="p">)</span><span class="nf">valueForPower</span><span class="p">:(</span><span class="kt">float</span><span class="p">)</span><span class="nv">power</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">&lt;</span> <span class="n">MIN_DB</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">power</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">power</span> <span class="o">*</span> <span class="n">_scaleFactor</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_meterTable</span><span class="p">[</span><span class="nf">index</span><span class="p">]</span> <span class="nf">floatValue</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">@end</span>

</pre></table></code></div></div><blockquote><p><strong>è¿™ä¸ªç±»åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">_meterTable</code>ä¿å­˜ä»è®¡ç®—å‰çš„åˆ†è´æ•°åˆ°ä½¿ç”¨ä¸€å®šçº§åˆ«åˆ†è´è§£æä¹‹åçš„è½¬æ¢ç»“æœ, è¿™é‡Œä½¿ç”¨çš„è§£æç‡<code class="language-plaintext highlighter-rouge">-0.2dB</code>, è§£æç­‰çº§å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">MIN_DB</code> <code class="language-plaintext highlighter-rouge">TABLE_SIZE</code>è¿™ä¸¤ä¸ªå®çš„å€¼æ¥ä¿®æ”¹,æ¯ä¸ªåˆ†è´å€¼éƒ½è°ƒç”¨<code class="language-plaintext highlighter-rouge">dbToAmp:</code>å‡½æ•°è½¬æ¢ä¸ºçº¿æ€§èŒƒå›´å†…çš„å€¼,ä½¿å…¶å¤„äº<code class="language-plaintext highlighter-rouge">0(-60dB) ~ 1()</code>èŒƒå›´å†…, ä¹‹åç”±è¿™äº›èŒƒå›´å†…çš„å€¼æ„æˆå¹³è¡Œæ›²çº¿,å¼€å¹³æ–¹è®¡ç®—å¹¶ä¿å­˜åˆ°å†…éƒ¨æŸ¥æ‰¾è¡¨æ ¼ä¸­. ç„¶åå¦‚æœå¤–éƒ¨éœ€è¦å¯ä»¥è°ƒç”¨<code class="language-plaintext highlighter-rouge">valueForPower:</code>æ¥è·å–.</strong></p></blockquote><p>ç„¶åä¿å­˜åˆ°<code class="language-plaintext highlighter-rouge">LevelPair</code>çš„å®ä¾‹å¯¹è±¡è¿”å› è¿™ä¸ªå®ä¾‹å¾ˆç®€å•å­˜æ”¾ä¸¤ä¸ªå€¼ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">level</code>ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">peakLevel</code></p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">@interface</span> <span class="nc">LevelPair</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="kt">float</span> <span class="n">level</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">readonly</span><span class="p">)</span> <span class="kt">float</span> <span class="n">peakLevel</span><span class="p">;</span>

<span class="k">+</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">levelsWithLevel</span><span class="p">:(</span><span class="kt">float</span><span class="p">)</span><span class="nv">level</span> <span class="nf">peakLevel</span><span class="p">:(</span><span class="kt">float</span><span class="p">)</span><span class="nv">peakLevel</span><span class="p">;</span>

<span class="k">-</span> <span class="p">(</span><span class="n">instancetype</span><span class="p">)</span><span class="nf">initWithLevel</span><span class="p">:(</span><span class="kt">float</span><span class="p">)</span><span class="nv">level</span> <span class="nf">peakLevel</span><span class="p">:(</span><span class="kt">float</span><span class="p">)</span><span class="nv">peakLevel</span><span class="p">;</span>

<span class="k">@end</span>
</pre></table></code></div></div><p>åœ¨<code class="language-plaintext highlighter-rouge">ViewController</code>ä¸­æ˜¾ç¤ºç›¸å…³çš„UI</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre><td class="rouge-code"><pre><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">startTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSTimer</span> <span class="nf">timerWithTimeInterval</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span>
                                         <span class="nl">target:</span><span class="n">self</span>
                                       <span class="nl">selector:</span><span class="k">@selector</span><span class="p">(</span><span class="n">updateTimeDisplay</span><span class="p">)</span>
                                       <span class="nl">userInfo:</span><span class="nb">nil</span>
                                        <span class="nl">repeats:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[[</span><span class="n">NSRunLoop</span> <span class="nf">mainRunLoop</span><span class="p">]</span> <span class="nf">addTimer</span><span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">forMode</span><span class="p">:</span><span class="n">NSRunLoopCommonModes</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stopTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateTimeDisplay</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">timeLabel</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">recorder</span><span class="p">.</span><span class="n">formattedCurrentTime</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">startMeterTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="o">=</span> <span class="p">[</span><span class="n">CADisplayLink</span> <span class="nf">displayLinkWithTarget</span><span class="p">:</span><span class="n">self</span> <span class="nf">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">updateMeter</span><span class="p">)];</span>
<span class="c1">//    if ([self.levelTimer respondsToSelector:@selector(setPreferredFramesPerSecond:)]) {</span>
<span class="c1">//        self.levelTimer.preferredFramesPerSecond = 5;</span>
<span class="c1">//    } else {</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span><span class="p">.</span><span class="n">frameInterval</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="c1">//    }</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">addToRunLoop</span><span class="p">:[</span><span class="n">NSRunLoop</span> <span class="nf">currentRunLoop</span><span class="p">]</span>
                          <span class="nl">forMode:</span><span class="n">NSRunLoopCommonModes</span><span class="p">];</span>
    
<span class="p">}</span>


<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">stopMeterTimer</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="nf">invalidate</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelTimer</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span> <span class="nf">resetLevelMeter</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">updateMeter</span> <span class="p">{</span>
    <span class="n">LevelPair</span> <span class="o">*</span><span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">levels</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">levels</span><span class="p">.</span><span class="n">level</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span><span class="p">.</span><span class="n">peakLevel</span> <span class="o">=</span> <span class="n">levels</span><span class="p">.</span><span class="n">peakLevel</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">levelMeterView</span> <span class="nf">setNeedsDisplay</span><span class="p">];</span>
    
<span class="p">}</span>

</pre></table></code></div></div><p>ç”¨äºå®šæ—¶å™¨çš„å¤„ç†</p><p>äº‹ä»¶çš„ç›¸å…³å“åº”</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="cp">#pragma mark - event response æ‰€æœ‰è§¦å‘çš„äº‹ä»¶å“åº” æŒ‰é’®ã€é€šçŸ¥ã€åˆ†æ®µæ§ä»¶ç­‰
</span><span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">record</span><span class="p">:(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">stopButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">YES</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">sender</span> <span class="nf">isSelected</span><span class="p">])</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">stopMeterTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">stopTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">pause</span><span class="p">];</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">startMeterTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">startTimer</span><span class="p">];</span>
        <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">record</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="p">[</span><span class="n">sender</span> <span class="nf">setSelected</span><span class="p">:</span><span class="o">!</span><span class="p">[</span><span class="n">sender</span> <span class="nf">isSelected</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">IBAction</span><span class="p">)</span><span class="nf">stopRecording</span><span class="p">:(</span><span class="n">UIButton</span> <span class="o">*</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">stopMeterTimer</span><span class="p">];</span>
    <span class="n">self</span><span class="p">.</span><span class="n">recordButton</span><span class="p">.</span><span class="n">selected</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">stopButton</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="nb">NO</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">recorder</span> <span class="nf">stopWithCompletionHandler</span><span class="p">:</span><span class="o">^</span><span class="p">(</span><span class="n">BOOL</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">double</span> <span class="n">delayInSeconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mo">01</span><span class="p">;</span>
        <span class="n">dispatch_time_t</span> <span class="n">popTime</span> <span class="o">=</span> <span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)</span> <span class="p">(</span><span class="n">delayInSeconds</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">));</span>
        <span class="n">dispatch_after</span><span class="p">(</span><span class="n">popTime</span><span class="p">,</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
            <span class="p">[</span><span class="n">self</span> <span class="nf">showSaveDialog</span><span class="p">];</span>
        <span class="p">});</span>
    <span class="p">}];</span>
<span class="p">}</span>

</pre></table></code></div></div><p>è¿™é‡Œä¿å­˜æ•°æ®ä½¿ç”¨çš„æ˜¯å½’æ¡£æ–¹å¼</p><p><code class="language-plaintext highlighter-rouge">BDRecorder</code>æ²¡æœ‰ å¤„ç†æ„å¤–ä¸­æ–­ç­‰æƒ…å†µ æ¯”å¦‚å¤–æ¥éº¦å…‹é£ å’ŒéŸ³é¢‘æ„å¤–æ¥ç”µç­‰ï¼Œå¦‚æœéœ€è¦å¤„ç† å°±å¯ä»¥åœ¨<code class="language-plaintext highlighter-rouge">BDRecorder</code>ä¸­å£°æ˜å‡ ä¸ªä»£ç†ç›‘å¬éŸ³é¢‘å›è¯çš„é‚£å‡ ä¸ªé€šçŸ¥å°±å¯ä»¥äº† è¿™é‡Œå‡ºäºå­¦ä¹ ä¸ºç›®çš„å°±ç®€å•å†™åˆ°è¿™é‡Œå§ï¼Œå¦‚æœå¤§å®¶éœ€æ±‚å¼ºçƒˆæˆ‘å¯ä»¥å›å¤´è¡¥ä¸Šå¹¶å¼€æºã€‚</p><p>å¾ˆå¤šäººçº ç»“å¦‚ä½•æ ¹æ®æ³¢å½¢ç»˜åˆ¶æ›´å¥½çš„å›¾ æˆ‘è¿™é‡Œæ˜¯å€ŸåŠ©æœ¬ä¹¦ä½œè€…çš„demoå®Œæˆç›¸å…³æ³¢å½¢å¤„ç†çš„è§†å›¾ã€‚</p><div class="language-objc highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre><td class="rouge-code"><pre><span class="cp">#import "LevelMeterView.h"
</span>
<span class="cp">#import "LevelMeterColorThreshold.h"
</span>
<span class="k">@interface</span> <span class="nc">LevelMeterView</span> <span class="p">()</span>

<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">)</span> <span class="n">NSUInteger</span> <span class="n">ledCount</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UIColor</span> <span class="o">*</span><span class="n">ledBackgroundColor</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">strong</span><span class="p">,</span> <span class="n">nonatomic</span><span class="p">)</span> <span class="n">UIColor</span> <span class="o">*</span><span class="n">ledBorderColor</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSArray</span> <span class="o">*</span><span class="n">colorThresholds</span><span class="p">;</span>

<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">LevelMeterView</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithFrame</span><span class="p">:(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">frame</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithFrame</span><span class="p">:</span><span class="n">frame</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setupView</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="nf">initWithCoder</span><span class="p">:(</span><span class="n">NSCoder</span> <span class="o">*</span><span class="p">)</span><span class="nv">coder</span> <span class="p">{</span>
    <span class="n">self</span> <span class="o">=</span> <span class="p">[</span><span class="n">super</span> <span class="nf">initWithCoder</span><span class="p">:</span><span class="n">coder</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">self</span> <span class="nf">setupView</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">setupView</span> <span class="p">{</span>
    
    <span class="n">self</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">clearColor</span><span class="p">];</span>
    
    <span class="n">_ledCount</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
    
    <span class="n">_ledBackgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">colorWithWhite</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="nf">alpha</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">35</span><span class="n">f</span><span class="p">];</span>
    <span class="n">_ledBorderColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">blackColor</span><span class="p">];</span>
    
    <span class="n">UIColor</span> <span class="o">*</span><span class="n">greenColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">colorWithRed</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">458</span> <span class="nf">green</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span> <span class="n">blue</span><span class="o">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">396</span> <span class="n">alpha</span><span class="o">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span><span class="p">];</span>
    <span class="n">UIColor</span> <span class="o">*</span><span class="n">yellowColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">colorWithRed</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span> <span class="nf">green</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">930</span> <span class="n">blue</span><span class="o">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">315</span> <span class="n">alpha</span><span class="o">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span><span class="p">];</span>
    <span class="n">UIColor</span> <span class="o">*</span><span class="n">redColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">colorWithRed</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span> <span class="nf">green</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">325</span> <span class="n">blue</span><span class="o">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">329</span> <span class="n">alpha</span><span class="o">:</span><span class="mi">1</span><span class="p">.</span><span class="mo">000</span><span class="p">];</span>
    
    <span class="n">_colorThresholds</span> <span class="o">=</span> <span class="p">@[[</span><span class="n">LevelMeterColorThreshold</span> <span class="nf">colorThresholdWithMaxValue</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">5</span> <span class="nf">color</span><span class="p">:</span><span class="n">greenColor</span> <span class="n">name</span><span class="o">:</span><span class="s">@"green"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">LevelMeterColorThreshold</span> <span class="nf">colorThresholdWithMaxValue</span><span class="p">:</span><span class="mi">0</span><span class="p">.</span><span class="mi">8</span> <span class="nf">color</span><span class="p">:</span><span class="n">yellowColor</span> <span class="n">name</span><span class="o">:</span><span class="s">@"yellow"</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">LevelMeterColorThreshold</span> <span class="nf">colorThresholdWithMaxValue</span><span class="p">:</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span> <span class="nf">color</span><span class="p">:</span><span class="n">redColor</span> <span class="n">name</span><span class="o">:</span><span class="s">@"red"</span><span class="p">]];</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">drawRect</span><span class="p">:(</span><span class="n">CGRect</span><span class="p">)</span><span class="nv">rect</span> <span class="p">{</span>
    
    <span class="n">CGContextRef</span> <span class="n">context</span> <span class="o">=</span> <span class="n">UIGraphicsGetCurrentContext</span><span class="p">();</span>
    
    <span class="n">CGContextTranslateCTM</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bounds</span><span class="p">));</span>
    <span class="n">CGContextRotateCTM</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="o">-</span><span class="n">M_PI_2</span><span class="p">);</span>
    <span class="n">CGRect</span> <span class="n">bounds</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">.,</span> <span class="mi">0</span><span class="p">.,</span> <span class="p">[</span><span class="n">self</span> <span class="nf">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="p">[</span><span class="n">self</span> <span class="nf">bounds</span><span class="p">].</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">);</span>
    
    
    <span class="n">CGFloat</span> <span class="n">lightMinValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    
    <span class="n">NSInteger</span> <span class="n">peakLED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">peakLevel</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">peakLED</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">peakLevel</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">peakLED</span> <span class="o">&gt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">peakLED</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">ledIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ledIndex</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">;</span> <span class="n">ledIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="n">UIColor</span> <span class="o">*</span><span class="n">ledColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="n">colorThresholds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="nf">color</span><span class="p">];</span>
        
        <span class="n">CGFloat</span> <span class="n">ledMaxValue</span> <span class="o">=</span> <span class="p">(</span><span class="n">CGFloat</span><span class="p">)</span> <span class="p">(</span><span class="n">ledIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">;</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">colorIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">colorIndex</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">colorThresholds</span><span class="p">.</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">colorIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">LevelMeterColorThreshold</span> <span class="o">*</span><span class="n">currThreshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">colorThresholds</span><span class="p">[</span><span class="nf">colorIndex</span><span class="p">];</span>
            <span class="n">LevelMeterColorThreshold</span> <span class="o">*</span><span class="n">nextThreshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">colorThresholds</span><span class="p">[</span><span class="n">colorIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">currThreshold</span><span class="p">.</span><span class="n">maxValue</span> <span class="o">&lt;=</span> <span class="n">ledMaxValue</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">ledColor</span> <span class="o">=</span> <span class="n">nextThreshold</span><span class="p">.</span><span class="n">color</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="n">CGFloat</span> <span class="n">height</span> <span class="o">=</span> <span class="n">CGRectGetHeight</span><span class="p">(</span><span class="n">bounds</span><span class="p">);</span>
        <span class="n">CGFloat</span> <span class="n">width</span> <span class="o">=</span> <span class="n">CGRectGetWidth</span><span class="p">(</span><span class="n">bounds</span><span class="p">);</span>
        
        <span class="n">CGRect</span> <span class="n">ledRect</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="p">((</span><span class="n">CGFloat</span><span class="p">)</span> <span class="n">ledIndex</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">),</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span> <span class="o">/</span> <span class="n">self</span><span class="p">.</span><span class="n">ledCount</span><span class="p">));</span>
        
        <span class="c1">// Fill background color</span>
        <span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ledBackgroundColor</span><span class="p">.</span><span class="n">CGColor</span><span class="p">);</span>
        <span class="n">CGContextFillRect</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">ledRect</span><span class="p">);</span>
        
        <span class="c1">// Draw Light</span>
        <span class="n">CGFloat</span> <span class="n">lightIntensity</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ledIndex</span> <span class="o">==</span> <span class="n">peakLED</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">lightIntensity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">lightIntensity</span> <span class="o">=</span> <span class="n">clamp</span><span class="p">((</span><span class="n">self</span><span class="p">.</span><span class="n">level</span> <span class="o">-</span> <span class="n">lightMinValue</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">ledMaxValue</span> <span class="o">-</span> <span class="n">lightMinValue</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="n">UIColor</span> <span class="o">*</span><span class="n">fillColor</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lightIntensity</span> <span class="o">==</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fillColor</span> <span class="o">=</span> <span class="n">ledColor</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">lightIntensity</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">CGColorRef</span> <span class="n">color</span> <span class="o">=</span> <span class="n">CGColorCreateCopyWithAlpha</span><span class="p">([</span><span class="n">ledColor</span> <span class="nf">CGColor</span><span class="p">],</span> <span class="n">lightIntensity</span><span class="p">);</span>
            <span class="n">fillColor</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIColor</span> <span class="nf">colorWithCGColor</span><span class="p">:</span><span class="n">color</span><span class="p">];</span>
            <span class="n">CGColorRelease</span><span class="p">(</span><span class="n">color</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="n">CGContextSetFillColorWithColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">fillColor</span><span class="p">.</span><span class="n">CGColor</span><span class="p">);</span>
        <span class="n">UIBezierPath</span> <span class="o">*</span><span class="n">fillPath</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="nf">bezierPathWithRoundedRect</span><span class="p">:</span><span class="n">ledRect</span> <span class="nf">cornerRadius</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">];</span>
        <span class="n">CGContextAddPath</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">fillPath</span><span class="p">.</span><span class="n">CGPath</span><span class="p">);</span>
        
        <span class="c1">// Stroke border</span>
        <span class="n">CGContextSetStrokeColorWithColor</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">ledBorderColor</span><span class="p">.</span><span class="n">CGColor</span><span class="p">);</span>
        <span class="n">UIBezierPath</span> <span class="o">*</span><span class="n">strokePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">UIBezierPath</span> <span class="nf">bezierPathWithRoundedRect</span><span class="p">:</span><span class="n">CGRectInset</span><span class="p">(</span><span class="n">ledRect</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span><span class="p">)</span> <span class="nf">cornerRadius</span><span class="p">:</span><span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">];</span>
        <span class="n">CGContextAddPath</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">strokePath</span><span class="p">.</span><span class="n">CGPath</span><span class="p">);</span>
        
        <span class="n">CGContextDrawPath</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">kCGPathFillStroke</span><span class="p">);</span>
        
        <span class="n">lightMinValue</span> <span class="o">=</span> <span class="n">ledMaxValue</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">CGFloat</span> <span class="nf">clamp</span><span class="p">(</span><span class="n">CGFloat</span> <span class="n">intensity</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">intensity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">intensity</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">intensity</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">resetLevelMeter</span> <span class="p">{</span>
    <span class="n">self</span><span class="p">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="n">self</span><span class="p">.</span><span class="n">peakLevel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="p">;</span>
    <span class="p">[</span><span class="n">self</span> <span class="nf">setNeedsDisplay</span><span class="p">];</span>
<span class="p">}</span>


<span class="k">@end</span>
</pre></table></code></div></div><p>è¿™é‡Œç»™å‡ºäº†levelå’Œpeakçš„é˜€å€¼ æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹å¼€æºçš„viewå¤§å®¶å¯ä»¥è‡ªè¡Œç ”ç©¶ä¸€ä¸‹ å¾ˆç®€å• å°±æ˜¯æŠŠç›¸å…³é˜€å€¼é‡åŒ–çš„è¿‡ç¨‹ã€‚</p><h2 id="æ€»ç»“">æ€»ç»“</h2><p><code class="language-plaintext highlighter-rouge">AVAudioRecorder</code> çš„å­¦ä¹ è¿˜ç®—å®Œæ•´çš„æå®Œäº†,éšæ—¶è®°å½•ä¸€ä¸‹å­¦ä¹ å†…å®¹å’ŒæŠ€æœ¯çŸ¥è¯†ã€‚</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/images/20170328LearningAVFoundationAVAudioRecorder/FinalDemo.webp" alt="" /></p><p><strong>æœ€ç»ˆ<a href="https://github.com/sunyazhou13/AVAudioRecorderDemo">Demo</a></strong></p><p>æ¬¢è¿å¤§å®¶æŒ‡æ­£é”™è¯¯ å…¨æ–‡å®Œ</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ios/'>iOS</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ios/" class="post-tag no-text-decoration" >iOS</a> <a href="/tags/macos/" class="post-tag no-text-decoration" >macOS</a> <a href="/tags/objective-c/" class="post-tag no-text-decoration" >Objective-C</a> <a href="/tags/avfoundation/" class="post-tag no-text-decoration" >AVFoundation</a> <a href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/" class="post-tag no-text-decoration" >éŸ³è§†é¢‘</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> è¯¥åšå®¢æ–‡ç« ç”±ä½œè€…é€šè¿‡ <a href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a> è¿›è¡Œæˆæƒã€‚</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">åˆ†äº«</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning AV Foundation(ä¸‰)AVAudioRecorder - è¿ˆè…¾å¤§é˜Ÿé•¿&url=https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning AV Foundation(ä¸‰)AVAudioRecorder - è¿ˆè…¾å¤§é˜Ÿé•¿&u=https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Learning AV Foundation(ä¸‰)AVAudioRecorder - è¿ˆè…¾å¤§é˜Ÿé•¿&url=https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="http://service.weibo.com/share/share.php?title=Learning AV Foundation(ä¸‰)AVAudioRecorder - è¿ˆè…¾å¤§é˜Ÿé•¿&url=https://www.sunyazhou.com/2017/03/LearningAVFoundationAVAudioRecorder/" data-toggle="tooltip" data-placement="top" title="Weibo" target="_blank" rel="noopener" aria-label="Weibo"> <i class="fa-fw fab fa-weibo"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>æœ€è¿‘æ›´æ–°</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/2025/05/MemoryAlignmentAlgorithm/">GPUå†…å­˜å¯¹é½ç®—æ³•</a><li><a href="/2017/02/HowToUseGitManageCode/">å¦‚ä½•ä½¿ç”¨gitç®¡ç†ä»£ç </a><li><a href="/2025/02/the-basics-on-the-memory-layout-of-swift-struct-instances/">Swiftç»“æ„ä½“å®ä¾‹å†…å­˜å¸ƒå±€çš„åŸºç¡€çŸ¥è¯†</a><li><a href="/2025/02/unsafe-swift-using-pointers-and-interacting-with-c/">å¦‚ä½•ä½¿ç”¨unsafe SwiftæŒ‡é’ˆç±»å‹ç›´æ¥è®¿é—®å†…å­˜å¹¶ä¸Cäº¤äº’</a><li><a href="/2017/01/UIViewControllerCodeStandard/">UIViewControllerä»£ç è§„èŒƒ</a></ul></div><div id="access-tags"> <span>çƒ­é—¨æ ‡ç­¾</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/objective-c/">Objective C</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/skills/">skills</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/swiftui/">SwiftUI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">éŸ³è§†é¢‘</a> <a class="post-tag" href="/tags/avfoundation/">AVFoundation</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">æ–‡ç« ç›®å½•</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>æ¥ä¸‹æ¥é˜…è¯»</h3><div class="card-deck mb-4"><div class="card"> <a href="/2022/04/CVPixelBufferRef/"><div class="card-body"> <span class="timeago small" > 2022-04-06 <i class="unloaded">2022-04-06T01:50:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>æ·±å…¥ç†è§£CVPixelBufferRef</h3><div class="text-muted small"><p> åœ¨iOSé‡Œï¼Œæˆ‘ä»¬ç»å¸¸èƒ½çœ‹åˆ°CVPixelBufferRefè¿™ä¸ªç±»å‹ï¼Œåœ¨Cameraé‡‡é›†è¿”å›çš„æ•°æ®é‡Œå¾—åˆ°ä¸€ä¸ªCMSampleBufferRef,è€Œæ¯ä¸ªCMSampleBufferRefé‡Œåˆ™åŒ…å«ä¸€ä¸ªCVPixelBufferRef,åœ¨è§†é¢‘ç¡¬è§£ç çš„è¿”å›æ•°æ®é‡Œä¹Ÿæ˜¯ä¸€ä¸ªCVPixelBufferRefã€‚ é¡¾åæ€ä¹‰,CVPixelBufferRefæ˜¯ä¸€ç§åƒç´ å›¾ç‰‡ç±»å‹ï¼Œç”±äºCVå¼€å¤´ï¼Œæ‰€ä»¥å®ƒæ˜¯å±äºCo...</p></div></div></a></div><div class="card"> <a href="/2017/03/LearningAVFoundationAVSpeechSynthesizer/"><div class="card-body"> <span class="timeago small" > 2017-03-11 <i class="unloaded">2017-03-11T12:38:53+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning AV Foundation(ä¸€)æ±‰å­—è¯­éŸ³æœ—è¯»</h3><div class="text-muted small"><p> å‰è¨€ æœ€è¿‘åœ¨ç ”ç©¶AV Foundation æ¡†æ¶ å‘ç°æœ‰ä¸€æœ¬ä¹¦å«åš AV Foundationå¼€å‘ç§˜ç±ï¼šå®è·µæŒæ¡iOS &amp; OS X åº”ç”¨çš„è§†å¬å¤„ç†æŠ€æœ¯ ç„¶ågoogleæŸ¥äº†ä¸€ä¸‹è‹±æ–‡ç‰ˆå« Learning AV Foundation: A Hands-on Guide to Mastering the AV Foundation Framework çœ‹ç€å›½äººçš„ç¿»è¯‘ä¸ä»…æ…¨å¹...</p></div></div></a></div><div class="card"> <a href="/2017/03/LearningAVFoundationAVAudioPlayer/"><div class="card-body"> <span class="timeago small" > 2017-03-17 <i class="unloaded">2017-03-17T10:26:06+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Learning AV Foundation(äºŒ)AVAudioPlayer</h3><div class="text-muted small"><p> å¼€ç¯‡ æœ€è¿‘åœ¨å­¦ä¹ AV Foundation è¯•å›¾æŠŠå­¦ä¹ å†…å®¹è®°å½•ä¸‹æ¥ å¹¶å‚è€ƒä¸€äº›åšå®¢æ–‡ç«  æœ¬æœŸçš„å†…å®¹æ˜¯AVAudioPlayer éŸ³é¢‘çŸ¥è¯†åŸºç¡€ éŸ³é¢‘æ–‡ä»¶çš„ç”Ÿæˆè¿‡ç¨‹æ˜¯å°†å£°éŸ³ä¿¡æ¯__é‡‡æ ·__ã€é‡åŒ–__å’Œ__ç¼–ç __äº§ç”Ÿçš„æ•°å­—ä¿¡å·çš„è¿‡ç¨‹ï¼Œ__äººè€³æ‰€èƒ½å¬åˆ°çš„å£°éŸ³ï¼Œæœ€ä½çš„é¢‘ç‡æ˜¯ä»20Hzèµ·ä¸€ç›´åˆ°æœ€é«˜é¢‘ç‡20KHZï¼Œå› æ­¤éŸ³é¢‘æ–‡ä»¶æ ¼å¼çš„æœ€å¤§å¸¦å®½æ˜¯20KHZã€‚æ ¹æ®å¥ˆå¥æ–¯ç‰¹çš„ç†è®ºï¼Œåªæœ‰é‡‡æ ·é¢‘ç‡é«˜äº...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/2017/03/CheckNSWindowisFullScreen/" class="btn btn-outline-primary"><p>åˆ¤æ–­NSWindowæ˜¯å¦å…¨å±</p></a> <a href="/2017/03/AccessPrivacySensitive/" class="btn btn-outline-primary"><p>éšç§åŠæ•æ„Ÿæ•°æ®è®¿é—®æƒé™(Access privacy-sensitive data)</p></a></div><div class="utterances-container"> <script src="https://utteranc.es/client.js" repo="sunyazhou13/gitment-comments" issue-term="pathname" theme="photon-dark" crossorigin="anonymous" async> </script></div><script type="text/javascript"> $(function() { window.onmessage = evt => { if (evt.origin === 'https://utteranc.es') { toggle.updateCommentStyle(); window.onmessage = null; } } }); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2025 <a href="https://github.com/sunyazhou13">sunyazhou</a>. <span data-toggle="tooltip" data-placement="top" title="é™¤éå¦æœ‰è¯´æ˜ï¼Œå¦åˆ™æœ¬ç½‘ç«™ä¸Šçš„åšå®¢æ–‡ç« å‡ç”±ä½œè€…æ ¹æ®çŸ¥è¯†å…±äº«è®¸å¯åè®® - ç½²åæ ‡ç¤º 4.0ï¼ˆCC BY 4.0ï¼‰è¿›è¡Œæˆæƒè®¸å¯ã€‚">ä¿ç•™éƒ¨åˆ†æƒåˆ©ã€‚</span></p></div><div class="footer-right"><p class="mb-0"> æœ¬åšå®¢ç”± <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> ç”Ÿæˆï¼Œä½¿ç”¨ <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> ä½œä¸ºä¸»é¢˜</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">çƒ­é—¨æ ‡ç­¾</h4><a class="post-tag" href="/tags/objective-c/">Objective C</a> <a class="post-tag" href="/tags/ios/">iOS</a> <a class="post-tag" href="/tags/macos/">macOS</a> <a class="post-tag" href="/tags/skills/">skills</a> <a class="post-tag" href="/tags/swift/">Swift</a> <a class="post-tag" href="/tags/swiftui/">SwiftUI</a> <a class="post-tag" href="/tags/algorithm/">Algorithm</a> <a class="post-tag" href="/tags/c++/">C++</a> <a class="post-tag" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">éŸ³è§†é¢‘</a> <a class="post-tag" href="/tags/avfoundation/">AVFoundation</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sunyazhou.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
